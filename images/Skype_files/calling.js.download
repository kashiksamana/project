(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{102:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PhoneNumberFormat=void 0;const a=i(34),n=i(2150),o=i(1),s=i(3),r=i(4),l=i(5),c=i(19),d=i(20),u=i(28),h=i(10),p=/[^0-9\.\+]+/g,g=/(,+(.*))/;let C;var m;!function(e){e[e.E164=1]="E164",e[e.INTERNATIONAL=2]="INTERNATIONAL",e[e.NATIONAL=3]="NATIONAL",e[e.RFC3966=4]="RFC3966"}(m=t.PhoneNumberFormat||(t.PhoneNumberFormat={}));class S{static isPossibleNumber(e,t){return S._getInstance().isPossibleNumberString(e,t||d.default.getCountryCode())}static getRegionCodeForNumber(e){try{return e?S._getInstance().getRegionCodeForNumber(e):void 0}catch(t){return void r.error(s.LogTraceArea.Phone,"PhoneUtils.getRegionCodeForNumber: Failed to get region code for number "+a.pii.Omit(e?e.getRawInput():"")+" - "+c.default.errorAsString(t))}}static getCountryCodeForRegion(e){return S._getInstance().getCountryCodeForRegion(e)}static isValidNumberString(e){return S.isValidNumber(S.parse(e))}static isValidNumber(e){return!!e&&S._getInstance().isValidNumber(e)}static parseAndFormat(e,t,i){const a=S.parse(e,i);if(a&&S._getInstance().isValidNumber(a))return S.format(a,t)}static parse(e,t){try{return S._getInstance().parse(e,t)}catch(e){return}}static parseAndKeepRawInput(e,t){try{return S._getInstance().parseAndKeepRawInput(e,t)}catch(t){return void r.error(s.LogTraceArea.Phone,"PhoneUtils.parseAndKeepRawInput: Failed to parse phone number "+a.pii.Omit(e)+" - "+c.default.errorAsString(t))}}static format(e,t){return t?S._getInstance().format(e,S._getGoogleFormat(t)):S._getInstance().format(e)}static formatNumberWithType(e){const t=S.getStringForPhoneType(e.type);let i=e.number;try{const t=S._getInstance().parse(e.number);i=S._getInstance().format(t,n.PhoneNumberFormat.INTERNATIONAL)}catch(e){}return l.getString("PhoneUtils.PhoneFormat",{type:t,number:i})}static getMatchedPhoneNumber(e,t){if(e&&0!==e.length)return o.find(e,e=>e.number.indexOf(t)>-1)}static getStringForPhoneType(e){switch(e){case u.PhoneNumberTypes.Home:return l.getString("PhoneUtils.PhoneHome");case u.PhoneNumberTypes.Mobile:return l.getString("PhoneUtils.PhoneMobile");case u.PhoneNumberTypes.Office:return l.getString("PhoneUtils.PhoneOffice");case u.PhoneNumberTypes.Other:return l.getString("PhoneUtils.PhoneOther");default:return h.default.switchStatementExhaustiveChecking(e)}}static convertLabelToPhoneType(e){if(!e)return u.PhoneNumberTypes.Other;switch(e.toLowerCase()){case"mobile":return u.PhoneNumberTypes.Mobile;case"office":return u.PhoneNumberTypes.Office;case"home":return u.PhoneNumberTypes.Home;default:return u.PhoneNumberTypes.Other}}static getNormalizedPhoneNumber(e,t=!0){let i=e.trim();if(t&&(i=S.convertPhoneLetters(i),i=i.replace(p,""),0===i.length))return"";let a=d.default.getCountryCode();if(!a){const e=l.getLocale().split("-");e instanceof Array&&e.length>1&&(a=e[1])}i=S.convert00ToPlus(i);let n=S.parse(i,a);return n&&S.isValidNumber(n)?S.format(n,m.E164):n&&o.startsWith(i,"+")?i:o.startsWith(i,"+")?void 0:(n=S.parse("+"+i),n&&S.isValidNumber(n)?S.format(n,m.E164):i)}static normalizePartialNumberWithCountryCode(e){let t=e.replace(p,"");if(0===t.length)return"";const i=d.default.getCountryCode();if(t=S.convert00ToPlus(t),!o.startsWith(t,"+")&&i)try{const e=S._getInstance().getCountryCodeForRegion(i);return S.compilePhoneNumber(t,e)}catch(e){return r.warn(s.LogTraceArea.Phone,"PhoneUtils: Unable to get country code for countryCode: ",a.pii.Omit(i)),t}return t}static convert00ToPlus(e){return o.startsWith(e,"00")?"+"+e.substr(2):e}static compilePhoneNumber(e,t){return"+"+t+e}static stripSpecialChars(e){return e.replace(p,"")}static stripPossibleExtension(e){return e.replace(g,"")}static getPossibleExtension(e,t){const i=e.match(g),a=t?1:2;return i&&i[a]?i[a]:void 0}static isPossiblyPhoneNumber(e){return!!e&&(e.startsWith("+")&&(e=e.slice(1)),!isNaN(parseInt(e,10)))}static stripPlusSign(e){return e&&e.length>0&&"+"===e[0]?e.substr(1):e}static _getInstance(){return C||(C=n.PhoneNumberUtil.getInstance()),C}static _getGoogleFormat(e){switch(e){case m.E164:return n.PhoneNumberFormat.E164;case m.INTERNATIONAL:return n.PhoneNumberFormat.INTERNATIONAL;case m.NATIONAL:return n.PhoneNumberFormat.NATIONAL;case m.RFC3966:return n.PhoneNumberFormat.RFC3966}}static convertPhoneLetters(e){e=e.toLowerCase();let t="";const i=o.startsWith(e,"+");return o.each(e.split(""),e=>{switch(e){case"0":t+="0";break;case"1":t+="1";break;case"2":t+="2";break;case"3":t+="3";break;case"4":t+="4";break;case"5":t+="5";break;case"6":t+="6";break;case"7":t+="7";break;case"8":t+="8";break;case"9":t+="9";break;case"a":case"b":case"c":t+="2";break;case"d":case"e":case"f":t+="3";break;case"g":case"h":case"i":t+="4";break;case"j":case"k":case"l":t+="5";break;case"m":case"n":case"o":t+="6";break;case"p":case"q":case"r":case"s":t+="7";break;case"t":case"u":case"v":t+="8";break;case"w":case"x":case"y":case"z":t+="9"}}),i&&(t="+"+t),t}}t.default=S},103:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSharingPrefix=t.EcoMode=t.SlimcoreSetupKeys=t.KeyDistributionUrlType=t.UdpTransportUrlType=t.ConversationServiceUrlType=t.TranslationState=t.StartCallOrMaybePromptUserIntent=t.UnansweredCallVisualInfoType=t.UnansweredCallVisualInfo=t.UnansweredCallAction=t.UnansweredCallReason=t.CallingError=t.CallValidationFailureReason=t.LocalCallActions=t.VideoOverrideReason=t.CallDeviceQualityEventType=t.CallDeviceState=t.CallNetworkQualityEventType=t.NetworkConnectionState=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.LostConnection=1]="LostConnection",e[e.Connecting=2]="Connecting",e[e.Connected=3]="Connected"}(t.NetworkConnectionState||(t.NetworkConnectionState={})),function(e){e[e.Unknown=0]="Unknown",e[e.NetworkReconnection=1]="NetworkReconnection",e[e.NetworkReceiveQuality=2]="NetworkReceiveQuality",e[e.NetworkReceiveCatastrophic=3]="NetworkReceiveCatastrophic",e[e.NetworkSendCatastrophic=4]="NetworkSendCatastrophic"}(t.CallNetworkQualityEventType||(t.CallNetworkQualityEventType={})),function(e){e[e.Working=0]="Working",e[e.NotWorking=1]="NotWorking"}(t.CallDeviceState||(t.CallDeviceState={})),function(e){e[e.None=0]="None",e[e.AudioStoppedWorking=1]="AudioStoppedWorking",e[e.AudioDeviceBusy=2]="AudioDeviceBusy",e[e.AudioDeviceMuted=3]="AudioDeviceMuted",e[e.MicrophoneStoppedWorking=4]="MicrophoneStoppedWorking",e[e.SpeakerStoppedWorking=5]="SpeakerStoppedWorking",e[e.VideoStoppedWorking=6]="VideoStoppedWorking",e[e.VideoTimedOut=7]="VideoTimedOut",e[e.VideoCameraBusy=8]="VideoCameraBusy",e[e.VideoSystemOutOfMemory=9]="VideoSystemOutOfMemory",e[e.DeviceCausingEcho=10]="DeviceCausingEcho",e[e.MicrophoneNotMuteButSilent=11]="MicrophoneNotMuteButSilent",e[e.DeviceRenderGlitches=12]="DeviceRenderGlitches",e[e.DeviceLowSNR=13]="DeviceLowSNR",e[e.DeviceClipping=14]="DeviceClipping",e[e.DeviceEcho=15]="DeviceEcho",e[e.DeviceMultipleEndpoints=16]="DeviceMultipleEndpoints",e[e.DeviceRenderZeroVolume=17]="DeviceRenderZeroVolume",e[e.CpuInsufficient=18]="CpuInsufficient",e[e.ZeroCaptureDevicesEnumerated=19]="ZeroCaptureDevicesEnumerated",e[e.ZeroRenderDevicesEnumerated=20]="ZeroRenderDevicesEnumerated",e[e.VideoCaptureDeviceFreeze=21]="VideoCaptureDeviceFreeze",e[e.AudioCapturePermissionDenied=22]="AudioCapturePermissionDenied",e[e.VideoCapturePermissionDenied=23]="VideoCapturePermissionDenied",e[e.VideoCaptureFreezeRecovered=24]="VideoCaptureFreezeRecovered",e[e.DeviceRenderHowling=25]="DeviceRenderHowling",e[e.PresentationAudioLoopbackDeviceState=26]="PresentationAudioLoopbackDeviceState",e[e.RemoteNetworkConnectivityIssue=27]="RemoteNetworkConnectivityIssue",e[e.AudioCaptureUltrasoundDetected=28]="AudioCaptureUltrasoundDetected",e[e.MusicModeNotAvailable=29]="MusicModeNotAvailable",e[e.CameraLighting=30]="CameraLighting",e[e.ImageRenderingQuality=31]="ImageRenderingQuality"}(t.CallDeviceQualityEventType||(t.CallDeviceQualityEventType={})),function(e){e[e.Logout=0]="Logout",e[e.InBackground=1]="InBackground",e[e.AudioOnlyMode=2]="AudioOnlyMode",e[e.IncomingVideoDisabled=3]="IncomingVideoDisabled",e[e.FullScreenBot=4]="FullScreenBot"}(t.VideoOverrideReason||(t.VideoOverrideReason={})),function(e){e[e.None=0]="None",e[e.Initialized=1]="Initialized",e[e.StartedWithRing=2]="StartedWithRing",e[e.StartedGoLive=4]="StartedGoLive",e[e.Joined=8]="Joined",e[e.Answered=16]="Answered",e[e.Rejected=32]="Rejected",e[e.Ended=64]="Ended"}(t.LocalCallActions||(t.LocalCallActions={})),function(e){e[e.None=0]="None",e[e.InvalidLiveState=1]="InvalidLiveState",e[e.InvalidParameters=2]="InvalidParameters",e[e.PlatformNotSupported=3]="PlatformNotSupported",e[e.CalleeIsBlocked=4]="CalleeIsBlocked",e[e.CallingNotAllowed=5]="CallingNotAllowed",e[e.CallNotFound=6]="CallNotFound",e[e.ConversationNotFound=7]="ConversationNotFound",e[e.NoCameraPermission=8]="NoCameraPermission",e[e.NoMicPermission=9]="NoMicPermission",e[e.NoMicDetected=10]="NoMicDetected",e[e.OtherCallsOngoing=11]="OtherCallsOngoing",e[e.GogoNetwork=12]="GogoNetwork",e[e.CalleeDoesNotSupportCalling=13]="CalleeDoesNotSupportCalling",e[e.GroupTooLarge=14]="GroupTooLarge",e[e.OnePersonGroup=15]="OnePersonGroup",e[e.E2eeHandshakeIncomplete=16]="E2eeHandshakeIncomplete",e[e.RegularMemberInModeratedGroup=17]="RegularMemberInModeratedGroup"}(t.CallValidationFailureReason||(t.CallValidationFailureReason={}));class a extends Error{constructor(e,t,i,a,n){super(t),this.action=e,this.message=t,this.terminatedReason=i,this.failureType=a,this.validationReason=n}}t.CallingError=a,function(e){e[e.None=0]="None",e[e.PstnNumberUnavailable=1]="PstnNumberUnavailable",e[e.PstnCallTerminated=2]="PstnCallTerminated",e[e.PstnNumberForbidden=3]="PstnNumberForbidden",e[e.PstnBlockedByUs=4]="PstnBlockedByUs",e[e.PstnCouldNotConnectToSkypeProxy=5]="PstnCouldNotConnectToSkypeProxy",e[e.PstnSkypeoutAccountBlocked=6]="PstnSkypeoutAccountBlocked",e[e.NoAnswer=7]="NoAnswer",e[e.Decline=8]="Decline",e[e.DeclineParticipant=9]="DeclineParticipant",e[e.Unreachable=10]="Unreachable",e[e.LocalNetworkError=11]="LocalNetworkError",e[e.NoMicrophoneDetected=12]="NoMicrophoneDetected",e[e.MicrophonePermissionDenied=13]="MicrophonePermissionDenied",e[e.CameraPermissionDenied=14]="CameraPermissionDenied",e[e.MicAndCamPermissionDenied=15]="MicAndCamPermissionDenied",e[e.Unknown=16]="Unknown",e[e.InvalidNumber=17]="InvalidNumber",e[e.EmergencyCallDenied=18]="EmergencyCallDenied",e[e.Kicked=19]="Kicked",e[e.InsufficientFunds=20]="InsufficientFunds",e[e.BlockedRegulatoryIndia=21]="BlockedRegulatoryIndia",e[e.BlockedRegulatoryNetherlands=22]="BlockedRegulatoryNetherlands"}(t.UnansweredCallReason||(t.UnansweredCallReason={})),function(e){e[e.None=0]="None",e[e.SendMessage=1]="SendMessage",e[e.PromptForPermission=2]="PromptForPermission",e[e.SendFeedback=3]="SendFeedback",e[e.CallPSTN=4]="CallPSTN",e[e.ShowRegulatoryInfoIndia=5]="ShowRegulatoryInfoIndia",e[e.ShowRegulatoryInfoNetherlands=6]="ShowRegulatoryInfoNetherlands"}(t.UnansweredCallAction||(t.UnansweredCallAction={}));t.UnansweredCallVisualInfo=class{},function(e){e[e.Emoticon=0]="Emoticon",e[e.Icon=1]="Icon"}(t.UnansweredCallVisualInfoType||(t.UnansweredCallVisualInfoType={})),function(e){e[e.Generic=0]="Generic",e[e.Video=1]="Video",e[e.Audio=2]="Audio"}(t.StartCallOrMaybePromptUserIntent||(t.StartCallOrMaybePromptUserIntent={})),function(e){e[e.Disabled=0]="Disabled",e[e.Requested=1]="Requested",e[e.Pending=2]="Pending",e[e.Enabled=3]="Enabled",e[e.Cancelled=4]="Cancelled",e[e.Declined=5]="Declined"}(t.TranslationState||(t.TranslationState={})),function(e){e.Prod="https://api.cc.skype.com/conv/",e.Dev="http://api.conv-dev.skype.net/conv/"}(t.ConversationServiceUrlType||(t.ConversationServiceUrlType={})),function(e){e.Prod="udp://api.cc.skype.com:3478/",e.Dev="udp://api.conv-dev.skype.net:11000/"}(t.UdpTransportUrlType||(t.UdpTransportUrlType={})),function(e){e.Prod="https://api.cc.skype.com/kd/",e.Dev="http://api.conv-dev.skype.net/kd/"}(t.KeyDistributionUrlType||(t.KeyDistributionUrlType={})),function(e){e.UdpEnabled="*Lib/Call/NG/UdpEnabled",e.EnableUdpCanary="*Lib/Call/NG/EnableUdpCanary",e.EnableEncryptedHttp="*Lib/Call/NG/EnableEncryptedHttp",e.EnableEncryptedHttpForBroker="*Lib/Call/NG/EnableEncryptedHttpForBroker",e.ConversationServiceUrl="*Lib/Call/NG/ConversationServiceUrl",e.UdpTransportUrl="*Lib/Call/NG/UdpTransportUrl",e.KeyDistributionUrl="*Lib/Call/NG/KeyDistributionUrl",e.EnableEcoMode="*Lib/Call/EnableEcoMode",e.EnableDnsCache="*Lib/Call/NG/EnableDnsCache",e.TestContextKey="*Lib/Call/TestContextId",e.ECSClientType="*Lib/ECS/ClientType",e.AutoJoinOnConflict="*Lib/Call/NG/AutoJoinOnConflict",e.AdditionalVideoLinesForGroupCalls="*Lib/Call/NG/AdditionalVideoLinesForGroupCalls",e.MaxNrOfVideosVisibleInUI="*Lib/Call/MaxNrOfVideosVisibleInUI",e.EndpointMetadataSetupKey="*Lib/Call/EndpointMetadata",e.LogLevelKey="*Lib/LogLevel",e.AufLogLevelKey="*Lib/AufObjectLogLevel",e.LogRotationSizeKey="*Lib/Logging/Rotation/RotateSize",e.LogRetentionTimeKey="*Lib/Logging/Rotation/RetentionTime",e.LogULMaxSizeKey="*Lib/RootTools/Logging/Appender/MaxSize",e.LogULMaxFilesKey="*Lib/RootTools/Logging/Appender/MaxRotations",e.DeleteOldLogsKey="*Lib/Logging/Rotation/DeleteOldLogs",e.MediaStackLogEnabledKey="*Lib/Media/MediaLibraryLogFileEnabled",e.PreserveFirstLogKey="*Lib/Logging/Rotation/PreserveFirstLog",e.EdfRegistrationKey="*Lib/Call/NG/ForceEDFRegistration",e.RenewSkypeTokenKey="*Lib/Auth/EnableRenewSkypeToken",e.UiLanguageKey="*Lib/Call/NG/LanguageId",e.EmergencyCallingCountryKey="Lib/Call/EmergencyCountry",e.MediaLibraryLogFileEnabledKey="*Lib/Media/MediaLibraryLogFileEnabled",e.AsyncMediaInitKey="*Lib/AsyncMediaInit"}(t.SlimcoreSetupKeys||(t.SlimcoreSetupKeys={})),function(e){e[e.Off=0]="Off",e[e.MobileNetwork=1]="MobileNetwork",e[e.AllNetworks=2]="AllNetworks"}(t.EcoMode||(t.EcoMode={})),t.ScreenSharingPrefix="ss_"},1088:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateTelemetry=t.getCallConnectionType=t.getCallConnectionTypeAndUpdateTelemetry=void 0;const a=i(74),n=i(87),o=i(17),s=i(71),r=i(33),l=i(3),c=i(4),d=i(30),u=i(822),h=i(39),p=i(22);function g(e,t){return c.log(l.LogTraceArea.Calling,"getCallConnectionType conversationMri: "+h.mriOrId(e)+" causeId: "+t),p.EnsureStarted([d.default,u.default]).then(()=>{if(d.default.getUserPreferencesLocalNoSubscription().forceRelay)return c.log(l.LogTraceArea.Calling,"getCallConnectionType NoDirectConnection due to force causeId: "+t),a.ConnectionType.NoDirectConnection;const i=u.default.getCallConnectionType();return i===a.ConnectionType.NoDirectConnection?(c.log(l.LogTraceArea.Calling,"getCallConnectionType NoDirectConnection due to NetworkOperatorStore causeId: "+t),i):e&&(o.isOneToOneThread(e)||o.isSkypeIdMri(e))?r.default().getConversationPotentiallyBeforeStartupAsync(e).then(e=>s.default.isConversationObjectAccepted(e)?a.ConnectionType.AllSupported:(c.log(l.LogTraceArea.Calling,"getCallConnectionType NoDirectConnection due to ContactsStore.isIncomingContactInvitePending causeId: "+t),a.ConnectionType.NoDirectConnection)):a.ConnectionType.AllSupported})}function C(e,t,i){n.default.updateCallTelemetry(e,i,e=>{e.setMccMncCode(u.default.getMccCode(),u.default.getMncCode()),e.callConnectionType(t)})}t.getCallConnectionTypeAndUpdateTelemetry=function(e,t,i){return g(t,i).then(t=>(C(e,t,i),t))},t.getCallConnectionType=g,t.updateTelemetry=C},1098:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(25),n=i(15),o=i(8),s=i(17),r=i(582);let l=class extends n.StoreBase{constructor(){super(...arguments),this._phoneNumberUserMri={}}_startedTrackingKey(e){const t=r.default.getUserByPhoneNumberExactMatch(e);this._phoneNumberUserMri[e]=t?t.getMri():void 0,this._updateUserMriByPhoneNumber(e)}getConversationMri(e){return this._phoneNumberUserMri[e]}getConversationMriAsync(e){const t=s.getPhoneNumberFromMri(e);return t?this._updateUserMriByPhoneNumber(t).then(()=>this._phoneNumberUserMri[t]||e):o.Resolved(e)}_updateUserMriByPhoneNumber(e){return r.default.getUserByPhoneNumberExactMatchAsync(e).then(t=>{this._phoneNumberUserMri[e]=t?t.getMri():void 0,this.trigger(e)})}};a.__decorate([n.disableWarnings],l.prototype,"_startedTrackingKey",null),a.__decorate([n.autoSubscribe,a.__param(0,n.key)],l.prototype,"getConversationMri",null),l=a.__decorate([n.AutoSubscribeStore],l),t.default=new l},110:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallUIUtils=t.ReactionButtonType=t.UnsupportedFeature=t.MaxVideoWidthOnMobile=t.ServerMutedToastTimeout=t.DummyVideoSize=void 0;const a=i(1),n=i(0),o=i(74),s=i(7),r=i(29),l=i(53),c=i(123),d=i(103),u=i(60),h=i(695),p=i(33),g=i(693),C=i(32),m=i(3),S=i(148),y=i(4),f=i(5),_=i(126),b=i(178),v=i(21),w=i(23),T=i(68),I=i(583),P=i(698),M=i(587),k=i(324),A=i(27),R=i(39),V=i(48),E=i(1546),L=i(264),B=i(9),O=i(11),D=i(56),x=i(95),N=i(515),U=i(10),F=i(30),H=i(17),z=i(219),G=i(518),W=i(588);t.DummyVideoSize={height:0,width:0};var K,j;t.ServerMutedToastTimeout=5e3,t.MaxVideoWidthOnMobile=1.3*u.RibbonSizes.ribbonItemSizeSmall,function(e){e[e.CallReactions=0]="CallReactions"}(K=t.UnsupportedFeature||(t.UnsupportedFeature={})),function(e){e[e.Celebration=0]="Celebration",e[e.Heart=1]="Heart"}(j=t.ReactionButtonType||(t.ReactionButtonType={}));const Q={[u.StageMode.Speaker]:"CallPanel.CallHeaderSpeakerViewLabel",[u.StageMode.Grid]:"CallPanel.CallHeaderGridViewLabel",[u.StageMode.Presentation]:"CallPanel.CallHeaderPresentationViewLabel",[u.StageMode.FocusedScreenShare]:"CallPanel.CallHeaderContentViewLabel",[u.StageMode.TogetherMode]:"CallPanel.CallHeaderTogetherModeViewLabel",[u.StageMode.LargeGrid]:"CallPanel.CallHeaderLargeGridViewLabel"},q={[u.StageMode.Speaker]:"CallPanel.CallHeaderSpeakerViewLabel",[u.StageMode.Grid]:"CallPanel.CallHeaderGridViewLabel",[u.StageMode.Presentation]:"CallPanel.CallHeaderPresentationViewLabel",[u.StageMode.FocusedScreenShare]:"CallPanel.CallHeaderContentViewLabel",[u.StageMode.TogetherMode]:"CallPanel.CallHeaderTogetherModeViewLabel",[u.StageMode.LargeGrid]:"CallPanel.CallHeaderLargeGalleryViewLabel"},X={[u.StageMode.Speaker]:O.SkypeIcon.StartIncomingVideo,[u.StageMode.Grid]:O.SkypeIcon.Gallery,[u.StageMode.FocusedScreenShare]:O.SkypeIcon.Presenter,[u.StageMode.LargeGrid]:O.SkypeIcon.GalleryLarge,[u.StageMode.TogetherMode]:O.SkypeIcon.Audience},$={[u.StageMode.Speaker]:O.SkypeIcon.StartIncomingVideo,[u.StageMode.Grid]:O.SkypeIcon.GridView,[u.StageMode.FocusedScreenShare]:O.SkypeIcon.ContentView,[u.StageMode.Presentation]:O.SkypeIcon.Presenter,[u.StageMode.LargeGrid]:O.SkypeIcon.GalleryLarge,[u.StageMode.TogetherMode]:O.SkypeIcon.Audience};class J{static elementInfoForParticipantOrScreenshare(e,t,i,a,n,s,l,h){const p=a.state,g=this.isFullScreenBot(t)?[d.VideoOverrideReason.FullScreenBot]:void 0,C=l?o.StreamType.ScreenSharing:o.StreamType.Video,S=this._streamStatus(t,C,i,h?h(t):void 0,void 0,g),f=this._streamDimensions(t,C,i),_=!!l&&(S===u.VideoStatus.Streaming||S===u.VideoStatus.Available);let b=!1;if(_){const e=r.default.ScreenSharingControlStoreRegistrar.getStoreFromCallId(i);if(e){const t=e.viewerInControl();t&&v.default.isMyMri(t.mri)&&(b=!0)}else y.warn(m.LogTraceArea.CallingUI,"Screen sharing control store is undefined")}const w=c.default.isParticipantRinging(a),T=s&&c.default.isParticipantOnHold(a),I=c.default.isParticipantMuted(a),P=!!l,M=r.default.CallingStore.getRaisedHandRankForMri(i,t),k=c.default.isParticipantTalking(a),A=t===r.default.CallScreenShareStore.getPresenter(i)&&!l,R=r.default.CallingStore.isHandRaisedForMri(t,i),V=this.isTogetherModeBot(t),E=this.isLargeGridBot(t),L=a.state;let B=0;const O=a.streams[C].map(e=>{const a=this._streamStatus(t,C,i,h?h(t,e.endpointId):void 0,e),n=this._streamDimensions(t,C,i,e.endpointId);return a!==u.VideoStatus.None&&B++,{endpointId:e.endpointId,videoStatus:a,videoDimensions:n}});let D=u.CallParticipantStreamsStatus.None;return 0!==B&&(D=B>1?u.CallParticipantStreamsStatus.Multiple:u.CallParticipantStreamsStatus.Single),n&&p===n.participantState&&S===n.videoStatus&&f===n.videoDimensions&&_===n.isScreensharing&&b===n.isScreenshareControlling&&w===n.isRinging&&T===n.isOnHold&&I===n.isServerMuted&&P===n.renderScreenShare&&M===n.raisedHandRank&&k===n.isTalking&&O===n.streams&&D===n.streamsStatus&&A===n.isPresenter&&R===n.isHandRaised&&L===n.state?n:{key:e,mri:t,participantState:p,videoStatus:S,videoDimensions:f,isScreensharing:_,isScreenshareControlling:b,isRinging:w,isOnHold:T,isServerMuted:I,renderScreenShare:P,ribbonAddTime:n?n.ribbonAddTime:this.nextRibbonAddTime(),connectionSortKey:w?1:0,raisedHandRank:M,isTalking:k,isHandRaised:R,isPresenter:A,state:L,streamsStatus:D,streams:O,isLargeGridBot:E,isTogetherModeBot:V}}static isLargeGridBot(e){const t=S.default.getCallGridViewBotMriFilter();return a.includes(t,e)}static isTogetherModeBot(e){const t=S.default.getCallAudienceBotMriFilter();return a.includes(t,e)}static isFullScreenBot(e){return this.isTogetherModeBot(e)||this.isLargeGridBot(e)}static isLocalOrServerMuted(e){return r.default.CallingFeaturesHelper.isLocalOrServerMuted(e)}static nextRibbonAddTime(e=!0){return e?this._ribbonAddTimeValue--:Date.now()}static shouldRenderParticipant(e,t,i,n){return(c.default.isParticipantConnected(t)||c.default.isParticipantRinging(t))&&!a.includes(n,i)}static getMouseCornerPosition(e,t,i){if(i){const a=.15*i.width;if(e-i.x<a&&t-i.y<a)return u.CallingViewCornerPostion.UpperLeft;if(e-i.x<a&&t-i.y>i.height-a)return u.CallingViewCornerPostion.BottomLeft;if(e-i.x>i.width-a&&t-i.y<a)return u.CallingViewCornerPostion.UpperRight;if(e-i.x>i.width-a&&t-i.y>i.height-a)return u.CallingViewCornerPostion.BottomRight}return u.CallingViewCornerPostion.NotAtCorner}static shouldStartSimulateViewResizing(e,t,i,a,n){return e&&t&&i&&a&&n}static shouldReRenderVisibleRibbonItems(e,t,i){const n=Math.min(e.length,t.length),o=i?e.filter(e=>-1===i.indexOf(e)&&-1===i.indexOf("ss_"+e)):e;let s=!1;return a.each(o.slice(0,n),e=>{-1===t.indexOf(e)&&(s=!0)}),s}static shouldRenderParticipantState(e){return c.default.isParticipantStateConnected(e)||c.default.isParticipantStateRinging(e)}static shouldRenderConnectedParticipantInEventStream(e,t,i){return c.default.isParticipantConnected(e)&&!a.includes(i,t)}static shouldRenderRingingParticipantInEventStream(e,t,i){return c.default.isParticipantRinging(e)&&!a.includes(i,t)}static ribbonLayoutRect(e,t,i,a,n,o){let s=a.height,r=a.width;const l=e&&e!==u.LayoutInfoVideoType.None?J.tryToGetCorrectAspectRatioViaVideoType(e,t,o):1;return n?s=a.height/l:r=a.width*l,{x:i,y:0,width:r,height:s}}static tryToGetCorrectAspectRatioViaVideoType(e,t,i){return a.isUndefined(t)||e===u.LayoutInfoVideoType.None?1:t}static getSwapableRibbionItemKeys(e){return a.map(e.filter(e=>!a.isUndefined(e.ribbonPosition)&&e.ribbonPosition>=0&&!e.displayOnStage&&!e.isLocal&&!e.isHostOfScreenshare&&!e.isScreenshare),e=>e.key)}static getSwapableRibbionItemIndex(e){const t=e.filter(e=>!a.isUndefined(e.ribbonPosition)&&!e.displayOnStage&&e.ribbonPosition>=0&&!e.isLocal&&!e.isHostOfScreenshare&&!e.isScreenshare);return a.map(t,t=>a.findIndex(e,e=>e.key===t.key))}static getVisibleSwapableRibbonItemKeys(e,t){return a.map(e.filter(e=>!a.isUndefined(e.ribbonPosition)&&!e.displayOnStage&&e.ribbonPosition>=0&&-1===t.indexOf(e.key)&&!e.isLocal&&!e.isHostOfScreenshare&&!e.isScreenshare),e=>e.key)}static reorderLayoutInfoViaLeastVisibleItemSwaping(e,t){const i=Math.min(t.length,e.length),n=J.getSwapableRibbionItemKeys(e).slice(0,i),o=J.getSwapableRibbionItemIndex(e).slice(0,i),s=a.filter(n,e=>-1===t.indexOf(e));let r=[],l=0;a.each(t,t=>{let i;i=-1!==n.indexOf(t)?t:s[l++];const o=a.find(e,e=>e.key===i);a.isUndefined(o)||r.push(a.clone(o))}),r.forEach((t,i)=>{if(i<o.length){const a=o[i];if(a<e.length){const i=e[a].ribbonPosition,n=e[a].participantRank;e[a]=t,e[a].ribbonPosition=i,e[a].participantRank=n}}})}static stageLayoutRect(e,t){const i=e.height*((null==t?void 0:t.height)||1),a=e.width*((null==t?void 0:t.width)||1);return J.translateRect({x:0,y:0,height:i,width:a},e.width)}static translateRect(e,t){if(!e)return;return{x:t-e.x-e.width,y:e.y,width:e.width,height:e.height}}static translatePoint(e,t){if(!e)return;return{x:t-e.x,y:e.y}}static nametagOffset(e,t,i,a){return{offset:i}}static accessoryPosition(e,t,i){if(i)switch(t){case 1:return;case 2:return u.CallAccessoryPosition.Center;case 3:return 0===e?u.CallAccessoryPosition.Center:1===e?u.CallAccessoryPosition.BottomRight:u.CallAccessoryPosition.TopRight}switch(t){case 1:return;case 2:case 3:return 0===e?u.CallAccessoryPosition.BottomRight:u.CallAccessoryPosition.TopRight;case 4:if(0===e||1===e)return u.CallAccessoryPosition.BottomRight;if(2===e||3===e)return u.CallAccessoryPosition.TopRight}}static compareElementInfo(e,t,i){if(e.connectionSortKey!==t.connectionSortKey)return this._compareValue(e.connectionSortKey,t.connectionSortKey);if(e.renderScreenShare!==t.renderScreenShare)return this._compareBoolean(!!t.renderScreenShare,!!e.renderScreenShare);if(e.isScreensharing!==t.isScreensharing)return this._compareBoolean(!!t.isScreensharing,!!e.isScreensharing);if(i&&!e.isTalking&&!t.isTalking&&e.raisedHandRank!==t.raisedHandRank)return this._compareValue(e.raisedHandRank||Number.MAX_VALUE,t.raisedHandRank||Number.MAX_VALUE);if(e.activeSpeakerRank!==t.activeSpeakerRank)return this._compareValue(e.activeSpeakerRank||-1,t.activeSpeakerRank||-1);const a=e.videoStatus===u.VideoStatus.Streaming,n=t.videoStatus===u.VideoStatus.Streaming;return a!==n?this._compareBoolean(n,a):this._compareValue(e.ribbonAddTime,t.ribbonAddTime)}static getOrderedByVideoPresenceParticipants(e,t){const i=r.default.CallParticipantStore.getParticipantRenderInfosForCall(t),n=a.compact(a.map(e,e=>i.get(e))).sort((e,t)=>this._compareRenderInfoBasedOnVideo(e,t));return a.map(n,e=>e.renderKey)}static getOrderedDisplayedTrayParticipants(e,t,i,n=!1,o=!1){const s=r.default.CallParticipantStore.getParticipantRenderInfosForCall(i),l=a.compact(a.map(e,e=>s.get(e))),c=o?G.default.getPinnedParticipants(i):void 0,d=l.sort((e,t)=>this._compareTrayRenderInfo(e,t,n,c)),u=this._getNumberOfShownParticipants(t,d),h=a.take(d,u),p=a.takeRight(d,d.length-u),g=a.find(p,e=>0===e.activeSpeakerRank);return g&&a.fill(h,g,h.length-1),a.map(h,e=>e.renderKey)}static _compareTrayRenderInfo(e,t,i,n){if(e.isLocal!==t.isLocal)return this._compareBoolean(t.isLocal,e.isLocal);if(i&&e.isPresenter!==t.isPresenter)return this._compareBoolean(!!t.isPresenter,!!e.isPresenter);if(n){const i=a.includes(n,e.renderKey),o=a.includes(n,t.renderKey);if(i!==o)return this._compareBoolean(o,i)}const o=e.videoStatus===u.VideoStatus.Streaming||e.videoStatus===u.VideoStatus.Available,s=t.videoStatus===u.VideoStatus.Streaming||t.videoStatus===u.VideoStatus.Available;if(o!==s)return this._compareBoolean(s,o);const r=0===e.activeSpeakerRank,l=0===t.activeSpeakerRank;if(r!==l)return this._compareBoolean(l,r);if(!e.isTalking&&!t.isTalking&&e.raisedHandRank!==t.raisedHandRank){const i=a.isUndefined(e.raisedHandRank)?Number.MAX_VALUE:e.raisedHandRank,n=a.isUndefined(t.raisedHandRank)?Number.MAX_VALUE:t.raisedHandRank;return this._compareValue(i,n)}return e.activeSpeakerRank!==t.activeSpeakerRank?this._compareValue(e.activeSpeakerRank||-1,t.activeSpeakerRank||-1):1}static _compareRenderInfoBasedOnVideo(e,t){if(e.isLocal!==t.isLocal)return this._compareBoolean(t.isLocal,e.isLocal);const i=e.videoStatus===u.VideoStatus.Streaming||e.videoStatus===u.VideoStatus.Available,a=t.videoStatus===u.VideoStatus.Streaming||t.videoStatus===u.VideoStatus.Available;return i!==a?this._compareBoolean(a,i):1}static _getNumberOfShownParticipants(e,t){let i=t.length;if(a.sumBy(t,e=>this._getParticipantWidth(e))>e){let n=e-u.BigTrayOverflowButtonWidth;a.each(t,(e,t)=>n>this._getParticipantWidth(e)?(n-=this._getParticipantWidth(e),!0):(i=t,!1))}return i}static _getParticipantWidth(e){return e?e.videoStatus===u.VideoStatus.None?u.BigTrayCallParticipantWidth.audio:u.BigTrayCallParticipantWidth.video:0}static getErrorToastType(e){switch(e){case d.CallDeviceQualityEventType.AudioStoppedWorking:return u.DeviceStatusToastType.AudioStoppedWorking;case d.CallDeviceQualityEventType.MicrophoneStoppedWorking:return u.DeviceStatusToastType.MicrophoneStoppedWorking;case d.CallDeviceQualityEventType.SpeakerStoppedWorking:return u.DeviceStatusToastType.SpeakerStoppedWorking;case d.CallDeviceQualityEventType.AudioDeviceBusy:return u.DeviceStatusToastType.AudioDeviceBusy;case d.CallDeviceQualityEventType.VideoStoppedWorking:return u.DeviceStatusToastType.VideoStoppedWorking;case d.CallDeviceQualityEventType.VideoTimedOut:return u.DeviceStatusToastType.VideoTimedOut;case d.CallDeviceQualityEventType.VideoCameraBusy:return u.DeviceStatusToastType.VideoSystemBusy;case d.CallDeviceQualityEventType.VideoSystemOutOfMemory:return u.DeviceStatusToastType.VideoSystemOutOfMemory;case d.CallDeviceQualityEventType.DeviceCausingEcho:return u.DeviceStatusToastType.DeviceCausingEcho;case d.CallDeviceQualityEventType.MicrophoneNotMuteButSilent:return u.DeviceStatusToastType.MicrophoneNotMuteButSilent;case d.CallDeviceQualityEventType.DeviceRenderGlitches:return u.DeviceStatusToastType.DeviceRenderGlitches;case d.CallDeviceQualityEventType.DeviceLowSNR:return u.DeviceStatusToastType.DeviceLowSNR;case d.CallDeviceQualityEventType.DeviceClipping:return u.DeviceStatusToastType.DeviceClipping;case d.CallDeviceQualityEventType.DeviceEcho:return u.DeviceStatusToastType.DeviceEcho;case d.CallDeviceQualityEventType.DeviceMultipleEndpoints:return u.DeviceStatusToastType.DeviceMultipleEndpoints;case d.CallDeviceQualityEventType.DeviceRenderZeroVolume:return u.DeviceStatusToastType.DeviceRenderZeroVolume;case d.CallDeviceQualityEventType.CpuInsufficient:return u.DeviceStatusToastType.CpuInsufficient;case d.CallDeviceQualityEventType.ZeroCaptureDevicesEnumerated:return u.DeviceStatusToastType.ZeroCaptureDevicesEnumerated;case d.CallDeviceQualityEventType.ZeroRenderDevicesEnumerated:return u.DeviceStatusToastType.ZeroRenderDevicesEnumerated;case d.CallDeviceQualityEventType.VideoCaptureDeviceFreeze:return u.DeviceStatusToastType.VideoCaptureDeviceFreeze;case d.CallDeviceQualityEventType.AudioCapturePermissionDenied:return u.DeviceStatusToastType.AudioCapturePermissionDenied;case d.CallDeviceQualityEventType.VideoCapturePermissionDenied:return u.DeviceStatusToastType.VideoCapturePermissionDenied;case d.CallDeviceQualityEventType.VideoCaptureFreezeRecovered:return u.DeviceStatusToastType.VideoCaptureFreezeRecovered;case d.CallDeviceQualityEventType.DeviceRenderHowling:return u.DeviceStatusToastType.DeviceRenderHowling;case d.CallDeviceQualityEventType.PresentationAudioLoopbackDeviceState:return u.DeviceStatusToastType.PresentationAudioLoopbackDeviceState;case d.CallDeviceQualityEventType.RemoteNetworkConnectivityIssue:return u.DeviceStatusToastType.RemoteNetworkConnectivityIssue;case d.CallDeviceQualityEventType.AudioCaptureUltrasoundDetected:return u.DeviceStatusToastType.AudioCaptureUltrasoundDetected;case d.CallDeviceQualityEventType.MusicModeNotAvailable:return u.DeviceStatusToastType.MusicModeNotAvailable;case d.CallDeviceQualityEventType.CameraLighting:return u.DeviceStatusToastType.CameraLighting;case d.CallDeviceQualityEventType.ImageRenderingQuality:return u.DeviceStatusToastType.ImageRenderingQuality;default:return}}static getToastInformation(e,i,a,n){let o,s,r=!1,l=O.SkypeIcon.Warning;switch(e){case u.DeviceStatusToastType.AudioStoppedWorking:o="CallPanel.AudioDeviceFailed",r=!0;break;case u.DeviceStatusToastType.MicrophoneStoppedWorking:o="CallPanel.MicrophoneFailed",r=!0;break;case u.DeviceStatusToastType.SpeakerStoppedWorking:o="CallPanel.SpeakerFailed",r=!0;break;case u.DeviceStatusToastType.AudioDeviceBusy:o="CallPanel.AudioDeviceBusy",r=!0;break;case u.DeviceStatusToastType.MicrophoneDisconnected:o="CallPanel.NoMicrophone";break;case u.DeviceStatusToastType.SpeakerDisconnected:o="CallPanel.NoSpeaker";break;case u.DeviceStatusToastType.SoundSharingStopped:o="CallPanel.SoundSharingStopped";break;case u.DeviceStatusToastType.VideoStoppedWorking:case u.DeviceStatusToastType.VideoTimedOut:o="CallPanel.CameraFailed",r=!0;break;case u.DeviceStatusToastType.VideoSystemBusy:o="CallPanel.CameraBusy",r=!0;break;case u.DeviceStatusToastType.VideoSystemOutOfMemory:o="CallPanel.CameraStoppedWorkingOutOfMemory";break;case u.DeviceStatusToastType.CameraChanged:o="CallPanel.CameraChanged",r=!0,s=1e4;break;case u.DeviceStatusToastType.MicrophoneChanged:o="CallPanel.MicrophoneChanged",r=!0,s=1e4;break;case u.DeviceStatusToastType.SpeakerChanged:o="CallPanel.SpeakerChanged",r=!0,s=1e4;break;case u.DeviceStatusToastType.CompositeAudioAvailable:a?(o="CallPanel.NewAudio",s=1e4):(o="CallPanel.CompositeAudioChanged",r=!0,s=1e4);break;case u.DeviceStatusToastType.DeviceCausingEcho:o="CallPanel.DeviceCausingEcho",s=1e4;break;case u.DeviceStatusToastType.MicrophoneNotMuteButSilent:o="CallPanel.MicrophoneNotMuteButSilent",r=!0,s=1e4;break;case u.DeviceStatusToastType.MicrophoneServerMuted:o="CallPanel.MicrophoneServerMuted",s=t.ServerMutedToastTimeout,l=O.SkypeIcon.MicrophoneOff;break;case u.DeviceStatusToastType.OutgoingVideoDisabledDuringScreenSharing:o="CallPanel.OutgoingVideoDisabledScreenSharing";break;case u.DeviceStatusToastType.DeviceRenderGlitches:o="CallPanel.DeviceRenderGlitches",r=!0;break;case u.DeviceStatusToastType.DeviceLowSNR:o="CallPanel.DeviceLowSNR";break;case u.DeviceStatusToastType.DeviceClipping:o="CallPanel.DeviceClipping";break;case u.DeviceStatusToastType.DeviceEcho:o="CallPanel.DeviceEcho",l=O.SkypeIcon.MicrophoneOff;break;case u.DeviceStatusToastType.DeviceMultipleEndpoints:o="CallPanel.DeviceMultipleEndpoints",l=O.SkypeIcon.MicrophoneOff;break;case u.DeviceStatusToastType.DeviceRenderZeroVolume:o="CallPanel.DeviceRenderZeroVolume";break;case u.DeviceStatusToastType.CpuInsufficient:o="CallPanel.CpuInsufficient";break;case u.DeviceStatusToastType.ZeroCaptureDevicesEnumerated:o="CallPanel.ZeroCaptureDevicesEnumerated";break;case u.DeviceStatusToastType.ZeroRenderDevicesEnumerated:o="CallPanel.ZeroRenderDevicesEnumerated";break;case u.DeviceStatusToastType.VideoCaptureDeviceFreeze:o="CallPanel.VideoCaptureDeviceFreeze",r=!0,s=1e4;break;case u.DeviceStatusToastType.AudioCapturePermissionDenied:o="CallPanel.AudioCapturePermissionDenied",r=!0;break;case u.DeviceStatusToastType.VideoCapturePermissionDenied:o="CallPanel.VideoCapturePermissionDenied",r=!0;break;case u.DeviceStatusToastType.VideoCaptureFreezeRecovered:o="CallPanel.VideoCaptureFreezeRecovered",r=!0,s=1e4;break;case u.DeviceStatusToastType.DeviceRenderHowling:o="CallPanel.DeviceRenderHowling",r=!0;break;case u.DeviceStatusToastType.PresentationAudioLoopbackDeviceState:o="CallPanel.PresentationAudioLoopbackDeviceState";break;case u.DeviceStatusToastType.RemoteNetworkConnectivityIssue:o="CallPanel.RemoteNetworkConnectivityIssue";break;case u.DeviceStatusToastType.AudioCaptureUltrasoundDetected:o="CallPanel.AudioCaptureUltrasoundDetected",l=O.SkypeIcon.MicrophoneOff;break;case u.DeviceStatusToastType.MusicModeNotAvailable:o="CallPanel.MusicModeNotAvailable";break;case u.DeviceStatusToastType.CameraLighting:o="CallPanel.CameraLighting";break;case u.DeviceStatusToastType.ImageRenderingQuality:o="CallPanel.ImageRenderingQuality";break;case u.DeviceStatusToastType.VideoEffectsQualityChange:o="CallPanel.OnVideoEffectsQuality";break;case u.DeviceStatusToastType.None:default:return void y.warn(m.LogTraceArea.CallingUI,"Showing toast without specified error type this shouldnt happen")}return{notificationText:f.getString(o,i),showAvSettingsLink:r,timeout:s,icon:l,buttons:a,action:n}}static enableLayoutAnimation(){return!1}static useLightTheme(){return s.default.getS4LCMCFeatures().enableLightThemeOnCallStage&&!x.default.useDarkTheme()}static useHighContrastTheme(){return s.default.getS4LCMCFeaturesNoSubscription().enableHighContrastTheme&&x.default.useAccessibleThemeNoSubscription()}static useHighContrastThemeAndChanges(){return s.default.getS4LCMCFeatures().enableHighContrastTheme&&x.default.useAccessibleTheme()}static disableCaptureAndChanges(e){return r.default.CallingStore.isProvidingVideo(e)}static _compareValue(e,t){return e===t?0:e>t?1:-1}static _compareBoolean(e,t){return e===t?0:e?1:-1}static fallbackStageElements(e,t,i){const a=this._fallbackStageParticipantKey(e,t,i);return a?[a]:[]}static isLeftPanelOpen(e){return!w.default.isUsingStackNavigationContext()&&T.default.isLeftPanelShowing(e)}static isGalleryPanelOpen(e){return!w.default.isUsingStackNavigationContext()&&T.default.isGalleryShowing(e)}static isSubtitlesPanelOpen(e){return!w.default.isUsingStackNavigationContext()&&T.default.isSubtitlesShowing(e)}static isRightPanelOpen(e){return!w.default.isUsingStackNavigationContext()&&T.default.isRightSideBarShowing(e)}static getCallCanvasWidth(e){let t=A.default.getWidth(e);return t-=!w.default.isUsingSplitViewNoSubscription()&&this.isLeftPanelOpen(e)?L.default.getWidthNoSubscription(L.SideBar.Left):0,t-=this.isRightPanelOpen(e)?L.default.getWidthNoSubscription(L.SideBar.Right,!1):0,t}static getControlsType(e,t){const i=this.getCallCanvasWidth(e),a=t;let n;return n=w.default.isUsingStackNavigationContext()?u.CallControlsType.Mobile:i<=this._getWidthBreakpoint(u.CallControlsType.DesktopMinSmallest,a)?u.CallControlsType.DesktopMinSmallest:i<=this._getWidthBreakpoint(u.CallControlsType.DesktopMinStageTwo,a)?u.CallControlsType.DesktopMinStageTwo:i<=this._getWidthBreakpoint(u.CallControlsType.DesktopMin,a)?u.CallControlsType.DesktopMin:u.CallControlsType.Default,n}static _getWidthBreakpoint(e,t){if(t)switch(e){case u.CallControlsType.DesktopMin:return u.DesktopMinNewCallControlsWidthBreakpoint;case u.CallControlsType.DesktopMinStageTwo:return u.DesktopMinStageTwoNewCallControlsWidthBreakpoint;case u.CallControlsType.DesktopMinSmallest:return u.DesktopMinSmallestNewCallControlsWidthBreakpoint}else switch(e){case u.CallControlsType.DesktopMin:return u.DesktopMinCallControlsWidthBreakpoint;case u.CallControlsType.DesktopMinStageTwo:return u.DesktopMinStageTwoCallControlsWidthBreakpoint;case u.CallControlsType.DesktopMinSmallest:return u.DesktopMinSmallestCallControlsWidthBreakpoint}return-1}static isMinDesktop(e){return e===u.CallControlsType.DesktopMinSmallest||e===u.CallControlsType.DesktopMinStageTwo||e===u.CallControlsType.DesktopMin}static getMomentsIcon(){return O.SkypeIcon.Snapshot}static isDesktopMinCallPanelHeader(e){return!w.default.isUsingStackNavigationContext()&&!D.default.isTablet()&&this.getCallCanvasWidth(e)<=u.DesktopMinCallPanelHeaderWidthBreakpoint}static isDesktopMinCallRibbon(e){return!w.default.isUsingStackNavigationContext()&&!D.default.isTablet()&&this.getCallCanvasWidth(e)<=u.DesktopMinCallRibbonWidthBreakpoint}static isDesktopMinCallPanelHeaderV2(e){return!w.default.isUsingStackNavigationContext()&&!D.default.isTablet()&&this.getCallCanvasWidth(e)<=u.DesktopMinCallPanelHeaderV2WidthBreakpoint}static overflowMenuRowButtonsDescriptors(e){if(!e.callId||e.isEncryptedCall)return[];let t=[];const i=new I.NativeMobileInvitePeopleCommand(e.conversationMri,_.MeetNowOrigin.CallPanel,e.callId);if(i.canExecute()){const e=f.getString("JoinLinkCard.InvitePopupAccessibilityTitle");let a={key:u.CallControlsOverflowItem.AddPeople,icon:{icon:O.SkypeIcon.ShareiOS,color:B.Color.white},title:e,accessibilityLabel:e,onPress:()=>i.execute()};t.push(a)}return t}static overflowMenuToggleDescriptors(e){if(!e.callId||e.isEncryptedCall)return[];const t={isPSTNCall:e.isPSTNCall,isEncryptedCall:e.isEncryptedCall,conversationMri:e.conversationMri,callId:e.callId},i=[];if(e.isBackroundBlurEnabled){const t=new I.BackgroundBlurCommand(e.callId,e.isVideoActive,e.isBackroundBlurEnabled,e.isBackgroundBlurSelected),a={key:u.CallControlsOverflowItem.BackgroundBlur,icon:{icon:O.SkypeIcon.BackgroundReplacement,color:B.Color.white},title:f.getString("CallControlsOverFlowMenu.EnableBackgroundBlur"),accessibilityLabel:f.getString("CallControlsOverFlowMenu.EnableBackgroundBlur"),onPress:()=>t.execute(),selected:e.isBackgroundBlurSelected,disabled:!t.canExecute(),isNew:e.isBackgroundBlurNewItem};i.push(a)}const a=new I.ToggleIncomingVideoCommand(e.callId,t,e.isAudioOnlyEnabled,e.isIncomingVideoDisabled);if(a.canExecute()){const t=!e.isIncomingVideoDisabled&&!e.isAudioOnlyEnabled,n=f.getString(t?"CallControlsOverFlowMenu.StopIncomingVideo":"CallControlsOverFlowMenu.StartIncomingVideo"),o={key:u.CallControlsOverflowItem.IncomingVideo,icon:{icon:O.SkypeIcon.Video,color:B.Color.white},title:f.getString("CallControlsOverFlowMenu.StartIncomingVideo"),accessibilityLabel:n,onPress:()=>a.execute(),selected:t};i.push(o)}const n=new I.ToggleTranslatorCommand(e.callId,t,e.isTranslating);if(n.canExecute()&&e.callUIState===u.CallUIState.Default){const t=f.getString(e.isTranslating?"CallControlsOverFlowMenu.StopSubtitles":"CallControlsOverFlowMenu.StartSubtitles"),a={key:u.CallControlsOverflowItem.CallTranslator,icon:{icon:O.SkypeIcon.ClosedCaption,color:B.Color.white},title:f.getString("CallControlsOverFlowMenu.StartSubtitles"),accessibilityLabel:t,onPress:()=>n.execute(),selected:e.isTranslating};i.push(a)}return i}static overflowMenuButtonDescriptors(e,t){if(!e.callId||e.isEncryptedCall)return[];const i={isPSTNCall:e.isPSTNCall,isEncryptedCall:e.isEncryptedCall,conversationMri:e.conversationMri,callId:e.callId},a=[],n=new I.ShowBingBackgroundsCommand(e.callId,e.callerContext);if(n.canExecute()){const e={key:u.CallControlsOverflowItem.BingBackgrounds,icon:{icon:O.SkypeIcon.Bing,color:B.Color.white},title:f.getString("CallControlsOverFlowMenu.BingBackgrounds"),accessibilityLabel:f.getString("CallControlsOverFlowMenu.BingBackgrounds"),onPress:()=>n.execute()};a.push(e)}const o=new I.AddToCallCommand(e.callId,i,e.conversationMri,e.callerContext,m.NavigationAddToCallOrigin.OverflowMenu);if(o.canExecute()){const e={key:u.CallControlsOverflowItem.AddPeople,icon:{icon:O.SkypeIcon.ContactAdd,color:B.Color.white},title:f.getString("CallControlsOverFlowMenu.AddPeopleToCall"),accessibilityLabel:f.getString("CallControlsOverFlowMenu.AddPeopleToCall"),onPress:()=>o.execute()};a.push(e)}const s=new I.ToggleRecordCommand(e.callId,i,e.isRecording);if(s.canExecute()&&e.callUIState===u.CallUIState.Default){const t=f.getString(e.isRecording?"CallControlsOverFlowMenu.StopRecording":"CallControlsOverFlowMenu.StartRecording"),i={key:u.CallControlsOverflowItem.CallRecording,icon:e.isRecording?[{icon:O.SkypeIcon.CallRecordStroke,color:B.Color.white},{icon:O.SkypeIcon.CallRecordDot,color:B.Color.red}]:{icon:O.SkypeIcon.CallRecord,color:B.Color.white},title:t,accessibilityLabel:t,onPress:()=>s.execute()};a.push(i)}if(!r.default.CallingFeaturesHelper.allowReactionsInCallStageMobile()){const t=this.getReactionButtonType(e.conversationMri,e.callId),n=this.getReactionCommand(t,e.callId,i,e.reactionsConversationMri);if(n){const e=this.getReactionButtonDescriptors(t,n),i=Object.assign(Object.assign({},e),{icon:{icon:e.icon,color:B.Color.white}});a.push(i)}}const l=new I.MomentCommand(i.callId,i,e.reactionsConversationMri);if(l.canExecute()&&r.default.CallingFeaturesHelper.allowReactionsInCallStageMobile()&&e.callUIState===u.CallUIState.Default){const e={icon:O.SkypeIcon.Snapshot,color:B.Color.white},t=f.getString("CallReactionsBar.PhotoSnapshotButtonShortTitle"),i={key:u.CallControlsOverflowItem.Moments,icon:e,title:t,accessibilityLabel:t,onPress:()=>l.execute()};a.push(i)}const c=new E.MobileScreenShareToggleCommand(i);if(c.canExecute()){const t=e.isScreenShareActive?{icon:O.SkypeIcon.ScreenShareOff,color:B.Color.white}:{icon:O.SkypeIcon.ScreenShare,color:B.Color.white},i=f.getString(e.isScreenShareActive?"CallControlsOverFlowMenu.StopShareScreen":"CallControlsOverFlowMenu.ShareScreen"),n={key:u.CallControlsOverflowItem.MobileScreenSharing,icon:t,title:i,accessibilityLabel:i,onPress:()=>c.execute()};a.push(n)}const d=new P.RaiseHandCommand(i.callId,e);if(d.canExecute()){const e={icon:O.SkypeIcon.RaiseHand,color:B.Color.white},t=f.getString("CallControls.RaiseHand"),i=f.getString("CallControls.RaiseHandLabel"),n={key:u.CallControlsOverflowItem.RaiseHands,icon:e,title:t,accessibilityLabel:i,onPress:()=>d.execute()};a.push(n)}const h=new P.LowerHandCommand(i.callId,M.LowerHandOrigin.CallControls);if(h.canExecute()){const e={icon:O.SkypeIcon.LowerHand,color:B.Color.white},t=f.getString("CallControls.LowerHand"),i=f.getString("CallControls.LowerHandLabel"),n={key:u.CallControlsOverflowItem.LowerHands,icon:e,title:t,accessibilityLabel:i,onPress:()=>h.execute()};a.push(n)}const p=new I.ToggleCallStatsCommand(e.callId,t);if(p.canExecute()){const e={key:u.CallControlsOverflowItem.CallStats,icon:{icon:O.SkypeIcon.Info,color:B.Color.white},title:f.getString("CallPanel.CallStats"),doesNotInfluenceMenuLayout:!0,onPress:()=>p.execute()};a.push(e)}const g=new I.ChangeTogetherModeBackgroundCommand(i.callId,i.conversationMri);if(g.canExecute()){const e=f.getString("CallControlsOverFlowMenu.ChangeTogetherModeBackground"),t={key:u.CallControlsOverflowItem.ChangeTogetherModeBackground,icon:{icon:N.default.getBackgroundChangeButtonIcon(),color:B.Color.white},title:e,doesNotInfluenceMenuLayout:!0,onPress:()=>g.execute()};a.push(t)}return a}static overflowMenuItemDescriptor(e,t=!1,i=!1,a=!1){let n,o,s;switch(e){case u.CallControlsOverflowItem.AddPeople:s={icon:O.SkypeIcon.ContactAdd,color:B.Color.white},n=f.getString("CallControlsOverFlowMenu.AddPeopleToCall");break;case u.CallControlsOverflowItem.Chat:s={icon:t?O.SkypeIcon.ChatsInverted:O.SkypeIcon.Message,color:B.Color.white},n=f.getString("ContentPanel.ChatTabTitle"),o=t?f.getString("CallPanel.CloseConversation"):f.getString("CallPanel.OpenConversation");break;case u.CallControlsOverflowItem.Reactions:let r;r=t?O.SkypeIcon.Cancel:i?O.SkypeIcon.Birthday:O.SkypeIcon.HeartOutline,s={icon:r,color:B.Color.white},n=f.getString("CallReactionsBar.EmoticonButtonShortTitle");break;case u.CallControlsOverflowItem.HeartReaction:s={icon:O.SkypeIcon.HeartOutline,color:B.Color.white},n=f.getString("CallControlsOverFlowMenu.ReactWithHeart");break;case u.CallControlsOverflowItem.ThumbsUpReaction:s={icon:O.SkypeIcon.CategoryYes,color:B.Color.white},n=f.getString("CallControlsOverFlowMenu.ThumbsUp");break;case u.CallControlsOverflowItem.CelebrationAnimation:s={icon:O.SkypeIcon.Birthday,color:B.Color.white},n=f.getString("CallControlsOverFlowMenu.CelebrateBirthday");break;case u.CallControlsOverflowItem.Gallery:s={icon:O.SkypeIcon.Gallery1,color:B.Color.white},n=f.getString("CallReactionsBar.GalleryButtonTitle");break;case u.CallControlsOverflowItem.Moments:s={icon:this.getMomentsIcon(),color:B.Color.white},n=f.getString("CallReactionsBar.PhotoSnapshotButtonShortTitle");break;case u.CallControlsOverflowItem.CallRecording:s=t?[{icon:O.SkypeIcon.CallRecordStroke,color:B.Color.white},{icon:O.SkypeIcon.CallRecordDot,color:B.Color.red}]:{icon:O.SkypeIcon.CallRecord,color:B.Color.white},n=f.getString(t?"CallControlsOverFlowMenu.StopRecording":"CallControlsOverFlowMenu.StartRecording");break;case u.CallControlsOverflowItem.CallTranslator:s=t&&!a?{icon:O.SkypeIcon.ClosedCaptionFilled,color:B.Color.white}:{icon:O.SkypeIcon.ClosedCaption,color:B.Color.white},n=a?f.getString("CallControlsOverFlowMenu.SubtitlesToggle"):f.getString(t?"CallControlsOverFlowMenu.StopSubtitles":"CallControlsOverFlowMenu.StartSubtitles");break;case u.CallControlsOverflowItem.IncomingVideo:s={icon:O.SkypeIcon.Video,color:B.Color.white},n=f.getString("CallControlsOverFlowMenu.StartIncomingVideo");break;case u.CallControlsOverflowItem.AudienceChangeBackground:s={icon:O.SkypeIcon.Bot,color:B.Color.white},n=f.getString("CallControlsOverFlowMenu.AudienceBotBackgroundChange");break;case u.CallControlsOverflowItem.MobileScreenSharing:s={icon:O.SkypeIcon.ScreenShare,color:B.Color.white},n=f.getString("CallControlsOverFlowMenu.ShareScreen");break;case u.CallControlsOverflowItem.CallStats:s={icon:O.SkypeIcon.Info,color:B.Color.white},n=f.getString("CallPanel.CallStats");break;case u.CallControlsOverflowItem.ChangeTogetherModeBackground:s={icon:N.default.getBackgroundChangeButtonIcon(),color:B.Color.white},n=f.getString("CallControlsOverFlowMenu.ChangeTogetherModeBackground");break;case u.CallControlsOverflowItem.BackgroundBlur:s={icon:O.SkypeIcon.BackgroundReplacement,color:B.Color.white},n=f.getString("CallControls.CallMenuBlurBackground");break;case u.CallControlsOverflowItem.RaiseHands:s={icon:O.SkypeIcon.Up,color:B.Color.white},n=f.getString("CallControls.RaiseHand");break;case u.CallControlsOverflowItem.LowerHands:s={icon:O.SkypeIcon.Down,color:B.Color.white},n=f.getString("CallControls.LowerHand");break;case u.CallControlsOverflowItem.BingBackgrounds:s={icon:O.SkypeIcon.BackgroundReplacement,color:B.Color.white},n=f.getString("CallControls.BingBackgrounds");break;default:return U.default.switchStatementExhaustiveChecking(e)}return{icon:s,title:n,accessibilityLabel:o||n}}static getFeatureUnsupportedParticipantsInfo(e,t,i){return a.isEmpty(t)?void 0:{count:t.length,firstUser:C.default.getMemberShortNameForConversation(i,r.default.CallingStore.getRemoteCallMemberMri(e,t[0])),secondUser:t.length>1?C.default.getMemberShortNameForConversation(i,r.default.CallingStore.getRemoteCallMemberMri(e,t[1])):void 0}}static getFeatureUnsupportedMessage(e,t){const i=e.count;let a;if(e.firstUser&&(e.firstUser||e.secondUser))switch(i){case 1:a=this._getOneCountFeatureUnsupportedMessage(e.firstUser,t);break;case 2:a=this._getTwoCountFeatureUnsupportedMessage(e,t);break;default:a=this._getMoreCountFeatureUnsupportedMessage(e,t)}else a=this._getDefaultFeatureUnsupportedMessage(t);return a||y.error(m.LogTraceArea.CallingUI,"CallUIUtils.getFeatureUnsupportedMessage Missing localized unsupported message"),a}static announceCameraDirectionState(e){if(!V.default.shouldAnnounceForAccessibility())return;let t;e===o.CameraPosition.Front?t=f.getString("CallControls.CameraFrontAnnouncement"):e===o.CameraPosition.Back&&(t=f.getString("CallControls.CameraBackAnnouncement")),t&&n.Accessibility.announceForAccessibility(t)}static getAccessibilityLabelForStageMode(e){switch(e){case u.StageMode.Grid:case u.StageMode.Manual:return f.getString("CallControls.StageModeGridAnnouncement");case u.StageMode.FocusedScreenShare:return f.getString("CallControls.StageModeFocusedScreenShareAnnouncement");case u.StageMode.Presentation:return f.getString("CallPanel.CallHeaderPresentationViewLabel");case u.StageMode.Speaker:return f.getString("CallControls.StageModeFocusAnnouncement");default:return}}static announceStageMode(e){if(!V.default.shouldAnnounceForAccessibility())return;let t=this.getAccessibilityLabelForStageMode(e);t&&n.Accessibility.announceForAccessibility(t)}static announceMicrophoneState(e,t=!1){if(!V.default.shouldAnnounceForAccessibility())return;let i=this.getAccessibilityLabelForMicrophoneMute(e,t);i&&n.Accessibility.announceForAccessibility(i)}static getAccessibilityLabelForMicrophoneMute(e,t=!1){let i;return t&&e?i=f.getString("CallControls.MicrophoneServerMutedAccessibilityLabel"):t||e?!t&&e&&(i=f.getString("CallControls.MicrophoneMutedAccessibilityLabel")):i=f.getString("CallControls.MicrophoneUnmutedAccessibilityLabel"),i}static announceVideoState(e){V.default.shouldAnnounceForAccessibility()&&(e?n.Accessibility.announceForAccessibility(f.getString("CallPreview.ToggleVideoOnLabel")):n.Accessibility.announceForAccessibility(f.getString("CallPreview.ToggleVideoOffLabel")))}static announceHoldState(e){V.default.shouldAnnounceForAccessibility()&&(e?n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.HoldCallAnnouncement")):n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.ResumeCallAnnouncement")))}static announceScreenShareState(e){V.default.shouldAnnounceForAccessibility()&&(e?n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.ScreenShareStartAnnouncement")):n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.ScreenShareEndAnnouncement")))}static announceSubtitleState(e,t){V.default.shouldAnnounceForAccessibility()&&(t?e?n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.SubtitleStartStateAnnouncement")):n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.SubtitleStopStateAnnouncement")):e?n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.SubtitleBeginStartAnnouncement")):n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.SubtitleBeginStopAnnouncement")))}static announceIncomingVideoAllowanceState(e){V.default.shouldAnnounceForAccessibility()&&(e?n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.AllowIncomingVideoStopStateAnnouncement")):n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.AllowIncomingVideoStartStateAnnouncement")))}static getRingingItemDisplayString(e){let t="";if(e.length&&a.intersection(S.default.getCallFullscreenBotMris(),e).length){if(a.intersection(S.default.getCallAudienceBotMriFilter(),e).length)return f.getString("ReactionsStream.CallingTogetherMode");if(a.intersection(S.default.getCallGridViewBotMriFilter(),e).length)return f.getString("ReactionsStream.CallingLargeGridMode")}e.length&&(t=C.default.getDisplayName(e[0])||f.getString("Notifications.UnknownUserShort"));let i="";e.length>1&&(i=C.default.getDisplayName(e[1])||f.getString("Notifications.UnknownUserShort"));let n="";return 1===e.length?n=f.getString("ReactionsStream.CallingParticipant",{participant:t}):2===e.length?n=f.getString("ReactionsStream.CallingTwoParticipants",{firstParticipant:t,secondParticipant:i}):e.length>2&&(n=f.getString("ReactionsStream.CallingMultipleParticipants",{participant:t,count:e.length-1})),n}static stringToScreenShareIconEnum(e){switch(e.toLowerCase()){case u.ScreenShareIcon.Icon1.toString().toLowerCase():return u.ScreenShareIcon.Icon1;case u.ScreenShareIcon.Icon2.toString().toLowerCase():return u.ScreenShareIcon.Icon2;default:return u.ScreenShareIcon.Default}}static getShareScreenIcon(e){switch(e){case u.ScreenShareIcon.Icon1:return O.SkypeIcon.Screenshare1;case u.ScreenShareIcon.Icon2:return O.SkypeIcon.Screenshare2}return O.SkypeIcon.ScreenShare}static highContrastColorConfig(e){return{iconColor:e.primaryIconColor,backgroundColor:e.primaryBackgroundColor,selectedIconColor:e.primaryBackgroundColor,selectedBackgroundColor:e.primaryTextColor,borderColor:e.primaryTextColor,captionColor:e.primaryTextColor}}static videoTypeForKey(e,t,i){if(e===u.CallStageElementKeys.localUserKey){if(this.renderVideoPreview(t,i))return i.isLandscape?u.LayoutInfoVideoType.Landscape:u.LayoutInfoVideoType.Portrait}else if(e===this.screenShareKey(t)){const i=t.renderedRemoteElementInfo[e];if(i.videoStatus===u.VideoStatus.Streaming)return i.videoDimensions&&i.videoDimensions.width>i.videoDimensions.height?u.LayoutInfoVideoType.Landscape:u.LayoutInfoVideoType.Portrait}return u.LayoutInfoVideoType.None}static videoAspectRatioForKey(e,t,i){const a=s.default.getS4LCMCFeatures();if(e===u.CallStageElementKeys.localUserKey){if(this.renderVideoPreview(t,i)){const e=t.localVideoDimension||{width:a.videoWidth,height:a.videoHeight};if(e&&e.width>0&&e.height>0)return e.width/e.height}}else if(e===this.screenShareKey(t)){const i=t.renderedRemoteElementInfo[e];if(i.videoStatus===u.VideoStatus.Streaming&&i.videoDimensions&&i.videoDimensions.width>0&&i.videoDimensions.height>0)return i.videoDimensions.width/i.videoDimensions.height}return 1}static renderVideoPreview(e,t){return e.isProvidingVideo&&!e.ribbonHidden&&t.isVideoTarget}static screenShareKey(e){return e.screenshareElementInfo?e.screenshareElementInfo.key:void 0}static shouldRenderStage(e){return e.stageMode!==u.CallStageViewMode.RibbonOnly&&e.stageMode!==u.CallStageViewMode.None}static getNextScaleFactor(e,t,i){let n=a.range(1,t,(t-1)/i);n.push(t);const o=a.find(n,t=>t>e);return a.isUndefined(o)?1:o}static adjustedStageViewRect(e){const t=this.adjustedStageViewBounds(e);return t.x=e.viewRect.x,t}static getSizesForStageElements(e,t,i,a,n,o){const s=i.width*i.height,r=a&&!o||!a&&o;let l;l=r?i.width*(i.height+t-s):i.height*(i.width+t-s);const c=t-l;let d,u;if(a?(u=1/(0===l?t/i.height:i.width),d=1/n.height):(u=1/n.width,d=1/(0===l?t/i.width:i.height)),1===t)return[{width:u,height:d},...e];if(0===l){return new Array(t).fill({width:u,height:d}).concat(e)}for(let t=0;t<l;t++)e.unshift({width:u,height:d});if(c>=1){const t=J.getNewVirtualStageSize(l,i,r);return J.getSizesForStageElements(e,c,t,o?!a:a,n,!1)}return e}static getNewVirtualStageSize(e,t,i){const a=i?t.width:t.height,n=(i?t.height:t.width)-Math.ceil(e/a);return{width:i?a:n,height:i?n:a}}static getStageVideoCount(e,t,i,a){const n=Math.ceil(Math.sqrt(e)),o=Math.min(i,t,n),s=Math.ceil(e/o),r=Math.max(o,s),l=Math.min(o,s);return{width:a?r:l,height:a?l:r}}static isTopStageElement(e,t,i,n){let o=[],s=n;if(0===a.keys(t).length)o=i;else{const r=[],l={},c=a.invert(t);for(const t of e){const e=c[t.key];if(e&&!a.isUndefined(t.stagePosition)){const o=parseInt(e,10);t.stagePosition===n&&(s=o);const c=a.clone(t);c.stagePosition=o;const d=t.stagePosition;l[e]=i[d],r.push(c)}}const d=a.sortBy(a.keys(l));for(let e of d)o.push(l[e])}if(0===o.length)return!1;const r=1/o[0].width;if(o.length>2&&o.length%2==1){const e=a.findIndex(o,{height:1}),t=1/o[0===e?1:0].height;if(e>=0){let i=[e];for(let a=0;a<e;a+=t)i.push(a);for(let a=e+1;a<o.length;a+=t)i.push(a);return a.includes(i,s)}}return s<r}static adjustedStageViewBounds(e){const t=this.getStageTopOffset(e),i=this._getStageBottomOffset(e);return{x:0,y:e.viewRect.y+t,width:e.viewRect.width,height:e.viewRect.height-t-i}}static _getStageBottomOffset(e){return e.useMobileControls?0:u.DesktopCallControlsHeight}static getStageTopOffset(e){return this.getCurrentCallPanelHeaderLayout(e)===u.CallPanelHeaderLayout.Window?u.CallPanelHeaderHeight.window:0}static isInGridStageMode(e){return e===u.StageMode.Grid||e===u.StageMode.Manual}static isInIncomingScreenshareMode(e){return e===u.StageMode.Presentation||e===u.StageMode.FocusedScreenShare}static isInPresentationMode(e){return r.default.CallingFeaturesHelper.isPresentationModeEnabled()&&e===u.StageMode.Presentation}static getScreensharingMode(){return r.default.CallingFeaturesHelper.isPresentationModeEnabled()?u.StageMode.Presentation:u.StageMode.FocusedScreenShare}static getAvailableHeaderModes(e,t){return e?[]:t?[u.CallPanelHeaderLayout.Window,u.CallPanelHeaderLayout.Float]:[]}static isTogetherMode(e){return e===u.StageMode.TogetherMode}static isLargeGrid(e){return e===u.StageMode.LargeGrid}static getRibbonItemTopMargin(e){return u.RibbonSizes.ribbonItemModernStageTopMargin}static getCurrentCallPanelHeaderLayout(e){return e.callPanelHeaderLayout}static _getDefaultFeatureUnsupportedMessage(e){let t;switch(e){case K.CallReactions:t="CallPanel.ReactionsShortMessageDefault"}return t?f.getString(t):void 0}static _getOneCountFeatureUnsupportedMessage(e,t){let i;switch(t){case K.CallReactions:i="CallPanel.ReactionsShortMessage1User"}return i?f.getString(i,{firstUser:e}):void 0}static _getTwoCountFeatureUnsupportedMessage(e,t){let i;switch(t){case K.CallReactions:i="CallPanel.ReactionsShortMessage2Users"}return i?f.getString(i,{firstUser:e.firstUser,secondUser:e.secondUser}):void 0}static _getMoreCountFeatureUnsupportedMessage(e,t){let i;switch(t){case K.CallReactions:i="CallPanel.ReactionsShortMessageMoreUsers"}return i?f.getString(i,{count:e.count-2,firstUser:e.firstUser,secondUser:e.secondUser}):void 0}static _fallbackStageParticipantKey(e,t,i){let n,o=a.keys(e);const s=a.sortBy(a.filter(a.map(o,t=>e[t]),e=>e.videoStatus!==u.VideoStatus.None)).map(e=>e.key),r=a.last(s);if(r)n=r;else if(!t||i===u.CallStageViewMode.StageAndRibbon&&l.CallingCapabilities.floatableResizableVideoPreviewSupported())if(o.length){n=a.find(o,t=>{const i=e[t];return i&&!a.isUndefined(i.participantState)&&c.default.isParticipantStateConnected(i.participantState)})||o[0]}else n=u.CallStageElementKeys.localUserKey;else n=u.CallStageElementKeys.localUserKey;return y.log(m.LogTraceArea.CallingUI,"CallStageView._fallbackStageParticipantKey: "+R.mriOrId(n)),n===u.CallStageElementKeys.localUserKey||e[n]?n:void 0}static _streamStatus(e,t,i,a,n,o,s){if(!e)return u.VideoStatus.None;const l=!(!n||!r.default.RemoteStreamHelper.validateStream(i,e,n,o))?n:r.default.RemoteStreamHelper.getAvailableStream(i,e,t,s,o);return r.default.RemoteStreamHelper.isStreamRenderingForTargetStream(l,i,e,t,a)?u.VideoStatus.Streaming:l?u.VideoStatus.Available:u.VideoStatus.None}static _streamDimensions(e,i,a,n){return e&&r.default.RemoteStreamHelper.getStreamSize(a,e,i,n)||t.DummyVideoSize}static getReactionItems(e){const t=J.getEmoticonReactionKey(e),i=g.default().getCustomReactions(),n=a.uniq([t,...i].reverse());return a.map(n,e=>({key:e,type:k.default.isAnimationReaction(e)?u.ReactionsItemType.Animation:u.ReactionsItemType.Emoticon}))}static getEmoticonReactionKey(e){const t=s.default.getS4LCMCFeatures();if(e)return t.callCelebrationConfig.callCelebrateButtonKey;const i=g.default();if(i.hasBeenCustomized()){const e=i.getCurrentReactions();return 0===e.length?i.getCustomReactions()[0]:e[0]}return t.callReactionButtonKey}static canHandBeLoweredForParticipant(e,t){const i=r.default.CallingStore.getCallConversationMri(e),a=i&&p.default().getConversation(i);return r.default.CallingStore.isHandRaisedForMri(t,e)&&(!b.isModerated(a)||b.isCurrentUserAdminInModeratedGroup(a)||v.default.isMyMri(t))}static announceLoweredHandState(e,t){if(!V.default.shouldAnnounceForAccessibility())return;let i;e?i=f.getString("CallPanel.HandLowered"):t&&(i=f.getString("CallPanel.HandLoweredOther",{displayName:t})),i&&n.Accessibility.announceForAccessibility(i)}static getReactionButtonType(e,t){let i=j.Heart;return h.default.getCelebrationData(e,t)&&(i=j.Celebration),i}static getReactionCommand(e,t,i,a){let n;switch(e){case j.Celebration:n=new I.SendReactionCommand(u.ReactionsItemType.Animation,"cake",t,i,a);break;case j.Heart:n=new I.SendReactionCommand(u.ReactionsItemType.Emoticon,"heart",t,i,a)}if(n.canExecute())return n}static getReactionButtonDescriptors(e,t){let i;switch(e){case j.Celebration:i={key:u.CallControlsOverflowItem.CelebrationAnimation,icon:O.SkypeIcon.Birthday,title:f.getString("CallControlsOverFlowMenu.CelebrateBirthday"),accessibilityLabel:f.getString("CallControlsOverFlowMenu.CelebrateBirthday"),onPress:()=>t.execute()};break;case j.Heart:i={key:u.CallControlsOverflowItem.HeartReaction,icon:O.SkypeIcon.HeartOutline,title:f.getString("CallControlsOverFlowMenu.ReactWithHeart"),accessibilityLabel:f.getString("CallControlsOverFlowMenu.ReactWithHeart"),onPress:()=>t.execute()}}return i}static getStageModeItemTitle(e,t){const i=(t?q:Q)[this.displayedStageMode(e)];return i?f.getString(i):(y.error(m.LogTraceArea.CallingUI,"No title found for stage mode: "+u.StageMode[e]),"")}static getIconForStageMode(e,t){const i=(t?$:X)[this.displayedStageMode(e)];return i||y.error(m.LogTraceArea.CallingUI,"No icon found for stage mode: "+u.StageMode[e]),i}static displayedStageMode(e){return e===u.StageMode.Manual?u.StageMode.Grid:e}static getAvailableMenuItems(e,t,i,a){const n=z.default.getAvailableStageModes(e).reduce((e,t,a)=>(i&&0!==a&&e.push({type:u.LayoutPickerMenuItemType.Divider}),e.push({type:J.stageModeToLayoutPickerMenuItemType(t)}),e),[]),o=s.default.getS4LCMCFeatures(),r=H.isOneOnOneConversation(a);o.enableAudioParticipantsOnTheStage&&!r&&(n.push({type:u.LayoutPickerMenuItemType.Divider}),n.push({type:u.LayoutPickerMenuItemType.OnlyVideoOnTheStage,isNew:this._isOnlyVideoOnTheStageNew(o),markAsSeen:this._markOnlyVideoOnTheStageAsSeen})),t&&(n.push({type:u.LayoutPickerMenuItemType.Divider}),n.push({type:u.LayoutPickerMenuItemType.Fullscreen}));const l=J.getAvailableHeaderModes(i,r);return l.length&&n.push({type:u.LayoutPickerMenuItemType.Divider}),l.forEach(e=>{n.push({type:J.headerModeToLayoutPickerMenuItemType(e)})}),o.enableNewCallScreen&&(n.push({type:u.LayoutPickerMenuItemType.Divider}),n.push({type:u.LayoutPickerMenuItemType.NewCallScreenToggle,isNew:this._isNewCallStageItemNew(o),markAsSeen:this._markNewCallStageItemAsSeen})),n}static getAvailableMenuItemsV2(e,t,i,a){const n=z.default.getAvailableStageModesV2(e).reduce((e,t,a)=>(i&&0!==a&&e.push({type:u.LayoutPickerMenuItemType.Divider}),e.push({type:J.stageModeToLayoutPickerMenuItemType(t)}),e),[]),o=s.default.getS4LCMCFeatures(),r=H.isOneOnOneConversation(a),l=z.default.getStageMode(e),c=!r&&this.isInGridStageMode(l),d=this.isInGridStageMode(l),h=o.enableTopTrayHiding;if((c||d||h)&&n.push({type:u.LayoutPickerMenuItemType.Divider}),c&&n.push({type:u.LayoutPickerMenuItemType.OnlyVideoOnTheStage,isNew:this._isOnlyVideoOnTheStageNew(o),markAsSeen:this._markOnlyVideoOnTheStageAsSeen}),d&&n.push({type:u.LayoutPickerMenuItemType.SelfInTheGridToggle}),h){const t=z.default.isTopTrayHidden(e)?u.LayoutPickerMenuItemType.ShowPeopleAtTop:u.LayoutPickerMenuItemType.HidePeopleAtTop;n.push({type:t})}return t&&(n.push({type:u.LayoutPickerMenuItemType.Divider}),n.push({type:u.LayoutPickerMenuItemType.Fullscreen})),o.enableNewCallScreen&&(n.push({type:u.LayoutPickerMenuItemType.Divider}),n.push({type:u.LayoutPickerMenuItemType.NewCallScreenToggle})),n}static _isOnlyVideoOnTheStageNew(e){return e.enableAudioParticipantsOnTheStageAsNew&&!!F.default.getUserPreferencesLocal().showOnlyVideoOnTheStageAsNew}static _isNewCallStageItemNew(e){return e.enableNewCallScreen&&!e.newCallScreenEnabledByDefault&&!!F.default.getUserPreferencesLocal().showNewStageItemAsNew}static stageModeToLayoutPickerMenuItemType(e){switch(e){case u.StageMode.Speaker:return u.LayoutPickerMenuItemType.StageModeSpeaker;case u.StageMode.FocusedScreenShare:return u.LayoutPickerMenuItemType.StageModeFocusedScreenShare;case u.StageMode.Grid:return u.LayoutPickerMenuItemType.StageModeGrid;case u.StageMode.Manual:return u.LayoutPickerMenuItemType.StageModeManual;case u.StageMode.Presentation:return u.LayoutPickerMenuItemType.StageModePresentation;case u.StageMode.TogetherMode:return u.LayoutPickerMenuItemType.StageModeTogetherMode;case u.StageMode.LargeGrid:return u.LayoutPickerMenuItemType.StageModeLargeGrid}}static layoutPickerMenuItemTypeToStageMode(e){switch(e){case u.LayoutPickerMenuItemType.StageModeSpeaker:return u.StageMode.Speaker;case u.LayoutPickerMenuItemType.StageModeFocusedScreenShare:return u.StageMode.FocusedScreenShare;case u.LayoutPickerMenuItemType.StageModeGrid:return u.StageMode.Grid;case u.LayoutPickerMenuItemType.StageModeManual:return u.StageMode.Manual;case u.LayoutPickerMenuItemType.StageModePresentation:return u.StageMode.Presentation;case u.LayoutPickerMenuItemType.StageModeTogetherMode:return u.StageMode.TogetherMode;case u.LayoutPickerMenuItemType.StageModeLargeGrid:return u.StageMode.LargeGrid;default:return}}static headerModeToLayoutPickerMenuItemType(e){switch(e){case u.CallPanelHeaderLayout.Mobile:return u.LayoutPickerMenuItemType.CallPanelHeaderLayoutMobile;case u.CallPanelHeaderLayout.Float:return u.LayoutPickerMenuItemType.CallPanelHeaderLayoutFloat;case u.CallPanelHeaderLayout.Window:return u.LayoutPickerMenuItemType.CallPanelHeaderLayoutWindow;case u.CallPanelHeaderLayout.None:return u.LayoutPickerMenuItemType.CallPanelHeaderLayoutNone}}static layoutPickerMenuItemTypeToHeaderMode(e){switch(e){case u.LayoutPickerMenuItemType.CallPanelHeaderLayoutMobile:return u.CallPanelHeaderLayout.Mobile;case u.LayoutPickerMenuItemType.CallPanelHeaderLayoutFloat:return u.CallPanelHeaderLayout.Float;case u.LayoutPickerMenuItemType.CallPanelHeaderLayoutWindow:return u.CallPanelHeaderLayout.Window;case u.LayoutPickerMenuItemType.CallPanelHeaderLayoutNone:return u.CallPanelHeaderLayout.None;default:return}}static shouldShowCallParticipantPinOption(e,t){var i;return s.default.getS4LCMCFeaturesNoSubscription().enableCallParticipantsPinning&&F.default.getNewCallScreenDesignEnabled()&&this.isInGridStageMode(z.default.getStageMode(t))&&!this.isCallParticipantPinned(e,t)&&W.default.getStageCapacity()>((null===(i=G.default.getPinnedParticipants(t))||void 0===i?void 0:i.length)||0)}static shouldShowCallParticipantUnpinOption(e,t){return s.default.getS4LCMCFeaturesNoSubscription().enableCallParticipantsPinning&&F.default.getNewCallScreenDesignEnabled()&&this.isCallParticipantPinned(e,t)}static isCallParticipantPinned(e,t){return!!e&&G.default.isParticipantPinned(e,t)}}t.CallUIUtils=J,J._ribbonAddTimeValue=1,J._markOnlyVideoOnTheStageAsSeen=()=>{F.default.setUserPreferencesLocal({showOnlyVideoOnTheStageAsNew:!1})},J._markNewCallStageItemAsSeen=()=>{F.default.setUserPreferencesLocal({showNewStageItemAsNew:!1})},t.default=J},1133:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.problemSections=t.CQFHash=t.shuffleArray=t.XorShift=t.tokensString=t.shouldTriggerForCall=t.ProblemTokens=t.ProblemSectionType=void 0;const a=i(336),n=i(74),o=i(8),s=i(17),r=i(164),l=i(3),c=i(4),d=i(21);var u,h;!function(e){e[e.Audio=0]="Audio",e[e.Video=1]="Video"}(u=t.ProblemSectionType||(t.ProblemSectionType={})),function(e){e[e.AudioTokenNoSoundLocal=101]="AudioTokenNoSoundLocal",e[e.AudioTokenNoSoundRemote=102]="AudioTokenNoSoundRemote",e[e.AudioTokenEcho=103]="AudioTokenEcho",e[e.AudioTokenNoise=104]="AudioTokenNoise",e[e.AudioTokenLowSound=105]="AudioTokenLowSound",e[e.AudioTokenDropped=106]="AudioTokenDropped",e[e.AudioTokenDistorted=107]="AudioTokenDistorted",e[e.AudioTokenInterrupted=108]="AudioTokenInterrupted",e[e.AudioTokenOther=109]="AudioTokenOther",e[e.AudioTokenPSTNDialpad=301]="AudioTokenPSTNDialpad",e[e.VideoTokenNoVideoLocal=201]="VideoTokenNoVideoLocal",e[e.VideoTokenNoVideoRemote=202]="VideoTokenNoVideoRemote",e[e.VideoTokenLowQuality=203]="VideoTokenLowQuality",e[e.VideoTokenFreezing=204]="VideoTokenFreezing",e[e.VideoTokenStoppedUnexpectedly=205]="VideoTokenStoppedUnexpectedly",e[e.VideoTokenOtherSideTooDark=206]="VideoTokenOtherSideTooDark",e[e.VideoTokenNoAudioSync=207]="VideoTokenNoAudioSync",e[e.VideoTokenOther=208]="VideoTokenOther"}(h=t.ProblemTokens||(t.ProblemTokens={})),t.shouldTriggerForCall=function(e,t,i){if(e.durationSeconds<t.MinCallDurationSecs)return c.log(l.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackUtils.shouldTriggerForCall: "+e.callId+" duration too short ("+e.durationSeconds+" < "+t.MinCallDurationSecs+"). Returning false."),o.Resolved(!1);if(e.forwardingDestinationType&&"voicemail"===e.forwardingDestinationType)return c.log(l.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackUtils.shouldTriggerForCall: "+e.callId+" went to voicemail. Returning false."),o.Resolved(!1);let r;if(i){const t=s.isGroupConversation(e.conversationMri)?n.EcsCallType.CallTypeGroup:s.isPhoneMri(e.conversationMri)?n.EcsCallType.CallTypePstn:n.EcsCallType.CallTypeS2s;r=a.default.shouldTriggerCQF(d.default.getSkypeId(),e.callId,t).catch(()=>(c.log(l.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackUtils.shouldTriggerForCall: "+e.callId+" calling stack didn't provide a value. Assuming false."),!1))}else r=o.Resolved(!1);return r.then(i=>{if(i)return!0;const a=s.isGroupConversation(e.conversationMri)?t.GroupCall_Percent:s.isPhoneMri(e.conversationMri)?t.PSTN_Percent:t.S2S_Percent;return C(e.callId)%100>=a?(c.log(l.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackUtils.shouldTriggerForCall: hash for "+e.callId+" not within "+a+"%. Returning false."),!1):(c.log(l.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackUtils.shouldTriggerForCall: hash for "+e.callId+" within "+a+"%. Returning true."),!0)})},t.tokensString=function(e){if(0!==e.length)return"checks="+e.join("%20")};class p{constructor(e){const t=C(e);this._w=t,this._x=t/2>>>0,this._y=t/3>>>0,this._z=t/4>>>0}getNext(){const e=(this._x^this._x<<11>>>0)>>>0;return this._x=this._y,this._y=this._z,this._z=this._w,this._w=(this._w^this._w>>>19^e^e>>>8)>>>0,this._w}}function g(e,t){const i=new p(t);for(let t=e.length-1;t>=1;t--){const a=i.getNext()%(t+1),n=e[t];e[t]=e[a],e[a]=n}}function C(e){const t=r.computeSHA256(e);return(t[0]<<24|t[1]<<16|t[2]<<8|t[3]<<0)>>>0}t.XorShift=p,t.shuffleArray=g,t.CQFHash=C;const m=[h.AudioTokenNoSoundLocal,h.AudioTokenNoSoundRemote,h.AudioTokenEcho,h.AudioTokenNoise,h.AudioTokenLowSound,h.AudioTokenDropped,h.AudioTokenDistorted,h.AudioTokenInterrupted],S=[h.VideoTokenNoVideoLocal,h.VideoTokenNoVideoRemote,h.VideoTokenLowQuality,h.VideoTokenFreezing,h.VideoTokenStoppedUnexpectedly,h.VideoTokenOtherSideTooDark,h.VideoTokenNoAudioSync];function y(e,t,i){const a=t.slice(0);return g(a,e),a}t.problemSections=function(e,t){const i=[{type:u.Audio,title:"AudioProblems",problems:y(e,m,h.AudioTokenOther)}];return t&&(i.push({type:u.Video,title:"VideoProblems",problems:y(e,S,h.VideoTokenOther)}),g(i,e)),i}},1224:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.maybePresentCallPreviewPanel=t.HandOffCommand=void 0;const a=i(1),n=i(0),o=i(35),s=i(73),r=i(74),l=i(8),c=i(29),d=i(261),u=i(126),h=i(50),p=i(3497),g=i(97),C=i(41),m=i(66),S=i(42),y=i(16),f=i(738),_=i(174),b=i(14),v=i(739),w=i(54),T=i(125),I=i(21),P=i(88),M=i(445),k=i(179),A=i(59),R=i(24),V=i(77),E=i(7),L=i(107),B=i(344),O=i(32),D=i(30),x=i(23),N=i(82),U=i(27),F=i(36),H=i(4),z=i(5),G=i(13),W=i(3),K=i(201),j=i(9),Q=i(11),q=i(28),X=i(101),$=i(65),J=i(79),Y=i(6),Z=(i(31),i(10)),ee=i(87),te=i(110),ie=i(413),ae=i(60),ne=i(384),oe=i(1693);!function(e){e.addDevice="addDevice",e.transferCall="transferCall"}(t.HandOffCommand||(t.HandOffCommand={}));const se=Y.lazyProperties({dialog:()=>n.Styles.createViewStyle({flex:1,overflow:"visible"}),videoShadow:()=>n.Styles.createViewStyle({backgroundColor:j.Color.blackOverlay20}),dialogHeaderContainer:()=>n.Styles.createViewStyle({flexDirection:"row",justifyContent:"space-between"}),controlsWrapper:()=>n.Styles.createViewStyle({flexDirection:"column",overflow:"visible",flex:1,justifyContent:"flex-end"}),previewControl:()=>n.Styles.createViewStyle({alignItems:"center",alignSelf:"center",paddingVertical:20}),previewControlOnMobile:()=>n.Styles.createViewStyle({maxWidth:300,marginBottom:10}),previewControlLandscape:()=>n.Styles.createViewStyle({paddingVertical:10}),iconTogglesContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"space-between"}),iconStyle:()=>n.Styles.createViewStyle({marginRight:20}),accessibleToggleSwitchStyle:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",minHeight:40}),convIcon:()=>n.Styles.createTextStyle({alignItems:"center",justifyContent:"center",backgroundColor:j.Color.black}),cameraControlContainer:()=>n.Styles.createViewStyle({paddingRight:10}),previewCameraControlSmallScreen:()=>n.Styles.createViewStyle({bottom:100}),newCameraControlContainer:()=>n.Styles.createViewStyle({position:"absolute",bottom:0,left:0,paddingLeft:15,paddingBottom:10}),cameraPickerTopRightCornerNonModal:()=>n.Styles.createViewStyle({minHeight:void 0,marginTop:8}),closeButton:()=>n.Styles.createViewStyle({justifyContent:"center",height:50,paddingLeft:15,paddingRight:15}),conversationHeader:()=>n.Styles.createViewStyle({flex:1,backgroundColor:"transparent"}),conversationTitle:()=>n.Styles.createTextStyle({color:j.Color.white,font:R.default.font.uiDisplayBold,fontSize:R.default.controlFontSize.messagingHeaderSmall,flexShrink:1}),conversationTitleMargin:()=>n.Styles.createTextStyle({marginRight:15}),conversationSubtitle:()=>n.Styles.createTextStyle({color:j.Color.white,flexShrink:1,lineHeight:25,height:25}),cameraToggleButton:()=>n.Styles.createViewStyle({paddingHorizontal:15}),footer:()=>n.Styles.createViewStyle({height:60,alignSelf:"stretch"}),footerLandscape:()=>n.Styles.createViewStyle({height:50,alignSelf:"stretch"}),wideFooter:()=>n.Styles.createViewStyle({height:120,alignSelf:"stretch"}),footerWideLandscape:()=>n.Styles.createViewStyle({height:50,alignSelf:"stretch",flexDirection:"row",justifyContent:"space-between"}),wideButtonStyle:()=>n.Styles.createViewStyle({margin:10}),toggleText:()=>n.Styles.createTextStyle({color:j.Color.white,paddingRight:10,backgroundColor:"transparent"}),blurToggleStyleOnDesktop:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",position:"absolute",bottom:0,right:0,paddingRight:15,paddingBottom:10}),blurToggleStyleOnSmallWindow:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",paddingBottom:10}),settingsButtonStyleOnDesktop:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",position:"absolute",top:0,right:0,paddingRight:15}),videoCanvasWrapper:()=>n.Styles.createViewStyle({backgroundColor:j.Color.black}),videoBorderRadius:()=>n.Styles.createViewStyle({borderRadius:10}),pickersUnderVideoCanvas:()=>n.Styles.createViewStyle({bottom:-60}),videoBoxShadow:()=>n.Styles.createViewStyle({shadowColor:j.Color.blackOverlay40,shadowOffset:{width:0,height:2},shadowOpacity:.8,shadowRadius:10}),cameraAndMicrophoneDetails:()=>n.Styles.createTextStyle({color:j.Color.white,fontSize:12,backgroundColor:"transparent",marginBottom:12}),backgroundReplacementButtonStyles:()=>n.Styles.createViewStyle({marginVertical:8}),backgroundReplacementButtonLabelStyles:()=>n.Styles.createTextStyle({color:j.Color.white,paddingLeft:5}),iconTogglesModernContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"space-between",marginBottom:32})});t.maybePresentCallPreviewPanel=function(e,t){Z.default.newCauseId();const i=E.default.getS4LCMCFeatures().enableCallPreviewPermissionOnLoad,a=n.createElement(re,{dialogId:"CallPreview",conversationMri:e.conversationMri,activeCallId:e.activeCallId,callOrigin:e.callOrigin,isGoLive:e.isGoLive,isModal:!0,permissionAlreadyAsked:i,skipPermissionPanel:e.skipPermissionPanel,isNewCallPreviewStyle:!1}),o=()=>w.default.showModal(a,"CallPreview",t);i?c.default.CallPermissionsUtils.checkPermissionBrowserAndContinue(o,o,e.conversationMri):o()};class re extends h.default{constructor(){super(...arguments),this._isCameraChanged=!1,this._isStartOrJoinCallBtnPressed=!1,this._wasToggleBackgroundBlurChanged=!1,this._wasToggleCameraChanged=!1,this._wasToggleMicrophoneChanged=!1,this._unregisterAndCloseModal=()=>{this.props.isModal&&(M.unregisterModalDialogDismissalException(this.props.dialogId),w.default.dismissModal(this.props.dialogId,this._getRootViewId()))},this._onLocalVideoPreviewRef=e=>{this._localVideoRef=e||void 0,this.props.onVideoRenderingChange&&this.props.onVideoRenderingChange(!!e)},this._isLightAccessibleThemeUnderCamera=()=>this.props.displayControlsUnderVideoCanvas&&this._useAccessibleTheme()&&!this._useDarkTheme(),this._renderIconButtonWithSubtitle=(e,t,i,a,o)=>{let s=se.backgroundReplacementButtonLabelStyles,r=j.Color.white,l=j.Color.whiteOverlay70;this._isLightAccessibleThemeUnderCamera()&&(r=u.MeetNowColors.getButtonColors(!0).backgroundColor,l=j.Color.blackOverlay70,s=u.MeetNowStyle.getStyle(!0).background);const c=n.createElement(y.Subtitle,{numberOfLines:1,style:s},t);return n.createElement(C.default,{icon:a,size:Q.IconSize.size24,title:i,color:r,hoverColor:l,onPress:o,style:[...e,se.backgroundReplacementButtonStyles],accessoryView:c})},this._renderBackgroundReplacementButton=e=>this._renderIconButtonWithSubtitle(e,z.getString("AudioVideoSettings.CameraBackgroundReplacementLabel"),z.getString("AudioVideoSettings.CameraBackgroundReplacementLabel"),Q.SkypeIcon.BackgroundReplacement,this._showAVSettings),this._renderAvSettingsButton=e=>this._renderIconButtonWithSubtitle(e,z.getString("AudioVideoSettings.Title"),z.getString("AudioVideoSettings.Title"),Q.SkypeIcon.Settings,this._showAVSettings),this._switchCameraButtonPressed=()=>{this.isComponentMounted()&&this._updateVideoSource()},this._updateVideoSource=()=>{const e=Z.default.newCauseId(),t=this.state.selectedCamera,i=a.find(this.state.cameras,e=>e.id!==(null==t?void 0:t.id)&&e.position!==(null==t?void 0:t.position));i?(c.default.DeviceStore.choosePreferredDevices({camera:i.id},e),H.log(W.LogTraceArea.CallingUI,"CallPreview _updateVideoSource "+t+" -> "+i+" causeId: "+e),this._isCameraChanged=!0):H.error(W.LogTraceArea.CallingUI,"CallPreview _updateVideoSource new camera not found causeId: "+e)},this._closeButtonPressed=()=>{H.log(W.LogTraceArea.CallingUI,"CallPreview closeButtonPressed"),w.default.dismissModal(this.props.dialogId,this._getRootViewId())},this._onCameraSelected=e=>{var t,i;const a=Z.default.newCauseId();H.log(W.LogTraceArea.CallingUI,"CallPreview _onCameraSelected "+e+"current deviceId"+(null===(t=this.state.selectedCamera)||void 0===t?void 0:t.id)+" causeId: "+a),e!==(null===(i=this.state.selectedCamera)||void 0===i?void 0:i.id)&&(c.default.DeviceStore.choosePreferredDevices({camera:e},a),this._isCameraChanged=!0)},this.onStartOrJoinCall=e=>{var t;const i=Z.default.newCauseId();if(H.log(W.LogTraceArea.CallingUI,"CallPreview.onStartOrJoinCall activeCallId: "+this.props.activeCallId+" conversationMri: "+this.props.conversationMri+" isMicrophoneOn: "+this.state.isMicrophoneOn+" isCameraOn: "+this.state.isCameraOn+" transferCall: "+e+" activeEndpoints: "+this.state.activeUserEndpoints+" causeId: "+i),D.default.setCallPreviewSettings(this.state.isMicrophoneOn,this.state.isCameraOn,this.state.isBackgroundBlurred),this.props.conversationMri){this.props.hideActionButton||d.default.trackStartOrJoinMeetNowButtonClicked(this.props.conversationMri);const a=this.state.isMicrophoneOn?void 0:r.MuteFlags.MuteMicrophone,n={conversationMri:this.props.conversationMri,withVideo:this.state.isCameraOn,origin:this.props.callOrigin,callId:this._getCallId(),muteFlag:a,isCameraSelected:this.state.isCameraOn&&!!(null===(t=this.state.selectedCamera)||void 0===t?void 0:t.id),permissionsAlreadyChecked:this.state.shouldAskPermissionOnLoad||this.props.permissionAlreadyAsked};if(!this.state.isProtocolLaunchCallPreview&&this.props.isGoLive||this.props.activeCallId)if(this.props.activeCallId){const t={conversationMri:this.props.conversationMri,callId:this.props.activeCallId,withVideo:this.state.isCameraOn,origin:this.props.callOrigin,isGoLive:this.props.isGoLive,muteFlag:this.state.twinCamEnabled?r.MuteFlags.MuteAll:a,isCameraSelected:!0,transferCall:e,skipNavigation:this.state.twinCamEnabled,isTwinCam:!e&&this.state.twinCamEnabled,permissionsAlreadyChecked:this.state.shouldAskPermissionOnLoad||this.props.permissionAlreadyAsked};let n;if(c.default.ActiveCallUIHelper.getActiveCallId(this.props.conversationMri)===this.props.activeCallId){n=c.default.CallNavigationHelper.answerOrJoinCall(t,i);const e=this.state.isCameraOn?P.CallPreviewActions.JoinWithVideo:P.CallPreviewActions.JoinWithoutVideo;ee.default.trackCallPreview(e,this._isCameraChanged,!this.state.isMicrophoneOn,this.state.isBackgroundBlurred,this._getCallId())}else H.log(W.LogTraceArea.CallingUI,"CallPreview answerOrJoinCall call is already ended causeId: "+i),n=l.Rejected();n.catch(()=>{t.isTwinCam||this._unregisterAndCloseModal()}),t.isTwinCam||this._unregisterAndCloseModal()}else c.default.CallNavigationHelper.startGoLiveCall(n,i),this.props.callOrigin===W.NavigationCallOrigin.MeetNow&&this._unregisterAndCloseModal();else c.default.CallNavigationHelper.startCall(n,i),this.props.callOrigin!==W.NavigationCallOrigin.MeetNow&&this.props.callOrigin!==W.NavigationCallOrigin.DeepLink||this._unregisterAndCloseModal()}else H.log(W.LogTraceArea.CallingUI,"CallPreview.onStartOrJoinCall stopped, conversationMri is undefined causeId: "+i);this._isStartOrJoinCallBtnPressed=!0},this.onEndCall=()=>{const e=Z.default.newCauseId(),t=this.props.activeCallId,i=this.props.conversationMri;t&&i&&c.default.CallingStore.endCall(t,e).then(()=>{var a;H.log(W.LogTraceArea.CallingUI,"CallPreview onEndCall call is ended causeId: "+e),null===(a=this._localVideoRef)||void 0===a||a.recreatePreview(e),c.default.CallingStore.subscribeToCall(i,t,this.props.callOrigin,e).then(()=>{this.isComponentMounted()||this.state.callState!==r.CallState.Observing||c.default.CallingStore.disposeObservingCalls(e)})})},this._focusOn=e=>{0},this._onToggleMic=(e,t)=>{const i=Z.default.newCauseId();if(H.log(W.LogTraceArea.CallingUI,"CallPreview._onToggleMic causeId: "+i),t)c.default.CallPermissionsUtils.requestPermissionStatus(q.PermissionType.Microphone,i).then(e=>{if(e){const e=!0;this.setState({isMicrophoneOn:e},()=>this._focusOn(this._microphoneToggleRef)),this._wasToggleMicrophoneChanged=!0,this.props.activeCallId&&this.state.callState===r.CallState.Connected?c.default.CallingStore.unmute(this.props.activeCallId,i):D.default.setCallPreviewMicSettings(e)}else H.log(W.LogTraceArea.CallingUI,"CallPreview._onToggleMic cannot obtain microphone permission current state: "+N.default.permissionStatus(q.PermissionType.Microphone)+" causeId: "+i),k.default.showDeniedPromptWithSettingsOption(q.PermissionType.Microphone,G.MainRootViewId)});else{const e=!1;this.setState({isMicrophoneOn:e},()=>this._focusOn(this._microphoneToggleRef)),this._wasToggleMicrophoneChanged=!0,this.props.activeCallId&&this.state.callState===r.CallState.Connected?c.default.CallingStore.mute(this.props.activeCallId,i):D.default.setCallPreviewMicSettings(e)}},this._onToggleVideo=(e,t)=>{const i=Z.default.newCauseId();if(H.log(W.LogTraceArea.CallingUI,"CallPreview._onToggleVideo causeId: "+i),t)c.default.CallPermissionsUtils.requestPermissionStatus(q.PermissionType.Camera,i).then(e=>{if(e){const e=!0;this.setState({isCameraOn:e},()=>this._focusOn(this._cameraToggleRef)),this._wasToggleCameraChanged=!0,this.props.activeCallId&&this.state.callState===r.CallState.Connected?c.default.CallingStore.startVideo(this.props.activeCallId,i):D.default.setCallPreviewCameraSettings(e)}else H.log(W.LogTraceArea.CallingUI,"CallPreview._onToggleVideo cannot obtain camera permission current state: "+N.default.permissionStatus(q.PermissionType.Camera)+" causeId: "+i),k.default.showDeniedPromptWithSettingsOption(q.PermissionType.Camera,G.MainRootViewId)});else if(this.isComponentMounted()){const e=!1;this.setState({isCameraOn:e},()=>this._focusOn(this._cameraToggleRef)),this._wasToggleCameraChanged=!0,this.props.activeCallId&&this.state.callState===r.CallState.Connected?c.default.CallingStore.stopVideo(this.props.activeCallId,i):D.default.setCallPreviewCameraSettings(e)}},this._onToggleBlur=(e,t)=>{const i=Z.default.newCauseId();this._wasToggleBackgroundBlurChanged=!0,H.log(W.LogTraceArea.CallingUI,"CallPreview blur toggle isBackgroundBlurred"+t+" activeCallId: "+this._getCallId()+" causeId: "+i),c.default.DeviceStore.setBackgroundBlurred(t),this.state.isCameraOn||this.state.isBackgroundBlurred?this.setState({isBackgroundBlurred:t},()=>this._focusOn(this._backgroundBlurToggleRef)):this.setState({isBackgroundBlurred:t,isCameraOn:!0},()=>this._focusOn(this._backgroundBlurToggleRef))},this._showAVSettings=()=>{const e=Z.default.newCauseId();H.log(W.LogTraceArea.CallingUI,"CallPreviewView._showAVSettings causeId: "+e),c.default.CallNavigationHelper.navigateToAVRootDesktopSettings(this._getRootViewId(),e)},this._canPreheatActiveCall=()=>this.state.enablePreHeatCall&&this.props.conversationMri&&this.props.activeCallId,this._canDisposePreheatedCall=e=>!this._isStartOrJoinCallBtnPressed&&c.default.CallingStore.isPreheated(e),this._onMicrophoneToggleRef=e=>{this._microphoneToggleRef=e||void 0},this._onCameraToggleRef=e=>{this._cameraToggleRef=e||void 0},this._onBackgroundBlurToggleRef=e=>{this._backgroundBlurToggleRef=e||void 0},this._onSwitchCameraRef=e=>{this._switchCameraToggleRef=e||void 0}}_buildState(e,t){const i=this._getRootViewId(),r=e.conversationMri?O.default.getDisplayName(e.conversationMri):void 0,l=E.default.getS4LCMCFeatures(),d=D.default.getUserPreferencesLocal(),u={isLandscape:!this._getContext().isPresentedInDesktopSubview&&U.default.getDeviceOrientation(i)===o.DeviceOrientation.Landscape,isMobileScreenSize:U.default.isMobileScreenSize(i)||x.default.isUsingStackNavigationContext(),isCameraDisabled:!c.default.DeviceStore.hasCameras()&&!c.default.CallingFeaturesHelper.isOutgoingVideoDisabled(),isMicrophoneDisabled:!c.default.DeviceStore.hasMicrophones(),selectedCamera:c.default.DeviceStore.getSelectedCamera(),cameras:c.default.DeviceStore.getCameras(),statusBarHeight:F.default.leavePaddingForStatusBar()?F.default.statusBarHeight():0,userMri:I.default.getSkypeMri(),localPreviewAndroidV2:c.default.CallingStore.isLocalPreviewAndroidV2Enabled(),conversationName:r,isProtocolLaunchCallPreview:e.callOrigin===W.NavigationCallOrigin.DeepLink,enableBlurBackgroundCallPreview:c.default.DeviceStore.isBackgroundBlurEnabled(),isSmallDesktopWindow:U.default.getWidth(i)<640,enableBackgroundReplacement:c.default.DeviceStore.isBackgroundReplacementEnabled(),enablePreHeatCall:l.enablePreHeatCall,enableObservingCall:l.enableObservingCall,enableCallHandoff:l.enableCallHandoff,activeUserEndpoints:!!e.activeCallId&&c.default.CallingStore.getConnectedEndpoints(e.activeCallId).length>0,callState:e.activeCallId?c.default.CallingStore.getCallState(e.activeCallId):void 0,isOutgoingVideoDisabled:c.default.CallingFeaturesHelper.isOutgoingVideoDisabled(),shouldAskPermissionOnLoad:!e.permissionAlreadyAsked&&l.enableCallPreviewPermissionOnLoad,isAwaitingCameraConfirmation:c.default.CallControlsStore.isAwaitingCameraConfirmation(),useHighContrastTheme:te.default.useHighContrastThemeAndChanges(),noPreview:B.default.getAppState()===n.Types.AppActivationState.Background};return u.twinCamEnabled=l.twinCamEnabled&&u.activeUserEndpoints,this._wasToggleCameraChanged||(u.isCameraOn=!u.isOutgoingVideoDisabled&&!u.isCameraDisabled&&N.default.permissionStatus(q.PermissionType.Camera)===s.PermissionStatus.Granted&&(a.isUndefined(d.callPreviewCameraSetting)||!!d.callPreviewCameraSetting)),this._wasToggleMicrophoneChanged||(u.isMicrophoneOn=!u.isMicrophoneDisabled&&N.default.permissionStatus(q.PermissionType.Microphone)===s.PermissionStatus.Granted&&(a.isUndefined(d.callPreviewMicSetting)||!!d.callPreviewMicSetting)),this._wasToggleBackgroundBlurChanged||(u.isBackgroundBlurred=a.isUndefined(d.callPreviewBlurSetting)||!!d.callPreviewBlurSetting),u}componentDidMount(){super.componentDidMount();const e=Z.default.newCauseId();H.log(W.LogTraceArea.CallingUI,"CallPreview componentDidMount causeId: "+e),J.dismissAll(),ie.default.setCallPreviewViewSeen(this._getCallId()),M.registerModalDialogDismissalException(this.props.dialogId);const t=L.default.mergeStyles([L.default.createBackgroundColorStyle(j.Color.black),L.default.createBarStyle(K.BarStyleTheme.Light),L.default.createHiddenStyle(!1)]);if(this._updateStatusBarStyle(t),this.state.enableBackgroundReplacement||this._setBlurBackground(e),this._canPreheatActiveCall()&&this._startPreheatingActiveCall(),this.state.enableObservingCall&&this.props.activeCallId&&this.props.conversationMri){const t=this.props.activeCallId;c.default.CallingStore.subscribeToCall(this.props.conversationMri,t,this.props.callOrigin,e).then(()=>{this.isComponentMounted()||this.state.callState!==r.CallState.Observing||c.default.CallingStore.disposeObservingCalls(e)})}this.state.shouldAskPermissionOnLoad&&c.default.CallPermissionsUtils.checkPermissionBrowserAndContinue(a.noop,a.noop,this.props.conversationMri,this.props.skipPermissionPanel),this.props.conversationMri&&this.state.callState!==r.CallState.Connected&&d.default.trackLobbyOpen(this.props.conversationMri)}componentDidUpdate(e,t,i){var a;if(super.componentDidUpdate(e,t,i),t.enableBlurBackgroundCallPreview!==this.state.enableBlurBackgroundCallPreview||e.activeCallId!==this.props.activeCallId||t.enableBackgroundReplacement!==this.state.enableBackgroundReplacement){const e=Z.default.newCauseId();H.log(W.LogTraceArea.CallingUI,"CallPreview componentDidUpdate causeId: "+e),this.state.enableBackgroundReplacement||this._setBlurBackground(e)}e.activeCallId!==this.props.activeCallId&&(e.activeCallId&&this._canDisposePreheatedCall(e.activeCallId)&&this._disposePreheatedCall(e.activeCallId),this._canPreheatActiveCall()&&this._startPreheatingActiveCall()),this._isCameraChanged&&(null===(a=this._switchCameraToggleRef)||void 0===a||a.requestFocus())}componentWillUnmount(){super.componentWillUnmount();const e=Z.default.newCauseId();H.log(W.LogTraceArea.CallingUI,"CallPreview componentWillUnmount causeId: "+e),this.props.activeCallId&&this._canDisposePreheatedCall(this.props.activeCallId)&&this._disposePreheatedCall(this.props.activeCallId),this.state.enableObservingCall&&this.props.activeCallId&&c.default.CallingStore.disposeObservingCalls(e),this._isStartOrJoinCallBtnPressed||this.state.isProtocolLaunchCallPreview||!this.props.activeCallId||c.default.DeviceStore.setBackgroundEffectType(W.BackgroundEffect.Off),this._isStartOrJoinCallBtnPressed||ee.default.trackCallPreview(P.CallPreviewActions.Cancel,this._isCameraChanged,!this.state.isMicrophoneOn,this.state.isBackgroundBlurred,this._getCallId()),this._isStartOrJoinCallBtnPressed||d.default.finishScenario(),D.default.setCallPreviewSettings(this.state.isMicrophoneOn,this.state.isCameraOn,this.state.isBackgroundBlurred),this._unregisterAndCloseModal()}render(){var e,t;const i=this.props.isModal?n.createElement(C.default,{style:se.closeButton,icon:V.closeIcon(),size:Q.IconSize.size24,title:z.getString("Global.CloseButtonTitle"),onPress:this._closeButtonPressed,color:j.Color.white,hoverColor:j.Color.whiteOverlay70}):this._renderEmptyForFlexboxView();let a,o,s,r,l;const c=v.formatDevicesForPicker(this.state.cameras),d=this._renderConversationTitle(),{isSmallDesktopWindow:u}=this.state;if(this.props.isNewCallPreviewStyle){const e=[se.settingsButtonStyleOnDesktop];s=this._renderAvSettingsButton(e)}if(this.state.isCameraOn&&!this.state.isCameraDisabled){this.state.noPreview||(a=n.createElement(oe.default,{ref:this._onLocalVideoPreviewRef,nametag:"video_local_preview",localPreviewAndroidV2:this.state.localPreviewAndroidV2}));{let i=[se.cameraControlContainer];if(this.props.isNewCallPreviewStyle)o=void 0;else if(this.state.isProtocolLaunchCallPreview||!this.state.enableBlurBackgroundCallPreview||u){const e=this.props.displayControlsUnderVideoCanvas&&this.state.enableBlurBackgroundCallPreview,a=this.props.fullScreenMode&&(u?2:3);o=n.createElement(n.View,{style:i},n.createElement(f.default,{tabIndex:a||void 0,items:c,onValueChange:this._onCameraSelected,selectedValue:(null===(t=this.state.selectedCamera)||void 0===t?void 0:t.id)||"",labelColor:e?void 0:j.Color.white,style:this.props.isModal?void 0:se.cameraPickerTopRightCornerNonModal}))}else i.push(se.newCameraControlContainer),this.props.displayControlsUnderVideoCanvas&&i.push(se.pickersUnderVideoCanvas),this.props.fullScreenMode&&i.push(se.previewCameraControlSmallScreen),s=n.createElement(n.View,{style:i},n.createElement(f.default,{items:c,onValueChange:this._onCameraSelected,selectedValue:(null===(e=this.state.selectedCamera)||void 0===e?void 0:e.id)||"",labelColor:this.props.displayControlsUnderVideoCanvas?void 0:j.Color.white}))}}else this.props.fullScreenMode||(r=n.createElement(n.View,{style:[se.convIcon,b.default.absoluteFill]},n.createElement(X.UserIcon,{userMri:this.state.userMri,placeholderIcon:this.props.useAvatarPlaceholderIcon?Q.SkypeIcon.Contact:void 0,size:this.props.avatarSize?this.props.avatarSize:this.state.isLandscape?$.UserIconSize.Size100:$.UserIconSize.Size160})));const h=!this.state.isCameraDisabled&&!this.state.isProtocolLaunchCallPreview&&!u&&this.state.enableBackgroundReplacement&&!this.props.isNewCallPreviewStyle&&!0;if(h){const e=[se.blurToggleStyleOnDesktop];this.props.displayControlsUnderVideoCanvas&&e.push(se.pickersUnderVideoCanvas),this.props.fullScreenMode&&e.push(se.previewCameraControlSmallScreen),l=this.state.enableBackgroundReplacement?this._renderBackgroundReplacementButton(e):this._renderToggleWithText({styles:e,text:z.getString("CallPreview.CallPreviewBlurToggleLabel"),key:"blur",accessibilityLabel:z.getString("CallPreview.CallPreviewBlurToggleLabel"),value:this.state.isBackgroundBlurred,onToggle:this._onToggleBlur})}const p=this._getCallPreviewControl(h),g=this.state.isMobileScreenSize?{maxWidth:void 0,maxHeight:void 0}:{maxWidth:800,maxHeight:514},m=[se.dialogHeaderContainer],S=this._getHeaderTopMargin(!!d);S&&m.push(A.default.marginTopStyle(S));const y=[b.default.absoluteFill,se.videoCanvasWrapper];this.props.fullScreenMode||this.state.isMobileScreenSize||(y.push(se.videoBorderRadius),y.push(se.videoBoxShadow));const w=n.createElement(n.View,{style:se.dialog},n.createElement(n.View,{style:y},a,n.createElement(n.View,{style:[se.videoShadow,b.default.absoluteFill]}),r),n.createElement(n.View,{style:m},i,d,o),this.props.displayControlsUnderVideoCanvas?n.createElement(n.View,{style:se.controlsWrapper},p,s):n.createElement(n.View,{style:se.controlsWrapper},s,p),l);return this.props.isModal?n.createElement(_.default,{dialogId:this.props.dialogId,maxWidth:g.maxWidth,maxHeight:g.maxHeight,fullScreen:this.state.isMobileScreenSize,accessibilityLabel:z.getString("CallPreview.CallPreviewViewLabel"),backgroundColor:j.Color.transparent,closeOnClickOutside:!0,useFullSizeContainer:!0,isThemeAware:!0,showOverflow:!0},w):w}_renderEmptyForFlexboxView(){const e=[se.closeButton];return this.props.isNewCallPreviewStyle&&e.push(n.Styles.createViewStyle({height:0})),n.createElement(n.View,{key:"emptyForFlexbox",style:e})}_getHeaderTopMargin(e){return this.state.isMobileScreenSize&&!this.state.isLandscape&&!this._getContext().isPresentedInDesktopSubview&&this.state.statusBarHeight>0?this.state.statusBarHeight:e&&!this.state.isMobileScreenSize&&this.state.isLandscape?15:5}_renderOptionalCameraAndMicrophoneDetails(){if(!this.props.showCameraAndMicrophoneDetails||this.state.isMicrophoneOn&&this.state.isCameraOn)return;let e;return e=!this.state.isMicrophoneOn&&this.state.isCameraOn?z.getString("CallPreview.MicrophoneOff"):this.state.isMicrophoneOn&&!this.state.isCameraOn?z.getString("CallPreview.CameraOff"):z.getString("CallPreview.CameraAndMicrophoneOff"),n.createElement(n.Text,{style:se.cameraAndMicrophoneDetails},e)}_renderConversationTitle(){if(this.props.callOrigin&&W.NavigationCallOrigin[this.props.callOrigin]===W.NavigationCallOrigin[W.NavigationCallOrigin.InviteLink]){let e=[se.conversationTitle];return this.state.isCameraOn,n.createElement(n.View,{style:se.conversationHeader},n.createElement(n.Text,{style:e,ellipsizeMode:"tail",numberOfLines:1},this.state.conversationName),n.createElement(y.Caption,{style:se.conversationSubtitle},z.getString("CallPreview.CallPreviewCallInProgressSubtitle")))}}_renderOptionalActionButton(){if(this.props.hideActionButton)return;const e=this.props.callOrigin===W.NavigationCallOrigin.MeetNow&&!this.props.activeCallId||this.state.isProtocolLaunchCallPreview,t={backgroundColor:e?j.Color.blue:j.Color.green,textColor:j.Color.white},i=this.state.twinCamEnabled?{paddingTop:15,paddingBottom:15}:void 0;if(this.state.twinCamEnabled&&this.state.callState===r.CallState.Connected){const e={backgroundColor:j.Color.red,textColor:j.Color.white};return n.createElement(n.View,{style:this.state.isLandscape?se.footerLandscape:se.footer},n.createElement(S.default,{buttonSize:G.SXButtonSize.Medium,buttonStyle:G.SXButtonStyle.Custom,title:z.getString("CallPreview.StopTwinCam"),onPress:()=>this.onEndCall(),buttonConfig:e,backgroundStyle:i,autoFocus:!1,disabled:!this.props.conversationMri}))}return!this.state.enableObservingCall||this.state.enableObservingCall&&!a.includes([r.CallState.None,r.CallState.Disconnected],this.state.callState)?n.createElement(n.View,{style:this.state.isLandscape?se.footerLandscape:se.footer},n.createElement(S.default,{buttonSize:G.SXButtonSize.Medium,buttonStyle:G.SXButtonStyle.Custom,title:e?z.getString("CallPreview.StartCallButtonTitle"):z.getString("CallPreview.JoinButtonTitle"),onPress:()=>this.onStartOrJoinCall(),buttonConfig:t,backgroundStyle:i,autoFocus:!1,disabled:!this.props.conversationMri})):this.state.enableCallHandoff&&this.state.activeUserEndpoints?n.createElement(n.View,{style:this.state.isLandscape?se.footerWideLandscape:se.wideFooter},n.createElement(S.default,{buttonSize:G.SXButtonSize.Medium,buttonStyle:G.SXButtonStyle.ColorFill,title:this.state.twinCamEnabled?z.getString("CallPreview.StartTwinCam"):z.getString("CallPreview.HandoffCallAddDevice"),onPress:()=>this.onStartOrJoinCall(!1),autoFocus:!1,disabled:!this.props.conversationMri,backgroundStyle:i,icon:this.state.twinCamEnabled?Q.SkypeIcon.Camera:Q.SkypeIcon.MobileSending,style:se.wideButtonStyle}),n.createElement(S.default,{buttonSize:G.SXButtonSize.Medium,buttonStyle:G.SXButtonStyle.LightFill,title:z.getString("CallPreview.HandoffCallTransfer"),onPress:()=>this.onStartOrJoinCall(!0),autoFocus:!1,icon:Q.SkypeIcon.Screenshare2,disabled:!this.props.conversationMri,backgroundStyle:i,style:se.wideButtonStyle})):this.state.callState===r.CallState.Connecting?n.createElement(n.View,{style:this.state.isLandscape?se.footerLandscape:se.footer},n.createElement(m.default,{size:G.SXActivityIndicatorSize.Medium,tintColor:j.Color.white})):void 0}_getCallPreviewControl(e){const t=[se.previewControl];this.state.isLandscape&&t.push(se.previewControlLandscape),this.props.previewControlStyle&&t.push(this.props.previewControlStyle);const i=!e&&this.state.enableBackgroundReplacement&&this.state.isSmallDesktopWindow&&!this.state.isCameraDisabled&&!this.state.isProtocolLaunchCallPreview&&!this.props.isNewCallPreviewStyle,a=i?this._renderBackgroundReplacementButton([se.blurToggleStyleOnSmallWindow]):void 0;return n.createElement(n.View,{style:t},this._renderOptionalCameraAndMicrophoneDetails(),this._renderControlSection(i||e),a,this._renderOptionalActionButton())}_renderControlSection(e){const t=this._getCallControlMicButton(),i=this._getCallControlVideoButton(),a=this._getCallControlBackgroundBlurButton(e);return!0===this.props.isNewCallPreviewStyle?n.createElement(n.View,{style:se.iconTogglesContainer},t,i,a):n.createElement(n.View,{style:se.iconTogglesContainer},i,t,a)}_getCallControlCameraReverseButton(){let e;return e=this.state.selectedCamera?this.state.selectedCamera.position===r.CameraPosition.Front?z.getString("CallControls.CallButtonSwitchCameraBackwardLabel"):z.getString("CallControls.CallButtonSwitchCameraForwardLabel"):z.getString("CallControls.CallButtonSwitchCameraLabel"),this.state.isProtocolLaunchCallPreview?void 0:n.createElement(ne.CallButton,{ref:this._onSwitchCameraRef,key:ae.CallControlsKeys.VideoQuickSettings,icon:Q.SkypeIcon.NewSwitchCamera,title:z.getString("CapturePanel.SwitchCameraButtonTitle"),size:ne.CallButtonSize.Large,onPress:this._switchCameraButtonPressed,accessibilityLabel:e,backgroundStyle:ne.CallButtonBackgroundStyle.Solid,colorConfig:this._colorConfig()})}_getCallControlVideoButton(){const e=!this.state.isCameraDisabled&&this.state.isCameraOn;if(!0===this.props.isNewCallPreviewStyle){let t,i;const a=ne.CallButtonSize.Small;return this.state.isOutgoingVideoDisabled?t=i=z.getString("AudioVideoSettings.OutgoingVideoDisabled"):(t=z.getString(e?"CallControls.CallButtonTurnOffVideoLabel":"CallControls.CallButtonTurnOnVideoLabel"),i=T.default.generateTooltipLabelWithShortcutForCondition(t,W.KeyboardShortcut.ToggleCamera)),n.createElement(ne.CallButton,{ref:this._onCameraToggleRef,key:ae.CallControlsKeys.Video,icon:this.state.isAwaitingCameraConfirmation?Q.SkypeIcon.Ok:e?Q.SkypeIcon.Video:Q.SkypeIcon.VideoOff,title:i,size:a,isDisabled:this.state.isCameraDisabled,isToggledOn:e,onPress:t=>this._onToggleVideo(t,!e),accessibilityLabel:t,backgroundStyle:e?ne.CallButtonBackgroundStyle.Overlay:ne.CallButtonBackgroundStyle.Solid,colorConfig:this.state.isAwaitingCameraConfirmation?this._cameraConfirmColorConfig():void 0,doNotAddHorizontalMargin:!1})}{const t=this.state.isOutgoingVideoDisabled?"AudioVideoSettings.OutgoingVideoDisabled":"CallPreview.ToggleVideoAccessibilityLabel";return n.createElement(p.default,{key:"video",ref:this._onCameraToggleRef,icon:e?Q.SkypeIcon.Video:Q.SkypeIcon.VideoOff,accessibilityLabel:z.getString(t),iconSize:Q.IconSize.size24,style:[se.iconTogglesContainer,se.iconStyle],isOn:e,onChange:this._onToggleVideo,disable:this.state.isOutgoingVideoDisabled||this.state.isCameraDisabled})}}_getCallControlMicButton(){const e=!this.state.isMicrophoneDisabled&&this.state.isMicrophoneOn;if(!0===this.props.isNewCallPreviewStyle){const t=ne.CallButtonSize.Small,i=z.getString(e?"CallControls.CallButtonUnmuteLabel":"CallControls.CallButtonMute"),a=T.default.generateTooltipLabelWithShortcutForCondition(i,W.KeyboardShortcut.ToggleMicrophone);return n.createElement(ne.CallButton,{ref:this._onMicrophoneToggleRef,key:ae.CallControlsKeys.Mic,icon:e?Q.SkypeIcon.Microphone:Q.SkypeIcon.MicrophoneOff,title:a,size:t,isToggledOn:e,onPress:t=>this._onToggleMic(t,!e),accessibilityLabel:i,backgroundStyle:e?ne.CallButtonBackgroundStyle.Overlay:ne.CallButtonBackgroundStyle.Solid,colorConfig:this._colorConfig(),doNotAddHorizontalMargin:!1})}return this.state.isProtocolLaunchCallPreview?void 0:n.createElement(p.default,{key:"microphone",ref:this._onMicrophoneToggleRef,icon:e?Q.SkypeIcon.Microphone:Q.SkypeIcon.MicrophoneOff,accessibilityLabel:z.getString("CallPreview.ToggleMicrophoneAccessibilityLabel"),iconSize:Q.IconSize.size24,style:[se.iconTogglesContainer,se.iconStyle],isOn:e,onChange:this._onToggleMic,disable:this.state.isMicrophoneDisabled})}_getCallControlBackgroundBlurButton(e){const t=this.state.enableBlurBackgroundCallPreview&&!e,i=!this.state.isCameraDisabled&&this.state.isCameraOn;if(!0!==this.props.isNewCallPreviewStyle)return t?n.createElement(p.default,{key:"blur",ref:this._onBackgroundBlurToggleRef,icon:Q.SkypeIcon.BackgroundReplacement,accessibilityLabel:z.getString("CallPreview.CallPreviewBlurToggleLabel"),iconSize:Q.IconSize.size24,style:[se.iconTogglesContainer],isOn:i&&this.state.isBackgroundBlurred,onChange:this._onToggleBlur,disable:!i,disableInteraction:!i}):void 0;i&&this.state.isBackgroundBlurred,z.getString("CallPreview.CallPreviewBlurToggleLabel"),ne.CallButtonSize.Small}_renderToggleWithText(e){return n.createElement(n.View,{style:e.styles},n.createElement(y.BodyText,{size:y.BodyTextSize.SmallDeprecated,style:se.toggleText,numberOfLines:1},e.text),n.createElement(g.default,{key:e.key,style:se.accessibleToggleSwitchStyle,isOn:e.value,accessibilityLabel:e.accessibilityLabel,onChange:e.onToggle,disable:e.disable,disableInteraction:e.disableInteraction}))}_getHeaderText(e){return re.getHeaderText()}static getHeaderText(){return z.getString("CallPreview.CallPreviewViewLabel")}_setBlurBackground(e){H.log(W.LogTraceArea.CallingUI,"CallPreview _setBlurBackground causeId: "+e),!this.state.isCameraDisabled&&this.state.enableBlurBackgroundCallPreview&&(H.log(W.LogTraceArea.CallingUI,"CallPreview _setBlurBackground blur background as user preference, callId: "+this._getCallId()+" causeId: "+e),c.default.DeviceStore.setBackgroundBlurred(this.state.isBackgroundBlurred))}_cameraConfirmColorConfig(){return{iconColor:j.Color.white,backgroundColor:j.Color.blue,selectedIconColor:j.Color.white,selectedBackgroundColor:j.Color.blue}}_colorConfig(){return this.state.useHighContrastTheme?te.default.highContrastColorConfig(this._themeColors):void 0}_getCallId(){return this.props.activeCallId||this.props.fallbackCallId||Z.default.newGuid()}_startPreheatingActiveCall(){const e=Z.default.newCauseId(),{conversationMri:t,activeCallId:i,callOrigin:a}=this.props;if(H.log(W.LogTraceArea.CallingUI,"CallPreview._startPreheatingActiveCall conversationMri: "+t+" activeCallId: "+i+" causeId: "+e),t&&i)c.default.CallingStore.isPreheatedNoSubscription(i)?H.log(W.LogTraceArea.CallingUI,"CallPreview._startPreheatingActiveCall abort, call already preheated activeCallId: "+i+" causeId: "+e):(c.default.CallingStore.startPreheating(t,i,{withVideo:this.state.isCameraOn,muteFlags:this.state.isMicrophoneOn?void 0:r.MuteFlags.MuteMicrophone},a,e).then(()=>{!this.isComponentMounted()&&this._canDisposePreheatedCall(i)&&this._disposePreheatedCall(i)}),this._preheatedCallCauseId=e);else{const a="CallPreview._startPreheatingActiveCall abort, conversationMri and activeCallId cannot be undefined conversationMri: "+t+" activeCallId: "+i+" causeId: "+e;H.error(W.LogTraceArea.CallingUI,a)}}_disposePreheatedCall(e){const t=this._preheatedCallCauseId||Z.default.newCauseId();H.log(W.LogTraceArea.CallingUI,`CallPreview._disposePreheatedCall callId: ${e} causeId: ${t}`),c.default.CallingStore.stopPreheating(e,t)}}t.default=re},1227:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(25),n=i(34),o=i(1),s=i(15),r=i(3),l=i(4),c=i(37);var d;!function(e){e[e.DropTarget=0]="DropTarget",e[e.Drag=1]="Drag",e[e.Hover=2]="Hover"}(d||(d={}));let u=class extends s.StoreBase{getCurrentDraggingParticipantKey(){return this._currentConfig?this._currentConfig.key:void 0}getCurrentDraggingParticipantConfig(){return this._currentConfig}getCurrentHoveringParticipantConfig(){return this._hoveringConfig}dangerouslyGetCurrentDraggingParticipantConfig(){return this._currentConfig}setDraggingParticipantConfig(e){if(c.default(this._currentConfig,e))return;const t=this._currentConfig;this._currentConfig=e;const i=[],a=t?t.key:null;if(!this._currentConfig||a!==this._currentConfig.key){const e=this._currentConfig?this._currentConfig.key:"none";l.log(r.LogTraceArea.CallingUI,"CallDraggingParticipantStore.setDraggingParticipantConfig change: key: "+n.pii.Omit(e)),i.push(d.Drag)}e&&this._hoveringConfig&&(this._hoveringConfig=void 0,i.push(d.Hover)),i.push(d.DropTarget),this.trigger(i)}clearHoveringParticipantConfig(e){!this._hoveringConfig||e&&this._hoveringConfig.source!==e||(this._hoveringConfig=void 0,o.defer(()=>{this.trigger(d.Hover)}))}setHoveringParticipantConfig(e){c.default(this._hoveringConfig,e)||(this._hoveringConfig=e,this.trigger(d.Hover))}};a.__decorate([s.autoSubscribeWithKey(d.Drag)],u.prototype,"getCurrentDraggingParticipantKey",null),a.__decorate([s.autoSubscribeWithKey(d.DropTarget)],u.prototype,"getCurrentDraggingParticipantConfig",null),a.__decorate([s.autoSubscribeWithKey(d.Hover)],u.prototype,"getCurrentHoveringParticipantConfig",null),u=a.__decorate([s.AutoSubscribeStore],u);let h=new u;t.default=h},123:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SubscriptionDisposable=void 0;const a=i(34),n=i(1),o=i(2196),s=i(74),r=i(51),l=i(8),c=i(103),d=i(17),u=i(164),h=i(3),p=i(4),g=i(102),C=i(432),m=i(39),S=i(19);t.SubscriptionDisposable=class{constructor(e,t){this._token=e,this._unsubscribe=t}dispose(){if(this._token){const e=this._token;this._token=void 0,this._unsubscribe(e)}}};class y{constructor(){this.onCallingError=new r.default,this._callBlacklist=[]}activeCallStates(){return this.connectedCallStates().concat([s.CallState.Connecting,s.CallState.Notified,s.CallState.EarlyMedia])}connectedCallStates(){return this.onHoldCallStates().concat([s.CallState.Connected])}onHoldCallStates(){return[s.CallState.LocalHold,s.CallState.RemoteHold]}isCallStateActive(e){return n.includes(this.activeCallStates(),e)}isCallStateConnected(e){return n.includes(this.connectedCallStates(),e)}isCallStateOnHold(e){return n.includes(this.onHoldCallStates(),e)}isParticipantConnected(e){return!!e&&this.isParticipantStateConnected(e.state)}isParticipantStateConnected(e){return e===s.ParticipantState.Connected||e===s.ParticipantState.OnHold}isParticipantRinging(e,t=!0){return e&&this.isParticipantStateRinging(e.state,t)}isParticipantStateRinging(e,t=!0){return t&&e===s.ParticipantState.Connecting||e===s.ParticipantState.Ringing}isParticipantOnHold(e){return e&&e.state===s.ParticipantState.OnHold}isParticipantTalking(e){return e&&e.voiceLevel>0}isParticipantMuted(e){return e&&e.isServerMuted}isPstnNetherlandsReason(e){return!!e&&480===e.callControllerCode&&213432===e.callControllerSubCode}participantMris(e){const t=d.asMri(e.id);return{default:(e.acceptedBy&&e.acceptedBy!==e.id?y._normalizeForwardedEndpoint(d.asMri(e.acceptedBy)):void 0)||t,original:t}}static _normalizeForwardedEndpoint(e){if(!d.isPhoneMri(e))return e;const t=d.splitMri(e),i=g.default.getNormalizedPhoneNumber(t.id);return i?d.sanitizeMri(i,t.namespace):e}conversationLiveStateFromCastNotification(e){if(!e)return void p.error(h.LogTraceArea.Calling,"conversationLiveStateFromCastNotification: Error when parsing castContext: undefined");const t=this._uncompressPayload(e),i=t&&n.attempt(()=>atob(t));if(!i||n.isError(i))return void p.error(h.LogTraceArea.Calling,"conversationLiveStateFromCastNotification: Error when parsing castContext: "+S.default.errorAsString(i),a.pii.Omit(e||""));const o=S.default.parseJsonErrorToUndefined(i);if(o&&!n.isError(o))return o.groupCallInitiator&&(o.groupCallInitiator=d.sanitizeMri(o.groupCallInitiator,d.Namespaces.SkypeId)),o;p.error(h.LogTraceArea.Calling,"conversationLiveStateFromCastNotification: Error when parsing rawData: "+S.default.errorAsString(o),a.pii.Omit(i||""))}blacklistCallId(e,t){n.includes(this._callBlacklist,e)||(p.log(h.LogTraceArea.Calling,"Blacklisting callId: "+e+" causeId: "+t),this._callBlacklist.push(e))}isLiveStateValid(e){return!this.invalidLiveStateError(e)}invalidLiveStateError(e){return e?"Active"!==e.status?("InActive"===e.status&&p.warn(h.LogTraceArea.Calling,"Got non-null inactive live state "+a.pii.Omit(JSON.stringify(e))),"Status of call is "+e.status):e.expiration?1e3*e.expiration<Date.now()?"Expired with Active status":e.conversationId&&e.conversationUrl?n.includes(this._callBlacklist,e.conversationId)?"Call ID has been blacklisted":d.isMri(e.conversationUrl)&&d.isEncryptedThread(e.conversationUrl)?"Call is encrypted":void 0:"Missing call ID or conversation URL":"Missing expiration":"No live state found"}isLiveStateForGoLive(e){return!!e&&"cast"===e.conversationType}isLiveStateValidAndForGoLive(e){return!!this.isLiveStateValid(e)&&this.isLiveStateForGoLive(e)}incomingCallNotificationForFlamingo(e){let t,i;if(e.content){const a=S.default.parseJsonErrorToUndefined(e.content);a&&(a.cp&&(t=this._uncompressPayload(a.cp)),i=a.callId)}const a=d.getParsedConversationId(e),n=parseInt(e.eventId,10);return{evt:n,gp:t,gpc:e.content,nsp:void 0,displayName:void 0,callId:e.skypeguid||i,conversationMri:y._maybeSanitizeMri(e.conversationId||e.imdisplayname||a,n),callerMri:y._maybeSanitizeMri(e.imdisplayname,n),participantId:e.skypeguid,videoCall:"true"===e.isVideoCall,encryptedKey:void 0,recipientId:void 0}}incomingCallNotificationForPnh(e,t){let i;return t.servicePayload&&t.servicePayload.cp&&(i=this._uncompressPayload(t.servicePayload.cp)),{evt:e,gp:i,gpc:JSON.stringify(t.servicePayload),nsp:void 0,displayName:t.displayName,callId:t.callId,conversationMri:y._maybeConvertToEncryptedThread(y._maybeSanitizeMri(t.convoId,e),e),callerMri:y._maybeSanitizeMri(t.callerId,e),participantId:t.participantId,videoCall:"true"===t.videoCall,encryptedKey:t.encryptedKey,recipientId:y._maybeSanitizeRecipientId(t.recipientId)}}incomingGoLivelNotificationForPnh(e,t){const i=this.conversationLiveStateFromCastNotification(t.castContext);if(i)return{evt:e,callId:t.callId,callerMri:y._maybeSanitizeMri(i.groupCallInitiator,e),conversationMri:y._maybeSanitizeMri(t.threadId,e),recipientId:y._maybeSanitizeRecipientId(t.recipientId),conversationLiveState:i,participantId:void 0};p.warn(h.LogTraceArea.Calling,"Conversation livestate missing from notification: "+a.pii.Omit(JSON.stringify(t)))}stopGoLiveNotificationForPnh(e,t){return{evt:e,callId:t.callId,conversationMri:y._maybeSanitizeMri(t.threadId,e),recipientId:y._maybeSanitizeRecipientId(t.recipientId),participantId:void 0}}incomingGoLiveNotificationForTrouter(e){const t=e.eventId||e.body.evt,i=this.conversationLiveStateFromCastNotification(e.body.castContext);if(i)return{evt:t,callId:e.body.callId,callerMri:y._maybeSanitizeMri(i.groupCallInitiator,t),conversationMri:y._maybeSanitizeMri(e.body.threadId,t),recipientId:y._maybeSanitizeRecipientId(e.body.recipientId),conversationLiveState:i,participantId:void 0};p.warn(h.LogTraceArea.Calling,"Conversation livestate missing from notification: "+a.pii.Omit(JSON.stringify(e.body)))}stopGoLiveNotificationForTrouter(e){const t=e.eventId||e.body.evt;return{evt:t,callId:e.body.callId,conversationMri:y._maybeSanitizeMri(e.body.threadId,t),recipientId:y._maybeSanitizeRecipientId(e.body.recipientId),participantId:void 0}}_uncompressPayload(e){const t=u.base64StringToUint8Array(e);if(!t)return void p.warn(h.LogTraceArea.Calling,"_uncompressPayload: Couldn't un-base64 call data");const i=o.inflate(t);return u.Uint8ArrayToBase64String(i)}stopCallNotificationForPnh(e,t){return{evt:e,reason:t.reason,callId:t.callId,conversationMri:y._maybeSanitizeMri(t.conversationId,e),callerMri:y._maybeSanitizeMri(t.callerMri,e),participantId:t.participantId,recipientId:y._maybeSanitizeRecipientId(t.recipientId)}}stopCallNotificationForPermission(e){return{evt:e.evt,callId:e.callId,participantId:e.participantId,conversationMri:e.conversationMri,callerMri:e.callerMri,reason:"RejectedDueToNoMicPermission",recipientId:e.recipientId}}incomingCallNotificationForTrouter(e){let t;t=e.body.servicePayload&&e.body.servicePayload.cp?this._uncompressPayload(e.body.servicePayload.cp):e.body.gp;const i=e.eventId||e.body.evt;return{evt:i,gp:t,gpc:e.body.servicePayload?JSON.stringify(e.body.servicePayload):void 0,nsp:void 0,displayName:e.body.displayName,callId:e.body.callId,conversationMri:y._maybeConvertToEncryptedThread(y._maybeSanitizeMri(e.body.convoId||e.body.conversationId,i),i),callerMri:y._maybeSanitizeMri(e.body.callerId||e.body.callerMri,i),participantId:e.body.participantId,videoCall:e.body.videoCall,encryptedKey:e.body.encryptedKey,recipientId:y._maybeSanitizeRecipientId(e.body.recipientId)}}stopCallNotificationForTrouter(e){const t=e.eventId||e.body.evt;return{evt:t,reason:e.body.reason,callId:e.body.callId,conversationMri:y._maybeSanitizeMri(e.body.convoId||e.body.conversationId,t),callerMri:y._maybeSanitizeMri(e.body.callerId||e.body.callerMri,t),participantId:e.body.participantId,recipientId:y._maybeSanitizeRecipientId(e.body.recipientId)}}incomingCallNotificationForP2PPnh(e){const t=e.eventType;return{evt:t,displayName:e.displayName,callId:e.callId,conversationMri:y._maybeSanitizeMri(e.convoId,t),callerMri:y._maybeSanitizeMri(e.callerId,t),participantId:e.participantId,videoCall:"true"===e.videoCall,recipientId:y._maybeSanitizeRecipientId(e.recipientId)}}static _maybeSanitizeMri(e,t){const i=y._getCallerNamespaceForCallEvent(e,t);return e?d.sanitizeMri(e,i):void 0}static _maybeConvertToEncryptedThread(e,t){return t===C.PNHEvents.IncomingNGCEncryptedCall&&e&&!d.isEncryptedThread(e)?d.buildOneOnOneEncryptedThreadId(e):e}static _maybeSanitizeRecipientId(e){return e?d.sanitizeMri(e,d.Namespaces.SkypeId):void 0}buildNGCCallPayload(e,t,i,o,s,r){const l=e.gp;if(!l)return void p.error(h.LogTraceArea.Calling,"buildNGCCallPayload: Error when decoding gp payload: undefined causeId: "+r);const c=n.attempt(()=>atob(l));if(!c||n.isError(c))return void p.error(h.LogTraceArea.Calling,"buildNGCCallPayload: Error when decoding gp payload: "+S.default.errorAsString(c)+" causeId: "+r+" "+a.pii.Omit(l||""));const d=S.default.parseJsonErrorable(c);if(d&&!n.isError(d)){if(d.callNotification)return{conversationId:e.conversationMri?e.conversationMri:d.groupChat&&d.groupChat.threadId?d.groupChat.threadId:d.callNotification.from.id,messageId:d.groupChat?d.groupChat.messageId:null,callerId:e.callerMri?e.callerMri:d.callNotification.from.id,convoCallId:e.callId?e.callId:d.debugContent.callId,isMultiParty:!!d.conversationInvitation&&d.conversationInvitation.isMultiParty,fromMixer:d.callNotification.fromMixer||!1,ngcCall:!0,body:{evt:e.evt,nsp:e.nsp||"",gp:e.gp||""},videoCall:e.videoCall,launchTime:i,pushReceivedTime:o.pushReceivedTime,registrationId:s||"",callKey:t||"",participantId:e.participantId||"",connectionType:o.connectionType};p.log(h.LogTraceArea.Calling,"Unable to create incoming NGC payload "+r)}else p.error(h.LogTraceArea.Calling,"buildNGCCallPayload: Error when parsing gp payload: "+S.default.errorAsString(d)+" causeId: "+r+" "+a.pii.Omit(c||""))}static _getCallerNamespaceForCallEvent(e,t){if(e&&d.isMri(e))return d.getMriNamespace(e);switch(t){case C.PNHEvents.IncomingNGCCall:case C.PNHEvents.IncomingP2PCall:case C.PNHEvents.IncomingNGCGroupCall:case C.PNHEvents.IncomingNGCEncryptedCall:return d.Namespaces.SkypeId;case C.PNHEvents.IncomingNGCPSTNCall:return d.Namespaces.PSTN;case C.PNHEvents.IncomingS4BCall:return d.Namespaces.S4B_Bridge;case C.PNHEvents.IncomingNGCStopRinger:return g.default.isPossiblyPhoneNumber(e)?d.Namespaces.PSTN:d.Namespaces.SkypeId;default:return d.Namespaces.SkypeId}}getMediaPeerTypeForIncomingCall(e){switch(e){case C.PNHEvents.IncomingS4BCall:case C.PNHEvents.IncomingNGCCall:case C.PNHEvents.IncomingNGCEncryptedCall:return s.MediaPeerType.ConsumerTwoParty;case C.PNHEvents.IncomingNGCGroupCall:return s.MediaPeerType.ConsumerPstn;case C.PNHEvents.IncomingNGCPSTNCall:default:return s.MediaPeerType.ConsumerMultiParty}}isValidCallingMri(e){if(!e)return!1;if(!d.isMri(e))return!1;switch(d.getMriNamespace(e)){case d.Namespaces.S4B_Bridge:case d.Namespaces.PSTN:case d.Namespaces.SkypeId:case d.Namespaces.Thread:case d.Namespaces.Bot:return!0;default:return!1}}extractMriFromKey(e,t=!1){if(d.isMri(e))return t?m.mriOrId(e):e;const i=["ss_","video_","icon_"];for(let a=0;a<i.length;++a)if(n.startsWith(e,i[a])){const n=e.substr(i[a].length);if(d.isMri(n))return t?`${i[a]}${m.mriOrId(n)}`:n}return t?a.pii.Omit(e):e}sanitizeCallStartOptions(e){return n.mapValues(n.clone(e),(e,t)=>"callKey"===t||"encryptedKey"===t?e?"yes":"no":"label"===t?a.pii.Omit(e):e)}validateIncomingCallNotificationBody(e){return!!e.conversationMri&&(d.isEncryptedThread(e.conversationMri)?!!e.encryptedKey:!e.encryptedKey)}validateOutgoingCall(e,t){return!d.isEncryptedThread(e)||!t.withVideo&&!!t.ringOthers}validateOutgoingCallParticipants(e,t){return!e.ringOthers||t.length>0}generateCallingError(e,t,i,a,n){const o=new c.CallingError(e,t,i,a,n);return p.warn(h.LogTraceArea.Calling,"generateCallingError action: "+e+" message: "+t+" terminatedReason: "+i+" failureType: "+a+" validationReason: "+n||!1),this.onCallingError.fire(o),l.Rejected(o)}maybeCallingErrorAsString(e){const t=e.action,i=e.terminatedReason,a=e.failureType,n=e.validationReason?c.CallValidationFailureReason[e.validationReason]:void 0,o=e.message;return t||i||a||n?{message:"action: "+t+" terminatedReason: "+i+" failureType: "+a+" validationFailureReason: "+n+" message: "+o,isCallingError:!0}:{message:S.default.errorAsString(e),isCallingError:!1}}validateParametersPromise(e,t,i,a){return this.validateParameters(e,i,a)?l.Resolved():this.generateCallingError(t,"Parameter validation failed for "+e+" ("+t+")",s.TerminatedReason.BadRequest,s.FailureType.CallSetupFailed,c.CallValidationFailureReason.InvalidParameters)}validateParameters(e,t,i){let a=!0;return n.each(i,i=>{const n=n=>{const o="Failed to validate parameter "+m.mriOrId(i.param)+" in method ["+e+"] causeId: "+t+(n?", error "+S.default.errorAsString(n):"");p.error(h.LogTraceArea.Calling,o),a=!1};try{i.check()||n()}catch(e){n(e)}}),a}isEventTypeTriggeringMuteAction(e){return n.includes([c.CallDeviceQualityEventType.DeviceEcho,c.CallDeviceQualityEventType.DeviceMultipleEndpoints,c.CallDeviceQualityEventType.AudioCaptureUltrasoundDetected],e)}}const f=new y;t.default=f},1237:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(7),o=i(1238),s=i(1726),r=i(3572),l=i(3573);class c extends o.LayoutExperiment{constructor(e){super(e,"SkypeToPhoneCard")}_getOptionFromConf(){return n.default.getS4LEntitlementFeatures().SCE.UserServices.Client.Experiments.SkypeToPhoneCard}render(){const e=this._getLayoutToDisplay();if(e)return a.createElement(l.default,Object.assign({layoutComponent:e,experimentSettings:this._getExperimentSettings()},this.props));if(this.props.defaultComponent){const e=this.props.defaultComponent;return a.createElement(e,Object.assign({experimentSettings:this._getExperimentSettings()},this.props))}return null}_getLayoutToDisplay(){switch(this._getOptionToDisplay()){case o.ExperimentOption.NewCta:return r.default;default:return s.default}}}t.default=c},1238:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LayoutExperiment=t.ExperimentOption=void 0;const a=i(15);var n;!function(e){e[e.Default=0]="Default",e[e.NewCta=1]="NewCta"}(n=t.ExperimentOption||(t.ExperimentOption={}));const o={default:n.Default,newCta:n.NewCta};class s extends a.ComponentBase{constructor(e,t){super(e),this._settings={name:t,location:e.location}}shouldComponentUpdate(e,t){return this.state.optionToPresent!==t.optionToPresent}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this._setSettingsLayoutOption(t.optionToPresent)}_buildState(e,t){const i={optionToPresent:this._getOptionFromConf()};return t&&this._setSettingsLayoutOption(i.optionToPresent),i}_getOptionToDisplay(){const e=this.state.optionToPresent;return o[e]?o[e]:n.Default}_getExperimentSettings(){return this._settings}_setSettingsLayoutOption(e){this._settings.layoutOption=e}}t.LayoutExperiment=s},1256:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stickerMargin=void 0;const a=i(1),n=i(0),o=i(153),s=i(7),r=i(60),l=i(45),c=i(1225),d=i(6),u=i(263),h=i(324),p=(i(27),i(9)),g=i(24),C=i(14);t.stickerMargin=4;const m=d.lazyProperties({sticker:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",overflow:"visible",marginHorizontal:t.stickerMargin}),stickerInnerView:()=>n.Styles.createViewStyle({flex:1,overflow:"visible"}),imageSticker:()=>n.Styles.createViewStyle({position:"absolute",top:3,left:3,height:38,width:38}),modernImageSticker:()=>n.Styles.createViewStyle({height:28,width:28}),scaledEmoticon:()=>n.Styles.createViewStyle({transform:[{scale:.8}]}),caption:()=>n.Styles.createTextStyle({paddingTop:5,textAlign:"center",fontSize:g.default.controlFontSize.caption,paddingHorizontal:10,color:p.Color.white,height:20,marginTop:4}),captionLightTheme:()=>n.Styles.createTextStyle({color:p.Color.gray400}),modernStageCaption:()=>n.Styles.createTextStyle({paddingTop:3}),hidden:()=>n.Styles.createTextStyle({opacity:0})});class S extends l.default{constructor(){super(...arguments),this._hovered=!1,this._onReactionButtonRef=e=>{this._reactionButton=e||void 0},this._onPress=e=>{this.props.onPress(this.props.info,e.timeStamp)},this._onHoverStart=e=>{this._onHover(!0)},this._onHoverEnd=e=>{this._onHover(!1)}}_buildState(e,t){return{isSmallDevice:!1}}componentWillUnmount(){super.componentWillUnmount(),this._hovered&&c.default.clearToolTip()}_stickerView(){const e=h.default.localizedAccessibilityTextForImageSticker(this.props.info.key),t=[m.imageSticker];return this.props.useDesktopCallControls&&t.push(m.modernImageSticker),n.createElement(n.Image,{style:t,source:h.default.imageForSticker(this.props.info.key),title:e,accessibilityLabel:e})}_emoticonView(){const e=u.separateReactionNameAndTone(this.props.info.key);let t=h.default.localizedAccessibilityTextForEmoticon(e.reactionNameWithoutTone);this.props.celebrationData&&this.props.info.key===s.default.getS4LCMCFeaturesNoSubscription().callCelebrationConfig.callCelebrateButtonKey&&(t=this.props.celebrationData.celebrationText);const i=this.state.isSmallDevice||this.props.useDesktopCallControls?o.Size.Medium:o.Size.Large,a=[m.scaledEmoticon];return this.props.hideIcon&&a.push(m.hidden),n.createElement(n.View,{style:a,accessibilityLabel:t,title:t},n.createElement(o.AnimatedEmoticon,{size:i,innerText:t,emoticonName:e.reactionNameWithoutTone,standaloneAnimation:!0,isStatic:!this.props.isAnimated,preventSelectable:!0,tone:e.reactionTone}))}_getStickerDimesionStyles(){let e,t;return this.state.isSmallDevice||this.props.useDesktopCallControls?(e=34,t=34):(e=44,t=44),this.props.caption&&(t+=20),n.Styles.createViewStyle({width:e,height:t},!1)}requestFocus(){this._reactionButton&&this._reactionButton.requestFocus()}_onHover(e){this._hovered=e;const t=()=>!(!(this.isComponentMounted()&&this.props.title&&this._hovered)||n.UserInterface.isNavigatingWithKeyboard());t()?a.delay(()=>{t()&&c.default.showToolTip(()=>this.isComponentMounted()?this:void 0,this._getRootViewId(),t,this.props.title||"")},150):c.default.clearToolTip(),this.props.onHover&&this.props.onHover(e)}render(){const e=!!this.props.onPanHorizontal,t=[m.sticker,C.default.noncollapsibleView],i=e?[m.stickerInnerView]:[t,this._getStickerDimesionStyles()];let a,o;if(this.props.info.type===r.ReactionsItemType.Sticker?a=this._stickerView():this.props.info.type!==r.ReactionsItemType.Emoticon&&this.props.info.type!==r.ReactionsItemType.Animation||(a=this._emoticonView()),this.props.caption){const e=[m.caption];this.props.useDesktopCallControls&&e.push(m.modernStageCaption),this.props.useLightTheme&&e.push(m.captionLightTheme),o=n.createElement(n.Text,{style:e},this.props.caption)}let s=n.createElement(n.Button,{ref:this._onReactionButtonRef,style:i,activeOpacity:.5,tabIndex:this.props.tabIndex,importantForAccessibility:this.props.importantForAccessibility,accessibilityLabel:this.props.accessibilityLabel,onPress:this._onPress,onHoverStart:this._onHoverStart,onHoverEnd:this._onHoverEnd},a,o);return e&&(s=n.createElement(n.GestureView,{style:[t,this._getStickerDimesionStyles()],onPanHorizontal:this.props.onPanHorizontal,releaseOnRequest:!1,importantForAccessibility:this.props.importantForAccessibility},s)),s}}t.default=S,S.stickerSize=44,S.stickerMargin=t.stickerMargin},1257:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(7),s=i(29),r=i(1777),l=i(843),c=i(1258),d=i(45),u=i(750),h=i(41),p=i(37),g=i(6),C=i(5),m=i(1778),S=i(9),y=i(11),f=i(1779),_=y.IconSize.default,b=y.IconSize.size24,v=y.IconSize.size40,w=y.IconSize.size20,T=g.lazyProperties({scroll:()=>n.Styles.createViewStyle({flex:1,alignItems:"stretch",backgroundColor:S.Color.black}),buttonIconsContainer:()=>n.Styles.createViewStyle({height:_,alignItems:"flex-start",flexDirection:"row",justifyContent:"space-between"}),buttonIcon:()=>n.Styles.createViewStyle({width:_,height:_,justifyContent:"center",alignItems:"center",alignSelf:"flex-start",opacity:.9,overflow:"visible"}),buttonJumpContainer:()=>n.Styles.createViewStyle({position:"absolute",right:12,width:v,height:v,overflow:"visible"}),buttonJump:()=>n.Styles.createViewStyle({width:v,height:v,borderWidth:1,borderRadius:v/2,borderColor:S.Color.blackOverlay10,justifyContent:"center",alignItems:"center",opacity:.9,overflow:"visible",backgroundColor:S.Color.gray400}),buttonHovered:()=>n.Styles.createViewStyle({opacity:1})});class I{constructor(e,t,i){this.key=e,this.transcription=t,this.height=i,this.focusable=!1}}class P extends d.default{constructor(){super(...arguments),this._renderItem=(e,t)=>e instanceof I?n.createElement(r.default,{key:e.key,transcription:e.transcription,iconSize:c.SenderAvatarSize,isInterimCaptionConcatenated:this.state.isInterimCaptionConcatenated}):n.createElement(n.View,null),this._onPressClose=e=>{e.stopPropagation(),this.state.canJumpToEnd||l.default.setConsumptionHorizon(this.props.reactionsMri,this.state.lastMessageTime+1),this.props.onPressClose&&this.props.onPressClose()},this._onPressClosedCaptionSettings=e=>{e.stopPropagation(),s.default.CallNavigationHelper.navigateToSubtitlesCallingSettingsPanel(!1,this._getRootViewId())},this._onPressJump=e=>{e.stopPropagation(),this._listView&&this._listView.scrollToBottom()},this._onVisibleRangeChanged=(e,t,i,n)=>{if(!this._itemList)return;const o=n!==this._itemList.getItemList().length-1;a.defer(()=>{this.isComponentMounted()&&(this.state.canJumpToEnd!==o?this.setState({canJumpToEnd:o}):l.default.resetUnseenTranscriptionCount(this.props.reactionsMri))})},this._equalsItemInfo=(e,t)=>e instanceof I&&t instanceof I?e.key===t.key&&e.transcription.payload.message===t.transcription.payload.message&&e.transcription.payload.translation===t.transcription.payload.translation&&e.transcription.payload.isFinal===t.transcription.payload.isFinal:p.default(e,t),this._shouldUpdateItem=(e,t)=>!this._equalsItemInfo(e,t),this._onListViewRef=e=>{this._listView=e||void 0}}_buildState(e,t){var i,n;const s=o.default.getS4LCMCFeatures(),r=l.default.getTranscriptions(e.reactionsMri),c=a.map(r,e=>new I(e.payload.cid,e)),d=null!==(n=null===(i=a.maxBy(r.map(e=>e.message),e=>e.createdTime))||void 0===i?void 0:i.createdTime)&&void 0!==n?n:0;if(t||!this._itemList)this._itemList=new m.default,this._itemList.addItems(0,c);else{const e=this._itemList.getItemList(),t=u.default.calculateModifications(e,c,!0,!1,this._equalsItemInfo),i=u.default.convertToListModifications(t);this._itemList.applyMany(i)}return{isInterimCaptionConcatenated:s.isInterimCaptionConcatenated,lastMessageTime:d}}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),l.default.assignCallId(this.props.reactionsMri,this.props.callId)}render(){if(!this._itemList)return null;const e=this.props.bottomPadding||10,t=this.props.topPadding,i=n.Styles.createViewStyle({paddingBottom:e,paddingTop:t},!1),a=this.state.canJumpToEnd?this._renderJumpButton():void 0;return n.createElement(n.View,{key:"subtitleHistory",style:[this.props.style,T.scroll,i]},n.createElement(n.View,{key:"buttonIconsContainer",style:T.buttonIconsContainer},n.createElement(h.default,{style:T.buttonIcon,size:b,color:S.Color.gray50,hoverColor:S.Color.white,hoverStyle:T.buttonHovered,icon:y.SkypeIcon.ClosePanel,onPress:this._onPressClose,title:C.getString("CallTranscription.Collapse")}),n.createElement(h.default,{style:T.buttonIcon,size:b,color:S.Color.gray50,hoverColor:S.Color.white,hoverStyle:T.buttonHovered,icon:y.SkypeIcon.ClosedCaptionSettings,onPress:this._onPressClosedCaptionSettings,title:C.getString("CallingSettingsPanel.SubtitlesButtonLabel")})),n.createElement(f.VirtualMessageView,{ref:this._onListViewRef,observableList:this._itemList,renderItem:this._renderItem,onVisibleRangeChanged:this._onVisibleRangeChanged,shouldUpdateItem:this._shouldUpdateItem,contentMaxWidth:c.SubtitleMaxWidth,horizontalPadding:{left:30,right:30},useWideLayout:!1,leftSpacerWidth:0,rightSpacerWidth:0,canShowSuggestions:!1}),a)}_renderJumpButton(){const e=this.props.bottomPadding||10,t=n.Styles.createViewStyle({bottom:e},!1);return n.createElement(n.View,{key:"jumpToEnd",style:[T.buttonJumpContainer,t]},n.createElement(h.default,{style:T.buttonJump,hoverStyle:T.buttonHovered,size:w,onPress:this._onPressJump,color:S.Color.gray100,hoverColor:S.Color.white,icon:y.SkypeIcon.DownChevron,title:C.getString("CallTranscription.JumpToLast")}))}}t.default=P},1258:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SubtitleMaxWidth=t.SubtitleMaxPreviewLines=t.SenderAvatarSize=void 0;const a=i(65),n=i(10),o={desktop:{portrait:{preview:{isHorizontal:!0,sizeRatio:.7},interactive:{isHorizontal:!0,sizeRatio:.5}},landscape:{preview:{isHorizontal:!0,sizeRatio:.7},interactive:{isHorizontal:!1,fixedSize:300,sizeRatio:0}}},mobile:{portrait:{preview:{isHorizontal:!0,sizeRatio:.7},interactive:{isHorizontal:!0,sizeRatio:.5}},landscape:{preview:{isHorizontal:!0,sizeRatio:.8},interactive:{isHorizontal:!1,sizeRatio:.5}}}};t.SenderAvatarSize=a.UserIconSize.Size24,t.SubtitleMaxPreviewLines=4,t.SubtitleMaxWidth=500;class s{static getTranscriptionLayout(e,t,i){const a=t?o.mobile:o.desktop,n=i?a.landscape:a.portrait;return e?n.interactive:n.preview}static getTranscriptionLayoutRects(e,t){const i=t.fixedSize?s.shrinkRectByAmount(e,t.fixedSize,t.isHorizontal):s.shrinkRectByRatio(e,t.sizeRatio,t.isHorizontal);let a=i.remainderRect;if(t.paddingSize){const e=s.shrinkRectByAmount(a,t.paddingSize,!t.isHorizontal).shrinkedRect;a={x:t.isHorizontal?e.x+t.paddingSize:e.x,y:t.isHorizontal?e.y:e.y+t.paddingSize,width:e.width,height:e.height}}return{stage:i.shrinkedRect,subtitles:a,isHorizontal:t.isHorizontal}}static shrinkRectByRatio(e,t,i){t=n.default.clampValue(t,0,1);const a=Math.floor((i?e.height:e.width)*t);return s.shrinkRectByAmount(e,a,i)}static shrinkRectByAmount(e,t,i){t=n.default.clampValue(t,0,i?e.height:e.width);const a=i?{x:e.x,y:e.y,width:e.width,height:e.height-t}:{x:e.x,y:e.y,width:e.width-t,height:e.height};return{shrinkedRect:a,remainderRect:i?{x:e.x,y:a.y+a.height,width:e.width,height:e.height-a.height}:{x:a.x+a.width,y:e.y,width:e.width-a.width,height:e.height}}}}t.default=s},1260:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResponsiveComponentBase=void 0;const a=i(27),n=i(12);class o extends n.default{constructor(e){super(e),this._mobileSmallBreakpoint=360,this._mobileMediumBreakpoint=400,this._desktopSmallBreakpoint=800,this._desktopSmallHeightBreakpoint=600}_buildState(e,t){const i=this._getRootViewId(),n={};return n.xSize=a.default.getWidth(i),n.ySize=a.default.getHeight(i),n.isMobileScreenSize=a.default.isMobileScreenSize(i),n}_chooseResponsiveStyle(e){const t=this.props.isInLandscape?this.state.ySize:this.state.xSize,i=this.state.ySize,a=(this.props.isInLandscape?e.MobileDefaultLandscape:void 0)||e.MobileDefault;return this.state.isMobileScreenSize?t<=this._mobileSmallBreakpoint?e.MobileSmall||a:t<=this._mobileMediumBreakpoint?e.MobileMedium||a:e.MobileDefault:(t<=this._desktopSmallBreakpoint||i<=this._desktopSmallHeightBreakpoint)&&e.DesktopSmall||e.DesktopDefault}}t.ResponsiveComponentBase=o},1261:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageConversationCommand=t.MergeIncomingCallCommand=t.AcceptIncomingCallCommand=t.RejectIncomingCallCommand=void 0;const a=i(29),n=i(47),o=i(17),s=i(3),r=i(120),l=i(172),c=i(4),d=i(261),u=i(158),h=i(147),p=i(30),g=i(84),C=i(10);t.RejectIncomingCallCommand=class{constructor(e,t){this._callId=e,this._setFocusAfterReject=t}execute(){const e=C.default.newCauseId();c.log(s.LogTraceArea.CallingUI,`RejectIncomingCallCommand callId: ${this._callId} causeId: ${e}`),a.default.CallingStore.rejectCall(this._callId,e),this._setFocusAfterReject&&r.setFocus(r.FocusEvent.DeclineCallFromCallBanner)}};t.AcceptIncomingCallCommand=class{constructor(e,t,i,a){this._withVideo=e,this._callId=t,this._callInfo=i,this._skipNavigation=a}execute(){const e=C.default.newCauseId();c.log(s.LogTraceArea.CallingUI,`AcceptIncomingCallCommand withVideo:${this._withVideo}; callId: ${this._callId}; causeId: ${e}`);o.isGroupConversation(this._callInfo.conversationMri)&&d.default.beginTrackingJoinMeetNow(h.MeetNowOrigin.IncomingCallPanel,void 0,u.MeetNowHelpers.isMeetNowConversation(this._callInfo.conversationMri)),a.default.CallNavigationHelper.answerOrJoinCall({conversationMri:this._callInfo.conversationMri,callId:this._callId,withVideo:this._withVideo,skipNavigation:this._skipNavigation,knownToBeAnswer:!0,origin:s.NavigationCallOrigin.CallControls},e)}canExecute(){return!this._withVideo||a.default.CallingFeaturesHelper.allowOutboundVideo(this._callInfo)}};t.MergeIncomingCallCommand=class{constructor(e){this._callId=e}execute(){const e=C.default.newCauseId();c.log(s.LogTraceArea.CallingUI,`MergeIncomingCallCommand callId: ${this._callId}; causeId: ${e}`),a.default.CallingStore.mergeCall(this._callId,e)}};t.MessageConversationCommand=class{constructor(e){this._conversationMri=e}execute(e,t){const i=p.default.getValueOfDoNotFormatPreferenceOrFalseIfDisabled(this._conversationMri),a=o.isConversationWithPhoneNumber(this._conversationMri),s=i&&!a,r=a;g.default.postMessageFromInput(this._conversationMri,t,l.convertRawTextToInputEntities(e,s,r),n.MessageTypes.RichText)}}},1263:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(97),s=i(700),r=i(13),l=i(67),c=i(6),d=i(119),u=i(111),h=i(44),p=i(42),g=i(9),C=i(11),m=i(14),S=i(16),y=i(12),f=i(10),_=c.lazyProperties({container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"column",padding:15,backgroundColor:g.Color.white}),buttonsContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignContent:"stretch",paddingVertical:5}),headerContainer:()=>n.Styles.createViewStyle({flexDirection:"row",paddingVertical:5,flex:1}),scrollView:()=>n.Styles.createScrollViewStyle({flex:1,alignSelf:"stretch"}),headerStyle:()=>n.Styles.createTextStyle({marginVertical:10}),buttonStyle:()=>n.Styles.createViewStyle({marginVertical:10}),buttonGroupContainer:()=>n.Styles.createViewStyle({flexDirection:"column",paddingVertical:5,flex:1})});class b extends y.default{constructor(){super(...arguments),this._onAppMetricChange=(e,t)=>{s.default.setShowAppMetrics(t)},this._onVideoMetricChange=(e,t)=>{s.default.setShowVideoMetrics(t)},this._onClose=()=>{const e=f.default.newCauseId();s.default.closeDebugWindow(this.props.callId,e,this._getContext(),!1)},this._onPopout=()=>{const e=f.default.newCauseId();s.default.openNativeWindow(this.props.callId,!0,this._getContext(),e)}}_buildState(e,t){return{callTechnicalInfo:s.default.getCallTechnicalInfo(e.callId),selectedItem:t?s.CallDebugMenuItem.CallStats:s.default.getSelectedTab(),showAppMetrics:s.default.showAppMetrics(),showVideoMetrics:s.default.showVideoMetrics(),appMetrics:s.default.getAppMetrics()}}componentDidMount(){super.componentDidMount(),s.default.init(this.props.callId)}componentWillUnmount(){super.componentWillUnmount(),s.default.dispose(this.props.callId)}render(){const{selectedItem:e}=this.state;let t;switch(e){case s.CallDebugMenuItem.Simulation:t=this._renderSimulatePanel();break;case s.CallDebugMenuItem.CallStats:t=this._renderCallStats();break;case s.CallDebugMenuItem.Inspect:t=this._renderInspectContent()}const i={closeButtonType:h.CloseButtonType.Close,onPress:this._onClose,title:"Close"};return n.createElement(n.View,{style:_.container},!this.props.nativeWindow&&n.createElement(h.SimplePanelHeader,{panelName:"Call debug panel",titleTextStyle:m.default.flexNegativeOne,leftButton:i,rightButtons:void 0,hideBottomBorder:!0,leavePaddingForStatusBar:n.StatusBar.isOverlay()}),n.createElement(n.View,{style:_.buttonsContainer},this._renderMenuItems()),n.createElement(l.default,null),n.createElement(n.ScrollView,{key:"scrollview",style:_.scrollView},n.createElement(n.View,null,t)))}_renderMenuItems(){const{selectedItem:e}=this.state;return a.map(s.CallDebugMenuItem,t=>{const i=s.CallDebugMenuItem[t];return a.isString(i)?n.createElement(p.default,{key:"calldebug"+i,buttonSize:r.SXButtonSize.Small,buttonStyle:t===e?r.SXButtonStyle.ColorFill:r.SXButtonStyle.ThemeNoBackground,title:s.CallDebugMenuItem[t],onPress:()=>s.default.setSelectedTab(t)}):void 0})}_renderCallStats(){const{callTechnicalInfo:e}=this.state;if(e)return n.createElement(n.View,null,a.map(null==e?void 0:e.channels,(e,t)=>n.createElement(n.View,null,n.createElement(S.Header,{selectable:!0,style:_.headerStyle,size:5,numberOfLines:1},"Channel "+t),a.map(e,(e,t,i)=>{const a="Bandwidth Estimation Algorithm"===t?"Band. est. alg.":t;return n.createElement(n.View,{key:"callstat-"+i,style:m.default.flexOne},this._renderMetricLine(a,e),n.createElement(l.default,null))}))))}_renderSimulatePanel(){return n.createElement(n.View,null,n.createElement(S.Header,{key:"actions",style:_.headerStyle,size:5,numberOfLines:1},"Actions"),n.createElement(n.View,{style:_.buttonGroupContainer},n.createElement(p.default,{key:"addParticipant",buttonSize:r.SXButtonSize.Medium,buttonStyle:r.SXButtonStyle.ColorStroke,icon:C.SkypeIcon.ContactAdd,title:"Add participant",style:_.buttonStyle,onPress:()=>this._onAddParticipantPress()}),n.createElement(p.default,{key:"removeParticipant",buttonSize:r.SXButtonSize.Medium,buttonStyle:r.SXButtonStyle.ColorStroke,icon:C.SkypeIcon.SwitchAccount,title:"Remove participant",style:_.buttonStyle,onPress:()=>this._onRemoveParticipantPress()}),n.createElement(p.default,{key:"addGroupParticipant",buttonSize:r.SXButtonSize.Medium,buttonStyle:r.SXButtonStyle.ColorStroke,icon:C.SkypeIcon.ContactGroup,title:"Add 12 participants",style:_.buttonStyle,onPress:()=>this._onGroupParticipantPress()}),n.createElement(p.default,{key:"resetParticipants",buttonSize:r.SXButtonSize.Medium,buttonStyle:r.SXButtonStyle.ColorStroke,icon:C.SkypeIcon.Reload,title:"Reset",style:_.buttonStyle,onPress:()=>this._resetParticipants()})),n.createElement(S.Header,{key:"Simulate",style:_.headerStyle,size:5,numberOfLines:1},"Simulate call states"),n.createElement(S.Header,{key:"Network",style:_.headerStyle,size:5,numberOfLines:1},"Network states"))}_renderInspectContent(){return n.createElement(n.View,null,n.createElement(S.Header,{style:_.headerStyle,size:5,numberOfLines:1},"Actions"),n.createElement(n.View,{style:_.buttonGroupContainer},n.createElement(o.default,{accessibilityLabel:"Show app metrics",style:u.default.controlRowWithDescription,isOn:!!this.state.showAppMetrics,onChange:this._onAppMetricChange},n.createElement(n.View,{style:m.default.flexOne},n.createElement(S.RowTitle,{style:u.default.switchTitleMediumSemiLarge},"Show app metrics"))),n.createElement(o.default,{accessibilityLabel:"Show video metrics",style:u.default.controlRowWithDescription,isOn:!!this.state.showVideoMetrics,onChange:this._onVideoMetricChange},n.createElement(n.View,{style:m.default.flexOne},n.createElement(S.RowTitle,{style:u.default.switchTitleMediumSemiLarge},"Show video metrics"))),this._renderAppMetrics()))}_renderAppMetrics(){var e,t,i,a,o,s,r,c,d,u,h,p,g,C,y,f,b,v,w,T,I,P,M,k,A,R,V,E,L;if(!this.state.showAppMetrics)return;const B=(null===(e=this.state.appMetrics)||void 0===e?void 0:e.gpu)&&n.createElement(n.View,null,n.createElement(S.Header,{style:_.headerStyle,size:5,numberOfLines:1},"GPU ",null===(i=null===(t=this.state.appMetrics)||void 0===t?void 0:t.gpu)||void 0===i?void 0:i.pid),this._renderMetricLine("CPU",(null===(o=null===(a=this.state.appMetrics)||void 0===a?void 0:a.gpu)||void 0===o?void 0:o.cpu.toFixed(2))+" %"),this._renderMetricLine("Memory",((null===(r=null===(s=this.state.appMetrics)||void 0===s?void 0:s.gpu)||void 0===r?void 0:r.wss)/1024).toFixed(2)+" Mb")),O=(null===(c=this.state.appMetrics)||void 0===c?void 0:c.renderer)&&n.createElement(n.View,null,n.createElement(S.Header,{style:_.headerStyle,size:5,numberOfLines:1},"Renderer ",null===(u=null===(d=this.state.appMetrics)||void 0===d?void 0:d.renderer)||void 0===u?void 0:u.pid),this._renderMetricLine("CPU",(null===(p=null===(h=this.state.appMetrics)||void 0===h?void 0:h.renderer)||void 0===p?void 0:p.cpu.toFixed(2))+" %"),this._renderMetricLine("Memory",((null===(C=null===(g=this.state.appMetrics)||void 0===g?void 0:g.renderer)||void 0===C?void 0:C.wss)/1024).toFixed(2)+" Mb"),n.createElement(l.default,null)),D=(null===(y=this.state.appMetrics)||void 0===y?void 0:y.systemUsageInfo)&&n.createElement(n.View,null,n.createElement(S.Header,{style:_.headerStyle,size:5,numberOfLines:1},"Main"),this._renderMetricLine("CPU Model",null===(b=null===(f=this.state.appMetrics)||void 0===f?void 0:f.systemUsageInfo)||void 0===b?void 0:b.cpuModel),this._renderMetricLine("CPU Speed",null===(w=null===(v=this.state.appMetrics)||void 0===v?void 0:v.systemUsageInfo)||void 0===w?void 0:w.cpuSpeed),this._renderMetricLine("CPU Cores",null===(I=null===(T=this.state.appMetrics)||void 0===T?void 0:T.systemUsageInfo)||void 0===I?void 0:I.cores),this._renderMetricLine("Total memory",(null===(M=null===(P=this.state.appMetrics)||void 0===P?void 0:P.systemUsageInfo)||void 0===M?void 0:M.totalMemory)+" Mb"),this._renderMetricLine("Free memory",(null===(A=null===(k=this.state.appMetrics)||void 0===k?void 0:k.systemUsageInfo)||void 0===A?void 0:A.freeMemory)+" Mb"),this._renderMetricLine("Memory allocated to heap",(null===(V=null===(R=this.state.appMetrics)||void 0===R?void 0:R.systemUsageInfo)||void 0===V?void 0:V.processMemory)+" Mb"),this._renderMetricLine("CPU Usage",(null===(L=null===(E=this.state.appMetrics)||void 0===E?void 0:E.systemUsageInfo)||void 0===L?void 0:L.cpuUsage)+" %"),n.createElement(l.default,null));return n.createElement(n.View,{style:m.default.flexOne},D,O,B)}_renderMetricLine(e,t){return n.createElement(n.View,{key:e,style:_.headerContainer},n.createElement(S.Caption,{selected:!0,selectable:!0,messageStreamFontSize:d.MessageStreamFontSize.Normal},e,": "),n.createElement(S.Caption,{selectable:!0,messageStreamFontSize:d.MessageStreamFontSize.Normal},t))}_onAddParticipantPress(){s.default.addParticipant(this.props.callId)}_resetParticipants(){s.default.resetParticipants(this.props.callId)}_onRemoveParticipantPress(){s.default.removeParticipants(this.props.callId)}_onGroupParticipantPress(){s.default.addGroupParticipants(this.props.callId)}}t.default=b},1403:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(47);t.default=class{static updateCallEventMessages(e){const t=a.compact(e),i=a.clone(t);let o=void 0,s=0,r=void 0;return a.each(t,(e,t)=>{n.isEventCallStartedMessageType(e)?(o=e,s=t,r=void 0):n.isEventCallEndedMessageType(e)?o&&o.skypeguid===e.skypeguid&&(r?i[t]=e.applyPropertyLie("messagesSentDuringCall",!0):i[s]=void 0):e.isShownInStream()&&(r=e)}),a.compact(i)}}},148:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(7),o=i(103),s=i(33),r=i(3),l=i(688),c=i(4),d=i(5),u=i(30),h=i(64),p=i(39);t.default=new class{getCallRecorderBotMri(){return u.default.getUserPreferencesLocal().callRecorderBotMriOverride||n.default.getS4LCMCFeatures().callRecorderBotMri}getCallRecorderBotMriFilter(){const e=u.default.getUserPreferencesLocal().callRecorderBotMriOverride,t=n.default.getS4LCMCFeatures().callRecorderBotMriFilter;return e?[e,...t]:t}setCallRecorderBotOverride(e){c.log(r.LogTraceArea.Calling,"InCallBotMriUtils.setCallRecorderBotOverride mri: "+p.mriOrId(e)),u.default.setUserPreferencesLocal({callRecorderBotMriOverride:e})}clearCallRecorderBotOverride(){c.log(r.LogTraceArea.Calling,"InCallBotMriUtils.clearCallRecorderBotOverride"),u.default.setUserPreferencesLocal({callRecorderBotMriOverride:void 0})}getCallTranslatorBotMri(){return u.default.getUserPreferencesLocal().callTranslatorBotMriOverride||n.default.getS4LCMCFeatures().callTranslatorBotConfig.botMri}getCallTranslatorBotMriFilter(){const e=u.default.getUserPreferencesLocal().callTranslatorBotMriOverride,t=n.default.getS4LCMCFeatures().callTranslatorBotConfig.botMriFilter;return e?[e,...t]:t}setCallTranslatorBotOverride(e){c.log(r.LogTraceArea.Calling,"InCallBotMriUtils.setCallTranslatorBotOverride mri: "+p.mriOrId(e)),u.default.setUserPreferencesLocal({callTranslatorBotMriOverride:e})}clearCallTranslatorBotOverride(){c.log(r.LogTraceArea.Calling,"InCallBotMriUtils.clearCallTranslatorBotOverride"),u.default.setUserPreferencesLocal({callTranslatorBotMriOverride:void 0})}setCallTranslatorBotHideInRosterOverride(e){c.log(r.LogTraceArea.Calling,"InCallBotMriUtils.setCallTranslatorBotHideInRosterOverride hide: "+e),u.default.setUserPreferencesLocal({callTranslatorBotHideInRosterOverride:e})}getLocalCallTranslatorBotSpokenLanguageLocale(){const e=h.default.getCallTranslatorBotSpokenLanguageLocale();return e&&!a.isEmpty(e)?e:d.getLocale()}getLocalCallTranslatorBotSubtitleLanguageLocale(){const e=h.default.getCallTranslatorBotSubtitleLanguageLocale();return e&&!a.isEmpty(e)?e:this.getLocalCallTranslatorBotSpokenLanguageLocale()}isDeviceLanguageSupportedForTranslation(){return a.includes(n.default.getS4LCMCFeatures().callTranslatorBotConfig.languageSupport.speech,this.getLocalCallTranslatorBotSpokenLanguageLocale())}isConversationTranslated(e){const t=s.default().getConversation(e);return t?this.isDeviceLanguageSupportedForTranslation()&&t.getTranslationState()===o.TranslationState.Enabled:(c.log(r.LogTraceArea.Calling,"InCallBotMriUtils.isConversationTranslated invalid conversation"),!1)}getConversationTranslationState(e){const t=s.default().getConversation(e);if(t)return t.getTranslationState();c.log(r.LogTraceArea.Calling,"InCallBotMriUtils.isConversationTranslated invalid conversation")}getCallAudienceBotMri(){return u.default.getUserPreferencesLocal().callAudienceBotMriOverride||n.default.getS4LCMCFeatures().callAudienceBotConfig.botMri}getCallAudienceBotMriFilter(){const e=u.default.getUserPreferencesLocal().callAudienceBotMriOverride,t=n.default.getS4LCMCFeatures().callAudienceBotConfig.botMriFilter;return e?[e,...t]:t}getBotType(e){return a.includes(this.getCallAudienceBotMriFilter(),e)?l.BotType.Audience:a.includes(this.getCallGridViewBotMriFilter(),e)?l.BotType.GridView:a.includes(this.getCallRecorderBotMriFilter(),e)?l.BotType.Recorder:a.includes(this.getCallTranslatorBotMriFilter(),e)?l.BotType.Translator:void 0}setCallAudienceBotOverride(e){c.log(r.LogTraceArea.Calling,"InCallBotMriUtils.setCallAudienceBotOverride mri: "+p.mriOrId(e)),u.default.setUserPreferencesLocal({callAudienceBotMriOverride:e})}clearCallAudienceBotOverride(){c.log(r.LogTraceArea.Calling,"InCallBotMriUtils.clearCallAudienceBotOverride"),u.default.setUserPreferencesLocal({callAudienceBotMriOverride:void 0})}getCallGridViewBotMri(){return u.default.getUserPreferencesLocal().callGridViewBotMriOverride||n.default.getS4LCMCFeatures().callGridViewBotConfig.botMri}getCallGridViewBotMriFilter(){const e=u.default.getUserPreferencesLocal().callGridViewBotMriOverride,t=n.default.getS4LCMCFeatures().callGridViewBotConfig.botMriFilter;return e?[e,...t]:t}setCallGridViewBotOverride(e){c.log(r.LogTraceArea.Calling,"InCallBotMriUtils.setCallGridViewBotOverride mri: "+p.mriOrId(e)),u.default.setUserPreferencesLocal({callGridViewBotMriOverride:e})}clearCallGridViewBotOverride(){c.log(r.LogTraceArea.Calling,"InCallBotMriUtils.clearCallGridViewBotOverride"),u.default.setUserPreferencesLocal({callGridViewBotMriOverride:void 0})}getCallFullscreenBotMris(){return[...this.getCallAudienceBotMriFilter(),...this.getCallGridViewBotMriFilter()]}getMultiParticipantInCallBotMris(){return[...this.getCallRecorderBotMriFilter(),...this.getCallTranslatorBotMriFilter(),...this.getCallAudienceBotMriFilter(),...this.getCallGridViewBotMriFilter()]}getNonVisibleInCallBotMris(){const e=n.default.getS4LCMCFeatures().callTranslatorBotConfig.hideInRoster,t=u.default.getUserPreferencesLocal().callTranslatorBotHideInRosterOverride,i=this.getCallRecorderBotMriFilter();return!t&&e?[...i,...this.getCallTranslatorBotMriFilter()]:i}getNonInteractiveInCallBotMris(){return[...this.getCallRecorderBotMriFilter(),...this.getCallTranslatorBotMriFilter(),...this.getCallAudienceBotMriFilter(),...this.getCallGridViewBotMriFilter()]}}},1527:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.callTranslatorBotSpokenLanguageLocale=t.serviceGridViewBotUri=t.serviceAudienceBotUri=t.stateVersion=t.serviceUri=t.timestamp=t.participantIsAlexa=t.initiatorUserMri=t.participantNotIsVideoCapable=t.participantIsCapturingCallMedia=t.participantHasEndpointMetadata=t.participantSupportsCallMediaCaptureNotifications=t.participantSupportsCallRecording=t.participantSupportsCallingReactions=t.getLocalUserSupportsServerMuteUnmute=t.participantSupportsServerMute=void 0;const a=i(1),n=i(123),o=i(999),s=i(20);function r(e,t,i){return d(e,e=>{const n=a.find(e,e=>!!e.endpointMetadata&&!!e.endpointMetadata.services);if(n){const e=n.endpointMetadata.services;return a.find(e,e=>e.id===t&&e.version===i)}})}function l(e,t){return!!e&&(!!e.endpoints&&a.some(e.endpoints.endpointDetails,e=>!!e.endpointMetadata&&t(e.endpointMetadata)))}function c(e,t){return!!n.default.isParticipantConnected(e)&&l(e,t)}function d(e,t){if(e&&e.endpoints&&n.default.isParticipantConnected(e))return t(e.endpoints.endpointDetails)}function u(e,t){return!!e&&a.some(e,e=>!!e.capabilities&&t(e.capabilities))}t.participantSupportsServerMute=function(e){return function(e,t){if(!n.default.isParticipantConnected(e))return!1;if(!e)return!1;if(!e.endpoints)return!1;return u(e.endpoints.endpointDetails,t)}(e,e=>"enabled"===e.serverMuteUnmute)},t.getLocalUserSupportsServerMuteUnmute=function(e){return u(e,e=>"enabled"===e.serverMuteUnmute)},t.participantSupportsCallingReactions=function(e){return c(e,e=>!!e.reactionsEnabled)},t.participantSupportsCallRecording=function(e){return c(e,e=>!!e.supportsCallRecording)},t.participantSupportsCallMediaCaptureNotifications=function(e){return c(e,e=>!!e.supportsNotifyCallMediaCaptured)},t.participantHasEndpointMetadata=function(e){return l(e,e=>!0)},t.participantIsCapturingCallMedia=function(e){return c(e,e=>!!e.isCallMediaCaptured)},t.participantNotIsVideoCapable=function(e){return c(e,e=>!a.isUndefined(e.isVideoCapable)&&!e.isVideoCapable)},t.initiatorUserMri=function(e){return d(e,e=>{const t=a.find(e,e=>!!e.endpointMetadata&&!!e.endpointMetadata.initiatorUserId);return t?t.endpointMetadata.initiatorUserId:void 0})},t.participantIsAlexa=function(e){return!!d(e,e=>a.some(e,e=>{if(!e)return!1;const t=o.SkypeVersionParser.parse(e.clientVersion);return!!t&&s.default.isAlexaPlatformId(t.platformId)}))},t.timestamp=function(e){return d(e,e=>{const t=a.find(e,e=>!!e.endpointMetadata&&!!e.endpointMetadata.timestamp);return t?t.endpointMetadata.timestamp:void 0})},t.serviceUri=function(e,t,i){const a=r(e,t,i);return a?a.uri:void 0},t.stateVersion=function(e,t,i){const a=r(e,t,i);return a?a.stateVersion:void 0},t.serviceAudienceBotUri=function(e){return d(e,e=>{var t,i;const n=a.find(e,e=>!!e.endpointMetadata&&!!e.endpointMetadata.metadata&&!!e.endpointMetadata.metadata.serviceUri);return n?null===(i=null===(t=n.endpointMetadata)||void 0===t?void 0:t.metadata)||void 0===i?void 0:i.serviceUri:void 0})},t.serviceGridViewBotUri=function(e){return d(e,e=>{var t,i;const n=a.find(e,e=>!!e.endpointMetadata&&!!e.endpointMetadata.metadata&&!!e.endpointMetadata.metadata.serviceUri);return n?null===(i=null===(t=n.endpointMetadata)||void 0===t?void 0:t.metadata)||void 0===i?void 0:i.serviceUri:void 0})},t.callTranslatorBotSpokenLanguageLocale=function(e){return d(e,e=>{const t=a.find(e,e=>!!e.endpointMetadata&&!!e.endpointMetadata.callTranslatorBotSpokenLanguageLocale);return t?t.endpointMetadata.callTranslatorBotSpokenLanguageLocale:void 0})}},1539:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(3161),n=i(74),o=i(1085),s=i(8),r=i(7),l=i(29),c=i(584),d=i(219),u=i(87),h=i(60),p=i(110),g=i(649),C=i(13),m=i(32),S=i(3),y=i(295),f=i(4),_=i(1102),b=i(5),v=i(140),w=i(21),T=i(84),I=i(39),P=i(19),M=i(28),k=i(204),A=i(46);var R,V,E;!function(e){e[e.Small=1]="Small",e[e.Medium=2]="Medium",e[e.Large=3]="Large"}(R||(R={})),function(e){e[e.Landscape=1]="Landscape",e[e.Portrait=2]="Portrait"}(V||(V={})),function(e){e[e.Row=1]="Row",e[e.Column=2]="Column"}(E||(E={}));class L{constructor(e,t){this.causeId=e,this.mri=t}}class B extends L{constructor(e,t,i){super(e,t),this._size=i}captureFrame(e){return a.default.createImageContext(this._size.width,this._size.height).then(e=>{let t=m.default.getDisplayableProfile(this.mri),i=t.getColor().colors,n=t.getAvatarUrl(M.AvatarSize.Large);n&&(n=k.default.getAuthenticatedUrl(n));let o={x:this._size.width/2,y:0},r={x:this._size.width/2,y:this._size.height},l={origin:{x:0,y:0},size:this._size};a.default.drawLinearGradient(e,o,i[0],r,i[1],l);const c=s.Defer();if(n)return a.default.createImageContextWithURL(n).then(n=>{if(a.default.isContextValid(n)){let t=a.default.getSize(n),i=t.width<=t.height?t.width:t.height,o=G((t.width-i)/2,(t.height-i)/2,i,i),s=G((this._size.width-200)/2,(this._size.height-200)/2,200,200),r=a.default.createPath(_.GCPathTypes.Arc);r?(r.appencArcToPath({x:this._size.width/2,y:this._size.height/2},100,0,2*Math.PI),a.default.clipPath(e,r)):f.error(S.LogTraceArea.CallingUI,"CallSnapshots.Audioparticipant captureFrame Graphics.createPath return undefined"),a.default.drawGraphicsContext(e,n,o,s)}else{const a=t.getInitials();this.renderAvatarInitialsLook(e,a,i,200)}a.default.createImageData(e,0,0,this._size.width,this._size.height).then(t=>{t?c.resolve(t):(f.error(S.LogTraceArea.CallingUI,"CallSnapshots.Audioparticipant captureFrame Graphics.createImageData return null"),c.resolve(void 0)),a.default.destroyContext(e),a.default.isContextValid(n)&&a.default.destroyContext(n)})}).catch(()=>(f.error(S.LogTraceArea.CallingUI,"CallSnapshots.Audioparticipant captureFrame Graphics.createImageContextWithURL return null"),s.Resolved(void 0))),c.promise();{const n=t.getInitials();this.renderAvatarInitialsLook(e,n,i,200),a.default.createImageData(e,0,0,this._size.width,this._size.height).then(t=>{t?c.resolve(t):(f.error(S.LogTraceArea.CallingUI,"CallSnapshots.Audioparticipant captureFrame Graphics.createImageData return null"),c.resolve(void 0)),a.default.destroyContext(e)})}return c.promise()}).catch(()=>(f.error(S.LogTraceArea.CallingUI,"CallSnapshots.Audioparticipant captureFrame Graphics.createImageContext return null"),s.Resolved(void 0)))}renderAvatarInitialsLook(e,t,i,n){let o=g.colorStringToBodyMovinRgbArray(i[0]);a.default.setFillColor(e,255,255,255,1),a.default.fillArc(e,{x:this._size.width/2,y:this._size.height/2},n/2,0,2*Math.PI),a.default.setStrokeColor(e,Math.ceil(255*o[0]),Math.ceil(255*o[1]),Math.ceil(255*o[2]),1),a.default.setLineWidth(e,2),a.default.strokeArc(e,{x:this._size.width/2,y:this._size.height/2},n/2+1,0,2*Math.PI),a.default.setTextAlignment(e,a.HorizontalTextAlignment.Center,a.VerticalTextAlignment.Center),a.default.setFont(e,"sans-serif",n/4,!0),a.default.setFillColor(e,Math.ceil(255*o[0]),Math.ceil(255*o[1]),Math.ceil(255*o[2]),1),a.default.fillText(e,t,this._size.width/2,this._size.height/2)}}class O extends L{constructor(e,t,i){super(e,t),this._renderer=i}captureFrame(e){return s.fromThenable(this._renderer.captureFrame(e))}}class D{constructor(){this._offset={x:0,y:0},this._size={width:0,height:0},this._sizeScale=1}setSize(e){this._size=e}getSize(){return this._size}setOffset(e){this._offset=e}getOffset(){return this._offset}setSizeScale(e){this._sizeScale=e}concatSizeScale(e){this.setSizeScale(this.getSizeScale()*e)}getSizeScale(){return this._sizeScale}getRenderRectangle(){return G(this._offset.x*this._sizeScale,this._offset.y*this._sizeScale,this._size.width*this._sizeScale,this._size.height*this._sizeScale)}}class x extends D{constructor(e,t,i,a,n){super(),this._boxes=[],this.constructLayout(e,t,i,a,n)}static layoutDefinition(e,t,i,a,n){return f.log(S.LogTraceArea.CallingUI,"CallSnapshots.layoutDefinition (causeId:"+e+" ; landscape count:"+i.length+" ; portrait count: "+a.length+" )"),t.layout===E.Column?new N(e,t,i,a,n):new U(e,t,i,a,n)}static chooseRenderBox(e,t,i,a){f.log(S.LogTraceArea.CallingUI,"CallSnapshots.chooseRenderBox (causeId:"+e+" ; landscape count:"+i.length+" ; portrait count: "+a.length+" )");let n=t.orientation===V.Landscape?i:a;switch(t.sizeClass){case R.Large:return n.splice(n.length-1,1)[0];case R.Medium:return n.splice(Math.floor(n.length/2),1)[0];case R.Small:return n.splice(0,1)[0]}}constructLayout(e,t,i,a,n){if(t.definitions)for(let o of t.definitions)this._boxes.push(x.layoutDefinition(e,o,i,a,n));else if(t.elements)for(let n of t.elements)this._boxes.push(x.chooseRenderBox(e,n,i,a))}boxes(){return this._boxes}render(e){a.default.saveContext(e),a.default.setTranslate(e,this.getOffset().x,this.getOffset().y);for(let t of this._boxes)t.render(e);a.default.restoreContext(e)}setSizeScale(e){for(let t of this._boxes)t.concatSizeScale(e);this.doLayout()}doLayout(){for(let e of this._boxes)e.doLayout()}}class N extends x{doLayout(){super.doLayout();let e=0,t=-1;for(let i of this.boxes())i.getRenderRectangle().size.width>e&&(e=i.getRenderRectangle().size.width),(-1===t||i.getRenderRectangle().size.width<t)&&(t=i.getRenderRectangle().size.width);let i=(e-(e-t)/2)*this.getSizeScale();if(t!==e)for(let e of this.boxes()){let t=i/e.getRenderRectangle().size.width;e.concatSizeScale(t)}let a=0;for(let e of this.boxes())e.setOffset({x:0,y:a}),a+=e.getRenderRectangle().size.height;this.setSize({width:i,height:a})}}class U extends x{doLayout(){super.doLayout();let e=0,t=-1;for(let i of this.boxes())i.getRenderRectangle().size.height>e&&(e=i.getRenderRectangle().size.height),(-1===t||i.getRenderRectangle().size.height<t)&&(t=i.getRenderRectangle().size.height);let i=(e-(e-t)/2)*this.getSizeScale();if(t!==e)for(let e of this.boxes()){let t=i/e.getRenderRectangle().size.height;e.concatSizeScale(t)}let a=0;for(let e of this.boxes())e.setOffset({x:a,y:0}),a+=e.getRenderRectangle().size.width;this.setSize({width:a,height:i})}}class F extends D{constructor(e){super(),this._videoFrame=e,this._renderRect=this._computeRenderRect(),this.setSize({width:this._renderRect.size.width,height:this._renderRect.size.height})}isLandscape(){return this._videoFrame.getSize().width>=this._videoFrame.getSize().height}_computeRenderRect(){let e={origin:{x:0,y:0},size:{width:0,height:0}},t=this._videoFrame.getSize();if(this.isLandscape()){let i=4,a=3;e.size.width=t.width,e.size.height=a/i*e.size.width,e.size.height>t.height&&(e.size.height=t.height,e.size.width=i/a*e.size.height)}else{let i=3,a=4;e.size.height=t.height,e.size.width=i/a*e.size.height,e.size.width>t.width&&(e.size.width=t.width,e.size.height=a/i*e.size.width)}return e.origin.x=(t.width-e.size.width)/2,e.origin.y=(t.height-e.size.height)/2,e}renderRect(){return this._renderRect}doLayout(){}render(e){a.default.drawImage(e,this._videoFrame,this._renderRect.origin.x,this._renderRect.origin.y,this._renderRect.size.width,this._renderRect.size.height,this.getOffset().x,this.getOffset().y,this._renderRect.size.width*this.getSizeScale(),this._renderRect.size.height*this.getSizeScale())}}class H extends F{_computeRenderRect(){let e=this._videoFrame.getSize();return{origin:{x:0,y:0},size:{width:e.width,height:e.height}}}}class z{static takeSnapshot(e,t,i,a,o,c){f.log(S.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot causeId: "+e+" callId: "+t);const h=d.default.getStageMode(t);let g,C=[],m=[],y=0,_=!1;const b=l.default.CallingStore.isConnectedAudienceBotInCall(t),v=l.default.CallingStore.isConnectedGridViewBotInCall(t),T=b&&p.CallUIUtils.isTogetherMode(h),M=v&&p.CallUIUtils.isLargeGrid(h);if(M){const i=l.default.CallingStore.getConnectedGridViewBotMriInCall(t);i&&(z.addVideoParticipantForMri(t,i,m,e),_=!0)}else if(T){const i=l.default.CallingStore.getConnectedAudienceBotMriInCall(t);i&&(z.addVideoParticipantForMri(t,i,m,e),_=!0)}else{for(g=0;g<o.length&&!_;g++){let i=l.default.CallingStore.getBestStreamForMri(t,o[g],n.StreamType.ScreenSharing);if(i){y++;let a=l.default.CallingStore.getRemoteStreamRenderer(t,o[g],i);if(void 0!==a){let t=new O(e,o[g],a);m.push(t),_=!0}}else f.log(S.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot failed to find remote stream causeId: "+e+" callId: "+t+" mri: "+I.mriOrId(o[g]))}if(!_)for(g=0;g<o.length;g++){let i=l.default.CallingStore.getBestStreamForMri(t,o[g],n.StreamType.Video);if(i){let a=l.default.CallingStore.getRemoteStreamRenderer(t,o[g],i);if(a){let t=new O(e,o[g],a);m.push(t)}else{let t={width:600,height:450},i=new B(e,o[g],t);C.push(i)}}else{f.log(S.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot failed to find remote video streamNaN causeId: "+e+" callId: "+t+" mri: "+I.mriOrId(o[g]));let i={width:600,height:450},a=new B(e,o[g],i);C.push(a)}}}f.log(S.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot participation -  causeId: "+e+" callId: "+t+" total audio only "+C.length+" total video "+(m.length-y)+" total screen sharing "+y),u.default.updateCallTelemetry(t,e,e=>e.setPhotoSnapshotMakeup(C.length,m.length-y,y)),r.default.getS4LCMCFeatures().enableSnapshotNotification&&z.postNotification(e,t,i,a),f.log(S.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot rendering participants -  causeId: "+e);let k=[];this.getLocalRenderer(t).then(i=>{if(!_&&!M&&!T)if(i&&i.captureFrame)try{k.push(s.fromThenable(i.captureFrame(this.sCaptureTimeoutMS)))}catch(t){f.log(S.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot localRenderer.captureFrame "+P.default.errorAsString(t)+" causeId: "+e)}else f.log(S.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot no local renderer frame capture -  causeId: "+e);for(g=0;g<m.length&&k.length<z.sMaxParticipants;g++){const t=m[g];try{k.push(t.captureFrame(this.sCaptureTimeoutMS))}catch(t){f.log(S.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot aParticipant.captureFrame "+P.default.errorAsString(t)+" causeId: "+e)}}s.all(k.map(e=>e.catch(e=>e))).then(i=>{let a=[];for(let t of i)t&&t.getSize?a.push(t):t?f.log(S.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot error rendering a frame -  causeId: "+e+" error: "+t):f.log(S.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot null return rendering a frame -  causeId: "+e);if(a.length>0)this.renderAndPost(e,t,c,a,_);else{let i=[],a={width:600,height:450},n=new B(e,w.default.getSkypeMri(),a);i.push(n.captureFrame(this.sCaptureTimeoutMS));for(let e of C)i.length<z.sMaxParticipants&&i.push(e.captureFrame(this.sCaptureTimeoutMS));s.all(i.map(e=>e.catch(e=>e))).then(i=>{let a=[];for(let t of i)t?a.push(t):a.length<z.sMaxParticipants&&f.log(S.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot error rendering a frame -  causeId: "+e+" error: "+t);a.length>0&&this.renderAndPost(e,t,c,a,_)})}})})}static addVideoParticipantForMri(e,t,i,a){const o=l.default.CallingStore.getBestStreamForMri(e,t,n.StreamType.Video);if(o){const n=l.default.CallingStore.getRemoteStreamRenderer(e,t,o);if(n){let e=new O(a,t,n);i.push(e)}else f.error(S.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot large grid or together mode renderer is "+n)}else f.error(S.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot large grid or together mode stream is "+o)}static renderAndPost(e,t,i,a,n){let o,s=[],r=[];for(o=0;o<a.length;o++){let i=a[o];if(i){let e=i.getSize();if(!e||e.width<=0||e.height<=0)return void f.error(S.LogTraceArea.CallingUI,"CallSnapshots.renderAndPost frameSize is illegel"+e);f.log(S.LogTraceArea.CallingUI,"CallSnapshots.renderAndPost frame: #"+o+" width: "+e.width+"height: "+e.height),e.width>=e.height?r.push(n?new H(i):new F(i)):s.push(n?new H(i):new F(i))}else f.log(S.LogTraceArea.CallingUI,"CallSnapshots.renderAndPost missing frame @ #"+o+" -  causeId: "+e+" callId: "+t)}let l=this.layoutComposition(e,r.length,s.length,0,0);l&&this.processMoment(e,t,i,l,r,s)}static postNotification(e,t,i,a){const n=A.default.getFullUserProfileByMri(w.default.getSkypeMri()),o={reactionInfo:{type:h.ReactionsItemType.Snapshot,key:b.getString("CallPanel.SnapshotNotification",{name:n.getDisplayName()})},causeId:e,postSource:S.PostSource.SnapshotNotification,callId:t,conversationMri:i,reactionsConversationMri:a,logTraceArea:S.LogTraceArea.CallingUI};c.CallReactionPostingHelpers.postReaction(o)}static processMoment(e,t,i,n,s,r){f.log(S.LogTraceArea.CallingUI,"CallSnapshots.processMoment (causeId:"+e+" ; landscape count:"+s.length+" ; portrait count: "+r.length+" )"),s=s.sort((e,t)=>e.getSize().width>t.getSize().width?1:e.getSize().width<t.getSize().width?-1:0),r=r.sort((e,t)=>e.getSize().height>t.getSize().height?1:e.getSize().height<t.getSize().height?-1:0);let l=x.layoutDefinition(e,n,s,r,{origin:{x:0,y:0},size:{width:0,height:0}});if(l.doLayout(),l.getRenderRectangle().size.width>this.sMaxDim){let e=this.sMaxDim/l.getRenderRectangle().size.width;l.concatSizeScale(e)}if(l.getRenderRectangle().size.height>this.sMaxDim){let e=this.sMaxDim/l.getRenderRectangle().size.height;l.concatSizeScale(e)}let c=!1;a.default.createImageContext(l.getSize().width,l.getSize().height).then(e=>{l.render(e);const n=this.getWatermarkSize(l.getSize().width,l.getSize().height),s=o.Collection.SKYPE_ASSETS_LIGHT;f.log(S.LogTraceArea.CallingUI,"CallSnapshots.processMoment with logo size as "+n+" font "+s),a.default.setFont(e,s,n,!1),a.default.setFillColor(e,255,255,255,.2),a.default.fillText(e,"",n/2,l.getSize().height-n/2),a.default.createFileData(e,this.getSnapshotFileName()+".jpeg",n=>{n?T.default.postUploadAndShowFeedbackToast(i,n,S.PostSource.CallMoments,!1,t):(c=!0,f.error(S.LogTraceArea.CallingUI,"CallSnapshots.processMoment Graphics.createFileData return null data")),a.default.destroyContext(e)})}).catch(t=>{c=!0,f.error(S.LogTraceArea.CallingUI,"CallSnapshots.processMoment failed to create context with error"+P.default.errorAsString(t)+" ( causeId:"+e+" )")}).finally(()=>{c&&v.default.scheduleTextMessage(b.getString("CallPanel.SnapshotFailureMiniToast"),void 0,C.MainRootViewId)})}static getSnapshotFileName(){const e=new Date(Date.now()),t="Skype-"+y.getISO8601Date(e)+"-"+y.getISO8601Time(e);return t===this.lastSnapshotFileName?(this.lastSnapshotFileName=t,t+"-"+ ++this.counterForSnapshotIn1S):(this.counterForSnapshotIn1S=0,this.lastSnapshotFileName=t,t)}static getWatermarkSize(e,t){return e>t?t/10:e/10}static getLocalRenderer(e){return l.default.CallControlsStore.isProvidingVideo(e)?s.Resolved(l.default.CallingStore.getVideoPreviewRenderer(e)):s.Resolved(void 0)}static layoutComposition(e,t,i,a,n){return f.log(S.LogTraceArea.CallingUI,"CallSnapshots.layoutComposition (causeId:"+e+" ; landscape:"+t+" ; portraitCount: "+i+")"),1===t&&0===i&&0===a&&0===n?{landscape:t,portrait:i,layout:E.Column,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Large}]}:2===t&&0===i&&0===a&&0===n?{landscape:t,portrait:i,layout:E.Column,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Large},{position:2,orientation:V.Landscape,sizeClass:R.Large}]}:3===t&&0===i&&0===a&&0===n?{landscape:t,portrait:i,layout:E.Column,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Large},{position:1,orientation:V.Landscape,sizeClass:R.Large},{position:2,orientation:V.Landscape,sizeClass:R.Large}]}:0===t&&1===i&&0===a&&0===n?{landscape:t,portrait:i,layout:E.Row,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Large}]}:0===t&&2===i&&0===a&&0===n?{landscape:t,portrait:i,layout:E.Row,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Medium},{position:1,orientation:V.Portrait,sizeClass:R.Medium}]}:0===t&&3===i&&0===a&&0===n?{landscape:t,portrait:i,layout:E.Row,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Medium},{position:1,orientation:V.Portrait,sizeClass:R.Medium},{position:2,orientation:V.Portrait,sizeClass:R.Medium}]}:1===t&&1===i&&0===a&&0===n?{landscape:t,portrait:i,layout:E.Column,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Large},{position:1,orientation:V.Landscape,sizeClass:R.Medium}]}:2===t&&1===i&&0===a&&0===n?{landscape:t,portrait:i,layout:E.Row,definitions:[{landscape:2,portrait:0,layout:E.Column,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Small},{position:1,orientation:V.Landscape,sizeClass:R.Small}]},{landscape:0,portrait:1,layout:E.Column,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Medium}]}]}:3===t&&1===i&&0===a&&0===n?{landscape:t,portrait:i,layout:E.Row,definitions:[{landscape:1,portrait:1,layout:E.Column,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Large},{position:1,orientation:V.Landscape,sizeClass:R.Medium}]},{landscape:2,portrait:0,layout:E.Column,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Medium},{position:1,orientation:V.Landscape,sizeClass:R.Medium}]}]}:2===t&&3===i&&0===a&&0===n?{landscape:t,portrait:i,layout:E.Column,definitions:[{landscape:1,portrait:2,layout:E.Row,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Medium},{position:1,orientation:V.Portrait,sizeClass:R.Small},{position:2,orientation:V.Portrait,sizeClass:R.Small}]},{landscape:1,portrait:1,layout:E.Row,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Large},{position:1,orientation:V.Portrait,sizeClass:R.Small}]}]}:3===t&&2===i&&0===a&&0===n?{landscape:t,portrait:i,layout:E.Row,definitions:[{landscape:0,portrait:2,layout:E.Column,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Medium},{position:1,orientation:V.Portrait,sizeClass:R.Medium}]},{landscape:3,portrait:0,layout:E.Column,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Medium},{position:1,orientation:V.Landscape,sizeClass:R.Medium},{position:2,orientation:V.Landscape,sizeClass:R.Medium}]}]}:1===t&&2===i&&0===a&&0===n?{landscape:t,portrait:i,layout:E.Column,definitions:[{landscape:0,portrait:2,layout:E.Row,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Small},{position:1,orientation:V.Portrait,sizeClass:R.Small}]},{landscape:1,portrait:0,layout:E.Row,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Medium}]}]}:2===t&&2===i&&0===a&&0===n?{landscape:t,portrait:i,layout:E.Row,definitions:[{landscape:1,portrait:1,layout:E.Column,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Small},{position:1,orientation:V.Portrait,sizeClass:R.Medium}]},{landscape:1,portrait:1,layout:E.Column,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Medium},{position:1,orientation:V.Landscape,sizeClass:R.Small}]}]}:1===t&&3===i&&0===a&&0===n?{landscape:t,portrait:i,layout:E.Column,definitions:[{landscape:1,portrait:1,layout:E.Row,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Small},{position:1,orientation:V.Landscape,sizeClass:R.Medium}]},{landscape:0,portrait:2,layout:E.Row,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Medium},{position:1,orientation:V.Portrait,sizeClass:R.Medium}]}]}:0===t&&4===i&&0===a&&0===n?{landscape:t,portrait:i,layout:E.Column,definitions:[{landscape:0,portrait:2,layout:E.Row,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Medium},{position:1,orientation:V.Portrait,sizeClass:R.Medium}]},{landscape:0,portrait:2,layout:E.Row,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Medium},{position:1,orientation:V.Portrait,sizeClass:R.Medium}]}]}:4===t&&0===i&&0===a&&0===n?{landscape:t,portrait:i,layout:E.Column,definitions:[{landscape:2,portrait:0,layout:E.Row,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Medium},{position:1,orientation:V.Landscape,sizeClass:R.Medium}]},{landscape:2,portrait:0,layout:E.Row,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Medium},{position:1,orientation:V.Landscape,sizeClass:R.Medium}]}]}:4===t&&1===i&&0===a&&0===n?{landscape:t,portrait:i,layout:E.Row,definitions:[{landscape:1,portrait:1,layout:E.Column,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Large},{position:1,orientation:V.Landscape,sizeClass:R.Medium}]},{landscape:3,portrait:0,layout:E.Column,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Medium},{position:1,orientation:V.Landscape,sizeClass:R.Medium},{position:2,orientation:V.Landscape,sizeClass:R.Medium}]}]}:1===t&&4===i&&0===a&&0===n?{landscape:t,portrait:i,layout:E.Column,definitions:[{landscape:0,portrait:3,layout:E.Row,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Medium},{position:1,orientation:V.Portrait,sizeClass:R.Medium},{position:2,orientation:V.Portrait,sizeClass:R.Medium}]},{landscape:1,portrait:1,layout:E.Row,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Large},{position:1,orientation:V.Portrait,sizeClass:R.Medium}]}]}:0===t&&5===i&&0===a&&0===n?{landscape:t,portrait:i,layout:E.Row,definitions:[{landscape:0,portrait:3,layout:E.Column,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Small},{position:1,orientation:V.Portrait,sizeClass:R.Small},{position:2,orientation:V.Portrait,sizeClass:R.Small}]},{landscape:0,portrait:2,layout:E.Column,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Medium},{position:1,orientation:V.Portrait,sizeClass:R.Small}]}]}:5===t&&0===i&&0===a&&0===n?{landscape:t,portrait:i,layout:E.Column,definitions:[{landscape:3,portrait:0,layout:E.Row,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Small},{position:1,orientation:V.Landscape,sizeClass:R.Small},{position:2,orientation:V.Landscape,sizeClass:R.Small}]},{landscape:2,portrait:0,layout:E.Row,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Medium},{position:1,orientation:V.Landscape,sizeClass:R.Small}]}]}:void f.log(S.LogTraceArea.CallingUI,"CallStageView.layoutComposition: Failed to provide layout for "+t+", "+i)}}function G(e,t,i,a){return{origin:{x:Math.ceil(e),y:Math.ceil(t)},size:{width:Math.ceil(i),height:Math.ceil(a)}}}t.default=z,z.sMaxDim=1920,z.sCaptureTimeoutMS=7500,z.sMaxParticipants=5,z.lastSnapshotFileName="",z.counterForSnapshotIn1S=0},1546:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MobileScreenShareToggleCommand=void 0;i(3168);const a=i(29),n=i(87),o=i(3),s=i(4),r=i(5),l=i(48),c=i(10);t.MobileScreenShareToggleCommand=class{constructor(e){this._callInfo=e}canExecute(){const e=a.default.DeviceStore.getAvailableScreens();return e&&e.length>0&&a.default.CallingFeaturesHelper.allowMobileScreenSharing(this._callInfo)}execute(){const e=this._callInfo.callId;if(!e)return;const t=c.default.newCauseId(),i=a.default.CallingStore.isScreenSharing(e);if(s.log(o.LogTraceArea.CallingUI,`ScreenShareToggleCommand isScreenShareActive:${i}; callId: ${e}; causeId: ${t}`),i)a.default.CallingStore.stopScreenSharing(e,t),n.default.updateCallTelemetry(e,t,e=>e.stopScreenSharing()),l.default.maybeAnnounceForAccessibility(r.getString("AccessibilityLabel.ScreenShareStopped"));else{const i=a.default.DeviceStore.getAvailableScreens();if(i&&i.length>0){(()=>{a.default.CallingStore.startScreenSharing(e,t,i[0],!1),n.default.updateCallTelemetry(e,t,e=>e.startScreenSharing()),l.default.maybeAnnounceForAccessibility(r.getString("AccessibilityLabel.ScreenShareStarted"))})()}else s.error(o.LogTraceArea.CallingUI,"No screens are available for sharing")}}}},1589:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(73),n=i(74),o=i(7),s=i(123),r=i(103),l=i(88),c=i(17),d=i(32),u=i(3),h=i(4),p=i(5),g=i(129),C=i(82),m=i(324),S=i(224),y=i(11),f=i(28);class _{constructor(){this._endedCalls={},this._unknownReasonTimestamps=[]}test_reset(){this._endedCalls={},this._unknownReasonTimestamps=[]}reportUnansweredCallActionTaken(e,t,i,a){const n=this._endedCalls[e];n?(h.log(u.LogTraceArea.UnansweredCall,"Reporting UCUX action callId: "+n.callId+" reason: "+r.UnansweredCallReason[t]+" action: "+r.UnansweredCallAction[i]+" causeId: "+n.causeId),delete this._endedCalls[e],h.track(new l.UnansweredCallActionEvent(e,S.default.CallingNodeId.get(),n.terminatedReason,n.failureType,t,i))):h.warn(u.LogTraceArea.UnansweredCall,"Attempted to report result of UCUX for unknown callId: "+e+" causeId: "+a)}unansweredCallOptionsParticipant(e,t){const i=this._reasonForAddParticipantFailedInfo(e);if(i!==r.UnansweredCallReason.None)return{reason:i,actions:_._actionsForUnansweredCall(i,e.conversationMri,!1),title:p.getString("PstnUtils.UnableToAddParticipant"),optionalSecondaryMessage:_._titleForUnansweredCall(i,e.participantInfo.mri),originalCallId:e.callId,originalConversationMri:e.conversationMri,visualInfo:_._visualInfoForUnasnweredCall(i)};h.log(u.LogTraceArea.UnansweredCall,"Skipping UCUX in participant flow - callId: "+e.callId+" ParticipantStateReason: "+n.ParticipantStateReason[e.participantInfo.reason]+" causeId: "+t)}unansweredCallOptions(e,t){if(e.terminatedReason!==n.TerminatedReason.Kicked&&!e.isCallCreator&&(e.terminatedReason!==n.TerminatedReason.CallSetupError||t.hasMicrophones))return void h.log(u.LogTraceArea.UnansweredCall,"Skipping UCUX - user is not call creator and TerminatedReason is NOT Kicked callId: "+e.callId+" causeId: "+e.causeId);if(t.isPreheatedAndNotJoined)return void h.log(u.LogTraceArea.UnansweredCall,"Skipping UCUX - was preheating callId: "+e.callId+" causeId: "+e.causeId);const i=this._reasonForCallEndedInfo(e,t);if(i!==r.UnansweredCallReason.None)return h.log(u.LogTraceArea.UnansweredCall,"Computed UCUX result callId: "+e.callId+" reason: "+r.UnansweredCallReason[i]+" causeId: "+e.causeId),this._endedCalls[e.callId]=e,{reason:i,actions:_._actionsForUnansweredCall(i,e.conversationMri,this._showSendFeedbackOption()),title:_._titleForUnansweredCall(i,e.conversationMri),originalCallId:e.callId,originalConversationMri:e.conversationMri,visualInfo:_._visualInfoForUnasnweredCall(i),optionalSecondaryMessage:_._secondaryMessageForUnansweredCall(i,t)};h.log(u.LogTraceArea.UnansweredCall,"Skipping UCUX - success callId: "+e.callId+" causeId: "+e.causeId)}kickCallOptions(e,t){const i=r.UnansweredCallReason.Kicked;return h.log(u.LogTraceArea.UnansweredCall,"Computed kick UCUX result callId: "+e.callId+" reason: "+r.UnansweredCallReason[i]+" causeId: "+e.causeId),this._endedCalls[e.callId]=e,{reason:i,actions:[{action:r.UnansweredCallAction.None}],title:_._titleForUnansweredCall(i,e.conversationMri,t),originalCallId:e.callId,originalConversationMri:e.conversationMri,visualInfo:_._visualInfoForUnasnweredCall(i)}}_resetUnknownReasonCounter(){this._unknownReasonTimestamps=[]}_incrementUnknownReasonCounter(e){this._unknownReasonTimestamps.push(e)}_showSendFeedbackOption(){const e=this._unknownReasonTimestamps.length;if(g.default.isChild()||e<3)return!1;const t=this._unknownReasonTimestamps.slice(e-3,e);return(t[2]-t[0])/1e3<=300}_reasonForAddParticipantFailedInfo(e){let t=r.UnansweredCallReason.None;switch(e.participantInfo.reason){case n.ParticipantStateReason.PstnSkypeoutAccountBlocked:t=r.UnansweredCallReason.PstnSkypeoutAccountBlocked;break;case n.ParticipantStateReason.PstnCouldNotConnectToSkypeProxy:t=r.UnansweredCallReason.PstnCouldNotConnectToSkypeProxy;break;case n.ParticipantStateReason.PstnBlockedByUs:t=r.UnansweredCallReason.PstnBlockedByUs;break;case n.ParticipantStateReason.PstnNumberForbidden:t=r.UnansweredCallReason.PstnNumberForbidden;break;case n.ParticipantStateReason.PstnCallTerminated:t=r.UnansweredCallReason.PstnCallTerminated;break;case n.ParticipantStateReason.PstnNumberUnavailable:t=r.UnansweredCallReason.PstnNumberUnavailable;break;case n.ParticipantStateReason.Declined:case n.ParticipantStateReason.Busy:t=r.UnansweredCallReason.DeclineParticipant;break;case n.ParticipantStateReason.PstnInsufficientFunds:case n.ParticipantStateReason.PstnNoSubscriptionCover:case n.ParticipantStateReason.PstnCreditExpired:case n.ParticipantStateReason.PstnCreditExpiredButEnough:t=r.UnansweredCallReason.InsufficientFunds;break;case n.ParticipantStateReason.PstnBlockedRegulatoryIndia:t=r.UnansweredCallReason.BlockedRegulatoryIndia;break;case n.ParticipantStateReason.PstnInvalidNumber:t=r.UnansweredCallReason.InvalidNumber}return s.default.isPstnNetherlandsReason(e.participantInfo.callEndDiagnosticsInfo)&&(t=r.UnansweredCallReason.BlockedRegulatoryNetherlands),t}_reasonForCallEndedInfo(e,t){const i=e.failureType===n.FailureType.CallSetupFailed||0===e.durationSeconds&&e.failureType!==n.FailureType.CallDropped,o=(Date.now()-t.callCreationTime)/1e3;let s=r.UnansweredCallReason.Unknown;switch(e.terminatedReason){case n.TerminatedReason.Success:s=c.isThread(e.conversationMri)&&0===t.maxConnectedParticipants?r.UnansweredCallReason.NoAnswer:r.UnansweredCallReason.None;break;case n.TerminatedReason.Cancelled:s=o>15?r.UnansweredCallReason.NoAnswer:r.UnansweredCallReason.None;break;case n.TerminatedReason.NoNgcEndpoint:case n.TerminatedReason.NoSignalingFromPeer:case n.TerminatedReason.TemporarilyUnavailable:s=r.UnansweredCallReason.Unreachable;break;case n.TerminatedReason.NetworkError:case n.TerminatedReason.MediaDroppedError:case n.TerminatedReason.LocalHttpStackError:case n.TerminatedReason.NetworkRequestTimeoutError:case n.TerminatedReason.CannotConnectToNetworkError:case n.TerminatedReason.CallSetupError:case n.TerminatedReason.MediaRelayWhiteListingIssue:s=e.terminatedReason!==n.TerminatedReason.CallSetupError||t.hasMicrophones?i?r.UnansweredCallReason.LocalNetworkError:r.UnansweredCallReason.None:r.UnansweredCallReason.NoMicrophoneDetected;break;case n.TerminatedReason.PstnSkypeoutAccountBlocked:s=r.UnansweredCallReason.PstnSkypeoutAccountBlocked;break;case n.TerminatedReason.PstnCouldNotConnectToSkypeProxy:s=r.UnansweredCallReason.PstnCouldNotConnectToSkypeProxy;break;case n.TerminatedReason.PstnBlockedByUs:s=r.UnansweredCallReason.PstnBlockedByUs;break;case n.TerminatedReason.PstnNumberForbidden:s=r.UnansweredCallReason.PstnNumberForbidden;break;case n.TerminatedReason.PstnCallTerminated:s=r.UnansweredCallReason.PstnCallTerminated;break;case n.TerminatedReason.PstnNumberUnavailable:s=r.UnansweredCallReason.PstnNumberUnavailable;break;case n.TerminatedReason.NoPermission:const l=C.default.permissionStatus(f.PermissionType.Microphone)===a.PermissionStatus.Granted,d=C.default.permissionStatus(f.PermissionType.Camera)===a.PermissionStatus.Granted;if(!e.withVideo||l||d)if(l)if(d){const e="TerminatedReason.NoPermission, yet cannot identify what permissions are lacking";h.error(u.LogTraceArea.UnansweredCall,e)}else{const e="Never show 'CameraPermissionDenied' if 'withVideo' is false";h.error(u.LogTraceArea.UnansweredCall,e),s=r.UnansweredCallReason.CameraPermissionDenied}else s=r.UnansweredCallReason.MicrophonePermissionDenied;else s=r.UnansweredCallReason.MicAndCamPermissionDenied;break;case n.TerminatedReason.Missed:s=r.UnansweredCallReason.NoAnswer;break;case n.TerminatedReason.Declined:case n.TerminatedReason.Busy:s=r.UnansweredCallReason.Decline;break;case n.TerminatedReason.PstnInvalidNumber:s=r.UnansweredCallReason.InvalidNumber;break;case n.TerminatedReason.PstnEmergencyCallDenied:s=r.UnansweredCallReason.EmergencyCallDenied;break;case n.TerminatedReason.Kicked:s=r.UnansweredCallReason.Kicked;break;case n.TerminatedReason.PstnInsufficientFunds:case n.TerminatedReason.PstnNoSubscriptionCover:case n.TerminatedReason.PstnCreditExpired:case n.TerminatedReason.PstnCreditExpiredButEnough:s=r.UnansweredCallReason.InsufficientFunds;break;case n.TerminatedReason.PstnBlockedRegulatoryIndia:s=r.UnansweredCallReason.BlockedRegulatoryIndia;break;case n.TerminatedReason.Undefined:s=r.UnansweredCallReason.None}return i||(s=r.UnansweredCallReason.None),s===r.UnansweredCallReason.Unknown?this._incrementUnknownReasonCounter(t.callCreationTime):this._resetUnknownReasonCounter(),s}static _secondaryMessageForUnansweredCall(e,t){switch(e){case r.UnansweredCallReason.NoMicrophoneDetected:return p.getString("UnansweredCallTitle.NoMicDetectedMessage");default:return}}static _titleForUnansweredCall(e,t,i){const a=d.default.getShortDisplayName(t)||p.getString("UnansweredCallTitle.UnknownCallee");switch(e){case r.UnansweredCallReason.NoAnswer:case r.UnansweredCallReason.Decline:return c.isGroupConversation(t)?p.getString("UnansweredCallTitle.NoAnswerGroup"):p.getString("UnansweredCallTitle.Decline",{name:a});case r.UnansweredCallReason.DeclineParticipant:return p.getString("UnansweredCallTitle.Decline",{name:a});case r.UnansweredCallReason.Unreachable:return p.getString("UnansweredCallTitle.Unreachable",{name:a});case r.UnansweredCallReason.LocalNetworkError:return p.getString("UnansweredCallTitle.NetworkError");case r.UnansweredCallReason.MicrophonePermissionDenied:return p.getString("UnansweredCallTitle.NoMicrophonePermission");case r.UnansweredCallReason.CameraPermissionDenied:return p.getString("UnansweredCallTitle.NoCameraPermission");case r.UnansweredCallReason.MicAndCamPermissionDenied:return p.getString("UnansweredCallTitle.NoMicAndCamPermission");case r.UnansweredCallReason.Kicked:{const e=this._getKickedPrimaryMessage(i);return e||p.getString("CallControls.RemovedFromCallMessage")}case r.UnansweredCallReason.NoMicrophoneDetected:return p.getString("UnansweredCallTitle.NoMicDetected");case r.UnansweredCallReason.EmergencyCallDenied:return p.getString("PstnUtils.EmergencyCallDenied");case r.UnansweredCallReason.BlockedRegulatoryIndia:return p.getString("PstnUtils.BlockedRegulatoryIndia");case r.UnansweredCallReason.BlockedRegulatoryNetherlands:return p.getString("PstnUtils.BlockedRegulatoryNetherlands");case r.UnansweredCallReason.PstnBlockedByUs:return p.getString("PstnUtils.BlockedByUs");case r.UnansweredCallReason.PstnSkypeoutAccountBlocked:return p.getString("PstnUtils.SkypeoutAccountBlocked");case r.UnansweredCallReason.PstnCouldNotConnectToSkypeProxy:return p.getString("PstnUtils.CouldNotConnectToSkypeProxy");case r.UnansweredCallReason.PstnNumberForbidden:return p.getString("PstnUtils.NumberForbidden");case r.UnansweredCallReason.PstnCallTerminated:return p.getString("PstnUtils.CallTerminated");case r.UnansweredCallReason.PstnNumberUnavailable:return p.getString("PstnUtils.NumberUnavailable");case r.UnansweredCallReason.InvalidNumber:return p.getString("PstnUtils.InvalidNumber");case r.UnansweredCallReason.Unknown:return p.getString("UnansweredCallTitle.OtherError")}return p.getString("UnansweredCallTitle.OtherError")}static _actionsForUnansweredCall(e,t,i){switch(e){case r.UnansweredCallReason.NoAnswer:case r.UnansweredCallReason.Unreachable:return[{action:r.UnansweredCallAction.SendMessage,prepopulatedMessage:_._chatMessagesForReason(e,t)},{action:r.UnansweredCallAction.CallPSTN}];case r.UnansweredCallReason.Decline:return[{action:r.UnansweredCallAction.SendMessage,prepopulatedMessage:_._chatMessagesForReason(e,t)}];case r.UnansweredCallReason.LocalNetworkError:return[{action:r.UnansweredCallAction.SendMessage}];case r.UnansweredCallReason.Kicked:return[{action:r.UnansweredCallAction.None}];case r.UnansweredCallReason.Unknown:const a=[{action:r.UnansweredCallAction.SendMessage,message:""}];return i?a.concat({action:r.UnansweredCallAction.SendFeedback,message:p.getString("FeedbackMechanism.FeedbackDialogTitle")}):a;case r.UnansweredCallReason.MicrophonePermissionDenied:case r.UnansweredCallReason.CameraPermissionDenied:case r.UnansweredCallReason.MicAndCamPermissionDenied:return[{action:r.UnansweredCallAction.PromptForPermission}];case r.UnansweredCallReason.BlockedRegulatoryIndia:return[{action:r.UnansweredCallAction.ShowRegulatoryInfoIndia}];case r.UnansweredCallReason.BlockedRegulatoryNetherlands:return[{action:r.UnansweredCallAction.ShowRegulatoryInfoNetherlands}]}return[]}static _chatMessagesForReason(e,t){if(!c.isThread(t))switch(e){case r.UnansweredCallReason.NoAnswer:case r.UnansweredCallReason.Decline:return p.getString("UnansweredCallChatMessages.CallMeBack")}}static _visualInfoForUnasnweredCall(e){switch(e){case r.UnansweredCallReason.Decline:case r.UnansweredCallReason.NoAnswer:case r.UnansweredCallReason.Unreachable:return{type:r.UnansweredCallVisualInfoType.Emoticon,name:"call"};case r.UnansweredCallReason.Kicked:case r.UnansweredCallReason.Unknown:return{type:r.UnansweredCallVisualInfoType.Emoticon,name:"cry"};case r.UnansweredCallReason.NoMicrophoneDetected:return{type:r.UnansweredCallVisualInfoType.Icon,name:y.SkypeIcon.MicrophoneOff};case r.UnansweredCallReason.LocalNetworkError:return{type:r.UnansweredCallVisualInfoType.Icon,name:y.SkypeIcon.CallQualityIndicator};case r.UnansweredCallReason.MicAndCamPermissionDenied:case r.UnansweredCallReason.MicrophonePermissionDenied:return{type:r.UnansweredCallVisualInfoType.Icon,name:y.SkypeIcon.MicrophoneOff};case r.UnansweredCallReason.CameraPermissionDenied:return{type:r.UnansweredCallVisualInfoType.Icon,name:y.SkypeIcon.VideoOff};case r.UnansweredCallReason.EmergencyCallDenied:return{type:r.UnansweredCallVisualInfoType.Icon,name:y.SkypeIcon.CallBlockedFilled};case r.UnansweredCallReason.BlockedRegulatoryIndia:case r.UnansweredCallReason.BlockedRegulatoryNetherlands:return{type:r.UnansweredCallVisualInfoType.Icon,name:y.SkypeIcon.CallBlockedFilled};case r.UnansweredCallReason.PstnBlockedByUs:case r.UnansweredCallReason.PstnCallTerminated:case r.UnansweredCallReason.PstnCouldNotConnectToSkypeProxy:case r.UnansweredCallReason.PstnNumberForbidden:case r.UnansweredCallReason.PstnNumberUnavailable:case r.UnansweredCallReason.PstnSkypeoutAccountBlocked:case r.UnansweredCallReason.InvalidNumber:return{type:r.UnansweredCallVisualInfoType.Icon,name:y.SkypeIcon.CallErrorFilled};case r.UnansweredCallReason.None:return}}static _getKickedPrimaryMessage(e){if(!o.default.getS4LCMCFeaturesNoSubscription().enableNotifyUsersMuteKick)return;if(!e||!m.default.isCallEventReaction(e))return;const t=m.default.parseCallEventReaction(e);if(!t)return;const i=_._getUserName(t.mri);return p.getString("CallControls.RemovedFromCallMessageWithName",{name:i})}static _getUserName(e){const t=c.sanitizeMri(e,c.Namespaces.SkypeId);return d.default.getDisplayName(t)||p.getString("Notifications.UnknownUserShort")}}const b=new _;t.default=b},1675:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ModalHeight=t.ModalWidth=t.SharingSourceSize=void 0;const a=i(28);class n{}t.SharingSourceSize=n,n.XLarge={width:960,height:576},n.Large={width:480,height:288},n.Medium={width:240,height:144},n.Small={width:160,height:90},n.XSmall={width:80,height:45};const o=n.Small.width;var s;!function(e){e[e.FourWindowsColumns=490+3*o]="FourWindowsColumns",e[e.ThreeWindowsColumns=490+2*o]="ThreeWindowsColumns",e[e.TwoWindowsColumns=490+o]="TwoWindowsColumns",e[e.OneWindowsColumn=490]="OneWindowsColumn",e[e.NoWindowsColumn=600]="NoWindowsColumn"}(s=t.ModalWidth||(t.ModalWidth={}));var r;!function(e){e[e.ThreeScreens=650]="ThreeScreens",e[e.ThreeScreensAndToggle=720]="ThreeScreensAndToggle",e[e.TwoScreens=515]="TwoScreens",e[e.TwoScreensAndToggle=585]="TwoScreensAndToggle",e[e.OneScreen=380]="OneScreen",e[e.OneScreenAndToggle=450]="OneScreenAndToggle",e[e.NoWindowsOneScreens=640]="NoWindowsOneScreens",e[e.NoWindowsTwoScreens=500]="NoWindowsTwoScreens",e[e.NoWindowsMoreThanTwoScreens=685]="NoWindowsMoreThanTwoScreens"}(r=t.ModalHeight||(t.ModalHeight={}));t.default=class{static getSourceItemDimensions(e,t,i){let a=!1;t&&e<t&&i>1&&(a=!0);let o=e/i;return o>1e3&&!a?n.XLarge:o>200?n.Large:o>90?n.Medium:n.Small}static getWindowSourceItemDimensions(){return n.Small}static getScreenSourceItemDimensions(e,t,i){return t?1===i&&e!==a.ResponsiveWidth.MinDesktop?n.Large:n.Medium:e!==a.ResponsiveWidth.MinDesktop||t?n.Small:n.XSmall}static getModalWidth(e,t,i){if(0===i)return s.NoWindowsColumn;let n,o;switch(e){case a.ResponsiveWidth.Large:n=4;break;case a.ResponsiveWidth.Medium:n=3;break;case a.ResponsiveWidth.Small:default:n=2}switch(o=2!==t||3!==i&&4!==i?i>9?4:i>6?3:i>3?2:1:2,Math.min(n,o)){case 1:return s.OneWindowsColumn;case 2:return s.TwoWindowsColumns;case 3:return s.ThreeWindowsColumns;case 4:return s.FourWindowsColumns;default:return s.OneWindowsColumn}}static getModalHeigh(e,t,i){if(0===t)return 1===e?r.NoWindowsOneScreens:2===e?r.NoWindowsTwoScreens:r.NoWindowsMoreThanTwoScreens;let a;switch(a=e>=3?3:2===e?t>4?3:e:t>=3?3:t,a){case 1:return i?r.OneScreenAndToggle:r.OneScreen;case 2:return i?r.TwoScreensAndToggle:r.TwoScreens;default:return i?r.ThreeScreensAndToggle:r.ThreeScreens}}}},1676:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(35),o=i(0),s=i(63),r=i(7),l=i(69),c=i(88),d=i(54),u=i(13),h=i(3),p=i(26),g=i(4),C=i(229),m=i(125),S=i(6),y=i(5),f=i(30),_=i(23),b=i(27),v=i(395),w=i(36),T=i(59),I=i(174),P=i(44),M=i(19),k=i(42),A=i(9),R=i(11),V=i(56),E=i(138),L=i(3457),B=i(515),O=i(3459),D=i(10),x=A.Color.gray400,N=S.lazyProperties({panel:()=>o.Styles.createViewStyle({flex:1,flexDirection:"column",alignSelf:"stretch",backgroundColor:x}),modalContainerForAll:()=>o.Styles.createViewStyle({flex:1,flexDirection:"column",alignItems:"stretch",justifyContent:"flex-start",paddingTop:0,paddingLeft:20,paddingRight:20,paddingBottom:20}),backgroundsList:()=>o.Styles.createViewStyle({flexWrap:"wrap",flexDirection:"row",justifyContent:"center"}),backgroundsListParent:()=>o.Styles.createViewStyle({flex:1,flexWrap:"wrap",flexDirection:"column",justifyContent:"center",alignSelf:"center"}),header:()=>o.Styles.createViewStyle({paddingHorizontal:10,backgroundColor:x}),titleText:()=>o.Styles.createTextStyle({color:A.Color.white}),noteText:()=>o.Styles.createTextStyle({paddingLeft:8,color:A.Color.white}),noteTextRtl:()=>o.Styles.createTextStyle({paddingRight:8,color:A.Color.white}),divider:()=>o.Styles.createViewStyle({flex:1,height:void 0,minWidth:2}),button:()=>o.Styles.createViewStyle({width:180,marginTop:5}),buttonStacked:()=>o.Styles.createViewStyle({marginTop:5}),closeButton:()=>o.Styles.createViewStyle({height:50,paddingLeft:15,paddingRight:15}),infoAndButton:()=>o.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between",alignItems:"center",marginHorizontal:10,marginTop:10}),infoAndButtonStacked:()=>o.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignItems:"center",marginHorizontal:10,marginTop:10}),infoIconAndText:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"center",marginTop:5})});class U extends l.default{constructor(){super(...arguments),this._onEscape=()=>(g.log(h.LogTraceArea.CallingUI,"TogetherModePanel._onEscape"),this._onClose(),!0),this._onClose=()=>{if(this._dismissPanel(),this.props.onClose){const e=this.props.isAudienceBotInCall;g.track(new c.TogetherModePanelActionEvent(c.TogetherModePanelActionOrigin.Cancel,e)),this.props.onClose()}},this._onBackgroundItemDoubleTap=()=>{this._applyTogetherMode()},this._onBackgroundSelected=(e,t)=>{g.log(h.LogTraceArea.CallingUI,"TogetherModePanel: _onBackgroundSelected "+M.default.asString(e.untranslatedName)),t&&this.state.isNavigatingWithKeyboard?this._requestToApplyTogetherMode():this.setState({selectedBackground:e})},this._requestToApplyTogetherMode=()=>{this.state.stackNavigation?this._showApplyConfirmationDialog():this._applyTogetherMode()}}_buildState(e,t){t&&(this._rootViewId=this._getRootViewId());const i=b.default.getWidth(this._rootViewId),n=v.default.responsiveWidthForSize(i),o=B.default.getTogetherModeBackgrounds(),s=a.first(o),l=t?e.selectedBackground||s:this.state.selectedBackground;g.log(h.LogTraceArea.CallingUI,"created new state backgroundsList "+o.length);const c=E.isAccessibleTheme(this._currentTheme),d=r.default.getS4LCMCFeatures(),u=!this._useDarkTheme()&&d.enableLightThemeOnCallStage&&d.enableNewCallScreen&&f.default.getNewCallScreenDesignEnabled(),p=_.default.isUsingStackNavigationContext(),m=u||c||p;return{backgroundsList:o,hasBackgroundsSection:o.length>0,appWidth:i,selectedBackground:l,screenSize:n,isNavigatingWithKeyboard:C.default.isNavigatingWithKeyboard(),highContrastTheme:c,stackNavigation:p,defaultTheme:m,deviceOrientation:b.default.getDeviceOrientation(this._rootViewId),safeAreaHorizontalInsets:w.default.horizontalInsets(),isTablet:V.default.isTablet()}}componentDidMount(){super.componentDidMount(),m.default.addEscapeHandler(this._onEscape)}componentWillUnmount(){super.componentWillUnmount(),m.default.removeEscapeHandler(this._onEscape)}render(){const e=this.state.deviceOrientation===n.DeviceOrientation.Portrait,t=O.default.getBackgroundItemDimensions(this.state.stackNavigation,e,this.state.isTablet),i=this.state.stackNavigation,a=O.default.getModalWidth(this.state.screenSize,this.state.backgroundsList.length),s=O.default.getModalHeight(this.state.backgroundsList.length),r=i?void 0:a,l=[N.backgroundsList,o.Styles.createViewStyle({maxWidth:r},!1)],c=o.createElement(L.default,{style:l,backgroundsList:this.state.backgroundsList,itemWidth:t.width,itemHeight:t.height,selectedBackground:this.state.selectedBackground,isNavigatingWithKeyboard:this.state.isNavigatingWithKeyboard,onItemDoubleTap:this._onBackgroundItemDoubleTap,onItemSelected:this._onBackgroundSelected,accessibilityLabel:y.getString("TogetherModeModal.Title"),highContrastTheme:this.state.highContrastTheme,stackNavigation:this.state.stackNavigation,defaultTheme:this.state.defaultTheme}),d=[N.modalContainerForAll];if(!!this.state.safeAreaHorizontalInsets&&T.default.hasHorizontalSafeAreas(this.state.safeAreaHorizontalInsets)){const e=T.default.horizontalPaddingStyle(this.state.safeAreaHorizontalInsets);d.push(e)}const u=o.createElement(o.View,{style:d},o.createElement(o.View,{style:N.backgroundsListParent},c),this._getInfoIconAndButton()),h=[N.panel];this.state.defaultTheme&&h.push(this._themeStyles.primaryBackgroundColorStyle);const p=[N.header];this.state.defaultTheme&&p.push(this._themeStyles.primaryBackgroundColorStyle);const g=this.state.defaultTheme?this._themeStyles.primaryTextColorStyle:N.titleText;return o.createElement(I.default,{dialogId:"togetherMode",onClickOutside:this._onClose,maxWidth:a,maxHeight:s,fullScreen:i,useFullSizeContainer:!0},o.createElement(o.View,{style:h},o.createElement(P.SimplePanelHeader,{panelName:this._getTitleText(),leftButton:this._getCancelButton(),style:p,titleTextStyle:g,hideBottomBorder:!this.state.stackNavigation,useCenteredControls:!0}),u))}_getCancelButton(){const e=this.state.defaultTheme?this._themeColors.headerIconColor:A.Color.white,t=this.state.defaultTheme?this._themeColors.iconHoverColor:A.Color.gray100;return{closeButtonType:P.CloseButtonType.Close,title:y.getString("Global.CloseButtonTitle"),onPress:this._onClose,color:e,hoverColor:t}}_getApplyButton(){const e=this.state.highContrastTheme?u.SXButtonStyle.ThemeFill:u.SXButtonStyle.ColorFill;return o.createElement(k.default,{title:this._getApplyButtonText(),style:this.state.stackNavigation?N.buttonStacked:N.button,buttonStyle:e,buttonSize:u.SXButtonSize.Medium,onPress:this._requestToApplyTogetherMode,disabled:!this.state.selectedBackground})}_getInfoIconAndButton(){const e=this.state.stackNavigation?N.infoAndButtonStacked:N.infoAndButton,t=[this._getContext().isRTL?N.noteTextRtl:N.noteText];this.state.defaultTheme&&t.push(this._themeStyles.primaryTextColorStyle);const i=this.state.defaultTheme?this._themeColors.headerIconColor:A.Color.white,a=this.state.stackNavigation?void 0:o.createElement(o.View,{style:N.infoIconAndText},o.createElement(p.default,{size:R.IconSize.size16,icon:R.SkypeIcon.Info,color:i}),o.createElement(o.Text,{style:t},y.getString("TogetherModeModal.AppliesToAllParticipantsNote")));return o.createElement(o.View,{style:e},a,this._getApplyButton())}_getTitleText(){const e=this.state.deviceOrientation===n.DeviceOrientation.Portrait;return this.state.stackNavigation&&!this.state.isTablet&&e?y.getString("TogetherModeModal.TitleCompact"):y.getString("TogetherModeModal.Title")}_getApplyButtonText(){const e=this.state.deviceOrientation===n.DeviceOrientation.Portrait,t=this.state.stackNavigation&&!this.state.isTablet&&e;return this.props.isAudienceBotInCall||t?y.getString("TogetherModeModal.Apply"):y.getString("TogetherModeModal.ApplyAndEnable")}_showApplyConfirmationDialog(){const e=y.getString("TogetherModeModal.ConfirmTitle"),t=y.getString("TogetherModeModal.AppliesToAllParticipantsNote"),i=[{text:y.getString("Global.CancelLabel"),isCancel:!0,onPress:()=>{}},{text:y.getString("Global.ConfirmLabel"),isSubmit:!0,style:"destructive",onPress:()=>{this._applyTogetherMode()}}];s.default.showWithOptions({title:e,dialogAccessibilityTitle:t,message:t,buttons:i,rootViewId:this._getRootViewId()})}_dismissPanel(){if(this.state.stackNavigation){const e=D.default.newCauseId();this._goBack(e)}else d.default.dismissModal(B.default.getPanelId(),this._rootViewId)}_applyTogetherMode(){const e=this.props.isAudienceBotInCall,t=this.state.selectedBackground;a.isUndefined(t)?e?g.warn(h.LogTraceArea.CallingUI,"Attempting to change Together Mode background to undefined."):g.warn(h.LogTraceArea.CallingUI,"Attempting to start Together Mode without specifying a background."):(g.track(new c.TogetherModePanelActionEvent(c.TogetherModePanelActionOrigin.Apply,e)),this._dismissPanel(),e?this.props.onChangeBackground(t):this.props.onStartTogetherMode(t))}}t.default=U},1677:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(475),o=i(13),s=i(102),r=i(42),l=i(9),c=i(12),d=i(138);class u extends c.default{constructor(){super(...arguments),this._onComponentRef=e=>{this._componentRef=e||void 0}}_buildState(e,t){let i;if(s.default.isValidNumberString(e.phoneNumber)){const t=s.default.stripPlusSign(e.phoneNumber);i=n.default.getCallRateByPhoneNumber(t)}return{callRate:i}}render(){const e=s.default.parseAndFormat(this.props.phoneNumber,s.PhoneNumberFormat.INTERNATIONAL)||this.props.phoneNumber,t={backgroundColor:d.isDarkTheme(this._currentTheme)?l.Color.gray100:l.Color.black,textColor:this._themeColors.primaryBackgroundColor,subtitleTextColor:this._themeColors.disabledTextColor};return a.createElement(r.default,{ref:this._onComponentRef,key:"callingbutton_"+this.props.phoneNumber,buttonSize:o.SXButtonSize.Large,buttonStyle:o.SXButtonStyle.Custom,icon:this.props.icon,buttonConfig:t,title:e,subtitle:this.state.callRate,accessibilityLabel:this.props.accessibilityLabel,allowTextWrap:!0,onPress:this.props.onPress})}requestFocus(){this._componentRef&&this._componentRef.requestFocus()}}t.default=u},1693:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1101),n=i(0),o=i(8),s=(i(7),i(29)),r=i(3),l=i(4),c=i(19),d=i(14),u=i(10);class h extends n.Component{constructor(){super(...arguments),this._callingVideoView=null,this._useNewVideoView=!1,this._onCallingVideoView=e=>{const t=u.default.newCauseId();this._callingVideoView=e,this._resetRenderer(t)},this._recreateRenderer=e=>(this._videoPreviewRenderer&&this._videoPreviewRenderer.dispose(e),this._callingVideoView?s.default.DeviceStore.createPreviewRenderer(this._callingVideoView.getVideoContainer(),this.props.options,this.props.device).then(e=>{this._videoPreviewRenderer=e}):o.Resolved()),this._resetRenderer=e=>{this._recreateRenderer(e)}}render(){return this._useNewVideoView&&a.VideoView?n.createElement(a.VideoView,{ref:this._onCallingVideoView}):n.createElement(a.default,{ref:this._onCallingVideoView,style:d.default.absoluteFill,isLocal:!0,parentView:h.name,nametag:this.props.nametag,localPreviewAndroidV2:this.props.localPreviewAndroidV2})}componentWillUnmount(){this._callingVideoView=null;const e=u.default.newCauseId();l.log(r.LogTraceArea.Calling,"LocalVideoPreview componentWillUnmount causeId: "+e),this._resetRenderer(e)}componentDidUpdate(e,t,i){if(this.props.device!==e.device){const e=u.default.newCauseId();l.log(r.LogTraceArea.Calling,"LocalVideoPreview device change: "+this.props.device+" causeId: "+e),this._resetRenderer(e)}}recreatePreview(e){s.LocalStreamInfo.previewPromise.chainPromise(()=>this._callingVideoView?s.default.DeviceStore.createPreviewRenderer(this._callingVideoView.getVideoContainer(),this.props.options,this.props.device).then(e=>{this._videoPreviewRenderer=e}):o.Resolved(),"LocalVideoPreview recreatePreview called",e).catch(e=>l.warn(r.LogTraceArea.Calling,"Failed to create preview "+c.default.errorAsString(e)))}}t.default=h},1696:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallParticipantTalkingView=t.CallParticipantTalkingViewSize=void 0;const a=i(0),n=i(15),o=i(7),s=i(6),r=i(190),l=i(9);var c;!function(e){e[e.CompactSmall=60]="CompactSmall",e[e.CompactLarge=100]="CompactLarge",e[e.Large=120]="Large"}(c=t.CallParticipantTalkingViewSize||(t.CallParticipantTalkingViewSize={}));const d=s.lazyProperties({compactSmall:()=>s.lazyProperties({container:()=>a.Styles.createViewStyle({height:60,width:60,overflow:"visible"}),ring:()=>a.Styles.createViewStyle({position:"absolute",top:-0,left:-0,width:60,height:60,borderRadius:30})}),compactLarge:()=>s.lazyProperties({container:()=>a.Styles.createViewStyle({height:100,width:100,overflow:"visible"}),ring:()=>a.Styles.createViewStyle({position:"absolute",top:-0,left:-0,width:100,height:100,borderRadius:50})}),large:()=>s.lazyProperties({container:()=>a.Styles.createViewStyle({height:120,width:120,overflow:"visible"}),ring:()=>a.Styles.createViewStyle({position:"absolute",top:0,left:0,width:120,height:120,borderRadius:60})}),roundedRect:()=>a.Styles.createViewStyle({borderRadius:12}),videoContainer:()=>a.Styles.createViewStyle({position:"absolute",top:-0,left:-0,bottom:-0,right:-0}),videoInnerContainer:()=>a.Styles.createViewStyle({flex:1,borderRadius:12})});class u extends n.ComponentBase{constructor(){super(...arguments),this._isTalking=!1,this._ringScaleAnimatedValue=new a.Animated.Value(1),this._ringScaleAnimatedStyle=a.Styles.createAnimatedViewStyle({transform:[{scale:this._ringScaleAnimatedValue}]}),this._defaultAnimatedColorValue=new a.Animated.Value(0),this._defaultAnimatedColorStyle=a.Styles.createAnimatedViewStyle({backgroundColor:this._defaultAnimatedColorValue.interpolate({inputRange:[0,1],outputRange:[l.Color.blackOverlay20,l.Color.white]})})}_buildState(e,t){let i={disableParticipantTalkingAnimation:o.default.getS4LCMCFeatures().disableParticipantTalkingAnimation};return t&&(i.isAnimating=!1),i}componentDidMount(){super.componentDidMount(),this._updateTalkingRing()}updateTalking(e){this._isTalking!==e&&(this._isTalking=e,this._updateTalkingRing())}_updateTalkingRing(){this._isTalking&&!this.state.isAnimating&&this._startLoopingAnimation()}_startLoopingAnimation(){this.state.disableParticipantTalkingAnimation||(this._loop(),this._updateRingColor(!0))}_loop(){this._ringScaleAnimation||(this._ringScaleAnimation=a.Animated.sequence([r.default.timing(this._ringScaleAnimatedValue,{toValue:1.12,easing:a.Animated.Easing.CubicBezier(.33,0,0,1),duration:2100,isInteraction:!1,useNativeDriver:!0}),r.default.timing(this._ringScaleAnimatedValue,{toValue:1.04,easing:a.Animated.Easing.CubicBezier(.5,0,1,1),duration:1400,isInteraction:!1,useNativeDriver:!0})])),this._ringScaleAnimation.start(e=>{this.isComponentMounted()&&e.finished&&(this._isTalking?this._loop():this._resetTalkingRing())}),this.setState({isAnimating:!0})}_updateRingColor(e){a.Animated.timing(this._defaultAnimatedColorValue,{toValue:e?1:0,easing:a.Animated.Easing.Linear(),duration:300,isInteraction:!1}).start()}_resetTalkingRing(){this._ringScaleAnimation=r.default.timing(this._ringScaleAnimatedValue,{toValue:1,easing:a.Animated.Easing.InOut(),duration:300,isInteraction:!1,useNativeDriver:!0}),this._ringScaleAnimation.start(e=>{this.isComponentMounted()&&(this._ringScaleAnimation=void 0,this._isTalking?this._startLoopingAnimation():this.setState({isAnimating:!1}))}),this._updateRingColor(!1)}render(){if(this.props.isVideo){const e=[d.videoInnerContainer];return this.props.talkingTintColor?e.push(a.Styles.createViewStyle({backgroundColor:this.props.talkingTintColor,opacity:.8},!1)):e.push(this._defaultAnimatedColorStyle),a.createElement(a.Animated.View,{style:[d.videoContainer,this._ringScaleAnimatedStyle]},a.createElement(a.Animated.View,{style:e}))}let e;e=this.props.size<=c.CompactSmall?{container:d.compactSmall.container,ring:d.compactSmall.ring}:this.props.size<=c.CompactLarge?{container:d.compactLarge.container,ring:d.compactLarge.ring}:{container:d.large.container,ring:d.large.ring};const t=[e.container,this._ringScaleAnimatedStyle],i=[e.ring];this.props.talkingTintColor?i.push(a.Styles.createViewStyle({backgroundColor:this.props.talkingTintColor,opacity:.8},!1)):i.push(this._defaultAnimatedColorStyle),this.props.useRoundedRect&&i.push(d.roundedRect);const n=[e.container];return a.createElement(a.View,{style:n},a.createElement(a.Animated.View,{style:t},a.createElement(a.Animated.View,{style:i})))}}t.CallParticipantTalkingView=u,t.default=u},1697:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(118),o=i(155),s=i(331),r=i(3514),l=i(3515),c=i(60),d=i(17),u=i(33),h=i(371),p=i(1108),g=i(178),C=i(110);t.default=new class{getCallLocalVideoContextMenuOptions(e,t,i,n,o,s){return{callId:e,conversationMri:t,isGroupCall:!!t&&d.isGroupConversation(t),sizeToFit:!a.isUndefined(o)&&o,isCompact:!!i,videoStatus:n,isCropVideoEnabledOnGroupCall:!0,isCropVideoEnabledOn1On1Call:!0,showCropUncropMenuOption:!1,showLowerHand:s,showPinOption:C.default.shouldShowCallParticipantPinOption(c.CallStageElementKeys.localUserKey,e),showUnpinOption:C.default.shouldShowCallParticipantUnpinOption(c.CallStageElementKeys.localUserKey,e)}}getShowCropUncropMenuOption(e,t,i){let a=!0;return(n.BrowserEnvironment.isEdge()||e||t!==c.VideoStatus.Streaming||i)&&(a=!1),a}getMenuOptionEnabled(e){let t=!1,i=!1,n=!1,r=!1,l=!1,c=!1,h=!1;const p=new s.MuteEveryoneCommand(e.callId).canExecute(),C=u.default().getConversation(e.conversationMri),m=e.isGroupCall&&!e.isCropVideoEnabledOnGroupCall||!e.isGroupCall&&!e.isCropVideoEnabledOn1On1Call;if(t=this.getShowCropUncropMenuOption(m,e.videoStatus,e.isCompact),!e.isLocal&&e.isGroupCall){n=!0,i=!0;const{showChangeTogetherModeBackgroundOption:a}=e;a?(i=!1,n=!1,t=!1):g.isRegularMemberInModeratedGroup(C)&&(i=!1,n=!1)}return!e.showSendMessageMenuOption||e.isLocal||!e.isGroupCall||o.default.isMriBlocked(e.userMri)||d.isGuestUserMri(e.userMri)||(l=!0),i&&e.isLocalMuteSupported&&e.isServerMutedSupported&&!e.isMuted&&(r=!0),t&&!a.isUndefined(e.sizeToFit)&&(e.sizeToFit?c=!0:h=!0),{isMuteOptionDisabled:r,showMute:i,showMuteEveryone:p,showRemoveCall:n,showCropUncropMenuOption:t,showSendMessageMenuOption:l,showCropVideoOption:c,showFullVideoOption:h}}showParticipantActionsContextMenuOnPosition(e,t,i,n,o,s){p.default.setAnchorPosition(e),a.defer(()=>{const a=h.default.getMenuTargetCallback(t),r=this.getMenuOptionEnabled(i);i.isMuteOptionDisabled=r.isMuteOptionDisabled,i.showMute=r.showMute,i.showMuteEveryone=r.showMuteEveryone,i.showRemoveCall=r.showRemoveCall,i.showCropUncropMenuOption=r.showCropUncropMenuOption,i.showSendMessageMenuOption=r.showSendMessageMenuOption,i.showCropVideoOption=r.showCropVideoOption,i.showFullVideoOption=r.showFullVideoOption,new l.default(i).showContextMenu(t,{pageX:e.x,pageY:e.y},a,n,o,i.showCropUncropMenuOption?s:void 0)})}showParticipantActionsContextMenu(e,t,i,n,o,s){e.stopPropagation(),e.preventDefault();const r=a.pick(e,"pageX","pageY");this.showParticipantActionsContextMenuOnPosition({x:r.pageX||0,y:r.pageY||0},t,i,n,o,s)}showLocalVideoActionsContextMenuOnPosition(e,t,i,n){p.default.setAnchorPosition(e),a.defer(()=>{const a=h.default.getMenuTargetCallback(t),o=new r.default(i),s=i.isGroupCall&&!i.isCropVideoEnabledOnGroupCall||!i.isGroupCall&&!i.isCropVideoEnabledOn1On1Call;i.showCropUncropMenuOption=this.getShowCropUncropMenuOption(s,i.videoStatus,i.isCompact),o.showContextMenu(t,{pageX:e.x,pageY:e.y},a,i.showCropUncropMenuOption?n:void 0)})}showLocalVideoActionsContextMenu(e,t,i,n){e.stopPropagation(),e.preventDefault();const o=a.pick(e,"pageX","pageY");this.showLocalVideoActionsContextMenuOnPosition({x:o.pageX||0,y:o.pageY||0},t,i,n)}}},1698:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallParticipantNametagView=t.CallParticipantNametag=void 0;const a=i(0),n=i(1227),o=i(29),s=i(1697),r=i(60),l=i(110),c=i(113),d=i(17),u=i(109),h=i(45),p=i(32),g=i(6),C=i(5),m=i(21),S=i(575),y=i(742),f=i(9),_=i(11),b=i(1699),v=i(1226),w=g.lazyProperties({floatingNameTag:()=>a.Styles.createViewStyle({marginTop:10}),toolTipContainer:()=>a.Styles.createViewStyle({height:24}),toolTipContainerRaiseHand:()=>a.Styles.createViewStyle({overflow:"visible",paddingLeft:5}),toolTipContainerRaiseHandV2:()=>a.Styles.createViewStyle({overflow:"hidden",paddingLeft:35}),nametagBgColorStyle:()=>a.Styles.createViewStyle({backgroundColor:f.Color.blackOverlay50}),nametagBgColorStyleLightThemeStage:()=>a.Styles.createViewStyle({backgroundColor:f.Color.whiteOverlay80}),nametagBgColorStyleLightThemeTray:()=>a.Styles.createViewStyle({backgroundColor:f.Color.gray50overlay95}),nametagBgColorStyleHover:()=>a.Styles.createViewStyle({backgroundColor:f.Color.blackOverlay80}),nametagBgColorStyleHoverLightTheme:()=>a.Styles.createViewStyle({backgroundColor:f.Color.whiteOverlay90}),raisedHandIconV2:()=>a.Styles.createViewStyle({position:"absolute",left:0,bottom:-6}),wrapperStageV2:()=>a.Styles.createViewStyle({height:36,justifyContent:"flex-end",flexGrow:0,flexShrink:1})});class T extends h.default{constructor(){super(...arguments),this._updateAnchorRect=e=>{!e&&this.state.hoveringKey&&this.props.getAnchorInfo&&(e=this.props.getAnchorInfo(this.state.hoveringKey)),this._popupView&&e&&this._popupView.updatePosition(e)},this._onPopupViewRef=e=>{this._popupView=e||void 0},this._getPopUpPositions=e=>[u.PopupAnchorPositon.Bottom],this._getAnchorInfo=()=>{if(this.props.getAnchorInfo&&this.state.hoveringKey)return this.props.getAnchorInfo(this.state.hoveringKey)},this._renderPopupContent=()=>a.createElement(I,{style:w.floatingNameTag,opacityStyle:this.props.opacityStyle,hoveringKey:this.state.hoveringKey,callId:this.props.callId,conversationMri:this.props.conversationMri,isLocal:this.state.hoveringKey===r.CallStageElementKeys.localUserKey,onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,onNametagMouseEnter:this.props.onNametagMouseEnter,onNametagMouseLeave:this.props.onNametagMouseLeave,isCompact:!0,isOnHold:this.props.isOnHold})}_buildState(e,t){const i=n.default.getCurrentHoveringParticipantConfig();return{hoveringKey:i?i.key:void 0}}componentDidMount(){super.componentDidMount(),this._updateAnchorRect(),this.state.hoveringKey&&this._updateAnchorRectAndSubscribeForChanges(this.state.hoveringKey)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.hoveringKey===t.hoveringKey&&this.props.parentDimensions===e.parentDimensions||(this.state.hoveringKey?this._updateAnchorRectAndSubscribeForChanges(this.state.hoveringKey):this._unsubscribeFromAnchorRectChanges())}componentWillUnmount(){super.componentWillUnmount(),this._unsubscribeFromAnchorRectChanges()}_updateAnchorRectAndSubscribeForChanges(e){this._updateAnchorRect(),this._unsubscribeFromAnchorRectChanges(),this.props.getAnchorInfoChanges&&(this._rectChangeSubscriptionToken=this.props.getAnchorInfoChanges(e,this._updateAnchorRect))}_unsubscribeFromAnchorRectChanges(){this._rectChangeSubscriptionToken&&(this._rectChangeSubscriptionToken.unsubscribe(),this._rectChangeSubscriptionToken=void 0)}render(){return this.state.hoveringKey?a.createElement(S.default,{key:this.state.hoveringKey,ref:this._onPopupViewRef,disablePositionAnimation:!0,getAnchorInfo:this._getAnchorInfo,getPopupPositions:this._getPopUpPositions,renderPopup:this._renderPopupContent,allowTaps:!0,ignorePointerEvents:!0}):null}}t.CallParticipantNametag=T;class I extends h.default{constructor(){super(...arguments),this._onUserNameChevronOverflowPress=e=>{if(this.props.isLocal)s.default.showLocalVideoActionsContextMenu(e,this._getRootViewId(),this._getCallLocalVideoContextMenuOptions(),this.props.onToggleCropVideoClicked);else{const t=this._getCallParticipantContextMenuOptions();s.default.showParticipantActionsContextMenu(e,this._getRootViewId(),t,this.props.onCallParticipantContextMenuOpened,this.props.onCallParticipantContextMenuDismissed,this.props.onToggleCropVideoClicked)}},this._onMouseEnter=e=>{this.props.onNametagMouseEnter&&this.props.hoveringKey&&this.props.onNametagMouseEnter(e,this.props.hoveringKey)},this._onMouseLeave=e=>{this.props.onNametagMouseEnter&&this.props.hoveringKey&&this.props.onNametagMouseEnter(e,this.props.hoveringKey)}}_buildState(e,t){const i=!e.isLocal&&e.hoveringKey?d.asMriMaybe(e.hoveringKey):void 0,a=!e.isLocal;let n,s,c;if(a&&e.hoveringKey&&(n=o.default.CallingStore.findRemoteCallMember(e.callId,e.hoveringKey)),e.isLocal){const e=m.default.getSkypeMri();s=p.default.getDisplayName(e),c=e}else i&&(s=p.default.getDisplayName(i),c=i);const u=!!c&&!!e.callId&&o.default.CallingStore.isHandRaisedForMri(c,e.callId),h=d.isGroupConversation(e.conversationMri);let g={displayName:s,participantViewMuteIconEnabled:a,isServerMutedSupported:!!n&&o.default.CallingStore.getServerMuteUnmuteSupportedForParticipant(e.callId,n),isLocalMuteSupported:o.default.CallingStore.getLocalMuteSupported(e.callId),isMuted:e.isLocal?l.default.isLocalOrServerMuted(e.callId):!!n&&n.isServerMuted,isGroupCall:h,isCallConnected:o.default.CallingStore.isCallConnected(e.callId),isHandRaised:u};{const t=o.default.CallingFeaturesHelper.allowOutboundVideo({isPSTNCall:o.default.CallingStore.isPSTNCall(e.callId),isEncryptedCall:o.default.CallingStore.isEncryptedCall(e.callId),conversationMri:e.conversationMri,callId:e.callId});g.participantViewActionsEnabled=!e.isLocal,g.tooltipsShowing=v.default.getToolTipConfig(this._getRootViewId()).displayText.length>0,g.localVideoActionsEnabled=e.isLocal&&t,g.isPinned=l.default.isCallParticipantPinned(e.isLocal?r.CallStageElementKeys.localUserKey:c,e.callId)}return g}_getCallParticipantContextMenuOptions(){const e=this.props.hoveringKey;return{callId:this.props.callId,conversationMri:this.props.conversationMri,userMri:e,isLocal:this.props.isLocal,isGroupCall:this.state.isGroupCall,isLocalMuteSupported:this.state.isLocalMuteSupported,isMuted:this.state.isMuted,isServerMutedSupported:this.state.isServerMutedSupported,sizeToFit:this.props.sizeToFit,isCompact:!!this.props.isCompact,videoStatus:this.props.videoStatus?this.props.videoStatus:r.VideoStatus.None,isCropVideoEnabledOnGroupCall:!0,isCropVideoEnabledOn1On1Call:!0,showCropUncropMenuOption:!1,showMute:!1,showMuteEveryone:!1,isMuteOptionDisabled:!1,showRemoveCall:!1,showSendMessageMenuOption:c.default.call().canSendMessageToParticipant,showCropVideoOption:!1,showFullVideoOption:!1,showViewProfile:c.default.navigation().canAccessUserDetails,showLowerHandOption:this.state.isHandRaised,showChangeTogetherModeBackgroundOption:!1,showPinOption:l.default.shouldShowCallParticipantPinOption(e,this.props.callId),showUnpinOption:l.default.shouldShowCallParticipantUnpinOption(e,this.props.callId)}}_getCallLocalVideoContextMenuOptions(){return s.default.getCallLocalVideoContextMenuOptions(this.props.callId,this.props.conversationMri,!!this.props.isCompact,this.props.videoStatus?this.props.videoStatus:r.VideoStatus.None,this.props.sizeToFit,this.state.isHandRaised)}_getAccessibilityLabel(e){let t;return t=this.state.isMuted?C.getString("CallPanel.DisplayNameWithMicrophoneMuted",{displayName:e}):C.getString("SkypeUserListItem.DisplayNameLabel",{displayName:e}),this.state.isHandRaised&&(t=C.getString("CallPanel.DisplayNameWithHandRaised",{prefix:t})),t}_getToolTipStyleV2(){return this.props.useLightTheme?this.props.isInTray?w.nametagBgColorStyleLightThemeTray:w.nametagBgColorStyleLightThemeStage:w.nametagBgColorStyle}render(){const e=this.state.displayName?this.state.displayName:void 0,t=!this.props.isCompact&&this.state.isMuted?_.SkypeIcon.MicrophoneOff:void 0;if(!this.state.isCallConnected||!e||this.state.tooltipsShowing||!this.props.isCallStageV2&&!this.state.isGroupCall&&!this.state.isMuted)return null;let i=this._getAccessibilityLabel(e);const n=[this.props.style,this.props.opacityStyle,w.toolTipContainer,this.props.isCallStageV2?this._getToolTipStyleV2():void 0];let o,s;this.state.isHandRaised&&!this.props.isCompact&&(this.props.isCallStageV2?(n.push(w.toolTipContainerRaiseHandV2),s=a.createElement(a.View,{style:w.raisedHandIconV2},a.createElement(y.default,{type:y.RaiseHandImageType.MediumSizeCenterAligned}))):(n.push(w.toolTipContainerRaiseHand),o=a.createElement(y.default,{type:y.RaiseHandImageType.MediumSizeCenterAligned})));const r=[];this.state.isPinned&&r.push(_.SkypeIcon.Pin);let l=this.props.isCallStageV2?t:void 0;this.props.isOnHold&&(l=_.SkypeIcon.Pause),r.push(l);let c=_.SkypeIcon.More;this.props.isCallStageV2&&(this.props.showMoreIcon?n.push(this.props.useLightTheme?w.nametagBgColorStyleHoverLightTheme:w.nametagBgColorStyleHover):c=void 0),r.push(c);const d=this.props.useLightTheme?f.Color.gray400:void 0;let u=a.createElement(b.default,{style:n,displayText:e,leftIcon:this.props.isCallStageV2?void 0:t,leftElement:o,rightIcons:r,onPress:this._onUserNameChevronOverflowPress,accessibilityLabel:i,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,ellipseCaption:this.props.isCallStageV2,textColor:d});if(this.props.isCallStageV2)return a.createElement(a.View,{style:w.wrapperStageV2},u,s);const h=a.createElement(b.default,{style:n,displayText:e,leftElement:o,textColor:d}),p=a.createElement(b.default,{style:n,displayText:e,leftIcon:t,leftElement:o,textColor:d});return this.state.participantViewMuteIconEnabled||this.state.participantViewActionsEnabled||this.state.localVideoActionsEnabled?!this.state.isGroupCall&&t?p:this.state.participantViewMuteIconEnabled&&this.state.participantViewActionsEnabled||this.state.localVideoActionsEnabled?u:h:h}}t.CallParticipantNametagView=I,t.default=T},1710:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(165),n=i(0),o=i(29),s=i(1711),r=i(113),l=i(302),c=i(13),d=i(3538),u=i(3),h=i(4),p=i(6),g=i(5),C=i(3539),m=i(452),S=i(898),y=i(1712),f=i(52),_=i(23),b=i(9),v=i(42),w=i(24),T=i(12),I=i(10),P=i(1717),M=p.lazyProperties({componentsWrapper:()=>n.Styles.createViewStyle({flex:0,alignSelf:"center",alignItems:"stretch",justifyContent:"center",borderRadius:10,shadowOffset:{width:0,height:4},shadowRadius:8,shadowColor:b.Color.blackOverlay20,borderColor:b.Color.black,paddingTop:40,paddingBottom:40,paddingLeft:50,paddingRight:50,margin:10,overflow:"visible",maxWidth:500}),nameYourMeetingLabel:()=>n.Styles.createTextStyle({font:w.default.font.uiDisplayBold,lineHeight:22,marginBottom:8}),copyLinkDescription:()=>n.Styles.createTextStyle({font:w.default.font.uiDisplayRegular,marginBottom:16}),joinLinkWrapper:()=>n.Styles.createViewStyle({marginBottom:8}),copyJoinLink:()=>n.Styles.createViewStyle({height:50}),actionButtonWrapper:()=>n.Styles.createViewStyle({alignSelf:"center"}),actionButtonInnerContainer:()=>n.Styles.createViewStyle({paddingLeft:50,paddingRight:50}),addSkypeContactsWrapper:()=>n.Styles.createViewStyle({marginBottom:20})});class k extends T.default{constructor(){super(...arguments),this.state={startButtonClicked:!1},this._startCall=e=>()=>{const t=I.default.newCauseId();this.setState({startButtonClicked:!0}),m.default.trackStartMeetNowButtonClicked(e),o.default.CallNavigationHelper.startGoLiveCall({conversationMri:e,withVideo:!1,origin:u.NavigationCallOrigin.MeetNow,muteFlag:void 0,isCameraSelected:!1,askForAudioVideoPermissions:!0},t).then(()=>{const e=this._getRootViewId();this.state.isUsingSplitView&&this.props.meetNowParameters.convId!==e&&(h.log(u.LogTraceArea.JoinLink,"CreateLobby._startCall: closing splitview window"),a.default.closeSplitView(e))}).finally(()=>{this.setState({startButtonClicked:!1})})}}_buildState(e){const{convId:t}=e.meetNowParameters;this._conversationMri=t;const i=f.default.getPrimaryColor();return{joinLink:t&&l.default.getLink(t),canInvitePeople:r.default.meetnow().canInvitePeople,isUsingSplitView:_.default.isUsingSplitView(),accentColor:i}}_handleLobbyOpen(e){m.default.trackLobbyOpen(e),n.Accessibility.announceForAccessibility(g.getString("MeetNow.LobbyCreatorMainTitleV2"))}componentDidMount(){super.componentDidMount();const{convId:e}=this.props.meetNowParameters;e&&this._handleLobbyOpen(e)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const{convId:a}=this.props.meetNowParameters;a&&a!==e.meetNowParameters.convId&&this._handleLobbyOpen(a)}render(){const{meetNowParameters:e}=this.props,t=e.convId,{joinLink:i}=this.state;if(!t||!i)return n.createElement(s.default,{meetNowParameters:e},n.createElement(d.default,{primaryColor:this._themeColors.primaryTextColor}));const a=this._startCall(t);return n.createElement(s.default,{meetNowParameters:e},n.createElement(n.View,{style:[M.componentsWrapper,this._themeStyles.primaryBackgroundColorStyle]},n.createElement(C.default,null),n.createElement(n.Text,{style:[M.nameYourMeetingLabel,{color:this._themeColors.secondaryTextColor}]},g.getString("MeetNowTitleSuggestions.NameYourMeeting")),n.createElement(y.default,{threadId:t,meetNowParameters:e,onEnterPressed:a}),n.createElement(n.Text,{style:[M.copyLinkDescription,{color:this._themeColors.primaryTextColor}]},g.getString("MeetNow.NameTheMeetingAndCopyLink")),n.createElement(n.View,{style:M.joinLinkWrapper},n.createElement(S.default,{threadId:t,partnerParameters:e,joinLink:i,style:[M.copyJoinLink],isLarge:!0,useVerboseView:!0,accentColor:this.state.accentColor,customColors:this._useDarkTheme()?void 0:{backgroundColorStyle:this._themeStyles.buttonBackgroundColorStyle,textColorStyle:this._themeStyles.primaryTextColorStyle,iconColor:this._themeColors.primaryIconColor}})),this.state.joinLink&&n.createElement(n.View,{style:M.addSkypeContactsWrapper},n.createElement(P.default,{joinLink:this.state.joinLink,conversationMri:this._conversationMri,meetNowParameters:this.props.meetNowParameters,logSource:"CreateLobby",accentColor:this.state.accentColor})),n.createElement(n.View,{style:M.actionButtonWrapper},n.createElement(v.default,{key:"start-meeting-button",buttonStyle:c.SXButtonStyle.ColorFill,title:g.getString("MeetNow.StartMeeting"),hoverText:g.getString("MeetNow.StartMeeting"),onPress:a,buttonSize:c.SXButtonSize.Medium,minHeight:45,disabled:this.state.startButtonClicked,autoFocus:!0,showActivityIndicator:this.state.startButtonClicked,textStyleDeprecated:w.default.fontStyle.body,innerContainerStyle:M.actionButtonInnerContainer}))))}}t.default=k},1711:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(165),n=i(0),o=i(57),s=i(734),r=i(3),l=i(4),c=i(6),d=i(5),u=i(126),h=i(18),p=i(23),g=i(68),C=i(11),m=i(14),S=i(12),y=i(10),f=c.lazyProperties({backgroundImage:()=>n.Styles.createImageStyle({position:"absolute",overflow:"hidden"}),container:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center"})});class _ extends S.default{constructor(){super(...arguments),this._closeCurrentWindowInSplitView=()=>{const e=this._getRootViewId();this.state.isUsingSplitView&&this.props.meetNowParameters.convId!==e&&(l.log(r.LogTraceArea.JoinLink,"CallLobby._closeCurrentWindowInSplitView: closing splitview window"),a.default.closeSplitView(e))},this._handleClose=()=>{const e=y.default.newCauseId();if(this.props.meetNowParameters.convId)return h.default.navigateCallComplete(this.props.meetNowParameters.convId,!1,!1,this._getContext(),e),void this._closeCurrentWindowInSplitView();p.default.isUsingStackNavigationContext()?g.default.stackNavNavigateBack(!1,e):(h.default.navigateToWelcomeScreen(e),this._closeCurrentWindowInSplitView())},this._onLayout=e=>{const t=[{scale:1}],i=e.width/1,a=e.height/1;this.setState({backgroundImageStyle:{width:i,height:a,transform:t}})}}_buildState(e,t){return{isUsingSplitView:p.default.isUsingSplitView()}}render(){const e=this._useDarkTheme()?{opacity:.5}:void 0,t=this._useAccessibleTheme()&&!this._useDarkTheme()||void 0;return n.createElement(n.View,{style:[f.container,m.default.newStackingContext,this._themeStyles.primaryBackgroundColorStyle],onLayout:this._onLayout},n.createElement(n.Image,{style:[f.backgroundImage,this.state.backgroundImageStyle,e],resizeMode:"repeat",resizeMethod:"resize",source:o.Collection.MEET_NOW_BACKGROUND}),n.createElement(s.default,{meetNowParameters:this.props.meetNowParameters,onClose:this._handleClose,color:t&&u.MeetNowColors.iconAccessible,hoverColor:t&&u.MeetNowColors.iconOverlayAccessible,imageButtonStyle:{icon:C.SkypeIcon.Message,backgroundColor:this._themeColors.primaryBackgroundColor,textColor:this._themeColors.primaryTextColor,title:d.getString("CallPanel.ChatTitle"),accessibilityLabel:d.getString("CallPanel.ChatTitle")}}),this.props.children)}}t.default=_},1717:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(45),o=i(3),s=i(4),r=i(6),l=i(5),c=i(147),d=i(9),u=i(11),h=i(26),p=i(517),g=r.lazyProperties({inviteButton:()=>a.Styles.createButtonStyle({alignSelf:"center",alignContent:"center",alignItems:"center",flexDirection:"row"}),inviteButtonText:()=>a.Styles.createTextStyle({fontSize:16,lineHeight:24}),addContactsIcon:()=>a.Styles.createTextStyle({marginRight:4})});class C extends n.default{constructor(){super(...arguments),this._inviteSkypeContacts=()=>{if(s.log(o.LogTraceArea.JoinLink,this.props.logSource+"._inviteSkypeContacts "+c.MeetNowShareInviteCommands.AddSkypeContacts),!this.props.joinLink)return s.log(o.LogTraceArea.JoinLink,this.props.logSource+" abort, no joinLink");p.default.clickShare(c.MeetNowShareInviteCommands.AddSkypeContacts,{joinLink:this.props.joinLink,threadId:this.props.conversationMri,rootViewId:this._getRootViewId(),meetNowParameters:this.props.meetNowParameters}),this.props.onClick&&this.props.onClick()}}render(){var e,t;const i=[g.addContactsIcon];return this._getContext().isRTL&&i.push(a.Styles.createTextStyle({marginRight:0,marginLeft:4})),a.createElement(a.Button,{accessibilityLabel:l.getString("CallCreatorShareOverlayPopup.AddContactLabel"),style:g.inviteButton,onPress:this._inviteSkypeContacts},a.createElement(h.default,{icon:u.SkypeIcon.ContactAdd,size:u.IconSize.size18,color:null!==(e=this.props.accentColor)&&void 0!==e?e:d.Color.blue,style:i}),a.createElement(a.Text,{style:[g.inviteButtonText,{color:null!==(t=this.props.accentColor)&&void 0!==t?t:d.Color.blue}]},l.getString("CallCreatorShareOverlayPopup.AddContactLabel")))}}t.default=C},1726:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LayoutOptionDefault=void 0;const a=i(0),n=i(57),o=i(13),s=i(41),r=i(901),l=i(6),c=i(5),d=i(135),u=i(18),h=i(42),p=i(9),g=i(11),C=i(77),m=i(14),S=i(16),y=i(12),f=n.Collection.SKYPE_TO_PHONE_SMALL,_=l.lazyProperties({container:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",paddingHorizontal:10,paddingVertical:4,marginTop:5}),iconContainer:()=>a.Styles.createViewStyle({width:40,height:40,marginRight:10,flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"visible"}),iconStyle:()=>a.Styles.createImageStyle({width:40,height:40,justifyContent:"center",overflow:"visible"}),labelsContainer:()=>a.Styles.createViewStyle({flex:1,paddingLeft:5}),topTextLine:()=>a.Styles.createViewStyle({flexDirection:"row",justifyContent:"space-between"}),bottomTextLine:()=>a.Styles.createViewStyle({marginTop:2}),rightLabelText:()=>a.Styles.createTextStyle({textAlignVertical:"center",height:20}),rightPartView:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",paddingHorizontal:6,overflow:"visible"}),forwardButton:()=>a.Styles.createViewStyle({alignItems:"center",paddingHorizontal:10}),itemDivider:()=>a.Styles.createViewStyle({height:1,marginHorizontal:10,marginTop:5}),itemDividerMiddle:()=>a.Styles.createViewStyle({height:1,marginLeft:65,marginTop:0}),itemDividerDarkeTheme:()=>a.Styles.createViewStyle({backgroundColor:p.Color.gray400})});class b extends y.default{constructor(){super(...arguments),this._onProceedButtonPress=e=>{e.stopPropagation(),this.props.experimentSettings&&r.default.registerBalanceStateButtonClickAction(this.props.experimentSettings,this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable),u.default.navigateToBalanceStatePanel("DialerPanel.UserEntitlements.navigateBalanceState",this._getRootViewId())},this._renderImage=(e,t)=>{const i=[_.iconStyle];return t&&i.push(t),a.createElement(a.Image,{style:i,source:e})},this._renderOptionalSpacer=(e,t)=>{},this._renderTopText=e=>a.createElement(a.View,{style:_.topTextLine},a.createElement(S.RowTitle,{style:m.default.flexOne,numberOfLines:2},e))}componentDidMount(){super.componentDidMount(),this.props.experimentSettings&&r.default.registerOpenAction(this.props.experimentSettings,this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable)}render(){const e=[_.itemDivider];this._useDarkTheme()?e.push(_.itemDividerDarkeTheme):e.push(this._themeStyles.dividerColorStyle);const t=c.getString("Entitlements.SkypeToPhoneTitle");let i,n,r=t;if(this.props.hasCallingEntitlements){const e=c.getString("Entitlements.SubscriptionsSmallCaps",{count:this.props.subscriptionsCount});r+=", "+e,this.props.formattedBalance&&(r+=", "+this.props.formattedBalance),i=a.createElement(S.BodyText,{style:_.bottomTextLine,numberOfLines:1,textThemeColor:S.TextThemeColor.Secondary},e),n=[a.createElement(S.RowTitle,{key:"creditEntitlementValueText",style:[this._themeStyles.secondaryTextColorStyle,_.rightLabelText,m.default.pointerCursor],numberOfLines:1},this.props.formattedBalance),a.createElement(s.default,{key:"creditEntitlementForwardButton",size:g.IconSize.size20,color:this._themeColors.disclosureArrowColor,hoverColor:this._themeColors.iconHoverColor,icon:C.navForwardIcon(),style:_.forwardButton,title:c.getString("Global.ForwardButton"),accessibilityLabel:c.getString("Global.ForwardButton")})]}else{const e=c.getString("Entitlements.AddFundsLabel");r+=", "+e;const t={backgroundColor:this._themeColors.buttonBackgroundColor,textColor:this._themeColors.primaryIconColor};n=a.createElement(a.View,{blockPointerEvents:!0},a.createElement(h.default,{title:e,buttonStyle:o.SXButtonStyle.Custom,buttonSize:o.SXButtonSize.Small,buttonConfig:t,allowTextWrap:!0}))}return a.createElement(a.View,null,this._renderOptionalSpacer("skypeToPhoneSpacer",[e,_.itemDividerMiddle]),a.createElement(d.MaybeListItem.Button,{style:[_.container,m.default.pointerCursor],accessibilityLabel:r,onPress:this._onProceedButtonPress},a.createElement(a.View,{style:_.iconContainer},this._renderImage(f,void 0)),a.createElement(a.View,{style:[_.labelsContainer,m.default.pointerCursor]},this._renderTopText(t),i),a.createElement(a.View,{style:_.rightPartView},n)),a.createElement(a.View,{style:e}))}}t.LayoutOptionDefault=b,t.default=b},1727:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(35),n=i(0),o=i(57),s=i(13),r=i(159),l=i(1239),c=i(6),d=i(5),u=i(18),h=i(306),p=i(228),g=(i(184),i(27)),C=i(42),m=i(16),S=i(12),y=c.lazyProperties({noCallsItemContainer:()=>n.Styles.createViewStyle({alignItems:"center",paddingHorizontal:10}),noCallsItemContainerSmallTopMargin:()=>n.Styles.createViewStyle({marginTop:20}),noCallsItemContainerLargeTopMargin:()=>n.Styles.createViewStyle({marginTop:70,marginBottom:10}),noCallsItemInfoText:()=>n.Styles.createTextStyle({textAlign:"center"}),noCallsItemButton:()=>n.Styles.createButtonStyle({flex:1,marginTop:20,minWidth:190,alignSelf:"center"}),noCallsImageV3:()=>n.Styles.createImageStyle({width:130,height:130,alignSelf:"center"})});class f extends S.default{constructor(){super(...arguments),this._syncLocalAddressStore=()=>{this.state.hideSyncAddressBookCta||u.default.navigateToSyncAddressBook({origin:r.DialogNavOrigin.NoCallsItem,hideSkipButton:!0},void 0,this._getRootViewId())}}static getDefaultHeight(){return 157}_buildState(e,t){const i=this._getRootViewId();let n={hideSyncAddressBookCta:!0,isLandscape:g.default.getDeviceOrientation(i)===a.DeviceOrientation.Landscape&&!this._getContext().isPresentedInDesktopSubview,isSmallDevice:g.default.isSmallDevice(i)};return t&&(n.hideSyncAddressBookCta||p.default.track(new h.DisplayedEmptyStateCta(h.EmptyStateOrigin.NoCalls))),n}render(){let e,t,i=[y.noCallsItemContainer];return this.state.hideSyncAddressBookCta||(e=n.createElement(C.default,{style:y.noCallsItemButton,buttonStyle:s.SXButtonStyle.ColorFill,buttonSize:s.SXButtonSize.Medium,onPress:this._syncLocalAddressStore,title:d.getString("NoCallsItem.ConnectButton")})),this.state.isLandscape||(t=n.createElement(n.Image,{style:y.noCallsImageV3,resizeMode:"contain",source:o.Collection.ONBOARDING_CALLS_EMPTYSTATE_NOCALLS_V3})),n.createElement(n.View,{style:i},t,n.createElement(l.default,{headerText:this.props.title}),n.createElement(m.BodyText,{style:y.noCallsItemInfoText,textThemeColor:m.TextThemeColor.Secondary},this.props.infoLabel),e)}}t.default=f},1752:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(7),s=i(198),r=i(50),l=i(29),c=i(87),d=i(88),u=i(67),h=i(3),p=i(26),g=i(101),C=i(65),m=i(4),S=i(6),y=i(89),f=i(5),_=i(18),b=i(55),v=i(83),w=i(44),T=i(11),I=i(14),P=i(16),M=i(10),k=C.UserIconSize.Size40,A=S.lazyProperties({container:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),headerContainer:()=>n.Styles.createViewStyle({alignSelf:"stretch",alignItems:"stretch"}),itemContainer:()=>n.Styles.createViewStyle({alignSelf:"stretch",alignItems:"stretch",flexDirection:"column",paddingHorizontal:20,marginBottom:10}),itemTextContainer:()=>n.Styles.createTextStyle({fontSize:15,cursor:"pointer"}),itemDivider:()=>n.Styles.createViewStyle({height:1}),sectionTitle:()=>n.Styles.createViewStyle({height:48,flexDirection:"row",alignItems:"center",justifyContent:"flex-start",paddingHorizontal:20}),userContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start",justifyContent:"flex-start",paddingVertical:12}),userIcon:()=>n.Styles.createViewStyle({marginRight:8}),enableFeature:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"stretch",justifyContent:"flex-start",paddingHorizontal:20}),enableFeatureText:()=>n.Styles.createViewStyle({flexDirection:"row",flexGrow:1,alignItems:"center"}),bingIconLeft:()=>n.Styles.createViewStyle({width:16,height:16,marginRight:10}),copyrightText:()=>n.Styles.createTextStyle({fontSize:12}),settignsPanelWrapper:()=>n.Styles.createViewStyle({paddingHorizontal:20}),settignsPanel:()=>n.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-start",marginTop:10,marginBottom:12}),topBgReplaceIcon:()=>n.Styles.createViewStyle({width:24,height:24,marginRight:10}),bgReplaceTextBlock:()=>n.Styles.createViewStyle({flexDirection:"column",justifyContent:"flex-start",flexShrink:1}),bgReplaceTitle:()=>n.Styles.createTextStyle({fontSize:13,paddingBottom:5}),bgReplaceText:()=>n.Styles.createTextStyle({fontSize:13}),bgReplaceTexHover:()=>n.Styles.createTextStyle({cursor:"pointer"})});class R extends r.default{constructor(){super(...arguments),this._onSettingsTextMouseOver=()=>{this.setState({settingsTextHover:!0})},this._onSettingsTextMouseLeave=()=>{this.setState({settingsTextHover:!1})},this._onSettingClick=()=>{const e=M.default.newCauseId();this._goBack(e),_.default.navigateToDesktopSettingsGroup(b.SettingsGroup.AudioVideoSettings,this._getRootViewId(),e)},this._closeView=()=>{const e=M.default.newCauseId();m.log(h.LogTraceArea.CallingUI,"[CallRosterView] _closeRoster, causeId: "+e),this._goBack(e)}}static getHeaderText(){return f.getString("CallPanel.CallRosterAccessibilityLabel")}_buildState(e,t){const i=l.default.CallParticipantBackgroundInfoStore.getBackgroundInfos(e.callId);return{captions:i,sortedCaptions:this._sortCaptions(i),isBingPictureOfDayBgSelected:l.default.CallParticipantBackgroundInfoStore.getBingBackgroundEnabled(),isBgReplaceEnabled:l.default.DeviceStore.isBackgroundReplacementEnabled()}}_sortCaptions(e){const t={};for(let i of a.values(e)){if(!(i.isoDate&&i.market&&i.caption&&i.copyright))continue;const e=i.market,a=i.isoDate;t[e]||(t[e]={});const n=i.userId;if(t[e][a])t[e][a].userIds.push(n);else{const o={caption:i.caption,copyright:i.copyright,link:i.link,market:e,isoDate:a,userIds:[n]};t[e][a]=o}}return t}_getHeader(){const e={closeButtonType:w.CloseButtonType.Close,onPress:this._closeView,title:f.getString("Global.CloseButtonTitle")},t=n.createElement(n.View,{style:I.default.flexOne});let i=f.getString("CallControls.BingBackgrounds");return n.createElement(n.View,{style:A.headerContainer},n.createElement(w.SimplePanelHeader,{panelName:i,useTransparentBackground:!0,leftButton:e,titleView:t}))}_renderList(){const e=[],t=[A.itemDivider,this._themeStyles.dividerColorStyle],i=this.state.settingsTextHover?A.bgReplaceTexHover:void 0;if(this.state.isBgReplaceEnabled&&e.push(n.createElement(n.View,{style:A.settignsPanelWrapper},n.createElement(n.View,{style:A.settignsPanel},n.createElement(p.default,{color:this._themeColors.primaryIconColor,icon:T.SkypeIcon.BackgroundReplacement,size:T.IconSize.size24,style:A.topBgReplaceIcon}),n.createElement(n.View,{style:A.bgReplaceTextBlock,onMouseOver:this._onSettingsTextMouseOver,onMouseLeave:this._onSettingsTextMouseLeave,onPress:this._onSettingClick},n.createElement(P.BodyText,{bold:!0,style:[A.bgReplaceTitle,i]},f.getString("AudioVideoSettings.BackgroundEffectBingCameraTitle2")),n.createElement(P.BodyText,{style:[A.bgReplaceText,this._themeStyles.secondaryTextColorStyle,i]},f.getString("AudioVideoSettings.BackgroundEffectBingCoachMarkText2")))),n.createElement(u.default,{key:"itemDivider",style:t}))),e.push(n.createElement(n.View,{style:A.sectionTitle},n.createElement(v.SectionTitle,{title:f.getString("CallPanel.BingBackgroundOverviewTitle"),titleStyles:I.default.flexOne}))),this.state.sortedCaptions)for(let i of a.keys(this.state.sortedCaptions)){const o=this.state.sortedCaptions[i];for(let i of a.keys(o)){const a=o[i],s=[];for(let e of a.userIds){const t=e;s.push(n.createElement(g.UserIcon,{key:"userIcon",userMri:t,size:k,useCircleForAgentMask:!0,statusBorderColor:this._themeColors.primaryBackgroundColor,style:A.userIcon}))}const r=n.createElement(n.View,{style:A.itemContainer},n.createElement(P.BodyText,{bold:!0,style:A.itemTextContainer,onPress:()=>{this._onClick(a)}},a.caption),n.createElement(P.BodyText,{style:[A.copyrightText,this._themeStyles.secondaryTextColorStyle]},a.copyright),n.createElement(n.View,{style:A.userContainer},s),n.createElement(u.default,{key:"itemDivider",style:t}));e.push(r)}}return n.createElement(n.ScrollView,{key:"scrollview"},e)}render(){return n.createElement(n.View,{style:[A.container,this._themeStyles.primaryBackgroundColorStyle]},this._getHeader(),this._renderList())}_onClick(e){if(this.props.callId){const t=M.default.newCauseId();c.default.updateCallTelemetry(this.props.callId,t,e=>e.bingBackgroundEffectCaptionClick()),m.track(new d.BackgroundEffectsBingInfoClickEvent(this.props.callId,e.isoDate,void 0,e.market,!1))}if(e.link){const t=`${o.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds.host}${e.link}`,i={browserTitle:f.getString("AudioVideoSettings.BackgroundEffectCategoryBing"),preventInAppNavigationForGuest:!s.default.canNavigateInApp()};y.openUrlWithParams({origin:h.BrowserOrigin.LinkNode,url:t,options:i,rootViewId:this._getRootViewId()})}}_getHeaderText(e){return R.getHeaderText()}}t.default=R},1764:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(177),o=i(401),s=i(35),r=i(282),l=i(73),c=i(508),d=i(91),u=i(165),h=i(0),p=i(196),g=i(74),C=i(63),m=i(3637),S=i(96),y=i(7),f=i(3638),_=i(3639),b=i(69),v=i(331),w=i(3640),T=i(741),I=i(3643),P=(i(700),i(1638)),M=i(3644),k=i(29),A=i(123),R=i(103),V=i(913),E=i(1766),L=i(3648),B=i(325),O=i(328),D=i(1539),x=i(219),N=i(3652),U=i(3662),F=i(88),H=i(87),z=(i(1257),i(843)),G=i(1258),W=i(3665),K=i(3666),j=i(60),Q=i(110),q=i(413),X=i(53),$=i(1690),J=i(381),Y=i(281),Z=i(17),ee=i(240),te=i(109),ie=i(98),ae=i(13),ne=i(193),oe=i(33),se=i(532),re=i(254),le=i(1225),ce=i(3667),de=i(79),ue=i(32),he=i(3691),pe=i(3),ge=i(120),Ce=i(26),me=i(148),Se=i(3694),ye=i(1765),fe=i(1795),_e=i(4),be=i(130),ve=i(229),we=i(125),Te=i(6),Ie=i(5),Pe=i(355),Me=i(158),ke=i(140),Ae=i(3695),Re=(i(3697),i(349)),Ve=i(178),Ee=i(30),Le=i(64),Be=i(18),Oe=i(55),De=i(23),xe=i(68),Ne=i(358),Ue=i(82),Fe=i(1098),He=i(3699),ze=i(27),Ge=i(39),We=i(36),Ke=i(59),je=i(78),Qe=i(48),qe=i(264),Xe=i(345),$e=i(3706),Je=i(3707),Ye=i(3708),Ze=i(3709),et=i(3710),tt=i(3711),it=i(3712),at=i(3714),nt=i(3715),ot=i(3716),st=i(3718),rt=i(322),lt=i(201),ct=i(107),dt=i(19),ut=i(9),ht=i(20),pt=i(11),gt=i(28),Ct=i(14),mt=i(137),St=i(369),yt=i(100),ft=i(31),_t=i(10),bt=i(3719),vt=i(3721),wt=i(3723),Tt=i(588),It=Te.lazyProperties({callPanel:()=>h.Styles.createViewStyle({flex:1,alignItems:"center",alignSelf:"stretch",backgroundColor:ut.Color.gray400}),callPanelCallStageV2:()=>h.Styles.createViewStyle({backgroundColor:ut.Color.callStageDark}),callPanelLightTheme:()=>h.Styles.createViewStyle({backgroundColor:ut.Color.gray200Overlay20}),headerContainer:()=>h.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,height:80,overflow:"visible"}),headerContainerV2:()=>h.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,height:j.DesktopNewHeaderHeight,overflow:"visible"}),buttonsContainer:()=>h.Styles.createViewStyle({position:"absolute",bottom:0,left:0,right:0,overflow:"visible"}),buttonsWithNotificationContainer:()=>h.Styles.createViewStyle({bottom:30}),modernStageButtonsContainer:()=>h.Styles.createViewStyle({height:j.DesktopCallControlsHeight,backgroundColor:ut.Color.callStageDark,justifyContent:"flex-end"}),lightThemeButtonsContainer:()=>h.Styles.createViewStyle({backgroundColor:ut.Color.transparent}),callingAnimationContainer:()=>h.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,alignItems:"center",justifyContent:"center",overflow:"visible"}),fullScreenView:()=>h.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:ut.Color.transparent,overflow:"visible"}),innerViewBase:()=>h.Styles.createViewStyle({position:"absolute",top:0,left:0,backgroundColor:ut.Color.transparent,overflow:"visible"}),mobileInnerViewBase:()=>h.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:ut.Color.transparent,overflow:"visible"}),reactionsBar:()=>h.Styles.createViewStyle({overflow:"visible",position:"absolute",left:0,right:0,bottom:0,backgroundColor:ut.Color.transparent,height:360,alignItems:"stretch"}),reactionsBarCompositeInner:()=>h.Styles.createViewStyle({overflow:"visible",minHeight:360,backgroundColor:ut.Color.transparent}),dialpadContainer:()=>h.Styles.createViewStyle({position:"absolute",right:0,bottom:0,left:0,top:0,alignItems:"center",justifyContent:"center",backgroundColor:ut.Color.transparent}),dialpadInnerContainer:()=>h.Styles.createViewStyle({position:"absolute",bottom:0,alignItems:"stretch",justifyContent:"center",backgroundColor:ut.Color.gray400}),dialpadShim:()=>h.Styles.createViewStyle({backgroundColor:ut.Color.blackOverlay50}),topBanner:()=>h.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,height:150}),skypeLogo:()=>h.Styles.createViewStyle({position:"absolute",left:20,bottom:20,opacity:.2}),skypeLogoWithAudioBar:()=>h.Styles.createViewStyle({bottom:30+j.DesktopCallControlsHeight-10}),skypeLogoV2:()=>h.Styles.createViewStyle({bottom:30+j.DesktopCallControlsHeight+10}),hiddenControls:()=>h.Styles.createViewStyle({opacity:0})});class Pt extends b.default{constructor(){super(...arguments),this._orientationLockKey=a.uniqueId("CallPanel:"),this._hasConnected=!1,this._coachMarkContext={coachMarkArea:te.CoachMarkAreaType.CallPanel},this._reactionsBarHeight=70,this._subscriptions=[],this._endCallNavigationRequested=!1,this._shouldDelayCameraToggle=!0,this._callSnapshotSound=Xe.default.SkypeCameraCapture,this._callHeaderAnimatedOpacityValue=new h.Animated.Value(1),this._callHeaderAnimatedTranslateYValue=new h.Animated.Value(0),this._callHeaderAnimatedStyle=h.Styles.createAnimatedViewStyle({opacity:this._callHeaderAnimatedOpacityValue,transform:[{translateY:this._callHeaderAnimatedTranslateYValue}]}),this._callControlsAnimatedTranslateYValue=new h.Animated.Value(-10),this._callControlsAnimatedTranslateYStyle=h.Styles.createAnimatedViewStyle({transform:[{translateY:this._callControlsAnimatedTranslateYValue}]}),this._callControlsAnimatedOpacityValue=new h.Animated.Value(1),this._callControlsOpacityAnimatedStyle=h.Styles.createAnimatedViewStyle({opacity:this._callControlsAnimatedOpacityValue}),this._callStageOverlayOpacityValue=new h.Animated.Value(1),this._callStageOverlayOpacityStyle=h.Styles.createAnimatedViewStyle({opacity:this._callStageOverlayOpacityValue}),this._callParticipantTooltipOpacityValue=new h.Animated.Value(1),this._callParticipantNameTooltipStyle=h.Styles.createAnimatedViewStyle({opacity:this._callParticipantTooltipOpacityValue}),this._callParticipantAccessoryOpacityValue=new h.Animated.Value(1),this._callParticipantAccessoryOpacityStyle=h.Styles.createAnimatedViewStyle({opacity:this._callParticipantAccessoryOpacityValue}),this._newCompositeReactionsAnimatedOpacityValue=new h.Animated.Value(1),this._newCompositeReactionsAnimatedOpacityStyle=h.Styles.createAnimatedViewStyle({opacity:this._newCompositeReactionsAnimatedOpacityValue}),this._reactionsPanelAnimatedBottomValue=new h.Animated.Value(70),this._reactionsPanelAnimatedBottomStyle=h.Styles.createAnimatedViewStyle({bottom:this._reactionsPanelAnimatedBottomValue}),this._dialpadAnimatedOpacityValue=new h.Animated.Value(0),this._dialpadAnimatedOpacityStyle=h.Styles.createAnimatedViewStyle({opacity:this._dialpadAnimatedOpacityValue}),this._dialpadAnimatedTransformValue=new h.Animated.Value(390),this._dialpadAnimatedTransformStyle=h.Styles.createAnimatedViewStyle({transform:[{translateY:this._dialpadAnimatedTransformValue}]}),this._topBannerAnimatedOpacityValue=new h.Animated.Value(0),this._leftNoneStateOnce=!1,this._isInteractingWithCallControls=!1,this._hasShownNoMicrophoneConnectedToast=!1,this._hasShownNoSpeakerConnectedToast=!1,this._deviceErrorToasts={},this._hasShownCameraDeniedToast=!1,this._hasShownTeamsInteropBanner=!1,this._hasShownTogetherModeNoticeBannerForCallId=!1,this._useMobileControls=()=>this.state.controlsType===j.CallControlsType.Mobile,this._renderDialpad=e=>{if(this.state.showDialpad){const t=[It.dialpadContainer,It.dialpadShim,this._dialpadAnimatedOpacityStyle],i=[It.dialpadInnerContainer],a=Math.min(414,e.width),n=this.state.bottomSafeAreaInset+30;return i.push(h.Styles.createViewStyle({height:Math.min(390+n,e.height),width:a,left:(e.width-a)/2,paddingBottom:n},!1)),i.push(this._dialpadAnimatedTransformStyle),h.createElement(h.View,{key:"dialpadcontainer",style:It.dialpadContainer},h.createElement(h.Animated.View,{key:"shim",style:t},h.createElement(h.GestureView,{style:It.dialpadContainer,onTap:this._onCloseDialpad})),h.createElement(h.Animated.View,{key:"dialpad",style:i},h.createElement(he.default,{callId:this.props.callId,onClose:this._onCloseDialpad})))}},this._onKeyUp=e=>{const t=_t.default.newCauseId();return _e.log(pe.LogTraceArea.CallingUI,"_onKeyUp causeId:"+t),this._showOrHideControls(!0,t),!1},this._onEscape=()=>this._toggleFullScreenMode(!1),this._toggleFullScreenMode=e=>!!this.state.showFullScreenOptionInRibbonSettings&&(s.default.isFullScreenMode(this._getRootViewId()).then(t=>{const i=void 0!==e?e:!t;i!==t?i?s.default.tryEnterFullScreenMode(this._getRootViewId()).then(e=>{e?(_e.track(new F.RibbonSettingsMenuActionEvent(F.RibbonSettingsMenuActions.EnterFullScreen)),H.default.trackCallViewMenuActions(F.CallViewMenuActions.EnterFullScreen)):_e.error(pe.LogTraceArea.CallingUI,"_toggleFullScreenMode Failed to enter full screen mode")}):s.default.exitFullScreenMode(this._getRootViewId()).catch(e=>{_e.error(pe.LogTraceArea.CallingUI,"_toggleFullScreenMode Failed to exit full screen mode")}):_e.log(pe.LogTraceArea.CallingUI,"_toggleFullScreenMode to "+i+" abort, fullScreenMode is already",t)}),!0),this._closeCameraDeniedToast=()=>{this._hasShownCameraDeniedToast=!0,this.setState({hideCameraDeniedToast:!0})},this._onNewCallScreenRevertNoticeDismiss=()=>{Ee.default.setUserPreferencesLocal({wasNewCallScreenRevertNoticeDismissed:!0}),this.setState({renderMobileNewCallScreenRevertNotice:!1})},this._closeTeamsInteropToast=()=>{this._hasShownTeamsInteropBanner=!0,this.setState({hideTeamsInteropToast:!0})},this._closeTogetherModeNoticeToast=()=>{this._hasShownTogetherModeNoticeBannerForCallId=!0,this.setState({hideTogetherModeNoticeToastForCallId:this.props.callId}),Ee.default.setTogetherModeNoticePresentedForCallId(this.props.callId)},this._updateServerMutedState=e=>{if(e.callId===this.props.callId){if(this.isComponentMounted()&&e.serverMuted)if(_e.log(pe.LogTraceArea.CallingUI,"_updateServerMutedState: Received serverMuted event for call ID "+e.callId+" causeId: "+e.causeId),this._useMobileControls())this.setState({showServerMutedToastOnMobile:!0}),ft.default.setTimeout(()=>{this.isComponentMounted()&&this.setState({showServerMutedToastOnMobile:!1,serverMuteNotificationBannerHeight:0})},Q.ServerMutedToastTimeout);else{const t=j.DeviceStatusToastType.MicrophoneServerMuted;this._showDeviceErrorToast(t,e.causeId)}}else _e.warn(pe.LogTraceArea.CallingUI,"_updateServerMutedState: Received event for unexpected call ID "+e.callId+" causeId: "+e.causeId)},this._updateDeviceQualityState=e=>{if(e.callId===this.props.callId){if(_e.log(pe.LogTraceArea.CallingUI,"_updateDeviceQualityState device: "+e.eventType+" state: "+R.CallDeviceState[e.deviceState]+" causeId: "+e.causeId),this.isComponentMounted()){if(e.eventType===R.CallDeviceQualityEventType.AudioDeviceMuted&&e.deviceState===R.CallDeviceState.NotWorking)return void this._showMicrophoneMutedPill();const t=Q.default.getErrorToastType(e.eventType);t&&(e.deviceState===R.CallDeviceState.NotWorking?this._showDeviceErrorToast(t,e.causeId):e.deviceState===R.CallDeviceState.Working&&(A.default.isEventTypeTriggeringMuteAction(e.eventType)||this._hideDeviceErrorToastOfType(t)))}}else _e.warn(pe.LogTraceArea.CallingUI,"_updateDeviceQualityState: Received event for unexpected call ID "+e.callId+" causeId: "+e.causeId)},this._showMicrophoneMutedPill=()=>{(k.default.CallingStore.isMutedNoSubscription(this.props.callId)||k.default.CallingStore.isServerMuted(this.props.callId))&&(this.setState({isMicrophoneMutedWhileSpeaking:!0}),a.isUndefined(this._microphoneMutedTimeout)||ft.default.clearTimeout(this._microphoneMutedTimeout),this._microphoneMutedTimeout=ft.default.setTimeout(()=>{this._microphoneMutedTimeout=void 0,this.isComponentMounted()&&this.setState({isMicrophoneMutedWhileSpeaking:!1})},5e3))},this._updateDeviceNearEndQuality=(e,t,i)=>{e===this.props.callId?(t===g.QualityLevel.Bad&&k.default.CallingStore.isSharingSound(e)?this._showDeviceErrorToast(j.DeviceStatusToastType.SoundSharingStopped,i):t===g.QualityLevel.Good&&this._hideDeviceErrorToastOfType(j.DeviceStatusToastType.SoundSharingStopped),_e.log(pe.LogTraceArea.CallingUI,"_updateDeviceNearEndQuality level: "+t+" causeId: "+i)):_e.warn(pe.LogTraceArea.CallingUI,"_updateDeviceNearEndQualityState: Received event for unexpected call ID "+e+" causeId: "+i)},this._selectedDevicesChanged=(e,t,i)=>{this._devicesChanged(e,t,!0,i)},this._availableDevicesChanged=(e,t)=>{this._devicesChanged(e,!1,!1,t)},this._onVideoEffectsQualityChangedEvent=(e,t,i)=>{this._showDeviceErrorToast(j.DeviceStatusToastType.VideoEffectsQualityChange,i,{deviceName:e})},this._devicesChanged=(e,t,i,a)=>{t||(this._showDeviceChangeToast(e,i,a),_e.log(pe.LogTraceArea.CallingUI,"_devicesChanged selected "+i+":"+Ge.trustMeThisJsonIsSafe(e)+" causeId: "+a))},this._navigateToChatNotBack=e=>{_e.log(pe.LogTraceArea.CallingUI,"_navigateToChatNotBack, causeId: "+e),this._navigateToChat(!1,!0,e)},this._toggleChatPanel=e=>{_e.log(pe.LogTraceArea.CallingUI,"_toggleChatPanel causeId: "+e);const t=()=>{Be.default.closeConversationInCall(e,this._getContext())};!this.state.isChatOpen?(()=>{H.default.updateCallTelemetry(this.props.callId,e,e=>e.chatOpened()),this._onNavigatedAwayFromCall(e),Be.default.openConversationInCall(e,this.state.conversationMri,this.props.callId,this._getContext(),this._toggleChatPanel),this.state.isGalleryPanelOpen?Qe.default.maybeAnnounceForAccessibility(Ie.getString("AccessibilityLabel.GalleryClosed")):k.default.OngoingCallService.getIsSubtitleHistoryOpen(this.props.callId)&&Qe.default.maybeAnnounceForAccessibility(Ie.getString("AccessibilityLabel.SubtitlesClosed"))})():this._closeRightPanel(t,e)},this._currentLeftPanelWidth=()=>this.state.isLeftPanelOpen&&!De.default.isUsingSplitViewNoSubscription()?qe.default.getWidthNoSubscription():0,this._toggleGalleryPanel=()=>{const e=_t.default.newCauseId();_e.log(pe.LogTraceArea.CallingUI,"_toggleGalleryPanel causeId: "+e),this._intToggleGalleryPanel(e)},this._intToggleGalleryPanel=e=>{_e.log(pe.LogTraceArea.CallingUI,"_intToggleGalleryPanel causeId: "+e),this.state.isGalleryPanelOpen?(this._closeRightPanel(()=>Be.default.closeGalleryPanel(e,this._getContext()),e),Qe.default.maybeAnnounceForAccessibility(Ie.getString("AccessibilityLabel.GalleryClosed"))):(this.state.isChatOpen?Qe.default.maybeAnnounceForAccessibility(Ie.getString("AccessibilityLabel.ChatClosed")):k.default.OngoingCallService.getIsSubtitleHistoryOpen(this.props.callId)&&Qe.default.maybeAnnounceForAccessibility(Ie.getString("AccessibilityLabel.SubtitlesClosed")),H.default.updateCallTelemetry(this.props.callId,e,e=>e.galleryOpened()),this._onNavigatedAwayFromCall(e),this._showOrHideControls(!1,e),Be.default.navigateToGallery(this.state.conversationMri,Oe.GalleryViewMode.All,this._getContext(),this.props.callId,this.state.conversationMri,this._intToggleGalleryPanel),Qe.default.maybeAnnounceForAccessibility(Ie.getString("AccessibilityLabel.GalleryOpened")))},this._showReactionsDrawerOnHover=()=>{this._reactionsBar&&this._reactionsBar.toggleReactionsPickerHovered()},this._showOrHideReactionsDrawer=e=>{e=a.isUndefined(e)?this._reactionsBar&&!this._reactionsBar.isDrawerOpen():e;const t=_t.default.newCauseId();_e.log(pe.LogTraceArea.CallingUI,"_showOrHideReactionsDrawer show: "+e+" causeId: "+t),e?this._reactionsBar&&this._reactionsBar.openReactionsDrawer(t):this._reactionsBar&&this._reactionsBar.close(),this._callControls&&this._callControls.toggleReactionsPickerButton(!!e,!0)},this._onAppStateChange=()=>{const e=_t.default.newCauseId();_e.log(pe.LogTraceArea.CallingUI,"_onAppStateChange, causeId: "+e),this._updateAudioState(e);const t=h.App.getActivationState();t===h.Types.AppActivationState.Background?H.default.updateCallTelemetry(this.props.callId,e,e=>e.backgroundAppInCall()):t===h.Types.AppActivationState.Active&&this._showOrHideControls(!0,e)},this._callParticipantActionsMenuOpened=()=>{if(this.isComponentMounted()){const e=_t.default.newCauseId();_e.log(pe.LogTraceArea.CallingUI,"[CallPanel]_callParticipantActionsMenuOpened causeId: "+e),this.setState({isCallParticipantActionsMenuOpened:!0}),this._clearHideControlsTimer()}},this._callParticipantActionsMenuClosed=()=>{if(this.isComponentMounted()){const e=_t.default.newCauseId();_e.log(pe.LogTraceArea.CallingUI,"[CallPanel]_callParticipantActionsMenuClosed causeId: "+e),this.setState({isCallParticipantActionsMenuOpened:!1}),this._startHideControlsTimer(!0,this._callControlShortTimeoutMs,e)}},this._onVideoPreviewFloating=(e,t)=>{this.isComponentMounted()&&this.setState({shouldRenderFloatingVideoPreview:e,floatingVideoPreviewView:t})},this._videoToolTipAnchor=()=>this._videoButtonRef,this._onInCallWarningViewRef=e=>{this._inCallWarningView=e||void 0},this._onAudioNotificationViewRef=e=>{this._audioNotificationView=e||void 0},this._onShowHideDisableOutgoingVideoToast=(e,t)=>{e?(_e.log(pe.LogTraceArea.CallingUI,"CallPanel._onShowHideDisableOutgoingVideoToast: show causeId "+t),this._showDeviceErrorToast(j.DeviceStatusToastType.OutgoingVideoDisabledDuringScreenSharing,t)):(_e.log(pe.LogTraceArea.CallingUI,"CallPanel._onShowHideDisableOutgoingVideoToast: hide causeId "+t),this._hideDeviceErrorToastOfType(j.DeviceStatusToastType.OutgoingVideoDisabledDuringScreenSharing))},this._renderSkypeLogo=()=>{if(!this.state.isSkypeLogoEnabled)return;const e=[It.skypeLogo,this.state.isNewCallScreen?It.skypeLogoV2:It.skypeLogoWithAudioBar],t=this.state.useLightTheme?ut.Color.gray300:ut.Color.white;return h.createElement(Ce.default,{key:"skypeLogo",icon:pt.SkypeIcon.SkypeIcon,size:pt.IconSize.size48,color:t,style:e})},this._onLocalUnmute=()=>{this.isComponentMounted()&&this._useMobileControls()&&this.setState({showServerMutedToastOnMobile:!1,serverMuteNotificationBannerHeight:0})},this._onReactionsDrawerOpen=e=>{const t=_t.default.newCauseId();if(_e.log(pe.LogTraceArea.CallingUI,"_onReactionsDrawerOpen open: "+e+" causeId: "+t),this.isComponentMounted())if(this._useMobileControls()){const i=e&&this.state.isUsingStackNavigationContext,a=i!==this.state.hideCallControlsForActivity?{hideCallControlsForActivity:i}:void 0;this._showOrHideControls(!1,t,a)}else this._inCallWarningView&&this._inCallWarningView.showOrHideWarningView(!e),this._callControls&&this._callControls.toggleReactionsPickerButton(e,!0)},this._onEndCallFailure=e=>{this._exitCall(!0,!1,e)},this._onCallTitleLayout=e=>{this.isComponentMounted()&&e.width!==this.state.titleWidth&&this.setState({titleWidth:e.width})},this._onUseImmersiveModeChange=e=>{e!==this.state.useImmersiveMode&&this.setState({useImmersiveMode:e})},this._onHeaderBackButtonPressed=e=>{_e.log(pe.LogTraceArea.CallingUI,"_onHeaderBackButtonPressed causedId: "+e),this._navigateToChat(this._isIncomingOrOutgoingRing(),!1,e)},this._onRecentsButtonPressed=e=>{if(_e.log(pe.LogTraceArea.CallingUI,"_onRecentsButtonPressed causeId: "+e),this.state.isSplitNavCollapsed&&this._getRootViewType()!==ae.RootViewType.SplitViewContent)Be.default.mainStageContextPopToRoot(!1,e,this._getContext());else{const t=this.state.isRecentsOpen,i=()=>{const i=Be.default.toggleRecentsInCall(!t,e,this._getContext());return H.default.updateCallTelemetry(this.props.callId,e,e=>t?e.navBarClosed():e.navBarOpened()),{willToggle:i.willToggle,completeAction:()=>{i.completeAction(),!t&&i.willToggle&&(ge.setFocusWithDelay(ge.FocusEvent.OpenCallSideBar,100),ge.setFocusWithDelay(ge.FocusEvent.Recent,100))}}};this._toggleLeftPanelForAction(i,!t,e)}},this._onShowOrHideProfile=e=>{this.isComponentMounted()&&Be.default.showDetailsPanelWithParams({mri:this.state.conversationMri,showConversationSettings:!0,rootViewId:this._getRootViewId(),causeId:e})},this._onShowParticipants=(e,t,i)=>{this._onShowOrHideRoster(e,t,i)},this._onShowOrHideRoster=(e,t,i)=>{!this._isIncomingOrOutgoingRing()&&this.state.rosterAvailble&&this.isComponentMounted()&&(Be.default.openCallRoster(this.state.conversationMri,this.props.callId,this._getContext()),_e.log(pe.LogTraceArea.CallingUI,"[CallPanel] show call roster, causeId: "+e),St.default.createSession(this.props.callId,t||j.CallRosterOrigin.FromGroupTitle,!!i),H.default.updateCallTelemetry(this.props.callId,e,e=>e.callRosterOpenedCount()))},this._toggleMobileOverflowMenu=e=>{const t=_t.default.newCauseId();if(_e.log(pe.LogTraceArea.CallingUI,"_toggleMobileOverflowMenu causeId: "+t),e){const i={callId:this.props.callId,conversationMri:this.state.conversationMri,reactionsConversationMri:this.state.reactionsConversationMri,isPSTNCall:this.state.isPSTNCall,isEncryptedCall:this.state.isEncryptedCall,callerContext:()=>this._getContext(),callUIState:this.state.callUIState},a=h.createElement(w.default,Object.assign({colorThemeOverride:yt.Theme.DelphiDark},i)),n=this._getRootViewId(),o=w.default.menuHeight(i);re.default.showWithContent({menuId:re.default.menuId(),anchor:e,rootViewId:this._getRootViewId(),menuHeight:o,content:a,useBlurredBackground:!0,colorThemeOverride:yt.Theme.DelphiDark,headerConfig:{headerType:se.HeaderType.Slim},staticContent:!0,useTransparentShim:!0,hidePopupArrow:!0,useDesktopPopup:!this.state.isUsingStackNavigationContext&&!this.state.isMobileScreenReaderEnabled,getTitle:()=>{},onCloseMenu:e=>{_e.log(pe.LogTraceArea.CallingUI,"onCloseMenu causeId: "+e),re.default.close(n,e)}},t);const s=!this.state.isUsingStackNavigationContext;this._showOrHideControls(s,t),de.dismissAll()}},this._onAddToCallKeyboardShortcut=(e,t)=>{if(t!==this._getRootViewId()||this.state.isS4BCall)return!1;const i=_t.default.newCauseId();return _e.log(pe.LogTraceArea.CallingUI,"_onAddToCallKeyboardShortcut causeId: "+i),this._onAddToCallPressed(i,pe.NavigationAddToCallOrigin.KeyboardShortcut),!0},this._onAddToCallPressed=(e,t)=>{_e.log(pe.LogTraceArea.CallingUI,"_onAddToCallPressed causeId: "+e),this._onNavigatedAwayFromCall(e),Be.default.openAddToCall(this.state.conversationMri,this.props.callId,t,this._getContext(),e),St.default.updateCallRosterTelemetry(this.props.callId,e,e=>e.callRosterAddToCall())},this._onBingBackgroundsPressed=e=>{_e.log(pe.LogTraceArea.CallingUI,"_onBingBackgroundsPressed causeId: "+e),this._onNavigatedAwayFromCall(e),Be.default.openBingBackgroundsOverview(this.props.callId,this._getContext())},this._onOpenDialpad=()=>{const e=_t.default.newCauseId();if(_e.log(pe.LogTraceArea.CallingUI,"CallPanel._onOpenDialpad causeId: "+e),!this.state.enableDialpadOnPSTNSubtitlesCalls&&k.default.CallingStore.isTranslating(this.props.callId))return H.default.updateCallTelemetry(this.props.callId,e,e=>e.displayedDtmfWarning()),void C.default.showOKAlert(Ie.getString("CallPanel.DialpadUnavailableTitle"),Ie.getString("CallPanel.DialpadUnavailableMessage"),this._getRootViewId());this._onShowOrHideDialpad(!0,e)},this._onCloseDialpad=()=>{const e=_t.default.newCauseId();_e.log(pe.LogTraceArea.CallingUI,"CallPanel._onCloseDialpad causeId: "+e),this._onShowOrHideDialpad(!1,e)},this._onShowOrHideDialpad=(e,t)=>{e!==this.state.showDialpad&&(e?(H.default.updateCallTelemetry(this.props.callId,t,e=>e.accessedDialpad()),this.setState({showDialpad:!0})):this._animateDialpad(!1,t,()=>{this.isComponentMounted()&&this.setState({showDialpad:!1})}))},this._onLayoutChange=e=>{this.setState({panelLayout:{x:e.x,y:e.y,width:e.width,height:e.height}})},this._onToggleLocalVideoSource=()=>{const e=_t.default.newCauseId();_e.log(pe.LogTraceArea.CallingUI,"_onToggleLocalVideoSource causeId: "+e),this._startHideControlsTimer(!0,0,e),this._shouldDelayCameraToggle?ft.default.setTimeout(()=>{this.isComponentMounted()&&this._updateVideoSource()},500):this._updateVideoSource()},this._updateVideoSource=()=>{const e=_t.default.newCauseId();_e.log(pe.LogTraceArea.CallingUI,"_updateVideoSource causeId: "+e);const t=this.state.selectedCamera&&this.state.selectedCamera.position,i=this.state.selectedCamera&&this.state.selectedCamera.id,n=a.find(this.state.cameras,e=>e.id!==i&&e.position!==t),o=n&&n.id,s=n&&n.position;k.default.DeviceStore.choosePreferredDevices({camera:o},e),_e.log(pe.LogTraceArea.CallingUI,"_updateVideoSource "+i+" position "+t+" -> "+o+" position "+s+" causeId: "+e),H.default.updateCallTelemetry(this.props.callId,e,e=>e.toggleCamera())},this._onVideoButtonRef=e=>{this._videoButtonRef=e||void 0},this._onMouseMove=()=>{if(this.state.callUIState===j.CallUIState.Default||this.state.callUIState===j.CallUIState.Voicemail){const e=_t.default.newCauseId();this.state.buttonsAndInfoHidden?this._showOrHideControls(!0,e):this._startHideControlsTimer(!0,this._callControlShortTimeoutMs,e)}},this._onMouseLeave=()=>{const e=_t.default.newCauseId();_e.log(pe.LogTraceArea.CallingUI,"_onMouseLeave causeId: "+e),this._useMobileControls()&&(this.state.callUIState!==j.CallUIState.Default&&this.state.callUIState!==j.CallUIState.Voicemail||this._showOrHideControls(!1,e))},this._onCallPanelHeaderLayoutChange=e=>{x.default.setCallHeaderLayoutMode(this.props.callId,e)},this._onStageTapped=e=>{const t=_t.default.newCauseId();return _e.log(pe.LogTraceArea.CallingUI,"_onStageTapped causeId: "+t),this.state.isVideoSuggestionTooltipVisible&&q.default.setVideoSuggestionTooltipVisibility(this.props.callId,!1),this.state.isGalleryPanelOpen&&this._intToggleGalleryPanel(t),!(this.state.callUIState!==j.CallUIState.Default&&this.state.callUIState!==j.CallUIState.Voicemail||this._shouldKeepControlsVisible())&&(this._showOrHideControls(this.state.buttonsAndInfoHidden,t,void 0,!1,e),!0)},this._onCallControls=e=>{this._callControls=e||void 0},this._onStageChange=e=>{this._shouldDelayCameraToggle!==!e&&(this._shouldDelayCameraToggle=!e)},this._onParticipantDragChange=e=>{!e||this.state.callUIState!==j.CallUIState.Default&&this.state.callUIState!==j.CallUIState.Voicemail||this._showOrHideReactionsDrawer(!1)},this._onCallControlsInteracting=e=>{const t=_t.default.newCauseId();_e.log(pe.LogTraceArea.CallingUI,"_onCallControlsInteracting causeId: "+t),this._isInteractingWithCallControls=e,this._isInteractingWithCallControls?this._clearHideControlsTimer():this._startHideControlsTimer(!0,this._callControlTimeoutMs,t)},this._onReactionsBarDesiredHeight=e=>{this._reactionsBarHeight=e;const t=this.state&&this._useMobileControls()?this._callControlsVisualHeight():this._reactionsBarHeight;this._reactionsPanelAnimatedBottomValue.setValue(t)},this._onToggleVideo=()=>{const e=_t.default.newCauseId();_e.log(pe.LogTraceArea.CallingUI,"_onToggleVideo causeId: "+e),k.default.CallControlsStore.toggleVideo(this.props.callId,e),this._startHideControlsTimer(!0,this._callControlExtraShortTimeoutMs,e)},this._onDynamicAudioChoice=(e,t)=>{const i=_t.default.newCauseId();_e.log(pe.LogTraceArea.CallingUI,"CallPanel._onDynamicAudioChoice causeId: "+i);const a=new _.AudioRouteSelectionPresenter(i);a.setUserProvidingVideo(k.default.CallingStore.isProvidingVideo(this.props.callId)),a.setControlTimerHandlers(()=>{this._clearHideControlsTimer()},()=>{this._startHideControlsTimer(!0,this._callControlTimeoutMs,i)}),a.show(this._getRootViewId(),e,t)},this._onCaptureMomentKeyboardShortcut=(e,t)=>{if(t!==this._getRootViewId()||this.state.isS4BCall)return!1;const i=_t.default.newCauseId();return _e.log(pe.LogTraceArea.CallingUI,"CallPanel._onCaptureMomentKeyboardShortcut causeId: "+i),this._intOnCaptureMomentPress(i),!0},this._callControlsOnCaptureMomentPress=()=>{const e=_t.default.newCauseId();_e.log(pe.LogTraceArea.CallingUI,"CallPanel._callControlsOnCaptureMomentPress causeId: "+e),this._intOnCaptureMomentPress(e)},this._reactionsBarOnCaptureMomentPress=()=>{const e=_t.default.newCauseId();_e.log(pe.LogTraceArea.CallingUI,"CallPanel._reactionsBarOnCaptureMomentPress causeId: "+e),this._intOnCaptureMomentPress(e)},this._intOnCaptureMomentPress=e=>{_e.log(pe.LogTraceArea.CallingUI,"CallPanel._intOnCaptureMomentPress causeId: "+e);const t=[this._galleryMri()],i=this.props.callId,a=this.state.conversationMri,n=this.state.reactionsConversationMri;if(X.CallingCapabilities.callSnapshotSupported()){let o=k.default.CallingStore.getRankedSpeakerMris(this.props.callId);this._callSnapshotSound.playOnce(e),D.default.takeSnapshot(e,i,a,n,o,t),Qe.default.maybeAnnounceForAccessibility(Ie.getString("CallPanel.SnapshotPosted")),H.default.updateCallTelemetry(this.props.callId,e,e=>e.postPhotoSnapshot())}},this._onEmptyCallGalleryViewPhotoButtonPress=()=>{this._onPhotoButtonPress(F.CallAddPhotosEntryPoint.CallGalleryEmptyView)},this._onPhotoButtonPress=e=>{const t=_t.default.newCauseId();_e.log(pe.LogTraceArea.CallingUI,"_onPhotoButtonPress causeId: "+t);const i=this._useMobileControls(),a={capturedContentHandler:new J.CapturedContentHandlerForPosting(this._galleryMri(),this.props.callId),conversationId:this._galleryMri(),callId:this.props.callId,allowVideo:!1,allowMultiple:!0,defaultToAlbums:!1,mediaPickerOnly:!0,disableMarkup:!0,onSendFlowComplete:this._onReactionsPhotoSendComplete};H.default.initCallAddPhotosEvent(this.props.callId,this.state.conversationMri,e),i&&this._onNavigatedAwayFromCall(t),this.state.isUsingStackNavigationContext?Y.navigateToCaptureComboWithParams(a,this._getContext(),()=>{Be.default.reduceNavStack([Oe.ConversationMediaViewerPanelNavigationId])}):i?Y.navigateToCaptureComboModalWithParams(a,this._getContext(),this._setAsVideoTargetWithDelay):this._intToggleGalleryPanel(t)},this._setAsVideoTargetWithDelay=()=>{_e.log(pe.LogTraceArea.CallingUI,"CallPanel._setAsVideoTargetWithDelay, isCallPanelVisible before update: "+this.state.isCallPanelVisible),this.isComponentMounted()&&!this.state.isCallPanelVisible&&(_e.log(pe.LogTraceArea.CallingUI,"Setting isCallPanelVisible: true"),this.setState({isCallPanelVisible:!0,isInCallGalleryOpenOnMobile:!1}))},this._onCallRecordingPress=()=>{const e=_t.default.newCauseId();_e.log(pe.LogTraceArea.CallingUI,"CallPanel._onCallRecordingPress causeId: "+e),this._intOnCallRecordingPress(e)},this._intOnCallRecordingPress=e=>{_e.log(pe.LogTraceArea.CallingUI,"CallPanel._intOnCallRecordingPress causeId: "+e),this.state.isRecording?k.default.InCallBotService.stopRecording(this.props.callId,e):k.default.InCallBotService.startRecording(this.props.callId,e)},this._onOpenGalleryWithoutMessage=e=>{_e.log(pe.LogTraceArea.CallingUI,"CallPanel._onOpenGalleryWithoutMessage causeId: "+e),this._onOpenGallery(void 0,void 0,e)},this._onOpenGallery=(e,t,i)=>{if(_e.log(pe.LogTraceArea.CallingUI,"onOpenGallery enableNewCaptureActivityPip: "+this.state.enableNewCaptureActivityPip+" causeId: "+i),this.state.isUsingStackNavigationContext){const t=e?e.conversationId:this._galleryMri();this.state.isUsingStackNavigationContext&&this.state.enableNewCaptureActivityPip&&!De.default.isMobileSplitView()&&q.default.setCallViewVisible(this.props.callId,!1,i),H.default.updateCallTelemetry(this.props.callId,i,e=>e.galleryOpened()),Be.default.navigateToConversationMediaViewer({conversationMri:t,initialMessage:e,defaultToLastItem:!0,useOpaqueBackground:!0,emptyMediaDescriptor:{mediaType:P.CallGalleryEmptyViewer.MediaType,launchCamera:this._onEmptyCallGalleryViewPhotoButtonPress},onClose:this._onGalleryClosed,origin:pe.NavigationMediaViewerOrigin.CallSharedPhoto},i,this._getContext()),this.setState({isInCallGalleryOpenOnMobile:!0})}else e?(H.default.updateCallTelemetry(this.props.callId,i,e=>e.galleryOpened()),this._onNavigatedAwayFromCall(i),Pe.default.showWithMessageConfig({initialMessage:e,defaultToLastItem:!0,rootViewId:this._getRootViewId(),initFromComponent:t,closeToComponent:this._getChatButtonRef,animateOpenClose:!0,onClose:this._onMediaViewerClosed,emptyMediaDescriptor:{mediaType:P.CallGalleryEmptyViewer.MediaType,launchCamera:this._onEmptyCallGalleryViewPhotoButtonPress},origin:pe.NavigationMediaViewerOrigin.CallSharedPhoto})):this._intToggleGalleryPanel(i)},this._onMediaViewerClosed=()=>{const e=_t.default.newCauseId();_e.log(pe.LogTraceArea.CallingUI,"onGalleryClosed causeId: "+e),this._pulseAnimationOnChatButton(),this.state.isUsingStackNavigationContext||this._useMobileControls()||this._showOrHideControls(!0,e)},this._pulseAnimationOnChatButton=()=>{this.isComponentMounted()&&(this._callControls&&this._callControls.animatedBubbleCircle(),this._reactionsBar&&this._reactionsBar.animatedBubbleCircleForChatButton())},this._onChatButtonRef=e=>{this._chatButton=e||void 0},this._getChatButtonRef=()=>this.isComponentMounted()?this._chatButton:void 0,this._onGalleryClosed=()=>{const e=_t.default.newCauseId();_e.log(pe.LogTraceArea.CallingUI,"onGalleryClosed causeId: "+e),q.default.setCallViewVisible(this.props.callId,!0,e),Be.default.closeConversationMediaViewer(e,this._getContext())},this._onReactionsPhotoSendComplete=()=>{const e=_t.default.newCauseId();_e.log(pe.LogTraceArea.CallingUI,"_onReactionsPhotoSendComplete, causeId: "+e),H.default.markPhotosSentCallAddPhotosEvent(this.props.callId,!0),H.default.completeCallAddPhotosEvent(this.props.callId),this.state.isUsingStackNavigationContext?Y.closeCaptureCombo(e,this._getContext()):this._useMobileControls()&&$.default.close()},this._onReactionsBarRef=e=>{this._reactionsBar=e||void 0},this._goBack=e=>(_e.log(pe.LogTraceArea.CallingUI,"_goBack causeId: "+e),this.state.callUIState===j.CallUIState.IncomingRing?(k.default.CallingStore.rejectCall(this.props.callId,e),!0):this.state.isChatOpen?(this._toggleChatPanel(e),!0):(this._exitCall(this._isIncomingOrOutgoingRing(),!1,e),!0)),this._requestEndInterruption=()=>n.default.requestEndToInterruption(),this._requestResumeCall=()=>{const e=_t.default.newCauseId();_e.log(pe.LogTraceArea.CallingUI,"_requestResumeCall, causeId: "+e),o.default.requestResumeCall(this.props.callId,e)},this._onToggleVideoKeyboardShortcut=(e,t)=>{if(t!==this._getRootViewId())return!1;const i=_t.default.newCauseId();return _e.log(pe.LogTraceArea.CallingUI,"_onToggleVideoKeyboardShortcut, causeId: "+i),this.state.buttonsAndInfoHidden&&this._showOrHideControls(!0,i),this._onToggleVideo(),!0},this._onToggleMicrophoneKeyboardShortcut=(e,t)=>{if(t!==this._getRootViewId())return!1;const i=_t.default.newCauseId();return _e.log(pe.LogTraceArea.CallingUI,"_onToggleMicrophoneKeyboardShortcut, causeId: "+i),this.state.buttonsAndInfoHidden&&this._showOrHideControls(!0,i),new v.ToggleMuteCommand(this.props.callId,k.default.CallingStore.isMuted(this.props.callId),k.default.CallingStore.isServerMuted(this.props.callId),this.state.microphonePermissionStatus!==l.PermissionStatus.Granted,this._getRootViewId()).execute(),!0},this._onAnnounceMuteStatusKeyboardShortcut=(e,t)=>{if(t!==this._getRootViewId())return!1;const i=_t.default.newCauseId();return _e.log(pe.LogTraceArea.CallingUI,"_onAnnounceMuteStatusKeyboardShortcut, causeId: "+i),this.state.buttonsAndInfoHidden&&this._showOrHideControls(!0,i),k.default.CallingStore.isMuted(this.props.callId)?Q.default.announceMicrophoneState(!0):Q.default.announceMicrophoneState(!1),!0},this._onAnnounceSelfVideoOnOffStatusKeyboardShortcut=(e,t)=>{if(t!==this._getRootViewId())return!1;const i=_t.default.newCauseId();return _e.log(pe.LogTraceArea.CallingUI,"_onAnnounceSelfVideoOnOffStatusKeyboardShortcut, causeId: "+i),this.state.buttonsAndInfoHidden&&this._showOrHideControls(!0,i),k.default.CallingStore.isProvidingVideo(this.props.callId)?Q.default.announceVideoState(!0):Q.default.announceVideoState(!1),!0},this._hangupCallShortcut=(e,t)=>t===this._getRootViewId()&&(this._hangupCall("CallPanel._hangupCallShortcut"),!0),this._hangupCall=e=>{const t=_t.default.newCauseId();_e.log(pe.LogTraceArea.CallingUI,"_hangupCall: "+e+t),this.state.callUIState===j.CallUIState.IncomingRing?k.default.CallingStore.rejectCall(this.props.callId,t):this._endCall(!1,t)},this._onPressCloseSubtitleHistory=()=>{{const e=_t.default.newCauseId();_e.log(pe.LogTraceArea.CallingUI,"_onPressCloseSubtitleHistory, close subtitles panel causeId: "+e),this.state.isUsingStackNavigationContext?(Be.default.navigateBack(e,this._getContext()),this.isComponentMounted()&&this.setState({isInCallSubtitleHistoryModeOnMobile:!1})):this._closeRightPanel(()=>Be.default.closeSubtitlesPanel(e,this._getContext()),e)}k.default.OngoingCallService.setIsSubtitleHistoryOpen(this.props.callId,!1)},this._onPressOpenSubtitleHistory=()=>{if(this.state.isTranslating){const e=_t.default.newCauseId();_e.log(pe.LogTraceArea.CallingUI,"_onPressOpenSubtitleHistory, open subtitles panel causeId: "+e),Be.default.openSubtitles(this.state.reactionsConversationMri,this.props.callId,this._getContext(),this._onPressCloseSubtitleHistory,e),this.state.isUsingStackNavigationContext&&this.isComponentMounted()&&this.setState({isInCallSubtitleHistoryModeOnMobile:!0}),k.default.OngoingCallService.setIsSubtitleHistoryOpen(this.props.callId,!0),this.forceUpdate()}},this._onCameraDeniedToastHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.cameraDeniedBannerHeight)&&this.setState({cameraDeniedBannerHeight:t})},this._onRecordingBannerHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.recordingBannerHeight)&&this.setState({recordingBannerHeight:t})},this._onNdiUsedBannerHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.ndiUsedBannerHeight)&&this.setState({ndiUsedBannerHeight:t})},this._onCallMediaCapturedBannerHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.callMediaCapturedBannerHeight)&&this.setState({callMediaCapturedBannerHeight:t})},this._onIncomingVideoDisabledBannerHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.incomingVideoDisabledBannerHeight)&&this.setState({incomingVideoDisabledBannerHeight:t})},this._onSpokenLangageConflictResolutionViewChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.spokenLangageConflictResolutionViewHeight)&&this.setState({spokenLangageConflictResolutionViewHeight:t})},this._onCallConnectionQualityBannerHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.callConnectionQualityBannerHeight)&&this.setState({callConnectionQualityBannerHeight:t})},this._onServerMuteNotificationBannerHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.serverMuteNotificationBannerHeight)&&this.setState({serverMuteNotificationBannerHeight:t})},this._onMobileScreenShareBannerHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.mobileScreenShareBannerHeight)&&this.setState({mobileScreenShareBannerHeight:t})},this._onMobileTeamsInteropBannerHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.mobileTeamsInteropBannerHeight||0)&&this.setState({mobileTeamsInteropBannerHeight:t})},this._onMobileTogetherModeNoticeBannerHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.mobileTogetherModeNoticeBannerHeight||0)&&this.setState({mobileTogetherModeNoticeBannerHeight:t})},this._onMobileNewCallScreenRevertNoticeBannerHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.mobileNewCallScreenRevertNoticeBannerHeight||0)&&this.setState({mobileNewCallScreenRevertNoticeBannerHeight:t})},this._onMobileTranslationBannerHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.mobileTranslationBannerHeight||0)&&this.setState({mobileTranslationBannerHeight:t})},this._closeCallCreatorShareOverlayPopup=()=>{this.setState({hasCallCreatorShareOverlayPopup:!1})}}_buildState(e,t){var i;const n=De.default.isUsingStackNavigationContext(),o=y.default.getS4LCMCFeatures();let r=j.CallUIState.Default,l=!1,c=!1,d="user"===k.default.CallingStore.getForwardingDestinationType(e.callId),u=k.default.CallingStore.getCallConversationMri(e.callId)||(t?e.initialConversationMri:this.state.conversationMri);const h=Z.isOneOnOneConversation(u),p=k.default.CallingStore.isPSTNCall(e.callId),C=Z.isEncryptedThread(u),m=Z.isS4BBridgeMri(u),S=k.default.CallingStore.hasStartedCallLocallyGoLive(e.callId),f=k.default.CallingStore.getCallState(e.callId),_=!!f&&A.default.isCallStateActive(f),b=k.default.CallingStore.isProvidingVideo(e.callId),v=this._getRootViewId(),w=!t&&this.state.isCallCreator||k.default.CallingStore.isCallCreator(e.callId),I=!(t||!this.state.hasBeenPresented)||!Ne.default.isAnimationPending(),P=k.default.CallingStore.hasRejectedCallLocally(e.callId);let M,R=!t&&(this.state.exitingCall||P);switch(f){case g.CallState.None:if(k.default.CallingStore.isCallIncoming(e.callId)&&e.navigationReason!==Oe.CallNavigationReason.AutoAnsweredRing)r=j.CallUIState.IncomingRing;else{const t=this._leftNoneStateOnce||k.default.CallingStore.callDidExist(e.callId);r=t?j.CallUIState.Disconnected:j.CallUIState.None,R=R||t&&I,t&&!R&&_e.log(pe.LogTraceArea.CallingUI,"_buildState: CallState.None, waiting for hasBeenPresented to exit")}l=!0;break;case g.CallState.Connected:case g.CallState.LocalHold:case g.CallState.RemoteHold:c=A.default.isCallStateOnHold(f),"voicemail"===k.default.CallingStore.getForwardingDestinationType(e.callId)?r=j.CallUIState.Voicemail:k.default.CallingStore.hasConnectedParticipants(e.callId)?r=j.CallUIState.Default:(r=t?j.CallUIState.None:this.state.callUIState,S&&(r=j.CallUIState.GoLiveSinglePlayer),l=!t&&this.state.skipRenderingParticipants);break;case g.CallState.Disconnecting:r=t?j.CallUIState.None:this.state.callUIState,l=!0,R=R||I,I||_e.log(pe.LogTraceArea.CallingUI,"_buildState: CallState.Disconnecting, waiting for hasBeenPresented to exit");break;case g.CallState.Disconnected:r=j.CallUIState.Disconnected,l=!0,R=R||I,I||_e.log(pe.LogTraceArea.CallingUI,"_buildState: CallState.Disconnected, waiting for hasBeenPresented to exit");break;case g.CallState.Connecting:case g.CallState.EarlyMedia:w&&(l=!h&&!b,r=S?j.CallUIState.GoLiveSinglePlayer:j.CallUIState.OutgoingRing);break;case g.CallState.Notified:e.navigationReason===Oe.CallNavigationReason.AnsweredRing||e.navigationReason===Oe.CallNavigationReason.AutoAnsweredRing?r=j.CallUIState.Default:(r=j.CallUIState.IncomingRing,l=!0)}const E=()=>C?Ie.getString("CallPanel.EncryptedConnectingStatusMessage"):Ie.getString("CallPanel.ConnectingStatusMessage");r===j.CallUIState.OutgoingRing&&(M=f===g.CallState.EarlyMedia?!t&&this.state.outgoingRingStatus?this.state.outgoingRingStatus:E():f!==g.CallState.Connecting||k.default.CallingStore.hasRingingParticipants(e.callId,!1)||k.default.CallingStore.hasConnectedParticipants(e.callId)?Ie.getString("CallPanel.RingingStatusMessage"):E());const L=Z.getReactionsThreadMriForCallId(e.callId),B=k.default.DeviceStore.getCameras(),D=k.default.DeviceStore.getSelectedCamera();let N;if(h&&p){const e=Z.getPhoneNumberFromMri(u);e&&(N=Fe.default.getConversationMri(e))}const U=t?{x:0,y:0,width:0,height:0}:this.state.panelLayout,F=ze.default.getDeviceOrientation(v)===s.DeviceOrientation.Landscape,H=We.default.statusBarHeight(),z=y.default.getS4LCMCFeatures().enableFullScreenOnWeb,G=k.default.CallingFeaturesHelper.areNewMainCallControlsEnabled(),W=Q.default.isLeftPanelOpen(v),K=Q.default.isRightPanelOpen(v),$=Q.default.isGalleryPanelOpen(v),J=Q.default.isSubtitlesPanelOpen(v),Y=Q.default.getControlsType(v,G),ee=je.default.isMobileScreenReaderEnabled(),te=!n&&xe.default.isDesktopSplitNavStackCollapsedForRootViewId(v),ie=!n&&!te&&xe.default.isCallChatShowing(v),ne=o.enableNewCameraFlipFlow&&!o.enableTapToMoveCallParticipant&&Y===j.CallControlsType.Mobile,se=o.enableImmersiveModeRibbon,re=k.default.InCallBotService.isTranslating(e.callId),le=!k.default.InCallBotService.spokenLanguageConflictToastShown(e.callId)&&!k.default.InCallBotService.isVoiceTranslationEnabled(e.callId)&&(k.default.InCallBotService.isStartSubtitlesMessageEnabled()?k.default.InCallBotService.shouldDisplaySubtitlesStartedMessage(e.callId):k.default.InCallBotService.isSpokenLanguageConflict(e.callId)),ce=o.enableMobileSubtitlesRightPanel,de=k.default.InCallBotUtils.isCallTranslatorBotTranslationEnabled(u)&&me.default.isConversationTranslated(u),ue=k.default.CallingFeaturesHelper.allowReactions({isPSTNCall:p,isEncryptedCall:C,conversationMri:u,callId:e.callId}),he=r===j.CallUIState.Default||r===j.CallUIState.OutgoingRing||r===j.CallUIState.GoLiveSinglePlayer,ge=r===j.CallUIState.Default,Ce=ue&&o.enableAllCallButtonsVisible?he:ge,Se=V.default(),ye=o.enableNewCallScreen&&Ee.default.getNewCallScreenDesignEnabled(),fe=[],be=x.default.getStageMode(e.callId),we={conversationMri:u,isProvidingVideo:b,cameras:B,selectedCamera:D,isCallCreator:w,microphonePermissionStatus:Ue.default.permissionStatus(gt.PermissionType.Microphone),isRecording:k.default.CallingStore.isRecording(e.callId),remoteParticipantsThatAreCapturingCallMedia:k.default.CallingStore.getRemoteMembersCapturingCallMedia(e.callId),isNdiBeingUsed:k.default.NdiHookupService.isInUse(),isTranslating:re,isIncomingVideoDisabled:k.default.CallingStore.isIncomingVideoDisabled(e.callId),audioOnlyEnabled:k.default.CallingStore.isAudioOnly(e.callId),isMobileScreenShareActive:!1,callUIState:r,outgoingRingStatus:M,terminatedReason:k.default.CallingStore.getCallTerminatedReason(e.callId),skipRenderingParticipants:l,rosterAvailble:!h,isCallOnHold:c,isCallBeingForwarded:d&&r===j.CallUIState.OutgoingRing,isUsingStackNavigationContext:n,reactionsConversationMri:L,exitingCall:R,isCallActive:_,isLandscape:F,panelLayout:U,hasBeenPresented:I,isMobileScreenReaderEnabled:ee,knownPSTNContactMri:N,isPSTNCall:p,isS4BCall:m,isEncryptedCall:C,statusBarHeight:H,hasMicrophones:k.default.DeviceStore.hasMicrophones(),hasSpeakers:k.default.DeviceStore.hasSpeakers(),isAudioOutputSelectionSupported:k.default.DeviceStore.getIsAudioOutputSelectionSupported(),enableNewCaptureActivityPip:Y===j.CallControlsType.Mobile&&o.enableNewCaptureActivityPip,topSafeAreaHeight:ne||We.default.keepStatusBarVisible()?We.default.statusBarPadding():0,bottomSafeAreaInset:We.default.bottomSafeAreaInset(ae.BottomInsetDefault),isReconnectUIEnabled:o.enableCallReconnectUI,isSpeakerMuted:!!X.CallingCapabilities.speakerVolumeControlSupported()&&(k.default.CallingStore.isSpeakerMuted(e.callId)||0===k.default.DeviceStore.getSpeakerVolume()),callAudioOutputRoute:k.default.CallControlsStore.getAudioOutput(),isNavigatingWithKeyboard:ve.default.isNavigatingWithKeyboard(),isRecentsOpen:!te&&xe.default.isLeftPanelShowing(v),isChatOpen:ie,isRightPanelOpen:K,isGalleryPanelOpen:$,isSubtitlesPanelOpen:J,isLeftPanelOpen:W,isSplitNavCollapsed:te,isRinglessCall:S,controlsType:Y,isVideoSuggestionTooltipVisible:q.default.isVideoSuggestionTooltipVisible(e.callId),lockOrientationForIncomingRing:r===j.CallUIState.IncomingRing&&n,isDesktopMin:Q.default.isDesktopMinCallPanelHeader(v),isDesktopMinCallRibbon:Q.default.isDesktopMinCallRibbon(v),useHighContrastTheme:Q.default.useHighContrastThemeAndChanges(),useLightTheme:ye&&Q.default.useLightTheme(),isTranscriptionEnabled:k.default.InCallBotUtils.isCallTranslatorBotEnabled(u),isSkypeLogoEnabled:o.enableSkypeLogo,isInCallGalleryOpenOnMobile:!t&&this.state.isInCallGalleryOpenOnMobile,shouldShowReactions:Ce,enableNewCameraFlipFlow:ne,enableStopCallControlTimerWhenActionsMenuOpened:o.enableStopCallControlTimerWhenActionsMenuOpened,enableImmersiveModeRibbon:se,showFullScreenOptionInRibbonSettings:z,callNetworkQualityPoor:Se.isCallQualityPoor(e.callId),callReconnectionState:Se.getCallReconnectionState(e.callId),newMobileOverflowOpen:T.default.isOverflowMenuVisible(),showSpokenLanguageConflict:le,mobileSubtitlesRightPanelEnabled:ce,isInCallSubtitleHistoryModeOnMobile:!t&&this.state.isInCallSubtitleHistoryModeOnMobile&&!q.default.isCallVisible(e.callId),showAloneInCall:S&&w&&O.default.getActiveParticipants(e.callId,u).length+fe.length===1,isTranslated:de,translationBannerBeenDismissed:Le.default.getInCallTranslationBannerDismissState(u),enableDoubleTapToFullScreen:z&&o.enableDoubleTapToFullScreen,enableDialpadOnPSTNSubtitlesCalls:o.enableDialpadOnPSTNSubtitlesCalls,isOutgoingVideoDisabled:k.default.CallingFeaturesHelper.isOutgoingVideoDisabled(),isNewCallScreen:ye,wasNewCallScreenRevertNoticeDismissed:Ee.default.getWasNewCallScreenRevertNoticeDismissed(),enableParticipantsButtonInCallControls:o.enableParticipantsButtonInCallControls&&!h,stageLayoutMode:be,activeCallsCount:k.default.CallingStore.getCallIds().filter(e=>k.default.CallingStore.isCallActive(e)).length,hideTogetherModeNoticeToastForCallId:Ee.default.getTogetherModeNoticePresentedForCallId(),isPossiblyNotConnectedAudienceBotInCall:k.default.CallingStore.isPossiblyNotConnectedAudienceBotInCall(e.callId),renderHeaderV2:ye&&!n,shouldShowTray:ye&&!x.default.isTopTrayHidden(e.callId)&&Tt.default.trayHasParticipants(e.callId),isOneOnOneConversation:h};we.isCallMediaBeingCaptured=!!we.remoteParticipantsThatAreCapturingCallMedia&&we.remoteParticipantsThatAreCapturingCallMedia.length>0;const Te=Me.MeetNowHelpers.isMeetNowConversation(u)&&Y===j.CallControlsType.Mobile?110:70;if(this._reactionsBarHeight!==Te&&this._onReactionsBarDesiredHeight(Te),we.callPanelHeaderLayout=x.default.getCallHeaderLayoutMode(e.callId),t)if(this._callControlTimeoutMs=o.callControlTimeoutMs,this._callControlShortTimeoutMs=o.callControlShortTimeoutMs,this._callControlExtraShortTimeoutMs=500,we.recordingBannerHeight=0,we.cameraDeniedBannerHeight=0,we.ndiUsedBannerHeight=0,we.incomingVideoDisabledBannerHeight=0,we.serverMuteNotificationBannerHeight=0,we.callMediaCapturedBannerHeight=0,we.callConnectionQualityBannerHeight=0,we.spokenLangageConflictResolutionViewHeight=0,we.mobileScreenShareBannerHeight=0,we.mobileTeamsInteropBannerHeight=0,we.mobileTogetherModeNoticeBannerHeight=0,we.mobileNewCallScreenRevertNoticeBannerHeight=0,we.mobileTranslationBannerHeight=0,we.hideCameraDeniedToast=!1,we.hideCallControlsForActivity=!1,we.useImmersiveMode=!1,we.showDialpad=!1,we.buttonsAndInfoHidden=!1,we.suppressParticipantAnimation=!1,we.titleWidth=0,we.isMicrophoneMutedWhileSpeaking=!1,we.showSpeakerOnWarning=!1,we.showServerMutedToastOnMobile=!1,we.isCallParticipantActionsMenuOpened=!1,we.shouldRenderFloatingVideoPreview=!1,we.hideTeamsInteropToast=!1,we.hasCallCreatorShareOverlayPopup=!0,n){const e=this._getContext().componentVisibilityStatus;e&&(we.isCallPanelVisible=e.isVisible(),this._visibilitySubscriptionToken=e.isVisibleEvent().subscribe(e=>{_e.log(pe.LogTraceArea.CallingUI,"visibility changed, isVisible: "+e+", isCallPanelVisible: "+this.state.isCallPanelVisible),this.isComponentMounted()&&e!==this.state.isCallPanelVisible&&(e?this._setAsVideoTargetWithDelay():(_e.log(pe.LogTraceArea.CallingUI,"Setting isCallPanelVisible: "+e),this.setState({isCallPanelVisible:e})))}))}else we.isCallPanelVisible=!0;else we.isRecording||(we.recordingBannerHeight=0),we.isNdiBeingUsed||(we.ndiUsedBannerHeight=0),we.isCallMediaBeingCaptured||(we.callMediaCapturedBannerHeight=0),we.isIncomingVideoDisabled||(we.incomingVideoDisabledBannerHeight=0),this._showMobileServerMutedToast(we)||(we.serverMuteNotificationBannerHeight=0),this._showCallConnectionQualityToast(we)||(we.callConnectionQualityBannerHeight=0),we.showSpokenLanguageConflict&&!we.isCallOnHold||(we.spokenLangageConflictResolutionViewHeight=0),we.isMobileScreenShareActive||(we.mobileScreenShareBannerHeight=0),we.isTranslated&&!we.translationBannerBeenDismissed||(we.mobileTranslationBannerHeight=0);if(this._callState=f,this._mustUpdateSpeakerMutedAsync(e.callId,we)&&a.defer(()=>{this._updateSpeakerMutedAsync(e.callId).then(e=>{this.isComponentMounted()&&this.setState({isSpeakerMuted:e})})}),!t&&this.state.conversationMri!==u&&!h&&De.default.isUsingSplitViewNoSubscription()){const t=this.state.conversationMri,i=u;a.defer(()=>{k.default.CallNavigationHelper.escalateCallOnUWPSplitedView(t,i,e.callId,_t.default.newCauseId())})}return!(null===(i=oe.default().getConversation(u))||void 0===i?void 0:i.isJoinEnabled())&&(we.hasCallCreatorShareOverlayPopup=!1),we}render(){const e=this._useMobileControls(),t=this.state.useLightTheme?It.callPanelLightTheme:It.callPanelCallStageV2,i=[It.callPanel,this.state.isNewCallScreen?t:void 0];h.StatusBar.isOverlay()&&i.push(Ke.default.paddingTopStyle(this.state.statusBarHeight));const a=Z.isReadOnlyConversation(this.state.conversationMri),n=e&&!this.state.isPSTNCall&&!this.state.isEncryptedCall&&!a,o=this._getTanscriptionRects(e),s=(o&&this._canShowTranscription()&&!e&&this._canShowTranscriptionPanel(o),this.state.panelLayout),r=h.Styles.createViewStyle({width:s.width,height:s.height},!1);let l;if(e){const t=o&&!this.state.mobileSubtitlesRightPanelEnabled?o.stage:s;l=[h.createElement(h.View,{key:"controlscontainer",style:[It.mobileInnerViewBase,r]},this._renderCallStage(t),this._renderReactionsPanel(this.state.shouldShowReactions),this._renderCallingAnimation(s,0,0),this._renderTranscriptionView(s,e),this._renderOptionalAloneInTheCallInformationView(),this._renderTransientView(),this._renderCallControls(this.state.shouldShowReactions,s),this._renderMobileTopBanner(s),this._renderTooltips()),this._renderCallPanelHeader(s),this._renderDialpad(s),this._renderAudioNotification()]}else{const e=this.state.enableDoubleTapToFullScreen?h.GestureView:h.View,t={};this.state.enableDoubleTapToFullScreen&&(t.onDoubleTap=()=>this._toggleFullScreenMode()),l=[h.createElement(e,Object.assign({key:"controlscontainer",style:[It.innerViewBase,r]},t),this._renderCallStage(s),this._renderTray(s),this._renderSkypeLogo(),this._renderCallingAnimation(s,0,0),this._renderOptionalAloneInTheCallInformationView(),this._renderTransientView(),this._renderTranscriptionView(s),this._renderAudioNotification(),this._renderReactionsBar(s,this.state.shouldShowReactions,n),this._renderReactionsPanel(this.state.shouldShowReactions),this._renderCallControls(this.state.shouldShowReactions,s),this._renderCallPanelHeader(s),this._renderDialpad(s),this._renderTooltips(),this._renderCallCreatorShareOverlayPopup(),X.CallingCapabilities.floatableResizableVideoPreviewSupported()?this._renderFloatingVideoPreview():void 0)]}return h.createElement(ie.default,{goBack:this._goBack},h.createElement(h.View,{style:i,onLayout:this._onLayoutChange,onMouseMove:this._onMouseMove,onMouseLeave:this._onMouseLeave},h.createElement(te.CoachMarkContext.Provider,{value:this._coachMarkContext},l)))}componentDidMount(){super.componentDidMount();const e=_t.default.newCauseId();_e.log(pe.LogTraceArea.CallingUI,"componentDidMount causeId: "+e),s.default.enableLowProfileMode().catch(e=>{_e.warn(pe.LogTraceArea.CallingUI,"enableLowProfileMode failed: "+dt.default.errorAsString(e))}),q.default.setCallViewVisible(this.props.callId,!0,e),k.default.CallingStore.unregisterRemoteStreamOverride(this.props.callId,R.VideoOverrideReason.InBackground,e),k.default.CallingStore.unregisterLocalVideoOverride(this.props.callId,R.VideoOverrideReason.InBackground,e),this.state.isIncomingVideoDisabled&&k.default.CallingStore.disableIncomingVideo(this.props.callId,e),this.state.buttonsAndInfoHidden||this._callControlsAnimatedTranslateYValue.setValue(this._controlsTranslateY()),this._subscriptions.push(S.default.subscribeForChanges("CallPanel",this._onAppStateChange)),this._updateAudioState(e),k.default.OngoingCallService.updateVideoState(this.props.callId,h.App.getActivationState()),this._updateLeftNoneStateOnce(e),this.state.callUIState!==j.CallUIState.Default&&this.state.callUIState!==j.CallUIState.Voicemail||this._startParticipantAnimationSuppressionTimeout(),this.state.lockOrientationForIncomingRing&&(_e.log(pe.LogTraceArea.CallingUI,"componentDidMount, entered IncomingRing state, locking orientation causeId: "+e),this._lockOrientationForIncomingRing()),this._callParticipantAccessoryOpacityValue.setValue(this.state.buttonsAndInfoHidden?1:0),this.state.isUsingStackNavigationContext&&(_e.log(pe.LogTraceArea.CallingUI,"componentDidMount, setting keyboard resize mode to None causeId: "+e),be.default.setResizeMode(r.KeyboardAwareResizeMode.None)),this._subscriptions.push(k.default.CallingStore.callDeviceQualityEvent().subscribe(this._updateDeviceQualityState)),this._subscriptions.push(k.default.CallingStore.serverMutedEvent().subscribe(this._updateServerMutedState)),this._subscriptions.push(k.default.CallingStore.deviceNearEndQualityEvent().subscribe(this._updateDeviceNearEndQuality)),this._subscriptions.push(k.default.DeviceStore.selectedDevicesChangedEvent().subscribe(this._selectedDevicesChanged)),this._subscriptions.push(k.default.DeviceStore.availableDevicesChangedEvent().subscribe(this._availableDevicesChanged)),this._subscriptions.push(k.default.DeviceStore.onVideoEffectsQualityChangedEvent().subscribe(this._onVideoEffectsQualityChangedEvent)),de.dismissAll();const t=ct.default.mergeStyles([ct.default.createBackgroundColorStyle(ut.Color.black),ct.default.createBarStyle(lt.BarStyleTheme.Light)]);this._updateStatusBarStyle(t),this._startOrStopOrientationListener(!0),this._registerKeyboardHandlers(),this.state.isChatOpen||B.default.assignOuterThread(this.state.reactionsConversationMri,this.state.conversationMri);const i=this._useMobileControls();i||h.Input.keyUpEvent.subscribe(this._onKeyUp),ke.default.addOrUpdateBottomMargin("callToast",i?82:100),this._maybeShowOrHideDeviceErrorToast(!0,!0,e),this._maybeShowCompositeCallRecordingToast(!1),this._maybeShowCompositeIncomingVideoDisabledToast(!1,e),this._maybeShowCompositeCallConnectionQualityToast(!1,e),this._maybeShowCompositeCameraDeniedToast(),this._maybeShowCompositeTeamsInteropInCallToast(e),this._maybeShowCompositeTogetherModeNoticeInCallToast(e),this._maybeEnableNewCallScreenDesignByDefault(e),this._maybeShowCompositeTranslationInCallToast(e),this.state.controlsType===j.CallControlsType.DesktopMin&&H.default.updateCallTelemetry(this.props.callId,e,e=>e.setEnterMinWidth()),k.default.OngoingCallService.getIsChatSidebarOpen(this.props.callId)&&!this.state.isChatOpen&&this._toggleChatPanel(e),rt.default.callPanelRendered()}componentWillUnmount(){super.componentWillUnmount(),this._hideAllDeviceErrorToasts(),ee.default.closeCoachMark({});const e=_t.default.newCauseId();_e.log(pe.LogTraceArea.CallingUI,"componentWillUnmount causeId: "+e),s.default.disableLowProfileMode().catch(e=>{_e.warn(pe.LogTraceArea.CallingUI,"enableLowProfileMode failed: "+dt.default.errorAsString(e))}),k.default.CallingStore.isCallConnected(this.props.callId)&&H.default.updateCallTelemetry(this.props.callId,e,e=>e.sideNavigateInCall()),B.default.setHasPostedReactions(this.state.reactionsConversationMri,!1),this._subscriptions.forEach(e=>e.unsubscribe()),this._subscriptions=[],q.default.setCallViewVisible(this.props.callId,!1,e),T.default.resetAllVisibility(e),be.default.setResizeMode(r.KeyboardAwareResizeMode.Default),Re.default.removeOrientationLock(this._orientationLockKey),this._startOrStopOrientationListener(!1),this._unregisterKeyboardHandlers(),this._visibilitySubscriptionToken&&(this._visibilitySubscriptionToken.unsubscribe(),this._visibilitySubscriptionToken=void 0),this._useMobileControls()||h.Input.keyUpEvent.unsubscribe(this._onKeyUp),ke.default.removeBottomMargin("callToast"),De.default.isUsingSplitViewNoSubscription()&&this.state.isChatOpen&&Be.default.closeConversationInCall(e,this._getContext()),this.state.newMobileOverflowOpen&&re.default.closeIfNeeded(this._getRootViewId(),e)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const o=_t.default.newCauseId();if(_e.log(pe.LogTraceArea.CallingUI,"componentDidUpdate causeId: "+o),!t.hasBeenPresented&&this.state.hasBeenPresented&&(_e.log(pe.LogTraceArea.CallingUI,"componentDidUpdate, hasBeenPresented: true"),ft.default.setTimeout(()=>{de.dismissAll()},1e3)),t.callUIState!==this.state.callUIState&&(_e.log(pe.LogTraceArea.CallingUI,"componentDidUpdate, callUIState changed: "+j.CallUIState[t.callUIState]+" -> "+j.CallUIState[this.state.callUIState]+" causeId: "+o),this._updateLeftNoneStateOnce(o),t.callUIState===j.CallUIState.GoLiveSinglePlayer&&this.state.callUIState===j.CallUIState.Default)){const e=a.filter(k.default.CallingStore.getRemoteCallMembers(this.props.callId),e=>A.default.isParticipantConnected(e));if(!a.isEmpty(e)){const t=e[0],i=k.default.CallingStore.getRemoteCallMemberMri(this.props.callId,t),a=ue.default.getDisplayName(i)||"";Qe.default.maybeAnnounceForAccessibility(Ie.getString("CallPanel.FirstParticipantJoinAccessibility",{name:a}))}}if(t.lockOrientationForIncomingRing!==this.state.lockOrientationForIncomingRing&&(this.state.lockOrientationForIncomingRing?(_e.log(pe.LogTraceArea.CallingUI,"componentDidUpdate, entered IncomingRing state, locking orientation causeId: "+o),this._lockOrientationForIncomingRing()):(_e.log(pe.LogTraceArea.CallingUI,"componentDidUpdate, left IncomingRing state, unlocking orientation causeId: "+o),Re.default.removeOrientationLock(this._orientationLockKey))),t.outgoingRingStatus!==this.state.outgoingRingStatus&&_e.log(pe.LogTraceArea.CallingUI,"componentDidUpdate, outgoingRingStatus changed: "+t.outgoingRingStatus+" -> "+this.state.outgoingRingStatus+" causeId: "+o),this.state.exitingCall&&!t.exitingCall&&(_e.log(pe.LogTraceArea.CallingUI,"componentDidUpdate, call disconnected, callState = "+this._callState+" terminatedReason = "+this.state.terminatedReason+" endCallNavigationRequested = "+this._endCallNavigationRequested),this._onEscape(),!this._endCallNavigationRequested)){this._endCallNavigationRequested=!0;const e=_t.default.newCauseId();if(this.state.terminatedReason===g.TerminatedReason.PstnInvalidNumber)_e.log(pe.LogTraceArea.CallingUI,"componentDidUpdate, exit call with invalid number causeId: "+e),De.default.isUsingSplitViewNoSubscription()?u.default.closeSplitView(this.props.initialConversationMri):this.state.isUsingStackNavigationContext?Be.default.navigateToHub(e):Be.default.navigateToWelcomeScreen(e);else{_e.log(pe.LogTraceArea.CallingUI,"componentDidUpdate, exit call causeId: "+e);const t=this.state.activeCallsCount>1||this.state.terminatedReason===g.TerminatedReason.Declined||this.state.terminatedReason===g.TerminatedReason.Missed||this.state.terminatedReason===g.TerminatedReason.Cancelled&&!this.state.isCallCreator;this._exitCall(t,!1,e)}}const s=this.state.callUIState===j.CallUIState.Default||this.state.callUIState===j.CallUIState.Voicemail,r=s&&!this._hasConnected,l=!this.state.newMobileOverflowOpen&&t.newMobileOverflowOpen;if(s&&(this.state.buttonsAndInfoHidden!==t.buttonsAndInfoHidden||r||l)&&!this._shouldKeepControlsVisible()){const e=this._useMobileControls()&&!r?this._callControlTimeoutMs:this._callControlShortTimeoutMs;this._startHideControlsTimer(r||!this.state.buttonsAndInfoHidden,e,o),this._hasConnected=!0}if(t.callUIState!==j.CallUIState.Default&&t.callUIState!==j.CallUIState.Voicemail&&s&&(this.state.isCallCreator&&Z.isOneOnOneConversation(this.state.conversationMri)&&k.default.CallPostMessageService.postOneOnOneCallStartedPartListMessage(this.state.conversationMri,this.props.callId),this._startParticipantAnimationSuppressionTimeout()),!this.state.isCallParticipantActionsMenuOpened&&(t.buttonsAndInfoHidden!==this.state.buttonsAndInfoHidden||this.state.isMobileScreenReaderEnabled!==t.isMobileScreenReaderEnabled||this.state.useImmersiveMode!==t.useImmersiveMode||this.state.hideCallControlsForActivity!==t.hideCallControlsForActivity||this.state.isVideoSuggestionTooltipVisible!==t.isVideoSuggestionTooltipVisible)){const e=this._areControlsVisible()||this.state.isMobileScreenReaderEnabled||this.state.isVideoSuggestionTooltipVisible;this._animateShowOrHideControls(e,!0,o),this._showOrHideStatusBar(e),le.default.clearToolTip()}this.state.isLandscape===t.isLandscape&&this.state.bottomSafeAreaInset===t.bottomSafeAreaInset||(this.state.buttonsAndInfoHidden?this._showOrHideStatusBar(!1):(_e.log(pe.LogTraceArea.CallingUI,"componentDidUpdate updating call controls bottom, causeId: "+o),this._callControlsAnimatedTranslateYValue.setValue(this._controlsTranslateY()))),this.state.showDialpad&&!t.showDialpad&&this._animateDialpad(!0,o),(this._isIncomingOrOutgoingRing()||this.state.callUIState===j.CallUIState.GoLiveSinglePlayer)&&this.state.buttonsAndInfoHidden&&this._showOrHideControls(!0,o),this._useMobileControls()||this._areControlsVisible()||this._showOrHideControls(!0,o,{},!0),this.state.conversationMri===t.conversationMri&&this.state.isChatOpen===t.isChatOpen||(this.state.conversationMri!==t.conversationMri&&this.state.isChatOpen&&(Be.default.closeConversationInCall(o,this._getContext()),Be.default.openConversationInCall(o,this.state.conversationMri,this.props.callId,this._getContext(),this._toggleChatPanel)),this.state.isChatOpen?B.default.clearOuterThreadAssignment(this.state.reactionsConversationMri,this.state.conversationMri):B.default.assignOuterThread(this.state.reactionsConversationMri,this.state.conversationMri)),this.state.isTranslating!==t.isTranslating&&(this.state.isTranslating?z.default.assignCallId(this.state.reactionsConversationMri,this.props.callId):(z.default.clearCallIdAssignment(this.state.reactionsConversationMri),k.default.OngoingCallService.setIsSubtitleHistoryOpen(this.props.callId,!1))),this._maybeShowOrHideDeviceErrorToast(t.hasMicrophones,t.hasSpeakers,o),this._maybeShowCompositeCallRecordingToast(t.isRecording),this._maybeShowCompositeIncomingVideoDisabledToast(t.isIncomingVideoDisabled,o),this._maybeShowCompositeCallConnectionQualityToast(t.callNetworkQualityPoor,o),this._maybeShowCompositeCameraDeniedToast(),this._maybeShowCompositeTeamsInteropInCallToast(o),this._maybeShowCompositeTogetherModeNoticeInCallToast(o),this._maybeEnableNewCallScreenDesignByDefault(o),this._maybeShowCompositeTranslationInCallToast(o),t.controlsType!==this.state.controlsType&&this.state.controlsType===j.CallControlsType.DesktopMin&&H.default.updateCallTelemetry(this.props.callId,o,e=>e.setEnterMinWidth()),this.state.isProvidingVideo!==t.isProvidingVideo&&Q.default.announceVideoState(this.state.isProvidingVideo),this.state.isCallOnHold!==t.isCallOnHold&&(Q.default.announceHoldState(this.state.isCallOnHold),!this.state.isCallOnHold&&this._callControls&&this._callControls.toggleReactionsPickerButton(!1,!1));const c=t.selectedCamera&&t.selectedCamera.position,d=this.state.selectedCamera&&this.state.selectedCamera.position;c!==g.CameraPosition.Unknown&&d!==g.CameraPosition.Unknown&&c!==d&&Q.default.announceCameraDirectionState(d),this.state.callAudioOutputRoute!==n.default.AudioOutputEarpiece&&t.callAudioOutputRoute===n.default.AudioOutputEarpiece&&(this.setState({showSpeakerOnWarning:!0}),a.isUndefined(this._speakerOnWarningTimeout)||ft.default.clearTimeout(this._speakerOnWarningTimeout),this._speakerOnWarningTimeout=ft.default.setTimeout(()=>{this._speakerOnWarningTimeout=void 0,this.isComponentMounted()&&this.setState({showSpeakerOnWarning:!1})},5e3)),this.state.isNavigatingWithKeyboard!==t.isNavigatingWithKeyboard&&this._showOrHideControls(this.state.isNavigatingWithKeyboard,o),this.state.isChatOpen!==t.isChatOpen&&k.default.OngoingCallService.setIsChatSidebarOpen(this.props.callId,this.state.isChatOpen)}_lockOrientationForIncomingRing(){Re.default.addOrUpdateOrientationLock(this._orientationLockKey,s.DeviceOrientation.Portrait),this.setState({isLandscape:!1})}_exitCall(e,t,i){_e.log(pe.LogTraceArea.CallingUI,"_exitCall shouldNavigateBack: "+e+" causeId: "+i),this._onNavigatedAwayFromCall(i);const a=this.state.isPSTNCall&&this.state.knownPSTNContactMri||this.props.initialConversationMri;Be.default.navigateCallComplete(a,e,t,this._getContext(),i)}_maybeShowCompositeCameraDeniedToast(){!this._useMobileControls()&&this._shouldShowCameraDeniedToast()&&(_e.log(pe.LogTraceArea.CallingUI,"CallPanel._maybeShowCompositeCameraDeniedToast, showing toast"),this._hasShownCameraDeniedToast=!0,k.default.CallNavigationHelper.showCameraDeniedToast({callId:this.props.callId,conversationMri:this.state.conversationMri}))}_shouldShowCameraDeniedToast(){return!!this.props.convertedVideoToAudio&&!this._hasShownCameraDeniedToast&&!this.state.hideCameraDeniedToast&&this.state.isCallActive}_maybeShowCompositeCallRecordingToast(e){this._useMobileControls()||!this.state.isRecording||e||(_e.log(pe.LogTraceArea.CallingUI,"CallPanel._maybeShowCallRecordingToast, showing toast"),k.default.CallNavigationHelper.showCallRecorderToast({callId:this.props.callId,conversationMri:this.state.conversationMri,action:(e,t)=>{t&&this._callControls&&this._callControls.focusCallEndButton()}}))}_maybeShowCompositeIncomingVideoDisabledToast(e,t){this._useMobileControls()||!this.state.isIncomingVideoDisabled||e||(_e.log(pe.LogTraceArea.CallingUI,"CallPanel._maybeShowIncomingVideoDisabledToast.  causeId "+t),k.default.CallNavigationHelper.showIncomingVideoDisabledToast({callId:this.props.callId,conversationMri:this.state.conversationMri},t))}_maybeShowCompositeTeamsInteropInCallToast(e){!this._useMobileControls()&&this._shouldShowTeamsInteropToast()&&(_e.log(pe.LogTraceArea.CallingUI,"CallPanel._maybeShowCompositeTeamsInteropInCallToast.  causeId "+e),this._hasShownTeamsInteropBanner=!0,k.default.CallNavigationHelper.showGeneralPurposeInCallToast({toastType:ne.ToastType.TeamsInterop,callId:this.props.callId,conversationMri:this.state.conversationMri},e))}_maybeShowCompositeTogetherModeNoticeInCallToast(e){!this._useMobileControls()&&this._shouldShowTogetherModeNoticeToast()&&(_e.log(pe.LogTraceArea.CallingUI,"CallPanel._maybeShowCompositeTogetherModeNoticeInCallToast.  causeId "+e),this._hasShownTogetherModeNoticeBannerForCallId=!0,Ee.default.setTogetherModeNoticePresentedForCallId(this.props.callId),k.default.CallNavigationHelper.showGeneralPurposeInCallToast({toastType:ne.ToastType.TogetherModeNotice,callId:this.props.callId,conversationMri:this.state.conversationMri},e))}_maybeEnableNewCallScreenDesignByDefault(e){Ee.default.canEnableNewCallScreenDesignByDefaultNoSubscription()&&Ee.default.setNewCallScreenDesignEnabled(!0);const t=y.default.getS4LCMCFeaturesNoSubscription().newCallScreenEnabledByDefault;this.state.isNewCallScreen&&!this.state.wasNewCallScreenRevertNoticeDismissed&&t&&(this._useMobileControls()?this.setState({renderMobileNewCallScreenRevertNotice:!0}):k.default.CallNavigationHelper.showGeneralPurposeInCallToast({toastType:ne.ToastType.NewCallScreenRevertNotice,callId:this.props.callId,conversationMri:this.state.conversationMri,onDismiss:this._onNewCallScreenRevertNoticeDismiss},e))}_shouldShowTeamsInteropToast(){return Z.isS4BBridgeMri(this.state.conversationMri)&&!this._hasShownTeamsInteropBanner&&!this.state.hideTeamsInteropToast&&this.state.isCallActive}_shouldShowTogetherModeNoticeToast(){return this.state.isPossiblyNotConnectedAudienceBotInCall&&!this._hasShownTogetherModeNoticeBannerForCallId&&this.state.hideTogetherModeNoticeToastForCallId!==this.props.callId&&this.state.isCallActive}_maybeShowCompositeTranslationInCallToast(e){this._useMobileControls()||!this.state.isTranslated||this.state.translationBannerBeenDismissed||(_e.log(pe.LogTraceArea.CallingUI,"CallPanel._maybeShowCompositeTranslationInCallToast.  causeId "+e),k.default.CallNavigationHelper.showTranslationInCallToast({callId:this.props.callId,conversationMri:this.state.conversationMri},e))}_maybeShowCompositeCallConnectionQualityToast(e,t){this._useMobileControls()||!this.state.callNetworkQualityPoor||e||(_e.log(pe.LogTraceArea.CallingUI,"CallPanel._maybeShowCallConnectionQualityToast.  causeId "+t),k.default.CallNavigationHelper.showCallConnectionQualityToast({callId:this.props.callId,conversationMri:this.state.conversationMri},t))}_maybeShowOrHideDeviceErrorToast(e,t,i){this.state.callUIState!==j.CallUIState.Default&&this.state.callUIState!==j.CallUIState.Voicemail||(this.state.hasMicrophones||!e&&this._hasShownNoMicrophoneConnectedToast?this.state.hasSpeakers||!this.state.isAudioOutputSelectionSupported||!t&&this._hasShownNoSpeakerConnectedToast||(this._showDeviceErrorToast(j.DeviceStatusToastType.SpeakerDisconnected,i),this._hasShownNoSpeakerConnectedToast||(this._hasShownNoSpeakerConnectedToast=!0)):(this._showDeviceErrorToast(j.DeviceStatusToastType.MicrophoneDisconnected,i),this._hasShownNoMicrophoneConnectedToast||(this._hasShownNoMicrophoneConnectedToast=!0))),this.state.hasSpeakers&&!t&&this._hideDeviceErrorToastOfType(j.DeviceStatusToastType.SpeakerDisconnected),this.state.hasMicrophones&&!e&&this._hideDeviceErrorToastOfType(j.DeviceStatusToastType.MicrophoneDisconnected)}_hideAllDeviceErrorToasts(){a.each(this._deviceErrorToasts,e=>k.default.CallNavigationHelper.hideToast(e)),this._deviceErrorToasts={}}_hideDeviceErrorToastOfType(e){this._deviceErrorToasts[e]&&(k.default.CallNavigationHelper.hideToast(this._deviceErrorToasts[e]),delete this._deviceErrorToasts[e])}_showDeviceErrorToast(e,t,i,a){const n=Q.default.getToastInformation(e,i,a,i=>{H.default.trackInCallUFD(this.props.callId,e,i),H.default.updateCallTelemetry(this.props.callId,t,e=>e.ufdDisplayed(i))});if(n){this._hideDeviceErrorToastOfType(e);const t=k.default.CallNavigationHelper.showNotificationToast(n);t&&(this._deviceErrorToasts[e]=t)}}_showDeviceChangeToast(e,t,i){const n=k.default.DeviceStore.isSelectedCompositeAudioDevice(e);n&&e.push(n),a.isEmpty(a.filter(e,e=>e.kind!==g.DeviceType.Camera))||(_e.log(pe.LogTraceArea.CallingUI,"_showDeviceChangeToast: remove composite audio device toast if presented"),this._hideDeviceErrorToastOfType(j.DeviceStatusToastType.CompositeAudioAvailable)),e.forEach(e=>{switch(e.kind){case g.DeviceType.Camera:this._showDeviceErrorToast(j.DeviceStatusToastType.CameraChanged,i,{deviceName:e.label});break;case g.DeviceType.Microphone:n||this._showDeviceErrorToast(j.DeviceStatusToastType.MicrophoneChanged,i,{deviceName:e.label});break;case g.DeviceType.Speaker:n||this._showDeviceErrorToast(j.DeviceStatusToastType.SpeakerChanged,i,{deviceName:e.label});break;case g.DeviceType.CompositeAudioDevice:if(n)this._hideDeviceErrorToastOfType(j.DeviceStatusToastType.MicrophoneChanged),this._hideDeviceErrorToastOfType(j.DeviceStatusToastType.SpeakerChanged),this._showDeviceErrorToast(j.DeviceStatusToastType.CompositeAudioAvailable,i,{deviceName:n.label});else if(!t){const t=e,a=()=>this._hideDeviceErrorToastOfType(j.DeviceStatusToastType.CompositeAudioAvailable),n=[{labelKey:"StartCallUtils.ConfirmButtonText",callback:()=>{k.default.DeviceStore.choosePreferredDevices({microphone:t.microphoneId,speaker:t.speakerId},i),a()}},{labelKey:"StartCallUtils.CancelButtonText",callback:a}];this._showDeviceErrorToast(j.DeviceStatusToastType.CompositeAudioAvailable,i,{deviceName:t.label},n)}}})}_navigateToChat(e,t,i){_e.log(pe.LogTraceArea.CallingUI,"_navigateToChat, causeId: "+i),this.state.isUsingStackNavigationContext?(_e.log(pe.LogTraceArea.CallingUI,"_navigateToChat, exit to conversation, causeId: "+i),H.default.updateCallTelemetry(this.props.callId,i,e=>e.chatOpened()),this._exitCall(e,t,i)):this._toggleChatPanel(i)}_toggleLeftPanelForAction(e,t,i){_e.log(pe.LogTraceArea.CallingUI,"_toggleLeftPanelForAction causeId: "+i),e().completeAction()}_closeRightPanel(e,t){_e.log(pe.LogTraceArea.CallingUI,"_closeRightPanel causeId: "+t),e()}_animateShowOrHideControls(e,t,i){const a=e?1:0,n=e?0:-1e3,o=e?0:1,s=this._isIncomingOrOutgoingRing()?0:1-o,r=this._useMobileControls();let l,c;if(r||e||r&&!this.state.hideCallControlsForActivity&&!this.state.useImmersiveMode?(l=!0,c=this._controlsTranslateY()):(l=!1,c=r?85:j.DesktopCallControlsHeight+30),_e.log(pe.LogTraceArea.CallingUI,"_animateShowOrHideControls showControls:"+e+" adjustedShowControls: "+l+" hideCallControlsForActivity "+this.state.hideCallControlsForActivity+" useImmersiveMode: "+this.state.useImmersiveMode+" animated: "+t+" causeId: "+i),r||this._newCompositeReactionsAnimatedOpacityValue.setValue(e?1:0),e&&(this._callHeaderAnimatedTranslateYValue.setValue(n),this._callControlsAnimatedTranslateYValue.setValue(c)),this._controlsAnimation&&this._controlsAnimation.stop(),t){this._controlsAnimation=h.Animated.parallel([d.timing.easeOut({value:this._callHeaderAnimatedOpacityValue,toValue:a}),d.timing.easeOut({value:this._callControlsAnimatedOpacityValue,toValue:s}),d.timing.easeOut({value:this._topBannerAnimatedOpacityValue,toValue:o}),d.timing.easeOut({value:this._callStageOverlayOpacityValue,toValue:s}),d.timing.easeOut({value:this._callParticipantAccessoryOpacityValue,toValue:o}),d.timing.easeOut({value:this._callParticipantTooltipOpacityValue,toValue:s})]),this._controlsAnimation.start(t=>{this._maybeCompleteRenderCallControlsScenario(),t.finished?(delete this._controlsAnimation,this._callHeaderAnimatedTranslateYValue.setValue(n),this._callControlsAnimatedTranslateYValue.setValue(c)):(_e.log(pe.LogTraceArea.CallingUI,"componentDidUpdate buttonsAndInfoHidden animation did not complete, causeId "+i),e===this._areControlsVisible()&&this._animateShowOrHideControls(!this.state.buttonsAndInfoHidden,!1,i))});const t=this._renderCallControlsScenario;t&&t.markStepCompleted("StartedAnimation")}else this._topBannerAnimatedOpacityValue.setValue(o),this._callHeaderAnimatedOpacityValue.setValue(a),this._callHeaderAnimatedTranslateYValue.setValue(n),this._callControlsAnimatedTranslateYValue.setValue(c),this._callParticipantAccessoryOpacityValue.setValue(o),this._callParticipantTooltipOpacityValue.setValue(s),this._callStageOverlayOpacityValue.setValue(s),this._maybeCompleteRenderCallControlsScenario()}_maybeCompleteRenderCallControlsScenario(){const e=this._renderCallControlsScenario;e&&(e.markStepCompleted("MadeOpaque"),this._renderCallControlsScenario=void 0,a.defer(()=>{e.markStepCompleted("backOnJSThread"),e.finish()}))}_areControlsVisible(){return!this.state.buttonsAndInfoHidden}_coachMarksBeingShown(){return ee.default.isCoachMarkBeingShown({areaType:te.CoachMarkAreaType.CallPanel})}_clearHideControlsTimer(){this._hideControlsTimer&&(ft.default.clearTimeout(this._hideControlsTimer),this._hideControlsTimer=void 0)}_startHideControlsTimer(e,t,i){this._isIncomingOrOutgoingRing()||!this.isComponentMounted()||this.state.isCallParticipantActionsMenuOpened||(this._clearHideControlsTimer(),e&&!this.state.buttonsAndInfoHidden&&(this._hideControlsTimer=ft.default.setTimeout(()=>{this.isComponentMounted()&&!this._isIncomingOrOutgoingRing()&&this._showOrHideControls(!1,i)},t)))}_renderTranscriptionView(e,t){if(this.state.isSubtitlesPanelOpen||!this._canShowTranscription())return;const i=this._transcriptionLayout(!1,t),a=G.default.getTranscriptionLayoutRects(e,i),n=h.Styles.createViewStyle({position:"absolute",left:a.isHorizontal?0:a.stage.width,right:0,top:a.isHorizontal?a.stage.height:a.subtitles.y,bottom:0},!1),o=this._getTranscriptionBottomPadding();return h.createElement(W.default,{style:n,key:"callTranscriptionView",callId:this.props.callId,reactionsMri:this.state.reactionsConversationMri,bottomPadding:o,showControls:!this.state.buttonsAndInfoHidden,onPressOpen:this._onPressOpenSubtitleHistory})}_renderTransientView(){let e;if(this.state.isCallOnHold){const t=k.default.OngoingCallService.getOnHoldForInterruption(this.props.callId)?k.default.CallingStore.isCallKitCall(this.props.callId)?this._requestResumeCall:this._requestEndInterruption:void 0;e=h.createElement(K.default,{key:"callTransientStateView",type:K.CallTransientStateViewType.Hold,header:Ie.getString("CallPanel.OnHoldHeader"),onPress:t,ignorePointerEvents:!0})}else this.state.isReconnectUIEnabled&&this.state.callReconnectionState===R.NetworkConnectionState.Connecting?(H.default.updateCallTelemetry(this.props.callId,"renderTransientView",e=>e.showedReconnectUI()),e=h.createElement(K.default,{key:"callTransientStateView",type:K.CallTransientStateViewType.Reconnect,header:Ie.getString("CallPanel.ReconnectingHeader"),body:Ie.getString("CallPanel.ReconnectingBody"),blockPointerEvents:!0})):this.state.callReconnectionState===R.NetworkConnectionState.LostConnection&&(e=h.createElement(K.default,{key:"callTransientStateView",type:K.CallTransientStateViewType.Reconnect,header:Ie.getString("CallPanel.NoNetworkHeader"),body:Ie.getString("CallPanel.NoNetworkBody"),blockPointerEvents:!0}));return e}_renderMobileTopBanner(e){if(!this._useMobileControls())return;let t,i,n,o,s,r,l,c,d,u,p=this.state.topSafeAreaHeight;if(this._shouldShowCameraDeniedToast()&&(i=h.createElement(Ze.default,{closeToast:this._closeCameraDeniedToast,onDesiredHeightChanged:this._onCameraDeniedToastHeightChanged,topInset:p}),p=0),this.state.isRecording&&(t=h.createElement(Ye.default,{callId:this.props.callId,conversationMri:this.state.conversationMri,topInset:p,viewWidth:e.width,onDesiredHeightChanged:this._onRecordingBannerHeightChanged,onPress:this._onCallRecordingPress}),p=0),this.state.isNdiBeingUsed&&(n=h.createElement(Je.LocalStackNavCallMediaCapturerToast,{topInset:p,viewWidth:e.width,onDesiredHeightChanged:this._onNdiUsedBannerHeightChanged}),p=0),this.state.isCallMediaBeingCaptured&&!this.state.isCallOnHold){const t=this.state.remoteParticipantsThatAreCapturingCallMedia[0];o=h.createElement(Je.RemoteStackNavCallMediaCapturerToast,{callId:this.props.callId,conversationMri:this.state.conversationMri,initiatorMri:t,topInset:p,viewWidth:e.width,onDesiredHeightChanged:this._onCallMediaCapturedBannerHeightChanged}),p=0}this.state.isIncomingVideoDisabled&&!this.state.isCallOnHold&&(s=h.createElement(tt.default,{callId:this.props.callId,conversationMri:this.state.conversationMri,topInset:p,onDesiredHeightChanged:this._onIncomingVideoDisabledBannerHeightChanged}),p=0),this.state.showSpokenLanguageConflict&&!this.state.isCallOnHold&&(r=h.createElement(nt.default,{topInset:p,onDesiredHeightChanged:this._onSpokenLangageConflictResolutionViewChanged,callId:this.props.callId}),p=0),this._showCallConnectionQualityToast(this.state)&&(l=h.createElement($e.default,{callId:this.props.callId,conversationMri:this.state.conversationMri,topInset:p,onDesiredHeightChanged:this._onCallConnectionQualityBannerHeightChanged}),p=0),this._showMobileServerMutedToast(this.state)&&(c=h.createElement(at.default,{callId:this.props.callId,conversationMri:this.state.conversationMri,topInset:p,onDesiredHeightChanged:this._onServerMuteNotificationBannerHeightChanged}),p=0),this.state.isMobileScreenShareActive&&!this.state.isCallOnHold&&(d=h.createElement(it.default,{callId:this.props.callId,conversationMri:this.state.conversationMri,isEncryptedCall:this.state.isEncryptedCall,isPSTNCall:this.state.isPSTNCall,topInset:p,onDesiredHeightChanged:this._onMobileScreenShareBannerHeightChanged}),p=0),this._shouldShowTeamsInteropToast()&&(u=h.createElement(ot.default,{closeToast:this._closeTeamsInteropToast,onDesiredHeightChanged:this._onMobileTeamsInteropBannerHeightChanged,topInset:p,conversationMri:this.state.conversationMri}),p=0);let g,C=[];return this._shouldShowTogetherModeNoticeToast()&&(C.push(h.createElement(et.default,{type:ne.ToastType.TogetherModeNotice,closeToast:this._closeTogetherModeNoticeToast,onDesiredHeightChanged:this._onMobileTogetherModeNoticeBannerHeightChanged,topInset:p,conversationMri:this.state.conversationMri})),p=0),this.state.renderMobileNewCallScreenRevertNotice&&(C.push(h.createElement(et.default,{type:ne.ToastType.NewCallScreenRevertNotice,closeToast:this._onNewCallScreenRevertNoticeDismiss,onDesiredHeightChanged:this._onMobileNewCallScreenRevertNoticeBannerHeightChanged,topInset:p,conversationMri:this.state.conversationMri})),p=0),this.state.isTranslated&&!this.state.translationBannerBeenDismissed&&this.state.isCallActive&&(g=h.createElement(st.default,{callId:this.props.callId,onDesiredHeightChanged:this._onMobileTranslationBannerHeightChanged,topInset:p,conversationMri:this.state.conversationMri}),p=0),t||n||o||s||i||r||c||l||d||g||u||!a.isEmpty(C)?h.createElement(h.Animated.View,{style:It.topBanner,ignorePointerEvents:!0},t,s,r,c,n,o,l,i,d,g,u,C):void 0}_renderReactionsBar(e,t,i){if(!t)return;const a=[It.reactionsBar,this._newCompositeReactionsAnimatedOpacityStyle,Ct.default.floatingStyle];return h.createElement(h.Animated.View,{key:"reactionsBar",style:a,ignorePointerEvents:!0},h.createElement(L.default,{ref:this._onReactionsBarRef,style:It.reactionsBarCompositeInner,ignorePointerEvents:!0,conversationMri:this.state.conversationMri,reactionsConversationId:this.state.reactionsConversationMri,callId:this.props.callId,minDrawerHeight:360,controlsType:this.state.controlsType,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,viewDimensions:e,activitiesEnabled:i,isShowingChat:this.state.isChatOpen,bottomSafeAreaInset:this.state.isLandscape?0:this.state.bottomSafeAreaInset,audioNotificationOffset:30,onDesiredHeightChanged:this.state.isUsingStackNavigationContext?this._onReactionsBarDesiredHeight:void 0,onCaptureMomentPress:this._reactionsBarOnCaptureMomentPress,onChatButtonPress:this._navigateToChatNotBack,onGalleryButtonPress:this._onOpenGalleryWithoutMessage,onReactionsDrawerOpen:this._onReactionsDrawerOpen,useDesktopCallControls:!this._useMobileControls()}))}_renderReactionsPanel(e){if(!e)return;const t=this._useMobileControls(),i=this.state.isUsingStackNavigationContext&&t?void 0:65,a=this.state.isUsingStackNavigationContext&&t?void 0:50;return h.createElement(h.Animated.View,{key:"reactionsPanel",style:It.fullScreenView,ignorePointerEvents:!0},h.createElement(He.default,{callId:this.props.callId,conversationMri:this.state.conversationMri,bottomStyle:this._reactionsPanelAnimatedBottomStyle,reactionsConversationMri:this.state.reactionsConversationMri,isDesktop:!this.state.isUsingStackNavigationContext,desktopBottomMargin:i,desktopSideMargin:a,sizePhotosToFit:!this.state.isUsingStackNavigationContext&&t,photoTapDelay:this.state.isUsingStackNavigationContext||t?0:500,useHighContrastTheme:this.state.useHighContrastTheme,onPhotoTap:this._onOpenGallery,onPhotoDismissed:this._pulseAnimationOnChatButton,areMobileCallControlsVisible:t&&this._areControlsVisible()}))}_innerViewStyleHeight(e,t){return this.state.isNewCallScreen?t?e.height-j.DesktopNewHeaderHeight:e.height-j.DesktopCallControlsHeight-j.DesktopNewHeaderHeight-(this.state.shouldShowTray?j.DesktopTopTrayHeight:0):t?e.height:e.height-j.DesktopCallControlsHeight}_renderTray(e){return this.state.shouldShowTray?h.createElement(wt.CallTrayView,{key:"callTrayView",conversationMri:this.state.conversationMri,callId:this.props.callId,callParticipantTooltipStyle:this._callParticipantNameTooltipStyle,hideNameTag:this.state.callUIState===j.CallUIState.GoLiveSinglePlayer,onCallParticipantContextMenuOpened:this.state.enableStopCallControlTimerWhenActionsMenuOpened?this._callParticipantActionsMenuOpened:void 0,onCallParticipantContextMenuDismissed:this.state.enableStopCallControlTimerWhenActionsMenuOpened?this._callParticipantActionsMenuClosed:void 0,isOneOnOneConversation:this.state.isOneOnOneConversation,disableReactions:this.state.isEncryptedCall,reactionsConversationId:this.state.reactionsConversationMri,onTextReactionPressed:this._navigateToChatNotBack,viewRect:e,onOverflowButtonPress:this._onShowParticipants,stageMode:this.state.stageLayoutMode,useLightTheme:this.state.useLightTheme}):void 0}_renderCallStage(e){const t=this._useMobileControls();let i=[It.fullScreenView];if(this.state.isNewCallScreen){const e=j.DesktopNewHeaderHeight+(this.state.shouldShowTray?j.DesktopTopTrayHeight:0);i.push(h.Styles.createViewStyle({top:e},!1))}let a=h.Styles.createViewStyle({width:e.width,height:this._innerViewStyleHeight(e,t)},!1);i.push(a);let o=this.state.skipRenderingParticipants||this.state.exitingCall?j.CallStageViewMode.None:this.state.callUIState!==j.CallUIState.Default?j.CallStageViewMode.StageOnly:j.CallStageViewMode.StageAndRibbon;this.state.callUIState===j.CallUIState.GoLiveSinglePlayer&&(o=j.CallStageViewMode.StageAndRibbon);const s=!(this.state.isInCallGalleryOpenOnMobile||this.state.isInCallSubtitleHistoryModeOnMobile);let r=e.width-(this.state.isDesktopMin?60:this.state.titleWidth);this.state.buttonsAndInfoHidden&&this.state.enableImmersiveModeRibbon&&!t&&(r=e.width-20);const l=this._getTopInset();return this.state.isNewCallScreen?h.createElement(U.CallStageViewV2,{key:"callStageView",style:i,conversationMri:this.state.conversationMri,callId:this.props.callId,viewRect:e,hideNameTag:this.state.callUIState===j.CallUIState.GoLiveSinglePlayer,onCallParticipantContextMenuOpened:this.state.enableStopCallControlTimerWhenActionsMenuOpened?this._callParticipantActionsMenuOpened:void 0,onCallParticipantContextMenuDismissed:this.state.enableStopCallControlTimerWhenActionsMenuOpened?this._callParticipantActionsMenuClosed:void 0,isOneOnOneConversation:this.state.isOneOnOneConversation,disableReactions:this.state.isEncryptedCall,reactionsConversationId:this.state.reactionsConversationMri,onTextReactionPressed:this._navigateToChatNotBack,isLandscape:this.state.isLandscape,stageLayoutMode:this.state.stageLayoutMode,useLightTheme:this.state.useLightTheme}):h.createElement(N.default,{key:"callStageView",style:i,conversationMri:this.state.conversationMri,isEncryptedCall:this.state.isEncryptedCall,isPSTNCall:this.state.isPSTNCall,callId:this.props.callId,disableReactions:this.state.isEncryptedCall,viewRect:e,availableRibbonWidth:r,callControlsType:this.state.controlsType,callParticipantOpacityStyle:this._callParticipantAccessoryOpacityStyle,callParticipantTooltipStyle:this._callParticipantNameTooltipStyle,callStageOverlayOpacityStyle:this._callStageOverlayOpacityStyle,callHeaderOpacityStyle:this._callHeaderAnimatedStyle,reactionsConversationId:this.state.reactionsConversationMri,baseStageMode:o,useMobileControls:t,isLandscape:this.state.isLandscape,hideFullscreenIcon:this._isIncomingOrOutgoingRing(),layoutAnimationEnabled:!this.state.suppressParticipantAnimation,callPanelHeaderLayout:this.state.callPanelHeaderLayout,showRibbonExtras:!t&&!this.state.buttonsAndInfoHidden,isRoutedToEarpiece:this.state.callAudioOutputRoute===n.default.AudioOutputEarpiece,topInset:l,enableNewCaptureActivityPip:this.state.enableNewCaptureActivityPip,isVideoTarget:s,isDesktopMin:this.state.isDesktopMinCallRibbon,onStageTap:this._onStageTapped,onDragChange:this._onParticipantDragChange,onStageChange:this._onStageChange,onRemainderViewPressed:this._onShowOrHideRoster,onAddToCallPressed:this._onAddToCallPressed,onCallPanelHeaderLayoutChange:t?void 0:this._onCallPanelHeaderLayoutChange,onTextReactionPressed:this._navigateToChatNotBack,onUseImmersiveModeChange:this._onUseImmersiveModeChange,useHighContrastTheme:this.state.useHighContrastTheme,isIncomingOrOutgoingRing:this._isIncomingOrOutgoingRing(),useHighContrastHeaderTheme:this._useHighContrastHeader(),audioNotificationOffset:30,onParticipantViewTapped:this._onToggleLocalVideoSource,showFullScreenOptionInRibbonSettings:this.state.showFullScreenOptionInRibbonSettings,hideNameTag:this.state.callUIState===j.CallUIState.GoLiveSinglePlayer,onCallParticipantContextMenuOpened:this.state.enableStopCallControlTimerWhenActionsMenuOpened?this._callParticipantActionsMenuOpened:void 0,onCallParticipantContextMenuDismissed:this.state.enableStopCallControlTimerWhenActionsMenuOpened?this._callParticipantActionsMenuClosed:void 0,onVideoPreviewFloating:X.CallingCapabilities.floatableResizableVideoPreviewSupported()?this._onVideoPreviewFloating:void 0,enableFloatableResizableVideoPreview:X.CallingCapabilities.floatableResizableVideoPreviewSupported(),containerOffsetX:this._currentLeftPanelWidth(),areCallControlsVisible:!this.state.buttonsAndInfoHidden,enableNewCallScreen:this.state.isNewCallScreen,showParticipantsButton:!0,stageLayoutMode:this.state.stageLayoutMode})}_shouldShowParticipantsButtonInCallControls(){return this.state.isNewCallScreen||this.state.enableParticipantsButtonInCallControls||Q.default.isInPresentationMode(this.state.stageLayoutMode)}_renderFloatingVideoPreview(){return!this.state.isNewCallScreen&&this.state.shouldRenderFloatingVideoPreview&&this.state.floatingVideoPreviewView?this.state.floatingVideoPreviewView:void 0}_renderCallingAnimation(e,t,i){if(!this._isIncomingOrOutgoingRing()||!e.width||!e.height)return;const n=this.state.isProvidingVideo?void 0:h.createElement(M.default,{conversationId:this.state.conversationMri,useLightTheme:this.state.useLightTheme});let o=[It.callingAnimationContainer];return o.push(h.Styles.createViewStyle({top:t,bottom:a.isUndefined(i)?void 0:i},!1)),this._isIncomingOrOutgoingRing()&&n?h.createElement(h.View,{key:"callAnimation",style:o},n):void 0}_renderTooltips(){return h.createElement(bt.default,{callId:this.props.callId,anchor:this._videoToolTipAnchor,containerOffsetX:this._currentLeftPanelWidth()})}_renderCallPanelHeader(e){const t=this._useMobileControls(),i=!this._isIncomingOrOutgoingRing()&&!this.state.isUsingStackNavigationContext&&Z.isThread(this.state.conversationMri)&&!this.state.isEncryptedCall,a=[];a.push(this.state.renderHeaderV2?It.headerContainerV2:It.headerContainer),a.push(this._callHeaderAnimatedStyle);let n,o,s=0;h.StatusBar.isOverlay()&&!this.state.isLandscape&&(s+=this.state.statusBarHeight),t&&(s+=this._getBannersHeight()),a.push(Ke.default.marginTopStyle(s)),this.state.isUsingStackNavigationContext||(n=this._onShowOrHideRoster,o=this._onCallTitleLayout);const r=this.state.isPSTNCall&&this.state.knownPSTNContactMri||this.state.conversationMri;return this.state.renderHeaderV2?this._renderCallPanelHeaderV2(a,r,e,i,t,this._onShowOrHideProfile,n,o):this._renderCallPanelHeaderV1(a,r,e,i,t,this._onShowOrHideProfile,n,o)}_renderCallPanelHeaderV1(e,t,i,a,n,o,s,r){return h.createElement(h.Animated.View,{key:"callpanelheader"+this.state.callPanelHeaderLayout,style:e,ignorePointerEvents:!0},h.createElement(E.default,{callId:this.props.callId,conversationId:t,maxTitleWidth:this._maxTitleWidth(i),minimized:this.state.buttonsAndInfoHidden,isCallActive:this.state.callUIState===j.CallUIState.Default||this.state.callUIState===j.CallUIState.Voicemail,outgoingRingStatus:this.state.outgoingRingStatus,showParticipantCount:a,hideBackButton:this.state.callUIState===j.CallUIState.IncomingRing,incomingOrOutgoingRing:this._isIncomingOrOutgoingRing(),isDialPadShowing:this.state.showDialpad,isLandscape:this.state.isLandscape,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,useMobileControls:n,onTitlePress:o,onRosterPressed:s,onBingBackgroundsPressed:this._onBingBackgroundsPressed,onBackButtonPressed:this._onHeaderBackButtonPressed,onRecentsButtonPressed:this._onRecentsButtonPressed,isRecentsOpen:this.state.isRecentsOpen,onTitleLayout:r,onToggleCameraDirection:this._onToggleLocalVideoSource,onGalleryPress:this._toggleGalleryPanel,useHighContrastTheme:this._useHighContrastHeader(),callPanelHeaderLayout:this.state.callPanelHeaderLayout,isNewCameraFlipEnabled:this.state.enableNewCameraFlipFlow,onDynamicAudioChoice:this._onDynamicAudioChoice}))}_renderCallPanelHeaderV2(e,t,i,a,n,o,s,r){return h.createElement(h.Animated.View,{key:"callpanelheader"+this.state.callPanelHeaderLayout,style:e,ignorePointerEvents:!0},h.createElement(vt.default,{callId:this.props.callId,conversationId:t,maxTitleWidth:this._maxTitleWidth(i),minimized:this.state.buttonsAndInfoHidden,isCallActive:this.state.callUIState===j.CallUIState.Default||this.state.callUIState===j.CallUIState.Voicemail,outgoingRingStatus:this.state.outgoingRingStatus,showParticipantCount:a,hideBackButton:this.state.callUIState===j.CallUIState.IncomingRing,incomingOrOutgoingRing:this._isIncomingOrOutgoingRing(),isDialPadShowing:this.state.showDialpad,isLandscape:this.state.isLandscape,useMobileControls:n,onTitlePress:o,onRosterPressed:s,onBingBackgroundsPressed:this._onBingBackgroundsPressed,onBackButtonPressed:this._onHeaderBackButtonPressed,onRecentsButtonPressed:this._onRecentsButtonPressed,isRecentsOpen:this.state.isRecentsOpen,onTitleLayout:r,onToggleCameraDirection:this._onToggleLocalVideoSource,useHighContrastTheme:this._useHighContrastHeader(),useLightTheme:this.state.useLightTheme,callPanelHeaderLayout:this.state.callPanelHeaderLayout,isNewCameraFlipEnabled:this.state.enableNewCameraFlipFlow,onDynamicAudioChoice:this._onDynamicAudioChoice}))}_maxTitleWidth(e){if(this.state.callPanelHeaderLayout===j.CallPanelHeaderLayout.Window||this.state.callPanelHeaderLayout===j.CallPanelHeaderLayout.Float)return this.state.renderHeaderV2?Math.max(e.width/2,180):Math.max(e.width/2,350)}_renderOptionalNetworkInCallWarning(){let e;return this.state.callUIState===j.CallUIState.Voicemail?e=ye.default.getViewInformationForVoicemail():this.state.isCallBeingForwarded&&(e=ye.default.getViewInformationForForwarding()),e?h.createElement(Se.default,{viewInformation:e,ref:this._onInCallWarningViewRef}):void 0}_renderOptionalAloneInTheCallInformationView(){if(this.state.showAloneInCall)return h.createElement(m.default,{key:"goliveinfo",conversationMri:this.state.conversationMri,isCallCreator:this.state.isCallCreator,callId:this.props.callId,isProvidingVideo:this.state.isProvidingVideo,isRinglessCall:this.state.isRinglessCall,callControlsType:this.state.controlsType,isLandscape:this.state.isLandscape,useLightTheme:this.state.useLightTheme,useDesktopCallControls:!this._useMobileControls()})}_renderCallCreatorShareOverlayPopup(){var e;if(!0===(null===(e=this.props.meetNowParameters)||void 0===e?void 0:e.call)&&this.state.hasCallCreatorShareOverlayPopup)return h.createElement(I.default,{conversationMri:this.state.conversationMri,meetNowParameters:this.props.meetNowParameters,callId:this.props.callId,isProvidingVideo:this.state.isProvidingVideo,onClose:this._closeCallCreatorShareOverlayPopup})}_intRenderCallControls(e,t,i){if(this.state.callUIState===j.CallUIState.IncomingRing)return h.createElement(fe.default,{conversationMri:this.state.conversationMri,callId:this.props.callId,isPSTNCall:this.state.isPSTNCall,isEncryptedCall:this.state.isEncryptedCall,forMobile:this.state.controlsType===j.CallControlsType.Mobile});if(e){const e=this.state.buttonsAndInfoHidden&&!this.state.isVideoSuggestionTooltipVisible;return h.createElement(Ae.default,{style:e?It.hiddenControls:void 0,conversationMri:this.state.conversationMri,reactionsConversationMri:this.state.reactionsConversationMri,callId:this.props.callId,callUIState:this.state.callUIState,isPSTNCall:this.state.isPSTNCall,isEncryptedCall:this.state.isEncryptedCall,disableMic:this.state.microphonePermissionStatus!==l.PermissionStatus.Granted,onOpenDialpad:this._onOpenDialpad,onOverflowPressed:this._toggleMobileOverflowMenu,onEndCallFailure:this._onEndCallFailure,onLocalUnmute:this._onLocalUnmute,onInteracting:this._onCallControlsInteracting,blockPointerEvents:e,isShowingChat:this.state.isChatOpen,onChatPanelButtonPress:this._toggleChatPanel,onVideoButtonRef:this._onVideoButtonRef})}return e||i.width!==this.state.panelLayout.width||(i=this.state.panelLayout),h.createElement(ce.default,{ref:this._onCallControls,conversationMri:this.state.conversationMri,callId:this.props.callId,callUIState:this.state.callUIState,isPSTNCall:this.state.isPSTNCall,isEncryptedCall:this.state.isEncryptedCall,disableMic:this.state.microphonePermissionStatus!==l.PermissionStatus.Granted,availableWidth:i.width,opacityStyle:this._callControlsOpacityAnimatedStyle,isShowingChat:this.state.isChatOpen,isShowingRecents:this.state.isRecentsOpen,shouldShowReactions:t,isHidden:this.state.buttonsAndInfoHidden,onOpenDialpad:this._onOpenDialpad,onInteracting:this._onCallControlsInteracting,onAddToCall:this._onAddToCallPressed,onShowParticipants:this._onShowParticipants,onChatPanelButtonPress:this._toggleChatPanel,onReactionsPickerButtonPress:this._showOrHideReactionsDrawer,onReactionPickerButtonHover:this._showReactionsDrawerOnHover,onChatButtonRef:this._onChatButtonRef,onVideoButtonRef:this._onVideoButtonRef,onEndCallFailure:this._onEndCallFailure,onMomentsPress:this._callControlsOnCaptureMomentPress,onRecordCallPress:this._onCallRecordingPress,controlsType:this.state.controlsType,showHideOutgoingVideoDisabledToast:this._onShowHideDisableOutgoingVideoToast,isShowingAloneInCall:this.state.showAloneInCall,isOutgoingVideoDisabled:this.state.isOutgoingVideoDisabled,showParticipantsButton:this._shouldShowParticipantsButtonInCallControls(),useLightTheme:this.state.useLightTheme})}_renderCallControls(e,t){const i=this._useMobileControls(),a=[It.buttonsContainer];if(i){a.push(this._callControlsAnimatedTranslateYStyle),this._audioNotificationView&&this.state.callUIState===j.CallUIState.IncomingRing&&a.push(It.buttonsWithNotificationContainer)}else a.push(It.modernStageButtonsContainer),this.state.useLightTheme&&a.push(It.lightThemeButtonsContainer);return h.createElement(h.Animated.View,{key:"callControls",style:a,ignorePointerEvents:!0,importantForAccessibility:i&&this.state.showDialpad?p.ImportantForAccessibility.NoHideDescendants:void 0},this._renderOptionalNetworkInCallWarning(),this._intRenderCallControls(i,e,t))}_renderAudioNotification(){const e=[It.buttonsContainer];let t=this.state.bottomSafeAreaInset;this._useMobileControls()&&this._areControlsVisible()&&(t+=60);const i=this.state.hideCallControlsForActivity||this.state.showDialpad||this._isIncomingOrOutgoingRing(),a=h.createElement(f.default,{ref:this._onAudioNotificationViewRef,bottomPadding:t,callId:this.props.callId,showSpeakerOnWarning:this.state.showSpeakerOnWarning,isMicrophoneMutedWhileSpeaking:this.state.isMicrophoneMutedWhileSpeaking,hideNotification:i,useDesktopCallControls:!this._useMobileControls()});if(a)return h.createElement(h.Animated.View,{key:"audioNotification",style:e,ignorePointerEvents:!0},a)}_animateDialpad(e,t,i){_e.log(pe.LogTraceArea.CallingUI,"_showOrHideDialpad causeId: "+t);const a=e?1:0,n=this.state.isUsingStackNavigationContext?0:-150,o=this.state.isUsingStackNavigationContext?390:540;let s;if(e){const e=this.state.isUsingStackNavigationContext?0:(this.state.panelLayout.height-390)/2*-1;s=Math.max(e,n)}else s=o;let r=!0;!this.state.isUsingStackNavigationContext&&e&&(r=!1),r?h.Animated.parallel([d.timing.easeOut({value:this._dialpadAnimatedOpacityValue,toValue:a,useNativeDriver:!0}),d.timing.easeOut({value:this._dialpadAnimatedTransformValue,toValue:s,useNativeDriver:!0})]).start(i):(this._dialpadAnimatedOpacityValue.setValue(a),this._dialpadAnimatedTransformValue.setValue(s),i&&i())}_showOrHideControls(e,t,i={},a,n){if(!this._useMobileControls()&&!a)return;this._reactionsBar&&this._reactionsBar.setOverflowCoachMarksEnabled(!e);const o=this._shouldKeepControlsVisible(),s=()=>` showControls: ${e} buttonsAndInfoHidden: ${i.buttonsAndInfoHidden} shouldKeepControlsVisible: `+o;a||this.state.buttonsAndInfoHidden!==!e&&!o?(i.buttonsAndInfoHidden=!e,e&&n&&(this._renderCallControlsScenario=new mt.default(mt.ScenarioName.RenderCallControls),this._renderCallControlsScenario.start(void 0,n),this._renderCallControlsScenario.markStepCompleted("ShowControls")),this.setState(i),_e.log(pe.LogTraceArea.CallingUI,"_showOrHideControls "+s()+" causeId: "+t)):(o&&(i.buttonsAndInfoHidden=!1),this.setState(i),_e.log(pe.LogTraceArea.CallingUI,"_showOrHideControls "+s()+" causeId: "+t)),T.default.setCallControlsVisible(e,t)}_shouldKeepControlsVisible(){const e=this._coachMarksBeingShown(),t=this.state.callUIState===j.CallUIState.OutgoingRing||this.state.callUIState===j.CallUIState.GoLiveSinglePlayer,i=this._useMobileControls()&&this.state.newMobileOverflowOpen&&!this.state.isUsingStackNavigationContext,a=e||this._isInteractingWithCallControls||this._endCallNavigationRequested||this.state.isPSTNCall||this.state.isMobileScreenReaderEnabled||this.state.isNavigatingWithKeyboard||this.state.isVideoSuggestionTooltipVisible||t||i;return a&&_e.log(pe.LogTraceArea.CallingUI,"_shouldKeepControlsVisible isInteractingWithCallControls: "+this._isInteractingWithCallControls+" endCallNavigationRequested: "+this._endCallNavigationRequested+" isPSTNCall: "+this.state.isPSTNCall+" isMobileScreenReaderEnabled: "+this.state.isMobileScreenReaderEnabled+" isNavigatingWithKeyboard: "+this.state.isNavigatingWithKeyboard+" isVideoSuggestionTooltipVisible: "+this.state.isVideoSuggestionTooltipVisible+" coachMarksBeingShown: "+e+" isInOutgoingRingOrWaitState: "+t+" overflowMenuOpenOnTablet: "+i),a}_showOrHideStatusBar(e){let t;t=h.StatusBar.isOverlay()?ct.default.mergeStyles([ct.default.createHiddenStyle(!e),ct.default.createBarStyle(lt.BarStyleTheme.Light)]):ct.default.createBackgroundColorStyle(ut.Color.black,!1),this._updateStatusBarStyle(t)}_startParticipantAnimationSuppressionTimeout(){this.state.suppressParticipantAnimation&&ft.default.setTimeout(()=>{this.isComponentMounted()&&this.setState({suppressParticipantAnimation:!1})},2e3)}_updateLeftNoneStateOnce(e){_e.log(pe.LogTraceArea.CallingUI,"_updateLeftNoneStateOnce callUIState: "+j.CallUIState[this.state.callUIState]+" causeId: "+e),this._leftNoneStateOnce||this.state.callUIState===j.CallUIState.None||(this._leftNoneStateOnce=!0)}_updateAudioState(e){this.isComponentMounted()?(_e.log(pe.LogTraceArea.CallingUI,"_updateAudioState causeId: "+e),k.default.CallControlsStore.updateAudioState(this.props.callId,e)):_e.log(pe.LogTraceArea.CallingUI,"_updateAudioState - component no longer mounted, causeId: "+e)}_callControlsVisualHeight(){const e=this._useMobileControls()?55:j.DesktopCallControlsHeight;return Math.max(this._reactionsBarHeight,e+40+-1*this._controlsTranslateY())}_componentId(){return"CapturePanel"}_galleryMri(){return this.state.conversationMri}_isIncomingOrOutgoingRing(e){const t=e||this.state;return t.callUIState===j.CallUIState.IncomingRing||t.callUIState===j.CallUIState.OutgoingRing}_startOrStopOrientationListener(e){}_endCall(e,t){_e.log(pe.LogTraceArea.CallingUI,"_endCall forEveryone: "+e+" causeId: "+t),(e?k.default.CallingStore.endCallForEveryone(this.props.callId,t):k.default.CallingStore.endCall(this.props.callId,t)).catch(e=>{_e.log(pe.LogTraceArea.CallingUI,"_endCall failed: "+dt.default.errorAsString(e)+" causeId: "+t),this._onEndCallFailure(t)})}_controlsTranslateY(){return this._useMobileControls()?10-this.state.bottomSafeAreaInset:this.state.bottomSafeAreaInset}_registerKeyboardHandlers(){const e=oe.default().getConversation(this.state.conversationMri);Ve.isRegularMemberInModeratedGroup(e)||(we.default.addHandler(pe.KeyboardShortcut.AddPeopleToCall,this._onAddToCallKeyboardShortcut),we.default.addHandler(pe.KeyboardShortcut.TakeCallSnapshot,this._onCaptureMomentKeyboardShortcut)),we.default.addHandler(pe.KeyboardShortcut.ToggleMicrophone,this._onToggleMicrophoneKeyboardShortcut),this.state.isOutgoingVideoDisabled||we.default.addHandler(pe.KeyboardShortcut.ToggleCamera,this._onToggleVideoKeyboardShortcut),we.default.addHandler(pe.KeyboardShortcut.HangupOrRejectCall,this._hangupCallShortcut),we.default.addHandler(pe.KeyboardShortcut.AnnounceMuteStatus,this._onAnnounceMuteStatusKeyboardShortcut),we.default.addHandler(pe.KeyboardShortcut.AnnounceSelfVideoOnOffStatus,this._onAnnounceSelfVideoOnOffStatusKeyboardShortcut)}_unregisterKeyboardHandlers(){const e=oe.default().getConversation(this.state.conversationMri);Ve.isRegularMemberInModeratedGroup(e)||(we.default.removeHandler(pe.KeyboardShortcut.AddPeopleToCall,this._onAddToCallKeyboardShortcut),we.default.removeHandler(pe.KeyboardShortcut.TakeCallSnapshot,this._onCaptureMomentKeyboardShortcut)),we.default.removeHandler(pe.KeyboardShortcut.ToggleMicrophone,this._onToggleMicrophoneKeyboardShortcut),this.state.isOutgoingVideoDisabled||we.default.removeHandler(pe.KeyboardShortcut.ToggleCamera,this._onToggleVideoKeyboardShortcut),we.default.removeHandler(pe.KeyboardShortcut.HangupOrRejectCall,this._hangupCallShortcut),we.default.removeHandler(pe.KeyboardShortcut.AnnounceMuteStatus,this._onAnnounceMuteStatusKeyboardShortcut),we.default.removeHandler(pe.KeyboardShortcut.AnnounceSelfVideoOnOffStatus,this._onAnnounceSelfVideoOnOffStatusKeyboardShortcut)}_mustUpdateSpeakerMutedAsync(e,t){return ht.default.isElectronOsx()&&"true"!==y.default.getSkypeAudioLibraryFeatures().ECS_ADSP_VirtualSessionVolume&&t.isSpeakerMuted!==k.default.CallingStore.isSpeakerMuted(e)}_updateSpeakerMutedAsync(e){return k.default.DeviceStore.getSpeakerVolumeAsync(!0).then(t=>0===t||k.default.CallingStore.isSpeakerMuted(e))}_useHighContrastHeader(){return this.state.useHighContrastTheme&&!this._isIncomingOrOutgoingRing()&&this.state.callPanelHeaderLayout!==j.CallPanelHeaderLayout.Window}_onNavigatedAwayFromCall(e){var t;_e.log(pe.LogTraceArea.CallingUI,"onNavigateAwayFrom Call onCallScreenClose, causeId: "+e),this.state.isDesktopMin&&(null===(t=this._reactionsBar)||void 0===t?void 0:t.isDrawerOpen())&&this._showOrHideReactionsDrawer(!1),c.default.onCallScreenClose()}_transcriptionLayout(e,t){return G.default.getTranscriptionLayout(e,!!t,this.state.isLandscape)}_getTanscriptionRects(e){const t=k.default.OngoingCallService.getIsSubtitleHistoryOpen(this.props.callId)||!1;if(this.state.isTranslating&&t&&!this.state.isRightPanelOpen){const i=this._transcriptionLayout(t,e);return G.default.getTranscriptionLayoutRects(this.state.panelLayout,i)}}_canShowTranscriptionPanel(e){return!!k.default.OngoingCallService.getIsSubtitleHistoryOpen(this.props.callId)&&(!e||!e.isHorizontal)}_canShowTranscription(){return!(!this.state.isTranscriptionEnabled||!this.state.isTranslating)}_getTranscriptionBottomPadding(){let e=0;return e=this._areControlsVisible()?this._callControlsVisualHeight()+25:this._audioNotificationView?40:20,e}_showMobileServerMutedToast(e){return!!e.showServerMutedToastOnMobile&&!e.isCallOnHold}_showCallConnectionQualityToast(e){return(e.callNetworkQualityPoor||e.audioOnlyEnabled)&&!e.isCallOnHold}_shouldUpdateBannerHeight(e,t){return this.isComponentMounted()&&e!==t}_getBannersHeight(){return this.state.recordingBannerHeight+this.state.cameraDeniedBannerHeight+this.state.ndiUsedBannerHeight+this.state.callMediaCapturedBannerHeight+this.state.incomingVideoDisabledBannerHeight+this.state.callConnectionQualityBannerHeight+this.state.serverMuteNotificationBannerHeight+this.state.spokenLangageConflictResolutionViewHeight+this.state.mobileScreenShareBannerHeight+this.state.mobileTeamsInteropBannerHeight+this.state.mobileTranslationBannerHeight+this.state.mobileTogetherModeNoticeBannerHeight+this.state.mobileNewCallScreenRevertNoticeBannerHeight||0}_getTopInset(){let e=this.state.topSafeAreaHeight;const t=this._getBannersHeight();return this._areControlsVisible()?this._useMobileControls()?(e+=this.state.renderHeaderV2?j.DesktopNewHeaderHeight:j.CallPanelHeaderHeight.mobile,e+=t):this.state.enableNewCameraFlipFlow&&!We.default.keepStatusBarVisibleNoSubscription()&&(e+=17):e+=t,e}}t.default=Pt},1765:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(177),n=i(60),o=i(5),s=i(11);t.default=class{static getViewInformationForAudioRouting(e){let t;switch(e){case a.default.AudioOutputEarpiece:t=o.getString("CallPanel.EarpieceWarning");break;case a.default.AudioOutputSpeaker:t=o.getString("CallPanel.SpeakerWarning");break;case a.default.AudioOutputBluetooth:t=o.getString("CallPanel.BluetoothWarning");break;case a.default.AudioOutputWiredHeadset:t=o.getString("CallPanel.HeadsetWarning");break;default:return}return{warningText:t,warningViewType:n.InCallWarningViewType.Audio}}static getViewInformationForAudioMuted(e,t){if((e||t)&&(e||t)){let i,a;return t&&e?(i=void 0,a=o.getString("CallPanel.SpeakerAndMicrophoneMuted")):t?(i=s.SkypeIcon.VolumeOff,a=o.getString("CallPanel.SpeakerMuted")):e&&(i=s.SkypeIcon.MicrophoneOff,a=o.getString("CallPanel.MicrophoneMuted")),a?{warningText:a,icon:i,warningViewType:n.InCallWarningViewType.Audio}:void 0}}static getViewInformationForVoicemail(){return{warningText:o.getString("CallPanel.RecordingVoicemail"),warningViewType:n.InCallWarningViewType.Voicemail}}static getViewInformationForForwarding(){return{warningText:o.getString("CallPanel.CallForwarding"),warningViewType:n.InCallWarningViewType.Forwarding}}}},1766:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DesktopMinTopMargin=void 0;const a=i(1),n=i(177),o=i(0),s=i(74),r=i(7),l=i(1767),c=i(331),d=i(29),u=i(1768),h=i(219),p=i(60),g=i(110),C=i(113),m=i(17),S=i(13),y=i(532),f=i(254),_=i(3),b=i(41),v=i(4),w=(i(1771),i(914)),T=i(6),I=i(5),P=i(3647),M=i(68),k=i(78),A=i(9),R=i(11),V=i(77),E=i(14),L=i(12),B=i(100),O=i(31),D=i(10),x=i(23);var N;!function(e){e[e.Closed=0]="Closed",e[e.Opening=1]="Opening",e[e.Open=2]="Open"}(N||(N={})),t.DesktopMinTopMargin=p.RibbonSizes.ribbonItemSizeSmall+p.RibbonSizes.ribbonItemModernStageTopMargin;const U=T.lazyProperties({callPanelHeader:()=>o.Styles.createViewStyle({appRegion:"drag",flexDirection:"row",alignSelf:"stretch",height:p.CallPanelHeaderHeight.mobile,overflow:"visible"}),callPanelHeaderDesktop:()=>o.Styles.createViewStyle({backgroundColor:A.Color.transparent,alignItems:"center",height:p.CallPanelHeaderHeight.window}),callPanelHeaderDesktopMin:()=>o.Styles.createViewStyle({marginTop:t.DesktopMinTopMargin,justifyContent:"center"}),leftControl:()=>o.Styles.createViewStyle({flexDirection:"row",justifyContent:"center",alignItems:"center",paddingHorizontal:16,paddingTop:17,height:52,backgroundColor:A.Color.transparent}),leftControlDesktop:()=>o.Styles.createViewStyle({paddingTop:0,paddingLeft:16,paddingRight:0}),leftControlDesktopMin:()=>o.Styles.createViewStyle({position:"absolute",left:0,transform:[{translateY:-1*t.DesktopMinTopMargin}]}),recentsButton:()=>o.Styles.createViewStyle({width:R.IconSize.default,height:R.IconSize.default,borderRadius:R.IconSize.default/2,backgroundColor:A.Color.white,paddingLeft:0,marginLeft:16}),rightControls:()=>o.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-end",paddingTop:10}),rightControlsButton:()=>o.Styles.createButtonStyle({alignSelf:"stretch",alignItems:"center",marginRight:16,height:52}),titleContainerInner:()=>o.Styles.createViewStyle({flex:-1,justifyContent:"center",paddingHorizontal:20}),titleContainer:()=>o.Styles.createViewStyle({alignItems:"stretch",justifyContent:"flex-start",backgroundColor:A.Color.transparent,overflow:"visible",marginRight:16}),titleContainerStackNav:()=>o.Styles.createViewStyle({flex:1,height:p.CallPanelHeaderHeight.mobile}),titleContainerTablet:()=>E.default.flexOne,titleContainerDesktopMin:()=>o.Styles.createViewStyle({justifyContent:"center"}),undraggableRegion:()=>o.Styles.createViewStyle({appRegion:"no-drag"}),backButtonSpacer:()=>o.Styles.createViewStyle({width:64})});class F extends L.default{constructor(){super(...arguments),this._handleBackButtonClick=e=>{e.stopPropagation();const t=D.default.newCauseId();v.log(_.LogTraceArea.CallingUI,"CallPanelHeader._handleBackButtonClick, causeId: "+t),this.props.onBackButtonPressed(t)},this._handleRecentsButtonPress=e=>{e.stopPropagation();const t=D.default.newCauseId();v.log(_.LogTraceArea.CallingUI,"CallPanelHeader._handleRecentsButtonPress, causeId: "+t),this.props.onRecentsButtonPressed(t)},this._onTitleLayout=e=>{if(this.props.onTitleLayout){const t={x:e.x,y:e.y,width:e.width+60,height:e.height};this.props.onTitleLayout(t)}},this._onTitlePress=(e,t)=>{v.log(_.LogTraceArea.CallingUI,"CallPanelHeader._onTitlePress, causeId: "+e),this.props.onTitlePress&&this.props.onTitlePress(e,t)},this._onOpenRoster=()=>{const e=D.default.newCauseId();v.log(_.LogTraceArea.CallingUI,"CallPanelHeader._onOpenRoster, causeId: "+e),this.props.onRosterPressed&&this.props.onRosterPressed(e,p.CallRosterOrigin.FromParticipantCount)},this._onDynamicAudioChoice=e=>{this.props.onDynamicAudioChoice&&this.props.onDynamicAudioChoice(e,()=>this._audioOutputButton)},this._onAudioOutputButtonRef=e=>{this._audioOutputButton=e||void 0},this._onLayoutButtonRef=e=>{this._layoutButton=e||void 0},this._onNewPickerPress=()=>{const e=()=>this._layoutButton,t=this._getRootViewId();f.default.showWithContent({menuId:f.default.menuId(),anchor:e,rootViewId:t,menuHeight:w.default.getLayoutPickerHeight(this.state.availableMenuItems),content:o.createElement(w.default,{anchor:e,rootViewId:t,useMobileControls:this.props.useMobileControls,isIncomingOrOutGoingRing:this.props.incomingOrOutgoingRing,callId:this.props.callId,conversationMri:this.props.conversationId,availableItems:this.state.availableMenuItems}),useBlurredBackground:!0,colorThemeOverride:B.Theme.DelphiDark,headerConfig:{headerType:y.HeaderType.Slim},staticContent:!0,useTransparentShim:!0,hidePopupArrow:!0,getTitle:()=>{},onCloseMenu:e=>f.default.close(t,e),onMenuClosed:this._onMenuClosed},D.default.newCauseId())},this._toggleGridFocusView=()=>{const e=this.state.hasIncomingScreenshare?p.StageMode.FocusedScreenShare:p.StageMode.Speaker,t=g.default.isInGridStageMode(this.state.stageMode)?e:p.StageMode.Grid;this._changeCallLayoutCommand.execute(t)},this._onMenuClosed=e=>{this.state.availableMenuItems.forEach(e=>{e.markAsSeen&&e.markAsSeen()})}}_buildState(e,t){const i=h.default.getStageMode(e.callId),n=d.default.CallScreenShareStore.hasIncomingScreensharing(e.callId),o={isPSTNCall:d.default.CallingStore.isPSTNCall(e.callId),isEncryptedCall:m.isEncryptedThread(e.conversationId),conversationMri:e.conversationId,callId:e.callId};this._changeCallLayoutCommand=new c.ChangeCallLayoutCommand(o,e.incomingOrOutgoingRing,i);const u=d.default.CallingStore.isProvidingVideo(e.callId),S=d.default.OngoingCallService.getStageParticipants(e.callId),y=k.default.isMobileScreenReaderEnabled(),f=e.useMobileControls&&u&&(!(e.isNewCameraFlipEnabled&&!y)||a.includes(S,p.CallStageElementKeys.localUserKey));let _=s.CameraPosition.Unknown;if(f){const e=d.default.DeviceStore.getSelectedCamera();_=e?e.position:s.CameraPosition.Unknown}const b=r.default.getS4LCMCFeatures().enableFullScreenOnWeb&&!x.default.isUsingSplitViewNoSubscription(),v=g.default.getAvailableMenuItems(e.callId,b,e.useMobileControls,e.conversationId),w={showCameraToggle:f,cameraPosition:_,showRecentsButton:!e.isUsingStackNavigationContext&&C.default.navigation().canAccessRecentsList,isDesktopMin:g.default.isDesktopMinCallPanelHeader(this._getRootViewId()),isGalleryShowing:M.default.isGalleryShowing(this._getRootViewId()),outputRoute:d.default.CallControlsStore.getAudioOutput(),useiOSRoutePicker:l.AudioOutputRouteHelper.useiOSRoutePicker(),stageMode:i,hasIncomingScreenshare:n,changeCallLayoutEnabled:e.useMobileControls&&this._changeCallLayoutCommand.canExecute(),moreOutputRoutesAvailable:!1,newLayoutPickerEnabled:r.default.getS4LCMCFeatures().enableNewLayoutPicker,isOneOnOneCall:d.default.CallingStore.isOneOnOneCall(e.callId),availableMenuItems:v};return!t&&e.isRecentsOpen&&this.state?e.isRecentsOpen&&this.state.recentsOpenState===N.Closed&&(w.recentsOpenState=N.Opening,this._clearIsRecentsOpenTimeout(),this._isRecentsOpeUpEdgeTimeout=O.default.setTimeout(()=>{this.isComponentMounted()&&this.setState({recentsOpenState:N.Open}),this._isRecentsOpeUpEdgeTimeout=void 0},300)):(w.recentsOpenState=e.isRecentsOpen?N.Open:N.Closed,this._clearIsRecentsOpenTimeout()),w}_areMoreAudioOutputsAvailable(e){if(!r.default.getS4LCMCFeatures().earpieceHiddenForVideoCalls)return v.log(_.LogTraceArea.CallingUI,"CallPanelHeader.areMoreAudioRoutesAvailable - ECS disabled.  Showing all audio routes."),!0;const t=d.default.CallControlsStore.getAvailableAudioRoutes();v.log(_.LogTraceArea.CallingUI,`CallPanelHeader.areMoreAudioRoutesAvailable video: ${e} availableRoutes: ${t}`);let i=a.size(t);return e&&a.includes(t,n.default.AudioOutputEarpiece)&&i--,i>1}_clearIsRecentsOpenTimeout(){this._isRecentsOpeUpEdgeTimeout&&(O.default.clearTimeout(this._isRecentsOpeUpEdgeTimeout),this._isRecentsOpeUpEdgeTimeout=void 0)}render(){const e=this.props.useHighContrastTheme;let t=e?this._themeColors.headerIconColor:A.Color.white;const i=e?this._themeColors.iconHoverColor:A.Color.gray200,a=this._renderNavigationButton(t,i,e),n=this._renderTitleView(),s=this._renderFlipCameraButton(t,i),r=this._renderSpeakerButton(t,i),l=this._renderGridFocusToggleButton(t,i),c=[U.titleContainer,U.undraggableRegion];this.props.useMobileControls&&(this.props.isUsingStackNavigationContext?c.push(U.titleContainerStackNav):c.push(U.titleContainerTablet)),this.state.isDesktopMin&&c.push(U.titleContainerDesktopMin);let d=[o.createElement(o.Animated.View,{key:"titleControls",style:c,ignorePointerEvents:!0},n),o.createElement(o.View,{key:"rightControls",style:[U.rightControls,U.undraggableRegion]},l,r,s)];const u=[U.callPanelHeader];return this.props.isUsingStackNavigationContext||(u.push(U.callPanelHeaderDesktop),this.state.isDesktopMin&&u.push(U.callPanelHeaderDesktopMin)),o.createElement(o.View,{style:u,ignorePointerEvents:!0},a,d)}_renderNavigationButton(e,t,i){let a,n;if(!this.props.hideBackButton){const n=[U.leftControl];if(this.props.isUsingStackNavigationContext||n.push(U.leftControlDesktop),this.state.showRecentsButton){let s,r=e,l=t;this._getRootViewType()===S.RootViewType.SplitViewContent?s=I.getString("CallPanel.ShowRecentsButtonTitle"):(s=this.state.recentsOpenState===N.Open?I.getString("CallPanel.CloseRecentsButtonTitle"):I.getString("CallPanel.OpenRecentsButtonTitle"),this.state.recentsOpenState!==N.Closed&&(n.push(U.recentsButton),i?(n.push(this._themeStyles.primaryViewColorStyle),r=this._themeColors.primaryBackgroundColor,l=r):r=A.Color.gray400)),a=o.createElement(b.default,{key:"recents",style:n,size:R.IconSize.size24,onPress:this._handleRecentsButtonPress,color:r,hoverColor:l,icon:R.SkypeIcon.Menu,title:s})}else{const i=this.props.isUsingStackNavigationContext?R.SkypeIcon.Message:V.backIcon(),s=this.props.isUsingStackNavigationContext?I.getString("CallPanel.OpenConversation"):I.getString("Global.BackButtonTitle");a=o.createElement(b.default,{key:"back",style:n,size:R.IconSize.size24,onPress:this._handleBackButtonClick,color:e,hoverColor:t,icon:i,title:s})}}if(this.props.isUsingStackNavigationContext||a){const e=[U.undraggableRegion];this.props.isUsingStackNavigationContext?e.push(U.backButtonSpacer):this.state.isDesktopMin&&e.push(U.leftControlDesktopMin),n=o.createElement(o.View,{key:"leftControl",style:e},a)}return n}_renderTitleView(){if(this.props.isUsingStackNavigationContext)return o.createElement(P.default,{callId:this.props.callId,conversationMri:this.props.conversationId,isCallActive:this.props.isCallActive,outgoingRingStatus:this.props.outgoingRingStatus,onTitlePress:this.props.onTitlePress?this._onTitlePress:void 0,isSeen:!this.props.minimized,showParticipantCount:this.props.showParticipantCount,isLandscape:this.props.isLandscape});const e=this.state.isGalleryShowing?I.getString("CallReactionsBar.CloseGallery"):I.getString("CallReactionsBar.OpenGallery");return o.createElement(u.default,{onLayout:this.props.onTitleLayout?this._onTitleLayout:void 0,callId:this.props.callId,conversationMri:this.props.conversationId,isCallActive:this.props.isCallActive,outgoingRingStatus:this.props.outgoingRingStatus,onTitlePress:this.props.onTitlePress?this._onTitlePress:void 0,onOpenRoster:this._onOpenRoster,onBingBackgroundsPressed:this.props.onBingBackgroundsPressed,isSeen:!this.props.minimized,showParticipantCount:this.props.showParticipantCount,maxTitleWidth:this.props.maxTitleWidth,containerStyle:U.titleContainerInner,onGalleryPress:this.props.onGalleryPress,isDesktopMin:this.state.isDesktopMin,useHighContrastTheme:this.props.useHighContrastTheme,useLightTheme:!1,renderGalleryIfAllowed:!0,galleryButtonAccessibilityLabel:e})}_renderSpeakerButton(e,t){}_renderFlipCameraButton(e,t){if(this.props.useMobileControls&&this.state.showCameraToggle){let i,a;return i=this.props.isNewCameraFlipEnabled?R.SkypeIcon.NewSwitchCamera:R.SkypeIcon.SwitchCamera,a=this.state.cameraPosition===s.CameraPosition.Front?I.getString("CallControls.CallButtonSwitchCameraBackwardLabel"):I.getString("CallControls.CallButtonSwitchCameraForwardLabel"),o.createElement(b.default,{key:"camera",style:U.rightControlsButton,size:R.IconSize.size24,onPress:this.props.onToggleCameraDirection,color:e,hoverColor:t,icon:i,title:I.getString("CapturePanel.SwitchCameraButtonTitle"),accessibilityLabel:a})}}_renderGridFocusToggleButton(e,t){if(this.state.changeCallLayoutEnabled)return o.createElement(b.default,{ref:this._onLayoutButtonRef,key:"changeLayoutButton",icon:this._getIcon(),title:this._getTitle(),size:R.IconSize.size24,hoverColor:t,onPress:this.state.newLayoutPickerEnabled?this._onNewPickerPress:this._toggleGridFocusView,accessibilityLabel:this._getTitle(),color:e,style:U.rightControlsButton})}_getTitle(){if(this.state.newLayoutPickerEnabled)return g.default.getStageModeItemTitle(this.state.stageMode,!1);return g.default.isInGridStageMode(this.state.stageMode)?this.state.hasIncomingScreenshare?I.getString("CallControls.CallButtonSwitchToContentView"):I.getString("CallControls.CallButtonSwitchToSpeakerView"):I.getString("CallControls.CallButtonSwitchToGridView")}_getIcon(){if(this.state.newLayoutPickerEnabled)return g.default.getIconForStageMode(this.state.stageMode,!1);return g.default.isInGridStageMode(this.state.stageMode)?R.SkypeIcon.GridView:R.SkypeIcon.FocusedView3}}t.default=F},1767:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AudioOutputRouteHelper=void 0;const a=i(177),n=i(7),o=i(5),s=(i(19),i(20),i(11));t.AudioOutputRouteHelper=class{static displayInfoForOutputRoute(e){let t=s.SkypeIcon.VolumeMax,i="CallControls.CallButtonSpeaker",n="CallControls.CallButtonSpeakerAccessibilityLabel";return e&&(e===a.default.AudioOutputEarpiece?(t=s.SkypeIcon.VolumeOff,i="CallControls.CallButtonEarpiece",n="CallControls.CallButtonEarpieceAccessibilityLabel"):e===a.default.AudioOutputWiredHeadset?(t=s.SkypeIcon.Headset,i="CallControls.CallButtonHeadset",n="CallControls.CallButtonHeadsetAccessibilityLabel"):e===a.default.AudioOutputBluetooth&&(t=s.SkypeIcon.Bluetooth,i="CallControls.CallButtonBluetooth",n="CallControls.CallButtonBluetoothAccessibilityLabel")),{icon:t,title:o.getString(i),accessibilityLabel:o.getString(n)}}static useiOSRoutePicker(){n.default.getSkypeAudioLibraryFeatures().ECS_AudioDL_DisableRouteChangeNotification;return!1}}},1768:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(29),o=i(1769),s=i(219),r=i(3645),l=i(328),c=i(60),d=i(17),u=i(32),h=i(3),p=i(120),g=i(1641),C=i(141),m=i(4),S=i(6),y=i(5),f=i(9),_=i(24),b=i(1770),v=i(16),w=i(12),T=i(10),I=i(7),P=i(1255),M=f.Color.gray400,k=S.lazyProperties({headerContainer:()=>a.Styles.createViewStyle({flex:1,alignItems:"stretch"}),alignDesktopMin:()=>a.Styles.createViewStyle({justifyContent:"center"}),firstRow:()=>a.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-start",marginBottom:0}),conversationNameText:()=>a.Styles.createTextStyle({flex:-1,color:f.Color.white}),conversationNameTextLightTheme:()=>a.Styles.createTextStyle({color:M}),divider:()=>a.Styles.createTextStyle({marginLeft:5}),timerRowContainer:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),timerRowContainerV2:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"flex-start"}),galleryButtonText:()=>a.Styles.createTextInputStyle({marginTop:2}),baseSubtitleStyleV1:()=>a.Styles.createTextStyle({color:f.Color.whiteOverlay50}),baseSubtitleStyleLightTheme:()=>a.Styles.createTextStyle({color:f.Color.blackOverlay60})});class A extends w.default{constructor(){super(...arguments),this.handleFocusEvent=e=>!(e!==p.FocusEvent.CloseRightPanel||!this._galleryButton)&&(this._galleryButton.requestFocus(),!0),this._onTitlePress=()=>{if(this.props.onTitlePress){const e=T.default.newCauseId();m.log(h.LogTraceArea.CallingUI,"CallPanelHeaderTitle._onTitlePress, causeId: "+e),this.props.onTitlePress(e,c.CallRosterOrigin.FromGroupTitle)}},this._onOpenRoster=()=>{if(this.props.onOpenRoster){const e=T.default.newCauseId();m.log(h.LogTraceArea.CallingUI,"CallPanelHeaderTitle._onOpenRoster, causeId: "+e),this.props.onOpenRoster(e,c.CallRosterOrigin.FromParticipantCount)}},this._onGalleryPress=e=>{m.log(h.LogTraceArea.CallingUI,"CallPanelHeaderTitle._onGalleryPress"),this.props.onGalleryPress&&this.props.onGalleryPress()},this._onGalleryButtonRef=e=>{this._galleryButton=e||void 0},this._onManageGroupPress=e=>{const t=T.default.newCauseId();m.log(h.LogTraceArea.CallingUI,"CallPanelHeaderTitle._onManageGroupPress, causeId: "+t),this.props.onTitlePress&&this.props.onTitlePress(t,c.CallRosterOrigin.FromManageGroupButton)},this._getIconColor=e=>{if(!this.props.useHighContrastTheme)return this.props.useLightTheme?M:e}}_buildState(e,t){const i=I.default.getS4LCMCFeatures().bingBackgrounds,a=n.default.CallParticipantBackgroundInfoStore.captionsReceivedCount(e.callId),o=s.default.getStageMode(e.callId);return{conversationName:u.default.getDisplayName(e.conversationMri)||y.getString("Notifications.UnknownUserShort"),activeParticipantCount:e.showParticipantCount?l.default.getActiveParticipants(e.callId,e.conversationMri).length:0,totalParticipantCount:e.showParticipantCount?l.default.getRosterForConversation(e.conversationMri).length:0,allowCallGallery:e.renderGalleryIfAllowed&&n.default.CallingFeaturesHelper.allowCallGallery({isEncryptedCall:d.isEncryptedThread(e.conversationMri),isPSTNCall:n.default.CallingStore.isPSTNCall(e.callId),conversationMri:e.conversationMri,callId:e.callId}),allowManageGroup:I.default.getS4LCMCFeatures().enableLockMeeting&&!!e.onTitlePress&&d.isGroupConversation(e.conversationMri),stageMode:o,allowBingBackgrounds:!e.v2&&a>0&&(o===c.StageMode.LargeGrid||o!==c.StageMode.TogetherMode&&o!==c.StageMode.FocusedScreenShare&&i.showInCallHeader)}}componentDidMount(){super.componentDidMount(),p.register(p.FocusEvent.CloseRightPanel,this)}componentWillUnMount(){super.componentWillUnmount(),p.unregister(p.FocusEvent.CloseRightPanel,this)}render(){const e=!!this.props.onTitlePress,t=e?C.HoverableButton:a.View,i=[k.firstRow];this.props.isDesktopMin&&i.push(k.alignDesktopMin);const n=this.props.useHighContrastTheme?this._themeStyles.primaryTextColorStyle:void 0;let s;e&&(s=d.isOneOnOneConversation(this.props.conversationMri)?this.state.conversationName:y.getString("CallPanel.CallRosterHeaderEntryButtonAccessibilityLabel",{groupName:this.state.conversationName}));const l=[this.props.v2?_.default.fontStyle.callHeaderTitleV2:_.default.fontStyle.messagingHeader,[k.conversationNameText,this.props.useLightTheme?k.conversationNameTextLightTheme:void 0],n],c=this.state.allowManageGroup?a.createElement(P.default,{key:"manageGroupButton-"+this.props.conversationMri,iconColorOverride:this._getIconColor(f.Color.white),hoverColor:this._getIconColor(f.Color.whiteOverlay80),onPress:this._onManageGroupPress,accessibilityLabel:y.getString("CallPanel.ManageGroupAccessibilityLabel"),isCompact:!!this.props.showCompactManageGroup}):void 0,u=a.createElement(a.View,{style:i},a.createElement(t,{onPress:e?this._onTitlePress:void 0,title:s,accessibilityLabel:s,accessibilityTraits:e?a.Types.AccessibilityTrait.Button:a.Types.AccessibilityTrait.Header,tabIndex:e?void 0:-1},a.createElement(a.Text,{style:l,numberOfLines:1},this.state.conversationName)),c);let h;this.props.showParticipantCount&&this.state.activeParticipantCount&&this.state.totalParticipantCount&&(h=y.getString("CallPanel.CallRosterTitle",{count:this.state.activeParticipantCount,total:this.state.totalParticipantCount}));const p=[_.default.fontStyle.callHeaderSubtitleV2,this.props.useLightTheme?k.baseSubtitleStyleLightTheme:void 0],m=this.props.v2?p:[_.default.fontStyle.subtitle,k.baseSubtitleStyleV1];let S,w=a.createElement(r.default,{callId:this.props.callId,isTimerActive:!!this.props.isCallActive&&!!this.props.isSeen,participantCountText:h,baseSubtitleStyle:m,textThemeStyle:n,subtitleV2:this.props.v2,onPress:this.props.onOpenRoster?this._onOpenRoster:void 0});if(this.props.outgoingRingStatus&&this.props.outgoingRingStatus.length){const e=[m,this.props.isDesktopMin?k.alignDesktopMin:void 0,n];S=a.createElement(v.Subtitle,{style:e,numberOfLines:1,v2:this.props.v2},this.props.outgoingRingStatus)}const T=[this.props.containerStyle];if(this.props.maxTitleWidth&&T.push(a.Styles.createViewStyle({maxWidth:this.props.maxTitleWidth},!1)),this.props.isCallActive){const e=[m,this.props.v2?k.timerRowContainerV2:k.timerRowContainer];this.props.isDesktopMin&&e.push(k.alignDesktopMin);const t=[m,k.divider],i=this.state.allowCallGallery?[a.createElement(b.default,{key:"galleryDivider-"+this.props.conversationMri,style:t}),a.createElement(g.default,{ref:this._onGalleryButtonRef,key:"galleryButton-"+this.props.conversationMri,textStyle:[m,k.galleryButtonText,n],iconColorOverride:this._getIconColor(f.Color.whiteOverlay50),onPress:this._onGalleryPress,accessibilityLabel:this.props.galleryButtonAccessibilityLabel})]:void 0,s=this.state.allowBingBackgrounds?[a.createElement(b.default,{key:"bing-Divider-"+this.props.conversationMri,style:t}),a.createElement(o.default,{key:"bingBackgroundsButton-"+this.props.conversationMri,callId:this.props.callId,onBingBackgroundsPressed:this.props.onBingBackgroundsPressed,textStyleOverride:[m,k.galleryButtonText,n],v1:!0,useLightTheme:this.props.useLightTheme})]:void 0;w=a.createElement(a.View,{style:e},w,i,s)}return a.createElement(a.View,{style:T,ignorePointerEvents:!0,onLayout:this.props.onLayout},a.createElement(a.View,{style:k.headerContainer,ignorePointerEvents:!0},u,S,w))}}t.default=A},1769:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(57),s=i(7),r=i(29),l=i(110),c=i(3),d=i(4),u=i(141),h=i(6),p=i(5),g=i(9),C=i(24),m=i(16),S=i(12),y=i(10),f=i(101),_=i(65),b=h.lazyProperties({bingBackgroundsContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",marginRight:16,width:void 0}),bingBackgroundsIcon:()=>n.Styles.createViewStyle({width:16,height:16}),bingBackgroundsIconSmall:()=>n.Styles.createViewStyle({width:12,height:12}),bingBackgroundsIconMargin:()=>n.Styles.createViewStyle({marginRight:5}),bingBackgroundsText:()=>n.Styles.createTextStyle({backgroundColor:g.Color.transparent,textAlign:"center",textAlignVertical:"center",marginRight:5,paddingBottom:1}),bingBackgroundsFont:()=>n.Styles.createTextStyle({fontSize:C.default.fontSize.size13Deprecated,font:C.default.font.uiDisplayRegular}),bingBackgroundsFontColor:()=>n.Styles.createTextStyle({color:g.Color.white}),bingBackgroundsFontColorLight:()=>n.Styles.createTextStyle({color:g.Color.gray400}),bingBackgroundsUserIcon:()=>n.Styles.createViewStyle({marginRight:1}),plusCountContainer:()=>n.Styles.createTextStyle({height:20,minWidth:20,textAlign:"center"})});class v extends S.default{constructor(){super(...arguments),this._onBingBackgroundsPressed=()=>{const e=y.default.newCauseId();d.log(c.LogTraceArea.CallingUI,"CallPanelHeaderV2._onBingBackgroundsPressed, causeId: "+e),this.props.onBingBackgroundsPressed&&this.props.onBingBackgroundsPressed(e)}}_buildState(e,t){const i=r.default.CallParticipantBackgroundInfoStore.getBackgroundInfos(e.callId),a=s.default.getS4LCMCFeatures().bingBackgrounds;return{captions:i,bingBackgroundsUsers:this._getUserIconList(i),showIconCount:a.iconCountInHeader,compactView:l.default.isDesktopMinCallPanelHeaderV2(this._getRootViewId())}}_getUserIconList(e){const t=[];for(let i of a.values(e))""!==i.isoDate&&t.push(i.userId);return t}render(){var e;const t=null!==(e=this.props.textStyleOverride)&&void 0!==e?e:b.bingBackgroundsFont,i=this.props.useLightTheme?b.bingBackgroundsFontColorLight:b.bingBackgroundsFontColor;let a=_.UserIconSize.Size20,s=20,r=14,l=void 0,c=void 0;this.props.v1&&(a=_.UserIconSize.Size14,s=14,r=void 0,l=4,c=2);const d=n.Styles.createViewStyle({height:s,width:s}),h=n.Styles.createViewStyle({marginTop:c}),g=this.props.v1?b.bingBackgroundsIconSmall:b.bingBackgroundsIcon,C=n.Styles.createViewStyle({height:this.props.height,marginLeft:l,marginRight:r}),S=[];if(this.state.bingBackgroundsUsers&&this.state.bingBackgroundsUsers.length>0&&this.state.showIconCount&&this.state.showIconCount>0){const e=this.state.bingBackgroundsUsers.length>this.state.showIconCount?this.state.showIconCount:this.state.bingBackgroundsUsers.length;for(let t=0;t<e;t++){const e=this.state.bingBackgroundsUsers[t];S.push(n.createElement(f.UserIcon,{key:"userIcon-"+t,userMri:e,size:a,useCircleForAgentMask:!0,statusBorderColor:this._themeColors.primaryBackgroundColor,style:[b.bingBackgroundsUserIcon,h]}))}const o=this.state.bingBackgroundsUsers.length-this.state.showIconCount;o>0&&S.push(n.createElement(m.BodyText,{key:"userIcon-hidden",style:[b.bingBackgroundsUserIcon,b.plusCountContainer,i,t,d,h]},"+"+o))}const y=p.getString("CallControls.BingBackgrounds");let v=void 0;return this.state.compactView||(v=n.createElement(m.BodyText,{style:[b.bingBackgroundsText,t]},y)),n.createElement(u.HoverableButton,{style:[b.bingBackgroundsContainer,C],title:y,accessibilityLabel:y,onPress:this._onBingBackgroundsPressed},n.createElement(n.Image,{source:o.Collection.BING_LOGO_SMALL,style:[g,b.bingBackgroundsIconMargin],resizeMode:"cover"}),v,S)}}t.default=v},1771:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IosRouteControlButton=void 0;const a=i(177),n=i(0),o=i(45),s=i(14);class r extends o.default{render(){const e=a.default.routePickerView();return n.createElement(n.View,{style:this.props.style},this.props.children,n.createElement(e,{style:s.default.absoluteFill,accessibilityLabel:this.props.accessibilityLabel}))}}t.IosRouteControlButton=r,t.default=r},1772:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(584),s=i(1256),r=i(60),l=i(110),c=i(3),d=i(824),u=i(4),h=i(121),p=i(20),g=i(10),C=i(29);class m extends d.InitialStateComponent{constructor(){super(...arguments),this._itemPrefix="item_",this._lastReactionPostTime=0,this._isRTL=p.default.isRTL(),this._mountedRefsMap=new h.default,this._onPositionDrawer=(e,t)=>{u.log(c.LogTraceArea.CallReactionsDrawer,"_positionDrawer isOpen: "+t.isOpen+" animated: "+e)},this._onPositionDrawerAnimationCompleted=()=>{u.log(c.LogTraceArea.CallReactionsDrawer,"_onPositionDrawerAnimationCompleted isOpen: "+this.state.isOpen),this._drawerAnimation=void 0;const e=this._mountedRefsMap.ref(this._itemPrefix+0);this.isComponentMounted()&&e&&this.state.isOpen&&e.requestFocus(),this.props.onOpenCloseAnimationComplete&&this.props.onOpenCloseAnimationComplete(this.state.isOpen)},this._renderReactionItem=(e,t)=>{switch(e.type){case r.ReactionsItemType.Animation:case r.ReactionsItemType.Emoticon:case r.ReactionsItemType.Sticker:return this._renderItem(e,t)}},this._onToggleOpen=()=>{const e=!this.state.isOpen;u.log(c.LogTraceArea.CallReactionsDrawer,"_onToggleOpen shouldOpen: "+e),this.setState({isOpen:e})},this._onReactionPressed=(e,t)=>{const i=g.default.newCauseId();u.log(c.LogTraceArea.CallReactionsDrawer,"_onReactionPressed causeId: "+i);const a=Date.now();if(a-this._lastReactionPostTime>=500){const n={reactionInfo:e,causeId:i,timestamp:t,postSource:c.PostSource.CallReactionPressed,callId:this.props.callId,conversationMri:this.props.conversationMri,reactionsConversationMri:this.props.reactionsConversationMri,logTraceArea:c.LogTraceArea.CallReactionsDrawer};o.CallReactionPostingHelpers.postReaction(n),this._selectedReactionInfo=e,this._lastReactionPostTime=a}this._onHandleReactionPressed()},this._onReactionPanHorizontal=e=>{}}_buildState(e,t){return{isOpen:!t&&this.state.isOpen,emoticonReactionKey:l.default.getEmoticonReactionKey(e.celebrationData),reactions:l.default.getReactionItems(e.celebrationData),enableNewMainCallControls:C.default.CallingFeaturesHelper.areNewMainCallControlsEnabled()}}componentMounting(e){super.componentMounting(e),this._positionDrawer(!1,e)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=this.state.isOpen!==t.isOpen;a&&this._positionDrawer(!0,this.state),u.log(c.LogTraceArea.CallReactionsDrawer,"componentDidUpdate  openStateChanged: "+a+" isOpen: "+this.state.isOpen+" emoticonReactionKey: "+this.state.emoticonReactionKey)}_renderContent(){let e=0,t=a.map(this.state.reactions,(t,i)=>this._renderReactionItem(t,i+e));return e+=t.length,this._isRTL&&(t=a.reverse(t)),this._renderReactionViews(a.compact(t))}_renderItem(e,t){if(!e.key)return;const i=this.state.isOpen?void 0:n.Types.ImportantForAccessibility.NoHideDescendants,a=this.state.isOpen?void 0:-1;return n.createElement(s.default,{key:e.key,ref:this._mountedRefsMap.onComponentRef(this._itemPrefix+t),info:e,isAnimated:this.state.isOpen,onPress:this._onReactionPressed,onPanHorizontal:this.state.isOpen?void 0:this._onReactionPanHorizontal,importantForAccessibility:i,tabIndex:a,celebrationData:this.props.celebrationData})}openDrawer(){this.state.isOpen||this._onToggleOpen()}openDrawerOnHover(){}closeDrawer(){return this._drawerAnimation&&(this._drawerAnimation.stop(),this._drawerAnimation=void 0),!!this.state.isOpen&&(u.log(c.LogTraceArea.CallReactionsDrawer,"closeDrawer"),this._onToggleOpen(),!0)}isOpen(){return this.state.isOpen}_onHandleReactionPressed(){}}t.default=m},1773:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallStageLayoutController=void 0;const a=i(1),n=i(7),o=i(3654),s=i(60),r=i(60),l=i(110),c=i(37);i(56);class d{constructor(e){this._isCallStageV2=e,this._controllers={},this._verticalOffset=r.RibbonSizes.defaultRibbonItemTopMargin,this._baseRightInset=r.RibbonSizes.ribbonItemMargin,this._ribbonScrollRightInset=0,this._ribbonContentWidth=0,this._ribbonExpandedMultiplier=1,this._participantDragState=r.ParticipantDragState.Unspecified,this._maxStageElements=4,this._maxElementsInRow=2,this._maxElementsInColumn=2,this._totalStageElements=0,this._videosDimensionsList=[],this._isStageLandscape=!0,this._isGridSquare=!1,this._narrowOrWide=!1,this._enableRNStreamsV2=n.default.getS4LCMCFeaturesNoSubscription().enableRNStreamsV2}updateLayoutInfoForStage(e,t){const i=c.default(this._stageRect,t);this._updateStageElements(t.width,t.height,e.length),this._updateStageLayout(e,t,i),this._stageRect=t}updateLayoutInfo(e,t,i,n,o,l,d,u,h,p=!0,g=!1,C=0,m=!1,S=0){const y=a.filter(e,e=>!!e.displayOnStage),f=p&&c.default(this._stageRect,t);if(this._updateStageElements(t.width,t.height,y.length),this._updateStageLayout(y,t,f),this._stageRect=t,m)return 0;let _=C,b=C,v=C,w=-1;const T=a.filter(e,e=>!e.displayOnStage&&!e.isHiddenBot),I=T?T.length:0,P=S||i;let M=l-i*h-P,k=0;a.each(T,(e,t)=>{e.isLocal&&e.videoType!==s.LayoutInfoVideoType.None&&(M-=n);const a=e.ribbonPosition,l=a>w;let c=e.isLocal&&e.videoType!==s.LayoutInfoVideoType.None?n:i;const d=this.controllerForKey(e.key).getResizeFactor();d>1&&(c*=d);const u=e.key===r.CallStageElementKeys.ribbonModeViewKey?r.RibbonSizes.ribbonModeElementSize:c,h=c,p=this._positionElementInRibbon(e.key,e.videoType,e.videoAspectRatio,l?_:b,this._stageRect,{height:h,width:u},f,g);l&&(b=_,_=Math.max(_,p.x+p.width+r.RibbonSizes.ribbonItemInnerMargin),w=a,e.key===r.CallStageElementKeys.localUserKey&&(C=_));const m=this.controllerForKey(e.key);!o&&_>=M&&(k||t<I-1)||e.hidden?(m.setHidden(!0),k++):(m.setHidden(!1),v=_)});const A=this.controllerForKey(r.CallStageElementKeys.remainderViewKey);if(k){const e=this._positionElementInRibbon(r.CallStageElementKeys.remainderViewKey,void 0,void 0,v,this._stageRect,{height:i,width:i},f);v+=e.width+r.RibbonSizes.ribbonItemInnerMargin,A.setHidden(!1)}else A.setHidden(!0);if(u!==r.RibbonExtraVisibility.None){const e=this.controllerForKey(r.CallStageElementKeys.addToCallViewKey),t=this._positionElementInRibbon(r.CallStageElementKeys.addToCallViewKey,void 0,void 0,v,this._stageRect,{height:i,width:i},f);v+=t.width+r.RibbonSizes.ribbonItemInnerMargin,e.setHidden(u===r.RibbonExtraVisibility.Hidden)}const R=this.controllerForKey(r.CallStageElementKeys.ribbonModeViewKey),V=this._positionElementInRibbon(r.CallStageElementKeys.ribbonModeViewKey,void 0,void 0,v,this._stageRect,{height:i,width:P},f);return v+=V.width+r.RibbonSizes.ribbonItemInnerMargin,R.setHidden(d===r.RibbonExtraVisibility.Hidden),this._ribbonContentWidth=v,this._updateRibbonScrollInset(this._ribbonScrollRightInset,t,f),k}updateRibbonExpandedMultiplier(e,t,i=!1){this._ribbonExpandedMultiplier!==e&&(a.each(this._controllers,a=>a.updateRibbonExpandedMultiplier(e,t,i)),this._ribbonExpandedMultiplier=e)}updateRibbonVerticalOffset(e,t=!1,i=r.CallStageConfig.animationDuration){this._verticalOffset!==e&&(a.each(this._controllers,a=>a.updateRibbonVerticalOffset(e,this._stageRect,t,i)),this._verticalOffset=e)}ribbonWidth(){return this._ribbonContentWidth+this._baseRightInset}setCallHeaderPanelLayout(e){this._callPanelHeaderLayout=e,a.each(this._controllers,t=>t.setCallHeaderPanelLayout(e))}controllerForKey(e){let t=this._controllers[e];return t||(t=new o.CallItemLayoutController(e,this._verticalOffset,this._totalRibbonRightInset(),this._ribbonExpandedMultiplier,this._isCallStageV2),t.setCallHeaderPanelLayout(this._callPanelHeaderLayout),this._controllers[e]=t),t}setParticipantDragState(e){this._participantDragState=e}resetParticipantDragState(){this._onGestureComplete()}getParticipantDragState(){return this._participantDragState}onPan(e,t,i,a,n,o){if(!e)return this._panRibbon(i,a),!1;const s=this.controllerForKey(e);if(this._participantDragState!==r.ParticipantDragState.Move){if(s.isCompact()&&this._panRibbon(i,a))return!1;t&&(this._participantDragState=r.ParticipantDragState.Move)}this._participantDragState===r.ParticipantDragState.Move&&s.onPan(i,a,n);const l=this._participantDragState===r.ParticipantDragState.Move;return i.isComplete&&this._onGestureComplete(),l}getMaxNumberOfStageElements(){return this._maxStageElements}isStageLandscape(){return this._isStageLandscape}isGridSquare(){return this._isGridSquare}shouldSwitchOrientation(){return this.isStageLandscape()&&!this._narrowOrWide&&!this.isGridSquare()||!this.isStageLandscape()&&(this._narrowOrWide||this.isGridSquare())}_updateStageElements(e,t,i){if(0===e||0===t)return;const a=e/t,o=n.default.getS4LCMCFeaturesNoSubscription().modernCallStage,s=o.minVideoSize.width,r=o.minVideoSize.height;if(0===s||0===r)return;let c,d;if(c=Math.round(e/s),d=Math.round(t/r),this._maxElementsInColumn!==d||this._maxElementsInRow!==c||this._totalStageElements!==i){this._maxElementsInRow=c,this._maxElementsInColumn=d;const e=this._maxElementsInRow*this._maxElementsInColumn;this._maxStageElements=Math.min(o.maxStageElements,e);const t=l.default.getStageVideoCount(i,this._maxElementsInRow,this._maxElementsInColumn,a>1);this._totalStageElements=i,this._isGridSquare=t.width===t.height,this._isStageLandscape=a>1,this._narrowOrWide=!this._isGridSquare&&(a>2||a<1),this._videosDimensionsList=l.default.getSizesForStageElements([],i,t,this._isGridSquare?!this._isStageLandscape:this._isStageLandscape,t,this._narrowOrWide)}}_panRibbon(e,t){const i=this._shouldScrollRibbon(t)?20:0;if(this._participantDragState===r.ParticipantDragState.Pan||Math.abs(e.pageY-e.initialPageY)<i){if(!a.isUndefined(this._lastPageX)){const i=this._lastPageX-e.pageX;this._updateRibbonScrollInset(this._ribbonScrollRightInset+i,t),this._participantDragState===r.ParticipantDragState.Unspecified&&Math.abs(e.pageX-e.initialPageX)>20&&(this._participantDragState=r.ParticipantDragState.Pan)}return this._lastPageX=e.pageX,e.isComplete&&this._onGestureComplete(),!0}return!1}_onGestureComplete(){this._participantDragState=r.ParticipantDragState.Unspecified,this._lastPageX=void 0}_shouldScrollRibbon(e){return this._ribbonContentWidth+this._baseRightInset>e.width}_updateRibbonScrollInset(e,t,i=!1,n=r.CallStageConfig.animationDuration){let o=Math.min(e,0);const s=this._shouldScrollRibbon(t)?t.width-(this._ribbonContentWidth+this._baseRightInset):0;o=Math.max(o,s),this._ribbonScrollRightInset!==o&&(this._ribbonScrollRightInset=o,a.each(this._controllers,e=>e.updateRibbonRightInset(this._totalRibbonRightInset(),t,i,n)))}_totalRibbonRightInset(){return this._baseRightInset+this._ribbonScrollRightInset}_positionElementInRibbon(e,t,i,a,n,o,r=!1,c=!1){const d=this.controllerForKey(e),u=l.default.ribbonLayoutRect(t,i,a,o,c,this._enableRNStreamsV2);return d.setRibbonPosition(u,!!t&&t!==s.LayoutInfoVideoType.None,n,o.width,r),u}_updateStageLayout(e,t,i=!1){a.each(e,a=>{var n;const o=a.stagePosition,r=this.controllerForKey(a.key),c=this._videosDimensionsList[o],d=l.default.stageLayoutRect(t,c);a.isTopRow=l.default.isTopStageElement(e,this._currentElementKeyPositions,this._videosDimensionsList,o),r.setIsTopRowElement(null!==(n=a.isTopRow)&&void 0!==n&&n),r.setStagePosition(this._maxStageElements,d,o,a.videoType!==s.LayoutInfoVideoType.None,t,i,c),r.setHidden(!1)})}setElementsPositions(e){const t={};for(let i=0;i<e.length;i++){const a=e[i];t[i]=a}this._currentElementKeyPositions=t}}t.CallStageLayoutController=d,t.default=d},1774:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(825),o=i(0),s=i(15),r=i(7),l=i(325),c=i(3),d=i(1084),u=i(4),h=i(6),p=i(324),g=i(28),C=i(14),m=h.lazyProperties({reactionContainer:()=>[C.default.absoluteFill,C.default.flexOne],animationStyle:()=>o.Styles.createViewStyle({position:"absolute",top:0,bottom:0,overflow:"visible",alignSelf:"center",alignContent:"center"})});class S extends s.ComponentBase{constructor(){super(...arguments),this._isAnimationPlaying=!1,this._reactionKey="",this._onAEAnimationRef=e=>{this._aeAnimatedView=e||void 0},this._startAnimation=()=>{this._aeAnimatedView&&!this._isAnimationPlaying&&(u.log(c.LogTraceArea.CallReactions,"CelebrationAnimationView._startAnimation"),this._isAnimationPlaying=!0,this._aeAnimatedView.play(),l.default.setAnimationIsPlaying(this._isAnimationPlaying),a.delay(()=>{this.props.onAnimationOut&&this.props.onAnimationOut(),this._isAnimationPlaying=!1,l.default.setAnimationIsPlaying(this._isAnimationPlaying),this.isComponentMounted()&&this.setState({shouldRenderAEAnimationView:!1})},this.state.animationTimeoutInMs))},this._resetAnimation=()=>{u.log(c.LogTraceArea.CallReactions,"CelebrationAnimationView._resetAnimation"),this._aeAnimatedView&&this._aeAnimatedView.reset()}}_buildState(e,t){const i=t?Date.now():this.state.reactionsCutOff;let a=t?void 0:this.state.animationReactionInfo,n=!t&&this.state.shouldRenderAEAnimationView,o=!1;const s=r.default.getS4LCMCFeatures().enableNewAnimations?r.default.getS4LCMCFeatures().callAnimatedReactionsConfig.callAnimatedReactionsTimeoutsinMs:r.default.getS4LCMCFeatures().callCelebrationConfig.celebrationAnimationTimeoutsinMs;let c=s.default;const d=l.default.getLastReaction(e.conversationMri,i);if(!this._isAnimationPlaying&&d){const e=p.default.callReactionInfoForReaction(d);if(this._reactionKey=this._getReactionKey(e),(e.reactionsTextStyle===g.ReactionsTextStyle.Animation||this._isNewAnimatedReaction(e))&&(o=!0,t||this._didReceiveNewAnimation(a,e))){a=e;const t=this._reactionKey;n=r.default.getS4LUiFeatures().jsonAnimationEnabled,t&&s[t]&&(c=s[t])}}return{reactionsCutOff:i,animationTimeoutInMs:c,animationReactionInfo:a,shouldRenderAEAnimationView:n,isReactionNewAnimation:o}}_isNewAnimatedReaction(e){return r.default.getS4LCMCFeatures().enableNewAnimations&&(null==e?void 0:e.reactionsTextStyle)===g.ReactionsTextStyle.Default&&p.default.isSuperAnimationReaction(this._reactionKey)}_getReactionKey(e){return(null==e?void 0:e.reaction.getEmoticonCallReactionKey())||""}componentWillUnmount(){u.log(c.LogTraceArea.CallReactions,"CelebrationAnimationView.componentWillUnmount"),super.componentWillUnmount(),this._resetAnimation(),this.props.onAnimationOut&&this.props.onAnimationOut()}componentDidMount(){u.log(c.LogTraceArea.CallReactions,"CelebrationAnimationView.componentDidMount"),super.componentDidMount(),this.state.animationReactionInfo&&this._startAnimation()}_didReceiveNewAnimation(e,t){let i=!1;return t&&(e?t.reaction.createdTime>e.reaction.createdTime&&t.reaction.cuid!==e.reaction.cuid&&(i=!0):i=!0),i}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=this._didReceiveNewAnimation(t.animationReactionInfo,this.state.animationReactionInfo);u.log(c.LogTraceArea.CallReactions,"CelebrationAnimationView.componentDidUpdate CallReactionsStore.isAnimationPlaying() "+l.default.isAnimationPlaying()+"; shouldUpdateAnimation "+a),a&&(this._resetAnimation(),this._startAnimation())}shouldComponentUpdate(){return!l.default.isAnimationPlaying()}_getScaledDimensionsStyle(e){const t=e.intrinsicSize.width/e.intrinsicSize.height,i=this.props.width/t<=this.props.height;let a=this.props.width,n=this.props.height,s=0;return i?n=this.props.width/t:(a=this.props.height*t,s=(this.props.width-a)/2),o.Styles.createViewStyle({width:a,height:n,left:s,right:s},!1)}render(){let e;if(this.state.shouldRenderAEAnimationView&&this.state.animationReactionInfo&&this.state.isReactionNewAnimation){const t=p.default.animationInfoForKey(this.state.animationReactionInfo.content||this._reactionKey,!0);if(t){let i=[C.default.absoluteFill,C.default.flexOne];{const e=o.Styles.createViewStyle({width:t.intrinsicSize.width,height:this.props.height},!1);i=[m.animationStyle,e]}const a=d.default.getAssetSourceWithColor(t);e=o.createElement(n.default,Object.assign({},a,{style:i,source:t.source,ref:this._onAEAnimationRef}))}}return o.createElement(o.Animated.View,{style:m.reactionContainer,blockPointerEvents:!0,ignorePointerEvents:!0},e)}}t.default=S},1775:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(34),n=i(1),o=i(0),s=i(15),r=i(325),l=i(60),c=i(3),d=i(3655),u=i(4),h=i(6),p=i(121),g=i(21),C=i(324),m=h.lazyProperties({container:()=>o.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"visible"})});class S extends s.ComponentBase{constructor(){super(...arguments),this._mountedRefsMap=new p.default,this.showMessage=e=>{u.log(c.LogTraceArea.CallReactions,"InlineCallStageReactionsView.showMessage cuid: "+e.reaction.cuid);const t=this.state.callParticipantReactions,i=e.reaction.creator,a=g.default.isMyMri(i)?l.CallStageElementKeys.localUserKey:i;t[a]=e,n.each(n.keys(t),e=>{if(e!==a){const t=this._mountedRefsMap.ref(e);t&&t.dismiss()}});const o=this.state.sequence+1;return this.setState({callParticipantReactions:t,sequence:o}),!0},this.dismissReaction=e=>{u.log(c.LogTraceArea.CallReactions,"InlineCallStageReactionsView.dismissReaction, key: "+a.pii.Omit(e));const t=this.state.callParticipantReactions;if(t[e]){delete t[e];const i=this.state.sequence+1;this.setState({callParticipantReactions:t,sequence:i})}},this._onAnimationEnd=e=>{if(this.isComponentMounted()){const t=e.reaction.creator,i=g.default.isMyMri(t)?l.CallStageElementKeys.localUserKey:t,a=e.reaction.cuid,n=this.state.callParticipantReactions;if(n[i]&&n[i].reaction.cuid===a){delete n[i];const e=this.state.sequence+1;this.setState({callParticipantReactions:n,sequence:e})}}},this._getAnchorInfo=e=>this.props.getAnchorInfo(e)||{rect:{x:this.props.alignRight?this.props.parentDimensions.width:0,y:20,height:this.props.topOffsetForUnhandledReactions,width:this.props.topOffsetForUnhandledReactions/2},hidden:!0}}_buildState(e,t){const i=t?Date.now():this.state.reactionsCutoff,a=r.default.getLastReaction(e.reactionsConversationMri,i);let n={lastReactionInfo:a&&C.default.callReactionInfoForReaction(a),reactionsCutoff:i};return t&&(n.callParticipantReactions={},n.sequence=0),n}componentDidMount(){super.componentDidMount();const e=this.props.getCallReactionsDisplayHelper();e.registerUnhandledReactionCallback(this.showMessage),e.registerUnhandledReactionDismissCallback(this.dismissReaction)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=t.lastReactionInfo?t.lastReactionInfo.reaction.cuid:void 0,n=this.state.lastReactionInfo?this.state.lastReactionInfo.reaction.cuid:void 0;this.state.lastReactionInfo&&a!==n&&this.props.getCallReactionsDisplayHelper().showReaction(this.state.lastReactionInfo)}componentWillUnmount(){super.componentWillUnmount(),this.props.getCallReactionsDisplayHelper().unregisterUnhandledReactionCallback(),this.props.getCallReactionsDisplayHelper().unregisterUnhandledReactionDismissCallback()}updateElementDimensions(e,t){const i=this._mountedRefsMap.ref(e);i&&i.updateAnchorInfo()}_renderReactionsFeed(e,t){return o.createElement(d.default,{key:e+"feed",ref:this._mountedRefsMap.onComponentRef(e),creatorKey:e,callParticipantReaction:t,alignRight:this.props.alignRight,onRemoveReaction:this._onAnimationEnd,getAnchorInfo:this._getAnchorInfo,getAnchorRectChanges:this.props.getAnchorInfoChanges,onReactionTap:this.props.onReactionTap})}render(){const e=n.map(this.state.callParticipantReactions,(e,t)=>e?this._renderReactionsFeed(t,e):void 0);return o.createElement(o.View,{style:[m.container,this.props.style],blockPointerEvents:this.props.blockPointerEvents,ignorePointerEvents:this.props.ignorePointerEvents},e)}}t.default=S},1776:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NewCallReactionsView=void 0;const a=i(0),n=i(12),o=i(1775),s=i(60),r=i(6),l=i(14),c=i(185),d=i(10),u=i(4),h=i(132),p=i(21),g=r.lazyProperties({reactionsView:()=>l.default.absoluteFill});class C extends n.default{constructor(){super(...arguments),this._stageReactionsAnimatedOpacityValue=new a.Animated.Value(1),this._stageReactionsAnimatedStyle=a.Styles.createAnimatedViewStyle({opacity:this._stageReactionsAnimatedOpacityValue}),this._getAnchorInfoChanges=(e,t)=>{},this._onTextReactionPressed=()=>{if(this.props.onTextReactionPressed){const e=d.default.newCauseId();u.log(c.LogTraceArea.CallingUI,"CallStageView._onTextReactionPressed, causeId: "+e),this.props.onTextReactionPressed(e)}},this._getAnchorInfo=e=>{const t=p.default.isMyMri(e)?s.CallStageElementKeys.localUserKey:e;let i=void 0;return h.default.measureLayoutRelativeToAncestor(()=>this.props.getChildRef(t),this.props.getParentRef).then(e=>{i={rect:e,hidden:!1}}),i}}render(){return this.props.disableReactions?null:a.createElement(a.Animated.View,{style:[g.reactionsView,this._stageReactionsAnimatedStyle],key:s.CallStageElementKeys.callTextReactionViewKey,ignorePointerEvents:!0},a.createElement(o.default,{reactionsConversationMri:this.props.reactionsConversationId,ignorePointerEvents:!0,parentDimensions:this.props.parentDimensions,topOffsetForUnhandledReactions:0,alignRight:!0,getAnchorInfo:this._getAnchorInfo,getAnchorInfoChanges:this._getAnchorInfoChanges,getCallReactionsDisplayHelper:this.props.getCallReactionsDisplayHelper,onReactionTap:this._onTextReactionPressed}))}}t.NewCallReactionsView=C},1777:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(15),o=i(6),s=i(9),r=i(16),l=i(101),c=o.lazyProperties({container:()=>a.Styles.createViewStyle({alignItems:"flex-start",marginBottom:2}),userIcon:()=>a.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,overflow:"visible"})});class d extends n.ComponentBase{render(){const e=this.props.isInterimCaptionConcatenated?this.props.transcription.sentence:this.props.transcription.payload.translation||this.props.transcription.payload.message;if(!e)return null;const t=this.props.iconSize/2,i=a.Styles.createViewStyle({alignItems:"flex-start",marginLeft:t,borderRadius:3,backgroundColor:s.Color.blackOverlay70},!1),n=a.Styles.createTextStyle({minHeight:this.props.iconSize,paddingLeft:t+10,paddingRight:10,paddingVertical:2,color:this.props.transcription.payload.isFinal?s.Color.white:s.Color.gray300},!1);return a.createElement(a.View,{style:c.container,disableTouchOpacityAnimation:!0},a.createElement(a.View,{style:i,key:"text"},a.createElement(r.BodyText,{style:n},e)),a.createElement(a.View,{style:c.userIcon,key:"icon"},a.createElement(l.UserIcon,{userMri:this.props.transcription.senderMri,size:this.props.iconSize,showBorder:!0})))}}t.default=d},1782:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HoverPopup=void 0;const a=i(91),n=i(0),o=i(145),s=i(54),r=i(3),l=i(4),c=i(6),d=i(9),u=i(12),h=i(31),p=i(3672),g=c.lazyProperties({transparentWrapper:()=>n.Styles.createViewStyle({padding:65})});class C extends u.default{constructor(){super(...arguments),this._isPopupHovered=!1,this._isAnchorHovered=!1,this._isAnchorLongPressed=!1,this._onBack=()=>(this._dismissSticky(),!0),this._dismissSticky=()=>{this.props.isSticky&&s.default.dismissPopup(this.props.popupId,this._getRootViewId()),this._onClosed()},this._showPopup=()=>{h.default.setTimeout(()=>{this._allowShowPopup()&&this.isComponentMounted()&&this.showImmediately()},1e3)},this._renderPopup=(e,t,i,a)=>n.createElement(p.default,{anchorPosition:e,anchorOffset:t,popupWidth:i,popupHeight:a,fillColor:d.Color.transparent,strokeColor:d.Color.transparent,popupAccessibilityTitle:this.popupDescription(),offset:{x:-5,y:-18},onContentDimensionsChanged:this._reconstructPopup,renderContent:()=>this.renderContent()}),this._reconstructPopup=()=>{this.hideImmediately(),this.showImmediately()},this.showImmediately=()=>{l.log(r.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}].showImmediately, executed`),this.setState({shouldShowPopup:!0},()=>{if(this._animatedPopupRef&&this._animatedPopupRef.fadeIn(),this.props.isSticky){const e={getAnchor:this.props.anchor,renderPopup:this._renderPopup,rootViewId:this._getRootViewId(),positionPriorities:["top"],onDismiss:this._onClosed,dismissIfShown:!0};s.default.showPopup(e,this.props.popupId)}this._onOpened(this._isAnchorLongPressed)})},this.hideImmediately=()=>{l.log(r.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}].hideImmediately, executed`),this.setState({shouldShowPopup:!1}),this.props.isSticky?this._dismissSticky():this._onClosed()},this._hidePopup=e=>{l.log(r.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}]._hidePopup, settingTimeout`),h.default.setTimeout(()=>{l.log(r.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}]._hidePopup, shouldFade: ${e}`),this._allowHidePopup()?e?this._animatedPopupRef&&this._animatedPopupRef.fadeOut(e=>{e.finished&&this.isComponentMounted()&&this.hideImmediately()}):this.isComponentMounted()&&this.hideImmediately():l.log(r.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}]._hidePopup, notAllowed`)},50)},this.onAnchorEnter=()=>{l.log(r.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}].onAnchorEnter`),this._isAnchorHovered=!0,this.props.isSticky||this._showPopup()},this.onAnchorLeave=()=>{l.log(r.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}].onAnchorLeave`),this._isAnchorHovered=!1,this._isAnchorLongPressed=!1,this.props.isSticky||this._hidePopup(!0)},this.onAnchorLongPress=()=>{l.log(r.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}].onAnchorLongPress`),this._isAnchorHovered=!1,this._isAnchorLongPressed=!0,this.props.isSticky?this.showImmediately():this._showPopup()},this.onAnchorPress=()=>{l.log(r.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}].onAnchorPress`),this._isAnchorHovered=!1,this._isAnchorLongPressed=!1,this.props.isSticky?this.hideImmediately():this._hidePopup(!1)},this._defaultAllowShowPopupConditions=()=>(this._isAnchorHovered||this._isAnchorLongPressed)&&!this.state.shouldShowPopup,this._defaultAllowHidePopupConditions=()=>!this._isAnchorHovered&&!this._isAnchorLongPressed&&!this._isPopupHovered&&this.state.shouldShowPopup,this._allowShowPopup=()=>this._defaultAllowShowPopupConditions(),this._allowHidePopup=()=>this._defaultAllowHidePopupConditions(),this._onOpened=e=>{this.onOpened(e),this.props.onOpened&&this.props.onOpened()},this._onClosed=()=>{this.onClosed(),this.props.onClosed&&this.props.onClosed()},this._onPopupEnter=()=>{l.log(r.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}]._onPopupEnter`),this._isPopupHovered=!0},this._onPopupLeave=()=>{l.log(r.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}]._onPopupLeave`),this._isPopupHovered=!1,this.props.isSticky||this._hidePopup(!0)},this._onAnimatedPopupRef=e=>{this._animatedPopupRef=e||void 0}}_buildState(e,t){let i={};return t&&(i.shouldShowPopup=!1),i}render(){return!this.state.shouldShowPopup||this.props.isSticky?null:n.createElement(a.View,{ref:this._onAnimatedPopupRef,style:[g.transparentWrapper,this.props.style],opacity:0,onMouseEnter:this._onPopupEnter,onMouseLeave:this._onPopupLeave},this.renderContent())}componentDidMount(){super.componentDidMount(),this.props.isSticky&&(this._getContext().isPresentedInGenericDesktopModal||o.default.subscribe(this._onBack))}componentWillUnmount(){super.componentWillUnmount(),o.default.unsubscribe(this._onBack)}}t.HoverPopup=C},1784:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(29),s=i(5),r=(i(48),i(3675)),l=i(12);class c extends l.default{constructor(){super(...arguments),this._onVolumeChange=e=>{if(!this.isComponentMounted())return;const t=a.round(10*e,1);this.setState({accessibilityVolume:t}),this.props.onAdjustVolume&&this.props.onAdjustVolume(),this._setVolume(e)},this._onSelectedDeviceChanged=()=>{this.setState({initialValue:this._getVolume()})}}componentDidMount(){super.componentDidMount(),o.default.DeviceStore.selectedDevicesChangedEvent().subscribe(this._onSelectedDeviceChanged)}componentWillUnmount(){super.componentWillUnmount(),o.default.DeviceStore.selectedDevicesChangedEvent().unsubscribe(this._onSelectedDeviceChanged),o.default.DeviceStore.saveSettings()}_getAccessibilityVolumeAnnouncement(e){return s.getString("AudioVideoSettings.SpeakerVolumeSliderAnnouncement",{volume:e})}_buildState(e,t){return{initialValue:t?this._getVolume():-1,accessibilityVolume:a.round(this._getVolume()/10,1)}}render(){return n.createElement(r.default,{style:this.props.style,value:-1!==this.state.initialValue?this.state.initialValue/100:void 0,trackHeight:this.props.trackHeight||10,handleSize:this.props.handleSize||26,onProgressChange:this._onVolumeChange,accessibilityLabel:this._getAccessibilityLabel(),colorThemeOverride:this.props.colorThemeOverride,dragStep:.02,ariaValueNow:this.state.accessibilityVolume})}}t.default=c},1786:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(88),n=i(113),o=i(3),s=i(4),r=i(5),l=i(72),c=i(10),d="LeaveCall",u="EndCallForEveryOne";class h{static selectEndCallMenuItem(e,t,i){const n=c.default.newCauseId();switch(s.log(o.LogTraceArea.CallingUI,"CallControlsEndCallContextMenu.selectEndCallMenuItem causeId: "+n),l.default.dismiss(h._endCallMenuId,t),e){case u:i(!0,n),s.track(new a.EndCallPopupMenuActionsEvent(a.EndCallPopupActions.EndCallForEveryone));break;case d:i(!1,n),s.track(new a.EndCallPopupMenuActionsEvent(a.EndCallPopupActions.LeaveCall))}}static _getEndCallMenuConfig(e){return{anchor:e,useTheme:!0,positionPriorities:["top","bottom"],popupBeakSize:{height:0,width:0},popupOffset:{x:0,y:-10}}}}t.default=h,h._endCallMenuId=l.default.menuId(),h.showEndCallMenuPopup=(e,t,i,n)=>{const o=h._getEndCallMenuConfig(i);l.default.showWithOptions({id:h._endCallMenuId,config:o,getMenuItems:h._getEndCallMenuItems,handleMenuCommand:n,rootViewId:e,invokingEvent:t})&&s.track(new a.EndCallPopupMenuActionsEvent(a.EndCallPopupActions.EndCallPopupShown))},h._getEndCallMenuItems=()=>{let e=[];return e.push({text:r.getString("CallControls.LeaveCall"),command:d}),n.default.call().canEndCallForAll&&e.push({text:r.getString("CallControls.HangupAllMessageDesktop"),command:u}),e}},1794:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(460),s=i(534),r=i(3692),l=i(106),c=i(6),d=i(5),u=i(1260),h=c.lazyProperties({dialpad:()=>n.Styles.createViewStyle({flexGrow:1,flexShrink:0,marginHorizontal:5}),row:()=>n.Styles.createViewStyle({flexDirection:"row",flexGrow:1,flexShrink:0}),rowReverse:()=>n.Styles.createViewStyle({flexDirection:"row-reverse",flexGrow:1,flexShrink:0})}),p={dialpad:c.lazyProperties({MobileSmall:()=>n.Styles.createViewStyle({marginVertical:5}),MobileMedium:()=>n.Styles.createTextStyle({marginVertical:10}),MobileDefaultLandscape:()=>n.Styles.createTextStyle({marginVertical:10}),MobileDefault:()=>n.Styles.createTextStyle({marginVertical:15}),DesktopDefault:()=>n.Styles.createTextStyle({marginVertical:5})})},g=/[\r\n]+/;class C extends u.ResponsiveComponentBase{constructor(e){super(e),this._focusedButtonIndex=0,this._dialpadButtons=[],this._dialpadButtonRefCallbacks={},this._dialpadButtonPressCallbacks={},this._getLocalizationLetters=e=>{let t;switch(e){default:case"ABC":t=d.getString("PSTNDialerPanel.DialpadLocalizationLetters_ABC");break;case"DEF":t=d.getString("PSTNDialerPanel.DialpadLocalizationLetters_DEF");break;case"GHI":t=d.getString("PSTNDialerPanel.DialpadLocalizationLetters_GHI");break;case"JKL":t=d.getString("PSTNDialerPanel.DialpadLocalizationLetters_JKL");break;case"MNO":t=d.getString("PSTNDialerPanel.DialpadLocalizationLetters_MNO");break;case"PQRS":t=d.getString("PSTNDialerPanel.DialpadLocalizationLetters_PQRS");break;case"TUV":t=d.getString("PSTNDialerPanel.DialpadLocalizationLetters_TUV");break;case"WXYZ":t=d.getString("PSTNDialerPanel.DialpadLocalizationLetters_WXYZ")}return a.split(t,g)},this._onKeyPress=e=>{let t=-1;if(e.keyCode===l.default.UP?t=0:e.keyCode===l.default.RIGHT?t=1:e.keyCode===l.default.DOWN?t=2:e.keyCode===l.default.LEFT&&(t=3),t>=0){let i=this._buttonsNavigationMap[this._focusedButtonIndex][t],a=this._dialpadButtons[i];for(;a&&a.props.buttonDisabled;)i=this._buttonsNavigationMap[i][t],a=this._dialpadButtons[i];this._focusButton(a),e.preventDefault(),e.stopPropagation()}},this._onKeyLongPress=e=>t=>{this.props.onKeyLongPress&&this.props.onKeyLongPress(e)},this._onButtonFocused=e=>{const t=this._focusedButtonIndex;if(this._focusedButtonIndex=a.findIndex(this._dialpadButtons,t=>t&&t.props.value===e.props.title)||0,this._focusedButtonIndex!==t){const e=this._dialpadButtons[t];e&&e.resetFocus()}},this._buttons={1:void 0,2:this._getLocalizationLetters("ABC"),3:this._getLocalizationLetters("DEF"),4:this._getLocalizationLetters("GHI"),5:this._getLocalizationLetters("JKL"),6:this._getLocalizationLetters("MNO"),7:this._getLocalizationLetters("PQRS"),8:this._getLocalizationLetters("TUV"),9:this._getLocalizationLetters("WXYZ"),"*":e.isDtmfDialpad?void 0:[","],",":void 0,0:["+"],"#":void 0},this._buttonsNavigationMap={0:[9,1,3,2],1:[10,2,4,0],2:[11,0,5,1],3:[0,4,6,5],4:[1,5,7,3],5:[2,3,8,4],6:[3,7,9,8],7:[4,8,10,6],8:[5,6,11,7],9:[6,10,0,11],10:[7,11,1,9],11:[8,9,2,10]}}_buildState(e,t){const i=super._buildState(e,t);return i.isCollapsed=s.default.isDialpadCollapsed(),i.isDialingExtension=s.default.isDialingExtension(),i.showCommaButton=!s.default.isDialingExtension()&&!e.isDtmfDialpad,i.canDialComma=s.default.canDialComma(),i}componentDidMount(){super.componentDidMount(),o.default.isCallingBundleLoaded()||(this._dialpadButtons.forEach(e=>null==e?void 0:e.toggleDisabledState(!0)),o.default.getCallingBundleStartupable().performAfterInitialized().then(()=>{this._dialpadButtons.forEach(e=>null==e?void 0:e.toggleDisabledState(!1))}))}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),!this.props.isDtmfDialpad&&t.showCommaButton!==this.state.showCommaButton){let e=this._dialpadButtons[this._focusedButtonIndex];e&&e.props.buttonDisabled&&(e.resetFocus(),e=this._dialpadButtons[0],e&&e.setLastFocused())}}_getRowsCount(){let e=0;return a.each(this._buttons,t=>{const i=a.size(t);return!(e<i&&(e=i,2===e))}),e+1}focusFirst(){this._focusButton(this._dialpadButtons[0]),n.Accessibility.announceForAccessibility("1")}render(){const e=[h.dialpad,this._chooseResponsiveStyle(p.dialpad)],t=this._getContext().isRTL?h.rowReverse:h.row,i=this._getRowsCount(),a={onButtonFocused:this._onButtonFocused,isInLandscape:this.props.isInLandscape,isDtmfDialpad:this.props.isDtmfDialpad,disableFontScaling:this.props.disableFontScaling};return n.createElement(n.View,{style:e,onKeyPress:this._onKeyPress,importantForAccessibility:this.state.isCollapsed?n.Types.ImportantForAccessibility.NoHideDescendants:void 0},n.createElement(n.View,{style:t},n.createElement(r.default,Object.assign({value:"1",rowCount:i,letters:this._buttons[1],ref:this._getDialpadButtonRefCallback(0),onPress:this._getDialpadButtonPressCallback("1")},a)),n.createElement(r.default,Object.assign({value:"2",rowCount:i,letters:this._buttons[2],ref:this._getDialpadButtonRefCallback(1),onPress:this._getDialpadButtonPressCallback("2")},a)),n.createElement(r.default,Object.assign({value:"3",rowCount:i,letters:this._buttons[3],ref:this._getDialpadButtonRefCallback(2),onPress:this._getDialpadButtonPressCallback("3")},a))),n.createElement(n.View,{style:t},n.createElement(r.default,Object.assign({value:"4",rowCount:i,letters:this._buttons[4],ref:this._getDialpadButtonRefCallback(3),onPress:this._getDialpadButtonPressCallback("4")},a)),n.createElement(r.default,Object.assign({value:"5",rowCount:i,letters:this._buttons[5],ref:this._getDialpadButtonRefCallback(4),onPress:this._getDialpadButtonPressCallback("5")},a)),n.createElement(r.default,Object.assign({value:"6",rowCount:i,letters:this._buttons[6],ref:this._getDialpadButtonRefCallback(5),onPress:this._getDialpadButtonPressCallback("6")},a))),n.createElement(n.View,{style:t},n.createElement(r.default,Object.assign({value:"7",rowCount:i,letters:this._buttons[7],ref:this._getDialpadButtonRefCallback(6),onPress:this._getDialpadButtonPressCallback("7")},a)),n.createElement(r.default,Object.assign({value:"8",rowCount:i,letters:this._buttons[8],ref:this._getDialpadButtonRefCallback(7),onPress:this._getDialpadButtonPressCallback("8")},a)),n.createElement(r.default,Object.assign({value:"9",rowCount:i,letters:this._buttons[9],ref:this._getDialpadButtonRefCallback(8),onPress:this._getDialpadButtonPressCallback("9")},a))),n.createElement(n.View,{style:t},n.createElement(r.default,Object.assign({overrideKey:"buttonStarComma",value:this.state.showCommaButton?",":"*",accessibilityLabel:this.state.showCommaButton?d.getString("KeyboardShortcuts.CommaKey"):void 0,rowCount:i,letters:this._buttons[this.state.showCommaButton?",":"*"],longPressValue:this.props.isDtmfDialpad||this.state.showCommaButton?void 0:",",buttonDisabled:!this.props.isDtmfDialpad&&!this.state.canDialComma,ref:this._getDialpadButtonRefCallback(9),onPress:this._getDialpadButtonPressCallback(this.state.showCommaButton?",":"*"),onLongPress:this.props.isDtmfDialpad||this.state.showCommaButton?void 0:this._onKeyLongPress("*")},a)),n.createElement(r.default,Object.assign({value:"0",rowCount:i,letters:this._buttons[0],longPressValue:"+",ref:this._getDialpadButtonRefCallback(10),onPress:this._getDialpadButtonPressCallback("0"),onLongPress:this._onKeyLongPress("0")},a)),n.createElement(r.default,Object.assign({value:"#",rowCount:i,letters:this._buttons["#"],buttonDisabled:!this.props.isDtmfDialpad&&!this.state.isDialingExtension,ref:this._getDialpadButtonRefCallback(11),onPress:this._getDialpadButtonPressCallback("#")},a))))}_getDialpadButtonRefCallback(e){return this._dialpadButtonRefCallbacks[e]||(this._dialpadButtonRefCallbacks[e]=t=>{this._dialpadButtons[e]=t||void 0}),this._dialpadButtonRefCallbacks[e]}_getDialpadButtonPressCallback(e){return this._dialpadButtonPressCallbacks[e]||(this._dialpadButtonPressCallbacks[e]=t=>{this.props.onKeyPress&&this.props.onKeyPress(e)}),this._dialpadButtonPressCallbacks[e]}_focusButton(e){e&&e.requestFocus()}}t.default=C},1795:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(384),s=i(88),r=i(110),l=i(32),c=i(3),d=i(1261),u=i(1796),h=i(125),p=i(6),g=i(5),C=i(11),m=p.lazyProperties({buttonRow:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"visible"})});class S extends u.IncomingRingControlsBase{constructor(e){super(s.CallControlContext.IncomingRingControls,e),this._onAnswerCallKeyboardShortcut=()=>(this._answerCommand.execute(),!0),this._onRejectCallKeyboardShortcut=()=>(this._rejectCommand.execute(),!0),this._onRejectCall=()=>{this._rejectCommand.execute()},this._onAnswerCallWithVideo=()=>{this.props.onPress&&this.props.onPress(),this._answerWithVideoCommand.execute()},this._onAnswerCall=()=>{this.props.onPress&&this.props.onPress(),this._answerCommand.execute()},this._onMergeCall=()=>{this.props.onPress&&this.props.onPress(),new d.MergeIncomingCallCommand(this.props.callId).execute()}}_buildState(e,t){return this._initializeCommands(e,e.forMobile),{conversationName:l.default.getDisplayName(e.conversationMri)||g.getString("Notifications.UnknownUserShort"),useHighContrastTheme:r.default.useHighContrastThemeAndChanges(),allowVideoButton:this._answerWithVideoCommand.canExecute()}}componentDidMount(){super.componentDidMount(),this._registerKeyboardHandlers()}componentWillUnmount(){super.componentWillUnmount(),this._unregisterKeyboardHandlers()}_buttonSize(){return a.isUndefined(this.props.buttonSize)?o.CallButtonSize.Large:this.props.buttonSize}_registerKeyboardHandlers(){h.default.addHandler(c.KeyboardShortcut.AcceptIncomingCall,this._onAnswerCallKeyboardShortcut),h.default.addHandler(c.KeyboardShortcut.HangupOrRejectCall,this._onRejectCallKeyboardShortcut)}_unregisterKeyboardHandlers(){h.default.removeHandler(c.KeyboardShortcut.AcceptIncomingCall,this._onAnswerCallKeyboardShortcut),h.default.removeHandler(c.KeyboardShortcut.HangupOrRejectCall,this._onRejectCallKeyboardShortcut)}_colorConfig(){return this.state.useHighContrastTheme?r.default.highContrastColorConfig(this._themeColors):void 0}render(){const e=this._buttonSize(),t=this._colorConfig(),i=this.props.hasSmallerSpacing?o.CallButtonSpacing.Small:o.CallButtonSpacing.Default;let a,s;if(this.props.showMergeButton){const s=this.props.isMergePossible?g.getString("CallControls.CallButtonMergeLabel",{conversationName:this.state.conversationName}):g.getString("CallControls.CallButtonMergeDisabledLabel");a=n.createElement(o.CallButton,{icon:C.SkypeIcon.CallMerge,isToggledOn:!1,title:s,onPress:this._onMergeCall,isCallMergeButton:!0,size:e,accessibilityLabel:s,colorConfig:t,spacing:i,isDisabled:!this.props.isMergePossible})}if(this.state.allowVideoButton){const a=g.getString("CallControls.CallButtonVideoLabel",{conversationName:this.state.conversationName});s=n.createElement(o.CallButton,{icon:C.SkypeIcon.Video,isToggledOn:!1,title:a,onPress:this._onAnswerCallWithVideo,isCallStartButton:!0,size:e,accessibilityLabel:a,colorConfig:t,spacing:i})}const r=g.getString("CallControls.CallButtonAudioLabel",{conversationName:this.state.conversationName}),l=g.getString("CallControls.CallButtonDeclineLabel"),c=n.createElement(o.CallButton,{ref:this._onAnswerCallButtonRef,icon:C.SkypeIcon.CallStart,isToggledOn:!1,title:r,onPress:this._onAnswerCall,isCallStartButton:!0,size:e,accessibilityLabel:r,colorConfig:t,spacing:i}),d=n.createElement(o.CallButton,{icon:C.SkypeIcon.CallEnd,isToggledOn:!1,title:l,onPress:this._onRejectCall,isCallEndButton:!0,size:e,accessibilityLabel:l,colorConfig:t,spacing:i});return n.createElement(n.View,{style:[m.buttonRow,this.props.style]},n.createElement(n.View,{style:m.buttonRow},a,s,c,d))}}t.default=S},1796:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IncomingRingControlsBase=void 0;const a=i(1),n=i(177),o=i(29),s=i(88),r=i(3),l=i(1261),c=i(4),d=i(12);class u extends d.default{constructor(e,t){super(t),this._instrumentationContext=e,this._mediaActionEvent=e=>{if(o.default.CallingStore.isCallIncoming(this.props.callId)){c.track(new s.MediaActionEvent(this._instrumentationContext,s.MediaActionEventResult.AnswerCall));const t=o.default.CallingStore.incomingCallHasVideo(this.props.callId);c.log(r.LogTraceArea.CallingUI,`${this._instrumentationContext}._mediaActionEvent answering call (video: ${t}); causeId: ${e}`),t&&this._answerWithVideoCommand.canExecute()?this._answerWithVideoCommand.execute():this._answerCommand.execute()}else c.track(new s.MediaActionEvent(this._instrumentationContext,s.MediaActionEventResult.Ignore)),c.log(r.LogTraceArea.CallingUI,`${this._instrumentationContext}._mediaActionEvent no action; causeId: ${e}`)},this._onAnswerCallButtonRef=e=>{this._answerCallButton=e||void 0}}_initializeCommands(e,t){this._forMobile=t,this._rejectCommand=new l.RejectIncomingCallCommand(e.callId,!t),this._answerCommand=new l.AcceptIncomingCallCommand(!1,e.callId,e,t),this._answerWithVideoCommand=new l.AcceptIncomingCallCommand(!0,e.callId,e,t)}componentDidMount(){super.componentDidMount(),this._forMobile&&a.delay(()=>{this.isComponentMounted()&&this._answerCallButton&&this._answerCallButton.requestFocus()},100),this._mediaActionEventSub=n.default.mediaActionEvent.subscribe(this._mediaActionEvent),n.default.maybeEndCallFromAndroidBtScoDisconnectEvent&&(this._maybeEndCallFromAndroidBtScoDisconnectSub=n.default.maybeEndCallFromAndroidBtScoDisconnectEvent.subscribe(()=>{c.track(new s.MaybeEndCallFromAndroidBtScoDisconnectEvent(this._instrumentationContext))}))}componentWillUnmount(){super.componentWillUnmount(),this._mediaActionEventSub&&(this._mediaActionEventSub.unsubscribe(),this._mediaActionEventSub=void 0),this._maybeEndCallFromAndroidBtScoDisconnectSub&&(this._maybeEndCallFromAndroidBtScoDisconnectSub.unsubscribe(),this._maybeEndCallFromAndroidBtScoDisconnectSub=void 0)}}t.IncomingRingControlsBase=u},1797:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(15),o=i(29),s=i(913),r=i(87),l=i(3),c=i(26),d=i(4),u=i(6),h=i(5),p=i(9),g=i(11),C=i(16),m=i(10),S=u.lazyProperties({container:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center"}),icon:()=>a.Styles.createViewStyle({marginRight:10})});class y extends n.ComponentBase{constructor(){super(...arguments),this._onStartAudioOnlyPress=e=>{const t=m.default.newCauseId();d.log(l.LogTraceArea.CallingUI,"CallConnectionQualityBanner starting AudioOnly mode. causeId:"+t),o.default.CallingStore.startAudioOnly(this.props.callId,t)},this._onStopAudioOnlyPress=e=>{const t=m.default.newCauseId();d.log(l.LogTraceArea.CallingUI,"CallConnectionQualityBanner stopping AudioOnlyMode. causeId:"+t),o.default.CallingStore.stopAudioOnly(this.props.callId,t)}}_buildState(e,t){const i={callId:e.callId,conversationMri:e.conversationMri,isPSTNCall:o.default.CallingStore.isPSTNCall(e.callId),isEncryptedCall:o.default.CallingStore.isEncryptedCall(e.callId)},a=o.default.CallingStore.isProvidingVideo(e.callId)||o.default.RemoteStreamHelper.isStreamAvailableForAnyParticipant(e.callId),n=s.default();return{allowAudioOnly:o.default.CallingFeaturesHelper.allowAudioOnly(i)&&a,audioOnlyEnabled:o.default.CallingStore.isAudioOnly(e.callId),callNetworkQualityPoor:n.isCallQualityPoor(e.callId),callNetworkCatastrophic:n.isCallCatastrophic(e.callId)}}_renderHyperlink(){const e=m.default.newCauseId();if(this.state.audioOnlyEnabled){d.log(l.LogTraceArea.CallingUI,"CallConnectionQualityBanner shows stop audio only. causeId: "+e);const t=h.getString("CallConnectionQualityToast.StopAudioOnlyLinkText");return this._renderHyperlinkButton(t,this._onStopAudioOnlyPress)}if(this.state.allowAudioOnly&&this.state.callNetworkCatastrophic){d.log(l.LogTraceArea.CallingUI,"CallConnectionQualityBanner audio only suggestion. causeId: "+e),r.default.updateCallTelemetry(this.props.callId,e,e=>e.suggestAudioOnly());const t=h.getString("CallConnectionQualityToast.StartAudioOnlyLinkText");return this._renderHyperlinkButton(t,this._onStartAudioOnlyPress)}}_renderHyperlinkButton(e,t){return a.createElement(a.Button,{onPress:t},a.createElement(C.BodyText,{style:this.props.linkStyle},e))}_renderIcon(){var e;if(this.state.callNetworkQualityPoor)return a.createElement(c.default,{style:S.icon,icon:g.SkypeIcon.CallQualityIndicator,size:g.IconSize.size24,color:null!==(e=this.props.iconColor)&&void 0!==e?e:p.Color.white})}_getTitleText(){return this.state.callNetworkQualityPoor&&this.state.audioOnlyEnabled?h.getString("CallConnectionQualityToast.PoorConnectionAndAudioOnlyEnabledTitle"):this.state.audioOnlyEnabled?h.getString("CallConnectionQualityToast.AudioOnlyTitle"):h.getString("CallConnectionQualityToast.PoorConnectionTitle")}render(){return a.createElement(a.View,{style:S.container},this._renderIcon(),a.createElement(a.View,{style:this.props.containerStyle},a.createElement(C.BodyText,{bold:!0,style:this.props.textStyle,numberOfLines:1},this._getTitleText()),this._renderHyperlink()))}}t.default=y},1798:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStackNavPrivacyToast=t.RemoteStackNavPrivacyToast=void 0;const a=i(0),n=i(1799),o=i(510),s=i(32),r=i(41),l=i(6),c=i(5),d=i(36),u=i(9),h=i(11),p=i(114),g=i(16),C=l.lazyProperties({container:()=>a.Styles.createViewStyle({flexDirection:"row",paddingLeft:10,paddingRight:10,paddingVertical:10,backgroundColor:u.Color.gray400Overlay70}),contentContainer:()=>a.Styles.createViewStyle({flex:1,marginLeft:10,paddingTop:4}),hiddenContainer:()=>a.Styles.createViewStyle({opacity:0}),titleContainer:()=>a.Styles.createViewStyle({flexDirection:"row",flex:1}),privacyStatementContainer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",paddingTop:5}),privacyStatementTextContainer:()=>a.Styles.createViewStyle({flex:1,marginRight:5}),statusTextStyle:()=>a.Styles.createTextStyle({flex:1,paddingHorizontal:10}),textStyle:()=>a.Styles.createTextStyle({color:u.Color.white}),linkStyle:()=>a.Styles.createTextStyle({color:u.Color.sxBlue})});class m extends n.RemoteBaseCallRecorderToast{constructor(){super(...arguments),this._onLayout=e=>{const t=e.height-(this.props.topInset||0);t!==this.state.desiredHeight&&this.setState({desiredHeight:t,initialLayoutComplete:!0})}}_buildState(e,t){const i=d.default.horizontalPaddingStyle();let a={initiatorDisplayName:e.initiatorMri?s.default.getMemberShortNameForConversation(e.conversationMri,e.initiatorMri):void 0,horizontalPaddingStyle:i};return t&&(a.initialLayoutComplete=!1,a.desiredHeight=0),a}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.desiredHeight!==t.desiredHeight&&this.props.onDesiredHeightChanged(t.desiredHeight)}render(){const e=[{icon:h.SkypeIcon.CallRecordStroke,color:u.Color.white},{icon:h.SkypeIcon.CallRecordDot,color:u.Color.red}],t=[C.container];this.state.horizontalPaddingStyle&&t.push(this.state.horizontalPaddingStyle),this.props.topInset&&t.push(a.Styles.createViewStyle({paddingTop:this.props.topInset},!1)),this.state.initialLayoutComplete||t.push(C.hiddenContainer);let i,n=a.createElement(o.default,{icons:e});const s=[C.titleContainer,a.Styles.createViewStyle({maxWidth:this.props.viewWidth-55},!1)];let r;return this.state.initiatorDisplayName?r=c.getString(this.props.notificationTextPath,{name:this.state.initiatorDisplayName}):this.props.initialNotficationTextPath&&(r=c.getString(this.props.initialNotficationTextPath)),r&&(i=a.createElement(a.View,{style:s},a.createElement(g.Subtitle,{style:C.textStyle},r))),a.createElement(a.View,{style:t,onLayout:this._onLayout},n,a.createElement(a.View,{style:C.contentContainer},i))}}t.RemoteStackNavPrivacyToast=m;class S extends n.LocalBaseCallRecorderToast{constructor(){super(...arguments),this._onLayout=e=>{const t=e.height-(this.props.topInset||0);t!==this.state.desiredHeight&&this.setState({desiredHeight:t,initialLayoutComplete:!0})}}_buildState(e,t){let i={horizontalPaddingStyle:d.default.horizontalPaddingStyle(),recordingTimestamp:e.getTimestamp()};return t&&(i.showPrivacyLink=!0,i.initialLayoutComplete=!1,i.desiredHeight=0),i}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.desiredHeight!==t.desiredHeight&&this.props.onDesiredHeightChanged(t.desiredHeight)}render(){const e=[{icon:h.SkypeIcon.CallRecordStroke,color:u.Color.white},{icon:h.SkypeIcon.CallRecordDot,color:u.Color.red}],t=[C.container];this.state.horizontalPaddingStyle&&t.push(this.state.horizontalPaddingStyle),this.props.topInset&&t.push(a.Styles.createViewStyle({paddingTop:this.props.topInset},!1)),this.state.initialLayoutComplete||t.push(C.hiddenContainer);let i,n=a.createElement(a.View,{onPress:this._onStopPress},a.createElement(o.default,{icons:e})),s=a.createElement(a.View,{style:C.titleContainer},a.createElement(g.Subtitle,{style:C.textStyle},this._getElapsedTime()),a.createElement(a.Button,{onPress:this._onStopPress},a.createElement(g.Subtitle,{style:[C.statusTextStyle,C.linkStyle]},c.getString(this.props.stopLinkTextPath))));if(this.state.showPrivacyLink){const e=[C.privacyStatementTextContainer,a.Styles.createViewStyle({maxWidth:this.props.viewWidth-80},!1)];i=a.createElement(a.View,{style:C.privacyStatementContainer},a.createElement(a.View,{style:e},a.createElement(g.Caption,{style:C.textStyle},c.getString(this.props.privacyStatementTextPath),"",a.createElement(p.default,{url:"#",style:C.linkStyle,allowFontScaling:!1,onPress:this._onMorePrivacyInfoPress},c.getString(this.props.morePrivacyInfoLinkTextPath)))),a.createElement(r.default,{icon:h.SkypeIcon.ClosePanel,size:h.IconSize.size20,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.primaryIconColor,title:c.getString("Global.CloseButtonTitle"),onPress:this._onDismissPrivacyInfoPress}))}return a.createElement(a.View,{style:t,onLayout:this._onLayout},n,a.createElement(a.View,{style:C.contentContainer},s,i))}}t.LocalStackNavPrivacyToast=S},1799:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalBaseCallRecorderToast=t.RemoteBaseCallRecorderToast=void 0;const a=i(0),n=i(7),o=i(70),s=i(3),r=i(4),l=i(5),c=i(12),d=i(31),u=i(10);class h extends c.default{constructor(){super(...arguments),this.recordingStartedAnnounceForAccessibility=()=>{if(this.state.initiatorDisplayName){const e=this.state.initiatorDisplayName||"";a.Accessibility.announceForAccessibility(l.getString(this.props.startedAccessibilityLabelTextPath,{name:e}))}},this.recordingStoppedAnnounceForAccessibility=()=>{if(this.state.initiatorDisplayName){const e=this.state.initiatorDisplayName||"";a.Accessibility.announceForAccessibility(l.getString(this.props.stoppedAccessibilityLabelTextPath,{name:e}))}}}componentDidMount(){super.componentDidMount(),this.state.initiatorDisplayName&&this.recordingStartedAnnounceForAccessibility()}componentWillUnmount(){super.componentWillUnmount(),this.recordingStoppedAnnounceForAccessibility()}}t.RemoteBaseCallRecorderToast=h;class p extends c.default{constructor(){super(...arguments),this._onStopPress=e=>{const t=u.default.newCauseId();r.log(s.LogTraceArea.CallingUI,"BaseCallRecorderToast.onStopPress causeId:"+t),this.props.onStopPress(this.state.callId,t)},this._onMorePrivacyInfoPress=e=>{a.Linking.openUrl(n.default.getConfigSettingsNoSubscription().skypeGoLinks.privacyAndCookies)},this._onDismissPrivacyInfoPress=()=>{r.log(s.LogTraceArea.CallingUI,"BaseCallRecorderToast.onDismissPrivacyInfoPress"),this.setState({showPrivacyLink:!1})},this._getElapsedTime=()=>o.default.getElapsedTimeStringFromMs(this.state.recordingElapsedTimeMs),this._recordingStartedAnnounceForAccessibility=()=>{a.Accessibility.announceForAccessibility(l.getString(this.props.startedAccessibilityLabelTextPath))},this._recordingStoppedAnnounceForAccessibility=()=>{a.Accessibility.announceForAccessibility(l.getString(this.props.stoppedAccessibilityLabelTextPath))}}componentDidMount(){super.componentDidMount(),this.callRecordingTimer=d.default.setInterval(()=>{let e=0;const t=this.state.recordingTimestamp?this.state.recordingTimestamp:void 0;if(t){const i=o.default.getUnixMillisecondsTimestamp(t);e=Date.now()-i,e<0&&(e=0)}this.isComponentMounted()&&this.setState({recordingElapsedTimeMs:e})},1e3),this._recordingStartedAnnounceForAccessibility()}componentWillUnmount(){super.componentWillUnmount(),this.privacyInfoDisplayTimer&&(d.default.clearTimeout(this.privacyInfoDisplayTimer),this.privacyInfoDisplayTimer=void 0),this.callRecordingTimer&&(d.default.clearTimeout(this.callRecordingTimer),this.callRecordingTimer=void 0),this._recordingStoppedAnnounceForAccessibility()}}t.LocalBaseCallRecorderToast=p},1800:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(60),o=i(13),s=i(41),r=i(6),l=i(5),c=i(23),d=i(179),u=i(9),h=i(11),p=i(114),g=i(28),C=i(16),m=i(12),S=h.IconSize.size20,y=o.CompositeNotificationToastInfo.horizontal,f=r.lazyProperties({container:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingHorizontal:y,paddingVertical:o.CompositeNotificationToastInfo.vertical}),containerStack:()=>a.Styles.createViewStyle({backgroundColor:u.Color.gray400Overlay70,paddingVertical:y}),containerComposite:()=>a.Styles.createViewStyle({backgroundColor:u.Color.transparent,paddingRight:20}),textContainerComposite:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",flexWrap:"wrap",paddingHorizontal:10,alignItems:"center"}),textStack:()=>a.Styles.createTextStyle({lineHeight:20}),textComposite:()=>a.Styles.createTextStyle({flex:-1,lineHeight:24,alignSelf:"center",wordBreak:"break-word"}),buttonTextComposite:()=>a.Styles.createTextStyle({marginLeft:4}),blueText:()=>a.Styles.createTextStyle({color:u.Color.sxBlue})});class _ extends m.default{constructor(){super(...arguments),this._onLearnMorePress=()=>{d.default.showDeniedPromptWithSettingsOption(g.PermissionType.Camera,this._getRootViewId())},this._onClosePress=()=>{this.props.closeToast(n.ToastActionType.ManualDismissed)},this._onLayout=e=>{e.width!==this.state.containerWidth&&this.setState({containerWidth:e.width})}}_buildState(e,t){const i={isUsingStackNavigationContext:c.default.isUsingStackNavigationContext()};return t&&(i.containerWidth=0),i}render(){let e,t;const i=[this._themeStyles.primaryTextColorStyle],n=[this._useAccessibleTheme()?this._themeStyles.primaryTextColorStyle:f.blueText];return this.state.isUsingStackNavigationContext?(e=a.Styles.createViewStyle({maxWidth:this.state.containerWidth-S-y-4},!1),t=f.containerStack,i.push(f.textStack),n.push(f.textStack)):(e=f.textContainerComposite,t=f.containerComposite,i.push(f.textComposite),n.push(f.textComposite,f.buttonTextComposite)),a.createElement(a.View,{style:[f.container,t],onLayout:this._onLayout},a.createElement(a.View,{style:e},a.createElement(C.BodyText,{style:i,bold:!1},l.getString("AudioVideoSettings.CameraDeniedBannerSuggestion")),a.createElement(p.default,{url:"#",style:n,onPress:this._onLearnMorePress},l.getString("AudioVideoSettings.LearnMore"))),a.createElement(s.default,{icon:h.SkypeIcon.ClosePanel,size:S,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.primaryIconColor,title:l.getString("Global.CloseButtonTitle"),onPress:this._onClosePress}))}}t.default=_},1801:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(7),o=i(193),s=i(32),r=i(3),l=i(26),c=i(6),d=i(89),u=i(5),h=i(9),p=i(24),g=i(11),C=i(114),m=i(16),S=i(12),y=c.lazyProperties({contentContainer:()=>a.Styles.createButtonStyle({flex:1,flexDirection:"row",alignItems:"center",marginVertical:10}),textContentContainer:()=>a.Styles.createViewStyle({flex:1,alignSelf:"center"}),textContent:()=>a.Styles.createTextStyle({paddingLeft:10,paddingRight:15,flexWrap:"wrap",flex:1}),textContentMobile:()=>a.Styles.createTextStyle({fontSize:p.default.controlFontSize.caption}),container:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"flex-start"}),dismissButtonDesktop:()=>a.Styles.createViewStyle({margin:12}),dismissButtonMobile:()=>a.Styles.createViewStyle({marginTop:10}),translationIconDesktop:()=>a.Styles.createViewStyle({marginLeft:10})});class f extends S.default{constructor(){super(...arguments),this._onPressTogetherModeNoticeLearnMore=()=>{d.openUrlWithParams({origin:r.BrowserOrigin.CallPanel,url:n.default.getConfigSettingsNoSubscription().togetherModeNotice.learnMoreUrl,rootViewId:this._getRootViewId()})},this._onDismiss=()=>{this.props.onDismiss&&this.props.onDismiss()}}_buildState(e,t){return{conversationName:s.default.getDisplayName(e.conversationMri)||""}}render(){return a.createElement(a.View,{style:[this.props.containerStyle,y.container]},a.createElement(a.View,{style:y.contentContainer},this._renderTeamsIcon(),this._renderTextContent()),this._renderDismissButton())}_renderTeamsIcon(){var e,t;const i=this._getIconForType();if(i)return a.createElement(l.default,{key:"teamsIcon",style:y.translationIconDesktop,icon:i,color:null!==(e=this.props.iconColor)&&void 0!==e?e:h.Color.white,size:null!==(t=this.props.iconSize)&&void 0!==t?t:g.IconSize.size16})}_getIconForType(){switch(this.props.toastType){case o.ToastType.TogetherModeNotice:return g.SkypeIcon.Audience;case o.ToastType.TeamsInterop:return g.SkypeIcon.MSTeams}}_renderTextContent(){switch(this.props.toastType){case o.ToastType.TogetherModeNotice:return this._renderTogetherModeNoticeTextContent();case o.ToastType.TeamsInterop:return this._renderTeamsInteropContent();case o.ToastType.NewCallScreenRevertNotice:return this._renderNewCallScreenRevertNoticeContent()}}_renderTeamsInteropContent(){return a.createElement(a.View,{key:"textContentContainer",style:y.textContentContainer},a.createElement(m.BodyText,{style:this._getTextStyles()},u.getString("TeamsInteropBanner.TeamsInteropInCallBannerText",{userName:this.state.conversationName})))}_renderTogetherModeNoticeTextContent(){const e=this._getTogetherModeLearnMoreLink();return a.createElement(a.View,{key:"textContentContainer",style:y.textContentContainer},a.createElement(m.BodyText,{style:this._getTextStyles()},u.getParts("TogetherModeNoticeBanner.TogetherModeNoticeInCallBannerText",{learnMoreLink:e})))}_renderNewCallScreenRevertNoticeContent(){return a.createElement(a.View,{key:"textContentContainer",style:y.textContentContainer},a.createElement(m.BodyText,{style:this._getTextStyles()},u.getString("NewCallScreenRevertNoticeBanner.NewCallScreenRevertNoticeInCallBannerText")))}_getTogetherModeLearnMoreLink(){return a.createElement(C.default,{url:n.default.getConfigSettingsNoSubscription().togetherModeNotice.learnMoreUrl,onPress:this._onPressTogetherModeNoticeLearnMore,blue:!0,key:"togetherModeNoticeLearnMoreLink "},u.getString("Global.LearnMore"))}_renderDismissButton(){var e,t;return a.createElement(l.default,{key:"dismissButton",style:y.dismissButtonDesktop,color:null!==(e=this.props.iconColor)&&void 0!==e?e:h.Color.white,onPress:this._onDismiss,size:null!==(t=this.props.iconSize)&&void 0!==t?t:g.IconSize.size24,icon:g.SkypeIcon.Cancel})}_getTextStyles(){return[this.props.textStyle,y.textContent]}}t.default=f},1802:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(15),o=i(29),s=i(3),r=i(4),l=i(5),c=i(16),d=i(10);class u extends n.ComponentBase{constructor(){super(...arguments),this._onStopPress=e=>{const t=d.default.newCauseId();r.log(s.LogTraceArea.CallingUI,"StackNavAudioOnlyToast disable audio only clicked. causeId:"+t),o.default.CallingStore.enableIncomingVideo(this.props.callId,t)}}componentDidMount(){super.componentDidMount(),a.Accessibility.announceForAccessibility(l.getString("CallControlsOverFlowMenu.AllowIncomingVideoStartStateAnnouncement"))}componentWillUnmount(){super.componentWillUnmount(),a.Accessibility.announceForAccessibility(l.getString("CallControlsOverFlowMenu.AllowIncomingVideoStopStateAnnouncement"))}render(){return a.createElement(a.View,{style:this.props.containerStyle},a.createElement(c.BodyText,{bold:!0,style:this.props.textStyle,numberOfLines:1},l.getString("IncomingVideoDisabledToast.BannerTitle")),a.createElement(a.Button,{onPress:this._onStopPress},a.createElement(c.BodyText,{style:this.props.linkStyle},l.getString("IncomingVideoDisabledToast.ResumeLinkText"))))}}t.default=u},1803:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(15),o=i(7),s=i(29),r=i(41),l=i(26),c=i(408),d=i(6),u=i(5),h=i(64),p=i(1262),g=i(9),C=i(11),m=i(114),S=i(14),y=i(16),f=i(10),_=d.lazyProperties({rightPadding:()=>a.Styles.createViewStyle({paddingRight:5}),marginLeft:()=>a.Styles.createViewStyle({marginLeft:10}),containerStyle:()=>a.Styles.createButtonStyle({alignItems:"flex-start"}),innerContainerStyle:()=>a.Styles.createViewStyle({flexDirection:"column",justifyContent:"center",alignItems:"flex-start"}),closeButtonStyle:()=>a.Styles.createButtonStyle({flexGrow:0,flexShrink:1,paddingLeft:10,overflow:"visible",alignItems:"flex-end",alignSelf:"center",justifyContent:"flex-start"}),emptyContainer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignSelf:"center",justifyContent:"flex-end"}),controlsContainer:()=>a.Styles.createButtonStyle({flexGrow:1,flexShrink:1,flexDirection:"row",justifyContent:"flex-start",alignItems:"center",flexWrap:"wrap"}),innerDesktopContainerStyle:()=>a.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-start",alignItems:"center",flexWrap:"wrap"}),innerControlStyle:()=>a.Styles.createViewStyle({minHeight:0,marginTop:10,marginBottom:4,marginRight:15}),innerControlDesktopStyle:()=>a.Styles.createViewStyle({marginRight:15,marginTop:4,marginBottom:4}),ccIconStyle:()=>a.Styles.createViewStyle({alignSelf:"center"}),linkStyle:()=>a.Styles.createTextStyle({color:g.Color.sxBlue,fontWeight:"bold"}),langPickerStyle:()=>a.Styles.createViewStyle({minHeight:30}),listPickerStyle:()=>a.Styles.createViewStyle({minHeight:0,marginTop:10,marginBottom:8})});class b extends n.ComponentBase{constructor(){super(...arguments),this._subtitlesStartedMessage=()=>u.getString("CallSubtitleToast.CallStartedInLanguage",{selectedLanguage:this.state.selectedLanguageName}),this._renderSubtitlesStartedInLanguageMessage=()=>{var e;return a.createElement(a.View,{style:[this.props.containerStyle,_.containerStyle]},a.createElement(l.IconView,{color:null!==(e=this.props.iconColor)&&void 0!==e?e:g.Color.white,onPress:this.props.onDismiss,size:C.IconSize.size20,icon:C.SkypeIcon.ClosedCaptionFilled}),a.createElement(a.View,{style:[S.default.flexOne,_.marginLeft,_.innerContainerStyle]},a.createElement(y.BodyText,{style:this.props.textStyle},this._subtitlesStartedMessage()),a.createElement(a.View,{style:_.controlsContainer},a.createElement(p.default,{style:[_.innerControlDesktopStyle,_.langPickerStyle],rowTitle:!1,caption:!1,showSelectOption:!0,selectOptionText:u.getString("CallSubtitleToast.ChangeSpokenLanguageDefaultText"),onHandleMenuCommand:this._onHandleMenuCommand,labelColor:g.Color.sxBlue}),a.createElement(y.BodyText,{allowFontScaling:!1,bold:!0,size:y.BodyTextSize.SmallDeprecated,style:[_.innerControlDesktopStyle]},a.createElement(m.default,{url:"#",style:_.linkStyle,allowFontScaling:!1,onPress:this._onStopPress},u.getString("CallSubtitleToast.StopSubtitles"))))),this._getDismissIconView())},this._renderMultipleSpokenLanguageWarningText=()=>{var e;return a.createElement(a.View,{style:[this.props.containerStyle,_.containerStyle]},a.createElement(l.IconView,{color:null!==(e=this.props.iconColor)&&void 0!==e?e:g.Color.white,onPress:this.props.onDismiss,size:C.IconSize.size20,icon:C.SkypeIcon.ClosedCaptionFilled,style:_.ccIconStyle}),a.createElement(a.View,{style:[S.default.flexOne,_.marginLeft,_.innerDesktopContainerStyle]},a.createElement(y.BodyText,{style:this.props.textStyle},u.getString("CallSubtitleToast.MultipleSpokenLanguageWarningText")),a.createElement(p.default,{style:_.rightPadding,rowTitle:!1,caption:!1,showSelectOption:!0,onHandleMenuCommand:this._onHandleMenuCommand,labelColor:g.Color.blue})),this._getDismissIconView())},this._onHandleMenuCommand=e=>{this.props.onDismiss&&this.props.onDismiss(),s.default.InCallBotService.setSpokenLanguageLocale(this.props.callId,e)},this._onStopPress=()=>{this.props.onDismiss&&this.props.onDismiss();const e=f.default.newCauseId();s.default.InCallBotService.stopTranslator(this.props.callId,e)}}_buildState(e,t){var i;const a=null!==(i=h.default.getCallTranslatorBotSpokenLanguageLocale())&&void 0!==i?i:"",n=c.getShortLanguageTitle(a);return{isStartCaptionsInfoPanelEnabled:o.default.getS4LCMCFeatures().isStartCaptionsInfoPanelEnabled,selectedLanguageName:n}}componentDidMount(){super.componentDidMount();let e=this.state.isStartCaptionsInfoPanelEnabled?this._subtitlesStartedMessage():u.getString("CallSubtitleToast.MultipleSpokenLanguageWarningText");a.Accessibility.announceForAccessibility(e)}render(){return this.state.isStartCaptionsInfoPanelEnabled?this._renderSubtitlesStartedInLanguageMessage():this._renderMultipleSpokenLanguageWarningText()}_getDismissIconView(){var e,t;if(!this.props.onDismiss)return;return a.createElement(r.default,{key:"cancelIcon",size:C.IconSize.size20,color:null!==(e=this.props.iconColor)&&void 0!==e?e:g.Color.white,hoverColor:null!==(t=this.props.iconColor)&&void 0!==t?t:g.Color.whiteOverlay70,icon:C.SkypeIcon.Cancel,style:_.closeButtonStyle,title:u.getString("Global.CloseButtonTitle"),onPress:this.props.onDismiss})}}t.default=b},1804:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(15),o=i(7),s=i(26),r=i(6),l=i(5),c=i(64),d=i(9),u=i(24),h=i(11),p=i(114),g=i(16),C=r.lazyProperties({contentContainer:()=>a.Styles.createButtonStyle({flex:1,flexDirection:"row",alignItems:"center",marginVertical:10}),textContentContainer:()=>a.Styles.createViewStyle({flex:1,alignSelf:"center"}),textContent:()=>a.Styles.createTextStyle({paddingLeft:10,paddingRight:15,flexWrap:"wrap",flex:1}),textContentMobile:()=>a.Styles.createTextStyle({fontSize:u.default.controlFontSize.caption}),container:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"flex-start"}),dismissButtonDesktop:()=>a.Styles.createViewStyle({margin:10}),dismissButtonMobile:()=>a.Styles.createViewStyle({marginTop:10}),translationIconDesktop:()=>a.Styles.createViewStyle({marginLeft:15})});class m extends n.ComponentBase{constructor(){super(...arguments),this._onDismiss=()=>{this.props.onDismiss&&this.props.onDismiss(),c.default.setInCallTranslationBannerDismissState(this.props.conversationMri,!0)},this._onLearnMoreLinkPress=e=>{a.Linking.openUrl(o.default.getConfigSettingsNoSubscription().translator.learnMoreUrl)}}render(){return a.createElement(a.View,{style:[this.props.containerStyle,C.container]},a.createElement(a.View,{style:C.contentContainer},this._renderTranslationIcon(),this._renderTextContent()),this._renderDismissButton())}_renderTranslationIcon(){var e,t;return a.createElement(s.default,{key:"translationIcon",style:C.translationIconDesktop,icon:h.SkypeIcon.SkypeTranslator,color:null!==(e=this.props.iconColor)&&void 0!==e?e:d.Color.white,size:null!==(t=this.props.iconSize)&&void 0!==t?t:h.IconSize.size16})}_renderTextContent(){const e=l.getParts("TranslationBanner.TranslatedConversationInCallText",{learnMore:this._getLearnMoreLink()});return a.createElement(a.View,{key:"textContentContainer",style:C.textContentContainer},a.createElement(g.BodyText,{style:this._getTextStyles()},e))}_renderDismissButton(){var e,t;return a.createElement(s.default,{key:"dismissButton",style:C.dismissButtonDesktop,color:null!==(e=this.props.iconColor)&&void 0!==e?e:d.Color.white,onPress:this._onDismiss,size:null!==(t=this.props.iconSize)&&void 0!==t?t:h.IconSize.size24,icon:h.SkypeIcon.Cancel})}_getLearnMoreLink(){return a.createElement(p.default,{key:"learnMoreLink",style:this.props.linkStyle,url:"#",blue:!0,onPress:this._onLearnMoreLinkPress},l.getString("TranslationBanner.TranslatedConversationInCallLearnMoreLink"))}_getTextStyles(){return[this.props.textStyle,C.textContent]}}t.default=m},1805:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(50),o=i(29),s=i(3725),r=i(328),l=i(87),c=i(17),d=i(3),u=i(4),h=i(6),p=i(5),g=i(18),C=i(39),m=i(44),S=i(11),y=i(14),f=i(369),_=i(10),b=h.lazyProperties({container:()=>a.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),headerContainer:()=>a.Styles.createViewStyle({alignSelf:"stretch",alignItems:"stretch"})});class v extends n.default{constructor(){super(...arguments),this._closeRoster=()=>{const e=_.default.newCauseId();u.log(d.LogTraceArea.CallingUI,"[CallRosterView] _closeRoster, causeId: "+e),this._goBack(e),f.default.getActiveSession()&&(f.default.completeSession(),u.log(d.LogTraceArea.CallingUI,"[CallRosterView] _closeRoster Call Roster completeSession, causeId: "+e),l.default.updateCallTelemetry(this.props.callId,e,e=>e.callRosterClosedCount()))},this._addParticipantsToCall=()=>{const e=_.default.newCauseId();u.log(d.LogTraceArea.CallingUI,"[CallRosterView] _addParticipantsToCall, causeId: "+e),g.default.openAddToCall(this.props.conversationId,this.props.callId,d.NavigationAddToCallOrigin.RosterView,this._getContext(),e),f.default.updateCallRosterTelemetry(this.props.callId,e,e=>e.callRosterAddToCall())}}static getHeaderText(){return p.getString("CallPanel.CallRosterAccessibilityLabel")}_buildState(e,t){const i=r.default.getRosterForConversation(e.conversationId);if(i&&0===i.length){const t=_.default.newCauseId();u.warn(d.LogTraceArea.CallingUI,"CallRosterView._buildState: allParticipants is empty list conversationId="+C.mriOrId(e.conversationId)+" causeId="+t),l.default.updateCallTelemetry(e.callId,t,e=>e.callRosterGetAllParticipantsFailedCount())}const a=r.default.getActiveParticipants(e.callId,e.conversationId),n=o.default.CallingStore.isPSTNCall(e.callId),s=c.isEncryptedThread(e.conversationId);return{allParticipantCount:i.length,activeParticipantCount:a.length,conversationName:r.default.getConversationName(e.conversationId),allowAddToCall:o.default.CallingFeaturesHelper.allowAddToCall({conversationMri:e.conversationId,isPSTNCall:n,isEncryptedCall:s,callId:e.callId})}}_getCallRosterHeader(){const e={closeButtonType:m.CloseButtonType.Close,onPress:this._closeRoster,title:p.getString("Global.CloseButtonTitle")},t=this.state.allowAddToCall?{onPress:this._addParticipantsToCall,accessibilityLabel:p.getString("CallPanel.AddToCallTooltipTitle"),icon:S.SkypeIcon.ContactAdd}:void 0,i=a.createElement(a.View,{style:y.default.flexOne});let n=p.getString("CallPanel.CallRosterTitle",{count:this.state.activeParticipantCount,total:this.state.allParticipantCount});return a.createElement(a.View,{style:b.headerContainer},a.createElement(m.SimplePanelHeader,{panelName:n,useTransparentBackground:!0,leftButton:e,rightButtons:t,titleView:i}))}render(){return a.createElement(a.View,{style:[b.container,this._themeStyles.primaryBackgroundColorStyle]},this._getCallRosterHeader(),a.createElement(s.default,{callId:this.props.callId,conversationMri:this.props.conversationId}))}_getHeaderText(e){return v.getHeaderText()}}t.default=v},1818:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(35),o=i(0),s=i(50),r=i(357),l=i(290),c=i(745),d=i(359),u=i(79),h=i(3),p=i(4),g=i(6),C=i(5),m=i(18),S=i(23),y=i(239),f=i(205),_=i(27),b=i(36),v=i(44),w=i(201),T=i(107),I=i(10),P=g.lazyProperties({panel:()=>o.Styles.createViewStyle({alignSelf:"stretch",flex:1}),headerContainer:()=>o.Styles.createViewStyle({alignItems:"stretch",flexDirection:"column"})});class M extends s.default{constructor(){super(...arguments),this._searchActive=!1,this._onSearchActive=e=>{this._showOrHideHeader(this.state,!e,!0),e||this.setState({query:""}),this._updateStatusBarStyle(e?T.default.createBarStyle(w.BarStyleTheme.Light,!0):T.default.createBarStyle(this._themeColors.defaultStatusBarTheme,!0))},this._onPressClose=e=>{this._close()},this._onCountrySelected=e=>{this.props.onCountrySelected?this.props.onCountrySelected(e):f.default.setSelectedCountry(this.state.countries[e],!0),this._close()},this._onSearch=e=>{this.isComponentMounted()&&(this.setState({query:e}),this._countryListRef&&this._countryListRef.onFilterChange(e))},this._onCountryListRef=e=>{this._countryListRef=e||void 0}}static getHeaderText(){return C.getString("PSTNCountrySelectorPanel.Title")}_buildState(e,t){const i=this._getRootViewId();let s=y.default.getCountries();if(e.countriesFiltered){s=a.pickBy(s,(function(t,i){return a.includes(e.countriesFiltered,t.country)}))}const r={countries:s,statusBarPadding:b.default.statusBarPadding(),isPortrait:_.default.getDeviceOrientation(i)===n.DeviceOrientation.Portrait,isUsingStackNavigationContext:S.default.isUsingStackNavigationContext(),isSmallDevice:_.default.isSmallDevice(i)};return t&&(r.query="",this._headerAnimatedHeightValue=new o.Animated.Value(l.default.expandedHeight(i)),this._headerAnimatedHeightStyle=o.Styles.createAnimatedViewStyle({height:this._headerAnimatedHeightValue}),this._headerAnimatedTopValue=new o.Animated.Value(0),this._headerAnimatedTopStyle=o.Styles.createAnimatedViewStyle({transform:[{translateY:this._headerAnimatedTopValue}]})),r}render(){return o.createElement(o.View,{style:[P.panel,this._themeStyles.primaryBackgroundColorStyle]},this._renderHeaderContainer(),o.createElement(c.default,{ref:this._onCountryListRef,countries:this.state.countries,recentCountries:this.props.hideRecentCountries?void 0:f.default.getLast5CalledCountriesNoSubscription(),onSelect:this._onCountrySelected}))}componentDidMount(){super.componentDidMount();const e=T.default.mergeStyles([T.default.createBarStyle(this._themeColors.defaultStatusBarTheme),T.default.createHiddenStyle(!1)]);this._updateStatusBarStyle(e),this._showOrHideHeader(this.state,!this._searchActive,!1)}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.statusBarPadding===t.statusBarPadding&&this.state.isPortrait===t.isPortrait||this._showOrHideHeader(t,!this._searchActive,!1)}_renderHeaderContainer(){let e;e=this.state.isUsingStackNavigationContext?o.createElement(r.default,{key:"searchInputButton",initialValue:1,showButtonWhenInactive:!0,placeholderText:C.getString("PSTNCountrySelector.SearchPlaceholder"),rawSearchQuery:this.state.query,onInputTextChange:this._onSearch,onActive:this._onSearchActive}):o.createElement(d.default,{key:"searchInputButton",placeholderText:C.getString("PSTNCountrySelector.SearchPlaceholder"),activePlaceholderText:C.getString("PSTNCountrySelector.SearchPlaceholder"),showButtonWhenInactive:!0,autoFocus:this.props.searchAutoFocus,autoFocusWhenActive:!0,rawSearchQuery:this.state.query,onInputTextChange:this._onSearch,onActive:this._onSearchActive});const t={closeButtonType:this.props.isAloneInNavStack||this._getContext().isPresentedByMobileStackNavigator?v.CloseButtonType.Close:v.CloseButtonType.Back,title:C.getString("Global.CloseButtonTitle"),onPress:this._onPressClose},i=o.createElement(v.SimplePanelHeader,{panelName:this._getHeaderText(this.state),leftButton:t,hideBottomBorder:this.state.isUsingStackNavigationContext});let a;return a=this.state.isUsingStackNavigationContext?o.createElement(o.Animated.View,{style:[P.headerContainer,this._headerAnimatedHeightStyle]},o.createElement(o.Animated.View,{style:this._headerAnimatedTopStyle},i,e)):o.createElement(o.View,null,i,e),a}_showOrHideHeader(e,t,i=!0){this._searchActive=!t;const a=this._getRootViewId(),n=this._headerHeight(e),s=t?0:-1*n,r=t?n+l.default.collapsableHeight(a):l.default.expandedHeight(a)+e.statusBarPadding;i?o.Animated.parallel([o.Animated.timing(this._headerAnimatedTopValue,{toValue:s,duration:200,easing:o.Animated.Easing.Out()}),o.Animated.timing(this._headerAnimatedHeightValue,{toValue:r,duration:200,easing:o.Animated.Easing.Out()})]).start():(this._headerAnimatedTopValue.setValue(s),this._headerAnimatedHeightValue.setValue(r))}_headerHeight(e){return(e.isPortrait?e.isSmallDevice?v.HeaderHeightSmall:v.HeaderHeight:e.isSmallDevice?v.HeaderHeightLandscapeSmall:v.HeaderHeightLandscape)+e.statusBarPadding}_close(){const e=I.default.newCauseId();p.log(h.LogTraceArea.Navigation,"CountrySelector._close,  causeId: "+e),u.dismissAll(),m.default.goBack(e,this._getContext())}_getHeaderText(e){return M.getHeaderText()}}t.default=M},1825:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(8),n=i(7),o=i(103),s=i(81),r=i(47),l=i(671),c=i(33),d=i(139),u=i(3),h=i(4),p=i(64),g=i(84),C=i(39),m=i(19);t.default=new class{_getTranslationToLocale(e){const t=c.default().getConversation(e);return t?t.getMessageTranslationLocale():void 0}disableTranslation(e,t){this._changeTranslationState(e,o.TranslationState.Disabled,o.TranslationState.Disabled,t),p.default.deleteTranslationBannerDismissStates(e),h.track(new l.ConversationTranslationAction(e,u.TranslationAction.Disabled,t,this._getTranslationToLocale(e)))}cancelTranslationRequest(e,t){this._changeTranslationState(e,o.TranslationState.Disabled,o.TranslationState.Cancelled,t),p.default.deleteTranslationBannerDismissStates(e),h.track(new l.ConversationTranslationAction(e,u.TranslationAction.Cancelled,t,this._getTranslationToLocale(e)))}declineTranslationRequest(e,t){this._changeTranslationState(e,o.TranslationState.Disabled,o.TranslationState.Declined,t),p.default.deleteTranslationBannerDismissStates(e),h.track(new l.ConversationTranslationAction(e,u.TranslationAction.Declined,t,this._getTranslationToLocale(e)))}requestTranslation(e,t){this._changeTranslationState(e,o.TranslationState.Requested,o.TranslationState.Pending,t),p.default.setInCallTranslationBannerDismissState(e,!1),p.default.setConversationTranslationBannerDismissState(e,!1),h.track(new l.ConversationTranslationAction(e,u.TranslationAction.Requested,t,this._getTranslationToLocale(e)))}acceptTranslation(e,t){this._changeTranslationState(e,o.TranslationState.Enabled,o.TranslationState.Enabled,t),h.track(new l.ConversationTranslationAction(e,u.TranslationAction.Accepted,t,this._getTranslationToLocale(e)))}_changeTranslationState(e,t,i,l){const c=n.default.getS4LCMCFeatures().enableOldMessageTranslation;h.log(u.LogTraceArea.Calling,"TranslationHelper._changeTranslationState conversationId: "+C.mriOrId(e)+" localTranslationState "+o.TranslationState[t]+" remoteTranslationState "+o.TranslationState[i]);const p=d.createTranslationSettingsMessage(e,u.PostSource.MessagePanel,l,i,!1);let S;c&&(S=d.createTranslationSettingsMessage(e,u.PostSource.MessagePanel,l,i,!1,r.MessageTypes.Data)),p?s.default.setTranslationState(e,t).then(()=>c&&S?g.default.postMessage(S):a.Resolved()).then(()=>g.default.postMessage(p)).catch(e=>{h.error(u.LogTraceArea.Calling,"TranslationHelper._changeTranslationState failed: "+m.default.errorAsString(e))}):h.error(u.LogTraceArea.Calling,"TranslationHelper._changeTranslationState failed to create translation settings message")}}},1828:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});i(1),i(35);const a=i(116),n=i(0),o=i(7),s=i(3751),r=i(50),l=i(3752),c=i(530),d=i(3753),u=i(252),h=i(13),p=i(534),g=i(1794),C=i(3754),m=i(3755),S=i(3759),y=i(79),f=i(3),_=i(472),b=i(3760),v=i(4),w=i(6),T=i(5),I=i(52),P=i(18),M=i(23),k=i(3761),A=(i(3762),i(27)),R=i(36),V=i(59),E=i(3763),L=i(48),B=i(3764),O=i(3765),D=i(1270),x=i(1237),N=i(322),U=i(107),F=i(9),H=i(14),z=i(10),G=w.lazyProperties({dialerWrapper:()=>n.Styles.createViewStyle({backgroundColor:F.Color.darkThemeSecondaryBackground,flexDirection:"column",flexGrow:1,flexShrink:0,overflow:"visible"}),regularLightThemeBackground:()=>n.Styles.createViewStyle({backgroundColor:F.Color.transparent,bottom:0,left:0,position:"absolute",right:0,top:0}),accessibleLightThemeBackground:()=>n.Styles.createViewStyle({backgroundColor:F.Color.gray50,bottom:0,left:0,position:"absolute",right:0,top:0}),darkThemeBackground:()=>n.Styles.createViewStyle({backgroundColor:F.Color.gray400,bottom:0,left:0,position:"absolute",right:0,top:0}),firstGroupLandscape:()=>n.Styles.createViewStyle({flex:1,flexBasis:0}),secondGroup:()=>n.Styles.createViewStyle({bottom:0,left:0,position:"absolute",right:0}),secondGroupLandscape:()=>n.Styles.createViewStyle({flex:1,flexBasis:0,borderLeftWidth:1}),groups:()=>n.Styles.createViewStyle({alignSelf:"stretch",flex:1}),groupsLandscape:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row"}),itemDivider:()=>n.Styles.createViewStyle({backgroundColor:F.Color.gray400,height:1})});class W extends r.default{constructor(){super(...arguments),this._onScrollFastContactsSearch=()=>{const e=this._fastContactsSearch&&this._fastContactsSearch.state.isSingleSelection;!this._dialpadAnimation||this.state.isInLandscape||e||this._dialpadAnimation.toggleDialpadToCollapsedState(!0)},this._onItemPressedFastContactsSearch=()=>{this._dialpadAnimation&&!this.state.isInLandscape&&this._dialpadAnimation.toggleDialpadToCollapsedState(!1)},this._onRenderFastContactsSearch=()=>{const e=this._getSearchResultCount();if(L.default.shouldAnnounceForAccessibility()&&this._lastAnnouncedSearchCount!==e){this._lastAnnouncedSearchCount=e;const t=T.getString("SearchResultsList.SearchResultsAnnouncement",{count:e});n.Accessibility.announceForAccessibility(t)}!this._dialpadAnimation||this.state.isInLandscape||this._dialpadAnimation.isCollapsed()||this._balancePanelAnimation&&this._fastContactsSearch&&this._balancePanelAnimation.toggleBalancePanelVisibility(this._fastContactsSearch.state.isSingleSelection||e>=1)},this._renderDialpadView=()=>{const e=[G.dialerWrapper];this.state.bottomSafeAreaInset&&e.push(V.default.paddingBottomStyle(this.state.bottomSafeAreaInset)),this._useDarkTheme()||e.push(this._themeStyles.primaryBackgroundColorStyle);const t=[G.itemDivider];this._useDarkTheme()||t.push(this._themeStyles.dividerColorStyle);const i=this.state.isInLandscape?void 0:n.createElement(n.View,{style:t});return n.createElement(n.View,{style:e},this.state.isInLandscape?void 0:this._renderCallerIdCTA(),i,n.createElement(s.default,{ref:this._onBalancePanelAnimationRef,isInLandscape:this.state.isInLandscape,onCannotToggle:this._onCannotToggleBalancePanelAnimation},n.createElement(x.default,{isLandscape:this.state.isInLandscape,location:_.ExperimentLocation.DialerPanel})),n.createElement(C.default,{ref:this._onDialpadAnimationRef,isInLandscape:this.state.isInLandscape,onToggleStart:this._onToggleStartDialpadAnimation,onToggleCompletion:this._onToggleCompletionDialpadAnimation,onHeightsChanged:this._onHeightsChangedDialpadAnimation},n.createElement(g.default,{ref:this._onDialpadRef,isInLandscape:this.state.isInLandscape,isDtmfDialpad:!1,enableExtensionDialing:this.state.extensionDialingEnabled}),n.createElement(m.default,{callId:this.props.callId,conversationId:this.props.conversationId})))},this._onPress=()=>{this._dialpadAnimation&&this._dialpadAnimation.toggleDialpadToCollapsedState(!1)},this._onContactSaved=()=>{this._dialpadAnimation&&!this.state.isInLandscape&&!this._dialpadAnimation.isCollapsed()&&this._balancePanelAnimation&&this._balancePanelAnimation.toggleBalancePanelVisibility(!1)},this._onCallerIdDialpadCtaPress=()=>{const e=z.default.newCauseId();v.log(f.LogTraceArea.Navigation,"DialerPanel._onCallerIdDialpadCtaPress,  causeId: "+e);u.default.registerCallerIdDialerCTAClick(),P.default.navigateToCallerIDSettingsEntry("CallerIdPrompt.dialpad",!1,this._getContext(),e)},this._onFastContactsSearchRef=e=>{this._fastContactsSearch=e||void 0},this._onSearchSpacerAnimationRef=e=>{this._searchSpacerAnimation=e||void 0},this._onBalancePanelAnimationRef=e=>{this._balancePanelAnimation=e||void 0},this._onCannotToggleBalancePanelAnimation=e=>!e&&!!this._dialpadAnimation&&this._dialpadAnimation.isCollapsed(),this._onDialpadAnimationRef=e=>{this._dialpadAnimation=e||void 0},this._onDialpadRef=e=>{this._dialpad=e||void 0},this._onDialpadHeaderRef=e=>{this._dialpadHeader=e||void 0},this._onToggleStartDialpadAnimation=e=>{this._searchSpacerAnimation&&this._searchSpacerAnimation.toggleToHiddenState(),e&&this._balancePanelAnimation&&this._balancePanelAnimation.toggleBalancePanelVisibility(!0)},this._onToggleCompletionDialpadAnimation=e=>{e?this._searchSpacerAnimation&&this._searchSpacerAnimation.toggleToCollapsedState():(this._balancePanelAnimation&&this._balancePanelAnimation.toggleBalancePanelVisibility(this._getSearchResultCount()>=1),this._searchSpacerAnimation&&this._searchSpacerAnimation.toggleToExpandedState(),this._dialpad&&this._dialpad.focusFirst()),p.default.toggleDialpadCollapse(e)},this._onHeightsChangedDialpadAnimation=(e,t)=>{this._searchSpacerAnimation&&this._searchSpacerAnimation.setState({expandedHeight:e,collapsedHeight:t})}}_buildState(e,t){const i=M.default.isUsingStackNavigationContext(),a=this._getRootViewId(),n=A.default.isHeightSmallerThanThreshold(625,a),s=A.default.isSmallOrTinyScreenSize(a);let r=this._getContext().isPresentedInDesktopSubview?void 0:R.default.horizontalInsets(h.HorizontalInsetDefault);r&&n&&(r={left:r.left,right:0});const l=p.default.isSaveContactVisible(e.reopenOnInvalidNumber,e.prefilledNumber),c=p.default.isCallerIdCTAVisibleInPortrait(e.reopenOnInvalidNumber,e.prefilledNumber),d=p.default.isCallerIdCTAVisibleInLandscape(e.reopenOnInvalidNumber,e.prefilledNumber),u=o.default.getS4LEntitlementFeatures().SCE.Dialpad.Features.ExtensionDialingEnabled;return{screenWidth:A.default.getWidth(a),isSmallOrTinyScreenSize:s,bottomSafeAreaInset:R.default.bottomSafeAreaInset(h.BottomInsetDefault),isInLandscape:n,safeAreaHorizontalInsets:r,isUsingStackNavigationContext:i,shouldShowSaveContact:l,shouldShowCallerIdCTAPortrait:c,shouldShowCallerIdCTALandscape:d,extensionDialingEnabled:u&&void 0===e.conversationId&&void 0===e.callId,shouldShowRateAboveSelectedContact:p.default.shouldShowRateAboveSelectedContact()}}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),y.dismissAll()}componentDidMount(){super.componentDidMount();const e=U.default.mergeStyles([U.default.createBarStyle(this._themeColors.defaultStatusBarTheme),U.default.createHiddenStyle(!1)]);this._updateStatusBarStyle(e),N.default.dialpadRendered(),c.default.notifyDialpadCTAShown(),D.default.showPromptIfNeeded(this.props.conversationId||h.MainRootViewId)}componentWillUnmount(){super.componentWillUnmount(),this._removeStatusBarStyle(),p.default.resetDialerPanelState()}render(){const e=[G.dialerWrapper,this._themeStyles.primaryBackgroundColorStyle];let t;return this._useDarkTheme()&&e.push(this._themeStyles.searchBoxColorStyle),t=this._useDarkTheme()?n.createElement(n.View,{style:G.darkThemeBackground}):this._useAccessibleTheme()?n.createElement(n.View,{style:G.accessibleLightThemeBackground}):n.createElement(a.GradientView,{style:G.regularLightThemeBackground,colors:I.default.getGradientColorsNoSubscription(),direction:a.GradientDirection.BOTTOM_RIGHT}),n.createElement(n.View,{style:this.state.isInLandscape?G.groupsLandscape:G.groups},n.createElement(n.View,{style:this.state.isInLandscape?G.firstGroupLandscape:H.default.flexOne},t,n.createElement(S.default,{ref:this._onDialpadHeaderRef,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,isAloneInNavStack:this.props.isAloneInNavStack,isInLandscape:this.state.isInLandscape,maxWidth:this.state.screenWidth?this.state.screenWidth-100:0}),this._renderPhoneNumberInput(),this.state.shouldShowRateAboveSelectedContact?this._renderCallRates():this._renderSelectedContact(),this._renderSaveContact(),this.state.shouldShowRateAboveSelectedContact?this._renderSelectedContact():this._renderCallRates(),n.createElement(b.default,{ref:this._onFastContactsSearchRef,isInLandscape:this.state.isInLandscape,safeAreaHorizontalInsets:this.state.safeAreaHorizontalInsets,onScroll:this._onScrollFastContactsSearch,onItemPressed:this._onItemPressedFastContactsSearch,onRender:this._onRenderFastContactsSearch}),n.createElement(B.default,{ref:this._onSearchSpacerAnimationRef,isInLandscape:this.state.isInLandscape}),this.state.isInLandscape?this._renderCallerIdCTA():void 0),n.createElement(n.View,{style:this.state.isInLandscape?[G.secondGroupLandscape,this._themeStyles.dividerBorderColorStyle]:G.secondGroup},n.createElement(n.View,{style:e},this._renderDialpadView())))}_renderCallRates(){return n.createElement(d.default,{key:"callRates"})}_renderSelectedContact(){return n.createElement(O.default,{key:"selectedContact"})}_renderSaveContact(){if(!this.state.shouldShowSaveContact)return;return n.createElement(E.default,{onContactSaved:this._onContactSaved})}_renderPhoneNumberInput(){return n.createElement(k.default,{onPress:this._onPress,callId:this.props.callId,conversationId:this.props.conversationId,isInLandscape:this.state.isInLandscape,prefilledInput:this.props.prefilledNumber,openedOnInvalidNumberError:this.props.reopenOnInvalidNumber})}_renderCallerIdCTA(){if((this.state.isInLandscape||this.state.shouldShowCallerIdCTAPortrait)&&(!this.state.isInLandscape||this.state.shouldShowCallerIdCTALandscape))return n.createElement(l.default,{onMount:u.default.registerCallerIdDialerCTAOpen,onPress:this._onCallerIdDialpadCtaPress,isSmallScreen:this.state.isSmallOrTinyScreenSize})}_safeAreaMarginStyle(){if(this.state.safeAreaHorizontalInsets&&V.default.hasHorizontalSafeAreas(this.state.safeAreaHorizontalInsets))return V.default.horizontalMarginStyle(this.state.safeAreaHorizontalInsets)}_getSearchResultCount(){return this._fastContactsSearch?this._fastContactsSearch.state.profiles.length:0}_getHeaderText(e){return W.getHeaderText()}static getHeaderText(){return T.getString("PSTNDialerPanel.PSTNDialerPanelAccessibilityTitle")}}t.default=W},1829:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PhoneNumberInputBase=void 0;const a=i(0),n=i(7),o=i(475),s=i(1830),r=i(3),l=i(41),c=i(4),d=i(6),u=i(5),h=i(18),p=i(102),g=i(205),C=i(205),m=i(275),S=i(1260),y=i(48),f=i(9),_=i(11);var b;!function(e){e[e.Regular=0]="Regular",e[e.Emergency=1]="Emergency"}(b||(b={}));const v=d.lazyProperties({contactsIcon:()=>a.Styles.createViewStyle({paddingLeft:10,paddingRight:10,paddingBottom:10,paddingTop:8,alignSelf:"flex-start",flex:0})});class w extends S.ResponsiveComponentBase{constructor(e){super(e),this._getOptionalContactsIcon=()=>this.state.isContactsIconEnabled?a.createElement(l.default,{icon:_.SkypeIcon.People,color:this._useAccessibleTheme()?this._themeColors.primaryIconColor:f.Color.white,hoverColor:this._useAccessibleTheme()?this._themeColors.iconHoverColor:f.Color.whiteOverlay50,size:_.IconSize.size24,style:v.contactsIcon,onPress:this._onContactsButtonClick,title:u.getString("PSTNDialerPanel.ContactsButtonTitle")}):void 0,this._onContactsButtonClick=()=>{c.track(new m.DialerPanelComponentClick(m.DialerPanelClickTarget.ContactsIcon)),h.default.navigateToContactsPanel(void 0,!1,this._getContext())}}_buildState(e,t){const i=super._buildState(e,t),a=g.default.getPhoneNumber(C.TriggerKeys.Emergency);i.value=g.default.getPhoneNumber(C.TriggerKeys.InputValue).inputValue,i.selectedResult=g.default.getSearchResults().selectedResult,i.phoneNumber=a,i.phoneNumber.emergency?i.mode=b.Emergency:i.mode=b.Regular;const o=n.default.getS4LEntitlementFeatures().SCE;return i.isContactsIconEnabled=o.Dialpad.Features.ContactsIconEnabled,i.isRateIntegrationEnabled=o.UserServices.Client.Features.RateIntegrationEnabled,i.accessibilitySummary=g.default.getAccessibilitySummary(),i.callRate=this._getCallRate(a),t&&(i.showInvalidNumberNote=e.openedOnInvalidNumberError),i}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount();const e=this.props.prefilledInput;e&&this._writeToStore(e,r.NavigationCallOrigin.PstnDialpadPrefilled);const t=s.default.restorePhoneNumberInputIfNeeded();t&&this._writeToStore(t,r.NavigationCallOrigin.PstnDialpadSaveContact),s.default.clearState()}_getCallRate(e){if(e.E164&&p.default.isValidNumberString(e.E164))return o.default.getCallRateByPhoneNumber(p.default.stripPlusSign(e.E164))}_isEmergencyMode(){return this.state.mode===b.Emergency}_writeToStore(e,t){g.default.overwritePhoneNumberInput(e,!1,t)}_announceForAccessibility(e,t){return y.default.maybeAnnounceForAccessibility(e,t)}}t.PhoneNumberInputBase=w},1830:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class a{static savePhoneNumberInput(e){this.phoneNumberInput=e}static clearState(){this.phoneNumberInput=void 0,this.restoreStateRequired=!1}static restorePhoneNumberInputIfNeeded(){return this.restoreStateRequired?this.phoneNumberInput:void 0}static shouldRestoreState(){this.restoreStateRequired=!0}}t.default=a,a.phoneNumberInput=void 0,a.restoreStateRequired=!1},1921:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallConversationPanel=void 0;const a=i(0),n=i(7),o=i(69),s=i(88),r=i(53),l=i(381),c=i(281),d=i(43),u=i(33),h=i(79),p=i(58),g=i(3),C=i(86),m=i(148),S=i(4),y=i(6),f=i(5),_=i(467),b=i(1274),v=i(18),w=i(68),T=i(264),I=i(44),P=i(24),M=i(11),k=i(14),A=i(10),R=y.lazyProperties({base:()=>a.Styles.createViewStyle({flex:1,alignItems:"stretch",paddingBottom:20}),baseTablet:()=>a.Styles.createViewStyle({paddingBottom:0}),headerPanelStyle:()=>a.Styles.createViewStyle({paddingHorizontal:0}),centeredText:()=>a.Styles.createTextStyle({textAlign:"center"}),centeredView:()=>a.Styles.createViewStyle({justifyContent:"center",alignItems:"center",flex:1,flexDirection:"row"})});class V extends o.default{constructor(){super(...arguments),this._onToggleFindPanelWithOverflowConfig=e=>{const t=A.default.newCauseId();return S.log(g.LogTraceArea.FindPanel,"CallConversationPanel._onToggleFindPanelWithOverflowConfig, causeId: "+t),this.state.isFindPanelShowing?(S.track(new _.MessageOverflowEvent(_.MessageOverflowAction.MessageOverflowCloseButtonClicked)),v.default.closeFindPanel(t,this._getContext())):(S.track(new _.MessageOverflowEvent(_.MessageOverflowAction.MessageOverflowOpenButtonClicked)),v.default.navigateToFindPanel(this.props.conversationId,e,this._getContext(),t)),!0},this._handleLaunchCamera=()=>{r.UICapabilities.cameraSupported()&&(h.dismissAll(),c.navigateToCaptureComboModalWithParams({capturedContentHandler:new l.CapturedContentHandlerForPosting(this.props.conversationId),conversationId:this.props.conversationId,allowVideo:!0,mediaPickerShouldCollapseFully:!0,showCoachmarksIfNeeded:!0},this._getContext()))},this._onClosePress=()=>{const e=A.default.newCauseId();S.log(g.LogTraceArea.Navigation,"CallConversationPanel._onClosePress, causeId: "+e),this.props.onClose?this.props.onClose(e):v.default.closeConversationInCall(e,this._getContext())},this._onExpandPress=()=>{S.log(g.LogTraceArea.Navigation,"Going to full screen conversation"),S.track(new s.FullChatUXTelemetryEvent(s.FullChatUXNavigation.Enter,this.props.conversationId,this.props.callId)),v.default.navigateToConversation({convId:this.props.conversationId,origin:g.NavigationConversationOrigin.Call,causeId:A.default.newCauseId()})}}_buildState(e,t){const i=u.default().getConversation(e.conversationId);return{otherPartyMri:i&&i.isOneOnOne()?i.getOtherPartyMri():void 0,sideBarWidth:T.default.getWidth(),isFindPanelShowing:w.default.isFindPanelShowing(this._getRootViewId()),enableFullChatUx:n.default.getS4LMessagingFeatures().enableFullChatUx,isTranslatedConversation:m.default.isConversationTranslated(e.conversationId)}}_getTitleView(){return a.createElement(a.View,{style:R.centeredView},a.createElement(C.HiddenText,{style:[R.centeredText,P.default.fontStyle.h5,this._themeStyles.headerTextColorStyle]},f.getString("CallPanel.ChatTitle")))}render(){const e=d.default.applyShouldGroupAccessibilityChildren({style:[R.base,this._themeStyles.messageStreamBackgroundColorStyle,void 0]}),t={closeButtonType:I.CloseButtonType.Close,onPress:this._onClosePress,title:f.getString("CallPanel.CloseConversation")},i=[];this.state.enableFullChatUx&&i.push({icon:M.SkypeIcon.Expand,text:f.getString("CallPanel.Expand"),onPress:this._onExpandPress});const n=this._getContext().isPresentedInDesktopRightNav?{leftButton:t,rightButtons:i,titleView:this.state.enableFullChatUx?this._getTitleView():void 0,titleTextStyle:this.state.enableFullChatUx?k.default.flexNegativeOne:void 0}:{leftButton:void 0,rightButtons:t,titleView:a.createElement(a.View,{style:k.default.flexOne})};return a.createElement(a.View,Object.assign({},e),a.createElement(I.SimplePanelHeader,Object.assign({style:R.headerPanelStyle,hideBottomBorder:!0,useCenteredControls:!0},n)),a.createElement(b.default,{conversationId:this.props.conversationId,otherPartyMri:this.state.otherPartyMri,renderOrigin:p.MessageRenderOrigin.CallCanvas,allowUploads:!0,hasConnectedCalls:!0,availableWidth:this.state.sideBarWidth,onHandleOverflow:this._onToggleFindPanelWithOverflowConfig,onLaunchCamera:this._handleLaunchCamera,onToggleFindPanel:this._onToggleFindPanelWithOverflowConfig,isFindPanelHidden:!this.state.isFindPanelShowing,isTranslatedConversation:this.state.isTranslatedConversation}))}}t.CallConversationPanel=V,t.default=V},1922:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalPrivacyToastComponent=t.RemotePrivacyToastComponent=void 0;const a=i(0),n=i(1799),o=i(29),s=i(123),r=i(60),l=i(13),c=i(510),d=i(193),u=i(32),h=i(3),p=i(41),g=i(4),C=i(6),m=i(5),S=i(9),y=i(11),f=i(114),_=i(16),b=i(95),v=C.lazyProperties({container:()=>a.Styles.createViewStyle({flex:1,justifyContent:"center",paddingHorizontal:l.CompositeNotificationToastInfo.horizontal,paddingVertical:10}),leftContentContainer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",paddingHorizontal:10}),stopRecordingContentContainer:()=>a.Styles.createViewStyle({paddingHorizontal:5,flexDirection:"row"}),statusContentContainer:()=>a.Styles.createViewStyle({flex:1,alignItems:"center",flexDirection:"row"}),privacyStatementContainer:()=>a.Styles.createViewStyle({flex:1,alignItems:"center",flexDirection:"row"}),privacyStatementTextStyle:()=>a.Styles.createTextStyle({flex:1,color:S.Color.white,wordBreak:"break-word",paddingRight:10,textAlign:"right"}),statusTextStyle:()=>a.Styles.createTextStyle({flex:1,wordBreak:"break-word",paddingLeft:10}),linkStyle:()=>a.Styles.createTextStyle({color:S.Color.sxBlue})});class w extends n.RemoteBaseCallRecorderToast{_buildState(e,t){const i=d.default.getToast(e.id);if(i&&i.state){const t=i.state,a=o.default.CallingStore.getCallState(t.callId);return{callId:t.callId,callState:a,shouldToastBeRemoved:e.shouldToastBeRemoved(a),initiatorDisplayName:e.initiatorMri?u.default.getMemberShortNameForConversation(t.conversationMri,e.initiatorMri):void 0}}return{}}render(){const e=[{icon:y.SkypeIcon.CallRecordStroke,color:this._themeColors.headerIconColor},{icon:y.SkypeIcon.CallRecordDot,color:S.Color.red}],t=a.createElement(c.default,{icons:e});let i,n;return this.state.initiatorDisplayName?i=m.getString(this.props.notificationTextPath,{name:this.state.initiatorDisplayName}):this.props.initialNotificationTextPath&&(i=m.getString(this.props.initialNotificationTextPath)),i&&(n=a.createElement(_.BodyText,{style:[v.statusTextStyle,this._themeStyles.headerTextColorStyle],allowFontScaling:!1},i)),a.createElement(a.View,{style:v.container},a.createElement(a.View,{style:v.leftContentContainer},a.createElement(a.View,{style:v.statusContentContainer},t,n)))}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),!this.state.shouldToastBeRemoved&&s.default.isCallStateActive(this.state.callState)||(g.log(h.LogTraceArea.CallingUI,"RemotePrivacyToastComponent.componentDidUpdate removing toast"),d.default.removeToast(this.props.id))}}t.RemotePrivacyToastComponent=w;class T extends n.LocalBaseCallRecorderToast{_buildState(e,t){const i=d.default.getToast(e.id);if(i&&i.state){const a=i.state,n=o.default.CallingStore.getCallState(a.callId);return{callId:a.callId,showPrivacyLink:t||!(!this.state||!this.state.showPrivacyLink),callState:n,shouldToastBeRemoved:e.shouldToastBeRemoved(n),recordingTimestamp:e.getTimestamp(),useAccessibleTheme:b.default.useAccessibleTheme()}}return{}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.shouldToastBeRemoved&&(g.log(h.LogTraceArea.CallingUI,"LocalPrivacyToastComponent.componentDidUpdate removing toast"),d.default.removeToast(this.props.id,r.ToastActionType.Dismissed,!0))}render(){const e=[{icon:y.SkypeIcon.CallRecordStroke,color:this._themeColors.headerIconColor},{icon:y.SkypeIcon.CallRecordDot,color:S.Color.red}];let t,i=a.createElement(a.Button,{onPress:this._onStopPress,accessibilityLabel:m.getString(this.props.stopLinkTextPath)},a.createElement(c.default,{icons:e}));this.state.recordingTimestamp&&(t=a.createElement(_.BodyText,{style:[v.statusTextStyle,this._themeStyles.headerTextColorStyle],allowFontScaling:!1},this._getElapsedTime()));const n=a.createElement(a.View,{style:v.stopRecordingContentContainer},t,a.createElement(_.BodyText,{style:v.statusTextStyle,allowFontScaling:!1},a.createElement(f.default,{url:"#",style:this.state.useAccessibleTheme?this._themeStyles.headerTextColorStyle:v.linkStyle,allowFontScaling:!1,onPress:this._onStopPress},m.getString(this.props.stopLinkTextPath))));let o;if(this.state.showPrivacyLink){const e=a.createElement(f.default,{url:"#",style:this.state.useAccessibleTheme?this._themeStyles.headerTextColorStyle:v.linkStyle,allowFontScaling:!1,onPress:this._onMorePrivacyInfoPress},m.getString(this.props.morePrivacyInfoLinkTextPath));o=a.createElement(a.View,{style:v.privacyStatementContainer},a.createElement(_.BodyText,{style:[v.privacyStatementTextStyle,this._themeStyles.headerTextColorStyle],allowFontScaling:!1},m.getString(this.props.privacyStatementTextPath)," ",e),a.createElement(p.default,{icon:y.SkypeIcon.ClosePanel,size:y.IconSize.size20,color:this._themeColors.headerIconColor,hoverColor:this._themeColors.primaryIconColor,title:m.getString("Global.CloseButtonTitle"),onPress:this._onDismissPrivacyInfoPress}))}return a.createElement(a.View,{style:v.container},a.createElement(a.View,{style:v.leftContentContainer},a.createElement(a.View,{style:v.statusContentContainer},i,n,o)))}}t.LocalPrivacyToastComponent=T},205:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerKeys=void 0;const a=i(25),n=i(1),o=i(15),s=i(7),r=i(80),l=i(17),c=i(582),d=i(33),u=i(375),h=i(3247),p=i(3),g=i(4),C=i(208),m=i(239),S=i(102),y=i(275),f=i(31),_=i(46);var b;!function(e){e[e.InputValue=0]="InputValue",e[e.Emergency=1]="Emergency",e[e.E164=2]="E164",e[e.SelectedCountry=3]="SelectedCountry",e[e.Prefix=4]="Prefix",e[e.Callable=5]="Callable",e[e.SearchResults=6]="SearchResults"}(b=t.TriggerKeys||(t.TriggerKeys={}));let v=class extends o.StoreBase{constructor(){super(...arguments),this._phoneNumber={inputValue:"",E164:"",callable:!1,emergency:!1,forceChangedPrefix:!1,searchable:!0},this._searchResults={results:[],query:""},this._searchCache=[],this._searchContacts={},this._searchInitialized=!1,this._searchCacheLoading=!1,this._lastCalledCountryCodes={},this._phoneNumberPrefixIndex={index:{},indexSize:0,maxLength:0}}getPhoneNumber(e){return this._phoneNumber}getSearchResults(){return this._searchResults}getSelectedCountry(){return this._selectedCountry}getDefaultCountry(){return this._defaultCountry}getAccessibilitySummary(){return{searchHasResults:!!this._searchResults.results.length&&!this._searchResults.selectedResult,selectedContactDisplayName:this._searchResults.selectedResult?this._searchResults.selectedResult.contact.displayName:void 0,selectedCountryName:this._selectedCountry?this._selectedCountry.countryName:void 0}}getLast5CalledCountriesNoSubscription(){return this._lastCalledCountryCodes}setSelectedCountry(e,t=!1){if(g.log(p.LogTraceArea.DialerStore,"setSelectedCountry("+JSON.stringify(e)+", "+t+")"),g.log(p.LogTraceArea.DialerStore,"selectedCountry state changed, from ["+JSON.stringify(this._selectedCountry)+"] to ["+JSON.stringify(e)+"]"),this._selectedCountry=e,this._setDefaultCountry(this._selectedCountry),t){let e="";this._selectedCountry&&(this._phoneNumber.suffix&&this._phoneNumber.E164?(g.log(p.LogTraceArea.DialerStore,"Preserving number input"),this._phoneNumber.suffix===this._phoneNumber.inputValue?(this._phoneNumber.prefix=n.toString(this._selectedCountry.countryCode),e=this._phoneNumber.suffix,this._recalculatePhoneNumberCountry(),this._recalculatePhoneNumberE164Format()):e=S.default.compilePhoneNumber(this._phoneNumber.suffix,this._selectedCountry.countryCode)):e="+"+this._selectedCountry.countryCode),this.overwritePhoneNumberInput(e,!!e)}this.setPhoneNumberOrigin(p.NavigationCallOrigin.PstnDialpadTyped),this.trigger(b.SelectedCountry)}_preselectCountry(){const e=s.default.getS4LEntitlementFeatures().SCE.Dialpad.ContactsSearch;if(!this._selectedCountry){const t=u.default.getDefaultPstnDestinationCountry();g.log(p.LogTraceArea.DialerStore,"_preselectCountry() Stored PSTN default country: "+JSON.stringify(t)),t&&this.setSelectedCountry(t,!e.T9SearchEnabled)}!e.T9SearchEnabled||this._searchResults&&this._searchResults.preselected||this.cleanupPhoneNumberInput()}cleanupPhoneNumberInput(e=!0){g.log(p.LogTraceArea.DialerStore,"cleanupPhoneNumberInput("+e+")"),this._setInputValue("",e),this.setPhoneNumberOrigin(p.NavigationCallOrigin.PstnDialpadTyped)}eraseCharFromPhoneNumberInput(e=!0){g.log(p.LogTraceArea.DialerStore,"eraseCharFromPhoneNumberInput("+e+")");const t=this._phoneNumber.inputValue.slice(-1),i=this._phoneNumber.inputValue.slice(0,-1);return this._setInputValue(i,e),this.setPhoneNumberOrigin(p.NavigationCallOrigin.PstnDialpadTyped),[t,i]}appendCharToPhoneNumberInput(e,t=!0){g.log(p.LogTraceArea.DialerStore,"appendCharToPhoneNumberInput(*, "+t+")"),e=u.default.filterPhoneNumberChar(this._phoneNumber.inputValue,e),this._setInputValue(this._phoneNumber.inputValue?this._phoneNumber.inputValue+e:e,t),this.setPhoneNumberOrigin(p.NavigationCallOrigin.PstnDialpadTyped)}overwritePhoneNumberInput(e,t=!0,i=p.NavigationCallOrigin.PstnDialpadTyped){g.log(p.LogTraceArea.DialerStore,"overwritePhoneNumberInput(*, "+t+")"),this._setInputValue(e,t),this.setPhoneNumberOrigin(i)}selectSearchResultItem(e){const t=this._searchResults.results[e];this.overwritePhoneNumberInput(t.phone.number,!1,p.NavigationCallOrigin.PstnDialpadSearchResult),this._resetSearchResults(),this._searchResults.results=[t],this._searchResults.exactMatch=t,this._searchResults.selectedResult=t,this.trigger(b.SearchResults)}initializeSearch(){this._searchInitialized||this._searchCacheLoading||(this._searchCacheLoading=!0,this._searchCachePromise=c.default.getSortedUsersByPhoneNumberAsync("+").then(e=>{this._searchCache=[],n.each(e,e=>{this._searchContacts[e.getUniqueId()]={displayName:e.getDisplayName(),uniqueId:e.getUniqueId(),userMri:e.getMri()},n.each(e.phones,(t,i)=>{this._searchCache.push({contact:this._searchContacts[e.getUniqueId()],phone:t,t9SearchHash:u.default.mapKeypadLettersToNumbers(e.getDisplayName())})})}),this._searchCache=h.DialerSearchUtils.sortByDisplayName(this._searchCache),g.log(p.LogTraceArea.DialerStore,"Contact search: [init], Contacts cache: ["+n.size(this._searchContacts)+"], Search cache: ["+n.size(this._searchCache)+"]"),this._localAddressBookSubToken||(this._localAddressBookSubToken=C.default.subscribe(()=>this._updateSearchCache())),this._updateSearchCache(),this._searchInitialized=!0}).finally(()=>{this._searchCachePromise=void 0,this._searchCacheLoading=!1}))}_updateSearchCache(){const e=C.default.getFilteredSortedAddressBookContacts("",!0,!1);n.each(e,e=>{this._searchContacts[e.getUniqueId()]={displayName:e.getDisplayName(),uniqueId:e.getUniqueId(),userMri:""},n.remove(this._searchCache,t=>t.contact.uniqueId===this._searchContacts[e.getUniqueId()].uniqueId),n.each(e.phones,(t,i)=>{this._searchCache.push({contact:this._searchContacts[e.getUniqueId()],phone:t,t9SearchHash:u.default.mapKeypadLettersToNumbers(e.getDisplayName())})})}),g.log(p.LogTraceArea.DialerStore,"Contact search: [update], AB contacts: ["+e.length+"] Contacts cache: ["+n.size(this._searchContacts)+"], Search cache: ["+n.size(this._searchCache)+"]"),this._searchCache=h.DialerSearchUtils.sortByDisplayName(this._searchCache)}_scheduleSearch(){if(this._cancelOngoingSearch(),!this._phoneNumber.searchable)return;this.initializeSearch();const e=s.default.getS4LEntitlementFeatures().SCE.Dialpad.ContactsSearch;this._phoneNumberHandlingPromise=f.default.sleep(e.ExecutionDelay).then(()=>{this._resetSearchResults();const t={resultsName:[],resultsNumber:[]};n.isEmpty(this._searchResults.query)||(n.each(this._searchCache,i=>{if(e.T9SearchEnabled){let e=i.phone.number.indexOf(this._searchResults.query);-1!==e&&(i.matchedString=this._searchResults.query,t.resultsNumber.push(i)),e=i.t9SearchHash.indexOf(this._searchResults.query),-1!==e&&(i.matchedString=i.contact.displayName.substr(e,this._searchResults.query.length),t.resultsName.push(i))}else n.startsWith(i.phone.number,this._searchResults.query)&&(i.matchedString=this._searchResults.query,t.resultsNumber.push(i));i.phone.number===this._searchResults.query&&(this._searchResults.exactMatch=i)}),this._searchResults.results=t.resultsName.concat(t.resultsNumber))}).always(()=>{g.log(p.LogTraceArea.DialerStore,"Contact search: [results], Partial match: ["+this._searchResults.results.length+"] Exact match: ["+!!this._searchResults.exactMatch+"]"),this._phoneNumberHandlingPromise=void 0,this.trigger(b.SearchResults)})}_cancelOngoingSearch(){if(this._phoneNumberHandlingPromise){const e=this._phoneNumberHandlingPromise;this._phoneNumberHandlingPromise=void 0,e.cancel()}}_resetSearchResults(){const e=s.default.getS4LEntitlementFeatures().SCE.Dialpad.ContactsSearch.T9SearchEnabled;this._searchResults.query=h.DialerSearchUtils.getSearchCriteria(this._phoneNumber,e),this._searchResults.results=[],this._searchResults.exactMatch=void 0,this._searchResults.selectedResult=void 0,this._searchResults.preselected=void 0}destroySearch(){if(this._cancelOngoingSearch(),this._searchInitialized&&(this._searchCache=[],this._searchContacts={},this._searchInitialized=!1,this._searchCachePromise)){const e=this._searchCachePromise;this._searchCacheLoading=!1,this._searchCachePromise=void 0,e.cancel()}this._localAddressBookSubToken&&(C.default.unsubscribe(this._localAddressBookSubToken),this._localAddressBookSubToken=void 0),this._resetSearchResults(),this.trigger(b.SearchResults),g.log(p.LogTraceArea.DialerStore,"Contact search: [destroy]")}initializeCountrySelection(){g.log(p.LogTraceArea.DialerStore,"CountrySelection: [init]");const e=n.sortBy(n.filter(d.default().getAllConversationsInMemory(),e=>e.isCurrentUserMember()&&!!e.lastCallTime&&l.isPhoneMri(e.id)),e=>-1*(e.lastCallTime||0)),t=r.chain(e,r.map(e=>this._getRegionCodeForConversation(e)),r.uniq(),r.compact());this._lastCalledCountryCodes=r.chain(t,r.take(5),r.map(e=>["recent_"+e,m.default.getCountryByCode(e)]),r.fromPairs()),this._preselectCountry()}destroyCountrySelection(){this._lastCalledCountryCodes={},this._selectedCountry=void 0,this._defaultCountry=void 0,g.log(p.LogTraceArea.DialerStore,"CountrySelection: [destroy]")}resetPhoneNumber(){this._phoneNumber={inputValue:"",E164:"",callable:!1,emergency:!1,forceChangedPrefix:!1,searchable:!0},g.log(p.LogTraceArea.DialerStore,"PhoneNumber: [destroy]")}_setInputValue(e,t=!0){if(g.log(p.LogTraceArea.DialerStore,"_setInputValue(): [before] "+u.default.phoneNumberToString(this._phoneNumber)),this._phoneNumber.searchable=t,this._phoneNumber.inputValue===e)return;let i=this._processPhoneNumber(e);0!==i.length&&(i=n.uniq(i.concat(this._identifyEmergencyNumber())),this._identifyCallableNumber()&&i.push(b.Callable),g.log(p.LogTraceArea.DialerStore,"_setInputValue(): TriggerEvents",i),this.trigger(i),this._scheduleSearch(),g.log(p.LogTraceArea.DialerStore,"_setInputValue(): [after] "+u.default.phoneNumberToString(this._phoneNumber)))}_processPhoneNumber(e){const t=[];e=u.default.normalizePhoneNumber(e);const i=S.default.stripPossibleExtension(e);return this._recalculatePhoneNumberPrefix(i)&&(t.push(b.Prefix),this._recalculatePhoneNumberCountry()),this._phoneNumber.suffix=u.default.getPhoneNumberSuffix(i,this._phoneNumber.prefix),this._phoneNumber.extension=S.default.getPossibleExtension(e,!0),u.default.isE164Format(i)&&(e=u.default.getFormattedPhoneNumber(e,this._phoneNumber.prefix)),this._phoneNumber.inputValue!==e&&(this._phoneNumber.inputValue=e,t.unshift(b.InputValue),this._recalculatePhoneNumberE164Format()&&t.push(b.E164)),t}_identifyEmergencyNumber(){let e=[],t=!1;if(u.default.isEmergencyNumber(this._phoneNumber)){t=!0;const i=u.default.getEmergencyCallingCountrySubstitute(this._phoneNumber.countryCode);if(i&&!u.default.isE164Format(this._phoneNumber.inputValue)){const t=u.default.getE164FormattedPhoneNumber(n.toString(i.countryCode),this._phoneNumber.suffix);e=this._processPhoneNumber(t),this._phoneNumber.forceChangedPrefix=!0}else this._phoneNumber.forceChangedPrefix=!1}return this._phoneNumber.emergency!==t&&(this._phoneNumber.emergency=t,e.push(b.Emergency),t&&g.track(new y.EmergencyNumber)),e}_identifyCallableNumber(){const e=u.default.isCallableNumber(this._phoneNumber);return this._phoneNumber.callable!==e&&(this._phoneNumber.callable=e,!0)}_recalculatePhoneNumberPrefix(e){if(this._phoneNumber.prefix&&1===e.indexOf(this._phoneNumber.prefix))return!1;let t=void 0;if(0!==e.indexOf("+")&&e.length>0){const e=this._selectedCountry||this._defaultCountry;e&&(t=n.toString(e.countryCode))}else t=u.default.getPhoneNumberPrefix(e,this._getPhoneNumberPrefixIndex());return this._phoneNumber.prefix!==t&&(this._phoneNumber.prefix=t,!0)}_recalculatePhoneNumberCountry(){const e=u.default.getPhoneNumberPrefixCountry(this._phoneNumber.prefix,this._getPhoneNumberPrefixIndex());e?this._phoneNumber.countryCode!==e.country&&(this._phoneNumber.countryCode=e.country,this._selectedCountry&&n.toString(this._selectedCountry.countryCode)===this._phoneNumber.prefix||this.setSelectedCountry(e)):this._selectedCountry&&(this._phoneNumber.countryCode=void 0,this.setSelectedCountry(void 0))}_recalculatePhoneNumberE164Format(){const e=u.default.getE164FormattedPhoneNumber(this._phoneNumber.prefix,this._phoneNumber.suffix);return this._phoneNumber.E164!==e&&(this._phoneNumber.E164=e,!0)}_setDefaultCountry(e){!e||this._defaultCountry&&this._defaultCountry.country===e.country||(void 0!==this._defaultCountry&&u.default.setDefaultPstnDestinationCountryCode(e.country),g.log(p.LogTraceArea.DialerStore,"Default country state changed, from ["+JSON.stringify(this._defaultCountry)+"] to ["+JSON.stringify(e)+"]"),this._defaultCountry=e)}_getRegionCodeForConversation(e){const t=l.stripMriNamespace(e.id);if(u.default.containsNonGeographicOrTestPrefixes(t))return;const i=S.default.parseAndKeepRawInput(t),a=S.default.getRegionCodeForNumber(i);return a?a.toLowerCase():void 0}_getPhoneNumberPrefixIndex(){return this._phoneNumberPrefixIndex.indexSize<=0&&(this._phoneNumberPrefixIndex=u.default.getCountryDestinationPrefixIndex(m.default.getCountries()),g.log(p.LogTraceArea.DialerStore,"PhoneNumberPrefixIndex init, indexSize:",this._phoneNumberPrefixIndex.indexSize)),this._phoneNumberPrefixIndex}setPhoneNumberOrigin(e){this._phoneNumberOrigin=e}resetPhoneNumberOrigin(){this._phoneNumberOrigin=void 0}getPhoneNumberOrigin(){return this._phoneNumberOrigin}preselectSavedContact(e){const t=_.default.getFullUserProfileByMriNoSubscription(e);if(t&&t.phones){this._resetSearchResults(),this._searchInitialized=!1;const e={contact:{displayName:t.getDisplayName(),uniqueId:t.getUniqueId(),userMri:t.getMri()},phone:t.phones[0]};this.overwritePhoneNumberInput(e.phone.number,!1,p.NavigationCallOrigin.PstnDialpadSaveContact),this._searchResults.results=[e],this._searchResults.exactMatch=e,this._searchResults.selectedResult=e,this._searchResults.preselected=!0,this.trigger(b.SearchResults)}}};a.__decorate([o.autoSubscribe,a.__param(0,o.key)],v.prototype,"getPhoneNumber",null),a.__decorate([o.autoSubscribeWithKey(b.SearchResults)],v.prototype,"getSearchResults",null),a.__decorate([o.autoSubscribeWithKey(b.SelectedCountry)],v.prototype,"getSelectedCountry",null),a.__decorate([o.autoSubscribeWithKey(b.SelectedCountry)],v.prototype,"getDefaultCountry",null),a.__decorate([o.autoSubscribeWithKey([b.SelectedCountry,b.SearchResults])],v.prototype,"getAccessibilitySummary",null),v=a.__decorate([o.AutoSubscribeStore],v),t.default=new v},2118:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(3),n=i(20),o=i(28),s={enableEndCallInRecents:!1,enableIOSIntegratedCalling:!0,enableCreditPurchase:!1,enableEnhancedPhotoExposure:!0,enableStreamVideo:!1,enableFilters:!0,enableAdaptiveCameraContentScale:!1,enableAzMSPublish:!1,enableAzMSConsume:!1,enableDesktopVIM:!0,desktopVIMAMSDocumentType:"sharing/videototranscode",resumableUploads:{enabled:!0,types:["Video","VideoMessage"]},enableDesktopVIMThumbnailUpload:!0,mobilePreviewPercentage:.2,enableNoMicModal:!0,enableMissedCallbackReminderAppActive:!1,enableIncomingVideoNotification:!1,enableNewIncomingVideoSound:!1,maximumVideoSuggestionTooltipInteraction:3,enableMicPopup:!0,enableRNStreamsV2:!1,enableStartVideoOnSettingsClose:!0,desktopVIMAppendExtensionOnUpload:!0,enableOutgoingWarmStartMessage:!0,enableTestCalls:!1,maximumGroupSizeRing:25,maximumGroupSizeGoLive:250,maximumGroupSizeRinglessCall:50,enableCallReconnectUI:!0,enableCallReconnectSound:!0,maxRecordingMs:18e4,videoWidth:640,videoHeight:360,videoBitrate:1300,enableMsnpFlamingoMessages:!0,createTranslatedChatEnabled:!0,translatorAgentId:"28:0d5d6cff-595d-49d7-9cf8-973173f5233b",videoProfile:1,enableVideoBFrame:!1,videoReEncodeKeyFrameSec:1,optimizeVideoForNetwork:!1,captureStopDelayMs:1e4,cameraVersion:1,enableSimpleTextReactions:!1,enableHDVideo:!1,enableMomentsCapture:!0,enableMomentsCaptureCoachmarkforScreenshare:!1,enableNewCaptureActivityPip:!0,androidCallMonitorConfig:{permissionPromptMaxDisplayCount:3,permissionPromptResetIntervalSeconds:2419200},enableDXVAOffloading:!0,enableBufferSharing:!1,callRecorderBotEnabledOneOnOneCall:!0,callRecorderBotEnabledGroupCall:!0,callRecorderBotEnabledOneOnOnePstnCall:!1,callRecorderBotMri:"28:0ad9717e-76fd-4658-a764-beaf21698977",callRecorderBotMriFilter:["28:0ad9717e-76fd-4658-a764-beaf21698977","28:56fc6434-1e40-4e9e-ace2-373ce28cfba4"],callRecorderRetentionDurationDays:30,callReactionsBarButtonConfig:{mobile:[["Moments"],["Reactions"]],tablet:[["Chat","Moments"],["Gallery","Reactions"]]},enablePhotoSharingCoachMark:!1,callKitSupportDisabledCalls:!0,enableCallTechnicalInformation:!1,callReactionButtonKey:"heart",callCelebrationConfig:{callCelebrateButtonKey:"cake",celebrationAnimationTimeoutsinMs:{cake:3750,clap:2e3,default:3e3}},callAnimatedReactionsConfig:{callAnimatedReactionsKeys:["beer","clap","daffyduck","fire","heart","laugh","lebronjames","lolabunny","penguin","sad","sarcastic","surprised","yes","cake"],callAnimatedReactionsTimeoutsinMs:{beer:3e3,cake:3750,clap:2e3,default:3e3,fire:3600,heart:2e3,laugh:2e3,lebronjames:2180,penguin:6300,sad:2e3,sarcastic:2e3,surprised:2e3,yes:2e3}},enableNewAnimations:!1,enableGifCaptureLoadingIndicator:!1,allowIncomingCallsWithExpiredToken:!1,enableAddToCallRibbonCoachMark:!1,enableImmersiveModeRibbon:!0,enableNDISetting:n.default.isElectronOsx()||n.default.isElectronWindows(),learnMoreNDILink:"https://www.newtek.com/blog/tips/using-ndi-in-skype/",broadcastTermsOfServiceUrl:"https://www.skype.com/{lang}/legal/broadcast/",enableMessageTranslation:!1,enableOldMessageTranslation:!0,translatorBotDeprecationDate:"31/12/2019",enableTranslatorBotDeprecation:!1,messageTranslatorEndpointUrl:"https://translatorv2.skype.com/api/v1/text.translation",callCaptionsEnableTranslatedVoiceOption:!1,isCallCaptionsCleanupEnabled:!1,callCaptionsCleanupBatchSize:1e3,callCaptionsCleanupValidDate:"",callCaptionsClearTimeout:7e3,callCaptionsMaxHistory:100,callCaptionsEnableForAllCallsOption:!0,callCaptionsEnableSubtitleLanguageOption:!1,isInterimCaptionConcatenated:!1,callTranslatorBotConfig:{enabledTranslatorOneOnOneCall:!1,enabledTranslatorOneOnOnePstnCall:!1,enabledTranslatorGroupCall:!1,hideInRoster:!0,botMri:"28:5dad43e6-3db1-435f-b8ee-7b0a759c658f",botMriFilter:["28:9f6cbb6e-083f-4b96-bcfa-802488dcf40e","28:d96d5a9f-c9ae-41af-9187-e213d456041f","28:29a41b3a-90e7-4d23-9d24-afe4dee2e4e7","28:52b0c63e-a675-4e38-b8fb-b373d96ec315","28:f15ea256-e453-4b87-810e-6fabc0a6fdb3","28:f4c739a9-9d32-45a9-bb93-bfb955b30270","28:5dad43e6-3db1-435f-b8ee-7b0a759c658f"],service:{id:"skype.tx",version:1},languageSupport:{speech:["de-DE","en-GB","en-US","es-ES","fr-FR","it-IT","ja-JP","pt-BR","ru-RU","zh-CN","zh-TW"],tts:["de-DE","en-GB","en-US","es-ES","fr-FR","it-IT","ja-JP","pt-BR","ru-RU","zh-CN","zh-TW"]},translatorBotClientTimeoutMs:5e3},isStartCaptionsInfoPanelEnabled:!1,callControlTimeoutMs:7e3,callControlShortTimeoutMs:5e3,enableCallKitOnlyBehavior:!0,enableHighContrastTheme:!1,enableSnapshotNotification:!0,syncAdapterMode:"on",autoGrantContactsWritePermissions:!0,photoEventTimeoutMs:5e3,callAudienceBotConfig:{enabledOneOnOneCall:!1,enabledGroupCall:!1,enabledBackgroundSelection:!1,botMri:"28:9cd07db6-fab5-438c-8e34-44117fac7650",botMriFilter:["28:4969df63-cfcb-45e3-b06e-1f2b54d8b9bb","28:9cd07db6-fab5-438c-8e34-44117fac7650","28:3d59cb08-f597-4e49-9add-a05f9735152b"],backgrounds:[],minParticipantsOnCall:2,maxNumberOfAttemptsForDataChannelHandler:4,retryDelayMsForDataChannelHandler:500},callGridViewBotConfig:{enabled:!1,botMri:"28:ab5d1521-415b-4380-82e4-af803fb8bf2d",botMriFilter:["28:9dc84a1d-cd1f-4e39-83b4-365e9482e2ad","28:8cf0f6d9-65dc-464b-a2cb-8f66a9767358","28:ab5d1521-415b-4380-82e4-af803fb8bf2d"],minParticipantsOnCall:2},enableUFDForDeviceHasEcho:!1,enableAttachVideoWithId:!1,enableRemoteMute:!0,enableJoinerCallPreview:!1,enableRinglessCall:!1,enableRinglessCallForSmallGroups:!1,enableEndGoLiveForLastParticipant:!1,enableStopCallControlTimerWhenActionsMenuOpened:!0,enableBlockPSTNUserInContactInviteHeader:!1,enablnewPSTNLandingScreenWhileSearch:!1,enableTapToMoveCallParticipant:!1,enableAddToCallGroupJoinLink:!0,enableCallRosterGroupJoinLink:!0,enableSkypeLogo:!0,enableSlimcorelogging:!1,enableSecondaryRinging:!0,enableUnmuteOnRing:!0,retryPolicy:{maxPostElapsedTime:3e5,maxTransferTime:{postingService_getStatusServerTranscoding:6e4,postingService_postChatMessage:o.NumberShim.MAX_SAFE_INTEGER,postingService_postChatMessageForeground:o.NumberShim.MAX_SAFE_INTEGER},maxRetriesDefault:5,maxRetries:{postingService_urlPreviewFetching:3,postingService_updateChatMessageProperties:3,postingService_getStatusServerTranscoding:1e3,postingService_postChatMessage:o.NumberShim.MAX_SAFE_INTEGER,postingService_postChatMessageForeground:o.NumberShim.MAX_SAFE_INTEGER},constantPollTime:{postingService_getStatusServerTranscoding:500},countLocalNetworkFailures:!0},optimalVideoCountInitialThrottleSeconds:0,serverVideoTranscoding:{enabled:!1,expectedTimeToCompleteMs:1e3,expectedTimeDisplayPercentage:.9},localPreviewAndroidV2:!1,enableShowCallRateInPSTNCallWindow:!0,enableNewCameraFlipFlow:!0,enableMultiGradientOverlay:!0,enablePreRS5HIDSupported:!0,enableAccessibleRecordButton:!1,disableCopyingOriginalVideoToCache:!1,videoReencodeConfig:{profile:2,highQualitySource:!1,outputWidth:1280,outputHeight:720,videoBitrate:2e6,audioBitrate:96e3,minSizeDecreaseRatio:.2},picturePrefetchEnabled:!0,picturePrefetch:{status:"On",maxTimeIntervalPriorToStartupSec:86400,maxQueuedEntriesCount:20},picturePrefetchCacheExpiryTimeSec:259200,videoPrefetchCacheExpiryTimeSec:259200,enableLibraryVideoMarkup:!1,maxVideoDurationOnMobileMin:1,enableRingingNotifications:!0,fileRetentionDurationDays:30,screensharingIconFromECS:"",scheduleNextCallDurationSeconds:300,scheduleNextCallFrequency:20,scheduledCallNotSupportedFallbackUrl:"https://www.skype.com/get-skype",scheduledCallSearchBatchSize:100,enableScheduledCallAddToCalendar:!1,enableScheduledCallsSystemMessages:!1,scheduledCallInviteSendTimeout:3e3,maxScheduleNextCallDisplays:5,enableMeetNowEmoticonPicker:!1,enableMeetNowStickersOnSafari:!1,meetNowTitleSuggestionList:{enableSuggestionList:!1,isFlatList:!0},redesignedLobbiesEnabled:!1,waitJoinKnowledgeTimeoutMs:15e3,enablePreHeatCall:!1,enableObservingCall:!1,enableFullScreenOnWeb:!1,enableDoubleTapToFullScreen:!1,serverMessagesAfterThreadCreationTimeWindow:3e3,ignoreNonFatalError:!0,earpieceHiddenForVideoCalls:!1,enableRequestNewAppInitiatedCallAPI:!1,reportCallEndedWhenStopTrackingCall:!0,enableMobileScreenSharing:!1,enableCameraPortraitLock:!1,enableMobileSubtitlesRightPanel:!1,enableScreenSharingToolbar:!1,enableDeclineAndMessageOnRingControls:!1,enableBlurBackgroundForAllCalls:!1,footprintServiceIntervalInMinutes:0,footprintServiceConfigUrls:[],enableScreenSharingControl:!1,enableEndCallWhenSystemSleeps:!1,useConverstionSyncForJoinCall:!1,enableOfficeLens:!1,enableOfficeLensOnChromeOs:!1,officeLensMinAndroidOsVersion:26,disableParticipantTalkingAnimation:!1,enableShouldShowCQFDelegation:!1,enableScreenRecordingPermission:!1,enableCallIntegration:!1,enableBackgroundReplacement:!1,enableBackgroundBlurOnWeb:!1,enableBackgroundBlurOnIOS:!1,enableBackgroundBlurOnAndroid:!1,enableBackgroundBlurNewLabel:!0,backgroundEffects:[],bingBackgrounds:{enabled:!1,enableDataChannel:!1,dataChannelId:14,host:"https://www.bing.com",path:"/hp/api/v1/imagegallery?format=json&setmkt=[LOCALE]&today=1",syncIntervalMs:216e5,pickImageBasedOnUserIdHash:!1,showInSettings:!1,showInCallHeader:!1,showInCallFooter:!1,iconCountInHeader:1,captionAlwaysCollapsed:!0,useBingLogoInsteadOfSearchIcon:!1,showBackgroundCaptions:!0,tryOpenInAppBrowser:!0,sendBackgroundInfoUpdates:!0,throttleIntervalMs:500,retryDataChannelSendOnError:!0,retryDataChannelMaxNumber:3,retryDataChannelDelayMs:2e3},backgroundCategories:a.BackgroundCategories,enableBackgroundEffectsCategories:!1,numberOfVisibleLastUsedEffects:4,backgroundEffectsUri:"https://secure.skypeassets.com/content/dam/scom/",hideSnapshotButton:!1,keepScreenShareWhenDisableVideo:!1,modernCallStage:{enabled:!1,maxStageElements:4,animationDuration:250,keepStreamAlive:!1,minVideoSize:{width:360,height:270},mobileMinVideoSize:{width:180,height:135},autoLetterBoxThresholdRatio:.3},enableNotifyUsersMuteKick:!1,enablePerfomanceTelemetry:!1,perfomanceTelemetryTimeoutInterval:5e3,enableAllCallButtonsVisible:!1,enableNewBackgroundEffectsLayout:!1,maxNumberOfVideosInUI:12,enableDialpadOnPSTNSubtitlesCalls:!1,disableVideosInRibbon:!1,enableCallPreviewPermissionOnLoad:!1,enableRaiseHands:!1,enableDeviceNumberTelemetry:!1,enableMsixPermissionTelemetry:!1,enableUFDQualityTelemetry:!1,enableShareInviteMessageVariant:!1,enableExperimentalVideoRendering:!1,enablePresentationMode:!1,enableParticipantsButtonInCallControls:!1,enableNewMainCallControlsForOldCallScreen:!1,enableAudioParticipantsOnTheStage:!1,enableAudioParticipantsOnTheStageByDefault:!1,enableAudioParticipantsOnTheStageAsNew:!1,enableNewCallScreen:!1,newCallScreenEnabledByDefault:!1,enableLightThemeOnCallStage:!1,enableReactionsInCallStageMobile:!1,enableOutgoingVideoFirefox:!1,enableIncomingVideoFirefox:!1,enableScreenSharingFirefox:!1,cameraHelp:{showCameraIssuesText:!1,cameraIssuesLink:"https://go.skype.com/call.quality.guide"},enableUIToSelectSkypeOrPSTNContactToAddToGroupCall:!1,meetNowRequestsConfig:{retryCount:3,timeoutInMs:15e3},electronNavigationDebounce:1e3,enableReorderingParticipantsRaiseHand:!0,enableSpeechConsentFlow:!1,speechConsentFlowConfig:{callsBetweenConsentSuggestion:5,maxSuggestionsShownCount:3},enableNoiseSuppression:!1,enableNewLayoutPicker:!1,enableLockMeeting:!1,enableAudienceDataChannel:!1,enableAsyncMedia:!1,PSTNCampaignTerminatedReasons:[],customCallReactions:{enabled:!1,maxNumberOfCustomReactions:6,defaultPack:["yes","cwl","surprised","clap","cry"],useNewAddEmojiIcon:!1},timeoutForRendererInState:5e3,enableCallHandoff:!1,enableMultipleStreamSupport:!1,autoLetterBoxThresholdRatioForNewStage:.5,autoLowerHand:!1,autoLowerHandConfig:{speakingTimeThreshold:4e3,notSpeakingTimeThreshold:1e3,noiseMeasurmentThreshold:1e3,noiseMultiplayer:1.5,measurmentInterval:200,failPeriod:15e3,hardcodedNoiseValue:0},enableLocalSpeakingIndicator:!1,callingStoreThrottleMs:void 0,enableEcoMode:!1,enableCallParticipantsPinning:!1,twinCamEnabled:!1,enableTopTrayHiding:!1};t.default=s},219:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(25),n=i(1),o=i(15),s=i(8),r=i(7),l=i(29),c=i(88),d=i(60),u=i(110),h=i(3),p=i(4),g=i(23),C=i(22),m=i(10),S=i(30);let y=class extends o.StoreBase{constructor(){super(),this._stageLayoutMode={},this._fallbackStageLayoutMode={},this._callHeaderLayoutMode={},this._fallbackCallHeaderLayoutMode={},this._onlyVideoOnTheStage={},this._selfInTheGrid={},this._hideTopTray={},this._callScreenshareStoreSubscriptions={},this._callCallingStoreSubscriptions={},this._wasFullScreenBotAutoTriggered={},C.RegisterStartupable(this,"CallStageLayoutStore")}startup(){return s.Resolved()}onStartTrackingCall(e,t,i){this._setDefaultHeaderLayoutMode(e,t),this._setDefaultSelfInTheGrid(t,e),this.setStageMode(e,d.StageMode.Grid,i,!0),this._subscribeToScreenshareStore(e),this._subscribeForFullScreenBots(e)}onStopTrackingCall(e){this._cleanUpStageLayoutSettings(e),this._unsubscribeFromScreenshareStore(e),this._unsubscribeForFullScreenBots(e)}_subscribeForFullScreenBots(e){this._callCallingStoreSubscriptions[e]||(this._callCallingStoreSubscriptions[e]=l.default.CallingStore.subscribe(()=>this._onCallingStoreChanged(e),e))}_unsubscribeForFullScreenBots(e){this._callCallingStoreSubscriptions[e]&&(l.default.CallingStore.unsubscribe(this._callCallingStoreSubscriptions[e]),delete this._callCallingStoreSubscriptions[e],delete this._wasFullScreenBotAutoTriggered[e])}_onCallingStoreChanged(e){const t=m.default.newCauseId();if(l.default.CallingStore.isConnectedAudienceBotInCall(e)&&!this._wasFullScreenBotAutoTriggered[e]){p.log(h.LogTraceArea.Calling,"CallStageLayoutStore._onCallingStoreChanged with audience bot,\n                causeId: "+t),this._wasFullScreenBotAutoTriggered[e]=!0;const i=d.StageMode.TogetherMode;this._setFallbackStageMode(e,t,i),l.default.CallScreenShareStore.hasIncomingScreensharing(e)||(this._setStageMode(e,i,t,!0),this._setFallbackHeaderLayoutMode(e,t),this._setCallHeaderLayoutMode(e,d.CallPanelHeaderLayout.Window,t))}else l.default.CallingStore.isPossiblyNotConnectedAudienceBotInCall(e)||(this._wasFullScreenBotAutoTriggered[e]=!1)}_subscribeToScreenshareStore(e){this._callScreenshareStoreSubscriptions[e]||(this._callScreenshareStoreSubscriptions[e]=l.default.CallScreenShareStore.subscribe(()=>this._onScreensharingChanged(e),e))}_unsubscribeFromScreenshareStore(e){this._callScreenshareStoreSubscriptions[e]&&(l.default.CallScreenShareStore.unsubscribe(this._callScreenshareStoreSubscriptions[e]),delete this._callScreenshareStoreSubscriptions[e])}_onScreensharingChanged(e){const t=m.default.newCauseId();p.log(h.LogTraceArea.Calling,"CallStageLayoutStore._onScreensharingChanged, causeId: "+t),l.default.CallScreenShareStore.hasIncomingScreensharing(e)?this._applyScreensharingSettings(e,t):this._applyFallbackSettings(e,t)}_applyScreensharingSettings(e,t){this._setFallbackStageMode(e,t);const i=u.default.getScreensharingMode();this._setStageMode(e,i,t,!0),this._setFallbackHeaderLayoutMode(e,t),this._setCallHeaderLayoutMode(e,d.CallPanelHeaderLayout.Window,t)}_applyFallbackSettings(e,t){u.default.isInIncomingScreenshareMode(this._getStageMode(e))&&this._resetStageModeToFallback(e,t),this._resetHeaderModeToFallback(e)}getStageMode(e){return this._getStageMode(e)}_getStageMode(e){return n.isUndefined(this._stageLayoutMode[e])?d.StageMode.Grid:this._stageLayoutMode[e]}setStageMode(e,t,i,a){this._setStageMode(e,t,i,a),n.isUndefined(this._fallbackStageLayoutMode[e])||delete this._fallbackStageLayoutMode[e]}getAvailableStageModes(e){const t=r.default.getS4LCMCFeatures(),i=[d.StageMode.Grid],a=l.default.CallingStore.isOneOnOneCall(e);l.default.CallScreenShareStore.hasIncomingScreensharing(e)?i.push(u.default.getScreensharingMode()):a||i.push(d.StageMode.Speaker);const n=l.default.CallingStore.isPSTNCall(e),o=l.default.CallingStore.isEncryptedCall(e);return n||o||((a?t.callAudienceBotConfig.enabledOneOnOneCall:t.callAudienceBotConfig.enabledGroupCall)&&i.push(d.StageMode.TogetherMode),!a&&t.callGridViewBotConfig.enabled&&i.push(d.StageMode.LargeGrid)),i}getAvailableStageModesV2(e){const t=r.default.getS4LCMCFeatures(),i=[],a=l.default.CallingStore.isOneOnOneCall(e);a||i.push(d.StageMode.Speaker),l.default.CallScreenShareStore.hasIncomingScreensharing(e)&&i.push(u.default.getScreensharingMode()),i.push(d.StageMode.Grid);const n=l.default.CallingStore.isPSTNCall(e),o=l.default.CallingStore.isEncryptedCall(e);return n||o||(!a&&t.callGridViewBotConfig.enabled&&i.push(d.StageMode.LargeGrid),(a?t.callAudienceBotConfig.enabledOneOnOneCall:t.callAudienceBotConfig.enabledGroupCall)&&i.push(d.StageMode.TogetherMode)),i}_setStageMode(e,t,i,a){const n=this._stageLayoutMode[e];if(n!==t){this._stageLayoutMode[e]=t,p.log(h.LogTraceArea.Calling,`CallStageLayoutStore._setStageMode: call stage mode\n                changed from ${d.StageMode[n]} to ${d.StageMode[t]}, causeId: ${i}`);const o=this._getOnlyVideoOnTheStage(e),s=S.default.getUserPreferencesLocalNoSubscription().isNewCallScreenDesignEnabled;p.track(new c.CallStageLayoutChangeEvent(n,t,o,o,!!s,!!a)),this.trigger(e)}}_cleanUpStageLayoutSettings(e){delete this._stageLayoutMode[e],delete this._fallbackStageLayoutMode[e],delete this._callHeaderLayoutMode[e],delete this._fallbackCallHeaderLayoutMode[e],delete this._onlyVideoOnTheStage[e],delete this._selfInTheGrid[e],delete this._hideTopTray[e]}_setFallbackStageMode(e,t,i){const a=n.isUndefined(i)?this._stageLayoutMode[e]:i;this._fallbackStageLayoutMode[e]===a||u.default.isInIncomingScreenshareMode(a)||(this._fallbackStageLayoutMode[e]=a,p.log(h.LogTraceArea.Calling,`CallStageLayoutStore._setFallbackStageMode: fallback call stage mode\n                set to ${d.StageMode[a]}, causeId: ${t}`))}_resetStageModeToFallback(e,t){const i=this._fallbackStageLayoutMode[e];n.isUndefined(i)?(p.log(h.LogTraceArea.Calling,"CallStageLayoutStore.resetStageModeToFallback: No fallback mode found for call id "+e+" causeId: "+t),this.setStageMode(e,d.StageMode.Grid,t,!0)):(p.log(h.LogTraceArea.Calling,`CallStageLayoutStore.resetStageModeToFallback: set stage mode\n                to ${d.StageMode[i]} , causeId ${t}`),this.setStageMode(e,i,void 0,!0),delete this._fallbackStageLayoutMode[e])}getCallHeaderLayoutMode(e){return n.isUndefined(this._callHeaderLayoutMode[e])?this._getDefaultHeaderLayout(!0):this._callHeaderLayoutMode[e]}setCallHeaderLayoutMode(e,t,i){n.isUndefined(this._fallbackCallHeaderLayoutMode[e])||delete this._fallbackCallHeaderLayoutMode[e],this._setCallHeaderLayoutMode(e,t,i)}_setDefaultHeaderLayoutMode(e,t){this._setCallHeaderLayoutMode(e,this._getDefaultHeaderLayout(t))}_setCallHeaderLayoutMode(e,t,i){const a=this._callHeaderLayoutMode[e];a!==t&&(this._callHeaderLayoutMode[e]=t,p.log(h.LogTraceArea.Calling,`CallStageLayoutStore._setCallHeaderLayoutMode: header layout mode\n                changed from ${d.CallPanelHeaderLayout[a]} to ${d.CallPanelHeaderLayout[t]},\n                causeId: ${i}`),this.trigger(e))}_setFallbackHeaderLayoutMode(e,t){const i=this._callHeaderLayoutMode[e];this._fallbackCallHeaderLayoutMode[e]!==i&&(this._fallbackCallHeaderLayoutMode[e]=i,p.log(h.LogTraceArea.Calling,`CallStageLayoutStore._setFallbackHeaderLayoutMode: fallback call header mode\n                set to ${d.CallPanelHeaderLayout[i]}, causeId: ${t}`))}_resetHeaderModeToFallback(e){const t=this._fallbackCallHeaderLayoutMode[e];n.isUndefined(t)?p.log(h.LogTraceArea.Calling,"No header fallback mode found for call id "+e):(p.log(h.LogTraceArea.Calling,"CallStageLayoutStore._resetHeaderModeToFallback: set header mode\n                to "+d.CallPanelHeaderLayout[t]),this.setCallHeaderLayoutMode(e,t),delete this._fallbackCallHeaderLayoutMode[e])}_getDefaultHeaderLayout(e){return g.default.isUsingStackNavigationContext()?d.CallPanelHeaderLayout.Mobile:e?d.CallPanelHeaderLayout.Window:d.CallPanelHeaderLayout.Float}getOnlyVideoOnTheStage(e){return this._getOnlyVideoOnTheStage(e)}_getOnlyVideoOnTheStage(e){return n.isUndefined(this._onlyVideoOnTheStage[e])?this._getDefaultOnlyVideoOnTheStage():this._onlyVideoOnTheStage[e]}_getDefaultOnlyVideoOnTheStage(){const e=r.default.getS4LCMCFeaturesNoSubscription();return!S.default.getUserPreferencesLocalNoSubscription().isNewCallScreenDesignEnabled&&!e.enableAudioParticipantsOnTheStageByDefault}setOnlyVideoOnTheStage(e,t,i){const a=this._onlyVideoOnTheStage[e];if(a!==t){this._onlyVideoOnTheStage[e]=t,p.log(h.LogTraceArea.Calling,`CallStageLayoutStore.setOnlyVideoOnTheStage: onlyVideoOnTheStage changed from ${a} to ${t}, causeId: ${i}`);const n=this._getStageMode(e),o=S.default.getUserPreferencesLocalNoSubscription().isNewCallScreenDesignEnabled;p.track(new c.CallStageLayoutChangeEvent(n,n,a,t,!!o,!1)),this.trigger(e)}}getSelfInTheGrid(e){return this._getSelfInTheGrid(e)}_getSelfInTheGrid(e){return!!n.isUndefined(this._selfInTheGrid[e])||this._selfInTheGrid[e]}_setDefaultSelfInTheGrid(e,t){this.setSelfInTheGrid(e,t)}setSelfInTheGrid(e,t){p.log(h.LogTraceArea.CallingUI,"Set local view on the stage to "+e),S.default.getUserPreferencesLocalNoSubscription().isNewCallScreenDesignEnabled?this._getSelfInTheGrid(t)!==e&&(this._selfInTheGrid[t]=e,this.trigger(t)):p.warn(h.LogTraceArea.CallingUI,"Attempt to set local video on stage when new call stage is not enabled")}isTopTrayHidden(e){return!!this._hideTopTray[e]}setHideTopTray(e,t){this._hideTopTray[t]!==e&&(this._hideTopTray[t]=e,this.trigger(t))}};a.__decorate([o.autoSubscribe,a.__param(0,o.key)],y.prototype,"getStageMode",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],y.prototype,"getAvailableStageModes",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],y.prototype,"getAvailableStageModesV2",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],y.prototype,"getCallHeaderLayoutMode",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],y.prototype,"getOnlyVideoOnTheStage",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],y.prototype,"getSelfInTheGrid",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],y.prototype,"isTopTrayHidden",null),y=a.__decorate([o.AutoSubscribeStore],y),t.default=new y},239:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(25),n=i(1),o=i(0),s=i(15),r=i(8),l=i(80),c=i(49),d=i(160),u=i(75),h=i(1368),p=i(5),g=i(30),C=i(3218),m=i(22),S=i(19);let y=class extends s.StoreBase{constructor(){super(),this._handleMemoryWarningEvent=()=>{this._countries={}},this._updateData=(e,t)=>{this._countries=l.chain(e,l.uniqBy(e=>e.MSShort),l.map(e=>{const t=Number(e.TAPICode);if(!isNaN(t))return{country:n.toLower(e.MSShort),countryName:e.CountryRegionName,countryCode:t}}),l.compact(),l.keyBy(e=>e.country));const i={countries:this._countries,language:t};u.default.putData(c.InternalKeys.PhoneCountryCache,i),this._locale=t,this.trigger()},p.localeChangedEvent.subscribe(e=>{m.HasStarted(this)&&e!==this._locale&&this._requestCountryConfig(e)}),m.RegisterStartupable(this,"PhoneCountryStore",[d.default,u.default,g.default])}startup(){return this._countries={},this._locale=p.getLocale(),o.App.memoryWarningEvent.subscribe(this._handleMemoryWarningEvent),d.default.setRefreshOptions(c.InternalKeys.PhoneCountryCache,{interval:6048e5,taskTypeFlags:d.TaskTypeFlags.UsesNetworking,callback:()=>this._requestCountryConfig(p.getLocale())}),r.Resolved()}getCountries(){return this._getCountries()}getCountryByCode(e){return this._getCountries()[e]}_getCountries(){if(n.isEmpty(this._countries)){const e=u.default.getData(c.InternalKeys.PhoneCountryCache);this._countries=e&&e.countries||{},n.isEmpty(this._countries)?(this._loadDataFromBackupFile(),m.EnsureStarted(this).then(()=>{d.default.fireEarly(c.InternalKeys.PhoneCountryCache)})):e&&e.language!==p.getLocale()&&m.EnsureStarted(this).then(()=>{d.default.fireEarly(c.InternalKeys.PhoneCountryCache)})}return this._countries}_requestCountryConfig(e,t=!0){return C.default.getConfig(e).then(t=>this._updateData(t,e)).catch(i=>{if(404===i.statusCode&&t){const t=this._getFallbackLocale(e);if(t!==e)return void this._requestCountryConfig(t,!1)}n.isEmpty(this._countries)&&this._loadDataFromBackupFile()})}_loadDataFromBackupFile(){const e=i(3219);this._updateData(e,"en-US")}_getFallbackLocale(e){const t=e&&e.split("-")[0],i=h.getDefaultLocale(t);return`${t}-${S.default.toUpper(i)}`}};a.__decorate([s.autoSubscribe],y.prototype,"getCountries",null),a.__decorate([s.autoSubscribe,a.__param(0,s.key)],y.prototype,"getCountryByCode",null),y=a.__decorate([s.AutoSubscribeStore],y),t.default=new y},2422:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(76),n=i(7),o=i(3),s=i(4),r=i(112),l=i(224),c=i(143),d=i(137),u=i(62);class h extends c.SkypeRestClient{constructor(){super(n.default.getConfigSettingsNoSubscription().registrar.host),this._customErrorHandler=(e,t)=>401===t.statusCode&&t.body&&40102===t.body.code?(s.log(o.LogTraceArea.RegistrarService,"RegistrarClient got 401 w/error code 40102 from request -- nuking skypetoken"),u.default.skypeTokenInvalid(e.getRequestHeaders()["X-Skypetoken"]),a.ErrorHandlingType.DoNotRetry):a.DefaultErrorHandler(e,t),this._defaultOptions.mustHaveValidSkypeToken=!0,this._defaultOptions.customErrorHandler=this._customErrorHandler}_getHeaders(e){const t=super._getHeaders(e);return t["X-Skypetoken"]=u.default.getRawSkypeToken(),t}enumerateRegistrations(){return this.performApiGet(n.default.getConfigSettingsNoSubscription().registrar.registrationRelativeUrl)}postRegistration(e){return l.default.CallingNodeId.waitUntilSet().then(()=>{const t=new d.default(r.ScenarioName.PNH_Post,void 0,{NodeId:l.default.CallingNodeId.get()||""});return t.start(),this.performApiPost(n.default.getConfigSettingsNoSubscription().registrar.registrationRelativeUrl,e).then(()=>t.finish(),e=>t.fail(e.statusCode.toString(),{body:JSON.stringify(e.body),statusText:e.statusText||""}))})}deleteRegistration(e){return l.default.CallingNodeId.waitUntilSet().then(()=>{const t=new d.default(r.ScenarioName.PNH_Delete,void 0,{NodeId:l.default.CallingNodeId.get()||""});t.start();const i=n.default.getConfigSettingsNoSubscription().registrar.registrationRelativeUrl+"/"+e;return this.performApiDelete(i).then(()=>t.finish(),e=>t.fail(e.statusCode.toString(),{body:JSON.stringify(e.body),statusText:e.statusText||""}))})}}t.default=new h},2690:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TransferStatus=t.CallDirection=t.CallType=t.CallState=t.CallSessionType=t.ParticipantType=void 0,function(e){e.Default="default",e.Voicemail="voicemail"}(t.ParticipantType||(t.ParticipantType={})),function(e){e.Default="default",e.ScreenSharing="screenSharing"}(t.CallSessionType||(t.CallSessionType={})),function(e){e.Failed="failed",e.Missed="missed",e.Accepted="accepted",e.Declined="declined",e.AcceptedElsewhere="acceptedElsewhere"}(t.CallState||(t.CallState={})),function(e){e.TwoParty="twoParty",e.MultiParty="multiParty"}(t.CallType||(t.CallType={})),function(e){e.Incoming="incoming",e.Outgoing="outgoing"}(t.CallDirection||(t.CallDirection={})),function(e){e.Transferred="transferred",e.TransferAccepted="transferAccepted",e.TransferFailed="transferFailed",e.TransferSucceeded="transferSucceeded"}(t.TransferStatus||(t.TransferStatus={}))},3169:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LgTmModeElementsManager=t.PresentationModeElementsManager=t.SpeakerModeElementsManager=t.GridModeElementsManager=t.FullScreenBotType=t.StageModeElementsManager=void 0;const a=i(1),n=i(4),o=i(60),s=i(148),r=i(185),l=i(103),c=i(29),d=i(110),u=i(518),h=i(7);class p{constructor(e,t){this._callId=e,this._trayWidth=t,this._filterOutNonDisplayableParticipants=e=>!0}onInit(e){return n.log(r.LogTraceArea.CallingUI,"StageModeElementsManager: initializing participants"),this.updateParticipants(e)}updateParticipants(e){const t=a.filter(e,this._filterOutNonDisplayableParticipants),i=d.CallUIUtils.getOrderedByVideoPresenceParticipants(a.compact(t),this._callId),n=this._getStageParticipants(i),o=a.without(i,...n),s=this._getTrayParticipants(i,n);return{stageParticipants:n,trayParticipants:s,trayRemainder:o.length-s.length}}setTrayWidth(e,t){return this._trayWidth=e,this.updateParticipants(t)}_getTrayParticipants(e,t,i=!1,n=!1){const o=a.without(e,...t);return d.CallUIUtils.getOrderedDisplayedTrayParticipants(o,this._trayWidth,this._callId,i,n)}}var g;t.StageModeElementsManager=p,function(e){e[e.LargeGrid=0]="LargeGrid",e[e.TogetherMode=1]="TogetherMode"}(g=t.FullScreenBotType||(t.FullScreenBotType={}));t.GridModeElementsManager=class extends p{constructor(e,t,i,n,o){super(e,t),this._callId=e,this._trayWidth=t,this._stageCapacity=i,this._onlyVideoOnStage=n,this._showSelfInTheGrid=o,this._filterOutNonDisplayableParticipants=e=>!a.includes(s.default.getNonInteractiveInCallBotMris(),e)}updateStageCapacity(e,t){return n.log(r.LogTraceArea.CallingUI,"GridModeElementsManager.updateStageCapacity to "+t),this._stageCapacity=t,this.updateParticipants(e)}_getStageParticipants(e){if(h.default.getS4LCMCFeatures().enableCallParticipantsPinning&&u.default.hasPinnedParticipants(this._callId))return this._getParticipantsForPinningMode(e);let t=e;this._showSelfInTheGrid||(t=a.without(e,o.CallStageElementKeys.localUserKey));let i=t;return this._onlyVideoOnStage&&(i=a.filter(e,e=>{var t;const i=null===(t=c.default.CallParticipantStore.getParticipantRenderInfo(e,this._callId))||void 0===t?void 0:t.videoStatus;return i===o.VideoStatus.Streaming||i===o.VideoStatus.Available})),a.take(i,this._stageCapacity)}_getParticipantsForPinningMode(e){const t=a.intersection(e,u.default.getPinnedParticipants(this._callId));return a.take(t,this._stageCapacity)}_getTrayParticipants(e,t){const i=a.without(e,...t);return c.default.CallingStore.isOneOnOneCall(this._callId)&&a.remove(i,e=>e===o.CallStageElementKeys.localUserKey),d.CallUIUtils.getOrderedDisplayedTrayParticipants(i,this._trayWidth,this._callId)}};t.SpeakerModeElementsManager=class extends p{constructor(e,t){super(e,t),this._callId=e,this._trayWidth=t,this._filterOutNonDisplayableParticipants=e=>!a.includes(s.default.getNonInteractiveInCallBotMris(),e)&&!a.startsWith(e,l.ScreenSharingPrefix)}_getStageParticipants(e){const t=a.minBy(e,e=>{var t;return null===(t=c.default.CallParticipantStore.getParticipantRenderInfo(e,this._callId))||void 0===t?void 0:t.activeSpeakerRank});return t?[t]:[]}};t.PresentationModeElementsManager=class extends p{constructor(e,t){super(e,t),this._callId=e,this._trayWidth=t,this._filterOutNonDisplayableParticipants=e=>!a.includes(s.default.getNonInteractiveInCallBotMris(),e)}_getStageParticipants(e){const t=a.find(e,e=>a.startsWith(e,l.ScreenSharingPrefix)),i=[];return t&&i.push(t),i}_getTrayParticipants(e,t){return super._getTrayParticipants(e,t,!0,!0)}};t.LgTmModeElementsManager=class extends p{constructor(e,t,i){super(e,t),this._callId=e,this._trayWidth=t,this._botType=i,this._filterOutNonDisplayableParticipants=e=>{const t=this._getBotMrisToFilterOut();return!a.includes(s.default.getNonVisibleInCallBotMris(),e)&&!a.includes(t,e)&&!a.startsWith(e,l.ScreenSharingPrefix)}}_getStageParticipants(e){const t=this._getBotMris(),i=a.find(e,e=>a.includes(t,e)),n=[];return i&&n.push(i),n}_getBotMris(){switch(this._botType){case g.LargeGrid:return s.default.getCallGridViewBotMriFilter();case g.TogetherMode:return s.default.getCallAudienceBotMriFilter()}}_getBotMrisToFilterOut(){switch(this._botType){case g.LargeGrid:return s.default.getCallAudienceBotMriFilter();case g.TogetherMode:return s.default.getCallGridViewBotMriFilter()}}}},3218:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(76),n=i(7),o=i(5);class s extends a.GenericRestClient{constructor(){super(n.default.getConfigSettingsNoSubscription().pstn.host),this._ratesEndpoint=n.default.getConfigSettingsNoSubscription().pstn.ratesEndpoint}getConfig(e){const t=(e||o.getLocale()).toLowerCase()+".json";return this.performApiGet(this._ratesEndpoint+t)}}t.default=new s},3226:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(8),o=i(1133),s=i(3),r=i(4);t.default=new class{shouldPresentScheduleNextCallPanel(e,t,i,n,o){if(!a.isEmpty(t))return r.log(s.LogTraceArea.ScheduleCall,"shouldPresentScheduleNextCallPanel: skipping for "+e.callId+" because other calls are active "+JSON.stringify(t)),!1;const l=e.durationSeconds>o.scheduleNextCallDurationSeconds,c=n>=o.scheduleNextCallFrequency,d=i<o.maxScheduleNextCallDisplays;return!!(l&&c&&d&&e.isCallCreator)}shouldPresentCallQualityFeedbackPanel(e,t,i,l,c){return a.isEmpty(t)?l?(r.log(s.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackPanel:_maybePresentCQF: showing because of forceCQF"),n.Resolved(!0)):o.shouldTriggerForCall(e.callInfo,i,c).then(t=>(t&&r.log(s.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackPanel:_maybePresentCQF: showing for "+e.callInfo.callId+" because of ECS"),t)):(r.log(s.LogTraceArea.CallQualityFeedback,"shouldPresentCallQualityFeedbackPanel: skipping for "+e.callInfo.callId+" because other calls are active "+JSON.stringify(t)),n.Resolved(!1))}shouldPresentPermissionPanel(e,t){return!!a.isEmpty(t)||(r.log(s.LogTraceArea.CallMonitor,"shouldPresentPermissionPanel: skipping for "+e.callId+" because other calls are active "+JSON.stringify(t)),!1)}shouldPresentCallerIdPanel(e){return a.isEmpty(e)}}},3234:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StartCallOptionAction=void 0;const a=i(1),n=i(74),o=i(8),s=i(29),r=i(123),l=i(103),c=i(53),d=i(17),u=i(33),h=i(864),p=i(3),g=i(4),C=i(208),m=i(233),S=i(39),y=i(46);var f;!function(e){e[e.call=0]="call",e[e.promptForAddresses=1]="promptForAddresses",e[e.promptForSkypeMri=2]="promptForSkypeMri",e[e.failed=3]="failed"}(f=t.StartCallOptionAction||(t.StartCallOptionAction={}));const _=new class{startCallOrMaybePromptHelper(e,t,i,s,u,_,b,v){if(!this._releaseAssert(!!e.skypeMri||!a.isEmpty(e.phones),"CallOptionsHelper.startCallOrMaybePromptHelper","Must pass skypeMri or phones"))return r.default.generateCallingError("start","Must pass skypeMri or phones",n.TerminatedReason.BadRequest,n.FailureType.CallSetupFailed,l.CallValidationFailureReason.InvalidParameters),o.Resolved();if(!this._releaseAssert(!e.skypeMri||r.default.isValidCallingMri(e.skypeMri),"CallOptionsHelper.startCallOrMaybePromptHelper","If skypeMri is passed, it must be valid for calling"))return r.default.generateCallingError("start","If skypeMri is passed, it must be valid for calling",n.TerminatedReason.BadRequest,n.FailureType.CallSetupFailed,l.CallValidationFailureReason.InvalidParameters),o.Resolved();const w=(t,a,n)=>{if(!t)return;const o=this._activeCallIdForMri(t,n);return o?e.showCallPreview?s(t,o,a):i(t,o,a):void 0},T=(i,a)=>{w(i,a,v)||(e.initiatingConversation&&d.isEncryptedThread(e.initiatingConversation)&&!d.isEncryptedThread(i)?b(a).then(()=>t(i,a)):t(i,a)),P()},I=e=>T(e,!1),P=()=>{e.onCallStartedAnsweredOrJoined&&e.onCallStartedAnsweredOrJoined()},M=e=>{T(e,!1)};if(w(e.skypeMri,e.userIntent===l.StartCallOrMaybePromptUserIntent.Video,v))return P(),o.Resolved();const k=[!e.skypeMri||d.isThread(e.skypeMri)?o.Resolved(void 0):y.default.getFullUserProfileByMriAsync(e.skypeMri),c.CallingCapabilities.encryptedCallingSupported()&&e.skypeMri&&d.isSkypeIdMri(e.skypeMri)?h.getEstablishedEncryptedThreadId(e.skypeMri):o.Resolved(void 0)];return o.all(k).then(([t,i])=>{let a=m.mergeMriProfileAndExtraPhones(e.skypeMri,void 0,t?t.phones:e.phones);const n=e.skypeMri?C.default.getContactByCorrespondingMri(e.skypeMri):void 0;a=n?m.mergeMriProfileAndExtraPhones(void 0,a,n.phones):a;const o=this._callingOptionsHelper(e.skypeMri,a,e.userIntent,i);switch(o.action){case f.failed:g.error(p.LogTraceArea.Calling,"CallOptionsHelper._callingOptionsHelper failed. skypeMri: "+S.mriOrId(e.skypeMri)+", allPhones: "+a+", userIntent: "+e.userIntent);break;case f.call:if(!o.callMri){g.error(p.LogTraceArea.Calling,"CallOptionsHelper._callingOptionsHelper returned call action with no mri.");break}T(o.callMri,!!o.withVideo);break;case f.promptForSkypeMri:if(!e.skypeMri){g.error(p.LogTraceArea.Calling,"CallOptionsHelper._callingOptionsHelper promptForSkypeMri called with no mri.");break}u(d.isPhoneMri(e.skypeMri)?void 0:e.skypeMri,i,!!o.suppressPromptVideoOption,T,I,M,a,e.showSmsOption);break;case f.promptForAddresses:const n=e.skypeMri?d.getPhoneNumberFromMri(e.skypeMri):void 0,s=n?C.default.getContactByPhoneNumber(n):void 0,r=s?s.getDisplayName():t?t.getDisplayName():"";_(r,a,t&&t.emails)}})}test_callingOptionsHelper(e,t){return this._callingOptionsHelper(e.skypeMri,e.phones,e.userIntent,t)}_callingOptionsHelper(e,t,i,n){const o=a.isEmpty(t)?0:t.length;return!e||d.isPhoneMri(e)?o&&i!==l.StartCallOrMaybePromptUserIntent.Video?i===l.StartCallOrMaybePromptUserIntent.Generic?{action:f.promptForAddresses}:1===o?{action:f.call,withVideo:!1,callMri:d.sanitizeMri(t[0].number,d.Namespaces.PSTN)}:{action:e?f.promptForSkypeMri:f.promptForAddresses}:{action:f.failed}:d.isThread(e)?o?{action:f.failed}:i===l.StartCallOrMaybePromptUserIntent.Generic?{action:f.promptForSkypeMri}:{action:f.call,withVideo:i===l.StartCallOrMaybePromptUserIntent.Video,callMri:e}:d.isUserMri(e)?i===l.StartCallOrMaybePromptUserIntent.Generic?{action:f.promptForSkypeMri}:i===l.StartCallOrMaybePromptUserIntent.Video?{action:f.call,withVideo:!0,callMri:e}:0!==o||n?{action:f.promptForSkypeMri,suppressPromptVideoOption:!0}:{action:f.call,withVideo:!1,callMri:e}:{action:f.failed}}_releaseAssert(e,t,i){return!!e||(g.error(p.LogTraceArea.Calling,S.dev_unknownOmit(t)+": "+S.dev_unknownOmit(i)),!1)}_activeCallIdForMri(e,t){if(!e)return;if(d.isThread(e)){const i=u.default().getConversation(e);if(!i){const i="CallOptionsHelper._activeCallIdForMri: Didn't find conversation";return g.warn(p.LogTraceArea.Calling,i+" "+S.mriOrId(e)+" causeId: "+t),void r.default.generateCallingError("answerOrJoin",i,n.TerminatedReason.BadRequest,n.FailureType.CallSetupFailed,l.CallValidationFailureReason.ConversationNotFound)}const a=i.validLiveState();return a&&a.conversationId}const i=s.default.CallingStore.getCallIdsForConversationMri(e);return a.head(i)}};t.default=_},3237:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.compileCallRateLabel=void 0;const a=i(7),n=i(531),o=i(343),s=i(5);t.compileCallRateLabel=function(e){let t=void 0;switch(e.callFundedBy){case o.CallRateFundingSource.Credit:e.price&&e.currency&&(t=s.getString("CallOptionsMenu.CallFundedBy_Credit",{price:n.getFormattedRate(e.price,e.currency,3)}));break;case o.CallRateFundingSource.CallingPlan:t=s.getString("CallOptionsMenu.CallFundedBy_CallingPlan");break;case o.CallRateFundingSource.FreeCall:t=s.getString("CallOptionsMenu.CallFundedBy_FreeCall");break;case o.CallRateFundingSource.TasterCall:t=s.getString("CallOptionsMenu.CallFundedBy_TasterCall",{numberOfMinutes:a.default.getS4LEntitlementFeatures().SCE.CallRates.TasterCallMaxDurationMinutes});break;case o.CallRateFundingSource.NoFunding:t=s.getString("CallOptionsMenu.CallFundedBy_NoFunding")}return t}},3238:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(1592),o=i(253),s=i(3),r=i(4),l=i(21),c=i(20);class d extends n.BaseEntitlementsClient{getRates(e){const t=Date.now(),i=l.default.getSkypeId(),n="users/"+encodeURIComponent(i)+"/call-rates?Platform="+c.default.getSkypePlatformId()+a.map(e,(e,t)=>"&callNumbers["+t+"]="+encodeURIComponent(e)).join("");r.log(s.LogTraceArea.EntitlementsClient,"Performing call to ConsumerEntitlement: GET Call Rates");return this._performRequest(n,{acceptType:"application/json; ver=1.0"}).then(e=>{let i=a.keyBy(e.body,e=>e.pstnNumber);return r.track(new o.RatesFetching(Date.now()-t)),i})}}t.default=new d},324:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(57),s=i(7),r=i(60),l=i(47),c=i(203),d=i(104),u=i(32),h=i(152),p=i(3),g=i(4),C=i(5),m=i(52),S=i(21),y=i(19),f=i(448),_=i(28),b=["cid","sender","receivers","message"];class v{static imageForSticker(e){switch(e.toLowerCase()){case"sticker1":return o.Collection.CAPTURE_STICKER1;case"sticker8":return o.Collection.CAPTURE_STICKER8;case"sticker17":return o.Collection.CAPTURE_STICKER17;case"sticker20":return o.Collection.CAPTURE_STICKER20;case"sticker22":return o.Collection.CAPTURE_STICKER22;case"sticker29":return o.Collection.CAPTURE_STICKER29;case"sticker31":return o.Collection.CAPTURE_STICKER31;case"sticker32":return o.Collection.CAPTURE_STICKER32;case"sticker33":default:return o.Collection.CAPTURE_STICKER33}}static stickerKeyForText(e){switch(e){case"omg":return"STICKER31";case"snap":return"STICKER33";case"awesome":return"STICKER8";case"BRB":return"STICKER1";case"hello":return"STICKER29";case"oops":return"STICKER22";case"yes":return"STICKER17";case"ouch":return"STICKER20";case"wow":return"STICKER32"}}static textForImageSticker(e){switch(e){case"STICKER31":return"omg";case"STICKER33":return"snap";case"STICKER8":return"awesome";case"STICKER1":return"BRB";case"STICKER29":return"hello";case"STICKER22":return"oops";case"STICKER17":return"yes";case"STICKER20":return"ouch";case"STICKER32":return"wow"}}static localizedAccessibilityTextForImageSticker(e){switch(e){case"STICKER31":return C.getString("Sticker.OMGAccessibilityLabel");case"STICKER33":return C.getString("Sticker.SnapAccessibilityLabel");case"STICKER8":return C.getString("Sticker.AwesomeAccessibilityLabel");case"STICKER1":return C.getString("Sticker.BRBAccessibilityLabel");case"STICKER29":return C.getString("Sticker.HelloAccessibilityLabel");case"STICKER22":return C.getString("Sticker.OopsAccessibilityLabel");case"STICKER17":return C.getString("Sticker.YesAccessibilityLabel");case"STICKER20":return C.getString("Sticker.OuchAccessibilityLabel");case"STICKER32":return C.getString("Sticker.WowAccessibilityLabel")}}static messageToReactionsEmoticonLocalizedAccesssibilityString(e){const t=e.getEmoticonCallReactionKey();return t?this.localizedAccessibilityTextForEmoticon(t):void 0}static localizedAccessibilityTextForEmoticon(e){const t=h.default.getEmoticonByNameNoSubscription(e);return(null==t?void 0:t.description)||e}static isAnimationReaction(e){return"cake"===e}static isSuperAnimationReaction(e){return a.includes(s.default.getS4LCMCFeatures().callAnimatedReactionsConfig.callAnimatedReactionsKeys,e)}static superAnimationReactionsNumber(e){let t=0;return a.each(e,e=>{this.isSuperAnimationReaction(e)&&t++}),t}static isTranscriptionReaction(e){const t=y.default.parseJsonErrorToUndefined(e.content);return t&&a.every(b,e=>e in t)}static isCallEventReaction(e){const t=d.decode(e),i=a.last(t.children);if(!i.getInternalType)return!1;const n=i.getInternalType()&&i.getInternalType()||_.ReactionsTextType.Default;return!!i.getUserMri()&&a.includes([_.ReactionsTextType.CallEventMuted,_.ReactionsTextType.CallEventKickedOut],n)}static animationInfoForKey(e,t){switch(e){case"beer":return f.default.BEER;case"cake":return t?f.default.CELEBRATION_ICBC:f.default.CELEBRATION_ICBC_PORTRAIT;case"clap":return f.default.CLAP;case"daffyduck":return f.default.DAFFYDUCK;case"fire":return f.default.FIRE;case"heart":return f.default.HEART;case"laugh":return f.default.LAUGH;case"lebronjames":return f.default.LEBRONJAMES;case"lolabunny":return f.default.LOLABUNNY;case"penguin":return f.default.PENGUIN;case"sad":return f.default.SAD;case"sarcastic":return f.default.SARCASTIC;case"surprised":return f.default.SURPRISED;case"yes":return f.default.YES}}static announceReaction(e){const t=u.default.getDisplayableProfile(e.creator);let i,o,s=!0;if(e.isEmoticonCallReaction())i=v.messageToReactionsEmoticonLocalizedAccesssibilityString(e);else{const t=d.decode(e),n=a.last(t.children),r=a.first(t.children);if(o=n.getStyle?n.getStyle():void 0,o===_.ReactionsTextStyle.Sticker){if(r.getRawText?r.getRawText():void 0){const e=v.stickerKeyForText(r.getRawText());i=e&&v.localizedAccessibilityTextForImageSticker(e)}}else{if(r.children.length){const e=a.first(r.children);e.getRawText&&(i=e.getRawText())}else r.getRawText&&(i=r.getRawText());s=!1}}if(i){if(s){let e;e=o===_.ReactionsTextStyle.Snapshot?i:C.getString("AccessibilityLabel.Reactions1User",{firstUser:t.getShortName(),reactionName:i}),n.Accessibility.announceForAccessibility(e)}}else g.warn(p.LogTraceArea.CallReactions,"ReactionsEmojiStream._updateReactionsAndReturnState Unsupported reaction emoticon/sticker or empty text")}static callReactionInfoForReaction(e){const t=d.decode(e),i=a.last(t.children),n=l.getMessageTypeGroup(e),o=i.getStyle&&i.getStyle()||_.ReactionsTextStyle.Default;let s;if(!e.isEmoticonCallReaction()&&n===l.MessageTypeGroups.Text){const i=a.first(t.children);let n;if(i.children.length){const e=a.first(i.children);e.getRawText&&(n=e.getRawText())}else i.getRawText&&(n=i.getRawText());if(o===_.ReactionsTextStyle.Sticker&&n){const e=v.stickerKeyForText(n);e&&(s=v.imageForSticker(e))}else if(o===_.ReactionsTextStyle.Snapshot){const t=u.default.getDisplayableProfile(e.creator);s=C.getString("CallPanel.SnapshotNotification",{name:t.getShortName()})}else s=n}const r=S.default.isMyMri(e.creator);return{reaction:e,reactionsTextStyle:o,gradientColors:r?m.default.getGradientColors():c.default.getGradientColors(e.creator),isLocal:r,content:s}}static parseCallEventReaction(e){const t=d.decode(e),i=a.last(t.children);if((i.getStyle&&i.getStyle()||_.ReactionsTextStyle.Default)===_.ReactionsTextStyle.CallEvent){const t=i.getInternalType()&&i.getInternalType()||_.ReactionsTextType.Default,a=i.getUserMri();if(a)return{mri:e.creator,actionMri:a,eventType:t}}}}t.default=v,v.reactionItems=[{key:"heart",type:r.ReactionsItemType.Emoticon},{key:"STICKER32",type:r.ReactionsItemType.Sticker},{key:"cwl",type:r.ReactionsItemType.Emoticon},{key:"STICKER8",type:r.ReactionsItemType.Sticker},{key:"sad",type:r.ReactionsItemType.Emoticon}]},3247:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DialerSearchUtils=void 0;const a=i(1);t.DialerSearchUtils=class{static sortByDisplayName(e){return a.sortBy(a.values(e),e=>e.contact.displayName)}static getSearchCriteria(e,t=!1){return 0!==e.inputValue.indexOf("+")&&t||a.isEmpty(e.E164)?e.inputValue:e.E164}}},325:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerKeys=void 0;const a=i(25),n=i(1),o=i(15),s=i(8),r=i(61),l=i(47),c=i(49),d=i(3),u=i(4),h=i(21),p=i(324),g=i(39),C=i(22);!function(e){e[e.EventReactions=0]="EventReactions"}(t.TriggerKeys||(t.TriggerKeys={}));let m=class extends o.StoreBase{constructor(){super(),this._reactionGroups={},this._outerToInnerThreadMap={},this._isAnimationPlaying=!1,C.RegisterStartupable(this,"CallReactionsStore",[r.default])}startup(){return s.Resolved()}destroy(){this._messagesUpdatedSubscriptionToken&&(this._messagesUpdatedSubscriptionToken.unsubscribe(),this._messagesUpdatedSubscriptionToken=void 0)}_startedTrackingKey(e){u.log(d.LogTraceArea.CallReactions,"CallReactionsStore._startedTrackingKey, reactionsConversationMri: "+g.mriOrId(e)),this._reactionGroups[e]||(this._reactionGroups[e]=this._newCallReactionsGroup()),c.default.getMessagesInConversation(e).then(t=>{t.length&&this._reactionGroups[e]&&this._putInnerOrOuterThreadReactions(e,t)}),this._messagesUpdatedSubscriptionToken||(this._messagesUpdatedSubscriptionToken=r.default.messagesProcessed.subscribe(e=>{const t=n.filter(e,e=>!!this._reactionGroups[e.conversationId]||!!this._outerToInnerThreadMap[e.conversationId]),i=n.groupBy(t,e=>e.conversationId);n.each(i,(e,t)=>{this._putInnerOrOuterThreadReactions(t,e)})}))}_stoppedTrackingKey(e){const t=this._reactionGroups[e];t&&t.outerThreadMri&&this._clearOuterThreadAssignment(e,t.outerThreadMri)}assignOuterThread(e,t){if(u.log(d.LogTraceArea.CallReactions,"CallReactionsStore.assignOuterThread, outerThreadMri: "+g.mriOrId(t)+" innerThreadMri: "+g.mriOrId(e)),this._outerToInnerThreadMap[t]||(this._outerToInnerThreadMap[t]=[]),n.includes(this._outerToInnerThreadMap[t],e)||this._outerToInnerThreadMap[t].push(e),this._reactionGroups[e]){const i=this._reactionGroups[e].outerThreadMri;i&&i!==t&&this._clearOuterThreadAssignment(e,i)}else this._reactionGroups[e]=this._newCallReactionsGroup();this._reactionGroups[e].outerThreadMri=t}clearOuterThreadAssignment(e,t){u.log(d.LogTraceArea.CallReactions,"CallReactionsStore.clearOuterThreadAssignment, outerThreadMri: "+g.mriOrId(t)+" innerThreadMri: "+g.mriOrId(e)),this._clearOuterThreadAssignment(e,t)}setReactionPressedScenario(e){this._reactionPressedScenario=e}maybeGetAndClearReactionPressedScenario(){const e=this._reactionPressedScenario;return this._reactionPressedScenario=void 0,e}setHasPostedReactions(e,t){const i=this._reactionGroups[e];i&&i.hasPostedReactions!==t&&(i.hasPostedReactions=t,t&&this._triggerForMri(e))}getUnseenIncomingTextCount(e){const t=this._reactionGroups[e];return t?t.unseenIncomingTextCount:0}resetUnSeenIncomingTextCount(e){let t=this._reactionGroups[e];t&&(t.unseenIncomingTextCount=0),this._triggerForMri(e)}getUnseenIncomingPhotoCount(e){const t=this._reactionGroups[e];return t?t.unseenIncomingPhotoCount:0}resetUnSeenIncomingPhotoCount(e){let t=this._reactionGroups[e];t&&(t.unseenIncomingPhotoCount=0),this._triggerForMri(e)}markOneIncomingPhotoSeen(e){let t=this._reactionGroups[e];t&&t.unseenIncomingPhotoCount>0&&t.unseenIncomingPhotoCount--,this._triggerForMri(e)}getUnseenIncomingTranscriptionCount(e){const t=this._reactionGroups[e];return t?t.unseenIncomingTranscriptionCount:0}resetUnseenIncomingTranscriptionCount(e){let t=this._reactionGroups[e];t&&(t.unseenIncomingTranscriptionCount=0),this._triggerForMri(e)}getUnseenIncomingEventsCount(e){const t=this._reactionGroups[e];return t?t.unseenIncomingEventsCount:0}resetUnseenIncomingEventsCount(e){let t=this._reactionGroups[e];t&&(t.unseenIncomingEventsCount=0),this._triggerForMri(e)}hasPostedReactions(e){const t=this._reactionGroups[e];return!!t&&t.hasPostedReactions}getReactions(e,t=0){const i=this._reactionsInfoForThreadMri(e);return i&&i.allReactions.length?n.filter(i.allReactions,(e,i)=>e.createdTime>t&&!e.isEmoticonCallReaction()):[]}getTextReactions(e,t=0){const i=this._reactionsInfoForThreadMri(e);return i&&i.textReactions.length?t>0?n.filter(i.textReactions,(e,i)=>e.createdTime>t):i.textReactions:[]}getLastReaction(e,t=0){const i=this._reactionsInfoForThreadMri(e);if(!i||!i.textReactions.length)return;const a=n.last(i.textReactions);return a&&a.createdTime>t?a:void 0}getPictureReactions(e,t=0,i=!1){const a=this._reactionsInfoForThreadMri(e);return a&&a.photoReactions.length?t>0||i?n.filter(a.photoReactions,(a,n)=>!(a.createdTime<=t)&&(!i||a.conversationId===e)):a.photoReactions:[]}getLastTranscriptionReaction(e,t=0){const i=this._reactionsInfoForThreadMri(e);if(!i||!i.transcriptionReactions.length)return;const a=n.last(i.transcriptionReactions);return a&&a.createdTime>t?a:void 0}getLastTranscriptionReactions(e,t=0){const i=this._reactionsInfoForThreadMri(e);return i&&i.transcriptionReactions.length?n.filter(i.transcriptionReactions,e=>e.createdTime>t):[]}getEventsReaction(e,t=0){const i=this._reactionsInfoForThreadMri(e);return i&&i.eventReactions.length?t>0?n.filter(i.eventReactions,(i,a)=>!(i.createdTime<=t)&&i.conversationId===e):i.eventReactions:[]}getLastEventReaction(e,t=0){const i=this._reactionsInfoForThreadMri(e);if(!i||!i.eventReactions.length)return;const a=n.last(i.eventReactions);return a&&a.createdTime>t?a:void 0}_clearOuterThreadAssignment(e,t){if(this._outerToInnerThreadMap[t]){const i=this._outerToInnerThreadMap[t];n.remove(i,t=>t===e),n.isEmpty(i)&&delete this._outerToInnerThreadMap[t]}}_putInnerOrOuterThreadReactions(e,t){const i=this._innerThreadMris(e),a=n.filter(i,e=>this._putReactions(e,t));this.trigger(a)}_putReactions(e,t){const i=this._reactionGroups[e];if(!i)return!1;let a=!1;return n.each(t,t=>{if(t.isDeletedMessage())i.callReactionsInfo.allReactions=n.filter(i.callReactionsInfo.allReactions,e=>e.cuid!==t.cuid),i.callReactionsInfo.photoReactions=n.filter(i.callReactionsInfo.photoReactions,e=>e.cuid!==t.cuid),i.callReactionsInfo.textReactions=n.filter(i.callReactionsInfo.textReactions,e=>e.cuid!==t.cuid),i.callReactionsInfo.transcriptionReactions=n.filter(i.callReactionsInfo.transcriptionReactions,e=>e.cuid!==t.cuid),i.callReactionsInfo.eventReactions=n.filter(i.callReactionsInfo.eventReactions,e=>e.cuid!==t.cuid);else{if(this._maybeUpdateReactionMessage(t,e))return;if(l.getMessageTypeGroup(t)===l.MessageTypeGroups.Picture)i.callReactionsInfo.photoReactions.push(t),h.default.isMyMri(t.creator)||i.unseenIncomingPhotoCount++;else{if(l.getMessageTypeGroup(t)!==l.MessageTypeGroups.Text)return;l.isCaptionMessageType(t.messagetype)?(i.callReactionsInfo.transcriptionReactions.push(t),i.unseenIncomingTranscriptionCount++):p.default.isCallEventReaction(t)?(i.callReactionsInfo.eventReactions.push(t),i.unseenIncomingEventsCount++):(i.callReactionsInfo.textReactions.push(t),t.isEmoticonCallReaction()||i.unseenIncomingTextCount++)}i.callReactionsInfo.allReactions.push(t)}a=!0}),u.log(d.LogTraceArea.CallReactions,"CallReactionsStore._putReactions, triggering changes: "+a+" innerThreadMri: "+g.mriOrId(e)+" unseenIncomingPhotoCount: "+i.unseenIncomingPhotoCount+" unseenIncomingTextCount: "+i.unseenIncomingTextCount),a}setAnimationIsPlaying(e){this._isAnimationPlaying=e}isAnimationPlaying(){return this._isAnimationPlaying}_maybeUpdateReactionMessage(e,t){const i=this._reactionsInfoForThreadMri(t);return!!i&&(!!this._replaceReactionMessage(e,i.allReactions)&&(l.getMessageTypeGroup(e)===l.MessageTypeGroups.Picture?this._replaceReactionMessage(e,i.photoReactions):l.getMessageTypeGroup(e)===l.MessageTypeGroups.Text&&(l.isCaptionMessageType(e.messagetype)?this._replaceReactionMessage(e,i.transcriptionReactions):p.default.isCallEventReaction(e)?this._replaceReactionMessage(e,i.eventReactions):this._replaceReactionMessage(e,i.textReactions)),!0))}_replaceReactionMessage(e,t){let i=n.findIndex(t,t=>t.cuid===e.cuid);return i>=0&&(t.splice(i,1,e),!0)}_newCallReactionsGroup(){return{callReactionsInfo:{allReactions:[],photoReactions:[],textReactions:[],transcriptionReactions:[],eventReactions:[]},unseenIncomingPhotoCount:0,unseenIncomingTextCount:0,unseenIncomingTranscriptionCount:0,unseenIncomingEventsCount:0,hasPostedReactions:!1}}_reactionsInfoForThreadMri(e){const t=this._reactionGroups[e];if(t&&t.callReactionsInfo)return t.callReactionsInfo}_innerThreadMris(e){return this._reactionGroups[e]?[e]:this._outerToInnerThreadMap[e]||[]}_triggerForMri(e){const t=n.uniq(this._innerThreadMris(e));this.trigger(t)}test_putInnerOrOuterThreadReactions(e,t){this._putInnerOrOuterThreadReactions(e,t)}test_reset(){this._reactionGroups={},this._outerToInnerThreadMap={}}};a.__decorate([o.disableWarnings],m.prototype,"_startedTrackingKey",null),a.__decorate([o.disableWarnings],m.prototype,"_stoppedTrackingKey",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],m.prototype,"getUnseenIncomingTextCount",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],m.prototype,"getUnseenIncomingPhotoCount",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],m.prototype,"getUnseenIncomingTranscriptionCount",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],m.prototype,"getUnseenIncomingEventsCount",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],m.prototype,"hasPostedReactions",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],m.prototype,"getReactions",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],m.prototype,"getTextReactions",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],m.prototype,"getLastReaction",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],m.prototype,"getPictureReactions",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],m.prototype,"getLastTranscriptionReaction",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],m.prototype,"getLastTranscriptionReactions",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],m.prototype,"getEventsReaction",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],m.prototype,"getLastEventReaction",null),a.__decorate([o.autoSubscribe],m.prototype,"isAnimationPlaying",null),m=a.__decorate([o.AutoSubscribeStore],m),t.default=new m},3263:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(8),o=i(7),s=i(47),r=i(17),l=i(49),c=i(3),d=i(231),u=i(496),h=i(4),p=i(22),g=i(19);t.default=new class{constructor(){this._isCleanupInProgress=!1,this._doCallCaptionsCleanup=()=>(u.default.queueIdleTask("Scheduling call captions cleanup",u.TaskTypeFlags.CpuIntensive|u.TaskTypeFlags.UsesNetworking,()=>{try{return o.default.getS4LCMCFeaturesNoSubscription().isCallCaptionsCleanupEnabled?l.default.getLastCallCaptionsCleanupTimestamp().then(this._isCallCaptionsCleanupRequired).then(this._cleanupCallCaptions).catch(e=>{h.track(new d.FundamentalsDebugEvent("CallCaptionsCleanupFailure","FailureInPromise")),this._logError("Call captions cleanup failed. Error: "+g.default.errorAsString(e))}):(this._logInfo("Call captions cleanup disabled."),n.Resolved())}catch(e){return h.track(new d.FundamentalsDebugEvent("CallCaptionsCleanupFailure","FailureInWrapperCatch")),this._logError("Call captions cleanup failed. Error: "+g.default.errorAsString(e)),n.Rejected()}}),n.Resolved()),this._isCallCaptionsCleanupRequired=e=>{if(this._isCleanupInProgress)return!1;if(!e)return h.track(new d.FundamentalsDebugEvent("CallCaptionsCleanupStarted","FirstRun")),this._logInfo("Call captions cleanup not yet done."),!0;return!!(e<this._parseCleanupValidTimestamp())&&(h.track(new d.FundamentalsDebugEvent("CallCaptionsCleanupStarted","Expired")),this._logInfo("Call captions cleanup expired. Need for another cleanup."),!0)},this._parseCleanupValidTimestamp=()=>{const e=o.default.getS4LCMCFeaturesNoSubscription().callCaptionsCleanupValidDate;let t=Date.parse(e);return isNaN(t)?0:t},this._cleanupCallCaptions=e=>e?(this._isCleanupInProgress=!0,n.all([this._setCaptionsCleanupStartTimestamp(),this._processCaptionsCleanup(),this._processConversationCleanup()]).then(this._completeCleanup)):(this._logInfo("Call captions - cleanup valid. No need for another cleanup."),n.Resolved()),this._setCaptionsCleanupStartTimestamp=()=>l.default.openTransaction([l.Stores.InternalData],!0).then(e=>e.getCallCaptionsCleanupStartTimestamp().then(t=>t?n.Resolved():e.setCallCaptionsCleanupStartTimestamp()).then(()=>e.markCompleted(),e=>{this._logError("Call captions - Set startTimestamp failed. Error: "+g.default.errorAsString(e))})),this._processCaptionsCleanup=()=>{const e=n.Defer(),t=o.default.getS4LCMCFeaturesNoSubscription().callCaptionsCleanupBatchSize;return this._cleanMessageCaptionsAsync(e,0,t),e.promise()},this._cleanMessageCaptionsAsync=(e,t,i)=>{u.default.queueIdleTask("Clean Messages startIndex: "+t,u.TaskTypeFlags.CpuIntensive|u.TaskTypeFlags.UsesNetworking,()=>{l.default.getAllMessages(i,t).then(n=>{if(0===n.length)return this._logInfo("Call captions - cleanup finished"),void e.resolve();const o=this._filterCallCaptionMessageType(n);if(a.isEmpty(o)){const a=t+i;this._logInfo("Call captions - 0 to delete. Moving offset to "+a),this._cleanMessageCaptionsAsync(e,a,i)}else this._removeCaptions(o).then(()=>{let a=t+(i-o.length);a<0&&(a=0),this._logInfo(`Call captions - ${o.length} deleted. Moving offset to ${a}`),this._cleanMessageCaptionsAsync(e,a,i)})})})},this._processConversationCleanup=()=>{const e=n.Defer(),t=o.default.getS4LCMCFeaturesNoSubscription().callCaptionsCleanupBatchSize;return this._cleanConversationsAsync(e,0,t),e.promise()},this._cleanConversationsAsync=(e,t,i)=>{l.default.getAllConversationMetas(i,t).then(n=>{if(0===n.length)return this._logInfo("Conversations - lastMessage captions cleanup finished."),void e.resolve();u.default.queueIdleTask("Clean conversation last message startIndex: "+t,u.TaskTypeFlags.CpuIntensive|u.TaskTypeFlags.UsesNetworking,()=>{const o=this._filterCallCaptionConversationType(n);a.isEmpty(o)?this._cleanConversationNext(e,t,i,0):this._cleanConversationsLastMessage(o).then(()=>{this._cleanConversationNext(e,t,i,o.length)})})})},this._filterCallCaptionMessageType=e=>{const t=a.filter(e,e=>s.isCaptionMessageType(e.messagetype));return this._logInfo("Call captions - filtering captions message type. Found "+t.length+" captions."),t},this._filterCallCaptionConversationType=e=>{const t=a.filter(e,e=>r.isReactionsThread(e.conv.id)&&!!e.conv.lastMessage&&s.isCaptionMessageType(e.conv.lastMessage.messagetype));return this._logInfo(`Conversations - filtering caption conversation type. Found ${t.length} captions conversations.`),t},this._removeCaptions=e=>l.default.openTransaction([l.Stores.Messages],!0).then(t=>t.removeMessages(e).then(()=>{t.markCompleted(),this._logInfo("Call captions - remove batch finished.")},e=>(this._logError("Call captions - remove batch failed. Error: "+g.default.errorAsString(e)),n.Rejected(e)))),this._cleanConversationsLastMessage=e=>(e=a.map(e,e=>e.updateConversation(e.conv.dropLastMessage())),l.default.openTransaction([l.Stores.Conversations],!0).then(t=>t.putConversationMetas(e).then(()=>{t.markCompleted(),this._logInfo("Conversations - update batch finished.")},e=>(this._logError("Conversations - update batch failed. Error: "+g.default.errorAsString(e)),n.Rejected(e))))),this._completeCleanup=()=>l.default.openTransaction([l.Stores.InternalData],!0).then(e=>e.getCallCaptionsCleanupStartTimestamp().then(e=>{if(e){const t=Date.now()-e;h.track(new d.FundamentalsDebugEvent("CallCaptionsCleanupTime",t.toString())),this._logInfo(`Captions and conversations cleanup execution time: ${t}ms.`)}}).then(()=>e.deleteCallCaptionsCleanupStartTimestamp()).then(()=>e.setCallCaptionsCleanupEndTimestamp()).then(()=>{this._isCleanupInProgress=!1,e.markCompleted(),this._logInfo("Captions and conversations cleanup finished.")},e=>(this._logError("Captions and conversations cleanup failed. Error: "+g.default.errorAsString(e)),n.Rejected(e)))),this._logInfo=e=>{h.log(c.LogTraceArea.GenericUnsafe,"[CaptionsCleanup] "+e)},this._logError=e=>{h.error(c.LogTraceArea.GenericUnsafe,"[CaptionsCleanup] "+e)},this.test_doCallCaptionsCleanup=()=>this._doCallCaptionsCleanup(),p.RegisterStartupable(this,"CallCaptionsCleanupService")}startup(){return o.default.subscribe(this._doCallCaptionsCleanup),this._doCallCaptionsCleanup(),n.Resolved()}_cleanConversationNext(e,t,i,a){const n=t+i;this._logInfo(`Conversations - ${a} updated. Moving offset to ${n}`),this._cleanConversationsAsync(e,n,i)}}},3264:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(1590),o=i(8),s=i(7),r=i(29),l=i(17),c=i(13),d=i(375),u=i(3),h=i(4),p=i(207),g=i(18),C=i(102),m=i(205),S=i(22),y=i(19),f=i(10);t.default=new class{constructor(){this._processIntentEvent=e=>{const t=f.default.newCauseId();h.log(u.LogTraceArea.DialerPanel,`CallIntentService._processIntentEvent eventType=${e.type} causeId: ${t}`),e.number&&a.startsWith(e.number,"tel:")&&(e.number=e.number.replace("tel:",""));const i=e.number&&y.default.safeDecodeURIComponent(e.number),o=C.default.isPossiblyPhoneNumber(i)?e.number:void 0;if(e.type===n.IntentEventType.contactMessage&&e.skypeId){const i=l.sanitizeMri(e.skypeId,l.Namespaces.SkypeId);g.default.navigateToConversation({convId:i,causeId:t,origin:u.NavigationConversationOrigin.NativeContactIntent})}else if(e.type!==n.IntentEventType.contactAudio&&e.type!==n.IntentEventType.contactVideo||!e.skypeId)if(e.type===n.IntentEventType.contactPhone&&i&&o&&(d.default.isE164Format(i)||s.default.getS4LCommerceFeatures().callIntent.allowNonE164NumberCalls)){m.default.initializeCountrySelection(),m.default.overwritePhoneNumberInput(o,!1);const e=m.default.getPhoneNumber(m.TriggerKeys.E164),i=l.sanitizeMri(e.E164,l.Namespaces.PSTN);r.default.CallNavigationHelper.startCall({conversationMri:i,withVideo:!1,origin:u.NavigationCallOrigin.NativeContactIntent},t)}else g.default.navigateToPSTNDialerWithParams({causeId:t,navigationSource:u.DialerNavigationSource.CallIntent,prefilledNumber:o},c.MainRootViewId);else{const i=l.sanitizeMri(e.skypeId,l.Namespaces.SkypeId);r.default.CallNavigationHelper.startCall({conversationMri:i,withVideo:"contactVideo"===e.type,origin:u.NavigationCallOrigin.NativeContactIntent},t)}},S.RegisterStartupable(this,"CallIntentService"),p.default.registerForLogout(this,"CallIntentService")}startup(){return n.default.setListener(this._processIntentEvent),o.Resolved()}test_processIntentEvent(e){this._processIntentEvent(e)}logout(e,t,i){return n.default.removeListener(),o.Resolved()}}},3265:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(8),s=i(96),r=i(7),l=i(3266),c=i(695),d=i(17),u=i(49),h=i(33),p=i(70),g=i(144),C=i(3),m=i(3),S=i(156),y=i(160),f=i(4),_=i(75),b=i(37),v=i(64),w=i(21),T=i(596),I=i(352),P=i(22),M=i(19),k=i(46),A=i(10);t.default=new class{constructor(){this._cachedUserProfilesDict={},this._didShowNotification=!1,this._didIdentifyDifferentTopContacts=!1,this._topContactsWithBirthday=[],this._activationStateChangedSubscribeCallback=()=>{const e=n.App.getActivationState()===n.Types.AppActivationState.Active;this._isAppActive!==e&&(f.log(C.LogTraceArea.Engagement,"Active state changed to "+n.Types.AppActivationState[n.App.getActivationState()]),this._isAppActive=e,this._appConfigStoreSubscribeCallback())},this._appConfigStoreSubscribeCallback=()=>{this._initServiceConfig(),this._isFeatureEnabled?this._usersStoreSubscriptionToken||(this._usersStoreSubscriptionToken=k.default.subscribe(e=>{this._tryCreateBirthdayNotification(e)}),f.log(C.LogTraceArea.Engagement,"Subscribed to UsersStore, _usersStoreSubscriptionToken: "+(this._usersStoreSubscriptionToken?"1":"0"))):(f.log(C.LogTraceArea.Engagement,"CelebrationNotificationService disabled. Disabling subscriptions"),this._usersStoreSubscriptionToken&&(k.default.unsubscribe(this._usersStoreSubscriptionToken),this._usersStoreSubscriptionToken=void 0))},this._tryCreateBirthdayNotification=e=>{if(!this._isFeatureEnabled)return f.log(C.LogTraceArea.Engagement,"Birthday notification feature is not enabled. Skipping scheduling"),o.Resolved();if(this._didShowNotification)return f.log(C.LogTraceArea.Engagement,"Birthday notification already created. Skipping scheduling"),o.Resolved();let t;const i=this._getAllContactsMrisEnabled?this.getAllContacts():this.getFavoriteAndSuggestedContacts();return t=e?a.intersection(e,a.keys(this._cachedUserProfilesDict)):i.favoriteContactsMris.concat(i.nonFavoriteSuggestedContactsMris),this.fetchUserProfiles(t).then(()=>{const e=this.getTopContactMrisWithBirthdaysToday(i);if(a.isUndefined(this._topContactsWithBirthday)||this._topContactsWithBirthday.length<=0)return f.log(C.LogTraceArea.Engagement,"Identified contacts with birthday during first run. Scheduling birthday notification"),this.maybeCreateBirthdayLocalEngagementNotification(e);const t=e[0],n=this._topContactsWithBirthday[0];return t&&t!==n?(f.log(C.LogTraceArea.Engagement,"Identified new contacts with birthday. Scheduling birthday notification"),this.maybeCreateBirthdayLocalEngagementNotification(e)):o.Resolved()})},P.RegisterStartupable(this,"CelebrationNotificationService",[h.default,y.default,_.default,v.default,k.default,T.default])}startup(){return this._initAppStateConfig(),this._appStateSubscription=s.default.subscribeForChanges("CelebrationNotificationService",this._activationStateChangedSubscribeCallback),this._appConfigStoreSubscription=r.default.subscribe(this._appConfigStoreSubscribeCallback),this._appConfigStoreSubscribeCallback(),y.default.setRefreshOptions("CelebrationNotification",{interval:this._refreshTime,taskTypeFlags:y.TaskTypeFlags.UsesNetworking,callback:()=>this._tryCreateBirthdayNotification()}),this._isFeatureEnabled&&S.default.queueIdleTask("CelebrationNotificationService",y.TaskTypeFlags.CpuIntensive,this._tryCreateBirthdayNotification),o.Resolved()}logout(e,t,i){return f.log(C.LogTraceArea.Engagement,"Logout action triggered for CelebrationNotificationService"),this._usersStoreSubscriptionToken&&(k.default.unsubscribe(this._usersStoreSubscriptionToken),this._usersStoreSubscriptionToken=void 0),this._searchStore&&(this._searchStore.destroy(),this._searchStore=void 0),this._didShowNotification=!1,this._topContactsWithBirthday=[],a.each(this._cachedUserProfilesDict,(e,t)=>{e&&delete this._cachedUserProfilesDict[t]}),f.log(C.LogTraceArea.Engagement,"Cleared local cache of user profiles in CelebrationNotificationService"),o.Resolved()}_initAppStateConfig(){this._isAppActive=n.App.getActivationState()===n.Types.AppActivationState.Active}_initServiceConfig(){const e=r.default.getEngagementFeatures().engagementCelebrationNotificationSetting,t=r.default.getSkypeEngagementFeatures().birthdayContent;f.log(C.LogTraceArea.Engagement,"initServiceConfig callback executed, given featureSettings: "+JSON.stringify(e)+"given birthdayContent: "+JSON.stringify(t)),this._campaignId=t.campaignId,this._variantId=t.variantId,this._isFeatureEnabled=e.enabled,this._refreshTime=e.refreshTime,this._celebrationNotificationsTopContactCutOff=e.celebrationNotificationsTopContactCutOff,this._isThrottlingOnRoamingSettingsEnabled=e.isThrottlingOnRoamingSettingsEnabled,this._isThrottlingOnLocalSettingsEnabled=e.isThrottlingOnLocalSettingsEnabled,this._isContactCutOffEnabled=e.isContactCutOffEnabled,this._getAllContactsMrisEnabled=e.getAllContactsMrisEnabled,this._isDiscardingOnAppActiveEnabled=e.isDiscardingOnAppActiveEnabled}_doesMriHaveBirthdayToday(e){const t=this._cachedUserProfilesDict[e];return t&&c.default.isTodayBirthdayForParticipantProfile(t)}_getSearchStore(){if(!this._searchStore){this._searchStore=new I.default;const e={rawQuery:"",trimmedNormalizedQuery:"",userMriToExclude:[w.default.getSkypeMri()],excludeBots:!0,onlyGroupCapable:!1,onlyCallCapable:!0,includeBlocked:!1,excludeNonManuallyAdded:!0};this._searchStore.updateConfig(e,[m.SearchResultsListGroup.FavoriteContacts,m.SearchResultsListGroup.SuggestedFrequentConversations,m.SearchResultsListGroup.AddressBook])}return this._searchStore}getAllContacts(){if(f.log(C.LogTraceArea.Engagement,"Will try to fetch all contacts"),this._searchStore=this._getSearchStore(),!this._searchStore)return f.log(C.LogTraceArea.Engagement,"Birthday notification search store did not initialize. Returning empty list of contact MRIs"),{favoriteContactsMris:[],nonFavoriteSuggestedContactsMris:[]};let e=this._celebrationNotificationsTopContactCutOff;const t=a.filter(this._searchStore.getCombinedContactsWithoutAddressBookAndShortCircuit(),t=>{if(!t.skypeContact)return!1;const i=t.skypeContact.getMri();return!!i&&(this._isContactCutOffEnabled&&d.isOneOnOneConversation(i)?(e--,e>=0):d.isOneOnOneConversation(i))}),i=a.map(t,e=>{if(e.skypeContact)return e.skypeContact.getMri()});return this._isContactCutOffEnabled&&0===e&&(f.log(C.LogTraceArea.Engagement,"Birthday notification contact cutoff reached. Returning empty list of contact MRIs"),f.track(new l.CelebrationNotificationTelemetryEvent({action:l.CelebrationNotificationTelemetryEventAction.ContactCutOffLimitReached,numberOfTopContacts:this._celebrationNotificationsTopContactCutOff,didIdentifyDifferentTopContacts:this._didIdentifyDifferentTopContacts,cardGuid:this._variantId,cardCampaignId:this._campaignId}))),{favoriteContactsMris:i,nonFavoriteSuggestedContactsMris:[]}}getFavoriteAndSuggestedContacts(){if(f.log(C.LogTraceArea.Engagement,"Will try to fetch favorite and suggested contacts"),this._searchStore=this._getSearchStore(),!this._searchStore)return f.log(C.LogTraceArea.Engagement,"Birthday notification search store did not initialize. Returning empty list of favorite and nonFavorite contact MRIs"),{favoriteContactsMris:[],nonFavoriteSuggestedContactsMris:[]};let e=this._celebrationNotificationsTopContactCutOff;const t=a.filter(this._searchStore.getFavoriteContactsResults(),t=>this._isContactCutOffEnabled&&d.isOneOnOneConversation(t)?(e--,e>=0):d.isOneOnOneConversation(t));if(this._isContactCutOffEnabled&&0===e)return f.log(C.LogTraceArea.Engagement,"Birthday notification contact cutoff reached. Returning empty list of nonFavorite contact MRIs"),f.track(new l.CelebrationNotificationTelemetryEvent({action:l.CelebrationNotificationTelemetryEventAction.ContactCutOffLimitReached,numberOfTopContacts:this._celebrationNotificationsTopContactCutOff,didIdentifyDifferentTopContacts:this._didIdentifyDifferentTopContacts,cardGuid:this._variantId,cardCampaignId:this._campaignId})),{favoriteContactsMris:t,nonFavoriteSuggestedContactsMris:[]};let i=[];return i=a.filter(this._searchStore.getSuggestedContactsAndConversationsResults(m.SearchResultsListGroup.SuggestedFrequentConversations),e=>d.isOneOnOneConversation(e)),i=a.difference(i,t),i=i.splice(e-1,i.length-e),{favoriteContactsMris:t,nonFavoriteSuggestedContactsMris:i}}fetchUserProfiles(e){return f.log(C.LogTraceArea.Engagement,"Starting to fetch user profiles for specified MRIs"),k.default.getFullUserProfileByMrisAsync(e).then(e=>{a.each(e,e=>{this._cachedUserProfilesDict[e.mri]&&delete this._cachedUserProfilesDict[e.mri],this._cachedUserProfilesDict[e.mri]=e}),f.log(C.LogTraceArea.Engagement,"Finished fetching user profiles for specified MRIs")})}getTopContactMrisWithBirthdaysToday(e){const t=e.favoriteContactsMris,i=e.nonFavoriteSuggestedContactsMris;let n=a.filter(t,e=>this._doesMriHaveBirthdayToday(e));const o=a.filter(i,e=>this._doesMriHaveBirthdayToday(e));return n.sort((e,t)=>this._compareTwoContacts(e,t)),o.sort((e,t)=>this._compareTwoContacts(e,t)),n=n.concat(o),n}maybeCreateBirthdayLocalEngagementNotification(e){const t=this._getCelebrationNotificationLastShownTime(this._isThrottlingOnLocalSettingsEnabled,this._isThrottlingOnRoamingSettingsEnabled);return this._didIdentifyDifferentTopContacts=!1,this._didShowNotification=!this._wasTimeBeforeToday(t),this._didShowNotification?(f.log(C.LogTraceArea.Engagement,"Birthday notification already created since: "+t+". Skipping scheduling"),f.track(new l.CelebrationNotificationTelemetryEvent({action:l.CelebrationNotificationTelemetryEventAction.NotificationAlreadyShown,numberOfTopContacts:e.length,didIdentifyDifferentTopContacts:this._didIdentifyDifferentTopContacts,cardGuid:this._variantId,cardCampaignId:this._campaignId})),o.Resolved()):(this._didIdentifyDifferentTopContacts=!b.default(this._topContactsWithBirthday,e),this._topContactsWithBirthday=e,f.log(C.LogTraceArea.Engagement,"Birthday notification will now be created"),this._createLocalBirthdayEngagementNotificationWithTopContacts(this._topContactsWithBirthday).always(e=>e?(this._didShowNotification=!0,f.log(C.LogTraceArea.Engagement,"Birthday notification created successfully"),this._setCelebrationNotificationLastShownTime(Date.now())):(f.log(C.LogTraceArea.Engagement,"Birthday notification not created"),o.Resolved())))}_createLocalBirthdayEngagementNotificationWithTopContacts(e){if(0===e.length)return f.log(C.LogTraceArea.Notifications,"Ignoring celebration notification because topContacts list is empty."),o.Resolved(!1);const t=e[0],i=k.default.getFullUserProfileByMri(t).getSkypeId();if(!this._cachedUserProfilesDict[t])return f.log(C.LogTraceArea.Notifications,"Ignoring celebration notification because of incomplete user profile."),f.track(new l.CelebrationNotificationTelemetryEvent({action:l.CelebrationNotificationTelemetryEventAction.SelectedTopContactUserProfileIncomplete,numberOfTopContacts:this._topContactsWithBirthday.length,didIdentifyDifferentTopContacts:this._didIdentifyDifferentTopContacts,cardGuid:this._variantId,cardCampaignId:this._campaignId,celebratedUserSkypeId:i})),o.Resolved(!1);if(this._isDiscardingOnAppActiveEnabled&&!this._isAppActive)return f.log(C.LogTraceArea.Notifications,"Ignoring celebration notification because app is not active."),o.Resolved(!1);const a={content:{skypeId:i}};return T.default.openCampaign(this._campaignId,this._variantId,g.EngagementType.PopCard,A.default.newGuid(),a).then(()=>(f.log(C.LogTraceArea.Notifications,"Created celebration popcard notification with campaignId : "+this._campaignId,"variantId : "+this._variantId),f.track(new l.CelebrationNotificationTelemetryEvent({action:l.CelebrationNotificationTelemetryEventAction.Created,notificationType:l.CelebrationNotificationType.EngagementPopCard,numberOfTopContacts:this._topContactsWithBirthday.length,didIdentifyDifferentTopContacts:this._didIdentifyDifferentTopContacts,cardCampaignId:this._campaignId,cardGuid:this._variantId,celebratedUserSkypeId:i})),!0)).fail(e=>(f.log(C.LogTraceArea.Notifications,"Failed to fetch campaign using PullCampaignContentService campaignId : "+this._campaignId+"variantId : "+this._variantId+" error: "+M.default.errorAsString(e)),f.track(new l.CelebrationNotificationTelemetryEvent({action:l.CelebrationNotificationTelemetryEventAction.PullCampaignContentServiceFailed,numberOfTopContacts:this._topContactsWithBirthday.length,didIdentifyDifferentTopContacts:this._didIdentifyDifferentTopContacts,cardGuid:this._variantId,cardCampaignId:this._campaignId,celebratedUserSkypeId:i})),!1))}_getRecentConversationsInvolvingUser(e){return a.filter(h.default().getDisplayableRecentConversationsSortedAll(),t=>a.some(t.getMemberMris(),t=>!w.default.isMyMri(e)&&t===e))}_compareTwoContacts(e,t){const i=this._getRecentConversationsInvolvingUser(e),a=this._getRecentConversationsInvolvingUser(t),n=i.length-a.length;let o=0;return i.length>0&&a.length>0&&(o=i[0].getTimestamp()-a[0].getTimestamp()),0===n?o:n}_wasTimeBeforeToday(e){const t=new Date(e),i=new Date;return i.setHours(0,0,0,0),t.getTime()<i.getTime()}_getCelebrationNotificationLastShownTime(e,t){const i=e&&_.default.getData(u.InternalKeys.CelebrationNotificationLastShownTime)||0,a=t&&v.default.getCelebrationNotificationLastShownTime()||0;return Math.max(i,a)}_setCelebrationNotificationLastShownTime(e){_.default.putData(u.InternalKeys.CelebrationNotificationLastShownTime,e),v.default.setCelebrationNotificationLastShownTime(e)}test_startup(){this._appConfigStoreSubscribeCallback()}test_reset(){this._searchStore&&(this._searchStore.destroy(),this._searchStore=void 0),this._usersStoreSubscriptionToken&&(k.default.unsubscribe(this._usersStoreSubscriptionToken),this._usersStoreSubscriptionToken=void 0),this._appStateSubscription&&(this._appStateSubscription.unsubscribe(),this._appStateSubscription=void 0),this._appConfigStoreSubscription&&(r.default.unsubscribe(this._appConfigStoreSubscription),this._appConfigStoreSubscription=void 0),a.each(this._cachedUserProfilesDict,(e,t)=>{e&&delete this._cachedUserProfilesDict[t]}),this._didShowNotification=!1;let e=p.default.add(Date.now(),0,-1);this._setCelebrationNotificationLastShownTime(e)}setFavoriteAndSuggestedContactsList(e){a.each(e,e=>{this._cachedUserProfilesDict[e.mri]=e})}setTopContactsList(e){this._topContactsWithBirthday=e}}},3267:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.postCallEventNotification=void 0;const a=i(584),n=i(60),o=i(32),s=i(3),r=i(5),l=i(21),c=i(28);t.postCallEventNotification=function(e,t,i,d,u,h){if(!d)return;let p="";const g=o.default.getDisplayableProfile(l.default.getSkypeMri()),C=o.default.getDisplayableProfile(t);switch(e){case c.ReactionsTextType.CallEventMuted:p=r.getString("CallPanel.MicrophoneServerMutedPersonalize",{initiator:g.getDisplayName(),person:C.getDisplayName()});break;case c.ReactionsTextType.CallEventKickedOut:p=r.getString("CallPanel.RemoveFromCallPersonalize",{initiator:g.getDisplayName(),person:C.getDisplayName()})}const m={reactionInfo:{type:n.ReactionsItemType.CallEvent,key:p,internalType:e,userMri:t},causeId:h,timestamp:Date.now(),postSource:s.PostSource.CallMoments,callId:i,conversationMri:d,reactionsConversationMri:u,logTraceArea:s.LogTraceArea.CallingUI};a.CallReactionPostingHelpers.postReaction(m)}},328:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(74),o=i(7),s=i(3267),r=i(29),l=i(123),c=i(87),d=i(110),u=i(17),h=i(33),p=i(3),g=i(4),C=i(5),m=i(21),S=i(1148),y=i(39),f=i(11),_=i(28),b=i(369);class v{static getRosterForConversation(e,t=!0){const i=h.default().getConversation(e);if(!i)return g.warn(p.LogTraceArea.CallingUI,"CallRosterUtils.getRosterForConversation: Failed to get conversation "+y.mriOrId(e)),[];const a=S.default.getSortedPeopleListInConversation(i,t);return a&&0===a.length&&g.warn(p.LogTraceArea.CallingUI,"CallRosterUtils.getRosterForConversation: returns empty list conversationId="+y.mriOrId(e)),a}static getActiveParticipants(e,t){let i=v.getRosterForConversation(t);const n=m.default.getSkypeMri();return a.filter(i,t=>{if(t===n)return!0;{const i=r.default.CallingStore.findRemoteCallMember(e,t);return l.default.isParticipantConnected(i)}})}static getInactiveGroupMembersFromRoster(e,t){return a.difference(e,t)}static getInactiveGroupMembers(e,t){return this.getInactiveGroupMembersFromRoster(v.getRosterForConversation(t,!1),r.default.CallingStore.getRemoteCallMemberMris(e))}static getConversationName(e){const t=h.default().getConversation(e);return t?t.topicName():(g.log(p.LogTraceArea.CallingUI,"CallRosterUtils.getRosterForConversation: Failed to get conversation "+y.mriOrId(e)),"")}static getParticipantRenderInfoConfig(e,t,i,a){const o=a?a.state:void 0,s=l.default.isParticipantConnected(a),c=a&&a.voiceLevel>0,d=o===n.ParticipantState.Ringing||o===n.ParticipantState.Connecting,u=!!a&&a.isServerMuted;return{key:e,participantState:o,isActive:s,isTalking:c,isRinging:d,isServerMuted:u,isServerMutedSupported:!!a&&r.default.CallingStore.getServerMuteUnmuteSupportedForParticipant(t,a),isLocalMuted:u,isLocalMuteSupported:i}}static getRenderInfoForParticipant(e,t){const i=e.key,a=e.participantState,n=e.isActive,o=e.isTalking,s=e.isRinging,r=e.isServerMuted,l=e.isServerMutedSupported,c=e.isLocalMuted,d=e.isLocalMuteSupported;return t&&e.participantState===t.participantState&&o===t.isTalking&&s===t.isRinging&&r===t.isServerMuted&&l===t.isServerMutedSupported&&d===t.isLocalMuteSupported&&c===t.isLocalMuted?t:{key:i,participantState:a,isActive:n,isTalking:o,isRinging:s,isServerMuted:r,isServerMutedSupported:l,isLocalMuted:c,isLocalMuteSupported:d}}static getRenderInfoForCurrentParticipant(e,t,i){const a=d.default.isLocalOrServerMuted(t);return{key:e,participantState:n.ParticipantState.Connected,isActive:!0,isTalking:!1,isRinging:!1,isLocal:!0,isLocalMuteSupported:i,isServerMuted:a,isServerMutedSupported:!0,isLocalMuted:a}}static getAllMembersWithActiveAndInactiveParticipants(e,t,i){let n={},o=[],s=[];const l=m.default.getSkypeMri();let c=v.getRosterForConversation(e);const d=r.default.CallingStore.getLocalMuteSupported(t);let u=v.getRenderInfoForCurrentParticipant(l,t,d);c&&0===c.length&&g.warn(p.LogTraceArea.CallingUI,"CallRosterUtils.getAllMembersWithActiveandInActiveParticipants: allMembers is empty list conversationId="+y.mriOrId(e));const h=a.map(r.default.CallingStore.getParticipantsWithRaisedHands(t),e=>e.id),C=a.uniq(a.concat(h,c)),S=a.includes(h,l);return a.each(C,e=>{if(e!==l){const a=r.default.CallingStore.findRemoteCallMember(t,e),l=v.getParticipantRenderInfoConfig(e,t,u.isLocalMuteSupported,a),c=v.getRenderInfoForParticipant(l,i[e]);a&&c.isActive?o.push(c):s.push(c),n[e]=c}else e===l&&S&&(o.push(u),n[l]=u)}),u&&!S&&(o.push(u),n[l]=u),o&&0===o.length&&g.warn(p.LogTraceArea.CallingUI,"CallRosterUtils.getAllMembersWithActiveandInActiveParticipants: activeParticipants is empty list conversationId="+y.mriOrId(e)),{activeParticipants:o,inactiveParticipants:s,allMembers:c,allParticipants:n}}static getIconTitleForMuteOrUnMute(e,t,i,a,n){let o,s,r=!1;return t&&i?(o=f.SkypeIcon.MicrophoneOff,s=C.getString("CallControls.CallButtonUnmuteLabel")):t&&!i?(o=f.SkypeIcon.Microphone,s=C.getString("CallControls.CallButtonMute")):e&&a?a&&n?(o=f.SkypeIcon.MicrophoneOff,s=C.getString("CallPanel.MicrophoneUnMuteNotAllowed"),r=!0):(o=f.SkypeIcon.Microphone,s=C.getString("CallControls.CallButtonMute")):(o=f.SkypeIcon.Microphone,s=C.getString("CallPanel.MicrophoneMuteNotSupported"),r=!0),{icon:o,title:s,disableIcon:r}}}t.default=v,v.handleLocalMuteOrUnmute=(e,t)=>(c.default.updateCallTelemetry(e,t,e=>e.muteCallRosterPress()),d.default.isLocalOrServerMuted(e)?(r.default.CallingStore.unmute(e,t),!1):(r.default.CallingStore.mute(e,t),b.default.updateCallRosterTelemetry(e,t,e=>e.callRosterMutedUser()),!0)),v.handleRemoteMute=(e,t,i)=>{const a=r.default.CallingStore.findRemoteCallMember(t,e),l=u.getReactionsThreadMriForCallId(t),c=r.default.CallingStore.getCallConversationMri(t);a?(r.default.CallingStore.muteParticipants(t,n.MuteScope.Specified,[a],i).then(()=>{o.default.getS4LCMCFeaturesNoSubscription().enableNotifyUsersMuteKick&&s.postCallEventNotification(_.ReactionsTextType.CallEventMuted,e,t,c,l,i)}),b.default.updateCallRosterTelemetry(t,i,e=>e.callRosterMutedUser())):g.error(p.LogTraceArea.CallingUI,"[CallRosterUtils] _handleRemoteMute\n                                                          participantToMute is null or empty, causeId: "+i)},v.handleRemoteHangup=(e,t,i)=>{const a=u.getReactionsThreadMriForCallId(t),n=r.default.CallingStore.getCallConversationMri(t);o.default.getS4LCMCFeaturesNoSubscription().enableNotifyUsersMuteKick&&s.postCallEventNotification(_.ReactionsTextType.CallEventKickedOut,e,t,n,a,i),r.default.CallingStore.removeParticipant(t,e,i)}},331:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StopScreenShareCommand=t.RequestScreenShareCommand=t.ToggleVideoCommand=t.ChangeCallLayoutCommand=t.MuteEveryoneCommand=t.EndCallForEveryoneCommand=t.EndCallCommand=t.ToggleScreenShareCommand=t.ToggleMuteCommand=void 0;const a=i(1),n=i(74),o=i(8),s=i(7),r=i(29),l=i(328),c=i(219),d=i(87),u=i(60),h=i(110),p=i(413),g=i(33),C=i(3),m=i(4),S=i(178),y=i(30),f=i(21),_=i(18),b=i(179),v=i(19),w=i(28),T=i(515),I=i(10);t.ToggleMuteCommand=class{constructor(e,t,i,a,n){this._callId=e,this._muted=t,this._serverMuted=i,this._isPermissionDenied=a,this._rootViewId=n}execute(){const e=I.default.newCauseId(),t="ToggleMuteCommand.execute causeId: "+e,i="this.state.isMuted: "+this._muted,a="this.state.isServerMuted: "+this._serverMuted;m.log(C.LogTraceArea.CallingUI,`${t}, ${i}, ${a}`),r.default.CallPermissionsUtils.requestPermissionStatus(w.PermissionType.Microphone,e).then(t=>{t?this._toggleMic(e):this._showMicDeniedPrompt()})}_showMicDeniedPrompt(){b.default.showDeniedPromptWithSettingsOption(w.PermissionType.Microphone,this._rootViewId)}_toggleMic(e){this._muted?(r.default.CallingStore.unmute(this._callId,e),h.default.announceMicrophoneState(!1,!1)):(r.default.CallingStore.mute(this._callId,e),h.default.announceMicrophoneState(!0,!1)),d.default.updateCallTelemetry(this._callId,e,e=>e.micButtonPress())}};t.ToggleScreenShareCommand=class{constructor(e,t){this._callInfo=e,this._screenSharing=t}canExecute(){return r.default.CallingFeaturesHelper.allowScreenSharing(this._callInfo)}execute(){const e=I.default.newCauseId();m.log(C.LogTraceArea.CallMonitor,"ToggleScreenShareCommand.execute causeId: "+e),this._screenSharing?r.default.CallMonitorService.onStopSharing(e):r.default.CallMonitorService.onSwitchToMainView(e).then(()=>{r.default.CallMonitorService.onStartSharing(e)},t=>{m.warn(C.LogTraceArea.CallMonitor,`CallMonitorCallControls.onSwitchToMainView failed ${v.default.errorAsString(t)} causeId: ${e}`)})}};t.EndCallCommand=class{constructor(e,t){this._callId=e,this._failedHandler=t}execute(){const e=I.default.newCauseId();m.log(C.LogTraceArea.CallingUI,"EndCallCommand.execute causeId: "+e),r.default.CallingStore.endCall(this._callId,e).catch(t=>{m.warn(C.LogTraceArea.CallingUI,`EndCallCommand: endCall failed: ${v.default.errorAsString(t)} causeId: ${e}`),this._failedHandler&&this._failedHandler(e)})}};t.EndCallForEveryoneCommand=class{constructor(e,t,i,a){this._callId=e,this._callInfo=t,this._callUIState=i,this._failedHandler=a}canExecute(){return this._callUIState!==u.CallUIState.IncomingRing&&this._callUIState!==u.CallUIState.OutgoingRing&&(r.default.CallingStore.isCallHostless(this._callId)&&r.default.CallingFeaturesHelper.allowEndCallForEveryone(this._callInfo))}execute(){const e=I.default.newCauseId();m.log(C.LogTraceArea.CallingUI,"EndCallForEveryoneCommand.execute causeId: "+e),r.default.CallingStore.endCallForEveryone(this._callId,e).catch(t=>{m.warn(C.LogTraceArea.CallingUI,`EndCallForEveryoneCommand: endCall failed: ${v.default.errorAsString(t)} causeId: ${e}`),this._failedHandler&&this._failedHandler(e)})}};t.MuteEveryoneCommand=class{constructor(e){this._callId=e}canExecute(){const e=r.default.CallingStore.getCallConversationMri(this._callId),t=e&&g.default().getConversation(e);return(!!e&&l.default.getActiveParticipants(this._callId,e).length)>1&&S.isCurrentUserAdminInModeratedGroup(t)}execute(){this.canExecute()?r.default.CallingStore.muteParticipants(this._callId,n.MuteScope.All,[],I.default.newCauseId()):m.error(C.LogTraceArea.CallingUI,"[MuteEveryoneCommand] tried execute muting everyone but canExecute is false")}};t.ChangeCallLayoutCommand=class{constructor(e,t,i){this._callInfo=e,this._isIncomingOrOutgoingRing=t,this._fromStageMode=i}canExecute(){return!(!this._callInfo.conversationMri||!this._callInfo.callId)&&(!this._isIncomingOrOutgoingRing&&r.default.CallingStore.getRemoteCallMembers(this._callInfo.callId).length>0)}canExecuteForStageMode(e){switch(e){case u.StageMode.TogetherMode:return r.default.CallingFeaturesHelper.allowCallAudienceBot(this._callInfo);case u.StageMode.LargeGrid:return r.default.CallingFeaturesHelper.allowCallGridViewBot(this._callInfo);default:return!0}}execute(e){const t=I.default.newCauseId();if(m.log(C.LogTraceArea.CallingUI,`ChangeCallLayoutCommand.execute switching stage mode from'\n            + '${u.StageMode[this._fromStageMode]} to ${u.StageMode[e]} causeId ${t}`),!this._callInfo.callId)return void m.error(C.LogTraceArea.CallingUI,"ChangeCallLayoutCommand.execute no callId causeId "+t);const i=o.Defer();let a=!0;if(e===u.StageMode.TogetherMode)a=this._handleTogetherModeStage(i,this._callInfo.callId,t);else if(e===u.StageMode.LargeGrid){r.default.CallingStore.isPossiblyNotConnectedGridViewBotInCall(this._callInfo.callId)||(a=!1,r.default.InCallBotService.startGridViewMode(this._callInfo.callId,t).then(()=>{i.resolve()}).catch(e=>{i.reject("failed to start GridViewMode: "+e)}))}a&&i.resolve(),i.promise().then(()=>{this._callInfo.callId?(c.default.setStageMode(this._callInfo.callId,e,t),h.default.announceStageMode(e)):m.error(C.LogTraceArea.CallingUI,"ChangeCallLayoutCommand.execute no callId causeId "+t)}).catch(e=>{m.warn(C.LogTraceArea.CallingUI,`ChangeCallLayoutCommand.execute ${e} causeId ${t}`)})}_handleTogetherModeStage(e,t,i){if(r.default.CallingStore.isPossiblyNotConnectedAudienceBotInCall(t))return!0;const n=n=>{r.default.InCallBotService.startAudienceMode(t,i).then(()=>{a.isUndefined(n)||r.default.AudienceBotService.selectAudienceScene(t,i,n.sceneId),e.resolve()}).catch(t=>{e.reject("failed to start AudienceMode:"+t)})},{enabledBackgroundSelection:o}=s.default.getS4LCMCFeatures().callAudienceBotConfig;if(!o)return n(void 0),!1;const l=T.default.getTogetherModeBackgrounds();if(a.isEmpty(l))return m.warn(C.LogTraceArea.CallingUI,"ChangeCallLayoutCommand.execute no TogetherMode backgrounds to choose from"),n(void 0),!1;const c={conversationMri:this._callInfo.conversationMri,onChangeBackground:n,onStartTogetherMode:n,onClose:()=>{e.reject("Together Mode Panel got closed")},isAudienceBotInCall:!1,selectedBackground:void 0};return _.default.navigateToTogetherModePanel(c,T.default.getPanelId()),!1}};t.ToggleVideoCommand=class{constructor(e,t){this._callId=e,this._callInfo=t}canExecute(){return r.default.CallingFeaturesHelper.allowOutboundVideo(this._callInfo)}execute(){const e=I.default.newCauseId();if(m.log(C.LogTraceArea.CallMonitor,"ToggleVideoCommand.execute causeId: "+e),p.default.isVideoSuggestionTooltipVisible(this._callId)){const e=y.default.getUserPreferencesLocalNoSubscription().videoSuggestionTooltipInteractionCount||0;y.default.setUserPreferencesLocal({videoSuggestionTooltipInteractionCount:e+1}),d.default.updateVideoSuggestionTooltipEvent(e=>{e.markDidTurnOnVideo()}),p.default.setVideoSuggestionTooltipVisibility(this._callId,!1)}r.default.CallControlsStore.toggleVideo(this._callId,e)}};t.RequestScreenShareCommand=class{constructor(e){this._screenShareControl=e}canExecute(){return void 0!==this._screenShareControl&&this._screenShareControl.canRequestControl()}execute(){return this._screenShareControl?this._screenShareControl.requestControl().then(()=>{m.log(C.LogTraceArea.ScreenSharing,"request control succeeded")}).catch(e=>{m.log(C.LogTraceArea.ScreenSharing,"request control failed with "+v.default.errorAsString(e))}):o.Resolved()}};t.StopScreenShareCommand=class{constructor(e){this._screenShareControl=e,this.viewerInControl=this._screenShareControl?this._screenShareControl.viewerInControl():void 0}canExecute(){return void 0!==this.viewerInControl&&f.default.isMyMri(this.viewerInControl.mri)}execute(){return this._screenShareControl&&this.viewerInControl?this._screenShareControl.terminateControl(this.viewerInControl.mri).then(()=>{m.log(C.LogTraceArea.ScreenSharing,"terminate control succeeded")}).catch(e=>{m.log(C.LogTraceArea.ScreenSharing,"terminate control failed with "+v.default.errorAsString(e))}):o.Resolved()}}},3337:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=(i(34),i(8)),o=i(7),s=i(29),r=i(123),l=i(81),c=i(71),d=i(722),u=i(3),h=i(4),p=i(207),g=i(523),C=i(432),m=i(406),S=i(22),y=i(852),f=i(46);t.default=new class{constructor(){this._subscriptions=[],S.RegisterStartupable(this,"TrouterNotificationsService",[g.default]),p.default.registerForLogout(this,"TrouterNotificationsService")}startup(){return this._subscriptions.push(g.default.event_trouterNotificationQueueChanged.subscribe(()=>{this._drainTrouterQueue()})),this._drainTrouterQueue(),n.Resolved()}_drainTrouterQueue(){a.each(g.default.fetchAndDrainTrouterNotificationQueue(),e=>{this._handleTrouterMessage(e.notification,e.causeId)})}logout(e,t,i){const o=this._subscriptions;return this._subscriptions=[],a.each(o,e=>e.unsubscribe()),n.Resolved()}_handleTrouterMessage(e,t){var i;const n=Number(e.eventId);h.log(u.LogTraceArea.Trouter,"_handleTrouterMessage (Evt: "+n+", causeId: "+t+"), MS-CV: "+e.cv+")"),s.default.CallNotificationHelpers.maybeDisposePendingWarmCallForNotification(n);const p=Date.now();if(n===C.PNHEvents.IncomingNGCCall||n===C.PNHEvents.IncomingNGCGroupCall||n===C.PNHEvents.IncomingNGCPSTNCall||n===C.PNHEvents.IncomingS4BCall||n===C.PNHEvents.IncomingNGCEncryptedCall)s.default.CallNotificationHelpers.processIncomingCallNotification(n,"trouter",r.default.incomingCallNotificationForTrouter(e),p,p,t);else if(n===C.PNHEvents.IncomingGoLiveStart)s.default.CallNotificationHelpers.processIncomingGoLiveNotification(n,"trouter",r.default.incomingGoLiveNotificationForTrouter(e),p,p,t);else if(n===C.PNHEvents.IncomingGoLiveStop)s.default.CallNotificationHelpers.processGoLiveStopNotification(n,"trouter",r.default.stopGoLiveNotificationForTrouter(e),p,p,t);else if(n===C.PNHEvents.IncomingNGCStopRinger)s.default.CallNotificationHelpers.processStopCallNotification("trouter",r.default.stopCallNotificationForTrouter(e),p,p,t);else if(n===C.PNHEvents.IncomingWarmCall)s.default.CallNotificationHelpers.processWarmCallNotification(!1,e.body,t);else if(n===C.PNHEvents.IncomingP2PCall)s.default.CallNotificationHelpers.processP2PCallNotification(n,"trouter",e.body,p,p,t);else if(n===C.PNHEvents.IncomingContactListChange)c.default.processContactListChangeNotification();else if(n===C.PNHEvents.IncomingContactRequest||n===C.PNHEvents.IncomingContactAccept||n===C.PNHEvents.IncomingContactInviteListChange)c.default.processContactInviteNotification();else if(n===C.PNHEvents.IncomingProfileChange)f.default.fetchUserPotentiallyBeforeStartup();else if(n===C.PNHEvents.IncomingAvatarChange)f.default.fetchUserAvatarUrlPotentiallyBeforeStartup();else if(n===C.PNHEvents.SceUserServicesChange)d.default.processSceUserServicesChangeNotification(e.body.data||e.body);else if(n===C.PNHEvents.IncomingTPUMConciergeMessage){const i=e.body;y.default.processTPUMNotification(i,t)}else if(n===C.PNHEvents.IncomingUpsPresence){const t=null===(i=e.body)||void 0===i?void 0:i.presence;a.isEmpty(t)||m.default.trouterUserPresencesReceived(t)}else{if(n!==C.PNHEvents.Ued)return h.warn(u.LogTraceArea.Trouter,"_handleTrouterMessage: Failed to handle event type: "+n+" causeId: "+t+", MS-CV: "+e.cv),!1;{const t=o.default.getS4LMessagingFeaturesNoSubscription().ued,i=t&&t.enabled&&t.consumeEvents;h.log(u.LogTraceArea.Trouter,"Incoming UED event, MS-CV: "+e.cv+", processing enabled:"+i),i&&l.default.handleTrouterEvent(e.body,e.cv)}}return!0}}},3342:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.maybePresentRinglessCallInterstitial=void 0;const a=i(35),n=i(0),o=i(57),s=i(50),r=i(29),l=i(88),c=i(87),d=i(43),u=i(54),h=i(13),p=i(234),g=i(79),C=i(3),m=i(41),S=i(4),y=i(6),f=i(5),_=i(27),b=i(36),v=i(59),w=i(174),T=i(201),I=i(107),P=i(42),M=i(9),k=i(11),A=i(77),R=i(16),V=y.lazyProperties({dialog:()=>n.Styles.createViewStyle({flex:1,justifyContent:"center"}),dialogHeaderContainer:()=>n.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,flexDirection:"row",justifyContent:"space-between"}),closeButton:()=>n.Styles.createViewStyle({paddingLeft:15,paddingRight:15}),footer:()=>n.Styles.createViewStyle({height:60,alignSelf:"center"}),footerLandscape:()=>n.Styles.createViewStyle({height:50,alignSelf:"center"}),footerButton:()=>n.Styles.createViewStyle({alignSelf:"center",justifyContent:"center",alignItems:"center",marginTop:10}),interstitialImage:()=>n.Styles.createImageStyle({height:120,width:360,alignSelf:"center",marginTop:5}),message:()=>n.Styles.createTextStyle({alignSelf:"center",textAlign:"center",marginVertical:10,marginHorizontal:30,backgroundColor:M.Color.transparent})});t.maybePresentRinglessCallInterstitial=function(e,t){S.log(C.LogTraceArea.CallingUI,"RinglessCallInterstitial maybePresentRinglessCallInterstitial, causeId: "+e.causeId);const i=n.createElement(E,{dialogId:"RinglessCallInterstitial",conversationMri:e.conversationMri,withVideo:e.withVideo,origin:e.origin,isLargeGroup:e.isLargeGroup,causeId:e.causeId});u.default.showModal(i,"RinglessCallInterstitial",t)};class E extends s.default{constructor(){super(...arguments),this._closeButtonPressed=()=>{S.log(C.LogTraceArea.CallNavigation,"RinglessCallInterstitial._closeButtonPressed causeId: "+this.props.causeId),c.default.trackRinglessCallInterstitial(l.RinglessCallInterstitialActions.Cancel,this.props.isLargeGroup),u.default.dismissModal(this.props.dialogId,this._getRootViewId())},this._onButtonPressed=()=>{S.log(C.LogTraceArea.CallNavigation,"RinglessCallInterstitial._onButtonPressed causeId: "+this.props.causeId),c.default.trackRinglessCallInterstitial(l.RinglessCallInterstitialActions.ContinueWithCall,this.props.isLargeGroup),r.default.CallNavigationHelper.startCall({conversationMri:this.props.conversationMri,withVideo:this.props.withVideo,origin:this.props.origin},this.props.causeId)}}_buildState(e,t){const i=this._getRootViewId();return{isLandscape:!this._getContext().isPresentedInDesktopSubview&&_.default.getDeviceOrientation(i)===a.DeviceOrientation.Landscape,isMobileScreenSize:_.default.isMobileScreenSize(i),statusBarHeight:b.default.leavePaddingForStatusBar()?b.default.statusBarHeight():0}}componentDidMount(){super.componentDidMount(),g.dismissAll();const e=I.default.mergeStyles([I.default.createBarStyle(T.BarStyleTheme.Light),I.default.createHiddenStyle(!1)]);this._updateStatusBarStyle(e)}componentWillUnmount(){super.componentWillUnmount(),S.log(C.LogTraceArea.CallingUI,"RinglessCallInterstitial componentWillUnmount")}render(){const e=this._renderCloseButton(),t=this._renderActionButton(),i=this.state.isMobileScreenSize?{maxWidth:void 0,maxHeight:void 0}:{maxWidth:p.CompactWidth,maxHeight:462},a=this._renderImage(),o=this._getTitleText(),s=this._getContentText(),r=d.default.combinedAccessibilityLabel(o,s);return n.createElement(w.default,Object.assign({dialogId:this.props.dialogId,containerStyle:this._themeStyles.primaryBackgroundColorStyle,closeOnClickOutside:!0},i,{maxWidth:this.state.isMobileScreenSize?void 0:p.DefaultWidth,fullScreen:this.state.isMobileScreenSize,useFullSizeContainer:!0,accessibilityLabel:r}),n.createElement(n.View,{style:V.dialog},e,a,n.createElement(R.PanelHeader,{style:V.message},o),n.createElement(R.BodyText,{style:V.message},s),t))}_getHeaderTopMargin(){return this.state.isMobileScreenSize&&!this.state.isLandscape&&!this._getContext().isPresentedInDesktopSubview&&this.state.statusBarHeight>0?this.state.statusBarHeight:!this.state.isMobileScreenSize&&this.state.isLandscape?15:5}_renderCloseButton(){const e=[V.dialogHeaderContainer],t=this._getHeaderTopMargin();return t&&e.push(v.default.marginTopStyle(t)),n.createElement(n.View,{style:e},n.createElement(m.default,{style:V.closeButton,icon:A.closeIcon(),size:k.IconSize.size24,title:f.getString("Global.CloseButtonTitle"),onPress:this._closeButtonPressed,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor}))}_renderActionButton(){return n.createElement(n.View,{style:this.state.isLandscape?V.footerLandscape:V.footer},n.createElement(P.default,{buttonSize:h.SXButtonSize.Medium,buttonStyle:h.SXButtonStyle.BlueFill,style:V.footerButton,allowTextWrap:!0,title:f.getString("CallPanel.GroupCallRingLessContinueToCallButtonTitle"),onPress:this._onButtonPressed,autoFocus:!1}))}_renderImage(){const e=this.props.isLargeGroup?o.Collection.RINGLESS_CALL_LARGE_GROUP:o.Collection.RINGLESS_CALL_SMALL_GROUP;return n.createElement(n.Image,{source:e,style:V.interstitialImage})}_getTitleText(){return this.props.isLargeGroup?f.getString("CallPanel.GroupCallRinglessLargeGroup"):f.getString("CallPanel.GroupCallRinglessSmallGroup")}_getHeaderText(e){return this._getTitleText()}_getContentText(){return this.props.isLargeGroup?f.getString("CallPanel.GroupCallRinglessLargeGroupExplanation"):f.getString("CallPanel.GroupCallRinglessSmallGroupExplanation")}}t.default=E},3349:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallButtonIconSize=void 0;const a=i(1),n=i(0),o=i(29),s=i(103),r=i(377),l=i(60),c=i(17),d=i(32),u=i(3),h=i(41),p=i(4),g=i(6),C=i(208),m=i(5),S=i(18),y=i(23),f=i(479),_=i(878),b=i(354),v=i(149),w=i(9),T=i(11),I=i(12),P=i(46),M=i(10);var k;!function(e){e[e.Default=0]="Default",e[e.Compact=1]="Compact",e[e.ExtraCompact=2]="ExtraCompact"}(k=t.CallButtonIconSize||(t.CallButtonIconSize={}));const A=g.lazyProperties({hiddenContainer:()=>n.Styles.createViewStyle({width:0,justifyContent:"flex-end"}),button:()=>n.Styles.createViewStyle({alignItems:"center",paddingHorizontal:10,backgroundColor:w.Color.transparent})});class R extends I.default{constructor(){super(...arguments),this._onAudioButtonRef=e=>{this._audioButtonRef=e||void 0},this._onVideoButtonRef=e=>{this._videoButtonRef=e||void 0},this._onUpcomingCallDetailsButtonPress=e=>{if(e.stopPropagation(),!this.props.scheduledCallId)return;const t=M.default.newCauseId();p.log(u.LogTraceArea.CallNavigation,"CallButtons._onUpcomingCallDetailsButtonPress, causeId: "+t),!this.state.isUsingStackNav&&this.props.mri&&S.default.navigateToConversation({convId:this.props.mri,causeId:t,origin:u.NavigationConversationOrigin.Search});const i=b.default.ScheduledCallsStore.getScheduledCallById(this.props.scheduledCallId);i&&b.default.NavigationActions.navigateToScheduledOverviewPanel({scheduledCallId:i.id,entryPoint:v.ScheduleCallEntryPoint.UpcomingCallComponent},this._getRootViewId())},this._onCallButtonPress=e=>{e.stopPropagation();const t=M.default.newCauseId();p.log(u.LogTraceArea.CallNavigation,"SearchItem._onCallButtonPress causeId: "+t);const i=()=>this._audioButtonRef;this.props.mri&&c.isPhoneMri(this.props.mri)&&(!this.props.addressBookContactOverride||this.props.addressBookContactOverride&&this.props.addressBookContactOverride.shortCircuitMriMatch)?this._handlePstnOnlyClick(i):this._startCall(!1,t,i)},this._onVideoCallButtonPress=e=>{e.stopPropagation();const t=M.default.newCauseId();p.log(u.LogTraceArea.CallNavigation,"SearchItem._onVideoCallButtonPress causeId: "+t);this._startCall(!0,t,()=>this._videoButtonRef)}}_buildState(e,t){const i={};let a=!1;return e.addressBookContactOverride?(i.isEncrypted=!1,i.displayName=e.addressBookContactOverride.getDisplayName()):e.mri?(i.isEncrypted=c.isEncryptedThread(e.mri),i.displayName=d.default.getDisplayName(e.mri)||"",i.activeCallStatus=o.default.ActiveCallUIHelper.activeCallStatus(e.mri),a=c.isPhoneMri(e.mri)):(i.isEncrypted=!1,i.displayName=""),i.isUsingStackNav=y.default.isUsingStackNavigationContext(),i.multipleAudioCallOptionsAvailable=e.mri&&!c.isEncryptedThread(e.mri)&&c.isOneOnOneConversation(e.mri)&&R._areMultipleAudioCallOptionsAvailable(e),i.callingNotAllowed=!e.mri||!c.isMri(e.mri)||!o.default.CallNavigationHelper.isOutgoingCallingAllowed(e.mri),i.allowOutboundVideo=e.mri&&!e.scheduledCallId&&c.isMri(e.mri)&&o.default.CallingFeaturesHelper.allowOutboundVideo({isPSTNCall:a,isEncryptedCall:i.isEncrypted,conversationMri:e.mri}),i}render(){let e,t,i,o,s;const r=this._themeColors.iconHoverColor,c=this._themeColors.primaryIconColor,d=this.state.activeCallStatus===l.ActiveCallStatus.OnHold;this.props.addressBookContactOverride&&!this.props.addressBookContactOverride.shortCircuitMriMatch?(o=!a.isEmpty(this.props.addressBookContactOverride.phones),s=!1):(o=!0,s=this.state.allowOutboundVideo);const u=[A.button];let p=T.IconSize.size24;if(this.props.iconSize&&(p=this.props.iconSize===k.Compact?T.IconSize.size20:T.IconSize.size16),o){let e,i;d?e=T.SkypeIcon.Pause:this.state.isEncrypted?e=T.SkypeIcon.PrivateCallFill:this.state.multipleAudioCallOptionsAvailable?(e=T.SkypeIcon.CallOptions,i=[n.Types.AccessibilityTrait.Button,n.Types.AccessibilityTrait.HasPopup]):e=T.SkypeIcon.CallStart,t=n.createElement(h.default,{ref:this._onAudioButtonRef,size:p,onPress:this._onCallButtonPress,color:c,hoverColor:r,icon:e,style:u,disabled:this.state.callingNotAllowed,title:m.getString("SkypeUserListItem.StartAudioCallButtonLabel"),accessibilityLabel:m.getString("AccessibilityLabel.StartAudioCallButtonAccessibilityLabel",{displayName:this.state.displayName}),accessibilityTraits:i})}this.props.scheduledCallId&&(i=n.createElement(h.default,{size:p,onPress:this._onUpcomingCallDetailsButtonPress,color:c,hoverColor:r,icon:T.SkypeIcon.Schedule,style:u,title:m.getString("SkypeUserListItem.ViewUpcomingCallDetailsButtonLabel"),accessibilityLabel:m.getString("AccessibilityLabel.ViewUpcomingCallDetailsButtonAccessibilityLabel",{displayName:this.state.displayName})})),s&&(e=n.createElement(h.default,{ref:this._onVideoButtonRef,size:p,onPress:this._onVideoCallButtonPress,color:c,hoverColor:r,icon:T.SkypeIcon.Video,style:u,disabled:this.state.callingNotAllowed,title:m.getString("SkypeUserListItem.StartVideoCallButtonLabel"),accessibilityLabel:m.getString("AccessibilityLabel.StartVideoCallButtonAccessibilityLabel",{displayName:this.state.displayName})}));const g=[f.styles.optionalCallButtonsContainer,this.props.hidden?A.hiddenContainer:void 0];return n.createElement(n.View,{style:g,importantForAccessibility:this.props.hidden?n.Types.ImportantForAccessibility.NoHideDescendants:void 0},i,e,t)}_handlePstnOnlyClick(e){const t=this.props.mri;t&&P.default.getFullUserProfileByMriAsync(t).then(i=>{if(!i)return;const a=c.getPhoneNumberFromMri(t);if(!a)return;const n=C.default.getContactByPhoneNumber(a),o=n?n.getDisplayName():i.getDisplayName();r.default.showForAddressContact(e,this._getRootViewId(),o,u.ContactInviteOrigin.CallPanelSearch,u.NavigationCallOrigin.SkypeUserListItem,i.phones,i.emails)})}_startCall(e,t,i){const a={skypeMri:this.props.addressBookContactOverride&&!this.props.addressBookContactOverride.shortCircuitMriMatch?void 0:this.props.mri,phones:this.props.addressBookContactOverride?this.props.addressBookContactOverride.phones:void 0,userIntent:e?s.StartCallOrMaybePromptUserIntent.Video:s.StartCallOrMaybePromptUserIntent.Audio,inviteOrigin:u.ContactInviteOrigin.SearchItem,callOrigin:u.NavigationCallOrigin.SearchItem},n=this.props.mri;n&&_.default.shouldShowInterstitial(n,e)?_.default.maybeShowRinglessCallInterstitial(n,e,a.callOrigin,t):r.default.startCallOrMaybePrompt(i,this._getRootViewId(),a,t)}static _areMultipleAudioCallOptionsAvailable(e){return!!e.mri&&(!!c.isPhoneMri(e.mri)||P.default.getDisplayableUserByMri(e.mri).getHasPhoneNumbers())}}t.default=R},3356:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(653),s=i(103),r=i(377),l=i(325),c=i(88),d=i(413),u=i(17),h=i(582),p=i(203),g=i(70),C=i(79),m=i(32),S=i(3),y=i(26),f=i(4),_=i(6),b=i(5),v=i(729),w=i(355),T=i(21),I=i(102),P=i(78),M=i(476),k=i(72),A=i(9),R=i(20),V=i(24),E=i(11),L=i(28),B=i(14),O=i(16),D=i(12),x=i(10),N=k.default.menuId(),U=_.lazyProperties({container:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",width:200}),cardFooterContainer:()=>n.Styles.createViewStyle({alignItems:"stretch"}),cardFooterContainerEnded:()=>n.Styles.createViewStyle({minHeight:72}),messageText:()=>n.Styles.createTextStyle({paddingHorizontal:10,textAlignVertical:"center",marginTop:3}),messageTextIOS:()=>n.Styles.createTextStyle({paddingVertical:3,marginTop:0}),durationContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",paddingHorizontal:10,paddingBottom:3}),durationIconMargins:()=>n.Styles.createViewStyle({marginRight:3}),optionalButton:()=>n.Styles.createButtonStyle({paddingVertical:13,borderTopWidth:2,borderStyle:"solid"}),optionalButtonText:()=>n.Styles.createTextStyle({textAlign:"center"}),optionalButtonHover:()=>n.Styles.createTextStyle({color:A.Color.gray300}),participantsText:()=>n.Styles.createTextStyle({paddingHorizontal:10,paddingVertical:3}),picturesContainer:()=>n.Styles.createViewStyle({height:110,flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between",backgroundColor:A.Color.gray200}),pictureTripleMain:()=>n.Styles.createViewStyle({height:110,width:100}),pictureTripleStack:()=>n.Styles.createViewStyle({height:55,width:100}),pictureDouble:()=>n.Styles.createViewStyle({height:110,width:100}),pictureSingle:()=>n.Styles.createViewStyle({height:110,width:200}),rightPicturesStackContainer:()=>n.Styles.createViewStyle({justifyContent:"space-between"}),lastPictureOverlay:()=>n.Styles.createViewStyle({position:"absolute",top:0,right:0,bottom:0,left:0,alignItems:"center",justifyContent:"center",backgroundColor:A.Color.blackOverlay20}),lastPictureOverlayText:()=>n.Styles.createTextStyle({color:A.Color.white})});class F extends D.default{constructor(){super(...arguments),this._mediaThumbnailNodes={},this._onCallBackButtonRef=e=>{this._callBackButton=e||void 0},this._onInviteButtonRef=e=>{this._inviteButton=e||void 0},this._onHoverStartCallBack=()=>{this.setState({hoveringOverCallBack:!0})},this._onHoverEndCallBack=()=>{this.setState({hoveringOverCallBack:!1})},this._onHoverStartInvite=()=>{this.setState({hoveringOverInvite:!0})},this._onHoverEndInvite=()=>{this.setState({hoveringOverInvite:!1})},this._onPicturePress=e=>{f.log(S.LogTraceArea.CallCard,"Loading MediaViewer for CallCard"),f.track(new c.CallActionEnterFromCallCard),w.default.showWithMessageConfig({initialMessage:e,animateOpenClose:!0,rootViewId:this._getRootViewId(),getContentNode:e=>this._mediaThumbnailNodes[e],origin:S.NavigationMediaViewerOrigin.CallCard}),C.dismissAll()},this._onCallBackButtonPress=()=>{const e=x.default.newCauseId();f.log(S.LogTraceArea.CallCard,"CallCard._onCallBackButtonPress causeId: "+e),r.default.startCallOrMaybePrompt(()=>this._callBackButton,this._getRootViewId(),{skypeMri:this.props.conversationId,userIntent:s.StartCallOrMaybePromptUserIntent.Generic,callOrigin:S.NavigationCallOrigin.CallCard,inviteOrigin:S.ContactInviteOrigin.Unknown},e)},this._onInviteButtonPress=e=>{const t=u.getPhoneNumberFromMri(this.props.conversationId)||"",i=[{text:I.default.formatNumberWithType({number:t,type:L.PhoneNumberTypes.Other}),command:"sms:"+t}],a={anchor:()=>this._inviteButton,useTheme:!0};k.default.showWithOptions({id:N,config:a,getMenuItems:()=>i,handleMenuCommand:this._handleInviteActionCommand,menuTitle:b.getString("CallCard.InviteActionTitle"),rootViewId:this._getRootViewId(),invokingEvent:e})},this._handleInviteActionCommand=e=>{if(e===k.SXActionMenuCancel)return;const t=e.split(":")[1];M.default.initiateJoinLinkInvite({target:new M.SmsInvite(t),origin:S.ContactInviteOrigin.CallCard,showLoadingModalWhileGettingJoinLink:!0,rootViewId:this._getRootViewId()})}}static getConstrainedWidth(){return 200}_buildState(e,t){const i=T.default.isMyMri(e.creatorMri),n={creatorUserColor:i?void 0:p.default.getColorInfo(e.creatorMri),isCreatedByUser:i};if(t&&(n.hoveringOverInvite=!1,n.hoveringOverCallBack=!1),d.default.hasVisibleCall()&&d.default.isCallVisible(e.callId))n.pictures=t?[]:this.state.pictures,n.participants=t?[]:this.state.participants,n.isLargeCard=!t&&this.state.isLargeCard,n.participantsText=t?"":this.state.participantsText,n.shouldShowInviteButton=!t&&this.state.shouldShowInviteButton,n.isMobileScreenReaderEnabled=!t&&this.state.isMobileScreenReaderEnabled;else{let i;if(i=e.cardType===o.CallCardType.Cast?e.conversationId:u.getReactionsThreadMriForCallId(e.callId),i){const e=l.default.getPictureReactions(i,0,!0);n.pictures=a.sortBy(e,e=>e.createdTime),n.reactionsConversationId=i}else n.pictures=t?[]:this.state.pictures;if(n.participants=a.compact(a.map(e.userParticipantMris,e=>e?m.default.getDisplayableProfile(e):void 0)),n.isLargeCard=e.cardType===o.CallCardType.Ended||e.cardType===o.CallCardType.Cast,n.participantsText=this._getFormattedParticipantNames(e.conversationId,e.creatorMri),n.isMobileScreenReaderEnabled=P.default.isMobileScreenReaderEnabled(),e.isPSTN){const t=u.getPhoneNumberFromMri(e.conversationId);if(t){const e=h.default.getSortedUsersByPhoneNumber(t);n.shouldShowInviteButton=0===e.length&&!1}else n.shouldShowInviteButton=!1}}return n}render(){return n.createElement(n.View,{style:[U.container,this.props.containerRadiusStyles],onPress:this.state.isMobileScreenReaderEnabled&&!this.state.isLargeCard?this._onCallBackButtonPress:void 0},this._renderPictures(),this._renderCardFooter())}_renderPictures(){const e=this.state.pictures.length;if(e){let t=[],i=[];const o=2;this._mediaThumbnailNodes={},a.each(this.state.pictures,(a,s)=>{if(s>o)return!1;let r,l=0,c=0;e>=3?0===s?(r=U.pictureTripleMain,l=110,c=100):(r=U.pictureTripleStack,l=55,c=100):2===e?(r=U.pictureDouble,l=110,c=100):1===e&&(r=U.pictureSingle,l=110,c=200);const d=n.createElement(v.default,{ref:e=>{this._mediaThumbnailNodes[a.cuid]={component:e}},message:a,width:c,height:l});let u;s===o&&3!==e&&(u=n.createElement(n.View,{style:U.lastPictureOverlay,blockPointerEvents:!0},n.createElement(O.BodyText,{bold:!0,style:U.lastPictureOverlayText},"+"+(e-s))));const h=n.createElement(n.View,{key:"callPicture"+s,style:r,onPress:()=>this._onPicturePress(a)},d,u);return e<3||0===s?t.push(h):i.push(h),!0});const s=i.length?n.createElement(n.View,{style:U.rightPicturesStackContainer},i):null,r=[U.picturesContainer];return!this.state.isCreatedByUser&&this._themeStyles.bubbleColorOtherStyle&&r.push(this._themeStyles.bubbleColorOtherStyle),n.createElement(n.View,{style:r},t,s)}}_renderCardFooter(){const e=this._isMissedCall(),t=u.isBlockedPSTNMri(this.props.conversationId),i=[V.default.fontStyle.cardAction,this._themeStyles.buttonTextColorStyle,U.optionalButtonText];this.state.hoveringOverCallBack&&i.push(U.optionalButtonHover);const a=e&&!t?n.createElement(n.Button,{ref:this._onCallBackButtonRef,style:[U.optionalButton,this._themeStyles.primaryBorderColorStyle],onPress:this._onCallBackButtonPress,onHoverStart:this._onHoverStartCallBack,onHoverEnd:this._onHoverEndCallBack,underlayColor:this._themeColors.rowHighlightColor},n.createElement(n.Text,{style:i,numberOfLines:1},b.getString("CallCard.CallBackButton"))):null,o=[V.default.fontStyle.cardAction,this._themeStyles.buttonTextColorStyle,U.optionalButtonText];this.state.hoveringOverInvite&&o.push(U.optionalButtonHover);const s=this.state.shouldShowInviteButton&&!t?n.createElement(n.Button,{ref:this._onInviteButtonRef,style:[U.optionalButton,this._themeStyles.primaryBorderColorStyle],onPress:this._onInviteButtonPress,onHoverStart:this._onHoverStartInvite,onHoverEnd:this._onHoverEndInvite},n.createElement(n.Text,{style:o},b.getString("CallCard.InviteButton"))):null,r=[U.cardFooterContainer,this._themeStyles.cardColorStyle];e?r.push(B.default.flexOne):r.push(U.cardFooterContainerEnded);const l=[U.messageText];return R.default.getPlatformType()===S.PlatformType.iOS&&l.push(U.messageTextIOS),n.createElement(n.View,{style:r},n.createElement(O.Subtitle,{style:l,numberOfLines:1},this.props.messageText),n.createElement(O.CardTitle,{style:U.participantsText,numberOfLines:1},this.state.participantsText),n.createElement(n.View,{style:U.durationContainer},n.createElement(y.default,{icon:this.props.iconText,size:E.IconSize.size12,color:this._themeColors.secondaryTextColor,style:U.durationIconMargins}),n.createElement(O.Caption,null,this.props.durationText?this.props.durationText:g.default.getDisplayTimeString(this.props.createdTime))),s,a)}_getFormattedParticipantNames(e,t){const i=u.isThread(e),a=b.getString("DisplayInfoStore.ListMyName"),n=T.default.isMyMri(t)?a:m.default.getShortDisplayName(t);let o="";if(i)o=b.getString("CallCard.CallParticipantsString",{nameA:n,nameB:m.default.getDisplayName(e)||b.getString("Notifications.UnknownUserShort")});else{const i=T.default.isMyMri(t)?m.default.getShortDisplayName(e):a;o=b.getString("CallCard.CallParticipantsString",{nameA:n,nameB:i})}return o}_isMissedCall(){return this.props.cardType===o.CallCardType.Missed}}t.default=F},3368:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(7),o=i(221),s=i(846),r=i(672),l=i(13),c=i(3369),d=i(70),u=i(32),h=i(134),p=i(4),g=i(6),C=i(5),m=i(21),S=i(18),y=i(23),f=i(114),_=i(16),b=i(12),v=i(10),w=g.lazyProperties({textStyle:()=>a.Styles.createTextStyle({justifyContent:"center",alignItems:"center",paddingHorizontal:10}),textStyleSelected:()=>a.Styles.createTextStyle({justifyContent:"center",alignItems:"center"}),markerTextPadding:()=>a.Styles.createViewStyle({paddingTop:4}),container:()=>a.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center",marginLeft:10,marginRight:10,paddingTop:10}),containerComposite:()=>a.Styles.createViewStyle({marginLeft:50,marginRight:0})});class T extends b.default{constructor(){super(...arguments),this._getCallForwardingActionLink=()=>a.createElement(f.default,{key:"callForwardingCTALinkId",style:[w.textStyle,w.markerTextPadding],onPress:this._onCallForwardingButtonPress,url:"#",blue:!0,linkTextStyle:l.LinkTextStyle.Caption},C.getString("CallCard.SetupCallForwardingLink")),this._onCallForwardingButtonPress=()=>{p.track(new c.SetUpCallForwardingClicked),S.default.navigateToCallingSettingsPanel(!1,this._getContext())}}_buildState(e,t){const i=h.default.getCreditEntitlement(),a=!!o.getPositiveCreditBalance(i)||h.default.userHasSubscriptions(),l=s.default.getCallLog(e.callId),c=r.default.calculateCallMarkerInfoFromPath(l,e.callId,e.conversationId,e.markerType,e.duration);return{isUsingStackNavigationContext:y.default.isUsingStackNavigationContext(),callerFirstName:u.default.getMemberShortNameForConversation(e.conversationId,e.callerMri),isCallerTheCurrentUser:m.default.isMyMri(e.callerMri),isPayingUser:a,enablePaidUsersCallForwardingUpsell:n.default.getS4LCommerceFeatures().creditUpsell.enablePaidUsersCallForwardingUpsell,enableAllUsersCallForwardingUpsell:n.default.getS4LCommerceFeatures().creditUpsell.enableAllUsersCallForwardingUpsell,markerType:c.type,duration:c.duration}}render(){let e,t,i,n;const o=this.state.markerType;switch(o){case r.CallMarkerType.Started:e=C.getString("CallCard.CallStartedMarker");break;case r.CallMarkerType.Missed:this.state.isCallerTheCurrentUser?e=C.getString("CallCard.MissedCallMarker"):(e=C.getString("CallCard.MissedCallFromCallerMarker",{caller:this.state.callerFirstName}),(this.state.enablePaidUsersCallForwardingUpsell&&this.state.isPayingUser||this.state.enableAllUsersCallForwardingUpsell)&&(n=this._getCallForwardingActionLink()));break;case r.CallMarkerType.Ended:e=this.props.messagesSentDuringCall?C.getString("CallCard.CallEndedMarker"):C.getString("CallCard.CallMarker"),this.state.duration&&(t=d.default.getFormattedDuration(this.state.duration,!1),i=d.default.getFormattedDuration(this.state.duration,!0));break;case r.CallMarkerType.Declined:e=C.getString("CallCard.CallDeclinedStatusMessage");break;case r.CallMarkerType.NoAnswer:e=C.getString("CallCard.CallNoAnswerStatusMessage");break;case r.CallMarkerType.Failed:e=C.getString("CallCard.CallFailedStatusMessage");break;default:v.default.switchStatementExhaustiveChecking(o)}const s=a.createElement(_.Caption,{selected:!0,style:[w.textStyleSelected,this.props.style],key:"callMarkerText"},e),l=t?C.getParts("CallCard.Marker",{markerText:s,markerValue:t}):s;let c=e;e&&i&&(c=C.getString("AccessibilityLabel.CallMarker",{markerText:e,duration:i}));const u=a.createElement(a.View,{accessibilityLabel:c,accessibilityTraits:a.Types.AccessibilityTrait.Text},a.createElement(_.Caption,{style:[w.textStyle,w.markerTextPadding,this.props.style],textThemeColor:_.TextThemeColor.Secondary,accessibilityHidden:!0},l)),h=[w.container];this.state.isUsingStackNavigationContext||this._getContext().isPresentedInDesktopSubview||h.push(w.containerComposite);const p=a.createElement(_.Caption,{style:[w.textStyle,this.props.style]},d.default.getDisplayTimeString(this.props.timestamp));return a.createElement(a.View,{style:h,key:"callMarker-"+this.props.callId},p,u,n)}}t.default=T},3424:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(35),n=i(73),o=i(0),s=i(57),r=i(145),l=i(50),c=i(13),d=i(79),u=i(3),h=i(4),p=i(6),g=i(5),C=i(82),m=i(27),S=i(36),y=i(59),f=i(174),_=i(42),b=i(14),v=i(16),w=i(10),T=p.lazyProperties({container:()=>o.Styles.createViewStyle({flex:1,flexDirection:"column",justifyContent:"center",alignItems:"center"}),containerLandscape:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"center",alignItems:"center"}),innerContainer:()=>o.Styles.createViewStyle({flexBasis:0,flex:1,justifyContent:"center",alignItems:"stretch",alignSelf:"stretch"}),imageContainer:()=>o.Styles.createViewStyle({flexBasis:0,flex:1,alignSelf:"stretch"}),headerText:()=>o.Styles.createTextStyle({marginVertical:15,marginHorizontal:10,textAlign:"center"}),descriptionText:()=>o.Styles.createTextStyle({marginBottom:15,marginHorizontal:10,textAlign:"center"}),button:()=>o.Styles.createButtonStyle({marginHorizontal:20,alignSelf:"stretch"})});class I extends l.default{constructor(){super(...arguments),this._onBack=()=>(this._submitPressedTrue(),!0),this._submitPressedTrue=()=>this._submitPressed(!0),this._submitPressedFalse=()=>this._submitPressed(!1)}_buildState(e,t){const i=this._getRootViewId();return{isLandscape:m.default.getDeviceOrientation(i)===a.DeviceOrientation.Landscape,safeAreaHorizontalInsets:S.default.horizontalInsets()}}componentDidMount(){super.componentDidMount(),d.dismissAll(),r.default.subscribe(this._onBack)}componentWillUnmount(){super.componentWillUnmount(),r.default.unsubscribe(this._onBack)}render(){const e=this._getHeaderText(this.state),t=[T.innerContainer];this.state.safeAreaHorizontalInsets.right&&t.push(y.default.horizontalPaddingStyle({right:this.state.safeAreaHorizontalInsets.right,left:0}));const i=o.createElement(o.View,{style:this.state.isLandscape?T.containerLandscape:T.container},o.createElement(o.View,{style:T.imageContainer},o.createElement(o.Image,{source:s.Collection.ANDROID_CALL_MONITOR_PERM_ILLUSTRATION,style:b.default.flexOne,resizeMode:"cover"})),o.createElement(o.View,{style:t},o.createElement(v.PanelHeader,{style:T.headerText},e),o.createElement(v.BodyText,{style:T.descriptionText},g.getString("AndroidCallMonitorPermissionsPanel.DescriptionText")),o.createElement(_.default,{style:T.button,buttonStyle:c.SXButtonStyle.BlueFill,onPress:this._submitPressedFalse,title:g.getString("AndroidCallMonitorPermissionsPanel.GrantPermissionButtonTitle")}),o.createElement(_.default,{buttonStyle:c.SXButtonStyle.ThemeNoBackground,buttonSize:c.SXButtonSize.Medium,style:T.button,onPress:this._submitPressedTrue,title:g.getString("AndroidCallMonitorPermissionsPanel.NotNowButtonTitle")})));return o.createElement(f.default,{dialogId:this.props.dialogId,containerStyle:this._themeStyles.primaryBackgroundColorStyle,closeOnClickOutside:!0,maxWidth:void 0,maxHeight:void 0,fullScreen:!0,useFullSizeContainer:!0,accessibilityLabel:e},o.createElement(o.View,{style:[b.default.flexOne,this._themeStyles.primaryBackgroundColorStyle]},i))}_submitPressed(e){const t=w.default.newCauseId();h.log(u.LogTraceArea.Navigation,"AndroidCallMonitorPermissionPanel._submitPressed, causeId"+t),this.isComponentMounted(),C.default.updateDrawOverPrePermissionStatus(e?n.PermissionStatus.Denied:n.PermissionStatus.Granted),e||n.default.requestDrawOverPermission(),this._goBack(t)}_getHeaderText(e){return g.getString("AndroidCallMonitorPermissionsPanel.HeaderText")}}t.default=I},3425:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.testableSubmitPressed=void 0;const a=i(1),n=i(336),o=i(35),s=i(0),r=i(153),l=i(856),c=i(145),d=i(50),u=i(1133),h=i(88),p=i(17),g=i(43),C=i(13),m=i(286),S=i(234),y=i(79),f=i(32),_=i(3),b=i(86),v=i(141),w=i(26),T=i(4),I=i(6),P=i(327),M=i(5),k=i(30),A=i(27),R=i(36),V=i(59),E=i(174),L=i(44),B=i(42),O=i(9),D=i(20),x=i(24),N=i(11),U=i(14),F=i(16),H=i(101),z=i(65),G=i(10),W=I.lazyProperties({starsPage:()=>s.Styles.createViewStyle({flex:1,alignItems:"center"}),starsPageInnerContainer:()=>s.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center",paddingTop:20}),starsPageInner:()=>s.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"space-around"}),starsContainer:()=>s.Styles.createViewStyle({flexDirection:"row",alignSelf:"stretch",justifyContent:"space-between"}),problemSectionContainer:()=>s.Styles.createViewStyle({flexDirection:"column",alignItems:"stretch",paddingLeft:10}),problemSectionTitle:()=>s.Styles.createTextStyle({paddingTop:20,paddingBottom:10}),checkboxAndTextContainer:()=>s.Styles.createViewStyle({justifyContent:"center",paddingVertical:5,paddingRight:5,borderBottomWidth:1,minHeight:50}),checkbox:()=>s.Styles.createViewStyle({position:"absolute",right:0,top:12}),problem:()=>s.Styles.createTextStyle({marginRight:48}),starIconSmall:()=>s.Styles.createViewStyle({alignItems:"center"}),starIconDeselected:()=>s.Styles.createViewStyle({opacity:.7}),starText:()=>s.Styles.createTextStyle({textAlign:"center",width:200}),footer:()=>s.Styles.createViewStyle({height:120,alignSelf:"stretch"}),footerLandscape:()=>s.Styles.createViewStyle({height:60,alignSelf:"stretch"}),footerButton:()=>s.Styles.createViewStyle({height:60,alignSelf:"stretch",justifyContent:"center",alignItems:"center"}),titleContainer:()=>s.Styles.createViewStyle({alignSelf:"stretch",justifyContent:"center",alignItems:"center",paddingTop:10}),title:()=>s.Styles.createTextStyle({alignSelf:"stretch",textAlign:"center",marginBottom:5,marginTop:10,marginHorizontal:15}),subtitle:()=>s.Styles.createTextStyle({alignSelf:"stretch",textAlign:"center",marginHorizontal:15}),body:()=>s.Styles.createTextStyle({marginVertical:20,marginHorizontal:10}),rateUsPage:()=>s.Styles.createViewStyle({flex:1,paddingVertical:10}),rateUsSectionContainer:()=>s.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center",paddingHorizontal:10}),rateUsButton:()=>s.Styles.createButtonStyle({flex:1,alignSelf:"stretch"}),rateUsFooter:()=>s.Styles.createViewStyle({height:120,marginHorizontal:10,alignSelf:"stretch"}),rateUsFooterLandscape:()=>s.Styles.createViewStyle({height:60,marginHorizontal:10,alignSelf:"stretch",flexDirection:"row"}),rateUsText:()=>s.Styles.createTextStyle({marginTop:20,marginHorizontal:10,textAlign:"center"})});class K extends d.default{constructor(){super(...arguments),this._submitPressedTrue=()=>this._submitPressed(!0),this._submitPressedFalse=()=>this._submitPressed(!1),this._toggleForStar1=e=>this._starToggled(e,1),this._toggleForStar2=e=>this._starToggled(e,2),this._toggleForStar3=e=>this._starToggled(e,3),this._toggleForStar4=e=>this._starToggled(e,4),this._toggleForStar5=e=>this._starToggled(e,5),this._contentForSection=e=>{const t=M.getStringUnsafe("CallQualityFeedback."+e.title);return s.createElement(s.View,{style:W.problemSectionContainer,key:e.title},s.createElement(F.Subtitle,{style:W.problemSectionTitle},t),a.map(e.problems,this._contentForProblem))},this._contentForProblem=e=>{const t="CallQualityFeedback."+e,i=M.getStringUnsafe(t),n=a.includes(this.state.checkedProblems,e),o=[s.Types.AccessibilityTrait.CheckBox];n&&o.push(s.Types.AccessibilityTrait.Checked);const r=i;return s.createElement(s.Button,{key:e,accessibilityTraits:o,accessibilityLabel:r,onPress:t=>this._problemTokenToggled(t,e)},s.createElement(b.default,{style:[W.checkboxAndTextContainer,this._themeStyles.dividerBorderColorStyle]},s.createElement(F.BodyText,{style:W.problem},i),s.createElement(s.View,{style:W.checkbox},s.createElement(P.default,{isOn:n}))))},this._onBack=()=>(this._submitPressedTrue(),T.log(_.LogTraceArea.HardwareBackButton,"goBack: true componentId: CallQualityFeedbackPanel"),!0)}_buildState(e,t){const i=Object.assign({top:R.default.statusBarPadding(),bottom:R.default.bottomSafeAreaInset(C.BottomInsetDefault)},R.default.horizontalInsets(C.HorizontalInsetDefault)),a=this._getRootViewId();let n={displayName:f.default.getDisplayName(e.conversationMri),isOneOnOne:p.isOneOnOneConversation(e.conversationMri),isLandscape:!this._getContext().isPresentedInDesktopSubview&&A.default.getDeviceOrientation(a)===o.DeviceOrientation.Landscape,isSmallDevice:A.default.isSmallDevice(a),isMobileScreenSize:A.default.isMobileScreenSize(a),safeAreaInsets:i};return t&&(n.stars=0,n.renderingProblems=!1,n.renderingRateUs=!1,n.checkedProblems=[]),n}componentDidMount(){super.componentDidMount(),y.dismissAll(),c.default.subscribe(this._onBack)}componentWillUnmount(){super.componentWillUnmount(),c.default.unsubscribe(this._onBack)}render(){const e=this.state.renderingProblems?this._contentForProblemsPage():this.state.renderingRateUs?this._contentForRateUsPage():this._contentForStarsPage();return s.createElement(E.default,{dialogId:this.props.dialogId,containerStyle:this._themeStyles.primaryBackgroundColorStyle,closeOnClickOutside:!0,maxWidth:this.state.isMobileScreenSize?void 0:S.DefaultWidth,maxHeight:this.state.isMobileScreenSize?void 0:S.DefaultHeight,fullScreen:this.state.isMobileScreenSize,useFullSizeContainer:!0,accessibilityLabel:e.accessibilityLabel},s.createElement(s.View,{style:[U.default.flexOne,this._themeStyles.primaryBackgroundColorStyle]},e.content))}_headerCloseButton(){return{closeButtonType:L.CloseButtonType.Close,title:M.getString("Global.CloseButtonTitle"),onPress:this._submitPressedTrue,color:this._themeColors.primaryIconColor}}_contentForStarsPage(){let e;e=this.state.isOneOnOne?s.createElement(H.UserIcon,{userMri:this.props.conversationMri,size:this.state.isLandscape?z.UserIconSize.Size60:z.UserIconSize.Size120}):s.createElement(m.ConversationIcon,{conversationId:this.props.conversationMri,altName:this.state.displayName,size:this.state.isLandscape?z.ConversationIconSize.Size60:z.ConversationIconSize.Size120});const t=[x.default.messagingHeaderFontStyle(!!this.state.isLandscape),this._themeStyles.primaryTextColorStyle,W.title],i=[W.titleContainer];this.state.safeAreaInsets.top&&i.push(V.default.paddingTopStyle(this.state.safeAreaInsets.top));const a=s.createElement(s.View,{style:i},s.createElement(s.Text,{style:t,numberOfLines:1},this.state.displayName),s.createElement(F.Subtitle,{style:W.subtitle},p.isEncryptedThread(this.props.conversationMri)?M.getString("CallQualityFeedback.SubtitleEncrypted"):M.getString("CallQualityFeedback.Subtitle"))),n=M.getString("CallQualityFeedback.Title");return{content:s.createElement(s.View,{style:W.starsPage},a,s.createElement(s.View,{style:W.starsPageInnerContainer},s.createElement(s.View,{style:W.starsPageInner},e,s.createElement(F.BodyText,{bold:!0,style:W.starText},n),s.createElement(s.View,{style:W.starsContainer},this._contentForStar(1,this._toggleForStar1),this._contentForStar(2,this._toggleForStar2),this._contentForStar(3,this._toggleForStar3),this._contentForStar(4,this._toggleForStar4),this._contentForStar(5,this._toggleForStar5)))),this._renderFooter()),accessibilityLabel:n}}_accessibilityLabelForStarNum(e){switch(e){case 1:return M.getString("CallQualityFeedback.1-StarAccessibilityLabel");case 2:return M.getString("CallQualityFeedback.2-StarAccessibilityLabel");case 3:return M.getString("CallQualityFeedback.3-StarAccessibilityLabel");case 4:return M.getString("CallQualityFeedback.4-StarAccessibilityLabel");default:case 5:return M.getString("CallQualityFeedback.5-StarAccessibilityLabel")}}_contentForStar(e,t){const i=this.state.stars||0,a=[W.starIconSmall],n=i<e;n&&a.push(W.starIconDeselected);let o=this._accessibilityLabelForStarNum(e);return i===e&&(o+=", "+M.getString("Global.SelectedAccessibilityLabel")),s.createElement(v.HoverableButton,{onPress:t,accessibilityLabel:o},s.createElement(w.default,{icon:n?N.SkypeIcon.Favourite:N.SkypeIcon.FavouriteFilled,size:N.IconSize.size32,color:O.Color.blue,style:a}))}_contentForProblemsPage(){const e=this._headerCloseButton(),t={icon:N.SkypeIcon.Send,title:M.getString("Global.SendButtonTitle"),disabled:a.isEmpty(this.state.checkedProblems),onPress:this._submitPressedFalse,flipIcon:this._getContext().isRTL},i=s.createElement(L.SimplePanelHeader,{panelName:M.getString("CallQualityFeedback.ProblemsTitle"),leftButton:e,rightButtons:t});let n;n=1===a.size(this.props.problemSections)?this.props.problemSections[0].type===u.ProblemSectionType.Audio?M.getString("CallQualityFeedback.ProblemsAudioBody"):M.getString("CallQualityFeedback.ProblemsVideoBody"):M.getString("CallQualityFeedback.ProblemsAudioAndVideoBody");const o=[W.problemSectionContainer];return V.default.hasHorizontalSafeAreas(this.state.safeAreaInsets)&&o.push(V.default.horizontalPaddingStyle(this.state.safeAreaInsets)),{content:s.createElement(s.View,{style:U.default.flexOne},i,s.createElement(s.ScrollView,{style:U.default.flexOne},s.createElement(s.View,{style:o},s.createElement(F.BodyText,{style:W.body},n),a.map(this.props.problemSections,this._contentForSection)))),accessibilityLabel:n}}_contentForRateUsPage(){const e=[W.rateUsPage];this.state.safeAreaInsets.top&&e.push(V.default.paddingTopStyle(this.state.safeAreaInsets.top)),this.state.safeAreaInsets.bottom&&e.push(V.default.paddingBottomStyle(this.state.safeAreaInsets.bottom));const t=M.getString("CallQualityFeedback.RateTheAppBody");return{content:s.createElement(s.View,{style:e},s.createElement(F.PanelHeader,{landscape:this.state.isLandscape,style:W.rateUsText},M.getString("CallQualityFeedback.Thanks")),s.createElement(F.BodyText,{style:W.rateUsText},t),s.createElement(s.View,{style:W.rateUsSectionContainer},s.createElement(r.AnimatedEmoticon,{size:this.state.isLandscape?r.Size.ExtraLarge:r.Size.ExtraExtraLarge,innerText:"like",emoticonName:"like",showPlaceHolder:!0,standaloneAnimation:!0})),s.createElement(s.View,{style:this.state.isLandscape?W.rateUsFooterLandscape:W.rateUsFooter},s.createElement(B.default,{style:W.rateUsButton,buttonStyle:C.SXButtonStyle.BlueFill,onPress:this._submitPressedFalse,title:M.getString("CallQualityFeedback.RateTheApp")}),s.createElement(B.default,{style:W.rateUsButton,buttonSize:C.SXButtonSize.Medium,buttonStyle:C.SXButtonStyle.ThemeNoBackground,title:M.getString("CapturePermissions.PrePromptCancelButtonTitle"),onPress:this._submitPressedTrue}))),accessibilityLabel:t}}_renderFooter(){let e;this.state.renderingProblems||this.state.renderingRateUs||(e={title:this.state.stars?M.getString("Global.SendButtonTitle"):M.getString("Global.CancelLabel"),onPress:this.state.stars?this._submitPressedFalse:this._submitPressedTrue});const t=e?s.createElement(B.default,{style:W.footerButton,buttonSize:C.SXButtonSize.Medium,buttonStyle:C.SXButtonStyle.ThemeNoBackground,title:e.title,onPress:e.onPress}):void 0;return s.createElement(s.View,{style:this.state.isLandscape?W.footerLandscape:W.footer},t)}_submitPressed(e){const t=G.default.newCauseId();T.log(_.LogTraceArea.Navigation,"CallQualityFeedbackPanel._submitPressed,  causeId: "+t),this.isComponentMounted(),j(this.props,this.state,e=>{this.isComponentMounted()&&this.setState(e)},e)&&this._goBack(t)}_problemTokenToggled(e,t){e.stopPropagation();let i=!1;const n=this.state.checkedProblems?a.clone(this.state.checkedProblems):[];a.includes(n,t)?a.remove(n,e=>e===t):(n.push(t),i=!0);const o="CallQualityFeedback."+t,r=M.getStringUnsafe(o)+", "+(i?M.getString("FeedbackMechanism.AccLabelCheckboxChecked"):M.getString("FeedbackMechanism.AccLabelCheckboxUnchecked"));s.Accessibility.announceForAccessibility(r),this.setState({checkedProblems:n})}_starToggled(e,t){e.stopPropagation();const i=g.default.combinedAccessibilityLabel(this._accessibilityLabelForStarNum(t),M.getString("Global.SelectedAccessibilityLabel"));i&&s.Accessibility.announceForAccessibility(i),this.setState({stars:t})}_getCheckboxAccessibilityLabel(e,t){const i=this._getCheckboxCheckedState(t);return M.getString("FeedbackMechanism.AccLabelCheckbox",{checkboxTitle:e,state:i})}_getCheckboxCheckedState(e){return e?M.getString("FeedbackMechanism.AccLabelCheckboxChecked"):M.getString("FeedbackMechanism.AccLabelCheckboxUnchecked")}_getHeaderText(e){return K.getHeaderText()}static getHeaderText(){return M.getString("CallQualityFeedback.Title")}}function j(e,t,i,a){if(t.renderingRateUs)return a||(l.openAppStore(),k.default.setUserPreferencesLocal({lastRateUsPromptInfo:{version:D.default.getAppVersion(),timestamp:Date.now()}})),!0;if(a||t.renderingProblems||5===t.stars){const i=t.stars?"random":"cancel",a=t.stars||void 0,o=t.stars&&t.stars<5?u.tokensString(t.checkedProblems||[]):void 0;let s=new h.CQF(e.callId,e.endpointId,e.nodeId,e.participantId,a,o,105,i,e.pstnCdrId,e.maxConnectedParticipants);return T.log(_.LogTraceArea.CallQualityFeedback,"CQF: submitting event. reason: "+i+", stars: "+a+", problemTokens: "+o),T.track(s),n.default.provideCallQualityFeedback(e.callId,e.participantId,"105",i,a?a-1:0,o),!0}return i({renderingProblems:!0}),!1}t.default=K,t.testableSubmitPressed=j},3454:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(74),s=i(97),r=i(7),l=i(29),c=i(53),d=i(13),u=i(67),h=i(3),p=i(41),g=i(4),C=i(229),m=i(125),S=i(6),y=i(5),f=i(30),_=i(27),b=i(395),v=i(1674),w=i(1675),T=i(3455),I=i(174),P=i(42),M=i(9),k=i(24),A=i(11),R=i(77),V=i(28),E=i(14),L=i(16),B=i(12),O=i(31),D=M.Color.gray400,x=S.lazyProperties({panel:()=>n.Styles.createViewStyle({flex:1,flexDirection:"column",alignSelf:"stretch",backgroundColor:D}),modalContainerForAll:()=>n.Styles.createViewStyle({flex:1,flexDirection:"column",alignItems:"center",justifyContent:"flex-start",padding:20}),sourcesLists:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",marginHorizontal:40,justifyContent:"flex-start",alignSelf:"center"}),screensSourcesList:()=>n.Styles.createViewStyle({flex:1,flexDirection:"column",justifyContent:"center",flexWrap:"wrap"}),windowsSourcesList:()=>n.Styles.createViewStyle({flex:1,flexWrap:"wrap",flexDirection:"column",justifyContent:"center"}),title:()=>n.Styles.createViewStyle({marginBottom:30}),titleText:()=>n.Styles.createTextStyle({color:M.Color.white,fontSize:k.default.controlFontSize.cardTitle}),divider:()=>n.Styles.createViewStyle({flex:1,height:void 0,minWidth:2}),sourceListScreen:()=>n.Styles.createViewStyle({justifyContent:"flex-start"}),sourceListWindow:()=>n.Styles.createViewStyle({flexWrap:"wrap",flexDirection:"row",justifyContent:"flex-start"}),buttons:()=>n.Styles.createViewStyle({flexDirection:"row"}),button:()=>n.Styles.createViewStyle({marginHorizontal:10,marginTop:15,width:180}),modalAudioLabelContainer:()=>n.Styles.createViewStyle({paddingHorizontal:4,flexDirection:"row",alignItems:"center",justifyContent:"center",alignSelf:"stretch",marginTop:15}),includeAudioLabel:()=>n.Styles.createTextStyle({color:M.Color.white}),audioMargin:()=>n.Styles.createViewStyle({marginRight:10}),sectionHeader:()=>n.Styles.createTextStyle({color:M.Color.white,marginLeft:5,marginBottom:10}),closeButton:()=>n.Styles.createViewStyle({alignSelf:"flex-start",justifyContent:"center",height:50,paddingLeft:15,paddingRight:15})});class N extends B.default{constructor(){super(...arguments),this._onAudioToggleChange=(e,t)=>{e.stopPropagation(),g.log(h.LogTraceArea.CallingUI,"ScreenSharingPanel._onAudioToggleChange"),this.setState({includeAudio:t},()=>{O.default.setTimeout(()=>{this.isComponentMounted()&&this._audioToggleRef&&this._audioToggleRef.focusToggle()},100)})},this._onEscape=()=>(g.log(h.LogTraceArea.CallingUI,"ScreenSharingPanel._onEscape"),this._onClose(v.ScreenSharingPanelCancelOrigin.Esc),!0),this._onAudioToggleRef=e=>{this._audioToggleRef=e||void 0},this._onClose=e=>{var t;this.props.onClose&&(g.track(new v.ScreenSharingPanelCancelEvent(e,this.state.screensSourcesList.length,(null===(t=this.state.windowsSourcesList)||void 0===t?void 0:t.length)||0,this.props.isScreenSharingActive)),this.props.onClose())},this._onSourceSelected=(e,t)=>{g.log(h.LogTraceArea.CallingUI,"ScreenSharingPanel: _onSourceSelected "+o.SharingSourceType[this.state.selectedSourcesType]),t&&this.state.isNavigatingWithKeyboard?this._shareScreen(v.ScreenSharingStartOrigin.EnterWithKeyboardNavigation):this.setState({selectedSource:e})},this._shareScreen=e=>{var t;this.state.selectedSource&&(g.track(new v.ScreenSharingPanelStartedSharingEvent(this.state.selectedSource.getType(),e,this.state.screensSourcesList.length,(null===(t=this.state.windowsSourcesList)||void 0===t?void 0:t.length)||0,this.props.isScreenSharingActive)),this.props.onSelectSource(this.state.selectedSource,this.state.includeAudio,this.state.selectedSource.getType()))}}_buildState(e,t){t&&(this._rootViewId=this._getRootViewId());let i=c.CallingCapabilities.applicationSharingSupported(),n=_.default.getWidth(this._rootViewId);const s=b.default.responsiveWidthForSize(n),d=l.default.DeviceStore.getAvailableScreens(),u=i?l.default.DeviceStore.getAvailableWindows():void 0;let p,m;t?(p=e.currentScreenSharingSource||a.first(d),m=e.currentScreenSharingSourceType||o.SharingSourceType.Monitor,l.default.DeviceStore.fetchAvailableWindows()):(p=this.state.selectedSource,m=this.state.selectedSourcesType),g.log(h.LogTraceArea.CallingUI,"created new state screensSourcesList "+d.length+" windowSharingEnabled "+i),u&&g.log(h.LogTraceArea.CallingUI,"windowsSourcesList "+u.length);const S=r.default.getS4LCMCFeatures(),y=!this._useDarkTheme()&&S.enableLightThemeOnCallStage&&S.enableNewCallScreen&&f.default.getNewCallScreenDesignEnabled(),v=this._useAccessibleTheme(),w=y||v;return{includeAudio:t?!!e.initialShareSounds:this.state.includeAudio,screensSourcesList:d,windowsSourcesList:u||[],hasWindowsSection:!!(null==u?void 0:u.length),appWidth:n,selectedSourcesType:m,selectedSource:p,screenSize:s,isNavigatingWithKeyboard:C.default.isNavigatingWithKeyboard(),useHighContrastTheme:v,useDefaultTheme:w}}componentDidMount(){super.componentDidMount(),m.default.addEscapeHandler(this._onEscape),this._windowsInterval=O.default.setInterval(()=>l.default.DeviceStore.fetchAvailableWindows(),1e3)}componentWillUnmount(){super.componentWillUnmount(),m.default.removeEscapeHandler(this._onEscape),O.default.clearInterval(this._windowsInterval),l.default.DeviceStore.clearAvailableWindows()}render(){const e=w.default.getWindowSourceItemDimensions(),t=this.state.appWidth<=650?e.width:this.state.screenSize<=V.ResponsiveWidth.Tiny?2*e.width:void 0,i=[x.windowsSourcesList,n.Styles.createViewStyle({maxWidth:t},!1)],a=[x.sectionHeader];this.state.useDefaultTheme&&a.push(this._themeStyles.primaryTextColorStyle);const o=this.state.hasWindowsSection&&[n.createElement(u.default,{key:"divider",style:x.divider,color:this.state.useDefaultTheme?this._themeColors.dividerColor:M.Color.gray200Overlay20,marginRight:25,marginLeft:18}),n.createElement(n.View,{style:i,key:"windowsList"},n.createElement(L.RowTitle,{style:a},y.getString("ScreenSharingModal.WindowsSection")),n.createElement(T.ScreenSharingSourceList,{style:x.sourceListWindow,sourcesList:this.state.windowsSourcesList,itemWidth:e.width,itemHeight:e.height,currentScreenSharingSource:this.props.currentScreenSharingSource,isNavigatingWithKeyboard:this.state.isNavigatingWithKeyboard,shareScreen:this._shareScreen,selectedSource:this.state.selectedSource,onSourceSelected:this._onSourceSelected,accessibilityLabel:y.getString("ScreenSharingModal.WindowsSection"),useHighContrastTheme:this.state.useHighContrastTheme,useDefaultTheme:this.state.useDefaultTheme}))],s=[x.titleText];this.state.useDefaultTheme&&s.push(this._themeStyles.primaryTextColorStyle);const r=w.default.getScreenSourceItemDimensions(this.state.screenSize,!this.state.hasWindowsSection,this.state.screensSourcesList.length),l=[x.screensSourcesList,n.Styles.createViewStyle({minWidth:r.width},!1)],d=c.CallingCapabilities.screenSharingWithSoundSupported(),h=n.createElement(n.View,{style:x.modalContainerForAll},n.createElement(n.View,{style:x.title},n.createElement(L.RowTitle,{style:s},y.getString("ScreenSharingModal.Title"))),n.createElement(n.View,{style:x.sourcesLists},n.createElement(n.View,{style:l},n.createElement(L.RowTitle,{style:a},y.getString("ScreenSharingModal.ScreensSection")),n.createElement(T.ScreenSharingSourceList,{style:this.state.hasWindowsSection?x.sourceListScreen:x.sourceListWindow,sourcesList:this.state.screensSourcesList,itemWidth:r.width,itemHeight:r.height,currentScreenSharingSource:this.props.currentScreenSharingSource,isNavigatingWithKeyboard:this.state.isNavigatingWithKeyboard,shareScreen:this._shareScreen,selectedSource:this.state.selectedSource,onSourceSelected:this._onSourceSelected,accessibilityLabel:y.getString("ScreenSharingModal.ScreensSection"),useHighContrastTheme:this.state.useHighContrastTheme,useDefaultTheme:this.state.useDefaultTheme})),o),c.CallingCapabilities.screenSharingWithSoundSupported()&&this._getAudioToggle(),n.createElement(n.View,{style:this.state.screenSize>V.ResponsiveWidth.MinDesktop?x.buttons:void 0},this._getCancelButton(),this._getStartSharingButton())),p=[x.panel];return this.state.useDefaultTheme&&p.push(this._themeStyles.primaryBackgroundColorStyle),n.createElement(I.default,{dialogId:"screenShare",onClickOutside:()=>this._onClose(v.ScreenSharingPanelCancelOrigin.ClickOutside),maxWidth:w.default.getModalWidth(this.state.screenSize,this.state.screensSourcesList.length,this.state.windowsSourcesList.length),maxHeight:w.default.getModalHeigh(this.state.screensSourcesList.length,this.state.windowsSourcesList.length,d),fullScreen:this.state.screenSize<=V.ResponsiveWidth.Tiny,useFullSizeContainer:!0},n.createElement(n.View,{style:p},this.state.screenSize<=V.ResponsiveWidth.Tiny&&this._getBackButton(),h))}_getBackButton(){return n.createElement(p.default,{style:x.closeButton,icon:R.closeIcon(),size:A.IconSize.size24,title:y.getString("Global.CloseButtonTitle"),onPress:()=>this._onClose(v.ScreenSharingPanelCancelOrigin.BackButton),color:M.Color.white,hoverColor:M.Color.whiteOverlay70})}_getAudioToggle(){const e=n.createElement(s.default,{ref:this._onAudioToggleRef,isOn:this.state.includeAudio,accessibilityLabel:y.getString("ScreenSharingModal.IncludeAudioToggleAccessibilityLabel"),onChange:this._onAudioToggleChange,style:E.default.alignItemsCenter}),t=[x.includeAudioLabel];this.state.useDefaultTheme&&t.push(this._themeStyles.primaryTextColorStyle);const i=n.createElement(n.View,{style:x.audioMargin},n.createElement(L.RowTitle,{style:t},y.getString("ScreenSharingModal.IncludeAudioText")));return n.createElement(n.View,{style:x.modalAudioLabelContainer},i,e)}_getCancelButton(){let e=this.state.useHighContrastTheme?d.SXButtonStyle.ThemeStroke:d.SXButtonStyle.ColorStroke;return n.createElement(P.default,{title:y.getString("ScreenSharingModal.Cancel"),style:x.button,buttonStyle:e,buttonSize:d.SXButtonSize.Medium,onPress:()=>this._onClose(v.ScreenSharingPanelCancelOrigin.CancelButton)})}_getStartSharingButton(){const e=this.state.useHighContrastTheme?d.SXButtonStyle.ThemeFill:d.SXButtonStyle.ColorFill;return n.createElement(P.default,{title:this._getScreenShareButtonText(),style:x.button,buttonStyle:e,buttonSize:d.SXButtonSize.Medium,onPress:()=>this._shareScreen(v.ScreenSharingStartOrigin.StartButton),disabled:!this.state.selectedSource})}_getScreenShareButtonText(){return this.props.isScreenSharingActive?this.state.selectedSourcesType&&this.state.selectedSourcesType===o.SharingSourceType.Window?y.getString("ScreenSharingModal.SwitchWindow"):y.getString("ScreenSharingModal.SwitchScreen"):this.state.hasWindowsSection?y.getString("ScreenSharingModal.ShareScreenOrWindow"):this.state.includeAudio?y.getString("ScreenSharingModal.ShareScreenAndSounds"):y.getString("ScreenSharingModal.ShareScreen")}}t.default=N},3455:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSharingSourceList=void 0;const a=i(1),n=i(0),o=i(15),s=i(74),r=i(43),l=i(106),c=i(6),d=i(5),u=i(121),h=i(1674),p=i(3456),g=c.lazyProperties({scrollView:()=>n.Styles.createScrollViewStyle({marginRight:-30,flex:1})});class C extends o.ComponentBase{constructor(){super(...arguments),this._mountedSourceRefsMap=new u.default,this._onKeyPress=e=>{let t=this.state.focusedIndex;e.keyCode!==l.default.UP&&e.keyCode!==l.default.LEFT||(t-=1),e.keyCode!==l.default.DOWN&&e.keyCode!==l.default.RIGHT||(t+=1),t<0||t>=this.props.sourcesList.length||this.isComponentMounted()&&this.setState({focusedIndex:t})}}_buildState(e,t){return{focusedIndex:t?0:this.state.focusedIndex}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.focusedIndex!==t.focusedIndex&&this._focusItem(this.state.focusedIndex)}render(){return n.createElement(n.ScrollView,{style:g.scrollView,onKeyPress:this._onKeyPress},n.createElement(n.View,{style:this.props.style},this._getAvailableSharingSources()))}_focusItem(e=0){if(e<0||e>=this.props.sourcesList.length)return;const t=this._mountedSourceRefsMap.ref("source"+e);null==t||t.requestFocus()}_getAvailableSharingSources(){return a.map(this.props.sourcesList,(e,t)=>{const i=!!this.props.selectedSource&&e.getId()===this.props.selectedSource.getId(),a=!!this.props.currentScreenSharingSource&&e.getId()===this.props.currentScreenSharingSource.getId(),o=e.getId(),l=e.getDescription(),c=e.getType()===s.SharingSourceType.Monitor?"ScreenSharingModal.DesktopAccessibilityLabel":"ScreenSharingModal.WindowAccessibilityLabel";let u=d.getString(c,{description:l,currentItemIndex:t+1,numberOfItems:this.props.sourcesList.length});return i&&(u=r.default.combinedAccessibilityLabel(u,d.getString("Global.SelectedAccessibilityLabel"))||""),n.createElement(p.default,{ref:this._mountedSourceRefsMap.onComponentRef("source"+t),tabIndex:this.state.focusedIndex===t?0:-1,key:o,sourceDetails:e,onSourceSelected:this.props.onSourceSelected,isSelected:i,screenIndex:t,width:this.props.itemWidth-8,height:this.props.itemHeight,borderWidth:4,currentlyShared:a,onDoubleTap:()=>this.props.shareScreen(h.ScreenSharingStartOrigin.DoubleClickSource),accessibilityLabel:u,useHighContrastTheme:this.props.useHighContrastTheme,useDefaultTheme:this.props.useDefaultTheme})})}}t.ScreenSharingSourceList=C},3456:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(74),o=i(88),s=i(3),r=i(26),l=i(4),c=i(6),d=i(5),u=i(52),h=i(39),p=i(1675),g=i(19),C=i(9),m=i(11),S=i(16),y=i(12),f=c.lazyProperties({image:()=>a.Styles.createViewStyle({borderColor:C.Color.transparent,backgroundColor:C.Color.gray400}),missingPreviewView:()=>a.Styles.createViewStyle({borderColor:C.Color.transparent,backgroundColor:C.Color.gray400,flexDirection:"column",alignContent:"center",alignItems:"center",justifyContent:"space-around"}),missingPreviewText:()=>a.Styles.createTextStyle({color:C.Color.white}),imageSelectedBorder:()=>a.Styles.createImageStyle({borderColor:C.Color.blue}),imageHoverBorder:()=>a.Styles.createImageStyle({borderColor:C.Color.gray200Overlay20}),imageSelectedBackground:()=>a.Styles.createViewStyle({backgroundColor:C.Color.blue}),imageHoverBackground:()=>a.Styles.createViewStyle({backgroundColor:C.Color.gray200Overlay60}),centerContent:()=>a.Styles.createViewStyle({borderRadius:4,alignItems:"center",paddingBottom:8,paddingTop:4}),sourceItem:()=>a.Styles.createViewStyle({justifyContent:"center",marginTop:4}),sourceDescription:()=>a.Styles.createTextStyle({textAlign:"center",color:C.Color.white,marginTop:8}),appDescription:()=>a.Styles.createTextStyle({textAlign:"left"}),textLine:()=>a.Styles.createViewStyle({marginLeft:5})});class _ extends y.default{constructor(){super(...arguments),this._failedCode="Failed",this._onHoverStart=()=>{this.isComponentMounted()&&this.setState({isHoveringOn:!0})},this._onHoverEnd=()=>{this.isComponentMounted()&&this.setState({isHoveringOn:!1})},this._toggleSelection=()=>{l.log(s.LogTraceArea.CallingUI,"ScreenSharingSourceItem: _toggleSelection Source Selected "+h.dev_unknownOmit(this.props.sourceDetails.getDescription())),this.props.onSourceSelected(this.props.sourceDetails,this.props.isSelected)},this._onContainerRef=e=>{this._containerRef=e||void 0}}_buildState(e,t){return{selectedColor:u.default.getPrimaryColor()}}requestFocus(){this._containerRef&&this._containerRef.requestFocus()}componentDidMount(){super.componentDidMount(),this._setPreviewUrl(this.props.width,this.props.height)}render(){let e,t;const i=this.props.sourceDetails.getDescription(),n=a.Styles.createViewStyle({width:this.props.width,height:this.props.height,borderWidth:this.props.borderWidth},!1);let o;if(this.props.isSelected){const e=a.Styles.createImageStyle({borderColor:this.state.selectedColor},!1);o=this.props.useHighContrastTheme?this._themeStyles.primaryViewColorStyle:e}else this.state.isHoveringOn&&(o=f.imageHoverBorder);const s=[f.image,n,o],l=[f.missingPreviewView,n,o],c=this._getPlaceholderSize();if(this.state.previewUrl)if(this.state.previewUrl===this._failedCode){let t=d.getString("ScreenSharingModal.PreviewUnavailable");e=a.createElement(a.View,{style:[l]},a.createElement(r.default,{icon:m.SkypeIcon.MissingPreview,color:C.Color.white,size:c}),a.createElement(S.BodyText,{style:f.missingPreviewText},t))}else e=a.createElement(a.Image,{style:s,source:this.state.previewUrl,resizeMode:"stretch"});const u=[a.Styles.createViewStyle({width:this.props.width},!1)];u.push(f.appDescription,f.textLine),this.props.useDefaultTheme&&(this.props.isSelected?u.push(this._themeStyles.primaryBackgroundColorTextStyle):u.push(this._themeStyles.secondaryTextColorStyle)),t=a.createElement(S.Caption,{style:[f.sourceDescription,u],numberOfLines:1},i);const h=a.Styles.createViewStyle({minWidth:this.props.width+2*this.props.borderWidth,minHeight:this.props.height+2*this.props.borderWidth+16},!1);let p;if(this.props.isSelected){const e=a.Styles.createViewStyle({backgroundColor:this.state.selectedColor},!1);p=this.props.useHighContrastTheme?this._themeStyles.primaryViewColorStyle:e}else this.state.isHoveringOn&&(p=f.imageHoverBackground);return a.createElement(a.GestureView,{onDoubleTap:this.props.onDoubleTap},a.createElement(a.View,{onMouseEnter:this._onHoverStart,onMouseLeave:this._onHoverEnd},a.createElement(a.Button,{ref:this._onContainerRef,style:[f.sourceItem,h],onPress:this._toggleSelection,accessibilityLabel:this.props.accessibilityLabel,tabIndex:this.props.tabIndex},a.createElement(a.View,{style:[f.centerContent,p]},e,t))))}_getPlaceholderSize(){return this.props.height<=p.SharingSourceSize.Small.width?m.IconSize.size48:this.props.height<=p.SharingSourceSize.Medium.width?m.IconSize.size100:m.IconSize.size128}_setPreviewUrl(e,t){this.props.sourceDetails.getPreviewAsync(e,t).then(e=>{this._checkIfUnmountedReportLateApi("get source preview")||e&&this._createCanvasAndSetpreviewUrl(e)}).catch(e=>{this.setState({previewUrl:this._failedCode});const t=g.default.errorAsString(e);l.error(s.LogTraceArea.CallingUI,"ScreenSharingSourceItem._setPreviewUrl "+t),l.track(new o.ScreenShareSourceGetPreviewFailure(t,n.SharingSourceType[this.props.sourceDetails.getType()],String(this.props.currentlyShared)))}),this.props.sourceDetails.getType()!==n.SharingSourceType.Monitor&&this._setPreviewUrlToIcon(e,t)}_setPreviewUrlToIcon(e,t){this.props.sourceDetails.getIcon(50,50).then(i=>{this._checkIfUnmountedReportLateApi("getIcon")||this.state.previewUrl||this._createCanvasForIconAndSetpreviewUrl(i,e,t)}).catch(e=>{const t=g.default.errorAsString(e);l.error(s.LogTraceArea.CallingUI,"ScreenSharingSourceItem._setPreviewUrlToIcon "+t),l.track(new o.ScreenShareSourceGetIconFailure(t,String(this.props.currentlyShared)))})}_checkIfUnmountedReportLateApi(e){return!this.isComponentMounted()&&(l.log(s.LogTraceArea.GenericUnsafe,"ScreenSharingSource: "+e+" returned after component was unmounted: "+h.dev_unknownOmit(this.props.sourceDetails.getDescription())),!0)}_createCanvasForIconAndSetpreviewUrl(e,t,i){let a=document.createElement("canvas");a.width=t,a.height=i,a.style.width=t+"px",a.style.height=i+"px";let n=a.getContext("2d");n&&(n.fillStyle=C.Color.black,n.fillRect(0,0,t,i),n.putImageData(e,t/2-25,i/2-25)),this.setState({previewUrl:a.toDataURL()})}_createCanvasAndSetpreviewUrl(e){let t=document.createElement("canvas"),i=t.getContext("2d");t.width=e.width,t.height=e.height,t.style.width=e.width+"px",t.style.height=e.height+"px",i&&i.putImageData(e,0,0),this.setState({previewUrl:t.toDataURL()})}}t.default=_},3457:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(15),s=i(43),r=i(106),l=i(6),c=i(5),d=i(121),u=i(3458),h=l.lazyProperties({scrollView:()=>n.Styles.createScrollViewStyle({flex:1})});class p extends o.ComponentBase{constructor(){super(...arguments),this._mountedItemRefsMap=new d.default,this._onKeyPress=e=>{let t=this.state.focusedIndex;e.keyCode!==r.default.UP&&e.keyCode!==r.default.LEFT||(t-=1),e.keyCode!==r.default.DOWN&&e.keyCode!==r.default.RIGHT||(t+=1),t<0||t>=this.props.backgroundsList.length||this.isComponentMounted()&&this.setState({focusedIndex:t})}}_buildState(e,t){return{focusedIndex:t?0:this.state.focusedIndex}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.focusedIndex!==t.focusedIndex&&this._focusItem(this.state.focusedIndex)}render(){return n.createElement(n.ScrollView,{style:h.scrollView,onKeyPress:this._onKeyPress,showsVerticalScrollIndicator:!1},n.createElement(n.View,{style:this.props.style},this._getAvailableBackgrounds()))}_focusItem(e=0){if(e<0||e>=this.props.backgroundsList.length)return;const t=this._mountedItemRefsMap.ref("source"+e);null==t||t.requestFocus()}_getAvailableBackgrounds(){return a.map(this.props.backgroundsList,(e,t)=>{const i=!!this.props.selectedBackground&&e.sceneId===this.props.selectedBackground.sceneId,a=e.sceneId,o=e.label;let r=c.getString("TogetherModeModal.BackgroundAccessibilityLabel",{name:o,currentItemIndex:t+1,numberOfItems:this.props.backgroundsList.length});return i&&(r=s.default.combinedAccessibilityLabel(r,c.getString("Global.SelectedAccessibilityLabel"))||""),n.createElement(u.default,{ref:this._mountedItemRefsMap.onComponentRef("source"+t),tabIndex:this.state.focusedIndex===t?0:-1,key:a,backgroundDetails:e,onSelected:this.props.onItemSelected,isSelected:i,width:this.props.itemWidth-8,height:this.props.itemHeight,borderWidth:4,onDoubleTap:this.props.onItemDoubleTap,accessibilityLabel:r,highContrastTheme:this.props.highContrastTheme,stackNavigation:this.props.stackNavigation,defaultTheme:this.props.defaultTheme})})}}t.default=p},3458:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(3),o=i(26),s=i(4),r=i(6),l=i(52),c=i(39),d=i(9),u=i(24),h=i(11),p=i(16),g=i(12),C=r.lazyProperties({image:()=>a.Styles.createViewStyle({borderColor:d.Color.transparent,backgroundColor:d.Color.gray400}),imageHoverBorder:()=>a.Styles.createImageStyle({borderColor:d.Color.gray200Overlay20}),imageHoverBackground:()=>a.Styles.createViewStyle({backgroundColor:d.Color.gray200Overlay60}),centerContent:()=>a.Styles.createViewStyle({borderRadius:4,alignItems:"center",paddingBottom:8,paddingTop:4,position:"relative"}),maxAudienceIconAndValue:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center",position:"absolute",top:13,right:13,backgroundColor:"#2B2C33D8",paddingHorizontal:2}),maxAudienceIcon:()=>a.Styles.createViewStyle({marginBottom:2,marginRight:4}),maxAudienceText:()=>a.Styles.createTextStyle({color:d.Color.white}),backgroundItem:()=>a.Styles.createViewStyle({justifyContent:"center",marginTop:4}),backgroundName:()=>a.Styles.createTextStyle({textAlign:"left",color:d.Color.white,marginTop:8}),textLine:()=>a.Styles.createViewStyle({marginLeft:5}),selectedTextStyleDark:()=>a.Styles.createViewStyle({backgroundColor:d.Color.gray400}),selectedTextStyleWhite:()=>a.Styles.createViewStyle({backgroundColor:d.Color.white})});class m extends g.default{constructor(){super(...arguments),this._onHoverStart=()=>{this.isComponentMounted()&&this.setState({isHoveringOn:!0})},this._onHoverEnd=()=>{this.isComponentMounted()&&this.setState({isHoveringOn:!1})},this._onPress=()=>{s.log(n.LogTraceArea.CallingUI,"TogetherModeBackgroundItem: _onPress Background Selected "+c.dev_unknownOmit(this.props.backgroundDetails.untranslatedName)),this.props.onSelected(this.props.backgroundDetails,this.props.isSelected)},this._onContainerRef=e=>{this._containerRef=e||void 0}}_buildState(e,t){return{isHoveringOn:!1,selectedColor:l.default.getPrimaryColor(),primaryBackgroundColorStyle:l.default.getPrimaryBackgroundColorStyle()}}requestFocus(){this._containerRef&&this._containerRef.requestFocus()}render(){const e=this.props.backgroundDetails.label,t=a.Styles.createViewStyle({width:this.props.width,height:this.props.height,borderWidth:this.props.borderWidth},!1),i=[C.image,t,this._getExtraBorderStyle()],n=a.createElement(p.Caption,{style:[C.backgroundName,this._getCaptionStyles()],numberOfLines:1},e),s=a.Styles.createViewStyle({minWidth:this.props.width+2*this.props.borderWidth,minHeight:this.props.height+2*this.props.borderWidth+16},!1),r=a.createElement(a.View,{style:C.maxAudienceIconAndValue},a.createElement(o.default,{style:C.maxAudienceIcon,size:h.IconSize.size14,color:d.Color.white,icon:h.SkypeIcon.ContactGroup}),a.createElement(a.Text,{style:[C.maxAudienceText,u.default.fontStyle.tertiaryButton]},this.props.backgroundDetails.maxAudience));return a.createElement(a.GestureView,{onDoubleTap:this.props.onDoubleTap},a.createElement(a.View,{onMouseEnter:this._onHoverStart,onMouseLeave:this._onHoverEnd},a.createElement(a.Button,{ref:this._onContainerRef,style:[C.backgroundItem,s],onPress:this._onPress,accessibilityLabel:this.props.accessibilityLabel,tabIndex:this.props.tabIndex},a.createElement(a.View,{style:[C.centerContent,this._getExtraBackgroundStyle()]},a.createElement(a.Image,{style:i,source:this.props.backgroundDetails.url,resizeMode:"stretch"}),r,n))))}_getCaptionStyles(){const e=[a.Styles.createViewStyle({width:this.props.width},!1),C.textLine];return this.props.isSelected?e.push(this.props.highContrastTheme?this._themeStyles.primaryBackgroundColorTextStyle:this.state.primaryBackgroundColorStyle):this.props.defaultTheme&&e.push(this._themeStyles.primaryTextColorStyle),e}_getExtraBackgroundStyle(){if(this.props.isSelected){const e=a.Styles.createViewStyle({backgroundColor:this.state.selectedColor},!1);return this.props.highContrastTheme?this._themeStyles.primaryViewColorStyle:e}if(this.state.isHoveringOn)return C.imageHoverBackground}_getExtraBorderStyle(){if(this.props.isSelected){const e=a.Styles.createImageStyle({borderColor:this.state.selectedColor},!1);return this.props.highContrastTheme?this._themeStyles.primaryViewColorStyle:e}if(this.state.isHoveringOn)return C.imageHoverBorder}}t.default=m},3459:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ModalHeight=t.ModalWidth=t.BackgroundSize=void 0;class a{}t.BackgroundSize=a,a.XLarge={width:960,height:576},a.Large={width:288,height:173},a.Medium={width:240,height:144},a.Small={width:160,height:90},a.XSmall={width:80,height:45};const n=a.Small.width;var o;!function(e){e[e.FourColumns=380+3*n]="FourColumns",e[e.ThreeColumns=380+2*n]="ThreeColumns",e[e.TwoColumns=380+n]="TwoColumns",e[e.OneColumn=380]="OneColumn"}(o=t.ModalWidth||(t.ModalWidth={}));var s;!function(e){e[e.ThreeRows=650]="ThreeRows",e[e.TwoRows=515]="TwoRows",e[e.OneRow=380]="OneRow"}(s=t.ModalHeight||(t.ModalHeight={}));t.default=class{static getBackgroundItemDimensions(e,t,i){return i&&e&&t?a.Medium:e&&t?a.Large:a.Medium}static getModalWidth(e,t){return o.TwoColumns}static getModalHeight(e){return s.ThreeRows}}},3460:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dismiss=t.show=void 0;const a=i(1),n=i(35),o=i(0),s=i(153),r=i(96),l=i(7),c=i(145),d=i(69),u=i(1677),h=i(29),p=i(103),g=i(53),C=i(17),m=i(54),S=i(13),y=i(71),f=i(33),_=i(254),b=i(234),v=i(79),w=i(32),T=i(134),I=i(3),P=i(120),M=i(141),k=i(26),A=i(94),R=i(4),V=i(373),E=i(125),L=i(6),B=i(208),O=i(233),D=i(5),x=i(1191),N=i(445),U=i(23),F=i(179),H=i(1139),z=i(84),G=i(380),W=i(27),K=i(39),j=i(112),Q=i(174),q=i(44),X=i(42),$=i(9),J=i(11),Y=i(28),Z=i(14),ee=i(16),te=i(1589),ie=i(1689),ae=i(46),ne=i(10),oe=L.lazyProperties({dialog:()=>o.Styles.createViewStyle({flex:1,alignItems:"stretch",justifyContent:"center"}),innerContainer:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center",padding:20}),title:()=>o.Styles.createTextStyle({marginTop:25,marginBottom:20,textAlign:"center",backgroundColor:$.Color.transparent}),sectionTitle:()=>o.Styles.createViewStyle({flex:1,alignItems:"stretch",alignSelf:"stretch",justifyContent:"center",flexDirection:"row"}),sectionTitleText:()=>o.Styles.createTextStyle({paddingHorizontal:10}),message:()=>o.Styles.createTextStyle({marginTop:10,marginBottom:20,textAlign:"center",backgroundColor:$.Color.transparent}),centeredText:()=>o.Styles.createTextStyle({textAlign:"center",backgroundColor:$.Color.transparent}),permissionsText:()=>o.Styles.createTextStyle({paddingBottom:20}),permissions:()=>o.Styles.createViewStyle({alignSelf:"stretch"}),primaryButton:()=>o.Styles.createButtonStyle({marginHorizontal:20,alignSelf:"stretch"}),messageComposerContainer:()=>o.Styles.createViewStyle({alignSelf:"stretch",justifyContent:"center",marginTop:20,marginHorizontal:20}),actionContainer:()=>o.Styles.createViewStyle({alignSelf:"stretch",alignItems:"center",marginBottom:20}),feedbackButton:()=>o.Styles.createButtonStyle({marginTop:20})});function se(e,t,i){R.log(I.LogTraceArea.UnansweredCall,"dismiss causeId: "+i),N.unregisterModalDialogDismissalException(e),m.default.dismissModal(e,t)}t.show=function(e,t,i,a){R.log(I.LogTraceArea.UnansweredCall,"show causeId: "+a);const n=o.createElement(re,{modalId:t,callId:e.originalCallId,conversationMri:e.originalConversationMri,unansweredCallOutput:e});return N.registerModalDialogDismissalException(t),m.default.showModal(n,t,i),e=>se(e,i.rootViewId,a)},t.dismiss=se;class re extends d.default{constructor(){super(...arguments),this._renderAction=(e,t)=>{switch(e.action){case p.UnansweredCallAction.SendMessage:if(C.isPhoneMri(this.props.conversationMri)||this.state.oneToOneConversationUnaccepted)return;const i=e.message&&0===t?o.createElement(ee.BodyText,{bold:!0,style:oe.centeredText},e.message):void 0;return o.createElement(o.View,{key:"composer"+t,style:oe.actionContainer},i,this._renderMessageComposer(e.prepopulatedMessage));case p.UnansweredCallAction.PromptForPermission:let a;this.props.unansweredCallOutput.reason===p.UnansweredCallReason.MicAndCamPermissionDenied?a=F.default.getDeniedPrompt(Y.PermissionType.MicrophoneAndCamera):this.props.unansweredCallOutput.reason===p.UnansweredCallReason.CameraPermissionDenied?a=F.default.getDeniedPrompt(Y.PermissionType.Camera):this.props.unansweredCallOutput.reason===p.UnansweredCallReason.MicrophonePermissionDenied&&(a=F.default.getDeniedPrompt(Y.PermissionType.Microphone));const n=a?o.createElement(ee.BodyText,{bold:!0,style:[oe.centeredText,oe.permissionsText]},a):void 0,s=g.UICapabilities.systemSettingsDeepLinkSupported()?o.createElement(X.default,{style:oe.primaryButton,buttonStyle:S.SXButtonStyle.BlueFill,onPress:this._onPermissionSettingsPress,title:D.getString("UnansweredCallActions.Settings")}):void 0;return o.createElement(o.View,{key:"permissions"+t,style:oe.permissions},n,s);case p.UnansweredCallAction.SendFeedback:return o.createElement(M.HoverableButton,{key:"sendfeedbackbutton"+t,onPress:this._onSendFeedbackPress,style:oe.feedbackButton},o.createElement(ee.BodyText,{key:"sendfeedbacktext"+t,bold:!0,style:oe.centeredText,textThemeColor:ee.TextThemeColor.Secondary},e.message));case p.UnansweredCallAction.CallPSTN:return this._renderCallButtons();case p.UnansweredCallAction.ShowRegulatoryInfoIndia||p.UnansweredCallAction.ShowRegulatoryInfoNetherlands:return this._renderRegulatoryInfoButton(e.action)}},this._onTitleOrMessageRef=e=>{this._titleOrMessageRef=e||void 0},this._onPermissionSettingsPress=()=>{o.Linking.openUrl("app-settings:")},this._onCallButtonPressed=e=>{const t=ne.default.newCauseId();R.log(I.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onCallButtonPressed mri: "+K.mriOrId(e)+" causeId: "+t),te.default.reportUnansweredCallActionTaken(this.props.callId,this.props.unansweredCallOutput.reason,p.UnansweredCallAction.CallPSTN,t),this._closeDialog(this._getRootViewId(),t),R.track(new ie.UnansweredCallCTA("cta_clicked")),h.default.CallNavigationHelper.startCall({conversationMri:e,withVideo:!1,origin:I.NavigationCallOrigin.UnansweredCallPanel},t)},this._onMessageSent=e=>{const t=ne.default.newCauseId();return R.log(I.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onMessageSent causeId: "+t),z.default.postMessageFromInput(this.props.conversationMri,I.PostSource.UnansweredCallPanel,e,void 0,{name:j.ScenarioName.SendTextMessage}),te.default.reportUnansweredCallActionTaken(this.props.callId,this.props.unansweredCallOutput.reason,p.UnansweredCallAction.SendMessage,t),this._closeDialog(this._getRootViewId(),t),!0},this._onSendFeedbackPress=e=>{const t=ne.default.newCauseId();R.log(I.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onSendFeedbackPress causeId: "+t),e.stopPropagation(),G.default.reportProblem(!0,this._getRootViewId()),te.default.reportUnansweredCallActionTaken(this.props.callId,this.props.unansweredCallOutput.reason,p.UnansweredCallAction.SendFeedback,t),this._closeDialog(this._getRootViewId(),t)},this._onClickOutside=()=>{const e=ne.default.newCauseId();R.log(I.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onClickOutside causeId: "+e),this._reportCancel(e)},this._onCancelPress=()=>{const e=ne.default.newCauseId();R.log(I.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onCancelPress causeId: "+e),this._reportCancel(e),this._closeDialog(this._getRootViewId(),e)},this._onBack=()=>{const e=ne.default.newCauseId();return R.log(I.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onBack causeId: "+e),this._reportCancel(e),this._closeDialog(this._getRootViewId(),e),R.log(I.LogTraceArea.HardwareBackButton,"goBack: true componentId: UnansweredCallPanel"),!0},this._onEscape=()=>{const e=ne.default.newCauseId();return R.log(I.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onEscape causeId: "+e),this._reportCancel(e),this._closeDialog(this._getRootViewId(),e),!0},this._onAppStateChange=e=>{if(e===o.Types.AppActivationState.Background){const e=ne.default.newCauseId();R.log(I.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onAppStateChange causeId: "+e),this._reportCancel(e),this._closeDialog(this._getRootViewId(),e)}},this._closeDialog=(e,t)=>{R.log(I.LogTraceArea.UnansweredCall,"UnansweredCallPanel._closeDialog causeId: "+t),se(this.props.modalId,e,t)},this._onPhoneActionsMenuClose=e=>{R.log(I.LogTraceArea.UnansweredCall,"_onPhoneActionsMenuClose causeId: "+e),_.default.close(this._getRootViewId(),e)},this._onTrySkypeToPhoneButtonRef=e=>{this._trySkypeToPhoneButtonRef=e||void 0}}_buildState(e,t){const i=this._getRootViewId(),a=C.isOneOnOneConversation(e.conversationMri);let o=void 0;if(a){const t=f.default().getConversation(e.conversationMri);t?o=t.getOtherPartyMri():C.isSkypeIdMri(e.conversationMri)&&(o=e.conversationMri)}return{isLandscape:W.default.getDeviceOrientation(i)===n.DeviceOrientation.Landscape,isMobileScreenSize:W.default.isMobileScreenSize(i),title:e.unansweredCallOutput.title,oneToOneConversationUnaccepted:a&&!y.default.isConversationAccepted(e.conversationMri),displayName:w.default.getShortDisplayName(e.conversationMri)||D.getString("UnansweredCallTitle.UnknownCallee"),fullName:w.default.getDisplayName(e.conversationMri)||D.getString("UnansweredCallTitle.UnknownCallee"),isOneOnOne:a,localAddressBookContact:B.default.getContactByCorrespondingMri(e.conversationMri),userPhones:o?ae.default.getFullUserProfileByMri(o).phones:[],callActionUcuxEnabled:l.default.getS4LEntitlementFeatures().SCE.UserServices.Client.Features.NewUcuxCallActionEnabled,hasEntitlements:T.default.userHasActiveEntitlements()}}componentDidMount(){super.componentDidMount();const e=ne.default.newCauseId();R.log(I.LogTraceArea.UnansweredCall,"componentDidMount causeId: "+e),this._titleOrMessageRef&&this._titleOrMessageRef.requestFocus(),v.dismissAll(),c.default.subscribe(this._onBack),E.default.addEscapeHandler(this._onEscape),this._activationSubToken=r.default.subscribeForChanges("UnansweredCallPanel",this._onAppStateChange)}componentWillUnmount(){super.componentWillUnmount();const e=ne.default.newCauseId();R.log(I.LogTraceArea.UnansweredCall,"componentWillUnmount causeId: "+e),c.default.unsubscribe(this._onBack),E.default.removeEscapeHandler(this._onEscape),this._reportCancel(e),this._activationSubToken&&(this._activationSubToken.unsubscribe(),this._activationSubToken=void 0),P.setFocusWithDelay(P.FocusEvent.CloseUnansweredCallPanel,500)}render(){return o.createElement(Q.default,{dialogId:this.props.modalId,containerStyle:this._themeStyles.primaryBackgroundColorStyle,closeOnClickOutside:!0,maxWidth:this.state.isMobileScreenSize?void 0:b.CompactWidth,fullScreen:this.state.isMobileScreenSize,useFullSizeContainer:!0,accessibilityLabel:this.state.title||this.props.unansweredCallOutput.optionalSecondaryMessage||"",onClickOutside:this._onClickOutside},o.createElement(V.default,{style:[oe.dialog,this._themeStyles.primaryBackgroundColorStyle]},this._content()))}_renderMessageComposer(e){let t=[];return e&&(t=t.concat(new A.UnhandledEntity(e))),o.createElement(o.View,{key:"composer",style:[oe.messageComposerContainer]},o.createElement(x.default,{conversationId:this.props.conversationMri,otherPartyMri:void 0,hideMediaBar:!0,disableCopyPasteMedia:!0,hideEmoticonKeyboardIcon:!0,hideMediaPickerIcon:!0,hideMojiPickerIcon:!0,hideStickerPickerIcon:!0,hideLocationPickerIcon:!0,hideContactPickerIcon:!0,hideMoneyPickerIcon:!0,hideOverflowMenu:!0,hideSmsIcon:!0,hideAudioMessage:!0,shouldAutoFocus:!!e,showSendControlWhenEmpty:!0,initialInputEntities:t,onMessageSent:this._onMessageSent}))}_renderRegulatoryInfoButton(e){let t="",i="";const n=l.default.getConfigSettingsNoSubscription().pstn;if(e===p.UnansweredCallAction.ShowRegulatoryInfoIndia?(t=n.indiaRegulatoryFaq,i=D.getString("PstnUtils.BlockedRegulatoryIndiaButton")):e===p.UnansweredCallAction.ShowRegulatoryInfoNetherlands&&(t=n.netherlandsRegulatoryFaq,i=D.getString("PstnUtils.BlockedRegulatoryNetherlandsButton")),!a.isEmpty(t)&&!a.isEmpty(i))return o.createElement(o.View,{key:"regulatoryButton",style:oe.actionContainer},o.createElement(X.default,{title:i,onPress:()=>{o.Linking.openUrl(t)},buttonStyle:S.SXButtonStyle.ColorFill,buttonSize:S.SXButtonSize.Medium,autoFocus:!0}));R.warn(I.LogTraceArea.UnansweredCall,`Missing button properties for UnansweredCallAction: ${p.UnansweredCallAction[e]}; url = "${t}", buttonTitle = "${i}"`)}_renderCallButtons(){const e=O.mergeMriProfileAndExtraPhones(this.props.conversationMri,this.state.localAddressBookContact?this.state.localAddressBookContact.phones:void 0,this.state.userPhones);let t,i;if(e&&0!==e.length)return 1===e.length?(t=o.createElement(o.View,{style:oe.sectionTitle},o.createElement(ee.Subtitle,{style:[oe.sectionTitleText,this._themeStyles.primaryTextColorStyle]},D.getString("UnansweredCallActions.TrySkypeToPhoneButton"))),i=this._renderCallButton(e[0].number)):i=this._renderTrySkypeToPhoneButton(e),R.track(new ie.UnansweredCallCTA("cta_shown")),o.createElement(o.View,{key:"placecall",style:oe.actionContainer},t,o.createElement(o.View,{style:oe.messageComposerContainer},i))}_renderCallButton(e){const t=C.sanitizeMri(e,C.Namespaces.PSTN),i=`${D.getString("UnansweredCallActions.CallName",{name:this.state.displayName})} ${e} `;return o.createElement(u.default,{key:"callingbutton_"+e,isUsingStackNav:U.default.isUsingStackNavigationContextNoSubscription(),icon:J.SkypeIcon.SkypeOut,accessibilityLabel:i,phoneNumber:e,onPress:()=>this._onCallButtonPressed(t)})}_renderTrySkypeToPhoneButton(e){return o.createElement(u.default,{key:"trySkypeToPhoneButton",ref:this._onTrySkypeToPhoneButtonRef,isUsingStackNav:U.default.isUsingStackNavigationContextNoSubscription(),icon:J.SkypeIcon.SkypeOut,phoneNumber:D.getString("UnansweredCallActions.TrySkypeToPhoneButton"),accessibilityLabel:D.getString("UnansweredCallActions.TrySkypeToPhoneButton"),onPress:()=>this._showPhoneActionsMenu(e)})}_headerCloseButton(){return{closeButtonType:q.CloseButtonType.Close,title:D.getString("Global.CloseButtonTitle"),onPress:this._onCancelPress,color:this._themeColors.primaryIconColor}}_content(){const e=this.state.isMobileScreenSize&&this.state.isLandscape,t=o.createElement(q.SimplePanelHeader,{leftButton:this._headerCloseButton(),hideBottomBorder:!0,floating:!0,useTransparentBackground:!0}),i=this.state.title?o.createElement(ee.PanelHeader,{key:"title",ref:this._onTitleOrMessageRef,landscape:e,style:oe.title},this.state.title):void 0,n=this.props.unansweredCallOutput.optionalSecondaryMessage?o.createElement(ee.PanelHeader,{key:"message",ref:i?void 0:this._onTitleOrMessageRef,landscape:e,style:oe.message},this.props.unansweredCallOutput.optionalSecondaryMessage):void 0;let r,l;if(a.some(this.props.unansweredCallOutput.actions,e=>e.action===p.UnansweredCallAction.CallPSTN)){const e=O.mergeMriProfileAndExtraPhones(this.props.conversationMri,this.state.localAddressBookContact?this.state.localAddressBookContact.phones:void 0,this.state.userPhones),t=!C.isPhoneMri(this.props.conversationMri)&&!this.state.oneToOneConversationUnaccepted&&this.state.isOneOnOne&&e.length>0&&this.state.hasEntitlements;t&&R.track(new ie.UnansweredCallCTA("cta_eligible"));const i=t&&this.state.callActionUcuxEnabled?a.filter(this.props.unansweredCallOutput.actions,e=>e.action===p.UnansweredCallAction.CallPSTN):a.filter(this.props.unansweredCallOutput.actions,e=>e.action===p.UnansweredCallAction.SendMessage);r=a.map(i,this._renderAction)}else r=a.map(this.props.unansweredCallOutput.actions,this._renderAction);if(this.props.unansweredCallOutput.visualInfo)switch(this.props.unansweredCallOutput.visualInfo.type){case p.UnansweredCallVisualInfoType.Emoticon:l=o.createElement(s.AnimatedEmoticon,{size:s.Size.ExtraLarge,emoticonName:this.props.unansweredCallOutput.visualInfo.name,standaloneAnimation:!0});break;case p.UnansweredCallVisualInfoType.Icon:l=o.createElement(k.default,{icon:this.props.unansweredCallOutput.visualInfo.name,size:J.IconSize.size80,color:$.Color.gray300})}return o.createElement(o.View,{style:Z.default.flexOne},o.createElement(o.View,{key:"innercontainer",style:oe.innerContainer},l,i,n,r),t)}_reportCancel(e){R.log(I.LogTraceArea.UnansweredCall,"UnansweredCallPanel._reportCancel causeId: "+e),te.default.reportUnansweredCallActionTaken(this.props.callId,this.props.unansweredCallOutput.reason,p.UnansweredCallAction.None,e)}_showPhoneActionsMenu(e){const t=a.map(e,e=>{const t=C.sanitizeMri(e.number,C.Namespaces.PSTN);return{props:{key:"pstnButton"+e.number+e.type,phone:e,keepSpaceForSubtitle:!0,onPress:()=>this._onCallButtonPressed(t)},builder:H.default.buildRow}});_.default.showWithBuilders({builders:t,anchor:()=>this._trySkypeToPhoneButtonRef,getTitle:()=>this.state.fullName,onCloseMenu:this._onPhoneActionsMenuClose,rootViewId:this._getRootViewId()})}}t.default=re},3495:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dismiss=t.show=void 0;const a=i(118),n=i(73),o=i(0),s=i(734),r=i(69),l=i(29),c=i(3496),d=i(54),u=i(13),h=i(13),p=i(3),g=i(4),C=i(6),m=i(5),S=i(126),y=i(30),f=i(82),_=i(179),b=i(174),v=i(528),w=i(42),T=i(9),I=i(28),P=i(16),M=i(10),k=i(27),A=C.lazyProperties({panel:()=>o.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center"}),mainDisplayText:()=>o.Styles.createTextStyle({marginTop:35,textAlign:"center",color:T.Color.white,maxWidth:640,paddingHorizontal:10}),mainDisplayTextSafari:()=>o.Styles.createTextStyle({fontSize:16}),downloadSuggestionText:()=>o.Styles.createTextStyle({color:T.Color.white,marginRight:10}),chromeDisplayImage:()=>o.Styles.createImageStyle({width:612,height:266}),downloadButton:()=>o.Styles.createButtonStyle({alignSelf:"center",minWidth:h.SXButtonSize.Small}),continueWithoutAVButton:()=>o.Styles.createButtonStyle({alignSelf:"center",minWidth:h.SXButtonSize.Small,margin:20}),suggestionContent:()=>o.Styles.createViewStyle({position:"absolute",top:30,right:30,alignItems:"center",flexDirection:"row",overflow:"visible"})});function R(e,t,i){g.log(p.LogTraceArea.Permissions,"AugmentedPermissionsPanelProps.dismiss dismiss causeId: "+i),d.default.dismissModal(e,t)}t.show=function(e,t,i,a,n,s){g.log(p.LogTraceArea.Permissions,"AugmentedPermissionsPanelProps.show permissionType: "+i+" causeId: "+a);const r=o.createElement(V,{causeId:a,modalId:e,permissionType:i,onContinueAfterPermissionsDenied:s});return d.default.showModal(r,e,t),e=>R(e,t.rootViewId,a)},t.dismiss=R;class V extends r.default{constructor(){super(...arguments),this._onJoinCallWithoutAVPermissions=()=>{this.props.onContinueAfterPermissionsDenied&&this.props.onContinueAfterPermissionsDenied(),this._setTelemetryAction(c.AVPermissionsAction.ContinueWithoutAV),this._dismissAndCleanup()},this._onCancelButtonClick=()=>{this._setTelemetryAction(c.AVPermissionsAction.Cancel),this._dismissAndCleanup()}}_buildState(e,t){const i={permissionStatus:f.default.permissionStatus(e.permissionType),isContinueCallWithoutAVEnabled:l.default.CallingFeaturesHelper.isCallWithoutAVPermissionsBrowserEnabled()};return t&&(i.permissionStatus===n.PermissionStatus.Unknown?f.default.getPermissionStatusFetchIfUnavailable(e.permissionType).then(e=>{i.permissionStatus=e,this._initializeTelemetry(i)}):this._initializeTelemetry(i)),i}componentDidMount(){if(super.componentDidMount(),f.default.permissionStatus(this.props.permissionType)===n.PermissionStatus.Unknown)switch(this.props.permissionType){case I.PermissionType.Microphone:y.default.setUserPreferencesLocal({wasInstructedAboutMicrophoneWebPermissions:!0});break;case I.PermissionType.Camera:y.default.setUserPreferencesLocal({wasInstructedAboutCameraWebPermissions:!0});break;case I.PermissionType.MicrophoneAndCamera:y.default.setUserPreferencesLocal({wasInstructedAboutMicrophoneWebPermissions:!0,wasInstructedAboutCameraWebPermissions:!0})}}componentWillUnmount(){super.componentWillUnmount(),this._callPermissionDeniedEvent&&(this._isGranted(this.state.permissionStatus)&&this._callPermissionDeniedEvent.setAction(c.AVPermissionsAction.PermissionGranted),g.track(this._callPermissionDeniedEvent))}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.permissionStatus!==n.PermissionStatus.Granted&&t.permissionStatus===n.PermissionStatus.Granted&&(this._setTelemetryAction(c.AVPermissionsAction.PermissionGranted),this._dismissAndCleanup())}render(){return this.state.permissionStatus===n.PermissionStatus.Unknown&&l.default.CallingFeaturesHelper.isBrowserCheckPermissionSupported()?null:o.createElement(b.default,{dialogId:this.props.modalId,containerStyle:S.MeetNowStyle.bgColorStyle,closeOnClickOutside:!1,maxWidth:void 0,fullScreen:!0,useFullSizeContainer:!0},o.createElement(o.View,{style:A.panel},this._renderMainDisplayImage(),this._renderMainDisplayText(),this._renderJoinCallWithoutAVButton(),o.createElement(s.default,{onClose:this._onCancelButtonClick,meetNowParameters:this.props.meetNowParameters})))}_renderMainDisplayImage(){if(this._isDeniedScreen(this.state)){const e=_.default.getDeniedImageSourceBrowser(),t=a.BrowserEnvironment.isCallingSupportedSafari()||k.default.isTinyScreenSizeNoSubscription(this._getRootViewId())?u.ImageResizeModeEnum.contain:u.ImageResizeModeEnum.cover;return e?o.createElement(o.Image,{style:A.chromeDisplayImage,resizeMode:t,source:e}):void 0}return o.createElement(v.SkypeLogo,null)}_renderMainDisplayText(){const e=this._isDeniedScreen(this.state),t=e?this._renderMainDisplayTextDenied():this._renderMainDisplayTextRequest(),i=[A.mainDisplayText,e&&a.BrowserEnvironment.isCallingSupportedSafari()?A.mainDisplayTextSafari:void 0];return o.createElement(P.Header,{style:i,size:5,allowFontScaling:!1,importantForAccessibility:o.Types.ImportantForAccessibility.Yes},t)}_assertAndWarnUnsupportedBrowser(){g.warn(p.LogTraceArea.Permissions,"AugmentedPermissions UI is not supported for other browsers")}_renderMainDisplayTextRequest(){const e=a.BrowserEnvironment.isChrome()||a.BrowserEnvironment.isCallingSupportedSafari()||a.BrowserEnvironment.isFirefox();switch(this.props.permissionType){case I.PermissionType.Microphone:return e?m.getString("AugmentedPermissions.RequestPermissionsChromeTextMic"):m.getString("AugmentedPermissions.RequestPermissionsEdgeTextMic");case I.PermissionType.Camera:return e?m.getString("AugmentedPermissions.RequestPermissionsChromeTextCam"):m.getString("AugmentedPermissions.RequestPermissionsEdgeTextCam");default:return e?m.getString("AugmentedPermissions.RequestPermissionsChromeTextBoth"):m.getString("AugmentedPermissions.RequestPermissionsEdgeTextBoth")}}_renderMainDisplayTextDenied(){const e=_.default.getDeniedTextDuringCallBrowser(I.PermissionType.Camera),t=_.default.getDeniedTextDuringCallBrowser(I.PermissionType.Microphone),i=_.default.getDeniedTextDuringCallBrowser(I.PermissionType.MicrophoneAndCamera);if(!e||!t||!i)return this._assertAndWarnUnsupportedBrowser(),"";if(this.state.permissionStatus===n.PermissionStatus.MicGrantedAndCameraDenied)return e;if(this.state.permissionStatus===n.PermissionStatus.MicDeniedAndCameraGranted)return t;switch(this.props.permissionType){case I.PermissionType.Camera:return e;case I.PermissionType.Microphone:return t;case I.PermissionType.MicrophoneAndCamera:return i;default:M.default.switchStatementExhaustiveChecking(this.props.permissionType,"AugmentedPermissions called for an incorrect permission type")}}_isDeniedScreen(e){return e.permissionStatus===n.PermissionStatus.Denied||e.permissionStatus===n.PermissionStatus.MicDeniedAndCameraGranted}_renderJoinCallWithoutAVButton(){if(this._isDeniedScreen(this.state)&&this.state.isContinueCallWithoutAVEnabled&&this.props.onContinueAfterPermissionsDenied)return o.createElement(w.default,{allowTextWrap:!0,buttonSize:h.SXButtonSize.Medium,buttonStyle:h.SXButtonStyle.LightStroke,onPress:this._onJoinCallWithoutAVPermissions,style:A.continueWithoutAVButton,title:m.getString("AugmentedPermissions.JoinCallWithoutAV")})}_dismissAndCleanup(){R(this.props.modalId,u.MainRootViewId,""),n.PermissionsPromptHelper.resetPermissionPromptsState()}_initializeTelemetry(e){const t=this._isDeniedScreen(e)?c.InitialScreen.DenyPrompt:c.InitialScreen.AllowPrompt;this._callPermissionDeniedEvent=new c.CallPermissionsBrowserEvent(t)}_setTelemetryAction(e){this._callPermissionDeniedEvent&&this._callPermissionDeniedEvent.setAction(e)}_isGranted(e){switch(this.props.permissionType){case I.PermissionType.Camera:return e===n.PermissionStatus.Granted||e===n.PermissionStatus.MicDeniedAndCameraGranted;case I.PermissionType.Microphone:return e===n.PermissionStatus.Granted||e===n.PermissionStatus.MicGrantedAndCameraDenied;case I.PermissionType.MicrophoneAndCamera:return e===n.PermissionStatus.Granted}}}t.default=V},3509:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(15),o=i(29),s=i(413);class r extends n.ComponentBase{_buildState(e,t){if(!t&&this.state.renderPipView)return{};{const e=o.default.CallingStore.getConnectedOrOutgoingAndNotOnHoldCallId();return{renderPipView:!!e&&!s.default.isCallVisible(e)}}}render(){if(this.state.renderPipView){const e=i(3510).default;return a.createElement(e,null)}return null}}t.default=r},3510:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(34),n=i(1),o=i(0),s=i(74),r=i(1695),l=i(29),c=i(123),d=i(740),u=i(328),h=i(87),p=i(60),g=i(110),C=i(413),m=i(53),S=i(17),y=i(45),f=i(3),_=i(26),b=i(4),v=i(37),w=i(6),T=i(5),I=i(21),P=i(39),M=i(19),k=i(72),A=i(9),R=i(11),V=i(14),E=i(3520),L=i(10),B="hangup",O="mute",D="unmute",x=w.lazyProperties({container:()=>o.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"visible"}),pipContainer:()=>o.Styles.createViewStyle({height:100,width:100,borderRadius:50,backgroundColor:A.Color.black}),gestureView:()=>o.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:A.Color.transparent}),pip:()=>o.Styles.createViewStyle({position:"absolute",height:100,width:100,overflow:"visible"}),talkingAnimation:()=>o.Styles.createViewStyle({position:"absolute",top:-10,left:-10,width:120,height:120,overflow:"visible"}),muteIconContainer:()=>o.Styles.createViewStyle({position:"absolute",bottom:2,left:0,right:0,height:30,alignItems:"center",justifyContent:"center",backgroundColor:A.Color.transparent})});class N extends y.default{constructor(){super(...arguments),this._currentPoint={x:0,y:0},this._targetPoint={x:0,y:0},this._isDragging=!1,this._animatedTopValue=new o.Animated.Value(this._currentPoint.y),this._animatedLeftValue=new o.Animated.Value(this._currentPoint.x),this._animatedStyle=o.Styles.createAnimatedViewStyle({top:this._animatedTopValue,left:this._animatedLeftValue}),this._animatedScaleValue=new o.Animated.Value(1),this._animatedScaleStyle=o.Styles.createAnimatedViewStyle({transform:[{scale:this._animatedScaleValue}]}),this._participantLayoutController={getStyles:()=>[x.pipContainer],getInnerStyles:()=>[V.default.flexOne],getBackgroundColorStyle(){},isHidden:()=>!1},this._onPress=()=>{const e=L.default.newCauseId();b.log(f.LogTraceArea.CallingUI,"FloatingPipView._onPress causeId: "+e),this._updateScale(!1),this.state.callConversationMri&&this.state.callId&&l.default.CallNavigationHelper.rejoinCall(this.state.callConversationMri,this.state.callId,e,f.NavigationCallOrigin.PipView)},this._onLongPress=e=>{this._updateScale(!1,750);const t=this._getActionMenu(),i={anchor:()=>this._floatingPipView,buttons:t.menuItems,destructiveButtonIndex:t.destructiveIndex};k.default.showWithActionMenuConfig({options:i,callback:this._onHandleActionMenuCommand,maintainAnchor:!0,rootViewId:this._getRootViewId(),invokingEvent:e})},this._onPressIn=()=>{this._updateScale(!0)},this._onPan=e=>{const t=!e.isComplete;if(this._isDragging!==t&&this._startOrStopDragging(t),!this._approachValue){const e=this._centerPoint(this._currentPoint);this._startApproach(e,e=>{const t={x:e.x-50,y:e.y-50};this._positionPip(t),!this._isDragging&&Math.abs(this._targetPoint.x-e.x)<1&&Math.abs(this._targetPoint.y-e.y)<1&&this._stopApproach()})}if(this._approachValue&&this._isDragging&&(this._targetPoint={x:e.pageX,y:e.pageY},this._approachValue.updateTarget(this._targetPoint)),e.isComplete){let t,i;if(Math.abs(e.velocityY)<.25)Math.abs(e.velocityX)<.25?(t=e.pageX>this.state.viewDimensions.width/2?this.state.viewDimensions.width:0,i=this._currentPoint.y+50):(t=e.velocityX>0?this.state.viewDimensions.width:0,i=this._currentPoint.y+50);else{const a=e.velocityY/e.velocityX;t=e.velocityX>0?this.state.viewDimensions.width:0,i=a*(t-e.pageX)+e.pageY}t=Math.max(Math.min(t,this._maxX()),40),i=Math.max(Math.min(i,this._maxY()),114),this._targetPoint={x:t,y:i},this._approachValue&&this._approachValue.updateTarget(this._targetPoint)}},this._updateElementLink=(e,t,i,a,o,r,c)=>{b.log(f.LogTraceArea.CallingUI,"FloatingPipView._updateElementLink causeId: "+o);const d=e;if(!this._renderedElementMri||this._renderedElementMri!==d||n.isUndefined(this._renderedElementType)||this._renderedElementType!==a||!this._callingVideoView||this._callingVideoView.getVideoContainer()!==t)if(this._renderedElementMri&&this._renderedElementMri!==d&&this._removeElementLink(o),n.isUndefined(t)||!n.isUndefined(this._renderedElementType)&&this._renderedElementType!==a)this._removeElementLink(o);else{if(this.state.callId){const e=m.CallingCapabilities.directReparentingSupported()?l.default.RemoteStreamHelper.getRemoteStreamRenderer(this.state.callId,d,a,r):void 0;l.default.RemoteStreamHelper.startRemoteStream(this.state.callId,d,"FloatingPipView",a,t,{scalingMode:s.ScalingMode.Crop,transparent:!1,rendererTobeReparented:e,disposeRendererWhenStreamisNotAvailable:()=>!0},o,[],r).then(()=>{c&&c()})}this._renderedElementType=a,this._renderedElementMri=d}},this._onLayoutChange=e=>{const t={width:e.width,height:e.height};this.setState({viewDimensions:t})},this._onHandleActionMenuCommand=e=>{const t=L.default.newCauseId();if(b.log(f.LogTraceArea.CallingUI,"FloatingPipView._onHandleActionMenuCommand "+e+" causeId: "+t),this.state.callId)switch(e){case B:l.default.CallingStore.endCall(this.state.callId,t);break;case O:h.default.updateCallTelemetry(this.state.callId,t,e=>e.muteFloatingPipPress()),l.default.CallingStore.mute(this.state.callId,t);break;case D:h.default.updateCallTelemetry(this.state.callId,t,e=>e.muteFloatingPipPress()),l.default.CallingStore.unmute(this.state.callId,t);break;case k.SXActionMenuCancel:}},this._onElementScalingModeChanged=(e,t,i)=>{const n=L.default.newCauseId();b.log(f.LogTraceArea.CallingUI,"FloatingPipView._onElementScalingModeChanged key: "+a.pii.Omit(e)+" scalingMode: "+i+" causeId: "+n),S.isMri(e)&&this.state.callId?l.default.RemoteStreamHelper.setScalingMode(this.state.callId,e,t,i,n).catch(e=>{b.warn(f.LogTraceArea.CallingUI,"FloatingPipView._onElementScalingModeChanged setScalingMode failed "+M.default.errorAsString(e)+" causeId: "+n)}):b.log(f.LogTraceArea.CallingUI,"CallStageView._onElementScalingModeChanged skipping for non-MRI "+a.pii.Omit(e))},this._layoutController=()=>this._participantLayoutController,this._onFloatingPipRef=e=>{this._floatingPipView=e||void 0},this._onCallingVideoView=(e,t)=>{b.log(f.LogTraceArea.CallingUI,"FloatingPipView._onCallingVideoView causeId"+t),this._callingVideoView!==e&&(this._callingVideoView=e)}}_buildState(e,t){const i={};t&&(i.viewDimensions={width:0,height:0});const a=l.default.CallingStore.getConnectedOrOutgoingAndNotOnHoldCallId();if(!a||C.default.isCallVisible(a))return i.showPip=!1,i.callState=s.CallState.None,i.videoAvailable=!1,i.videoStreaming=!1,i.screenshareAvailable=!1,i.screenshareStreaming=!1,i.isMuted=!1,i.callId=void 0,i.callConversationMri=void 0,i.speakerMri=void 0,i;const o=l.default.CallingStore.getCallConversationMri(a);if(l.default.CallingStore.isCallCreator(a)&&o&&1===u.default.getActiveParticipants(a,o).length)i.speakerMri=n.first(I.default.getMyMris());else{const e=l.default.CallingStore.getTopSpeakerMri(a);if(e)i.speakerMri=e;else{const e=l.default.CallingStore.getRemoteCallMemberMris(a);i.speakerMri=this._fallbackSpeakerParticipantKey(a,e)}}return i.speakerMri?(i.showPip=!0,i.callId=a,i.callConversationMri=o,i.callState=l.default.CallingStore.getCallState(a),i.videoAvailable=l.default.RemoteStreamHelper.isStreamAvailable(a,i.speakerMri,s.StreamType.Video),i.screenshareAvailable=l.default.RemoteStreamHelper.isStreamAvailable(a,i.speakerMri,s.StreamType.ScreenSharing),i.videoStreaming=l.default.RemoteStreamHelper.isStreamRenderingForTarget(a,i.speakerMri,s.StreamType.Video,this._callingVideoView?this._callingVideoView.getVideoContainer():void 0),i.screenshareStreaming=l.default.RemoteStreamHelper.isStreamRenderingForTarget(a,i.speakerMri,s.StreamType.ScreenSharing,this._callingVideoView?this._callingVideoView.getVideoContainer():void 0),i.isMuted=g.default.isLocalOrServerMuted(a)):(i.showPip=!1,i.callState=s.CallState.None,i.videoAvailable=!1,i.videoStreaming=!1,i.screenshareAvailable=!1,i.screenshareStreaming=!1,i.isMuted=!1,i.callId=void 0,i.callConversationMri=void 0),i}componentDidMount(){super.componentDidMount(),this.state.showPip&&this.state.viewDimensions.width&&this._presentPip();const e=this.state.showPip?"Showing":"Hiding";b.log(f.LogTraceArea.CallingUI,"FloatingPipView.componentDidMount: "+e+" PiP")}componentWillUnmount(){super.componentWillUnmount();const e=L.default.newCauseId();b.log(f.LogTraceArea.CallingUI,"FloatingPipView.componentWillUnmount causeId: "+e),this._removeElementLink(e)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=L.default.newCauseId();if(b.log(f.LogTraceArea.CallingUI,"FloatingPipView.componentDidUpdate causeId: "+a),this.state.showPip!==t.showPip&&(this.state.showPip&&this._presentPip(),this.state.showPip||c.default.isCallStateActive(this.state.callState)||this._removeElementLink(a),this.state.showPip!==t.showPip)){const e=this.state.showPip?"Showing":"Hiding";b.log(f.LogTraceArea.CallingUI,"FloatingPipView.componentDidUpdate: "+e+" PiP")}v.default(this.state.viewDimensions,t.viewDimensions)||(t.viewDimensions.width?this._updatePipPosition():this.state.showPip&&this._presentPip())}requestFocus(){}_presentPip(){b.log(f.LogTraceArea.CallingUI,"FloatingPipView._presentPip");const e={x:this.state.viewDimensions.width,y:84};this._positionPip(e),this._positionPip({x:e.x-90,y:e.y},!0,200)}_stopApproach(){this._approachValue&&(this._approachValue.stop(),this._approachValue=void 0)}_startApproach(e,t){this._stopApproach(),this._approachValue=new r.default(e,t),this._approachValue.start()}_startOrStopDragging(e){this._isDragging=e,this._updateScale(e)}_updateScale(e,t=250){o.Animated.timing(this._animatedScaleValue,{toValue:e?.9:1,easing:o.Animated.Easing.OutBack(),duration:t}).start()}_fallbackSpeakerParticipantKey(e,t){if(!t||n.isEmpty(t))return;const i=n.find(t,t=>l.default.RemoteStreamHelper.isStreamAvailable(e,t,s.StreamType.ScreenSharing));if(i)return i;const a=n.find(t,t=>l.default.RemoteStreamHelper.isStreamAvailable(e,t,s.StreamType.Video));return a||t[0]}_updatePipPosition(){if(this._isDragging)return;let e=this._currentPoint.x,t=this._currentPoint.y;e>0&&(e=this._maxX()-50);const i=this._maxY()-50;t>i&&(t=i),this._positionPip({x:e,y:t})}_maxX(){return this.state.viewDimensions.width-50+10}_maxY(){return this.state.viewDimensions.height-50+10}_centerPoint(e){return{x:e.x+50,y:e.y+50}}_removeElementLink(e){b.log(f.LogTraceArea.CallingUI,"FloatingPipView._removeElementLink causeId: "+e),this._renderedElementMri&&this.state.callId&&!n.isUndefined(this._renderedElementType)&&(l.default.RemoteStreamHelper.stopRemoteStream(this.state.callId,this._renderedElementMri,"FloatingPipView",this._renderedElementType,e),this._renderedElementType=void 0,this._renderedElementMri=void 0)}_positionPip(e,t=!1,i=0){t?o.Animated.parallel([o.Animated.timing(this._animatedTopValue,{toValue:e.y,easing:o.Animated.Easing.Out(),duration:250,delay:i}),o.Animated.timing(this._animatedLeftValue,{toValue:e.x,easing:o.Animated.Easing.Out(),duration:250,delay:i})]).start():(this._animatedTopValue.setValue(e.y),this._animatedLeftValue.setValue(e.x)),this._currentPoint=e}_getActionMenu(){const e=[];return e.push({text:T.getString("FloatingPipView.HangupAction"),command:B}),this.state.isMuted?e.push({text:T.getString("FloatingPipView.UnmuteAction"),command:D}):e.push({text:T.getString("FloatingPipView.MuteAction"),command:O}),{menuItems:e,destructiveIndex:0}}render(){if(!this.state.showPip||!this.state.viewDimensions.width)return o.createElement(o.View,{style:x.container,onLayout:this._onLayoutChange,ignorePointerEvents:!0});b.log(f.LogTraceArea.CallingUI,"FloatingPipView: Showing PiP for call user "+P.mriOrId(this.state.speakerMri)+", videoAvailable "+this.state.videoAvailable+", videoStreaming "+this.state.videoStreaming+", videoDimension "+this.state.viewDimensions.width+" "+this.state.viewDimensions.height+", threadId: "+P.mriOrId(this.state.callConversationMri)+", callId: "+this.state.callId);let e=p.VideoStatus.None;(this.state.videoAvailable||this.state.screenshareAvailable)&&(e=p.VideoStatus.Available,(this.state.videoStreaming||this.state.screenshareStreaming)&&(e=p.VideoStatus.Streaming));const t={renderKey:this.state.speakerMri||"",mri:this.state.speakerMri||"",isLocal:!1,videoStatus:e,renderScreenShare:this.state.screenshareAvailable},i=this.state.isMuted?o.createElement(o.View,{style:x.muteIconContainer},o.createElement(_.default,{icon:R.SkypeIcon.MicrophoneOff,size:R.IconSize.size16,color:A.Color.white})):void 0;return o.createElement(o.View,{style:x.container,onLayout:this._onLayoutChange,ignorePointerEvents:!0},o.createElement(o.Animated.View,{ref:this._onFloatingPipRef,style:[x.pip,this._animatedStyle,this._animatedScaleStyle],ignorePointerEvents:!0},o.createElement(E.default,{style:x.talkingAnimation,animate:!0,size:120}),o.createElement(d.CallParticipantView,{renderInfo:t,renderKey:t.renderKey,isCompact:!0,iconOpacity:1,onUpdateElementLink:this._updateElementLink,onScalingModeChanged:this._onElementScalingModeChanged,videoBorderRadius:50,suppressTalkingRing:!0,parentViewId:"FloatingPipView",onCallingVideoView:this._onCallingVideoView,layoutController:this._layoutController,iconSize:100}),i,o.createElement(o.GestureView,{style:x.gestureView,onPan:this.state.showPip?this._onPan:void 0,releaseOnRequest:!1,importantForAccessibility:o.Types.ImportantForAccessibility.No},o.createElement(o.Button,{style:x.gestureView,onPress:this.state.showPip?this._onPress:void 0,onPressIn:this._onPressIn,onLongPress:this._onLongPress,delayLongPress:500,disableTouchOpacityAnimation:!0,accessibilityLabel:T.getString("FloatingPipView.ReturnToCallButtonAccessibilityLabel"),accessibilityTraits:o.Types.AccessibilityTrait.Button}))))}}t.default=N},3511:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(1101),o=i(74),s=i(0),r=(i(7),i(14)),l=i(4),c=i(10),d=i(3512),u=i(12),h=i(185),p=i(6),g=i(60),C=i(39),m=p.lazyProperties({innerContainer:()=>r.default.absoluteFill,hiddenContainer:()=>s.Styles.createViewStyle({opacity:0}),mainContainer:()=>s.Styles.createViewStyle({position:"relative",flex:1})});class S extends u.default{constructor(){super(...arguments),this._useNewVideoView=!1,this._onFullScreenUserIcon=e=>{this._fullScreenUserIcon=e||void 0},this._onCallingVideoView=e=>{const t=c.default.newCauseId(),i=e||void 0;l.log(h.LogTraceArea.CallingUI,this._componentTag+"._onCallingVideoView "+C.mriOrId(this.props.mri)+" has video view: "+!!i+" causeId: "+t),this._callingVideoView!==i&&(a.isUndefined(i)&&!a.isUndefined(this._callingVideoView)&&(this._dismissedRenderTarget=this._callingVideoView.getVideoContainer()),this._callingVideoView=i,this._updateVideoLinks(t,i?()=>this.props.onTriggerScalingModeUpdate(this):void 0),this.props.onCallingVideoView&&this.props.onCallingVideoView(this._callingVideoView,t))},this._updateVideoLinks=(e,t)=>{const i=this._callingVideoView;this.props.onUpdateElementLink(this._getVideoKey(),i?i.getVideoContainer():void 0,i?i.getVideoContainer():this._dismissedRenderTarget,this.props.streamType,e,this.getEndpointId(),t)}}_buildState(e,t){return t&&(this._componentTag=S._generateComponentTag(e)),super._buildState(e,t)}componentDidMount(){super.componentDidMount();const e=c.default.newCauseId();l.log(h.LogTraceArea.CallingUI,this._componentTag+".componentDidMount:  causeId: "+e),this._updateVideoLinks(e,()=>this.props.onTriggerScalingModeUpdate(this))}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=c.default.newCauseId();l.log(h.LogTraceArea.CallingUI,this._componentTag+".componentDidUpdate:  causeId: "+a),e&&e.videoStatus===this.props.videoStatus||l.log(h.LogTraceArea.CallingUI,this._componentTag+".componentDidUpdate: Video status updated for "+this.props.renderKey+" "+g.VideoStatus[this.props.videoStatus||g.VideoStatus.None]+" causeId: "+a),this._updateVideoLinks(a,()=>this.props.onTriggerScalingModeUpdate(this))}updateTalkingView(e){!this.props.isCompact&&this._fullScreenUserIcon&&this._fullScreenUserIcon.updateTalking(e)}getVideoElement(){return this._callingVideoView}getVideoStatus(){return this.props.videoStatus||g.VideoStatus.None}getEndpointId(){return this.props.streamType!==o.StreamType.Video||this.props.isLocal?void 0:this.props.endpointId}render(){const e=this.props.videoStatus!==g.VideoStatus.None?"video_":"icon_",t=e+this.props.renderKey,i=e+this._getVideoKey(!0);let a,n;switch(this.props.videoStatus){case g.VideoStatus.Available:this.props.renderScreenShare?n=this._renderVideoSurface(t,i,!1):(n=this._renderVideoSurface(t,i,!0),a=this._renderStaticSurface());break;case g.VideoStatus.Streaming:const e=this.props.shouldWaitForVideoSize&&(!this.props.videoDimensions||!this.props.videoDimensions.width);n=this._renderVideoSurface(t,i,e);break;case g.VideoStatus.None:this.props.renderScreenShare||(a=this._renderStaticSurface())}return s.createElement(s.View,{style:[m.innerContainer,m.mainContainer]},n,a)}_renderVideoSurface(e,t,i){l.log(h.LogTraceArea.CallingUI,this._componentTag+"._renderVideoSurface "+t+" hidden "+i+" local:"+this.props.isLocal);const a=[m.innerContainer];return i&&a.push(m.hiddenContainer),this._useNewVideoView&&n.VideoView?s.createElement(n.VideoView,{ref:this._onCallingVideoView,key:"video_"+e}):s.createElement(n.default,{ref:this._onCallingVideoView,key:"video_"+e,nametag:e,style:a,isLocal:this.props.isLocal,videoBorderRadius:this.props.videoBorderRadius,parentView:this._componentTag,localPreviewAndroidV2:this.props.localPreviewAndroidV2,experimentalVideo:this.props.experimentalVideo})}_renderStaticSurface(){const e=this.props.mri?s.createElement(d.default,{ref:this._onFullScreenUserIcon,style:m.innerContainer,backgroundColorStyle:this.props.layoutController(this.props.renderKey).getBackgroundColorStyle(this.props.useLightTheme),userMri:this.props.mri,iconOpacity:this.props.iconOpacity||0,backgroundOpacity:this.props.isCompact?0:1,isConnecting:this.props.isRinging,size:this.props.iconSize,animateChanges:this.props.animateIconChanges,gradientColors:this.props.gradientColors}):void 0;return s.createElement(s.View,{style:m.innerContainer},e)}_getVideoKey(e=!1){return this.props.endpointId&&this.props.streamType===o.StreamType.Video&&!this.props.isLocal?(e?C.mriOrId(this.props.renderKey):this.props.renderKey)+"_"+this.props.endpointId:e?C.mriOrId(this.props.renderKey):this.props.renderKey}static _generateComponentTag(e){return e.parentViewId?e.parentViewId+"#CallParticipantVideoView":"CallParticipantVideoView"}}t.default=S},3512:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(116),n=i(0),o=i(1696),s=i(110),r=i(13),l=i(6),c=i(66),d=i(9),u=i(14),h=i(12),p=i(101),g=i(65).UserIconSize.Size120,C=l.lazyProperties({container:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),containerAndroid:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",overflow:"visible"}),innerView:()=>u.default.absoluteFill,backgroundContainerView:()=>n.Styles.createViewStyle({backgroundColor:d.Color.transparent}),icon:()=>n.Styles.createViewStyle({width:g,height:g,overflow:"visible"}),connecting:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",position:"absolute",top:0,left:0,height:g,width:g,borderRadius:g/2,backgroundColor:d.Color.blackOverlay20,overflow:"hidden"}),talkingViewContainer:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",overflow:"visible"})});class m extends h.default{constructor(){super(...arguments),this._isTalking=!1,this._animatedBackgroundOpacityValue=new n.Animated.Value(0),this._animatedBackgroundOpacityStyle=n.Styles.createAnimatedViewStyle({opacity:this._animatedBackgroundOpacityValue}),this._animatedIconOpacityValue=new n.Animated.Value(0),this._animatedIconScaleValue=new n.Animated.Value(1),this._animatedIconStyle=n.Styles.createAnimatedViewStyle({opacity:this._animatedIconOpacityValue,transform:[{scale:this._animatedIconScaleValue}]}),this._onCallParticipantTalkingViewRef=e=>{this._callParticipantTalkingView=e||void 0}}_buildState(e,t){return{useHighContrastTheme:s.default.useHighContrastThemeAndChanges()}}componentDidMount(){super.componentDidMount(),this._updateIconOpacity(),this._updateBackgroundIconOpacity(!1),this._updateIconScale()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.props.iconOpacity!==e.iconOpacity&&this._updateIconOpacity(this.props.animateChanges),this.props.isConnecting===e.isConnecting&&this.props.backgroundOpacity===e.backgroundOpacity||this._updateBackgroundIconOpacity(s.default.enableLayoutAnimation()),this.props.size!==e.size&&this._updateIconScale(this.props.animateChanges),this._updateTalkingView()}updateTalking(e){this._isTalking!==e&&(this._isTalking=e,this._updateTalkingView())}_updateTalkingView(){this._callParticipantTalkingView&&this._callParticipantTalkingView.updateTalking(this._isTalking)}_updateIconScale(e=!1){const t=this.props.size/g;e?n.Animated.timing(this._animatedIconScaleValue,{duration:250,toValue:t,easing:n.Animated.Easing.InOut()}).start():this._animatedIconScaleValue.setValue(t)}_updateIconOpacity(e=!1){const t=this.props.iconOpacity||0;e?n.Animated.timing(this._animatedIconOpacityValue,{duration:250,toValue:t,easing:n.Animated.Easing.InOut()}).start():this._animatedIconOpacityValue.setValue(t)}_updateBackgroundIconOpacity(e){const t=this.props.isConnecting||!this.props.backgroundOpacity?0:this.props.backgroundOpacity;e?n.Animated.timing(this._animatedBackgroundOpacityValue,{duration:250,toValue:t,easing:n.Animated.Easing.InOut()}).start():this._animatedBackgroundOpacityValue.setValue(t)}render(){const e=this.props.isConnecting?n.createElement(n.View,{style:C.connecting},n.createElement(c.default,{size:r.SXActivityIndicatorSize.Medium,tintColor:d.Color.whiteOverlay80})):void 0,t=this.props.backgroundOpacity&&this.props.backgroundOpacity>0?n.createElement(n.View,{style:[C.innerView,C.talkingViewContainer]},n.createElement(o.default,{ref:this._onCallParticipantTalkingViewRef,size:o.CallParticipantTalkingViewSize.Large,talkingTintColor:this.state.useHighContrastTheme?d.Color.gray200:void 0})):void 0;let i=[this.props.style];i.push(C.container);const s=[C.innerView,C.backgroundContainerView];this.state.useHighContrastTheme?s.push(this._themeStyles.primaryBackgroundColorStyle):this.props.backgroundColorStyle&&s.push(this.props.backgroundColorStyle),this._animatedBackgroundOpacityStyle&&s.push(this._animatedBackgroundOpacityStyle);const l=this.props.gradientColors&&!this.state.useHighContrastTheme?n.createElement(a.GradientView,{style:C.innerView,direction:a.GradientDirection.BOTTOM,colors:this.props.gradientColors}):void 0;return n.createElement(n.View,{style:i},n.createElement(n.Animated.View,{style:s},l),n.createElement(n.View,{style:C.icon},n.createElement(n.Animated.View,{style:[u.default.overflowVisible,this._animatedIconStyle]},t,n.createElement(p.UserIcon,{userMri:this.props.userMri,size:g,forceMediumAvatarSize:!0,useCircleForAgentMask:!0,showBorder:!0}),e)))}}t.default=m},3513:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(15),o=i(60),s=i(26),r=i(6),l=i(36),c=i(59),d=i(9),u=i(11),h=i(10),p=r.lazyProperties({accessory:()=>a.Styles.createViewStyle({position:"absolute",width:24,height:24,borderRadius:12,backgroundColor:d.Color.blackOverlay50,alignItems:"center",justifyContent:"center"}),accessoryTopLeft:()=>a.Styles.createViewStyle({left:16,top:16}),accessoryTopRight:()=>a.Styles.createViewStyle({position:"absolute",right:16,top:16}),accessoryBottomLeft:()=>a.Styles.createViewStyle({position:"absolute",left:16,bottom:16}),accessoryBottomRight:()=>a.Styles.createViewStyle({position:"absolute",right:16,bottom:16}),accessoryCenterContainer:()=>a.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:100,height:24,alignItems:"center",justifyContent:"center"})});class g extends n.ComponentBase{_buildState(e,t){return{safeAreaHorizontalInsets:l.default.horizontalInsets({left:16,right:30})}}_styleForAccessoryPosition(e){switch(e){case o.CallAccessoryPosition.BottomLeft:return p.accessoryBottomLeft;case o.CallAccessoryPosition.BottomRight:return p.accessoryBottomRight;case o.CallAccessoryPosition.TopLeft:return p.accessoryTopLeft;case o.CallAccessoryPosition.TopRight:return p.accessoryTopRight}}render(){const e=this.props.position===o.CallAccessoryPosition.Center,t=[p.accessory];if(!e&&this.props.position){const e=this._styleForAccessoryPosition(this.props.position);if(e&&t.push(e),this.props.position===o.CallAccessoryPosition.BottomRight||this.props.position===o.CallAccessoryPosition.TopRight){!!this.state.safeAreaHorizontalInsets&&c.default.hasHorizontalSafeAreas(this.state.safeAreaHorizontalInsets)&&t.push(c.default.horizontalMarginStyle(this.state.safeAreaHorizontalInsets))}}let i;switch(this.props.type){case o.CallAccessoryType.Mute:i=u.SkypeIcon.MicrophoneOff;break;case o.CallAccessoryType.OnHold:i=u.SkypeIcon.Pause;break;case o.CallAccessoryType.Screensharing:i=u.SkypeIcon.ScreenShare;break;default:i=h.default.switchStatementExhaustiveChecking(this.props.type)}let n=a.createElement(a.View,{style:t,blockPointerEvents:!0,ignorePointerEvents:!0},a.createElement(s.default,{icon:i,size:u.IconSize.size12,color:d.Color.white}));return e&&(n=a.createElement(a.View,{style:p.accessoryCenterContainer,blockPointerEvents:!0,ignorePointerEvents:!0},n)),n}}t.default=g},3514:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(29),o=i(88),s=i(87),r=i(60),l=i(110),c=i(13),d=i(3),u=i(4),h=i(5),p=i(18),g=i(55),C=i(698),m=i(587),S=i(72),y=i(10),f=i(518),_="TurnOffVideo",b="Mute",v="Unmute",w="BlurBackground",T="UnblurBackground",I="CropVideo",P="FullVideo",M="BackgroundEffectsSettings",k="LowerHand",A="PinParticipant",R="UnpinParticipant";t.default=class{constructor(e){this._callLocalVideoContextMenuOptions=e,this._getActionsMenuConfig=e=>({anchor:e,useTheme:!0,positionPriorities:["top","bottom"],popupBeakSize:{height:0,width:0}}),this._getCallLocalVideoMenuItems=()=>{let e=[],t=this._getCameraMenuItems(),i=this._getOtherMenuItems();return t.length&&e.push({key:"cameraSwitching",menuItems:t}),e.push({key:"otherSettings",menuItems:i}),e},this._getCameraMenuItems=()=>{let e=[],t=n.default.DeviceStore.getCameras(),i=this._getSelectedCameraId();return a.each(t,t=>{e.push({text:t.label,command:t.id,selected:this._localVideoOn&&t.id===i,selectableType:c.SXMenuItemSelectableType.Checkbox})}),e.push({text:h.getString("CallControls.CallButtonTurnOffVideoLabel"),command:_,selected:!this._localVideoOn,selectableType:c.SXMenuItemSelectableType.Checkbox}),e},this._getOtherMenuItems=()=>{const e=[],t=l.default.isLocalOrServerMuted(this._callLocalVideoContextMenuOptions.callId);if(this._localVideoOn&&n.default.DeviceStore.isBackgroundBlurCapable()&&!n.default.DeviceStore.isBackgroundReplacementEnabled()){const t=n.default.DeviceStore.isBackgroundBlurred();e.push({text:t?h.getString("CallControls.CallMenuUnBlurBackground"):h.getString("CallControls.CallMenuBlurBackground"),command:t?T:w})}return this._localVideoOn&&n.default.DeviceStore.isBackgroundReplacementEnabled()&&e.push({text:h.getString("CallControlsOverFlowMenu.BackgroundEffectsSettings"),command:M}),e.push({text:t?h.getString("CallControls.CallMenuUnmuteMicrophone"):h.getString("CallControls.CallMenuMuteMicrophone"),command:t?v:b}),this._callLocalVideoContextMenuOptions.showLowerHand&&e.push({text:h.getString("CallControls.LowerHand"),command:k}),this._callLocalVideoContextMenuOptions.showCropUncropMenuOption&&!a.isUndefined(this._callLocalVideoContextMenuOptions.sizeToFit)&&(this._callLocalVideoContextMenuOptions.sizeToFit?e.push({text:h.getString("CallControls.ShowCroppedVideo"),command:I}):e.push({text:h.getString("CallControls.ShowFullVideo"),command:P})),this._callLocalVideoContextMenuOptions.showPinOption&&e.push({text:h.getString("CallControls.PinParticipant"),command:A}),this._callLocalVideoContextMenuOptions.showUnpinOption&&e.push({text:h.getString("CallControls.UnpinParticipant"),command:R}),e},this._selectMenuItem=(e,t)=>{const i=y.default.newCauseId();u.log(d.LogTraceArea.CallingUI,"CallLocalVideoContextMenu._selectMenuItem"+e+" causeId: "+i);let c=n.default.DeviceStore.getCameras();switch(a.each(c,t=>{if(t.id===e)return t.id!==this._getSelectedCameraId()&&(n.default.DeviceStore.choosePreferredDevices({camera:e},i),u.track(new o.LocalVideoActionsEvent(o.LocalVideoActions.SwitchCamera))),void(this._localVideoOn||(n.default.CallingStore.startVideo(this._callLocalVideoContextMenuOptions.callId,i),u.track(new o.LocalVideoActionsEvent(o.LocalVideoActions.TurnOnVideo))))}),e){case _:this._localVideoOn&&(n.default.CallingStore.stopVideo(this._callLocalVideoContextMenuOptions.callId,i),u.track(new o.LocalVideoActionsEvent(o.LocalVideoActions.TurnOffVideo)));break;case b:n.default.CallingStore.mute(this._callLocalVideoContextMenuOptions.callId,i),l.default.announceMicrophoneState(!0),s.default.updateCallTelemetry(this._callLocalVideoContextMenuOptions.callId,i,e=>e.muteLocalVideoContextMenuPress()),u.track(new o.LocalVideoActionsEvent(o.LocalVideoActions.Mute));break;case v:n.default.CallingStore.unmute(this._callLocalVideoContextMenuOptions.callId,i),l.default.announceMicrophoneState(!1),s.default.updateCallTelemetry(this._callLocalVideoContextMenuOptions.callId,i,e=>e.muteLocalVideoContextMenuPress()),u.track(new o.LocalVideoActionsEvent(o.LocalVideoActions.Unmute));break;case w:n.default.DeviceStore.setBackgroundBlurred(!0),u.track(new o.LocalVideoActionsEvent(o.LocalVideoActions.BackgroundBlur));break;case T:n.default.DeviceStore.setBackgroundBlurred(!1),u.track(new o.LocalVideoActionsEvent(o.LocalVideoActions.BackgroundUnBlur));break;case I:t&&t(!1);break;case P:t&&t(!0);break;case M:this._showAVSettings();break;case k:new C.LowerHandCommand(this._callLocalVideoContextMenuOptions.callId,m.LowerHandOrigin.OverflowMenu).execute();break;case A:f.default.pinParticipant(r.CallStageElementKeys.localUserKey,this._callLocalVideoContextMenuOptions.callId),u.track(new o.PinCallParticipant(this._callLocalVideoContextMenuOptions.callId));break;case R:f.default.unpinParticipant(r.CallStageElementKeys.localUserKey,this._callLocalVideoContextMenuOptions.callId),u.track(new o.UnpinCallParticipant(this._callLocalVideoContextMenuOptions.callId))}},this._showCallLocalVideoMenuPopup=(e,t,i,a)=>{const n=this._getActionsMenuConfig(i);S.default.showGroupWithOptions({id:this._callLocalVideoMenuId,config:n,getMenuGroups:this._getCallLocalVideoMenuItems,handleMenuCommand:a,rootViewId:e,invokingEvent:t})&&u.track(new o.LocalVideoActionsEvent(o.LocalVideoActions.PopupShown))},this._getSelectedCameraId=()=>{const e=n.default.DeviceStore.getCurrentDevices();return null==e?void 0:e.camera},this._showAVSettings=()=>{const e=y.default.newCauseId();u.log(d.LogTraceArea.CallingUI,"CallLocalVideContextMenu._showAVSettings causeId: "+e),p.default.navigateToDesktopSettingsGroup(g.SettingsGroup.AudioVideoSettings,c.MainRootViewId,e)},this._callLocalVideoMenuId=S.default.menuId(),this._localVideoOn=n.default.CallingStore.isProvidingVideo(this._callLocalVideoContextMenuOptions.callId)}showContextMenu(e,t,i,a){!!this._callLocalVideoContextMenuOptions.conversationMri&&n.default.CallingFeaturesHelper.allowOutboundVideo({isPSTNCall:n.default.CallingStore.isPSTNCall(this._callLocalVideoContextMenuOptions.callId),isEncryptedCall:n.default.CallingStore.isEncryptedCall(this._callLocalVideoContextMenuOptions.callId),conversationMri:this._callLocalVideoContextMenuOptions.conversationMri,callId:this._callLocalVideoContextMenuOptions.callId})?this._showCallLocalVideoMenuPopup(e,t,i,e=>this._selectMenuItem(e,a)):u.log(d.LogTraceArea.CallingUI,"CallLocalVideoContextMenu allowOutboundVideo is false")}}},3515:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(331),n=i(3516),o=i(328),s=i(88),r=i(110),l=i(13),c=i(3),d=i(4),u=i(5),h=i(18),p=i(583),g=i(698),C=i(587),m=i(72),S=i(10),y=i(518),f="RemoveFromCall",_="Mute",b="CropVideo",v="FullVideo",w="SendMessage",T="ViewProfile",I="MuteEveryone",P="LowerHand",M="ChangeTogetherModeBackground",k="PinParticipant",A="UnpinParticipant";t.default=class{constructor(e){this._callParticipantContextMenuOptions=e,this._selectUserNameChevronMenuItem=(e,t,i)=>{this._selectCanvasAndRibbonActionsMenuItem(e,t,i)},this._getCanvasAndRibbonActionsMenuConfig=e=>({anchor:e,useTheme:!0,positionPriorities:["top","bottom"],popupBeakSize:{height:0,width:0}}),this._getCallParticipantMenuItems=()=>{let e=[];return this._callParticipantContextMenuOptions.showMute&&e.push({text:u.getString("CallControls.CallButtonMute"),command:_,disabled:!this._callParticipantContextMenuOptions.isMuteOptionDisabled}),this._callParticipantContextMenuOptions.showRemoveCall&&e.push({text:u.getString("CallControls.RemoveFromCall"),command:f}),this._callParticipantContextMenuOptions.showCropVideoOption?e.push({text:u.getString("CallControls.ShowCroppedVideo"),command:b}):this._callParticipantContextMenuOptions.showFullVideoOption&&e.push({text:u.getString("CallControls.ShowFullVideo"),command:v}),this._callParticipantContextMenuOptions.showLowerHandOption&&r.default.canHandBeLoweredForParticipant(this._callParticipantContextMenuOptions.callId,this._callParticipantContextMenuOptions.userMri)&&e.push({text:u.getString("CallControls.LowerHand"),command:P}),this._callParticipantContextMenuOptions.showChangeTogetherModeBackgroundOption&&e.push({text:u.getString("CallControlsOverFlowMenu.ChangeTogetherModeBackground"),command:M}),this._callParticipantContextMenuOptions.showPinOption&&e.push({text:u.getString("CallControls.PinParticipant"),command:k}),this._callParticipantContextMenuOptions.showUnpinOption&&e.push({text:u.getString("CallControls.UnpinParticipant"),command:A}),e},this._getMenuItemsRelatedToOutsideTheCall=()=>{let e=[];return this._callParticipantContextMenuOptions.showSendMessageMenuOption&&e.push({text:u.getString("CallControls.SendMessageFromParticipantMenuAccessibilityLabel"),command:w}),this._callParticipantContextMenuOptions.showViewProfile&&e.push({text:u.getString("GroupProfilePanel.ViewInfo"),command:T}),e},this._getMenuItemsRelatedToModeratedChat=()=>{let e=[];return this._callParticipantContextMenuOptions.showMuteEveryone&&e.push({text:u.getString("CallControls.CallButtonMuteEveryone"),command:I}),e},this._getCanvasAndRibbonActionsMenuItems=()=>{const e=[],t=this._getCallParticipantMenuItems(),i=this._getMenuItemsRelatedToOutsideTheCall(),a=this._getMenuItemsRelatedToModeratedChat();return t.length>0&&e.push({key:"menuItemsCallParticipant",menuItems:t,title:void 0}),i.length>0&&e.push({key:"menuItemsRelatedToOutsideTheCall",menuItems:i}),a.length>0&&e.push({key:"menuItemsRelatedToModeratedChat",menuItems:a}),e},this._selectCanvasAndRibbonActionsMenuItem=(e,t,i)=>{const r=S.default.newCauseId();switch(d.log(c.LogTraceArea.CallingUI,"CallParticipantActionsContextMenu._selectCanvasAndRibbonActionsMenuItem causeId: "+r),e){case T:h.default.showDetailsPanelWithParams({mri:this._callParticipantContextMenuOptions.userMri,rootViewId:l.MainRootViewId,causeId:r}),d.track(new s.CanvasAndRibbonActionsEvent(s.CanvasAndRibbonActions.ViewProfile));break;case f:o.default.handleRemoteHangup(this._callParticipantContextMenuOptions.userMri,this._callParticipantContextMenuOptions.callId,r),d.track(new s.CanvasAndRibbonActionsEvent(s.CanvasAndRibbonActions.RemoveFromCall));break;case _:o.default.handleRemoteMute(this._callParticipantContextMenuOptions.userMri,this._callParticipantContextMenuOptions.callId,r),d.track(new s.CanvasAndRibbonActionsEvent(s.CanvasAndRibbonActions.Mute));break;case I:new a.MuteEveryoneCommand(this._callParticipantContextMenuOptions.callId).execute(),d.track(new s.CallMuteEveryoneEvent(s.MuteEveryoneOrigin.OverflowMenu));break;case b:if(i){new n.default(i).execute()}break;case v:if(i){new n.FullVideoCommand(i).execute()}break;case w:(new n.SendMessageCommand).execute(this._callParticipantContextMenuOptions.userMri);break;case P:new g.LowerHandParticipantCommand(this._callParticipantContextMenuOptions.callId,this._callParticipantContextMenuOptions.userMri,C.LowerHandOrigin.OverflowMenu,this._callParticipantContextMenuOptions.isLocal,this._callParticipantContextMenuOptions.displayName).execute();break;case M:new p.ChangeTogetherModeBackgroundCommand(this._callParticipantContextMenuOptions.callId,this._callParticipantContextMenuOptions.conversationMri).execute();break;case k:y.default.pinParticipant(this._callParticipantContextMenuOptions.userMri,this._callParticipantContextMenuOptions.callId),d.track(new s.PinCallParticipant(this._callParticipantContextMenuOptions.callId));break;case A:y.default.unpinParticipant(this._callParticipantContextMenuOptions.userMri,this._callParticipantContextMenuOptions.callId),d.track(new s.UnpinCallParticipant(this._callParticipantContextMenuOptions.callId))}},this._showCanvasAndRibbonActionsMenuPopup=(e,t,i,a,n,o)=>{const r=this._getCanvasAndRibbonActionsMenuConfig(i);m.default.showGroupWithOptions({id:this._canvasAndRibbonActionsMenuId,config:r,getMenuGroups:this._getCanvasAndRibbonActionsMenuItems,handleMenuCommand:a,onDismiss:o,maintainTitleForMobile:!0,cancelButtonTitleIOS:u.getString("Global.CancelLabel"),rootViewId:e,invokingEvent:t})&&(n&&n(),d.track(new s.CanvasAndRibbonActionsEvent(s.CanvasAndRibbonActions.PopupShown)))},this._canvasAndRibbonActionsMenuId=m.default.menuId()}showContextMenu(e,t,i,a,n,o){this._showCanvasAndRibbonActionsMenuPopup(e,t,i,e=>this._selectUserNameChevronMenuItem(e,n,o),a,n)}}},3516:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SendMessageCommand=t.FullVideoCommand=void 0;const a=i(88),n=i(61),o=i(3),s=i(4),r=i(18),l=i(39),c=i(10);t.default=class{constructor(e){this._onToggleCropVideo=e}execute(){s.log(o.LogTraceArea.Calling,"CropVideoCommand.execute."),this._onToggleCropVideo(!1)}};t.FullVideoCommand=class{constructor(e){this._onToggleCropVideo=e}execute(){s.log(o.LogTraceArea.Calling,"FullVideoCommand.execute."),this._onToggleCropVideo(!0)}};t.SendMessageCommand=class{execute(e){n.default.ensureConversationLoadedOrFaked(e,o.ConversationFakedOrigin.CallParticipantActionMenu).then(t=>{const i=c.default.newCauseId();s.log(o.LogTraceArea.Calling,"SendMessageCommand.execute, causeId: "+i+" user mri:"+l.mriOrId(e)),r.default.navigateToConversation({convId:e,origin:o.NavigationConversationOrigin.CallParticipantActionMenu,isNewConversation:t,causeId:i}),s.track(new a.CanvasAndRibbonActionsEvent(a.CanvasAndRibbonActions.SendMessage))})}}},3517:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(15),s=i(7),r=i(325),l=i(3518),c=i(3),d=i(4),u=i(6),h=i(28),p=u.lazyProperties({container:()=>n.Styles.createViewStyle({position:"absolute",top:0,right:0,bottom:0,left:0,alignItems:"center",justifyContent:"center"})});class g extends o.ComponentBase{constructor(){super(...arguments),this._onMaybeHandleReaction=e=>{if(d.log(c.LogTraceArea.CallReactions,"CallParticipantReactionView._onMaybeHandleReaction cuid: "+e.reaction.cuid),!this.isComponentMounted())return d.log(c.LogTraceArea.CallReactions,"CallParticipantReactionView._onMaybeHandleReaction cuid: "+e.reaction.cuid+" NOT handled (not mounted)"),!1;const t=!e.reaction.isEmoticonCallReaction()&&e.reactionsTextStyle===h.ReactionsTextStyle.Default;return this.state.enableSimpleTextReactions?(d.log(c.LogTraceArea.CallReactions,"CallParticipantReactionView._onMaybeHandleReaction cuid: "+e.reaction.cuid+" NOT handled (simple text reactions enabled)"),!1):t&&this.props.isCompact?(d.log(c.LogTraceArea.CallReactions,"CallParticipantReactionView._onMaybeHandleReaction cuid: "+e.reaction.cuid+" NOT handled (compact text reaction)"),!1):(this.setState({reactionInfo:e}),d.log(c.LogTraceArea.CallReactions,"CallParticipantReactionView._onMaybeHandleReaction cuid: "+e.reaction.cuid+" handled"),!0)}}_buildState(e,t){const i=s.default.getS4LCMCFeatures();let a={enableSimpleTextReactions:i.enableSimpleTextReactions};return t&&(a.reactionInfo=void 0),i.enableNewAnimations&&(a.newAnimatedReaction=i.callAnimatedReactionsConfig.callAnimatedReactionsKeys),a}componentDidMount(){if(super.componentDidMount(),this.props.getCallReactionsDisplayHelper){this.props.getCallReactionsDisplayHelper().registerParticipantReactionCallback(this.props.participantMri,this._onMaybeHandleReaction)}}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),t.reactionInfo&&t.reactionInfo.isLocal){const e=r.default.maybeGetAndClearReactionPressedScenario();e&&(e.markPerfTargetStepCompleted("componentDidUpdate"),a.defer(()=>{e.markStepCompleted("backOnJSThread"),e.finish()}))}}componentWillUnmount(){if(super.componentWillUnmount(),this.props.getCallReactionsDisplayHelper){const e=this.props.getCallReactionsDisplayHelper();e.unregisterParticipantReactionCallback(this.props.participantMri),e.dismissReaction(this.props.participantMri)}}render(){let e;if(this.state.reactionInfo){let t,i=this.state.reactionInfo.content;if(this.state.reactionInfo.reaction.isEmoticonCallReaction())t=l.CallReactionType.Emoji,i=this.state.reactionInfo.reaction.getEmoticonCallReactionKey();else if(this.state.reactionInfo.reactionsTextStyle===h.ReactionsTextStyle.Sticker)t=l.CallReactionType.Sticker;else if(this.state.reactionInfo.reactionsTextStyle===h.ReactionsTextStyle.Snapshot)t=l.CallReactionType.Snapshot;else{if(this.state.reactionInfo.reactionsTextStyle===h.ReactionsTextStyle.Animation)return null;if(this.state.reactionInfo.isLocal)return null;t=l.CallReactionType.Text}let a=[];this.props.borderRadius&&a.push(n.Styles.createViewStyle({borderRadius:this.props.borderRadius},!1)),i&&(e=n.createElement(l.default,{style:a,reactionType:t,cuid:this.state.reactionInfo.reaction.cuid,creator:this.state.reactionInfo.reaction.creator,content:i,reaction:this.state.reactionInfo.reaction,showBackgroundGradient:this.state.reactionInfo.reactionsTextStyle!==h.ReactionsTextStyle.Animation,gradientColors:this.state.reactionInfo.gradientColors,isCompact:this.props.isCompact,borderRadius:this.props.borderRadius,useMobileReactionsLayout:this.props.useMobileReactionsLayout}))}return n.createElement(n.View,{style:p.container,ignorePointerEvents:!0},e)}}t.default=g},3518:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallReactionType=void 0;const a=i(116),n=i(0),o=i(15),s=i(153),r=i(743),l=i(13),c=i(3),d=i(4),u=i(6),h=i(360),p=i(21),g=i(190),C=i(263),m=i(9),S=i(24),y=i(14),f=i(16),_=i(31),b=i(10);var v;!function(e){e[e.Text=0]="Text",e[e.Emoji=1]="Emoji",e[e.Sticker=2]="Sticker",e[e.Animation=3]="Animation",e[e.Snapshot=4]="Snapshot"}(v=t.CallReactionType||(t.CallReactionType={}));const w=n.Animated.Easing.CubicBezier(1,0,.78,1),T=n.Animated.Easing.CubicBezier(.33,0,0,1),I=u.lazyProperties({container:()=>n.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,paddingHorizontal:16,alignItems:"center",justifyContent:"center"}),containerCompact:()=>n.Styles.createViewStyle({paddingHorizontal:0,paddingVertical:0}),gradient:()=>n.Styles.createViewStyle({position:"absolute",top:0,right:0,bottom:0,left:0,opacity:.8}),textReaction:()=>n.Styles.createTextStyle({color:m.Color.white,textAlign:"center",lineHeight:S.default.controlFontSize.h4+5})});class P extends o.ComponentBase{constructor(){super(...arguments),this._reactionOpacityAnimatedValue=new n.Animated.Value(0),this._reactionAnimatedStyle=n.Styles.createAnimatedViewStyle({opacity:this._reactionOpacityAnimatedValue}),this._reactionScaleAnimatedValue=new n.Animated.Value(.25),this._reactionScaleAnimatedStyle=n.Styles.createAnimatedViewStyle({transform:[{scale:this._reactionScaleAnimatedValue}]}),this._startAnimation=()=>{d.log(c.LogTraceArea.CallReactions,"CallReactionView._startAnimation");let e,t=1.2;e=this.props.reactionType===v.Text?r.default.getTextTimeoutBasedOnContent(this.props.content):2e3,this.props.reactionType!==v.Text&&(this.props.isCompact&&p.default.isMyMri(this.props.creator)||!this.props.isCompact)&&(t=1.5);const i=g.default.timing(this._reactionScaleAnimatedValue,{toValue:t,duration:350,easing:w,useNativeDriver:!0});1!==this._reactionOpacityAnimatedValue._value?this._activeAnimation=n.Animated.parallel([g.default.timing(this._reactionOpacityAnimatedValue,{toValue:1,duration:350,easing:w,useNativeDriver:!0}),i]):this._activeAnimation=i,this._activeAnimation.start(t=>{this.isComponentMounted()&&(this._activeAnimation=g.default.timing(this._reactionScaleAnimatedValue,{toValue:1,duration:350,easing:T,useNativeDriver:!0}),this._activeAnimation.start(t=>{this.isComponentMounted()&&(this._reactionOnScreenTimer=_.default.setTimeout(()=>{this.isComponentMounted()&&(this._reactionOnScreenTimer=void 0,this._activeAnimation=n.Animated.parallel([g.default.timing(this._reactionOpacityAnimatedValue,{toValue:0,duration:350,easing:w,useNativeDriver:!0}),g.default.timing(this._reactionScaleAnimatedValue,{toValue:.25,duration:350,easing:w,useNativeDriver:!0})]),this._activeAnimation.start(()=>{this._activeAnimation=void 0,this.isComponentMounted()&&this.props.onAnimationOut&&this.props.onAnimationOut()}))},e))}))})},this._stopAnimation=()=>{this._activeAnimation&&(this._activeAnimation.stop(),this._activeAnimation=void 0),this._clearOnScreenTimer()},this._clearOnScreenTimer=()=>{this._reactionOnScreenTimer&&(_.default.clearTimeout(this._reactionOnScreenTimer),this._reactionOnScreenTimer=void 0)}}componentDidMount(){super.componentDidMount(),this._startAnimation();const e=b.default.newCauseId();d.log(c.LogTraceArea.CallReactions,"CallReactionView.componentDidMount  cuid: "+this.props.cuid+" callReactionType: "+this.props.reactionType+" causeId: "+e)}componentWillUnmount(){super.componentWillUnmount();const e=b.default.newCauseId();d.log(c.LogTraceArea.CallReactions,"CallReactionView.componentWillUnmount causeId: "+e),this._stopAnimation()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=b.default.newCauseId();d.log(c.LogTraceArea.CallReactions,"CallReactionView.componentDidUpdate causeId: "+a),e.cuid!==this.props.cuid&&(this._stopAnimation(),this._startAnimation())}render(){let e,t,i=[I.container,this._reactionAnimatedStyle,this.props.isCompact?I.containerCompact:void 0,this.props.style];if(this.props.reactionType===v.Emoji){const t=C.separateReactionNameAndTone(this.props.content);e=n.createElement(s.AnimatedEmoticon,{size:this.props.isCompact?s.Size.Large:s.Size.ExtraExtraLarge,innerText:this.props.content,emoticonName:t.reactionNameWithoutTone,standaloneAnimation:!0,tone:t.reactionTone})}else if(this.props.reactionType!==v.Text||this.props.isCompact)this.props.reactionType!==v.Snapshot||this.props.isCompact||(e=n.createElement(f.Header,{size:l.HeaderSize.h4,style:I.textReaction},this.props.content));else{const t={renderMedia:!1,textOverrideStyle:[S.default.fontStyle.h4,I.textReaction],allowTextFallbackEmoticons:!0,allowLargeEmoticons:!0,allowHugeEmoticons:!0};e=n.createElement(h.default,{message:this.props.reaction,options:t})}if(this.props.showBackgroundGradient){let e=[I.gradient];this.props.borderRadius&&e.push(n.Styles.createViewStyle({borderRadius:this.props.borderRadius},!1)),t=this.props.gradientColors?n.createElement(a.GradientView,{style:e,direction:a.GradientDirection.BOTTOM,colors:this.props.gradientColors}):void 0}return e=n.createElement(n.Animated.View,{style:[y.default.overflowVisible,this._reactionScaleAnimatedStyle]},e),n.createElement(n.Animated.View,{style:i,ignorePointerEvents:!0},t,e)}}t.default=P},3519:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallParticipantBackgroundReplaceCaption=void 0;const a=i(34),n=i(0),o=i(74),s=i(57),r=i(7),l=i(198),c=i(712),d=i(741),u=i(29),h=i(123),p=i(88),g=i(87),C=i(132),m=i(3),S=i(26),y=i(4),f=i(89),_=i(5),b=i(6),v=i(21),w=i(11),T=i(16),I=i(12),P=i(9),M=i(10),k=i(14),A=b.lazyProperties({modernStageBackgroundInfo:()=>n.Styles.createViewStyle({position:"absolute",overflow:"hidden",alignItems:"flex-start",justifyContent:"flex-start"}),bgInfoContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start"}),topContainer:()=>n.Styles.createViewStyle({flexDirection:"column",alignItems:"stretch",borderRadius:4,paddingHorizontal:8,paddingVertical:8,marginRight:6}),topContainerBg:()=>n.Styles.createViewStyle({backgroundColor:P.Color.blackOverlay70}),topContainerBgLight:()=>n.Styles.createViewStyle({backgroundColor:P.Color.whiteOverlay80}),topContainerBgLightTray:()=>n.Styles.createViewStyle({backgroundColor:P.Color.gray50overlay95}),topLineContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start"}),bottomLineContainer:()=>n.Styles.createViewStyle({paddingTop:0,flexDirection:"column-reverse",alignItems:"flex-start",height:16}),bingLineContainer:()=>n.Styles.createViewStyle({paddingTop:4,marginTop:6,flexDirection:"column-reverse",alignItems:"flex-start",borderTopWidth:1,flexGrow:1,borderColor:P.Color.whiteOverlay50}),bingLineText:()=>n.Styles.createTextStyle({color:P.Color.whiteOverlay70}),bingLineTextLight:()=>n.Styles.createTextStyle({color:P.Color.gray400}),nameText:()=>n.Styles.createTextStyle({color:P.Color.white}),nameTextLight:()=>n.Styles.createTextStyle({color:P.Color.gray400}),nameTextHover:()=>n.Styles.createTextStyle({textDecorationLine:"underline"}),iconLeft:()=>n.Styles.createViewStyle({margin:0}),iconLeftAlone:()=>n.Styles.createViewStyle({margin:0}),bingIconLeft:()=>n.Styles.createViewStyle({height:16,width:16})});class R extends I.default{constructor(e){super(e),this._onClick=()=>{if(this.state.backgroundEffectImageInfo){const e=this.state.backgroundEffectImageInfo,t=e.link;if(y.log(m.LogTraceArea.CallingUI,`Clicking other user Bing background effect info. IsoDate: ${e.isoDate}, Info exists: ${!!t}, IsCollapsed: ${this.state.isCollapsed}, EffectUser: ${a.pii.Mri(this.state.mri)}`),this.props.callId){const t=M.default.newCauseId();g.default.updateCallTelemetry(this.props.callId,t,e=>e.bingBackgroundEffectCaptionClick()),y.track(new p.BackgroundEffectsBingInfoClickEvent(this.props.callId,e.isoDate,this.state.mri,e.market,this.state.isCollapsed))}if(t){const e=r.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds,i=`${e.host}${t}`,a={browserTitle:_.getString("AudioVideoSettings.BackgroundEffectCategoryBing"),preventInAppNavigationForGuest:!l.default.canNavigateInApp(),conversationId:this.props.conversationMri,openInExternalBrowser:!e.tryOpenInAppBrowser,useBingMiniCanvas:!0};f.openUrlWithParams({origin:m.BrowserOrigin.LinkNode,url:i,options:a,rootViewId:this._getRootViewId()})}}},this._onMouseEnter=e=>{this.props.onMouseEnter&&this.props.onMouseEnter(e),this.setState({hover:!0})},this._onMouseLeave=e=>{this.props.onMouseLeave&&this.props.onMouseLeave(e),this.setState({hover:!1})},this._onKeyPress=e=>C.default.maybeHandleKeyPress(e,()=>{this._onClick()});const t=this._layoutController();t.onRectChanged&&t.onRectChanged(e=>{this._findSizeAndOffset()}),t.onTopRowChanged&&t.onTopRowChanged(()=>{let i=!1;t.getIsTopRowElement&&(i=t.getIsTopRowElement());let a=this.state.captionOffsets;t.bgInfoCaptionOffset&&(a=t.bgInfoCaptionOffset(this._getRootViewId(),e.isCallStageV2?e.isInTray?10:12:16)),this.setState({isTopRow:i,captionOffsets:a})})}_buildState(e,t){let i=e.renderInfo;e.callId&&!e.renderInfo&&(i=u.default.CallParticipantStore.getParticipantRenderInfo(e.renderKey,e.callId));const a=(null==i?void 0:i.mri)||this._extractMriForKey(i,e.renderKey,!1),n={renderInfo:i,mri:a,streamType:(null==i?void 0:i.renderScreenShare)?o.StreamType.ScreenSharing:o.StreamType.Video,controlsVisible:d.default.areCallControlsVisible(),backgroundEffectId:u.default.DeviceStore.getBackgroundEffectType()};e.callId&&(n.backgroundEffectImageInfo=u.default.CallParticipantBackgroundInfoStore.getBackgroundInfo(e.callId,a),n.backgroundEffectImageInfo||u.default.CallingStore.isCallConnected(e.callId)||!n.backgroundEffectId||(n.backgroundEffectImageInfo=c.default.getBingBackgroundImageInfoFromId(n.backgroundEffectId,e.callId,a)));const s=this._layoutController();if(s.viewRect){const e=s.viewRect();n.width=e.width,n.height=e.height}return s.bgInfoCaptionOffset&&(n.captionOffsets=s.bgInfoCaptionOffset(this._getRootViewId(),e.isCallStageV2?e.isInTray?10:12:16)),n.isTopRow=!1,s.getIsTopRowElement&&(n.isTopRow=s.getIsTopRowElement()),n.isCollapsed=this._isCollapsed(n.width,e.noExpand),n}componentDidMount(){super.componentDidMount(),this._findSizeAndOffset()}_isCollapsed(e,t){return r.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds.captionAlwaysCollapsed||e&&e<500||!!t}_getOptionalBackgroundEffectInfo(){if(!this.state.backgroundEffectImageInfo)return;const e=this.state.backgroundEffectImageInfo,t=e.caption,i=e.copyright;if(!t)return;const a=this._getCaptionOffset(),o=this.state.width-2*a.left,s=n.Styles.createViewStyle({top:a.top,left:a.left,maxWidth:o}),r=o-16+44,l=n.Styles.createViewStyle({maxWidth:r}),c=[A.modernStageBackgroundInfo,s];this.props.nametagOpacityStyle&&c.push(this.props.nametagOpacityStyle);const d=[this.props.useLightTheme?A.nameTextLight:A.nameText,l,k.default.pointerCursor];this.state.hover&&d.push(A.nameTextHover);const u=w.SkypeIcon.Search,h=this.state.isCollapsed&&(!this.state.hover||this.props.noExpand),p=this._iconView(u,h?A.iconLeftAlone:A.iconLeft),g=this.props.useLightTheme?this.props.isInTray?A.topContainerBgLightTray:A.topContainerBgLight:A.topContainerBg,C=this.props.useLightTheme?A.bingLineTextLight:A.bingLineText;let m,S=n.createElement(n.Animated.View,{style:[A.topContainer,g,k.default.pointerCursor]},p);if(h)m=n.createElement(n.Animated.View,{style:A.bgInfoContainer},S);else{const e=n.createElement(n.Animated.View,{style:[A.topContainer,g]},n.createElement(n.Animated.View,{style:[A.topLineContainer]},n.createElement(T.Caption,{style:d,numberOfLines:1},t)),n.createElement(n.Animated.View,{style:A.bottomLineContainer},n.createElement(T.Caption,{small:!0,numberOfLines:1,style:l},i)),n.createElement(n.Animated.View,{style:A.bingLineContainer},n.createElement(T.Caption,{small:!0,numberOfLines:1,style:[l,C]},_.getString("AudioVideoSettings.BackgroundEffectCategoryBing"))));m=n.createElement(n.Animated.View,{style:A.bgInfoContainer},S,e)}return n.createElement(n.Animated.View,{style:c,ignorePointerEvents:!0,key:"BingCaptionWrapper-"+this.state.mri,onPress:this._onClick,onKeyPress:this._onKeyPress,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,accessibilityTraits:n.Types.AccessibilityTrait.Button,blockPointerEvents:!1,tabIndex:0},m)}render(){const e=r.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds;return!this.props.hideCaption&&e.showBackgroundCaptions&&this.state.streamType===o.StreamType.Video?[this._getOptionalBackgroundEffectInfo()]:[void 0]}_getCaptionOffset(){let e=16,t=16;if(this.props.isCallStageV2){const i=this.props.isInTray?10:12;e=i,t=i}return this.state.captionOffsets&&(e=this.state.captionOffsets.y,t=this.state.captionOffsets.x),{top:e,left:t}}_extractMriForKey(e,t,i=!1){return(null==e?void 0:e.isLocal)?v.default.getSkypeMri():h.default.extractMriFromKey(t,i)}_layoutController(){var e,t;return this.props.layoutController(this.props.renderKey,!!(null===(t=null===(e=this.state)||void 0===e?void 0:e.renderInfo)||void 0===t?void 0:t.renderScreenShare))}_findSizeAndOffset(){const e=this._layoutController();if(e.viewRect){const t=e.viewRect();this.setState({width:t.width,height:t.height,isCollapsed:this._isCollapsed(t.width,this.props.noExpand)})}}_iconView(e,t){return r.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds.useBingLogoInsteadOfSearchIcon?n.createElement(n.Image,{source:s.Collection.BING_LOGO_SMALL,style:[t,A.bingIconLeft],resizeMode:"cover"}):e?n.createElement(S.default,{icon:e,color:P.Color.white,size:w.IconSize.size16,style:t}):void 0}}t.CallParticipantBackgroundReplaceCaption=R,t.default=R},3520:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(15),o=i(9);class s extends n.ComponentBase{constructor(e){super(e),this._loopDuration=3e3,this._backgroundRing1ScaleAnimatedValue=new a.Animated.Value(1),this._backgroundRing1ScaleAnimatedStyle=a.Styles.createAnimatedViewStyle({transform:[{scale:this._backgroundRing1ScaleAnimatedValue}]}),this._backgroundRing2ScaleAnimatedValue=new a.Animated.Value(1),this._backgroundRing2ScaleAnimatedStyle=a.Styles.createAnimatedViewStyle({transform:[{scale:this._backgroundRing2ScaleAnimatedValue}]}),this._backgroundRing3ScaleAnimatedValue=new a.Animated.Value(1),this._backgroundRing3ScaleAnimatedStyle=a.Styles.createAnimatedViewStyle({transform:[{scale:this._backgroundRing3ScaleAnimatedValue}]})}_startAnimation(){this._animation=a.Animated.parallel([a.Animated.sequence([a.Animated.timing(this._backgroundRing1ScaleAnimatedValue,{delay:.3*this._loopDuration,toValue:1.9,easing:a.Animated.Easing.CubicBezier(.33,0,0,1),duration:.5*this._loopDuration,isInteraction:!1}),a.Animated.timing(this._backgroundRing1ScaleAnimatedValue,{toValue:1,easing:a.Animated.Easing.CubicBezier(.5,0,1,1),duration:.2*this._loopDuration,isInteraction:!1})]),a.Animated.sequence([a.Animated.timing(this._backgroundRing2ScaleAnimatedValue,{toValue:2.1,easing:a.Animated.Easing.CubicBezier(.33,0,0,1),duration:.66*this._loopDuration,isInteraction:!1}),a.Animated.timing(this._backgroundRing2ScaleAnimatedValue,{toValue:1,easing:a.Animated.Easing.CubicBezier(.7,0,1,1),duration:.33*this._loopDuration,isInteraction:!1})]),a.Animated.sequence([a.Animated.timing(this._backgroundRing3ScaleAnimatedValue,{toValue:2.3,easing:a.Animated.Easing.CubicBezier(.33,0,0,1),duration:.75*this._loopDuration,isInteraction:!1}),a.Animated.timing(this._backgroundRing3ScaleAnimatedValue,{toValue:1,easing:a.Animated.Easing.CubicBezier(.9,0,1,1),duration:.25*this._loopDuration,isInteraction:!1})])]),this._animation.start(()=>{this.isComponentMounted()&&this.props.animate&&this._startAnimation()})}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),!e.animate&&this.props.animate&&this._startAnimation()}componentDidMount(){super.componentDidMount(),this.props.animate&&this._startAnimation()}_containerStyle(){const e=this.props.size||200;return a.Styles.createViewStyle({overflow:"visible",width:e,height:e,alignItems:"center",justifyContent:"center"},!1)}_backgroundRing1Style(){const e=this.props.size||200;return a.Styles.createViewStyle({position:"absolute",top:e/4,left:e/4,width:e/2,height:e/2,borderRadius:e/4,backgroundColor:o.Color.gray300,opacity:.35},!1)}_backgroundRing2Style(){const e=this.props.size||200;return a.Styles.createViewStyle({position:"absolute",top:e/4,left:e/4,width:e/2,height:e/2,borderRadius:e/4,backgroundColor:o.Color.gray300,opacity:.15},!1)}_backgroundRing3Style(){const e=this.props.size||200;return a.Styles.createViewStyle({position:"absolute",top:e/4,left:e/4,width:e/2,height:e/2,borderRadius:e/4,backgroundColor:o.Color.gray300,opacity:.15},!1)}_backgroundRing0Style(){const e=this.props.size||200;return a.Styles.createViewStyle({position:"absolute",top:e/4,left:e/4,width:e/2,height:e/2,borderRadius:e/4,backgroundColor:o.Color.gray300,opacity:.07,transform:[{scale:2.3}]},!1)}render(){return a.createElement(a.View,{style:this.props.style,blockPointerEvents:!0},a.createElement(a.View,{style:this._containerStyle()},a.createElement(a.Animated.View,{style:[this._backgroundRing0Style()]}),a.createElement(a.Animated.View,{style:[this._backgroundRing1Style(),this._backgroundRing1ScaleAnimatedStyle]}),a.createElement(a.Animated.View,{style:[this._backgroundRing2Style(),this._backgroundRing2ScaleAnimatedStyle]}),a.createElement(a.Animated.View,{style:[this._backgroundRing3Style(),this._backgroundRing3ScaleAnimatedStyle]})))}}t.default=s},3538:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(6),o=i(5),s=i(126),r=i(13),l=i(66),c=n.lazyProperties({container:()=>a.Styles.createViewStyle({alignItems:"center"}),loadingIndicator:()=>a.Styles.createViewStyle({marginBottom:20,marginTop:20}),loadingText:()=>a.Styles.createTextStyle({fontSize:s.MeetNowFontSize.lobbySubtitle,marginBottom:20})});t.default=({primaryColor:e})=>a.createElement(a.View,{style:c.container},a.createElement(a.View,{style:c.loadingIndicator},a.createElement(l.default,{size:r.SXActivityIndicatorSize.Medium,tintColor:e})),a.createElement(a.Text,{style:[c.loadingText,{color:e}]},o.getString("SetConversationParticipantsPanel.CreatingNewConversation")))},3539:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(5),o=i(6),s=i(126),r=i(24),l=i(12),c=o.lazyProperties({title:()=>a.Styles.createTextStyle({font:r.default.font.uiDisplayBold,fontSize:s.MeetNowFontSize.lobbyTitle,lineHeight:36,marginBottom:16})});class d extends l.default{render(){const e=[c.title,this._themeStyles.primaryTextColorStyle];return a.createElement(a.View,null,a.createElement(a.Text,{style:e},n.getString("MeetNow.LobbyCreatorMainTitleV2")))}}t.default=d},3547:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(6),o=i(12),s=i(29),r=i(3548),l=i(3549),c=i(3),d=i(13),u=i(5),h=i(9),p=i(24),g=i(42),C=i(1711),m=i(158),S=i(261),y=i(1232),f=i(890),_=i(27),b=i(528),v=i(11),w=i(14),T={width:536,height:302},I=n.lazyProperties({container:()=>a.Styles.createViewStyle({maxWidth:552,padding:8}),meetingNameText:()=>a.Styles.createTextStyle({marginBottom:22,overflow:"visible",textAlign:"center",fontSize:20,fontWeight:"bold",lineHeight:24}),audioVideoPreviewViewContainer:()=>a.Styles.createViewStyle({marginBottom:24}),joinButtonView:()=>a.Styles.createViewStyle({marginBottom:15}),joinButtonInnerContainer:()=>a.Styles.createViewStyle({paddingLeft:50,paddingRight:50}),skypeLogoView:()=>a.Styles.createViewStyle({marginBottom:17}),termsOfService:()=>a.Styles.createTextStyle({fontSize:12,lineHeight:18,maxWidth:250})});class P extends o.default{constructor(){super(...arguments),this._join=()=>{S.default.trackStartOrJoinMeetNowButtonClicked(this._conversationMri),this._audioVideoPreviewViewRef&&(this.setState({joinNowClicked:!0}),this._audioVideoPreviewViewRef.onStartOrJoinCall())},this._setAudioVideoPreviewViewRef=e=>{this._audioVideoPreviewViewRef=e},this._getVideoContainerDimensions=()=>{let e=T;const{isSmallScreen:t,viewportWidth:i}=this.state;if(t){e={width:i,height:i/(T.width/T.height)}}return a.Styles.createViewStyle(e)}}_buildState(e,t){const{convId:i}=e.meetNowParameters,a=i?s.default.ActiveCallUIHelper.getActiveCallId(i):void 0,n=i?m.MeetNowHelpers.getMeetingName(i):void 0,o=this._getRootViewId(),r=_.default.isWidthSmallerThanThreshold(T.width,o),l=_.default.getWidth(o);return this._conversationMri=i,this._isGuestFlow=m.MeetNowHelpers.isGuestFlow(),{activeCallId:a,meetingName:n,isSmallScreen:r,viewportWidth:l}}render(){return a.createElement(C.default,{meetNowParameters:this.props.meetNowParameters},a.createElement(a.View,{style:I.container},a.createElement(r.default,{activeCallId:this.state.activeCallId,conversationMri:this._conversationMri}),a.createElement(a.Text,{style:[I.meetingNameText,{color:this._themeColors.primaryTextColor}]},this.state.meetingName),this._renderAudioVideoPreviewView(),this._isGuestFlow&&this._renderUserNameInput(),a.createElement(a.View,{style:[I.joinButtonView,w.default.alignItemsCenter]},a.createElement(g.default,{key:"join-meeting-button",accessibilityLabel:u.getString("MeetNow.JoinMeeting"),buttonStyle:d.SXButtonStyle.ColorFill,title:u.getString("MeetNow.JoinNow"),hoverText:u.getString("MeetNow.JoinNow"),onPress:this._join,buttonSize:d.SXButtonSize.Medium,minHeight:46,disabled:this.state.joinNowClicked,autoFocus:!0,showActivityIndicator:this.state.joinNowClicked,textStyleDeprecated:p.default.fontStyle.body,innerContainerStyle:I.joinButtonInnerContainer})),this._isGuestFlow&&this._renderGuestFooter()))}_renderAudioVideoPreviewView(){const e=[I.audioVideoPreviewViewContainer,this._getVideoContainerDimensions()];return this._isGuestFlow&&e.push(a.Styles.createViewStyle({marginBottom:16})),a.createElement(a.View,{style:e},a.createElement(l.default,{conversationMri:this._conversationMri,activeCallId:this.state.activeCallId,callOrigin:c.NavigationCallOrigin.MeetNow,ref:this._setAudioVideoPreviewViewRef,isGoLive:!0}))}_renderUserNameInput(){const{meetNowParameters:e}=this.props;if(!e.convId)return;const t=a.Styles.createViewStyle({flexDirection:"row",justifyContent:"center"}),i=a.Styles.createViewStyle({flex:1,maxWidth:350}),n=a.Styles.createViewStyle({minHeight:46,borderWidth:1,borderRadius:8,borderColor:h.Color.gray200Overlay80});return a.createElement(a.View,{style:t},a.createElement(a.View,{style:i},a.createElement(y.default,{threadId:e.convId,meetNowParameters:e,inputContainerStyles:n})))}_renderGuestFooter(){return a.createElement(a.View,null,a.createElement(a.View,{style:[I.skypeLogoView,w.default.alignItemsCenter]},a.createElement(b.SkypeLogo,{size:v.IconSize.size36,isAnimated:!1})),a.createElement(a.View,{style:w.default.alignItemsCenter},a.createElement(f.TermsOfService,{style:I.termsOfService,isDarkModeEnabled:this._useDarkTheme()})))}}t.default=P},3548:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(29),o=i(9),s=i(65),r=i(286),l=i(6),c=i(5),d=i(12),u=i(101),h=l.lazyProperties({mainContainer:()=>a.Styles.createViewStyle({flexDirection:"column",alignContent:"center",justifyContent:"center",alignItems:"center",padding:8}),participantsListContainer:()=>a.Styles.createViewStyle({flexDirection:"row-reverse",alignContent:"center",justifyContent:"center",alignItems:"center"}),participantsListContainerLeft:()=>a.Styles.createViewStyle({flexDirection:"row",backgroundColor:o.Color.transparent,alignContent:"center",alignItems:"center"}),participantsListContainerRight:()=>a.Styles.createViewStyle({flexDirection:"row-reverse",backgroundColor:o.Color.transparent,overflow:"visible",alignContent:"center",alignItems:"center"}),meetingAvatar:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",marginTop:8}),meetingParticipantsLabel:()=>a.Styles.createTextStyle({flex:1,marginHorizontal:8,marginTop:8,textAlign:"center",textAlignVertical:"center",alignSelf:"stretch"}),participantsListItemLeft:()=>a.Styles.createViewStyle({marginRight:-16}),participantsListItemRight:()=>a.Styles.createViewStyle({marginLeft:-16})});class p extends d.default{constructor(){super(...arguments),this._mainIconSize=s.ConversationIconSize.Size60,this._secondaryIconSize=s.UserIconSize.Size50,this._tertiaryIconSize=s.UserIconSize.Size40}_buildState(e,t){const i=e.activeCallId?n.default.CallingStore.connectedParticipants(e.activeCallId).map(e=>({userMri:e.id,userName:decodeURI(e.displayName)})):[],a=i.length;return{shouldOnlyShowMeetingAvatar:a<2,connectedParticipantsList:i,inviteLabel:0===a?c.getString("MeetNow.CallPreviewInviteMessageSimple"):1===a?c.getString("MeetNow.CallPreviewInviteMessageOneParticipant",{name:i[0].userName}):c.getString("MeetNow.CallPreviewInviteMessageMoreParticipants",{name:i[0].userName})}}render(){return this.state.shouldOnlyShowMeetingAvatar?this._renderMeetingAvatarOnlyHeader():this._renderMeetingAvatarWithParticipantsList()}_renderMeetingAvatarOnlyHeader(){return a.createElement(a.View,{style:h.mainContainer},a.createElement(r.default,{size:this._mainIconSize,conversationId:this.props.conversationMri,style:h.meetingAvatar}),a.createElement(a.Text,{style:[h.meetingParticipantsLabel,this._themeStyles.primaryTextColorStyle]},this.state.inviteLabel))}_renderMeetingAvatarWithParticipantsList(){return a.createElement(a.View,{style:h.mainContainer},a.createElement(a.View,{style:h.participantsListContainer},a.createElement(a.View,{style:h.participantsListContainerRight},this.state.connectedParticipantsList.length>=4&&a.createElement(u.UserIcon,{userMri:this.state.connectedParticipantsList[3].userMri,size:this._tertiaryIconSize,style:[h.participantsListItemRight]}),a.createElement(u.UserIcon,{userMri:this.state.connectedParticipantsList[1].userMri,size:this._secondaryIconSize,style:[h.participantsListItemRight]})),a.createElement(a.View,{style:h.participantsListContainerLeft},this.state.connectedParticipantsList.length>=4&&a.createElement(u.UserIcon,{userMri:this.state.connectedParticipantsList[2].userMri,size:this._tertiaryIconSize,style:[h.participantsListItemLeft]}),a.createElement(u.UserIcon,{userMri:this.state.connectedParticipantsList[0].userMri,size:this._secondaryIconSize,style:[h.participantsListItemLeft]}),a.createElement(r.default,{size:this._mainIconSize,conversationId:this.props.conversationMri,style:[h.meetingAvatar]}))),a.createElement(a.Text,{style:[h.meetingParticipantsLabel,this._themeStyles.primaryTextColorStyle]},this.state.inviteLabel))}}t.default=p},3549:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(1224),o=i(113),s=i(6),r=i(3),l=i(12),c=i(14),d=i(65),u=i(4),h=s.lazyProperties({container:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignContent:"stretch",alignItems:"stretch"})});class p extends l.default{constructor(){super(...arguments),this._setCallPreviewViewRef=e=>{this._callPreviewViewRef=e}}_buildState(e,t){return{canRequestPermissionsBeforeNavigation:o.default.meetnow().canRequestPermissionsBeforeNavigation,useAvatarPlaceholderIcon:!o.default.meetnow().canEditMeetingName}}render(){return a.createElement(a.View,{style:[h.container,c.default.overflowVisible]},a.createElement(n.default,{dialogId:"AudioVideoPreviewView",onVideoRenderingChange:this.props.onVideoRenderingChange,isGoLive:this.props.isGoLive,conversationMri:this.props.conversationMri,activeCallId:this.props.activeCallId,fallbackCallId:this.props.fallbackCallId,callOrigin:this.props.callOrigin,hideActionButton:!0,displayControlsUnderVideoCanvas:!1,showCameraAndMicrophoneDetails:!1,avatarSize:d.UserIconSize.Size160,useAvatarPlaceholderIcon:this.state.useAvatarPlaceholderIcon,skipPermissionPanel:this.props.skipPermissionPanel,fullScreenMode:!1,ref:this._setCallPreviewViewRef,isNewCallPreviewStyle:!0}))}onStartOrJoinCall(){this._callPreviewViewRef?this._callPreviewViewRef.onStartOrJoinCall():u.log(r.LogTraceArea.JoinLink,"AudioVideoPreviewView.onStartOrJoinCall, failed callPreviewRef is not defined")}}t.default=p},3564:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GroupMemberHelper=void 0;const a=i(1),n=i(0),o=i(3),s=i(5),r=i(330),l=i(613),c=i(216),d=i(28),u="groupMember_";class h extends c.SearchSectionHelper{constructor(e=o.SearchResultsListGroup.GroupMember){super(),this._keys={footer:"groupMemberFooter",header:"groupMemberHeader"},this._groupType=e}static _getKey(e){return u+e}static _getMri(e){return e}buildConfig(e,t,i){return{inactiveCallMemberMris:t.searchController.getGroupMemberResults(t.conversationId),searchQuery:i.trimmedNormalizedQuery,limit:3}}getItems(e,t,i,a,n){const r=o.SearchResultsListGroup.GroupMember,l={itemTemplate:"groupMember",header:s.getString("QuickCallPanel.GroupMembersNotOnCallSectionHeader",{count:this._searchConfig.inactiveCallMemberMris.length})},d=c.SearchSectionHelper.generateItemsLists({searchResultsListState:e,searchResultsListProps:t,groupType:r,sourceList:this._searchConfig.inactiveCallMemberMris,keys:this._keys,renderConfig:l,getKey:h._getKey,getMri:h._getMri,limit:3,onFooterPress:n}),u=d.defaultList||[];return e.isShowingMore[this._groupType]&&u.push(...d.listWithRestOfItems),d.footerItem&&u.push(d.footerItem),d.defaultList}renderItem(e){return"groupMemberHeader"===e.item.key?c.SearchSectionHelper.renderHeader(s.getString("QuickCallPanel.GroupMembersNotOnCallSectionHeader",{count:this._searchConfig.inactiveCallMemberMris.length})):"groupMemberFooter"===e.item.key?this._renderFooterItem(e.item):e.item.key.substr(0,u.length)===u?this._renderSearchResultItem(e):void 0}_renderFooterItem(e){return n.createElement(l.default,{shouldShowAllResults:e.isShowingMore,groupType:this._groupType,onShowMorePress:e.onPress})}_renderSearchResultItem(e){const t=e.item.key.substr(u.length),i=c.SearchSectionHelper.getSearchBaseItemProps(e,t),s={textToHighlight:this._searchConfig.searchQuery,highlightType:d.TextToHighlightType.DisplayName};return n.createElement(r.default,Object.assign({},i,{key:"groupMemberItem",mri:t,textToHighlightInfo:s,showLastCallInfo:!1,groupType:o.SearchResultsListGroup.GroupMember,onItemPress:e.item.onListItemClick||a.noop}))}}t.GroupMemberHelper=h},3571:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PstnDialpadHelper=t.PstnDialpadItem=void 0;const a=i(0),n=i(15),o=i(3),s=i(472),r=i(173),l=i(6),c=i(216),d=i(1237),u=l.lazyProperties({spacer:()=>a.Styles.createViewStyle({height:10})});class h extends n.ComponentBase{_buildState(e,t){return{disableHighBandwidthOperations:r.default.isUsingGogoNetwork()}}requestFocus(){}render(){return a.createElement(d.default,{location:s.ExperimentLocation.CallsPanel})}}t.PstnDialpadItem=h;class p extends c.SearchSectionHelper{constructor(){super()}buildConfig(e,t,i){}getItems(e,t,i,a){const n=[];return n.push({key:"dialpad",height:56,measureHeight:!0,template:"dialpad",isLastItem:!0,groupType:o.SearchResultsListGroup.PstnDialpad,onListItemClick:t.onListItemClick,isHoverable:!1}),n}renderItem(e){return"dialpad"===e.item.key?this._renderDialpadItem(e):"dialpadSpacer"===e.item.key?this._renderSpacer():void 0}_renderSpacer(){return a.createElement(a.View,{key:"dialpadSpacer",style:u.spacer})}_renderDialpadItem(e){return a.createElement(h,Object.assign({},e))}}t.PstnDialpadHelper=p},3572:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LayoutOptionNewCta=t.ActionButtonType=void 0;const a=i(1),n=i(0),o=i(57),s=i(13),r=i(67),l=i(472),c=i(1726),d=i(6),u=i(5),h=i(135),p=i(42),g=i(9),C=i(14),m=i(16);var S;!function(e){e[e.GetFreeTrial=0]="GetFreeTrial",e[e.GetCredit=1]="GetCredit",e[e.GetSubscription=2]="GetSubscription"}(S=t.ActionButtonType||(t.ActionButtonType={}));const y=o.Collection.SKYPE_TO_PHONE_SMALL_FT,f=o.Collection.SKYPE_TO_PHONE_TINY_FT,_=d.lazyProperties({listItemContainer:()=>n.Styles.createViewStyle({flexDirection:"row"}),buttonContainer:()=>n.Styles.createViewStyle({maxWidth:150,flexDirection:"column",justifyContent:"center",paddingHorizontal:10,overflow:"visible"}),buttonContainerWide:()=>n.Styles.createViewStyle({maxWidth:200}),buttonContainerSmall:()=>n.Styles.createViewStyle({maxWidth:130,paddingLeft:5}),iconContainer:()=>n.Styles.createViewStyle({width:60,flexDirection:"column",justifyContent:"center",alignItems:"center",overflow:"visible"}),iconContainerTiny:()=>n.Styles.createViewStyle({width:38}),iconStyleTiny:()=>n.Styles.createImageStyle({width:22,height:22,justifyContent:"center",overflow:"visible"}),centerTextContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"column",justifyContent:"space-around",paddingVertical:8,flexGrow:1}),centerTextContainterSmallPadding:()=>n.Styles.createViewStyle({paddingVertical:4,flexShrink:1}),entitlementsContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"column",paddingTop:1}),itemDivider:()=>n.Styles.createViewStyle({height:1,marginLeft:10,marginRight:10}),buttonTextStyle:()=>n.Styles.createTextStyle({textAlign:"center"})});class b extends c.default{constructor(){super(...arguments),this._renderTopText=e=>n.createElement(m.Caption,{numberOfLines:1},e)}render(){const e=[_.iconContainer],t=[_.buttonContainer],i=[_.centerTextContainer];let o;o=!!this.props.experimentSettings&&(this.props.experimentSettings.location===l.ExperimentLocation.DialerPanel&&this.props.isLandscape),(this.props.isSmallDevice&&!this.props.isLandscape||o)&&t.push(_.buttonContainerSmall),o&&(i.push(_.centerTextContainterSmallPadding),e.push(_.iconContainerTiny));const s=u.getString("Entitlements.SkypeToPhoneTitle"),c=this._renderTopText(s),d=this._renderCenterText(),p=this._renderActionButton(),g=[s,d.accessibilityLabel,p.accessibilityLabel],m=a.join(g,", ");return n.createElement(n.View,null,n.createElement(h.MaybeListItem.Button,{style:[_.listItemContainer,C.default.pointerCursor],accessibilityLabel:m,onPress:this._onProceedButtonPress,accessibilityTraits:n.Types.AccessibilityTrait.Button},n.createElement(n.View,{style:e},o?this._renderImage(f,_.iconStyleTiny):this._renderImage(y,void 0)),n.createElement(n.View,{style:i},c,d.element),n.createElement(n.View,{style:t},p.element)),n.createElement(r.default,{style:_.itemDivider}))}_renderCenterText(){if(this.props.isFreeTrialAvailable||"none"===this.props.userEntitlementsSummary){const e=u.getString("SkypeToPhonePanel.CallPhoneNumbers");return{element:n.createElement(n.View,{style:_.entitlementsContainer},n.createElement(m.Caption,{numberOfLines:void 0,selected:!0},e)),accessibilityLabel:e}}{const e=this._renderCallingEntitlement(),t=this._renderSubscriptions(),i=a.compact([e?e.accessibilityLabel:void 0,t.accessibilityLabel]),o=a.join(i,", ");return{element:n.createElement(n.View,{style:_.entitlementsContainer},e?e.element:void 0,t.element),accessibilityLabel:o}}}_renderActionButton(){return this.props.isFreeTrialAvailable?this._renderButton(S.GetFreeTrial):"credit_only"===this.props.userEntitlementsSummary?this._renderButton(S.GetSubscription):this._renderButton(S.GetCredit)}_renderButton(e){let t="";const i={textColor:g.Color.white,backgroundColor:this._themeColors.buttonBackgroundColor};switch(e){case S.GetFreeTrial:i.backgroundColor=g.Color.green,t=u.getString("SkypeToPhonePanel.GetFreeTrialButton");break;case S.GetCredit:i.backgroundColor=g.Color.orange,t=u.getString("SkypeToPhonePanel.GetCreditButton");break;case S.GetSubscription:i.backgroundColor=g.Color.blue,t=u.getString("SkypeToPhonePanel.GetSubscriptionButton")}if(this._useAccessibleTheme()){const e=this._useDarkTheme();i.backgroundColor=e?g.Color.white:g.Color.black,i.textColor=e?g.Color.black:g.Color.white}return{element:n.createElement(n.View,{blockPointerEvents:!0},n.createElement(p.default,{title:t,buttonStyle:s.SXButtonStyle.Custom,buttonSize:s.SXButtonSize.Small,buttonConfig:i,allowTextWrap:!0,textStyleDeprecated:_.buttonTextStyle})),accessibilityLabel:t}}_renderSubscriptions(){let e;return e=this.props.subscriptionMinutes&&1===this.props.subscriptionsCount?-1===this.props.subscriptionMinutes?u.getString("SkypeToPhonePanel.SubscriptionUnlimited"):u.getString("SkypeToPhonePanel.SubscriptionMinutesLeft",{count:this.props.subscriptionMinutes||""}):u.getString("SkypeToPhonePanel.SubscriptionsCount",{count:this.props.subscriptionsCount}),{element:this._renderSmallBodyText(e),accessibilityLabel:e}}_renderCallingEntitlement(){if(this.props.formattedBalance){const e=u.getString("SkypeToPhonePanel.Credit",{amount:this.props.formattedBalance||""});return{element:this._renderSmallBodyText(e),accessibilityLabel:e}}}_renderSmallBodyText(e){return n.createElement(m.BodyText,{numberOfLines:1,bold:!0,size:s.BodyTextSize.SmallDeprecated},e)}}t.LayoutOptionNewCta=b,t.default=b},3573:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(35),o=i(0),s=i(15),r=i(7),l=i(221),c=i(13),d=i(134),u=(i(284),i(227)),h=i(27),p=i(222);class g extends s.ComponentBase{_buildState(e,t){const i=d.default.getSubscriptions(),o=d.default.getCreditEntitlement(),s=u.default.getLoadedPersonalizedRecommendations();return{canRenderEntitlements:r.default.getS4LEntitlementFeatures().SCE.UserServices.Client.Features.UIEnabled,userFormattedBalance:l.getFormattedBalance(o),userSubscriptionsCount:i?a.size(i):0,hasActiveCreditEntitlements:l.hasUsableCredit(o),hasCallingEntitlements:d.default.userHasSubscriptions(),userEntitlementsSummary:l.getEntitlementCombination(o,i),subscriptionMinutes:1===a.size(i)?i[0].isUnlimited?-1:i[0].availableMinutes:void 0,isFreeTrialAvailable:s&&a.some(s.callingOffers,e=>e.isFreeTrial),isSmallDevice:h.default.isSmallDevice(c.MainRootViewId),isLandscape:void 0!==e.isLandscape?e.isLandscape:h.default.getDeviceOrientation(c.MainRootViewId)===n.DeviceOrientation.Landscape,shouldUseGPlayBilling:p.default.shouldUseGooglePlayBillingForCredit()||p.default.shouldUseGooglePlayBillingForSubscriptions()}}componentDidMount(){super.componentDidMount(),this.state.shouldUseGPlayBilling?p.default.requestUpdate():u.default.requestPersonalizedRecommendationsUpdate()}render(){const e=this.props.layoutComponent;return o.createElement(e,{experimentSettings:this.props.experimentSettings,userEntitlementsSummary:this.state.userEntitlementsSummary,formattedBalance:this.state.userFormattedBalance,subscriptionsCount:this.state.userSubscriptionsCount,hasActiveCreditEntitlements:this.state.hasActiveCreditEntitlements,hasCallingEntitlements:this.state.hasCallingEntitlements,subscriptionMinutes:this.state.subscriptionMinutes,isFreeTrialAvailable:this.state.isFreeTrialAvailable,isSmallDevice:this.state.isSmallDevice,isLandscape:this.state.isLandscape})}}t.default=g},3576:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RecentCallsHelper=void 0;const a=i(1),n=i(0),o=i(17),s=i(3),r=i(6),l=i(5),c=i(1727),d=i(3577),u=i(354),h=i(330),p=i(216),g=i(28),C=i(46),m="recentCall_",S=r.lazyProperties({noCallsContainer:()=>n.Styles.createViewStyle({paddingLeft:12,paddingRight:12,paddingTop:20,paddingBottom:20})}),y={header:"recentCallsHeader"};class f extends p.SearchSectionHelper{constructor(e){super(),this._useExtendedCallCount=e}static _getKey(e){return m+e}static _getMri(e){return e}buildConfig(e,t,i){return{localPhoneContacts:d.mapLocalContactsByMri(t.searchController.getAddressBookResults()),conversationIds:t.searchController.getRecentCallsResults(),isSyncAddressBookEnabled:i.isSyncAddressBookEnabled,limit:this._useExtendedCallCount?50:20,searchQuery:i.trimmedNormalizedQuery,upcomingCallsCount:u.default.ScheduledCallsStore.getUpcomingScheduledCalls().length}}getItems(e,t){const i=this._useExtendedCallCount?s.SearchResultsListGroup.RecentCallsExtended:s.SearchResultsListGroup.RecentCalls;if(0===this._searchConfig.conversationIds.length&&0===this._searchConfig.upcomingCallsCount&&!t.hideEmptyState)return[{index:0,isLastItem:!0,key:"noCallsItemKey",height:c.default.getDefaultHeight(),measureHeight:!0,template:"noCalls",groupType:i}];const n={itemTemplate:"call",header:l.getString("QuickCallPanel.RecentCallsSectionHeader"),hideHeader:this._useExtendedCallCount};return p.SearchSectionHelper.generateItemsLists({searchResultsListState:e,searchResultsListProps:t,groupType:i,sourceList:a.take(this._searchConfig.conversationIds,this._searchConfig.limit),keys:y,renderConfig:n,getKey:f._getKey,getMri:f._getMri}).defaultList}renderItem(e){return"recentCallsHeader"===e.item.key?p.SearchSectionHelper.renderHeader(l.getString("QuickCallPanel.RecentCallsSectionHeader")):e.item.key.substr(0,m.length)===m?this._renderSearchResultItem(e):"noCallsItemKey"===e.item.key?this._renderNoCallsItem():void 0}_getNoCallsTitle(){return l.getString("RecentCallsHelper.NoRecentCallsTitleDesktop")}_renderNoCallsItem(){let e;return e=l.getString("RecentCallsHelper.NoRecentCallsDescriptionDesktop"),n.createElement(n.View,{style:S.noCallsContainer,key:"noCallsItem"},n.createElement(c.default,{infoLabel:e,title:this._getNoCallsTitle()}))}_renderSearchResultItem(e){const t=e.item.key.substr(m.length),i=p.SearchSectionHelper.getSearchBaseItemProps(e,t);let r={key:"recentCallItem",mri:C.default.getConversationOwner(t),origin:e.origin,pstnMri:o.isPhoneMri(t)?t:void 0,showLastCallInfo:!0,onItemPress:e.item.onListItemClick||a.noop};if(o.isPhoneMri(t)){const e=this._searchConfig.localPhoneContacts[t];e&&(r.addressBookContactOverride=e,r.isAddressBookContact=!0)}const l={textToHighlight:this._searchConfig.searchQuery,highlightType:g.TextToHighlightType.DisplayName};return n.createElement(h.default,Object.assign({},i,r,{textToHighlightInfo:l,groupType:this._useExtendedCallCount?s.SearchResultsListGroup.RecentCallsExtended:s.SearchResultsListGroup.RecentCalls}))}}t.RecentCallsHelper=f},3577:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mapLocalContactsByMri=void 0;const a=i(1),n=i(17),o=i(102);t.mapLocalContactsByMri=function(e){const t={},i=a.compact(a.map(e,e=>e.addressBookContact));return a.each(i,e=>{e&&a.each(e.phones,i=>{if(o.default.isValidNumberString(i.number)){const a=n.getMriFromPhoneNumber(i);t[a]=e}})}),t}},3584:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(6),o=i(135),s=i(52),r=i(24),l=i(16),c=i(12),d=n.lazyProperties({countryListItemCode:()=>a.Styles.createTextStyle({flex:0,marginHorizontal:20,textAlign:"right"}),countryListItemName:()=>a.Styles.createTextStyle({flex:1,flexDirection:"row",marginHorizontal:20}),countryListItem:()=>a.Styles.createViewStyle({alignItems:"center",borderBottomWidth:1,flexDirection:"row",height:60,justifyContent:"space-between"})});class u extends c.default{constructor(){super(...arguments),this._onPress=()=>{this.props.onSelect(this.props.country)}}render(){let e;const t=r.default.rowTitleFontStyle(this._currentTheme),i=[t,s.default.getTextColorStyleNoSubscription()],n=[t,this._themeStyles.secondaryTextColorStyle,d.countryListItemCode];if(this.props.filter){const n=this.props.country.countryName.toLowerCase().indexOf(this.props.filter.toLowerCase()),o=this.props.country.countryName.substr(0,n),s=this.props.country.countryName.substr(n,this.props.filter.length),r=this.props.country.countryName.substr(o.length+s.length);e=a.createElement(a.Text,{style:d.countryListItemName,numberOfLines:1},a.createElement(a.Text,{style:t},o),a.createElement(a.Text,{style:i},s),a.createElement(a.Text,{style:t},r))}else e=a.createElement(a.Text,{style:d.countryListItemName,numberOfLines:1},a.createElement(l.RowTitle,null,this.props.country.countryName));return a.createElement(o.default.Button,{style:[d.countryListItem,this._themeStyles.dividerBorderColorStyle],onPress:this._onPress,underlayColor:this._themeColors.rowHighlightColor,accessibilityLabel:`${this.props.country.countryName} +${this.props.country.countryCode}`,accessibilityTraits:a.Types.AccessibilityTrait.Button,importantForAccessibility:a.Types.ImportantForAccessibility.Yes},e,a.createElement(a.Text,{style:n},"+",this.props.country.countryCode))}}t.default=u},3585:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallingSettingsStore=t.CallingSettingsFeature=void 0;const a=i(25),n=i(15),o=i(7),s=i(3),r=i(4),l=i(439),c=i(19);t.CallingSettingsFeature=class{};let d=class extends n.StoreBase{fetch(e=!1){if(this._callingSettings=o.default.getS4LCommerceFeatures().callingSettingsPanel,e)return;const t=this.callForwardingFeature();t&&t.clientEnabled&&this._fetchCallForwarding()}callForwardingFeature(){if(!this._callingSettings)return;const e=this._callingSettings.callForwarding;return{clientEnabled:e.enabled,link:e.link,goTarget:e.goTarget,fetched:void 0!==this._callForwardingEnabled,active:this._callForwardingEnabled}}_fetchCallForwarding(){l.default.getIsCallForwardingEnabledOption().then(e=>this._setCallForwardingEnabled(e)).catch(e=>{r.warn(s.LogTraceArea.Calling,"CallingSettingsStore: "+c.default.errorAsString(e)),this._setCallForwardingEnabled(void 0)})}_setCallForwardingEnabled(e){this._callForwardingEnabled!==e&&(this._callForwardingEnabled=e,this.trigger())}};a.__decorate([n.autoSubscribe],d.prototype,"callForwardingFeature",null),d=a.__decorate([n.AutoSubscribeStore],d),t.CallingSettingsStore=d,t.default=new d},3637:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(29),o=i(87),s=i(60),r=i(302),l=i(43),c=i(13),d=i(45),u=i(3),h=i(4),p=i(6),g=i(5),C=i(147),m=i(697),S=i(18),y=i(27),f=i(878),_=i(48),b=i(42),v=i(9),w=i(24),T=i(11),I=i(14),P=i(369),M=i(16),k=i(10),A=p.lazyProperties({commonTextStyle:()=>a.Styles.createTextStyle({textAlign:"center"}),headerStyle:()=>a.Styles.createTextStyle({color:v.Color.white,marginTop:20,marginBottom:10}),textStyleLightTheme:()=>a.Styles.createTextStyle({color:v.Color.gray300}),subTextStyle:()=>a.Styles.createTextStyle({paddingTop:5,color:v.Color.whiteOverlay70,maxWidth:360,marginBottom:20}),containerStyle:()=>a.Styles.createViewStyle({justifyContent:"flex-end",alignItems:"center",paddingBottom:180,backgroundColor:v.Color.blackOverlay20,paddingHorizontal:10}),containerStyleDesktopCallStage:()=>a.Styles.createViewStyle({paddingBottom:110,backgroundColor:v.Color.transparent}),containerStyleOnMobile:()=>a.Styles.createViewStyle({paddingBottom:80}),containerStyleOnMobileForPortraitMode:()=>a.Styles.createViewStyle({paddingBottom:100}),hyperLinkText:()=>a.Styles.createTextStyle({color:v.Color.blue}),hyperLinkStyle:()=>a.Styles.createTextStyle({marginTop:-15}),subTextContainer:()=>a.Styles.createTextStyle({alignItems:"center",justifyContent:"center",marginTop:-5})});class R extends d.default{constructor(){super(...arguments),this._onInviteButtonRef=e=>{this._shareInviteButtonRef=e||void 0},this._getShareInviteButtonRef=()=>this._shareInviteButtonRef,this._onShareInvitePress=e=>{this.state.joinLink?m.default.show({anchor:this._getShareInviteButtonRef,event:e,rootViewId:this._getRootViewId(),positionPriorities:["bottom","top"],threadId:this.props.conversationMri,joinLink:this.state.joinLink,meetNowParameters:{origin:C.MeetNowOrigin.MessageStream},allowJoiningLink:!0}):h.log(u.LogTraceArea.JoinLink,`AloneInTheCallInformationView._onShareInvitePress cannot show the menu because join link is not defined joinLink: ${this.state.joinLink}, threadId: ${this.props.conversationMri}`)},this._onHyperLinkPress=e=>{const t=k.default.newCauseId();h.log(u.LogTraceArea.CallingUI,"GoLiveInformationView._onHyperLinkPress, causeId: "+t),S.default.openCallRoster(this.props.conversationMri,this.props.callId,this._getContext()),P.default.createSession(this.props.callId,s.CallRosterOrigin.GoLiveInformationView,!1),o.default.updateCallTelemetry(this.props.callId,t,e=>e.callRosterOpenedCount())},this._onRingTheGroupButtonPress=()=>{f.default.handleRingTheGroup(this.props.conversationMri,this.props.callId);const e=g.getString("CallPanel.GroupCallRingingStatusMessage");a.Accessibility.announceForAccessibility(e),o.default.trackRingTheGroup(this.props.callId)},this._getHeaderText=()=>{switch(this.state.ringlessCallType){case f.LocallyStartedRinglessCallType.OnePerson:case f.LocallyStartedRinglessCallType.SmallGroup:return g.getString("CallPanel.GroupCallWithOnlyCallInitiatorMessage");case f.LocallyStartedRinglessCallType.LargeGroup:return g.getString("CallPanel.RinglessCallHeader");default:return}},this._getText=()=>{switch(this.state.ringlessCallType){case f.LocallyStartedRinglessCallType.OnePerson:return;case f.LocallyStartedRinglessCallType.SmallGroup:return this.state.hasRingingParticipants?g.getString("CallPanel.GroupCallRingingStatusMessage"):g.getString("CallPanel.GroupCallNotifiedTheGroupMessage");case f.LocallyStartedRinglessCallType.LargeGroup:return g.getString("CallPanel.RinglessCallDescription");default:return}}}_buildState(e,t){const i=n.default.CallingStore.hasRingingParticipants(e.callId,!0),a=f.default.getRinglessCallType(e.conversationMri,e.callId);return{isConvIconCentered:y.default.getHeight(this._getRootViewId())>700,hasRingingParticipants:i,ringlessCallType:a,joinLink:a===f.LocallyStartedRinglessCallType.OnePerson?r.default.getLink(e.conversationMri):void 0}}componentDidMount(){super.componentDidMount(),this._announceForAccessibility()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),!this.state.hasRingingParticipants&&t.hasRingingParticipants&&this._announceForAccessibility()}render(){const e=this._getHeaderText(),t=a.createElement(a.Text,{style:this._getHeaderStyles()},e),i=this._renderSubText(),n=this._renderRingTheGroupButton(),o=this.state.ringlessCallType===f.LocallyStartedRinglessCallType.OnePerson?this._renderInviteButton():void 0;return a.createElement(a.View,{style:this._getContainerStyles(),ignorePointerEvents:!0},t,i,n,o)}_announceForAccessibility(){let e;e=this._isRingTheGroupAvailable()||this.state.ringlessCallType===f.LocallyStartedRinglessCallType.LargeGroup?this._getAdditionalScreenReaderText():this._getText();const t=l.default.combinedAccessibilityLabel(this._getHeaderText(),e);_.default.maybeAnnounceForAccessibility(t,100)}_renderInviteButton(){return a.createElement(b.default,{key:"invite",ref:this._onInviteButtonRef,buttonStyle:c.SXButtonStyle.BlueFill,title:g.getString("MeetNow.ShareInvite"),onPress:this._onShareInvitePress,buttonSize:c.SXButtonSize.Medium,iconSize:T.IconSize.size14,iconPositon:c.SXButtonIconPosition.End,disabled:!this.state.joinLink})}_renderRingTheGroupButton(){if(this._isRingTheGroupAvailable())return a.createElement(b.default,{buttonStyle:c.SXButtonStyle.BlueFill,buttonSize:c.SXButtonSize.Medium,title:g.getString("CallPanel.GroupCallRingTheGroupButtonTitle"),allowTextWrap:!0,onPress:this._onRingTheGroupButtonPress})}_renderSubText(){const e=this._getText();if(!e)return;if(this.state.ringlessCallType===f.LocallyStartedRinglessCallType.SmallGroup&&!this.state.hasRingingParticipants)return;const t=[A.subTextStyle,A.commonTextStyle,this.state.isConvIconCentered?w.default.fontStyle.messagingHeaderSmall:w.default.fontStyle.panelHeader,this.props.useLightTheme?A.textStyleLightTheme:void 0];return a.createElement(a.View,{style:A.subTextContainer},a.createElement(a.Text,{style:t},e),this._renderHyperLink())}_renderHyperLink(){if(this.state.ringlessCallType!==f.LocallyStartedRinglessCallType.LargeGroup)return;const e=[A.subTextStyle,A.commonTextStyle,A.hyperLinkText,this.state.isConvIconCentered?w.default.fontStyle.messagingHeaderSmall:w.default.fontStyle.panelHeader],t=g.getString("CallPanel.RinglessCallHyperLink");return a.createElement(a.Button,{onPress:this._onHyperLinkPress,style:A.hyperLinkStyle,accessibilityLabel:t},a.createElement(M.BodyText,{style:e},t))}_getAdditionalScreenReaderText(){return this.state.ringlessCallType===f.LocallyStartedRinglessCallType.LargeGroup?g.getString("CallPanel.RinglessCallHyperLinkScreenReaderText"):g.getString("CallPanel.GroupCallRingTheGroupButtonDescriptiveScreenReaderText")}_isRingTheGroupAvailable(){return!this.state.hasRingingParticipants&&this.state.ringlessCallType===f.LocallyStartedRinglessCallType.SmallGroup}_getContainerStyles(){const e=[A.containerStyle,I.default.absoluteFill];return this.state.isConvIconCentered||this.props.callControlsType===s.CallControlsType.DesktopMinSmallest?this.props.useDesktopCallControls&&e.push(A.containerStyleDesktopCallStage):this.props.isLandscape?e.push(A.containerStyleOnMobile):e.push(A.containerStyleOnMobileForPortraitMode),e}_getHeaderStyles(){const e=[A.headerStyle,A.commonTextStyle];return this.props.useLightTheme&&e.push(A.textStyleLightTheme),this.state.isConvIconCentered?e.push(w.default.fontStyle.messagingHeader):e.push(w.default.fontStyle.messagingHeaderSmall),e}}t.default=R},3638:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});i(177);const a=i(91),n=i(0),o=i(15),s=i(741),r=i(29),l=i(53),c=i(26),d=i(1765),u=i(6),h=i(23),p=i(59),g=i(48),C=i(9),m=i(20),S=i(11),y=i(16),f=u.lazyProperties({warningContainer:()=>n.Styles.createViewStyle({position:"absolute",bottom:0,left:0,right:0,height:30}),innerContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",paddingVertical:5,marginHorizontal:50}),statusText:()=>n.Styles.createTextStyle({color:C.Color.white,backgroundColor:C.Color.transparent}),iconPadding:()=>n.Styles.createViewStyle({paddingRight:10}),iconPaddingRTL:()=>n.Styles.createViewStyle({paddingLeft:10}),background:()=>n.Styles.createViewStyle({backgroundColor:C.Color.blackOverlay20}),desktopCallControlsStyle:()=>n.Styles.createViewStyle({bottom:70})});class _ extends o.ComponentBase{constructor(){super(...arguments),this._onAnimatedWaringRef=e=>{this._animatedView=e||void 0}}_buildState(e,t){const i=h.default.isUsingStackNavigationContext(),a=l.CallingCapabilities.speakerVolumeControlSupported();return{areControlsVisible:s.default.areCallControlsVisible(),isNotificationHidden:e.hideNotification||i&&s.default.isOverflowMenuVisible(),showMicrophoneMuted:e.isMicrophoneMutedWhileSpeaking||r.default.CallingStore.isMicrophoneMuted(e.callId),callAudioOutputRoute:r.default.CallControlsStore.getAudioOutput(),speakerVolumeControlSupported:a,isSpeakerMuted:!!a&&(r.default.CallingStore.isSpeakerMuted(e.callId)||0===r.default.DeviceStore.getSpeakerVolume())}}componentDidMount(){super.componentDidMount(),this._getWarningViewinfo(),this.state.viewInformation&&g.default.maybeAnnounceForAccessibility(this.state.viewInformation.warningText)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this._getWarningViewinfo(),this.state.isNotificationHidden!==t.isNotificationHidden&&this._showOrHideWarningView(!this.state.isNotificationHidden,!1),!this.state.viewInformation||t.viewInformation&&t.viewInformation.warningText===this.state.viewInformation.warningText||g.default.maybeAnnounceForAccessibility(this.state.viewInformation.warningText)}_showOrHideWarningView(e,t=!0,i=0){this.isComponentMounted()&&this._animatedView&&(this._animatedView.stop(),t?e?this._animatedView.fadeIn(void 0,void 0,{delay:i}):this._animatedView.fadeOut(void 0,void 0,{delay:i}):this._animatedView.setValue({opacity:e?1:0}))}render(){if(!this.state.viewInformation)return null;const e=[f.warningContainer];let t,i;return this.state.viewInformation&&!this.state.areControlsVisible&&e.push(f.background),this.props.bottomPadding&&(e.push(p.default.paddingBottomStyle(this.props.bottomPadding)),e.push(p.default.heightStyle(30+this.props.bottomPadding))),this.state.viewInformation&&(i=this.state.viewInformation.warningText?this._getWarningText(this.state.viewInformation.warningText):void 0,t=this.state.viewInformation.icon?this._getWarningIcon(this.state.viewInformation.icon):void 0),this.props.useDesktopCallControls&&e.push(f.desktopCallControlsStyle),n.createElement(n.View,{style:e,blockPointerEvents:!0,ignorePointerEvents:!0},n.createElement(a.View,{ref:this._onAnimatedWaringRef,style:f.innerContainer},t,i))}_getWarningViewinfo(){let e;(this.state.speakerVolumeControlSupported||this.state.showMicrophoneMuted)&&(e=d.default.getViewInformationForAudioMuted(this.state.showMicrophoneMuted,this.state.isSpeakerMuted)),this.setState({viewInformation:e})}_getWarningText(e){return n.createElement(y.BodyText,{style:f.statusText},e)}_getWarningIcon(e){let t=C.Color.white;return this.state.viewInformation&&this.state.viewInformation.optionalIconColor&&(t=this.state.viewInformation.optionalIconColor),n.createElement(c.default,{icon:e,size:S.IconSize.size15,color:t,style:m.default.isRTL()?f.iconPaddingRTL:f.iconPadding})}}t.default=_},3639:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AudioRouteSelectionPresenter=t.AudioOutputRouteStrings=void 0;const a=i(1),n=i(177),o=i(29),s=i(87),r=i(3),l=i(4),c=i(5),d=i(72);var u;!function(e){e.CallButtonEarpiece="CallControls.CallButtonEarpiece",e.CallButtonSpeaker="CallControls.CallButtonSpeaker",e.CallButtonBluetooth="CallControls.CallButtonBluetooth",e.CallButtonHeadset="CallControls.CallButtonHeadset"}(u=t.AudioOutputRouteStrings||(t.AudioOutputRouteStrings={}));const h={[n.default.AudioOutputEarpiece]:u.CallButtonEarpiece,[n.default.AudioOutputSpeaker]:u.CallButtonSpeaker,[n.default.AudioOutputBluetooth]:u.CallButtonBluetooth,[n.default.AudioOutputWiredHeadset]:u.CallButtonHeadset},p={[n.default.AudioOutputEarpiece]:"Earpiece",[n.default.AudioOutputSpeaker]:"Speaker",[n.default.AudioOutputBluetooth]:"Bluetooth",[n.default.AudioOutputWiredHeadset]:"WiredHeadset",[n.default.AudioOutputOther]:"Other"};t.AudioRouteSelectionPresenter=class{constructor(e){this._causeId=e,this._providingVideo=!1,this._onMenuCancelled=()=>{const e=o.default.CallControlsStore.getAudioOutput(),t=p[e];s.default.trackAudioOutputRouteChange(t,t)},this._onMenuItemSelected=e=>{switch(l.log(r.LogTraceArea.CallingUI,`AudioRouteSelectionPresenter,_onMenuItemSelected command: ${e} causeId: ${this._causeId}`),e){case u.CallButtonEarpiece:this._requestAudioOutputRoute(n.default.AudioOutputEarpiece);break;case u.CallButtonSpeaker:this._requestAudioOutputRoute(n.default.AudioOutputSpeaker);break;case u.CallButtonBluetooth:this._requestAudioOutputRoute(n.default.AudioOutputBluetooth);break;case u.CallButtonHeadset:this._requestAudioOutputRoute(n.default.AudioOutputWiredHeadset)}this._resumeCallControlTimer&&this._resumeCallControlTimer()}}setUserProvidingVideo(e){this._providingVideo=e}setControlTimerHandlers(e,t){this._suspendCallControlTimer=e,this._resumeCallControlTimer=t}show(e,t,i){const s=o.default.CallControlsStore.getAudioOutput();n.default.requestAvailableOutputRoutesArray(s).then(o=>{this._providingVideo&&(o=a.filter(o,e=>e!==n.default.AudioOutputEarpiece)),o.length>2?this._showMenu(e,t,i,o):2===o.length?this._toggleRoutes(o,s):l.log(r.LogTraceArea.CallingUI,`AudioRouteSelectionPresenter.show() only single route option available current: ${s} available: ${o} causeId: ${this._causeId}`)})}_toggleRoutes(e,t){e[0]===t?this._requestAudioOutputRoute(e[1]):this._requestAudioOutputRoute(e[0]),this._resumeCallControlTimer&&this._resumeCallControlTimer()}_showMenu(e,t,i,n){const o=[];a.each(n,e=>{e?o.push({text:c.getString(h[e]),command:h[e]}):l.warn(r.LogTraceArea.CallingUI,"AudioRouteSelectionPresenter._showMenu invalid route in outputRoutes")}),this._suspendCallControlTimer&&this._suspendCallControlTimer(),d.default.showWithActionMenuConfig({options:{anchor:i,buttons:o,title:c.getString("CallPanel.SelectAudioRouteTitle")},callback:this._onMenuItemSelected,maintainAnchor:!0,rootViewId:e,onCancel:this._onMenuCancelled,invokingEvent:t})}_requestAudioOutputRoute(e){const t=o.default.CallControlsStore.getAudioOutput();s.default.trackAudioOutputRouteChange(p[t],p[e]),n.default.requestOutput(e)}}},3640:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(7),s=i(741),r=i(29),l=i(87),c=i(60),d=i(110),u=i(695),h=i(13),p=i(45),g=i(3641),C=i(3642),m=i(378),S=i(254),y=i(3),f=i(4),_=i(30),b=i(27),v=(i(48),i(1595)),w=i(9),T=i(10),I=i(189),P=w.Color.whiteOverlay30,M=b.default.isSmallDeviceNoSubscription(h.MainRootViewId)?3:4;class k extends p.default{constructor(){super(...arguments),this._recentActions=[]}static menuHeight(e){const t=this._stateForProps(e);let i=0;if(t.toggleItems&&(i+=50*t.toggleItems.length),t.rowButtonsItems&&(i+=50*t.rowButtonsItems.length),i>0){const e={marginTop:8,marginBottom:8};i+=g.default.rowHeight(e)}const a=t.buttonItems;return a&&(a.length>2?i+=C.default.rowHeight(a.length,M):i+=50*a.length),i}static _stateForProps(e){const t=u.default.getCelebrationData(e.conversationMri,e.callId),i=r.default.DeviceStore.isBackgroundBlurEnabled(),a={celebrationData:t,isIncomingVideoDisabled:r.default.CallingStore.isIncomingVideoDisabled(e.callId),isAudioOnlyEnabled:r.default.CallingStore.isAudioOnly(e.callId),isTranslating:r.default.InCallBotService.isTranslating(e.callId),isRecording:r.default.CallingStore.isRecording(e.callId),isAudienceMode:r.default.CallingStore.isFullscreenBotInCall(e.callId),isScreenShareActive:r.default.CallingStore.isScreenSharing(e.callId),isVideoActive:r.default.CallingStore.isProvidingVideo(e.callId),isBackroundBlurEnabled:i,isBackgroundBlurSelected:r.default.DeviceStore.isBackgroundBlurred(),isBackgroundBlurNewItem:i&&o.default.getS4LCMCFeatures().enableBackgroundBlurNewLabel&&!1},n=Object.assign(Object.assign({},e),a);return a.toggleItems=d.default.overflowMenuToggleDescriptors(n),a.rowButtonsItems=d.default.overflowMenuRowButtonsDescriptors(n),a.buttonItems=d.default.overflowMenuButtonDescriptors(n,e.callerContext()),a}_buildState(e,t){return k._stateForProps(e)}componentDidMount(){super.componentDidMount();const e=T.default.newCauseId();f.log(y.LogTraceArea.CallingUI,"CallControlsCustomActionMenu.componentDidMount Menu open causeId: "+e),s.default.setOverflowMenuVisiblity(!0,e)}componentWillUnmount(){super.componentWillUnmount();const e=T.default.newCauseId();f.log(y.LogTraceArea.CallingUI,"CallControlsCustomActionMenu.componentWillUnMount Menu close causeId: "+e),s.default.setOverflowMenuVisiblity(!1,e),l.default.trackOverflowMenuActions(this._recentActions),this.state.isBackroundBlurEnabled&&this.state.isBackgroundBlurNewItem&&_.default.setUserPreferencesLocal(Object.assign({},{}))}_executeDescriptorAndClose(e,t){this._executeDescriptor(e,t),f.log(y.LogTraceArea.CallingUI,"CallControlsCustomActionMenu.ClosingMenu causeId: "+t),S.default.close(this._getRootViewId(),t)}_executeDescriptor(e,t){const i=c.CallControlsOverflowItem[e.key];f.log(y.LogTraceArea.CallingUI,`CallControlsCustomActionMenu ${i} causeId: ${t}`),this._recentActions.push(i),e.onPress()}_createOnRowButtonPress(e){return()=>{const t=T.default.newCauseId();f.log(y.LogTraceArea.CallingUI,"CallControlsCustomActionMenu.Button.onRowPress causeId: "+t),S.default.close(this._getRootViewId(),t),this._executeDescriptor(e,t)}}render(){const e=[];if(a.each(this.state.toggleItems,t=>{const i={key:t.key,disabled:!!t.disabled,rowType:m.CustomActionMenuRowType.Toggle,isSelected:t.selected,accessibilityLabel:t.accessibilityLabel||t.title,titleText:t.title,onRowPress:()=>{const e=T.default.newCauseId();f.log(y.LogTraceArea.CallingUI,"CallControlsCustomActionMenu.Toggle.onRowPress causeId: "+e),this._executeDescriptor(t,e)},rowHeight:50,hideBorder:!0,icon:a.isArray(t.icon)?t.icon[0].icon:t.icon.icon,toggleOverlayColorAndroid:w.Color.black,isNew:!!t.isNew};e.push({props:i,builder:m.default.buildRow})}),a.each(this.state.rowButtonsItems,t=>{const i={key:t.key,rowType:m.CustomActionMenuRowType.Default,accessibilityLabel:t.accessibilityLabel||t.title,titleText:t.title,onRowPress:this._createOnRowButtonPress(t),rowHeight:50,hideBorder:!0,icon:a.isArray(t.icon)?t.icon[0].icon:t.icon.icon};e.push({props:i,builder:m.default.buildRow})}),e.length){const t={marginTop:8,marginBottom:8},i=Object.assign(Object.assign({},t),{key:"divider",rowHeight:g.default.rowHeight(t),color:P});e.push({props:i,builder:g.default.buildRow})}const t=this.state.buttonItems;if(t.length-a.filter(t,e=>!!e.doesNotInfluenceMenuLayout).length>2){const i={key:"grid",buttonDescriptors:a.map(t,e=>Object.assign(Object.assign({},e),{onPress:()=>{const t=T.default.newCauseId();f.log(y.LogTraceArea.CallingUI,"CallControlsCustomActionMenu.Button.onPress causeId: "+t),this._executeDescriptorAndClose(e,t)}})),rowHeight:C.default.rowHeight(t.length),columnCount:M,estimatedWidth:I.default.measureWindow(this._getRootViewId()).width};e.push({props:i,builder:C.default.buildRow})}else a.each(t,t=>{const i={key:t.key,accessibilityLabel:t.accessibilityLabel||t.title,titleText:t.title,onRowPress:()=>{const e=T.default.newCauseId();f.log(y.LogTraceArea.CallingUI,"CallControlsCustomActionMenu.Button.onRowPress causeId: "+e),this._executeDescriptorAndClose(t,e)},rowHeight:50,hideBorder:!0,icon:a.isArray(t.icon)?t.icon[0].icon:t.icon.icon};e.push({props:i,builder:m.default.buildRow})});return n.createElement(v.default,{rowBuilders:e,colorThemeOverride:this.props.colorThemeOverride})}}t.default=k},3643:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(302),o=i(9),s=i(898),r=i(126),l=i(1232),c=i(21),d=i(6),u=i(5),h=i(11),p=i(26),g=i(3),C=i(517),m=i(125),S=i(4),y=i(46),f=i(191),_=i(328),b=i(31),v=i(1717),w=i(12),T=i(158),I=d.lazyProperties({container:()=>a.Styles.createViewStyle({position:"absolute",top:40,left:0,margin:6,padding:24,borderRadius:16,maxWidth:398,minHeight:180}),headerView:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start",overflow:"visible"}),joinLinkButton:()=>a.Styles.createViewStyle({marginBottom:16}),inviteButton:()=>a.Styles.createButtonStyle({alignSelf:"center",alignContent:"center",alignItems:"center",flexDirection:"row"}),inviteButtonText:()=>a.Styles.createTextStyle({color:o.Color.blue,fontSize:16,lineHeight:24}),nameInput:()=>a.Styles.createViewStyle({marginTop:10}),primaryLabel:()=>a.Styles.createTextStyle({flexGrow:1,marginBottom:16,fontSize:15,lineHeight:22,fontWeight:"600"}),primaryLabelGuestFlow:()=>a.Styles.createTextStyle({flexGrow:1,marginBottom:16,fontSize:16,lineHeight:22}),secondaryLabel:()=>a.Styles.createTextStyle({marginBottom:16,fontSize:16,lineHeight:21}),closeButton:()=>a.Styles.createTextStyle({marginTop:-8,marginRight:-6})});class P extends w.default{constructor(){super(...arguments),this._autoCloseTimeoutMs=5e3,this._isAutoCloseBlocked=!1,this._getContainerBackgroundStyles=()=>{const e=this._useDarkTheme()?o.Color.gray400overlay95:o.Color.gray50overlay95;let t;if(!this.props.isProvidingVideo){const e={backgroundColor:o.Color.whiteOverlay50,shadowColor:o.Color.blackOverlay10,shadowOffset:{width:0,height:2},shadowOpacity:.1,shadowRadius:6},i={backgroundColor:this._themeColors.secondaryBackgroundColor};t=this._useDarkTheme()?i:e}return[I.container,a.Styles.createViewStyle(Object.assign({backgroundColor:e},t))]},this._onClose=()=>(!this.state.isGuestFlow||!this.state.isUserNameRequiredErrorVisible)&&(this._trackCloseEvent(f.MeetNowSharePopupCloseActionType.Manual),this.props.onClose(),!0),this._onUserNameChange=e=>{const t=e.trim();this.setState({isUserNameRequiredErrorVisible:!t.length,guestUserName:t})},this._onInviteSkypeContactsClick=()=>{this._isAutoCloseBlocked=!0},this._inviteByEmail=()=>{if(S.log(g.LogTraceArea.JoinLink,"CallCreatorShareOverlayPopup._inviteByEmail "+r.MeetNowShareInviteCommands.DefaultMail),!this.state.joinLink)return S.log(g.LogTraceArea.JoinLink,"CallCreatorShareOverlayPopup._inviteByEmail abort, no joinLink");C.default.clickShare(r.MeetNowShareInviteCommands.DefaultMail,{joinLink:this.state.joinLink,threadId:this._threadId,rootViewId:this._getRootViewId(),meetNowParameters:Object.assign(Object.assign({},this.props.meetNowParameters),{origin:r.MeetNowOrigin.CreatorPanelPopup})})},this._enableAutoCloseFlow=()=>{const e=_.default.getActiveParticipants(this.props.callId,this.props.conversationMri).length>1,t=!(this._autoCloseTimer||this._isAutoCloseBlocked);e&&t&&this._startAutoCloseTimer(),this._autoCloseTimer&&this._isAutoCloseBlocked&&b.default.clearTimeout(this._autoCloseTimer)},this._startAutoCloseTimer=()=>{this._autoCloseTimer=b.default.setTimeout(()=>{this.isComponentMounted()&&(this._trackCloseEvent(f.MeetNowSharePopupCloseActionType.Auto),this.props.onClose())},this._autoCloseTimeoutMs)},this._trackCloseEvent=e=>{const t=this._createdAt-(new Date).getTime();S.track(new f.MeetNowSharePopupCloseEvent(this.props.meetNowParameters,e,this.state.isGuestFlow,t))}}_buildState(e,t){const i=c.default.getSkypeMri(),a=y.default.getDisplayableUserByMri(i),o=T.MeetNowHelpers.isGuestFlow();return this._threadId=this.props.conversationMri,this._defaultGuestUserName=a.displayName,t&&(this._createdAt=(new Date).getTime()),o||this._enableAutoCloseFlow(),{isGuestFlow:o,showLinkCopied:!t&&this.state.showLinkCopied,guestUserName:t?this._defaultGuestUserName:this.state.guestUserName,joinLink:n.default.getLink(this._threadId),isUserNameRequiredErrorVisible:!1}}componentDidMount(){super.componentDidMount(),m.default.addEscapeHandler(this._onClose)}componentWillUnmount(){super.componentWillUnmount(),m.default.removeEscapeHandler(this._onClose)}render(){return this.state.isGuestFlow?this._renderGuestPopup():this._renderPopup()}_renderCloseButton(){const e=[I.closeButton];return this._getContext().isRTL&&e.push(a.Styles.createTextStyle({marginRight:0,marginLeft:-6})),a.createElement(a.Button,{accessibilityLabel:u.getString("CallCreatorShareOverlayPopup.CloseButtonAccessibilityLabel"),style:e,onPress:this._onClose},a.createElement(p.default,{key:"dismissButton",color:this._themeColors.primaryIconColor,size:h.IconSize.size24,icon:h.SkypeIcon.Cancel}))}_renderShareInviteEmail(){const e=a.Styles.createTextStyle({textDecorationLine:"underline",alignSelf:"center",color:o.Color.blue});return a.createElement(a.Button,{accessibilityLabel:u.getString("CallCreatorShareOverlayPopup.ShareByEmailLabelAccessibilityLabel"),style:e,onPress:this._inviteByEmail},a.createElement(a.Text,{style:I.inviteButtonText},u.getString("CallCreatorShareOverlayPopup.ShareByEmailLabel")))}_renderMeetNowJoinLinkButton(){return a.createElement(s.default,{threadId:this._threadId,joinLink:this.state.joinLink,partnerParameters:this.props.meetNowParameters,useVerboseView:!0,style:[I.joinLinkButton]})}_renderGuestPopup(){return a.createElement(a.View,{style:this._getContainerBackgroundStyles()},a.createElement(a.View,{style:I.headerView},a.createElement(a.Text,{style:[I.primaryLabelGuestFlow,{color:this._themeColors.primaryTextColor}]},u.getString("CallCreatorShareOverlayPopup.PrimaryLabelGuestFlow")),this._renderCloseButton()),a.createElement(l.default,{threadId:this._threadId,isErrorVisible:this.state.isUserNameRequiredErrorVisible,meetNowParameters:this.props.meetNowParameters,onChangeValue:this._onUserNameChange}),a.createElement(a.Text,{style:[I.secondaryLabel,{color:this._themeColors.primaryTextColor}]},u.getString("CallCreatorShareOverlayPopup.SecondaryLabel")),this._renderMeetNowJoinLinkButton(),this._renderShareInviteEmail())}_renderPopup(){return a.createElement(a.View,{style:this._getContainerBackgroundStyles()},a.createElement(a.View,{style:I.headerView},a.createElement(a.Text,{style:[I.primaryLabel,{color:this._themeColors.secondaryTextColor}]},u.getString("CallCreatorShareOverlayPopup.PrimaryLabel")),this._renderCloseButton()),a.createElement(a.Text,{style:[I.secondaryLabel,{color:this._themeColors.primaryTextColor}]},u.getString("CallCreatorShareOverlayPopup.SecondaryLabel")),this._renderMeetNowJoinLinkButton(),this.state.joinLink&&a.createElement(v.default,{joinLink:this.state.joinLink,conversationMri:this.props.conversationMri,meetNowParameters:Object.assign(Object.assign({},this.props.meetNowParameters),{origin:r.MeetNowOrigin.CreatorPanelPopup}),logSource:"CallCreatorShareOverlayPopup",onClick:this._onInviteSkypeContactsClick}))}}t.default=P},3644:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(116),n=i(0),o=i(15),s=i(17),r=i(286),l=i(6),c=i(52),d=i(190),u=i(9),h=i(101),p=i(65),g=l.lazyProperties({outerContainer:()=>n.Styles.createViewStyle({position:"absolute",top:0,right:0,bottom:0,left:0,flex:1,paddingHorizontal:50,alignItems:"center",justifyContent:"center",backgroundColor:u.Color.gray400,overflow:"visible"}),lightThemeBackgroundColor:()=>n.Styles.createViewStyle({backgroundColor:u.Color.gray50}),innerContainer:()=>n.Styles.createViewStyle({overflow:"visible",width:160,height:160}),backgroundRingColored:()=>n.Styles.createViewStyle({position:"absolute",top:32,left:32,width:96,height:96,borderRadius:48,backgroundColor:u.Color.gray400,opacity:1}),gradientRing:()=>n.Styles.createViewStyle({position:"absolute",width:100,height:100,borderRadius:50,opacity:1}),backgroundRingMask:()=>n.Styles.createViewStyle({position:"absolute",top:30,left:30,width:100,height:100,borderRadius:50,backgroundColor:u.Color.black,opacity:1}),mainCircle:()=>n.Styles.createViewStyle({position:"absolute",top:0,left:0,width:160,height:160,borderRadius:80,backgroundColor:u.Color.transparent})});class C extends o.ComponentBase{constructor(e){super(e),this._beginningAnimationDuration=1300,this._loopDuration=1830,this._animationShouldLoop=!1,this._backgroundRingColoredScaleAnimatedValue=new n.Animated.Value(3),this._backgroundRingColoredScaleAnimatedStyle=n.Styles.createAnimatedViewStyle({transform:[{scale:this._backgroundRingColoredScaleAnimatedValue}]}),this._backgroundRingMaskScaleAnimatedValue=new n.Animated.Value(3),this._backgroundRingMaskScaleAnimatedStyle=n.Styles.createAnimatedViewStyle({transform:[{scale:this._backgroundRingMaskScaleAnimatedValue}]}),this._mainCircleScaleAnimatedValue=new n.Animated.Value(1.5),this._mainCircleScaleAnimatedStyle=n.Styles.createAnimatedViewStyle({transform:[{scale:this._mainCircleScaleAnimatedValue}]}),this._innerContainerOpacityValue=new n.Animated.Value(0),this._innerContainerOpacityStyle=n.Styles.createAnimatedViewStyle({opacity:this._innerContainerOpacityValue})}_startAnimation(){this._animationBeginning=n.Animated.parallel([d.default.timing(this._backgroundRingColoredScaleAnimatedValue,{toValue:1,easing:n.Animated.Easing.CubicBezier(.33,0,0,1),duration:1.2*this._beginningAnimationDuration,isInteraction:!1,useNativeDriver:!0}),d.default.timing(this._backgroundRingMaskScaleAnimatedValue,{toValue:1,easing:n.Animated.Easing.CubicBezier(.33,0,0,1),duration:1.2*this._beginningAnimationDuration,isInteraction:!1,useNativeDriver:!0}),n.Animated.sequence([d.default.timing(this._mainCircleScaleAnimatedValue,{toValue:1,easing:n.Animated.Easing.CubicBezier(.33,0,0,1),duration:.8*this._beginningAnimationDuration,isInteraction:!1,useNativeDriver:!0}),d.default.timing(this._mainCircleScaleAnimatedValue,{toValue:1.06,easing:n.Animated.Easing.CubicBezier(.33,0,0,1),duration:.2*this._beginningAnimationDuration,isInteraction:!1,useNativeDriver:!0})])]),this._animationLoop=n.Animated.parallel([n.Animated.sequence([d.default.timing(this._backgroundRingColoredScaleAnimatedValue,{toValue:2.3,easing:n.Animated.Easing.CubicBezier(.33,0,0,1),duration:.5*this._loopDuration,isInteraction:!1,useNativeDriver:!0}),d.default.timing(this._backgroundRingColoredScaleAnimatedValue,{toValue:1,easing:n.Animated.Easing.CubicBezier(.9,0,1,1),duration:.22*this._loopDuration,isInteraction:!1,useNativeDriver:!0})]),n.Animated.sequence([d.default.timing(this._backgroundRingMaskScaleAnimatedValue,{toValue:2.3,easing:n.Animated.Easing.CubicBezier(.33,0,0,1),duration:.5*this._loopDuration,isInteraction:!1,useNativeDriver:!0}),d.default.timing(this._backgroundRingMaskScaleAnimatedValue,{toValue:1,easing:n.Animated.Easing.CubicBezier(.9,0,1,1),duration:.22*this._loopDuration,isInteraction:!1,useNativeDriver:!0})]),n.Animated.sequence([d.default.timing(this._mainCircleScaleAnimatedValue,{toValue:.88,easing:n.Animated.Easing.CubicBezier(.33,0,0,1),duration:.56*this._loopDuration,isInteraction:!1,useNativeDriver:!0}),d.default.timing(this._mainCircleScaleAnimatedValue,{toValue:1.06,easing:n.Animated.Easing.CubicBezier(1,0,.78,1),duration:.22*this._loopDuration,isInteraction:!1,useNativeDriver:!0}),d.default.timing(this._mainCircleScaleAnimatedValue,{toValue:1,easing:n.Animated.Easing.CubicBezier(.33,0,.67,1),duration:.22*this._loopDuration,isInteraction:!1,useNativeDriver:!0})])]),!this._animationShouldLoop&&this.isComponentMounted()?this._animationBeginning.start(()=>{this._startAnimation()}):this.isComponentMounted()&&this._animationLoop.start(()=>{this._startAnimation()}),this._animationShouldLoop=!0}componentDidMount(){super.componentDidMount(),this._startAnimation(),d.default.timing(this._innerContainerOpacityValue,{toValue:1,duration:50,delay:d.default.delayDuration(250),easing:n.Animated.Easing.In(),useNativeDriver:!0}).start()}render(){let e;e=s.isOneOnOneConversation(this.props.conversationId)?n.createElement(h.UserIcon,{userMri:this.props.conversationId,forceMediumAvatarSize:!0,size:p.UserIconSize.Size160,showBorder:!0}):n.createElement(r.ConversationIcon,{conversationId:this.props.conversationId,size:p.ConversationIconSize.Size160,showBorder:!0});const t=this.props.useLightTheme?g.lightThemeBackgroundColor:void 0;return n.createElement(n.View,{style:[g.outerContainer,t]},n.createElement(n.Animated.View,{style:[g.innerContainer,this._innerContainerOpacityStyle]},n.createElement(n.Animated.View,{style:[g.backgroundRingMask,t,this._backgroundRingMaskScaleAnimatedStyle]},n.createElement(a.GradientView,{style:g.gradientRing,colors:c.default.getGradientColorsNoSubscription(),direction:a.GradientDirection.BOTTOM_RIGHT})),n.createElement(n.Animated.View,{style:[g.backgroundRingColored,t,this._backgroundRingColoredScaleAnimatedStyle]}),n.createElement(n.Animated.View,{style:[g.mainCircle,this._mainCircleScaleAnimatedStyle]},e)))}}t.default=C},3645:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(7),o=i(29),s=i(70),r=i(141),l=i(16),c=i(12),d=i(31);class u extends c.default{constructor(){super(...arguments),this._callTimerInterval=1e3,this._onTimerUpdate=()=>{const e=o.default.OngoingCallService.getCallConnectedTime(this.props.callId),t=e?Date.now()-e:0;this.setState({elapsedTimeMs:t})}}_buildState(e,t){let i={};return t&&(i.elapsedTimeMs=0),i}componentDidMount(){super.componentDidMount(),this.props.isTimerActive&&this._maybeStartTimer()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),e.isTimerActive!==this.props.isTimerActive&&this._maybeStartTimer()}componentWillUnmount(){super.componentWillUnmount(),this._stopTimer()}_maybeStartTimer(){this.props.isTimerActive?this._startTimer():this._stopTimer()}_startTimer(){this._timerToken||(this._timerToken=d.default.setInterval(this._onTimerUpdate,this._callTimerInterval),this._onTimerUpdate())}_stopTimer(){this._timerToken&&(d.default.clearInterval(this._timerToken),this._timerToken=void 0)}_shouldRender(){return this.props.participantCountText||this.props.isTimerActive||this.state.elapsedTimeMs&&this.state.elapsedTimeMs>0}render(){if(this._shouldRender()){const e=this.state.elapsedTimeMs||this.props.isTimerActive,t=this.state.elapsedTimeMs||0;let i=e?s.default.getElapsedTimeStringFromMs(this.state.elapsedTimeMs||0):void 0,n=e?s.default.getFormattedDuration(Math.floor(t/1e3),!0):void 0;return this.props.participantCountText&&(n=this.props.participantCountText+(n?", "+n:""),i=this.props.participantCountText+(i?" | "+i:"")),a.createElement(r.HoverableView,{accessibilityLabel:n,accessibilityTraits:a.Types.AccessibilityTrait.Text,importantForAccessibility:a.Types.ImportantForAccessibility.Auto,onPress:this.props.onPress},a.createElement(l.Subtitle,{style:[this.props.baseSubtitleStyle,this.props.textThemeStyle],accessibilityHidden:!0,numberOfLines:1},i))}return null}}class h extends c.default{_buildState(e){return{elapsedTimeSec:o.default.CallDurationStore.getCallDurationInSeconds(e.callId)}}_shouldRender(){return this.props.participantCountText||this.state.elapsedTimeSec&&this.state.elapsedTimeSec>0||this.props.isTimerActive}render(){if(this._shouldRender()){const e=this.state.elapsedTimeSec||this.props.isTimerActive,t=this.state.elapsedTimeSec||0;let i=e?s.default.getElapsedTimeStringFromS(t):void 0,n=e?s.default.getFormattedDuration(Math.floor(t),!0):void 0;return this.props.participantCountText&&(n=this.props.participantCountText+(n?", "+n:""),i=this.props.participantCountText+(i?" | "+i:"")),a.createElement(r.HoverableView,{accessibilityLabel:n,accessibilityTraits:a.Types.AccessibilityTrait.Text,importantForAccessibility:a.Types.ImportantForAccessibility.Auto,onPress:this.props.onPress},a.createElement(l.Subtitle,{style:[this.props.baseSubtitleStyle,this.props.textThemeStyle],accessibilityHidden:!0,numberOfLines:1,v2:this.props.subtitleV2},i))}return null}}class p extends c.default{_buildState(){return{enableEndCallInRecents:n.default.getS4LCMCFeatures().enableEndCallInRecents}}render(){return this.state.enableEndCallInRecents?a.createElement(h,Object.assign({},this.props)):a.createElement(u,Object.assign({},this.props))}}t.default=p},3646:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(60),s=i(378),r=i(6),l=i(9),c=i(24),d=i(11),u=i(12),h=i(219),p=i(110),g=i(29),C=i(518),m=i(588),S=r.lazyProperties({dividerDesktop:()=>n.Styles.createViewStyle({borderBottomWidth:1,height:1,marginTop:5,marginBottom:5,borderColor:l.Color.gray400Overlay70}),dividerDesktopV2:()=>n.Styles.createViewStyle({height:2,marginTop:4,marginBottom:4,backgroundColor:"#11100F"}),dividerMobile:()=>n.Styles.createViewStyle({borderBottomWidth:1,height:1,borderColor:l.Color.whiteOverlay70}),rowMobile:()=>n.Styles.createViewStyle({marginHorizontal:16}),hoverStyle:()=>n.Styles.createViewStyle({backgroundColor:l.Color.gray200Overlay20})}),y=l.Color.white;class f extends u.default{constructor(){super(...arguments),this._onContainerRef=e=>{this._containerRef=e||void 0}}_buildState(e,t){return{disabled:this._isDisabled(e),isSelected:this._isSelected(e)}}_isDisabled(e){let t=!1;const i=p.default.layoutPickerMenuItemTypeToStageMode(e.type);if(e.changeLayoutCommand&&!a.isUndefined(i)&&(t=!e.changeLayoutCommand.canExecuteForStageMode(i)),e.type===o.LayoutPickerMenuItemType.SelfInTheGridToggle){const i=h.default.getOnlyVideoOnTheStage(e.callId)&&!g.default.CallingStore.isProvidingVideo(e.callId),a=C.default.hasPinnedParticipants(e.callId);(i||a)&&(t=!0)}return e.type===o.LayoutPickerMenuItemType.OnlyVideoOnTheStage&&C.default.getPinnedParticipants(e.callId)&&(t=!0),e.type!==o.LayoutPickerMenuItemType.HidePeopleAtTop||m.default.trayHasParticipants(e.callId)||(t=!0),t}_isSelected(e){let t=e.isSelected;if(e.type===o.LayoutPickerMenuItemType.SelfInTheGridToggle){const i=h.default.getOnlyVideoOnTheStage(e.callId)&&!g.default.CallingStore.isProvidingVideo(e.callId),a=C.default.hasPinnedParticipants(e.callId);(i||a)&&(t=!1)}return e.type===o.LayoutPickerMenuItemType.OnlyVideoOnTheStage&&C.default.hasPinnedParticipants(e.callId)&&(t=!1),!!t}render(){if(this.props.isDivider)return this._renderDivider();const e=this.props.itemColor?this.props.itemColor:y,t={onRef:this._onContainerRef,icon:this.props.icon,accessibilityLabel:this.props.title||"",titleText:this.props.title,onRowPress:this.props.onRowPress,colorThemeOverride:this.props.colorThemeOverride,rowHeight:this._getRowHeight(),titleTextColor:e,accessoryIcon:this.state.isSelected?d.SkypeIcon.Ok:void 0,titleStyle:c.default.fontStyle.bodySmallDeprecated,iconSize:d.IconSize.size16,accessoryIconSize:d.IconSize.size16,iconColor:e,accessoryIconColor:e,hideBorder:!this.props.showBorder,disabled:this.state.disabled,borderColor:l.Color.gray50Overlay50,tooltip:this.state.disabled?this.props.tooltip:void 0,containerStyleOverride:this.props.useMobileControls?S.rowMobile:void 0,hoverStyle:S.hoverStyle,isNew:this.props.isNew};return s.default.buildRow(t)}requestFocus(){this._containerRef&&this._containerRef.requestFocus()}_getRowHeight(){return this.props.useMobileControls?o.MobileLayoutPickerItemHeight:o.DesktopLayoutPickerItemHeight}_renderDivider(){const e=this.props.useMobileControls?S.dividerMobile:this.props.callStageV2?S.dividerDesktopV2:S.dividerDesktop;return n.createElement(n.View,{style:[e,this.props.dividerColor&&{backgroundColor:this.props.dividerColor}],importantForAccessibility:n.Types.ImportantForAccessibility.No})}}t.default=f,f.buildRow=e=>n.createElement(f,Object.assign({},e))},3647:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(29),o=i(328),s=i(60),r=i(43),l=i(70),c=i(32),d=i(3),u=i(4),h=i(6),p=i(5),g=i(9),C=i(16),m=i(12),S=i(31),y=i(10),f=h.lazyProperties({titleContainer:()=>a.Styles.createViewStyle({flex:-1,paddingTop:6,justifyContent:"center",backgroundColor:g.Color.transparent}),headerContainer:()=>a.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"flex-start",height:s.CallPanelHeaderHeight.mobile}),headerContainerLeftAligned:()=>a.Styles.createViewStyle({alignItems:"flex-start"}),firstRow:()=>a.Styles.createViewStyle({paddingTop:16,justifyContent:"center",marginBottom:8}),firstRowLeftAligned:()=>a.Styles.createViewStyle({marginBottom:1}),conversationNameText:()=>a.Styles.createTextStyle({color:g.Color.white}),callInfo:()=>a.Styles.createTextStyle({color:g.Color.whiteOverlay70})});class _ extends m.default{constructor(){super(...arguments),this._onPress=()=>{if(this.props.onTitlePress){const e=y.default.newCauseId();u.log(d.LogTraceArea.CallingUI,"MobileCallPanelHeaderTitle._onPress, causeId: "+e),this.props.onTitlePress(e,s.CallRosterOrigin.FromGroupTitle)}}}_buildState(e,t){const i=n.default.CallingStore.getConnectedAndNotOnHoldCallId(),a=!!i&&i!==e.callId;return{conversationName:c.default.getDisplayName(e.conversationMri)||p.getString("Notifications.UnknownUserShort"),activeParticipantCount:e.showParticipantCount?o.default.getActiveParticipants(e.callId,e.conversationMri).length:void 0,totalParticipantCount:e.showParticipantCount?o.default.getRosterForConversation(e.conversationMri).length:void 0,multipleCallWarning:a?p.getString("CallBanner.IncomingCallMultiCallWarning"):void 0}}render(){const e=[f.firstRow],t=[f.headerContainer,f.headerContainerLeftAligned],i=[f.conversationNameText,f.firstRowLeftAligned],n=[f.callInfo],o=a.createElement(a.View,{style:e},a.createElement(C.PanelHeader,{landscape:this.props.isLandscape,style:i,numberOfLines:1},this.state.conversationName));let s,r;this.props.outgoingRingStatus&&this.props.outgoingRingStatus.length&&(s=a.createElement(C.Caption,{style:n,numberOfLines:1},this.props.outgoingRingStatus)),this.props.showParticipantCount&&this.state.activeParticipantCount&&this.state.totalParticipantCount&&(r=p.getString("CallPanel.CallRosterTitleUpper",{count:this.state.activeParticipantCount,total:this.state.totalParticipantCount}));const l=a.createElement(b,{callId:this.props.callId,isActive:this.props.isCallActive&&this.props.isSeen,participantCountText:r,textStyle:n});let c;this.state.multipleCallWarning&&(c=a.createElement(C.Caption,{style:n},this.state.multipleCallWarning));const d=!!this.props.onTitlePress;return a.createElement(a.Button,{style:f.titleContainer,onPress:d?this._onPress:void 0,accessibilityTraits:d?a.Types.AccessibilityTrait.Button:a.Types.AccessibilityTrait.Text,disableTouchOpacityAnimation:!d},a.createElement(a.View,{style:t},o,s,c,l))}_subscribeToThemeChanges(){return!1}}t.default=_;class b extends m.default{constructor(){super(...arguments),this._onTimerUpdate=()=>{const e=n.default.OngoingCallService.getCallConnectedTime(this.props.callId),t=e?Date.now()-e:0;this.setState({elapsedTimeMs:t})}}_buildState(e,t){let i={};return t&&(i.elapsedTimeMs=0),i}componentDidMount(){super.componentDidMount(),this.props.isActive&&this._maybeStartTimer()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),e.isActive!==this.props.isActive&&this._maybeStartTimer()}componentWillUnmount(){super.componentWillUnmount(),this._startOrStopCallTimer(!1)}_maybeStartTimer(){this._startOrStopCallTimer(!!this.props.isActive)}_startOrStopCallTimer(e){e?this._timerToken||(this._timerToken=S.default.setInterval(this._onTimerUpdate,1e3),this._onTimerUpdate()):this._timerToken&&(S.default.clearInterval(this._timerToken),this._timerToken=void 0)}render(){let e=null;if(this.props.participantCountText||this.state.elapsedTimeMs>0||this.props.isActive){const t=this.state.elapsedTimeMs||this.props.isActive,i=t?l.default.getElapsedTimeStringFromMs(this.state.elapsedTimeMs):void 0,n=t?l.default.getFormattedDuration(Math.floor(this.state.elapsedTimeMs/1e3),!0):void 0,o=this.props.participantCountText&&i?a.createElement(a.Text,null," | "):void 0;let s;s=this.props.participantCountText&&n?r.default.combinedAccessibilityLabel(this.props.participantCountText,n):this.props.participantCountText||n,e=a.createElement(a.View,{accessibilityLabel:s,importantForAccessibility:a.Types.ImportantForAccessibility.Yes,accessibilityTraits:a.Types.AccessibilityTrait.Text},a.createElement(C.Caption,{style:this.props.textStyle,numberOfLines:1,accessibilityHidden:!0},this.props.participantCountText,o,i))}return e}_subscribeToThemeChanges(){return!1}}},3648:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(35),o=i(0),s=i(7),r=i(29),l=i(3649),c=i(1256),d=i(325),u=i(87),h=i(60),p=i(110),g=i(695),C=i(241),m=i(109),S=i(13),y=i(3650),f=i(45),_=i(3),b=i(41),v=i(4),w=i(6),T=i(5),I=i(190),P=i(27),M=i(36),k=i(59),A=i(78),R=i(3651),V=i(399),E=i(9),L=i(11),B=i(10);var O;!function(e){e[e.Left1=0]="Left1",e[e.Left2=1]="Left2",e[e.Right1=2]="Right1",e[e.Right2=3]="Right2"}(O||(O={}));const D=w.lazyProperties({barContainer:()=>o.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:0,paddingLeft:8,flexDirection:"row",overflow:"visible",backgroundColor:E.Color.transparent}),menu:()=>o.Styles.createViewStyle({paddingLeft:0,paddingTop:10,alignItems:"center",justifyContent:"space-between",overflow:"visible"}),menuIcon:()=>o.Styles.createViewStyle({width:L.IconSize.default,height:L.IconSize.default,alignItems:"center",justifyContent:"center",marginHorizontal:5,overflow:"visible"}),leftControls:()=>o.Styles.createViewStyle({flexDirection:"row",overflow:"visible"}),rightControls:()=>o.Styles.createViewStyle({flexDirection:"row",overflow:"visible"}),tabletReactionsContainer:()=>o.Styles.createViewStyle({justifyContent:"flex-end",height:340}),chatIconBadge:()=>o.Styles.createViewStyle({height:8,width:8,backgroundColor:E.Color.red,borderRadius:4,position:"absolute",right:5,top:5,justifyContent:"center",alignItems:"center"}),backgroundCircle:()=>o.Styles.createViewStyle({position:"absolute",width:L.IconSize.default,height:L.IconSize.default,borderRadius:L.IconSize.default/2,backgroundColor:E.Color.white,opacity:.5})});class x extends f.default{constructor(){super(...arguments),this._coachMarkContext={coachMarkArea:m.CoachMarkAreaType.CallReactionsBar},this._menuAnimatedTansformValue=new o.Animated.Value(0),this._menuAnimatedTansformStyle=o.Styles.createAnimatedViewStyle({transform:[{translateY:this._menuAnimatedTansformValue}]}),this._circleAnimatedScaleValue=new o.Animated.Value(0),this._circleAnimatedScaleStyle=o.Styles.createAnimatedViewStyle({transform:[{scale:this._circleAnimatedScaleValue}]}),this.closeReactionsDrawer=()=>{this._reactionsDrawer&&this._reactionsDrawer.closeDrawer()},this.setOverflowCoachMarksEnabled=e=>{this.setState({overflowCoachMarksEnabled:e})},this._onOpenReactionsDrawer=()=>{const e=B.default.newCauseId();v.log(_.LogTraceArea.CallReactions,"CallReactionsBar.openReactionsDrawer causeId: "+e),this.openReactionsDrawer(e)},this._onOpenCloseAnimationCompleteForStackNav=e=>{I.default.timing(this._menuAnimatedTansformValue,{toValue:e?this.props.minDrawerHeight+(this.props.audioNotificationOffset||0):0,duration:150,easing:o.Animated.Easing.Out(),useNativeDriver:!0}).start(),v.log(_.LogTraceArea.CallReactions,"ReactionsBar._onToggleOpen open: "+e),this.props.onReactionsDrawerOpen&&this.props.onReactionsDrawerOpen(e)},this._onOpenCloseAnimationCompleteForComposite=e=>{this.state.compositeReactionsDrawerOpen!==e&&this.isComponentMounted()&&this.setState({compositeReactionsDrawerOpen:e}),this.props.onReactionsDrawerOpen&&this.props.onReactionsDrawerOpen(e)},this._onGalleryButtonPress=()=>{if(this.props.onGalleryButtonPress){const e=B.default.newCauseId();v.log(_.LogTraceArea.CallingUI,"CallReactionsBar._onGalleryButtonPress, causeId: "+e),this.props.onGalleryButtonPress(e)}},this._onChatButtonPress=()=>{if(this.props.onChatButtonPress){const e=B.default.newCauseId();v.log(_.LogTraceArea.CallingUI,"CallReactionsBar._onChatButtonPress, causeId: "+e),this.props.onChatButtonPress(e)}},this._onCallReactionPressed=(e,t)=>{const i=B.default.newCauseId();v.log(_.LogTraceArea.CallReactions,"CallReactionsBar._onCallReactionPressed causeId: "+i),this.state.compositeReactionsDrawerOpen?this.closeReactionsDrawer():this.openReactionsDrawer(i)},this._onLayoutChanged=e=>{this.props.onDesiredHeightChanged&&this.props.onDesiredHeightChanged(Math.max(this.props.minDrawerHeight,e.height))},this._onReactionsDrawerRef=e=>{this._reactionsDrawer=e||void 0}}_buildState(e,t){var i,a;const o=s.default.getS4LCMCFeatures(),l=this._getRootViewId(),c=g.default.getCelebrationData(e.conversationMri,e.callId);let d={horizontalInsets:e.isUsingStackNavigationContext?M.default.horizontalInsets(S.HorizontalInsetDefault):{left:15,right:15},enableMomentsCapture:o.enableMomentsCapture,buttonConfig:e.isUsingStackNavigationContext?o.callReactionsBarButtonConfig.mobile:o.callReactionsBarButtonConfig.tablet,emoticonReactionKey:p.default.getEmoticonReactionKey(c),isMobileScreenReaderEnabled:A.default.isMobileScreenReaderEnabled(),celebrationData:c,isReceivingScreenShare:r.default.CallingStore.isReceivingScreenSharing(e.callId),isChatBadgeOn:this._isUnreadInCallIncomingMessageAndPhoto(),showCustomizeReactionsButton:(null===(i=o.customCallReactions)||void 0===i?void 0:i.enabled)&&(null===(a=o.customCallReactions)||void 0===a?void 0:a.useNewAddEmojiIcon)};return t&&(d.rootViewId=l,d.isLandscape=P.default.getDeviceOrientation(l)===n.DeviceOrientation.Landscape,d.compositeReactionsDrawerOpen=!1,d.overflowCoachMarksEnabled=!1),d}_isUnreadInCallIncomingMessageAndPhoto(){return d.default.getUnseenIncomingTextCount(this.props.reactionsConversationId)>0||d.default.getUnseenIncomingPhotoCount(this.props.reactionsConversationId)>0}componentDidMount(){super.componentDidMount();const e=B.default.newCauseId();v.log(_.LogTraceArea.CallReactions,"CallReactionsBar.componentDidMount causeId: "+e),this._startOrStopOrientationListener(!0,e),this.props.controlsType===h.CallControlsType.Mobile&&I.default.markAnimatedValue(this._menuAnimatedTansformValue,0)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this._reactionsDrawer&&this.state.compositeReactionsDrawerOpen!==t.compositeReactionsDrawerOpen&&(this.state.compositeReactionsDrawerOpen?this._reactionsDrawer.openDrawer():this._reactionsDrawer.closeDrawer())}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),e.isShowingChat!==this.props.isShowingChat&&e.isShowingChat&&(d.default.resetUnSeenIncomingPhotoCount(this.props.reactionsConversationId),d.default.resetUnSeenIncomingTextCount(this.props.reactionsConversationId))}animatedBubbleCircleForChatButton(){o.Animated.sequence([V.default.easeOut({value:this._circleAnimatedScaleValue,toValue:4}),V.default.easeOut({value:this._circleAnimatedScaleValue,toValue:0})]).start()}componentWillUnmount(){super.componentWillUnmount();const e=B.default.newCauseId();v.log(_.LogTraceArea.CallReactions,"CallReactionsBar.componentWillUnmount causeId: "+e),this._startOrStopOrientationListener(!1,e)}close(){return!(!this._reactionsDrawer||this.props.controlsType===h.CallControlsType.Mobile)&&this._reactionsDrawer.closeDrawer()}openReactionsDrawer(e){v.log(_.LogTraceArea.CallReactions,"CallReactionsBar.openReactionsDrawer causeId: "+e);const t=()=>{};if(this.state.isMobileScreenReaderEnabled){new l.CallReactionsActionSheet({reactionsConversationMri:this.props.reactionsConversationId,conversationMri:this.props.conversationMri,callId:this.props.callId,reactions:p.default.getReactionItems(this.state.celebrationData)}).showReactionActionSheet(t,this._getRootViewId())}else this.isComponentMounted()&&this.setState({compositeReactionsDrawerOpen:!0,openReactionsOnHover:!1})}toggleReactionsPickerHovered(){this.isComponentMounted()&&this.setState({compositeReactionsDrawerOpen:!0,openReactionsOnHover:!0})}isDrawerOpen(){return!!this._reactionsDrawer&&this._reactionsDrawer.isOpen()}_startOrStopOrientationListener(e,t){e?this._deviceOrientationKey||(this._deviceOrientationKey=a.uniqueId("ReactionsBar"),n.default.addOrientationEventListener(this._deviceOrientationKey,e=>{const i=e===n.DeviceOrientation.Landscape;this.isComponentMounted()&&this.state.isLandscape!==i&&(this.setState({isLandscape:i}),u.default.updateCallTelemetry(this.props.callId,t,e=>e.orientationChanged(i)))})):this._deviceOrientationKey&&(n.default.removeOrientationEventListener(this._deviceOrientationKey),this._deviceOrientationKey=void 0)}_buttonForOverflowMenuItem(e){switch(e){case h.CallControlsOverflowItem.Reactions:if(this.props.activitiesEnabled){const t=this._descriptorForOverflowMenuItem(e,this.state.compositeReactionsDrawerOpen);return this._renderMenuItem(t.icon,t.title,t.accessibilityLabel,this.state.compositeReactionsDrawerOpen?E.Color.gray400:void 0,!this.state.compositeReactionsDrawerOpen,this.state.compositeReactionsDrawerOpen?this.closeReactionsDrawer:this._onOpenReactionsDrawer,void 0)}break;case h.CallControlsOverflowItem.Moments:if(this.props.activitiesEnabled&&this.state.enableMomentsCapture){const t=this._descriptorForOverflowMenuItem(e);return this.state.overflowCoachMarksEnabled?this._renderMenuItem(t.icon,t.title,t.accessibilityLabel,void 0,!0,this.props.onCaptureMomentPress,this.state.isReceivingScreenShare?m.CoachMarkType.CallPanelPhotoMomentsForScreenShare:m.CoachMarkType.CallPanelPhotoMoments):this._renderMenuItem(t.icon,t.title,t.accessibilityLabel,void 0,!0)}break;case h.CallControlsOverflowItem.Gallery:if(this.props.activitiesEnabled){const t=this._descriptorForOverflowMenuItem(e);return this._renderMenuItem(t.icon,t.title,t.accessibilityLabel,void 0,!0,this._onGalleryButtonPress)}break;case h.CallControlsOverflowItem.Chat:if(this.props.activitiesEnabled){const t=e===h.CallControlsOverflowItem.Chat&&this.props.isShowingChat,i=this._descriptorForOverflowMenuItem(e,t);return this._renderChatMenuItem(i.icon,i.title,i.accessibilityLabel,void 0,!0,this._onChatButtonPress)}}}_descriptorForOverflowMenuItem(e,t=!1,i=!1){return p.default.overflowMenuItemDescriptor(e,t,i)}_renderReactionsMenu(){if(this.props.controlsType!==h.CallControlsType.Mobile)return;const e={[h.CallControlsOverflowItem.Chat]:this._buttonForOverflowMenuItem(h.CallControlsOverflowItem.Chat),[h.CallControlsOverflowItem.Moments]:this._buttonForOverflowMenuItem(h.CallControlsOverflowItem.Moments),[h.CallControlsOverflowItem.Gallery]:this._buttonForOverflowMenuItem(h.CallControlsOverflowItem.Gallery),[h.CallControlsOverflowItem.Reactions]:this._buttonForOverflowMenuItem(h.CallControlsOverflowItem.Reactions)},t=[...this._barContainerStyles(),D.menu,this._menuAnimatedTansformStyle];return k.default.hasHorizontalSafeAreas(this.state.horizontalInsets)&&t.push(k.default.horizontalPaddingStyle(this.state.horizontalInsets)),o.createElement(o.Animated.View,{style:t,ignorePointerEvents:!0},o.createElement(o.View,{style:D.leftControls},this._optionalButton(O.Left1,e),this._optionalButton(O.Left2,e)),o.createElement(o.View,{style:D.rightControls},this._optionalButton(O.Right1,e),this._optionalButton(O.Right2,e)))}_optionalButton(e,t){if(0!==this.state.buttonConfig.length)switch(e){case O.Left1:if(this.state.buttonConfig[0].length>0)return this._buttonForButtonName(this.state.buttonConfig[0][0],t);break;case O.Left2:if(this.state.buttonConfig[0].length>1)return this._buttonForButtonName(this.state.buttonConfig[0][1],t);break;case O.Right1:if(this.state.buttonConfig[1].length>0)return this._buttonForButtonName(this.state.buttonConfig[1][0],t);break;case O.Right2:if(this.state.buttonConfig[1].length>1)return this._buttonForButtonName(this.state.buttonConfig[1][1],t)}}_buttonForButtonName(e,t){switch(e){case h.CallControlsOverflowItem[h.CallControlsOverflowItem.Reactions]:return this.state.compositeReactionsDrawerOpen?t[h.CallControlsOverflowItem.Reactions]:this._renderOptionalReactionButton();case h.CallControlsOverflowItem[h.CallControlsOverflowItem.Chat]:return t[h.CallControlsOverflowItem.Chat];case h.CallControlsOverflowItem[h.CallControlsOverflowItem.Gallery]:return t[h.CallControlsOverflowItem.Gallery];case h.CallControlsOverflowItem[h.CallControlsOverflowItem.Moments]:return t[h.CallControlsOverflowItem.Moments];default:v.warn(_.LogTraceArea.CallingUI,'CallReactionsBar._buttonForButtonName Invalid CallControlsOverflowItem "'+e+'" specified in ECS param callReactionsBarButtonConfig.')}}_renderOptionalReactionButton(){const e={key:this.state.emoticonReactionKey,type:h.ReactionsItemType.Emoticon};return o.createElement(o.View,{style:D.menuIcon},o.createElement(c.default,{key:e.key,info:e,isAnimated:!1,onPress:this._onCallReactionPressed,accessibilityLabel:T.getString("CallReactionsBar.EmoticonButtonTitle"),importantForAccessibility:o.Types.ImportantForAccessibility.Yes}))}_renderMenuItem(e,t,i,n,s,r,l){const c=a.isArray(e)?e[0].icon:e.icon,d={style:D.menuIcon,icon:c,title:t,accessibilityLabel:i,color:n||E.Color.white,hoverColor:n||E.Color.white,size:this.props.useDesktopCallControls?L.IconSize.size20:L.IconSize.size24,showShadow:s,onPress:r};return l?o.createElement(C.default.IconButton,Object.assign({},d,{key:l,coachMarkType:l,positions:[m.PopupAnchorPositon.Top],anchorAccessibilityLabel:i})):o.createElement(b.default,Object.assign({},d))}_renderChatMenuItem(e,t,i,n,s,r,l){const c={icon:a.isArray(e)?e[0].icon:e.icon,title:t,accessibilityLabel:i,color:n||E.Color.white,hoverColor:n||E.Color.white,size:this.props.useDesktopCallControls?L.IconSize.size20:L.IconSize.size24,showShadow:s,onPress:r},d=this.state.isChatBadgeOn?o.createElement(o.View,{style:D.chatIconBadge}):void 0,u=l?o.createElement(C.default.IconButton,Object.assign({},c,{coachMarkType:l,positions:[m.PopupAnchorPositon.Top],anchorAccessibilityLabel:i})):o.createElement(b.default,Object.assign({},c));return o.createElement(o.View,{style:D.menuIcon},o.createElement(o.Animated.View,{style:[D.backgroundCircle,this._circleAnimatedScaleStyle]}),u,d)}_renderReactionsDrawer(){if(!this.state.compositeReactionsDrawerOpen&&!this.props.isUsingStackNavigationContext)return null;let e;const t=this.props.controlsType===h.CallControlsType.Mobile;e=this.props.isUsingStackNavigationContext?o.createElement(R.default,{ref:this._onReactionsDrawerRef,conversationMri:this.props.conversationMri,reactionsConversationMri:this.props.reactionsConversationId,callId:this.props.callId,bottomSafeAreaInset:this.props.bottomSafeAreaInset,horizontalInsets:this.state.horizontalInsets,controlsType:this.props.controlsType,onOpenCloseAnimationComplete:this._onOpenCloseAnimationCompleteForStackNav,celebrationData:this.state.celebrationData,audioNotificationOffset:this.props.audioNotificationOffset}):o.createElement(y.default,{ref:this._onReactionsDrawerRef,conversationMri:this.props.conversationMri,reactionsConversationMri:this.props.reactionsConversationId,callId:this.props.callId,controlsType:this.props.controlsType,onOpenCloseAnimationComplete:this._onOpenCloseAnimationCompleteForComposite,drawerOpenedOnHover:this.state.openReactionsOnHover,celebrationData:this.state.celebrationData,showCustomizeReactionsButton:this.state.showCustomizeReactionsButton,rootViewId:this.state.rootViewId});const i=!this.props.isUsingStackNavigationContext&&t?[D.tabletReactionsContainer]:this._barContainerStyles();return o.createElement(o.View,{style:i,ignorePointerEvents:!0},e)}_barContainerStyles(){return[D.barContainer,o.Styles.createViewStyle({height:this.props.minDrawerHeight+this.props.bottomSafeAreaInset,paddingBottom:this.props.bottomSafeAreaInset},!1)]}render(){return o.createElement(o.View,{style:this.props.style,onLayout:this.props.onDesiredHeightChanged?this._onLayoutChanged:void 0,ignorePointerEvents:!0},o.createElement(m.CoachMarkContext.Provider,{value:this._coachMarkContext},this._renderReactionsDrawer(),this._renderReactionsMenu()))}}t.default=x},3649:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallReactionsActionSheet=void 0;const a=i(1),n=i(584),o=i(3),s=i(4),r=i(324),l=i(72),c=i(10);t.CallReactionsActionSheet=class{constructor(e){this._onActionButtonPress=(e,t)=>{switch(t){case l.SXActionMenuCancel:s.log(o.LogTraceArea.CallingUI,"Dismissing call reaction action sheet");break;default:this._reactionPressed(t)}},this._reactionSheetOptions=e,this._reactions=a.map(e.reactions,e=>({key:e.key,info:e}))}showReactionActionSheet(e,t){a.isEmpty(this._reactions)?s.warn(o.LogTraceArea.CallingUI,"ReactionPack is empty, not showing action sheet"):(s.log(o.LogTraceArea.CallingUI,"showing reactions menu"),this._showReactionActionMenu(e,t))}_showReactionActionMenu(e,t){const i=a.map(this._reactions,e=>({text:r.default.localizedAccessibilityTextForEmoticon(e.key)||e.key,command:e.key}));l.default.showWithActionMenuConfig({options:{anchor:e,buttons:i},callback:t=>this._onActionButtonPress(e,t),rootViewId:t,invokingEvent:void 0})}_reactionPressed(e){const t=c.default.newCauseId();s.log(o.LogTraceArea.CallingUI,"_onReactionPressed causeId: "+t);const i=a.find(this._reactions,t=>t.key===e);if(i){const e={reactionInfo:i.info,causeId:t,timestamp:Date.now(),postSource:o.PostSource.CallReactionPressed,callId:this._reactionSheetOptions.callId,conversationMri:this._reactionSheetOptions.conversationMri,reactionsConversationMri:this._reactionSheetOptions.reactionsConversationMri,logTraceArea:o.LogTraceArea.CallingUI};n.CallReactionPostingHelpers.postReaction(e)}}}},3650:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(1772),s=i(60),r=i(9),l=i(839),c=i(414),d=i(41),u=i(11),h=i(4),p=i(106),g=i(6),C=i(5),m=i(18),S=g.lazyProperties({drawerContainer:()=>n.Styles.createViewStyle({flex:1,justifyContent:"flex-end",alignItems:"center"}),drawer:()=>n.Styles.createViewStyle({width:52,borderRadius:26,backgroundColor:r.Color.whiteOverlay70}),containerMobile:()=>n.Styles.createViewStyle({bottom:5,right:15}),innerContainer:()=>n.Styles.createViewStyle({flex:1,alignItems:"center",paddingTop:6,backgroundColor:r.Color.transparent}),closeButtonContainer:()=>n.Styles.createViewStyle({position:"relative"}),customizeReactionButtonContainer:()=>n.Styles.createViewStyle({position:"relative"}),closeButton:()=>n.Styles.createViewStyle({width:34,height:34,borderRadius:17,marginTop:6,marginHorizontal:9,alignItems:"center",backgroundColor:r.Color.gray400Overlay10}),customizeReactionButton:()=>n.Styles.createViewStyle({width:34,height:34,alignItems:"center",marginTop:6,marginHorizontal:9}),minContainer:()=>n.Styles.createViewStyle({position:"absolute",right:10,bottom:95}),container:()=>n.Styles.createViewStyle({position:"absolute",right:110,bottom:24}),newMainCallControlsContainer:()=>n.Styles.createViewStyle({position:"absolute",right:90,bottom:24}),divider:()=>n.Styles.createViewStyle({position:"relative",flex:1,marginVertical:6,marginHorizontal:10,height:1,flexDirection:"row",opacity:.3,backgroundColor:r.Color.blackOverlay35})});class y extends o.default{constructor(){super(...arguments),this._animatedHeightValue=new n.Animated.Value(0),this._animatedOpacityValue=new n.Animated.Value(0),this._animatedContainerStyle=n.Styles.createAnimatedViewStyle({height:this._animatedHeightValue}),this._animatedInnerContainerStyle=n.Styles.createAnimatedViewStyle({opacity:this._animatedOpacityValue}),this._onCloseButtonPress=()=>{this.closeDrawer()},this._onCustomizeReactionsButton=()=>{m.default.navigateToCustomReactionsPanel(l.CustomReactionsType.Call,this.props.rootViewId),h.track(new c.CustomReactionsManipulationTelemetry(c.CustomReactionsManipulationAction.CustomReactionsPanelOpened,{customReactionsType:l.CustomReactionsType.Call}))},this._onMouseLeave=()=>{this.state.isOpen&&this.props.drawerOpenedOnHover&&this.closeDrawer()},this._onKeyPress=e=>!(!this.isComponentMounted()||e.keyCode!==p.default.ESCAPE||!this.state.isOpen)&&(this.closeDrawer(),!0),this._onContainerRef=e=>{this._container=e||void 0}}_positionDrawer(e,t){const i=t.isOpen,a=this._getDrawerHeight(t.reactions.length),o=i?a:0,s=i?1:0;if(this._onPositionDrawer(e,t),this._animatedHeightValue&&this._animatedOpacityValue)if(e){const e=n.Animated.timing(this._animatedHeightValue,{toValue:o,easing:n.Animated.Easing.Linear(),duration:i?y.heightAnimationDurationOnOpen:y.heightAnimationDurationOnClose}),t=n.Animated.timing(this._animatedOpacityValue,{toValue:s,easing:n.Animated.Easing.Linear(),duration:i?y.opacityAnimationDurationOnOpen:y.opacityAnimationDurationOnClose});let a,r;i?(a=e,r=t):(a=t,r=e),this._drawerAnimation=a,this._drawerAnimation.start(()=>{this._drawerAnimation=r,this._drawerAnimation.start(()=>{this._onPositionDrawerAnimationCompleted()})})}else this._animatedHeightValue.setValue(o),this._animatedOpacityValue.setValue(s)}_renderReactionViews(e){return a.compact(e)}_getDrawerHeight(e){let t=44*e+12;return this.props.showCustomizeReactionsButton&&(t+=53),this.props.drawerOpenedOnHover||(t+=46),t}_renderCloseButton(){if(this.props.controlsType!==s.CallControlsType.Mobile&&!this.props.drawerOpenedOnHover)return n.createElement(n.View,{ignorePointerEvents:!0,style:S.closeButtonContainer},n.createElement(d.default,{icon:u.SkypeIcon.DownChevron,style:S.closeButton,size:u.IconSize.size20,color:r.Color.gray400,hoverColor:r.Color.gray400,onPress:this._onCloseButtonPress,title:void 0,accessibilityLabel:C.getString("ReactionsStream.ReactionBarCloseDrawerTitle")}))}_renderCustomizeReactionsButton(){if(this.props.showCustomizeReactionsButton)return n.createElement(n.View,{ignorePointerEvents:!0,style:S.customizeReactionButtonContainer},n.createElement(d.default,{icon:u.SkypeIcon.EmojiAdd,style:S.customizeReactionButton,size:u.IconSize.size32,color:r.Color.gray400,hoverColor:r.Color.gray400,onPress:this._onCustomizeReactionsButton,title:C.getString("ReactionsPanel.CustomCallReactionsTitle"),accessibilityLabel:C.getString("ReactionsPanel.CustomCallReactionsTitle")}),n.createElement(n.View,{style:S.divider}))}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.isOpen!==t.isOpen&&this._resetFocus(this.state.isOpen)}_resetFocus(e){this._container&&this._container.setFocusRestricted(e)}componentDidMount(){super.componentDidMount(),this.state.isOpen||this._resetFocus(!1)}render(){const e=this.props.controlsType===s.CallControlsType.DesktopMinSmallest,t=[S.drawer];this._animatedContainerStyle&&t.push(this._animatedContainerStyle);const i=this._getDrawerHeight(this.state.reactions.length),a=n.Styles.createViewStyle({height:i},!1);let o;o=e?S.minContainer:this.state.enableNewMainCallControls?S.newMainCallControlsContainer:S.container;const r=[a,o],l=[S.innerContainer];let c;this._animatedInnerContainerStyle&&l.push(this._animatedInnerContainerStyle),this.props.controlsType===s.CallControlsType.Mobile&&r.push(S.containerMobile),this.state.isOpen&&(c=this._renderCloseButton());const d=this._renderCustomizeReactionsButton();return n.createElement(n.View,{style:r,onKeyPress:this._onKeyPress,onMouseLeave:this._onMouseLeave,restrictFocusWithin:!0,ref:this._onContainerRef},n.createElement(n.View,{style:S.drawerContainer,ignorePointerEvents:!0},n.createElement(n.Animated.View,{style:t,ignorePointerEvents:!0},n.createElement(n.Animated.View,{style:l,ignorePointerEvents:!0},d,this._renderContent(),c))))}}t.default=y,y.heightAnimationDurationOnOpen=150,y.opacityAnimationDurationOnOpen=150,y.heightAnimationDurationOnClose=50,y.opacityAnimationDurationOnClose=50},3651:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(1772),s=i(3),r=i(610),l=i(41),c=i(6),d=i(5),u=i(190),h=i(59),p=i(9),g=i(20),C=i(11),m=c.lazyProperties({container:()=>n.Styles.createViewStyle({position:"absolute",bottom:0,right:0,left:0,height:70,overflow:"visible"}),innerContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",justifyContent:"space-between",backgroundColor:p.Color.blackOverlay20}),innerContainerRTL:()=>n.Styles.createViewStyle({flexDirection:"row-reverse"}),closeIcon:()=>n.Styles.createViewStyle({width:C.IconSize.default,height:C.IconSize.default,alignItems:"center",justifyContent:"center"})});class S extends o.default{constructor(){super(...arguments),this._enableHaptics=g.default.getPlatformType()===s.PlatformType.iOS,this._animatedStylesInitialized=!1}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.isOpen!==t.isOpen&&this._positionDrawer(!0,this.state)}openDrawer(){super.openDrawer(),this._enableHaptics&&r.default.prepareFeedback()}closeDrawer(){const e=super.closeDrawer();return this._enableHaptics&&r.default.unprepareFeedback(),e}_onHandleReactionPressed(){super._onHandleReactionPressed(),this._enableHaptics&&r.default.triggerFeedback()}_positionDrawer(e,t){if(this._onPositionDrawer(e,t),!this._animatedStylesInitialized)return void this._maybeInitAnimatedStyles(t);const i=this._animatedValues(t);this._animatedTransformValue&&this._animatedOpacityValue&&(e?(this._drawerAnimation=n.Animated.parallel([u.default.timing(this._animatedTransformValue,{toValue:i.top,easing:n.Animated.Easing.Out(),duration:150,useNativeDriver:!0}),u.default.timing(this._animatedOpacityValue,{toValue:i.opacity,easing:n.Animated.Easing.Out(),duration:150,useNativeDriver:!0})]),this._drawerAnimation.start(e=>{this._onPositionDrawerAnimationCompleted()})):(this._animatedTransformValue.setValue(i.top),this._animatedOpacityValue.setValue(i.opacity)))}_renderReactionViews(e){const t=n.createElement(l.default,{key:"close",style:m.closeIcon,size:C.IconSize.size24,icon:C.SkypeIcon.Cancel,color:p.Color.white,hoverColor:p.Color.white,title:d.getString("ReactionsStream.ReactionBarCloseDrawerTitle"),onPress:this._onToggleOpen});return a.compact([...e,t])}_maybeInitAnimatedStyles(e){if(!this._animatedStylesInitialized){const t=this._animatedValues(e);this._animatedTransformValue=new n.Animated.Value(t.top),this._animatedOpacityValue=new n.Animated.Value(t.opacity),this._animatedStyle=n.Styles.createAnimatedViewStyle({opacity:this._animatedOpacityValue,transform:[{translateY:this._animatedTransformValue}]}),this._animatedStylesInitialized=!0}}_animatedValues(e){return{top:e.isOpen?0:this._drawerSize(),opacity:e.isOpen?1:0}}_drawerSize(){return 70+this.props.bottomSafeAreaInset}render(){const e=[m.container];this._animatedStyle&&e.push(this._animatedStyle);const t=[m.innerContainer];return h.default.hasHorizontalSafeAreas(this.props.horizontalInsets)&&t.push(h.default.horizontalPaddingStyle(this.props.horizontalInsets)),this._isRTL&&t.push(m.innerContainerRTL),this.props.bottomSafeAreaInset&&(e.push(h.default.heightStyle(this._drawerSize())),t.push(h.default.paddingBottomStyle(this.props.bottomSafeAreaInset))),n.createElement(n.Animated.View,{style:e},n.createElement(n.View,{style:t},this._renderContent()))}}t.default=S},3652:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallStageView=void 0;const a=i(34),n=i(1),o=i(116),s=i(0),r=i(74),l=i(7),c=i(331),d=(i(700),i(1227)),u=i(29),h=i(123),p=i(1698),g=i(740),C=i(743),m=i(3653),S=i(1773),y=i(219),f=i(87),_=i(60),b=i(110),v=i(413),w=i(53),T=i(1774),I=i(17),P=i(109),M=i(32),k=i(3),A=i(148),R=i(1775),V=i(4),E=i(37),L=i(229),B=i(125),O=i(3657),D=i(6),x=i(181),N=i(5),U=i(158),F=i(121),H=i(21),z=i(583),G=i(3658),W=i(3659),K=i(3660),j=i(39),Q=i(36),q=i(78),X=i(48),$=i(345),J=i(19),Y=i(9),Z=i(14),ee=i(12),te=i(31),ie=i(65),ae=i(46),ne=i(10),oe="video_"+_.CallStageElementKeys.localUserKey,se=D.lazyProperties({backdropContainer:()=>s.Styles.createViewStyle({position:"absolute",top:0,right:0}),ribbonBackdrop:()=>s.Styles.createViewStyle({flex:1,backgroundColor:Y.Color.transparent}),reactionsView:()=>Z.default.absoluteFill,overlayTopContainer:()=>s.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0}),overlayBottomContainer:()=>s.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:0}),overlayContainer:()=>s.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,alignItems:"stretch",overflow:"visible",backgroundColor:Y.Color.blackOverlay20}),mobileOverlayShim:()=>s.Styles.createViewStyle({backgroundColor:Y.Color.blackOverlay50}),stageContainerStyle:()=>s.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:Y.Color.transparent,flex:1,flexDirection:"column",flexWrap:"wrap",justifyContent:"center",alignSelf:"center"}),windowTopOffsetStageContainerStyle:()=>s.Styles.createViewStyle({top:_.CallPanelHeaderHeight.window}),zeroTopOffsetStageContainerStyle:()=>s.Styles.createViewStyle({top:0}),modernStageLandscapeContainerStyle:()=>s.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap"})});class re extends ee.default{constructor(){super(...arguments),this._mappedVideos={},this._mappedRefs={},this._layoutController=new S.default(!1),this._mountedRefsMap=new F.default,this._latestVisibleRibbonCallItemKeys=[],this._localUserParticipantInfo={key:_.CallStageElementKeys.localUserKey,mri:H.default.getSkypeMri(),ribbonAddTime:0,connectionSortKey:0,streamsStatus:_.CallParticipantStreamsStatus.None},this._ribbonAnimatedWidthValue=new s.Animated.Value(0),this._ribbonAnimatedWidthStyle=s.Styles.createAnimatedViewStyle({width:this._ribbonAnimatedWidthValue}),this._stageReactionsAnimatedOpacityValue=new s.Animated.Value(1),this._stageReactionsAnimatedStyle=s.Styles.createAnimatedViewStyle({opacity:this._stageReactionsAnimatedOpacityValue}),this._suppressElementAnimation=!1,this._videoScalingMode={},this._screenshareScalingMode={},this._isVideoPreviewFloatingOnTop=!1,this._ribbonRightSideOffSetForVideoPreview=0,this._callReactionsDisplayHelper=new C.default,this._getRenderTargetViaKey=(e,t)=>{var i;const a=this._mountedRefsMap.ref(e);return a?null===(i=a.getVideoElement(t))||void 0===i?void 0:i.getVideoContainer():void 0},this._maybeUpdateRibbonVisibleElements=()=>{if(this.isComponentMounted()){const e=u.default.CallingStore.getRankedSpeakerMris(this.props.callId);if(this._latestVisibleRibbonCallItemKeys.length>0&&b.CallUIUtils.shouldReRenderVisibleRibbonItems(e,this._latestVisibleRibbonCallItemKeys,b.CallUIUtils.shouldRenderStage(this.state)?this.state.stageElements:[])){const e=ne.default.newCauseId();V.log(k.LogTraceArea.CallingUI,"CallStageView._maybeUpdateRibbonVisibleElements updating causeId: "+e),this._updateElementLayout(!1,this.state,this.props,e)}}},this._resizeVideoPreviewFromKeyboard=(e,t)=>{const i=this._layoutControllerForLocalUser(),a=b.CallUIUtils.renderVideoPreview(this.state,this.props),n=this._ribbonItemHeight(this.state,!0,!0,!1);if(i&&i.getUIPosition&&this.props.enableFloatableResizableVideoPreview&&a&&i.getUIPosition()===_.CallingViewUIPostion.Ribbon){const e=Math.min(this.props.availableRibbonWidth-3*n,this.props.viewRect.width/2);if(i.viewRect&&i.setResizeFactor&&i.getResizeFactor){const t=i.viewRect(!0),a=e/n*t.height/t.width,o=b.CallUIUtils.getNextScaleFactor(i.getResizeFactor(),a,2);return i.setResizeFactor(o),this._updateElementLayout(!1,this.state,this.props,"_resizeVideoPreviewFromKeyBoard"),!0}}return!1},this._getCurrentCallPanelHeaderLayout=e=>e?e.callPanelHeaderLayout:this.props.callPanelHeaderLayout,this._shouldShowRibbonModeSelector=(e,t)=>{const i=t?t.showRibbonExtras:this.props.showRibbonExtras;return!(t?t.useMobileControls:this.props.useMobileControls)&&i},this._updateElementLink=(e,t,i,a,n,o,s)=>{V.log(k.LogTraceArea.CallingUI,"CallStageView._updateElementLink causeId: "+n);const r="video_"+e;if(this._mappedRefs[r]!==t){if(this.props.enableFloatableResizableVideoPreview?(t||!t&&this._mappedRefs[r]===i)&&(this._mappedRefs[r]=t):this._mappedRefs[r]=t,!t){if(!this.props.enableFloatableResizableVideoPreview)return;if(r!==oe)return}r===oe?this._updateLocalVideoLink(n,s,!!t,i):this._updateRemoteVideoLink(e,this.state.allCallElements[e],n,s)}},this._updateBackgorundBlurCapabilityForAndroid=()=>{0},this._onStageElementTap=(e,t)=>{if(this._suppressElementAnimation)return void V.log(k.LogTraceArea.CallingUI,"CallStageView._onStageElementTap ignored, layout animations suppressed");const i=this.state.useImmersiveMode&&this.state.enableImmersiveMode;this.props.onStageTap?(this.props.onStageTap(t),i&&te.default.setTimeout(()=>{this.isComponentMounted()&&this.state.useImmersiveMode&&this._onToggleImmersiveMode()},750)):i&&this._onToggleImmersiveMode()},this._onRibbonElementTap=e=>{if(this._suppressElementAnimation)return V.log(k.LogTraceArea.CallingUI,"CallStageView._onRibbonElementTap ignored, layout animations suppressed"),!1;const t=ne.default.newCauseId();return V.log(k.LogTraceArea.CallingUI,"CallStageView._onRibbonElementTap causeId: "+t),!n.includes(this.state.stageElements,e)&&(y.default.setStageMode(this.props.callId,_.StageMode.Manual,t),this._moveCallElement(e,!0,this.state.stageElements.length),!0)},this._onScreenshareTap=e=>{if(this._suppressElementAnimation)return V.log(k.LogTraceArea.CallingUI,"CallStageView._onScreenshareTap ignored, layout animations suppressed"),!1;const t=ne.default.newCauseId();return V.log(k.LogTraceArea.CallingUI,"CallStageView._onScreenshareTap causeId: "+t),!n.includes(this.state.stageElements,e)&&(this._changeCallLayoutCommand.execute(_.StageMode.FocusedScreenShare),!0)},this._onRemainderViewRef=e=>{this._remainderView=e||void 0},this._onRemainderViewPressed=()=>{const e=ne.default.newCauseId();V.log(k.LogTraceArea.CallingUI,"CallStageView._onRemainderViewPressed causeId: "+e),this._suppressElementAnimation?V.log(k.LogTraceArea.CallingUI,"CallStageView._onRemainderViewPressed ignored, layout animations suppressed"):this.props.onRemainderViewPressed&&this.props.onRemainderViewPressed(e)},this._onAddToCallViewPressed=()=>{const e=ne.default.newCauseId();V.log(k.LogTraceArea.CallingUI,"CallStageView._onAddToCallViewPressed causeId: "+e),this._suppressElementAnimation?V.log(k.LogTraceArea.CallingUI,"CallStageView._onAddToCallViewPressed ignored, layout animations suppressed"):this.props.onAddToCallPressed&&this.props.onAddToCallPressed(e,k.NavigationAddToCallOrigin.Ribbon)},this._onElementMouseOverOrOut=(e,t,i)=>{if(t&&i){if(!e)return void V.warn(k.LogTraceArea.Calling,"CallStageView._onElementMouseOverOrOut:key is empty");d.default.setHoveringParticipantConfig({key:e,source:_.HoveringParticipantSource.Participant})}else d.default.clearHoveringParticipantConfig(_.HoveringParticipantSource.Participant)},this._onDoubleTap=e=>{this.state.enableImmersiveMode?this._onToggleImmersiveMode():this.state.enableTapToMoveCallParticipant&&this._onToggleParticipantFocus(e)},this._onElementPressInOrOut=(e,t,i)=>{this.state.enableImmersiveMode||this._onPresentDropTargets(e,t,i)},this._onPresentDropTargets=(e,t,i)=>{if(i)if(t){const t=this._stageDropTarget(),i={key:e,dropTargetViewRect:t.rect,showDropTarget:!0,toStage:!0,targetStagePosition:t.targetPosition,confirmOnly:t.confirmOnly};d.default.setDraggingParticipantConfig(i)}else{const t=this.props.topInset||0,i={key:e,dropTargetViewRect:this._ribbonDropTarget(t),showDropTarget:!0,toStage:!1,topPadding:t};d.default.setDraggingParticipantConfig(i)}else this._layoutController.getParticipantDragState()!==_.ParticipantDragState.Move&&d.default.setDraggingParticipantConfig(void 0)},this._onElementScalingModeChanged=(e,t,i,n)=>{const o=ne.default.newCauseId();V.log(k.LogTraceArea.CallingUI,"CallStageView._onElementScalingModeChanged key: "+a.pii.Omit(e)+" scalingMode: "+i+" causeId: "+o);const s=t===r.StreamType.ScreenSharing?this._screenshareScalingMode:this._videoScalingMode,l=s[e];if(s[e]=i,I.isMri(e))u.default.RemoteStreamHelper.setScalingMode(this.props.callId,e,t,i,o,void 0,n).catch(t=>{V.warn(k.LogTraceArea.CallingUI,"CallStageView._onElementScalingModeChanged:Remote setScalingMode failed "+J.default.errorAsString(t)+" - reverting scalingMode to "+l+" causeId: "+o),s[e]=l});else if(e===_.CallStageElementKeys.localUserKey){let t=this._mappedRefs[oe];t&&u.default.CallingStore.setLocalVideoScalingMode(this.props.callId,t,i,o).then(t=>{t||(V.warn(k.LogTraceArea.CallingUI,"CallStageView._onElementScalingModeChanged:Local failed causeId: "+o),s[e]=l)})}else V.log(k.LogTraceArea.CallingUI,"CallStageView._onElementScalingModeChanged skipping for non-MRI "+a.pii.Omit(e))},this._onToggleImmersiveMode=()=>{const e=!this.state.useImmersiveMode;this.setState({useImmersiveMode:e})},this._onToggleParticipantFocus=e=>{if(this._suppressElementAnimation)return void V.log(k.LogTraceArea.CallingUI,"CallStageView._onParticipantDoubleTap ignored");const t=ne.default.newCauseId();V.log(k.LogTraceArea.CallingUI,"CallStageView._onToggleParticipantFocus causeId: "+t),this.state.focusedParticipant||u.default.OngoingCallService.setPreFocusStageParticipants(this.props.callId,n.clone(this.state.stageElements));const i=this.state.focusedParticipant!==e?e:void 0;let a;a=i?[i]:this.props.stageLayoutMode===_.StageMode.Manual?this._cleanseStageElements(u.default.OngoingCallService.getPreFocusStageParticipants(this.props.callId),this.state,t):this._getStageElementsForOnToggleParticipantUnfocus(),a&&!n.isEmpty(a)||(V.log(k.LogTraceArea.CallingUI,"CallStageView._onParticipantDoubleTap: No stageElements, falling back"),a=b.CallUIUtils.fallbackStageElements(this.state.renderedRemoteElementInfo,this.state.isProvidingVideo,this.props.baseStageMode)),this.setState({focusedParticipant:i,stageElements:a})},this._onRibbonBackdropPan=e=>{this._layoutController.onPan(void 0,!1,e,this.props.viewRect)},this._onStageElementPan=(e,t,i)=>{const a=this.state.stageElements.length>1;this._intOnElementPan(e,a,t,i)},this._onElementPan=(e,t,i)=>{n.includes([_.StageMode.Speaker,_.StageMode.TogetherMode,_.StageMode.LargeGrid],this.props.stageLayoutMode)&&e!==_.CallStageElementKeys.localUserKey||this._intOnElementPan(e,!0,t,i)},this._onElementResize=e=>{V.log(k.LogTraceArea.CallingUI,`CallStageView._onElementResize key ${e} `),this._updateElementLayout(!1,this.state,this.props,"onElementReSize")},this._intOnElementPan=(e,t,i,a)=>{if(i.isComplete&&!this.state.draggingElementKey)return;const n=this._draggingElementConfig(e,i,a),o=n.config,s=b.CallUIUtils.translateRect(a,this.props.viewRect.width),r={x:this.props.viewRect.x+(this.props.containerOffsetX||0),y:this.props.viewRect.y,width:this.props.viewRect.width,height:this.props.viewRect.height};let l=this._layoutController.onPan(e,t,i,r,s,this.state.useImmersiveMode);if(this.state.draggingElementKey===e&&(l=!0,this._layoutController.setParticipantDragState(_.ParticipantDragState.Move)),l)if(i.isComplete){const t=ne.default.newCauseId();V.log(k.LogTraceArea.CallingUI,"CallStageView._intOnElementPan, causeId:"+t),e===_.CallStageElementKeys.localUserKey&&f.default.updateCallTelemetry(this.props.callId,t,e=>e.moveOwnPreview()),0!==this._ribbonRightSideOffSetForVideoPreview&&(this._ribbonRightSideOffSetForVideoPreview=0,this._updateElementLayout(!1,this.state,this.props,"_draggingElementConfig")),o.selectDropTarget?(o.showDropTarget&&e===_.CallStageElementKeys.localUserKey&&f.default.updateCallTelemetry(this.props.callId,t,e=>e.dockOwnPreview()),this._moveCallElement(e,!!o.toStage,o.targetStagePosition)):d.default.setDraggingParticipantConfig(void 0),this._layoutController.resetParticipantDragState()}else this._topElement=e,n.changed&&d.default.setDraggingParticipantConfig(o)},this._layoutControllerForKey=e=>this._layoutController.controllerForKey(e),this._layoutControllerForLocalUser=()=>this._layoutControllerForKey(_.CallStageElementKeys.localUserKey),this._onInlineCallStageReactionsViewRef=e=>{this._callReactionsView=e||void 0},this._getCallReactionsDisplayHelper=()=>this._callReactionsDisplayHelper,this._onTextReactionPressed=()=>{if(this.props.onTextReactionPressed){const e=ne.default.newCauseId();V.log(k.LogTraceArea.CallingUI,"CallStageView._onTextReactionPressed, causeId: "+e),this.props.onTextReactionPressed(e)}},this._onCallParticipantNametagMouseEnter=(e,t)=>{d.default.setHoveringParticipantConfig({key:t,source:_.HoveringParticipantSource.Nametag})},this._onCallParticipantNametagMouseLeave=(e,t)=>{d.default.clearHoveringParticipantConfig(_.HoveringParticipantSource.Nametag)},this._onRibbonElementTapBinder=(e,t)=>this._onRibbonElementTap(e),this._onStageTapBinder=(e,t)=>this.props.onStageTap(t),this._getAnchorInfo=e=>{const t=H.default.isMyMri(e)?_.CallStageElementKeys.localUserKey:e;if(t!==_.CallStageElementKeys.localUserKey&&!n.has(this.state.allCallElements,t))return;const i=this._layoutControllerForKey(t);if(i){if(i.isHidden())return;if(i.viewRect)return this._anchorInfoForRect(i.viewRect(),i.isHidden())}},this._getAnchorInfoChanges=(e,t)=>{if(e!==_.CallStageElementKeys.localUserKey&&!n.has(this.state.allCallElements,e))return;const i=this._layoutControllerForKey(e);if(i&&i.onRectChanged){const e=e=>{t(this._anchorInfoForRect(e,i.isHidden()))};return i.onRectChanged(e)}},this._onElementStartDragging=e=>{this._callReactionsView&&this._callReactionsView.dismissReaction&&this._callReactionsView.dismissReaction(e)}}_buildState(e,t){let i,a,o={},s=[_.CallStageElementKeys.localUserKey],r={},p=[],g=[],C=[],m=this.state?this.state.renderedRemoteElementInfo:{},S={},f=!1,w=0;const T=e.stageLayoutMode,P=l.default.getS4LCMCFeatures(),M=b.CallUIUtils.isTogetherMode(T)||b.CallUIUtils.isLargeGrid(T),k=M?A.default.getNonVisibleInCallBotMris():A.default.getNonInteractiveInCallBotMris(),R=A.default.getCallAudienceBotMriFilter(),V=A.default.getCallGridViewBotMriFilter();let E,B,O=I.isThread(e.conversationMri);if(n.each(u.default.CallingStore.getRemoteCallMembers(e.callId),t=>{var i;const a=u.default.CallingStore.getRemoteCallMemberMri(e.callId,t);if(M&&(b.CallUIUtils.isTogetherMode(T)&&n.includes(R,a)||b.CallUIUtils.isLargeGrid(T)&&n.includes(V,a))&&(E=a),b.CallUIUtils.shouldRenderParticipant(e.callId,t,a,k)){w++;const i=b.CallUIUtils.elementInfoForParticipantOrScreenshare(a,a,e.callId,t,m[a],O,void 0,this._getRenderTargetViaKey);S[a]=i,s.push(a),r[a]=h.default.isParticipantTalking(t);const o=_.VideoStatus.Available===i.videoStatus||_.VideoStatus.Streaming===i.videoStatus;f=f||!i.isScreensharing&&o||P.keepScreenShareWhenDisableVideo&&!!i.isScreensharing&&o,o&&p.push(a);const l=S[a].participantState;!n.isUndefined(l)&&h.default.isParticipantStateConnected(l)&&g.push(a)}h.default.isParticipantRinging(t)&&C.push(a),P.enableMultipleStreamSupport?n.each(null===(i=t.endpoints)||void 0===i?void 0:i.endpointDetails,e=>{const i=a+"_"+e.endpointId;o[i]={endpointId:e.endpointId,mri:a,participantState:t.state}}):o[a]={mri:a,participantState:t.state}}),u.default.CallScreenShareStore.isActive(e.callId)){const t=u.default.CallScreenShareStore.getRemoteScreenShareParticipant(e.callId);if(t){const n=u.default.CallingStore.getRemoteCallMemberMri(e.callId,t);B=n,a="ss_"+n;const r=b.CallUIUtils.elementInfoForParticipantOrScreenshare(a,n,e.callId,t,m[a],!1,n,this._getRenderTargetViaKey);S[a]=r,s.push(a),o[a]={mri:n,participantState:t.state,isScreenShare:!0},i=r}else B=H.default.getSkypeMri()}let D={allCallElements:o,screenshareElementInfo:i,ringingParticipants:C,remoteCallMemberCount:w,renderedRemoteElementInfo:S,enableNewIncomingVideoSound:P.enableNewIncomingVideoSound,isOneOnOneConversation:I.isOneOnOneConversation(e.conversationMri),mobilePreviewPercentage:P.mobilePreviewPercentage,bottomSafeAreaInset:Q.default.bottomSafeAreaInset(10),anyVideoOrScreensharing:!!i||f,enableImmersiveMode:e.useMobileControls,isProvidingVideo:u.default.CallingStore.isProvidingVideo(e.callId),isMuted:b.CallUIUtils.isLocalOrServerMuted(e.callId),isHandRaised:u.default.CallingStore.isHandRaisedForCurrentUserMri(e.callId),isCallCreator:u.default.CallingStore.isCallCreator(e.callId),callCreator:u.default.CallingStore.getCallCreator(e.callId),draggingElementKey:d.default.getCurrentDraggingParticipantKey(),enableLayoutAnimation:b.CallUIUtils.enableLayoutAnimation(),enableAddToCallRibbonItem:!e.useMobileControls&&u.default.CallingFeaturesHelper.allowAddToCall(e),enableAddToCallCoachmark:!e.useMobileControls&&P.enableAddToCallRibbonCoachMark,isFullscreenBotCall:M,showChangeTogetherModeBackgroundOption:z.ChangeTogetherModeBackgroundCommand.canExecute(e.callId,e.conversationMri),enableTapToMoveCallParticipant:P.enableTapToMoveCallParticipant,enableMultiGradientOverlay:P.enableMultiGradientOverlay,enableTapToFlipCamera:P.enableNewCameraFlipFlow&&!P.enableTapToMoveCallParticipant&&e.useMobileControls&&!q.default.isMobileScreenReaderEnabled(),localVideoDimension:u.default.CallingStore.getLocalVideoStreamSize(e.callId),isCallVisible:v.default.isCallVisible(e.callId),isNavigatingWithKeyboard:L.default.isNavigatingWithKeyboard(),isMeetNow:U.MeetNowHelpers.isMeetNowConversation(e.conversationMri),connectedParticipants:g,disableVideosInRibbon:P.disableVideosInRibbon,nonInteractiveInCallBotMris:A.default.getNonInteractiveInCallBotMris(),checkRaisedHandForReordering:P.enableReorderingParticipantsRaiseHand,screensharingUserMri:B,enableNewLayoutPicker:P.enableNewLayoutPicker,onlyVideoParticipantsOnStage:y.default.getOnlyVideoOnTheStage(e.callId)};const x={isPSTNCall:u.default.CallingStore.isPSTNCall(e.callId),isEncryptedCall:I.isEncryptedThread(e.conversationMri),conversationMri:e.conversationMri,callId:e.callId};if(this._changeCallLayoutCommand=new c.ChangeCallLayoutCommand(x,e.isIncomingOrOutgoingRing,T),t)D.useImmersiveMode=!1,D.ribbonHidden=!1,T===_.StageMode.Manual?D.stageElements=u.default.OngoingCallService.getStageParticipants(e.callId):D.stageElements=a?[a]:E?[E]:[],D.focusedParticipant=u.default.OngoingCallService.getFocusedParticipant(e.callId);else{let t;this._isVideoPreviewFloatingOnTop=e.enableFloatableResizableVideoPreview&&this._isVideoPreviewFloatingOnTop&&this.state.isProvidingVideo;const i=a&&!!this.state&&!b.CallUIUtils.screenShareKey(this.state);let o=i?void 0:this.state.focusedParticipant;const r=D.onlyVideoParticipantsOnStage?p:g;if(n.isEmpty(g)||u.default.OngoingCallService.getHasConnectedParticipantsEdge(e.callId)){const l=b.CallUIUtils.isInIncomingScreenshareMode(T)||i;if(o)n.includes(s,o)?t=this.state.stageElements:(o=void 0,t=T===_.StageMode.Manual?u.default.OngoingCallService.getPreFocusStageParticipants(e.callId):r);else if(l&&a)t=[a];else if(T===_.StageMode.Speaker){const i=this.state.stageElements[0],a=u.default.CallingStore.getTopSpeakerMri(e.callId);t=n.compact([a||i])}else if(M&&E)t=[E];else if(t=[],T===_.StageMode.Manual){t=u.default.OngoingCallService.getStagedParticipantsSelection(e.callId)||this.state.stageElements}else{const i=u.default.OngoingCallService.getStagedParticipantsSelection(e.callId);let o=[];n.isEmpty(i)||(o=n.filter(i,e=>n.includes(s,e)),n.isEmpty(o)||(t=o)),n.isEmpty(t)&&(t=n.isEmpty(r)||a&&T!==_.StageMode.Grid?this.state.stageElements:r)}}else u.default.OngoingCallService.setHasConnectedParticipantsEdge(e.callId,!0),t=[];if(n.isEmpty(g)||(D.stageElements=this._cleanseStageElements(t,D,"buildState")),D.focusedParticipant=o,D.draggingElementKey&&D.draggingElementKey!==_.CallStageElementKeys.localUserKey){const e=n.keys(S);n.includes(e,D.draggingElementKey)||(D.draggingElementKey=void 0,this._topElement=void 0)}}n.isEmpty(g)&&(D.stageElements=b.CallUIUtils.fallbackStageElements(S,!!D.isProvidingVideo,e.baseStageMode)),n.each(r,(e,t)=>{const i=this._mountedRefsMap.ref(t);i&&i.updateTalking(e)});const N=this._getCurrentCallPanelHeaderLayout(e);return this._layoutController.setCallHeaderPanelLayout(N),D.ribbonType=N!==_.CallPanelHeaderLayout.Float||e.isDesktopMin?_.RibbonType.Small:_.RibbonType.Large,D.stageMode=e.baseStageMode,D}componentMounting(e){super.componentMounting(e),this._updateRibbonVerticalOffset(this.props.topInset||0,!1,this.props.stageLayoutMode)}componentDidMount(){super.componentDidMount();const e=ne.default.newCauseId();V.log(k.LogTraceArea.CallingUI,"CallStageView.componentDidMount causeId: "+e),this._updateElementLayout(!1,this.state,this.props,e),this._updateVideoLinks(e),this._callingStoreSubscriptionId=u.default.CallingStore.subscribe(this._maybeUpdateRibbonVisibleElements,this.props.callId),this.props.onStageChange&&this.props.onStageChange(this._localUserOnStage()),this.state.stageMode!==_.CallStageViewMode.None&&(V.log(k.LogTraceArea.CallingUI,"CallStageView.componentDidMount initiating startVideoSoundTimeout"),this._startVideoSoundTimeout=Date.now()),u.default.SpeakerViewTelemetryService.startTracking(this.props.callId),f.default.setHadOldCallStageEnabled(this.props.callId,e),this._layoutController.setElementsPositions(this.state.stageElements),this._registerKeyboardHandlers()}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this._suppressElementAnimation=!this.props.layoutAnimationEnabled,e.callId!==this.props.callId&&this._callingStoreSubscriptionId&&(u.default.CallingStore.unsubscribe(this._callingStoreSubscriptionId),this._callingStoreSubscriptionId=u.default.CallingStore.subscribe(this._maybeUpdateRibbonVisibleElements,e.callId)),this.state.ribbonHidden===t.ribbonHidden&&this.state.useImmersiveMode===t.useImmersiveMode||this._collapseOrExpandRibbon(t.ribbonHidden||t.useImmersiveMode,e.viewRect,!0);const a=this._layoutControllerForLocalUser(),o=this.props.viewRect.width!==e.viewRect.width||this.props.viewRect.x!==e.viewRect.x,s=this.state.isProvidingVideo!==t.isProvidingVideo;if(o||s){const i=ne.default.newCauseId();if(s&&a&&a.setResizeFactor&&a.setResizeFactor(1),this.props.enableFloatableResizableVideoPreview&&this._isVideoPreviewFloatingOnTop){const t=this._layoutControllerForLocalUser();t&&t.setFullStageRect&&t.setFullStageRect(e.viewRect)}this._updateElementLayout(!1,t,e,i)}this.props.enableFloatableResizableVideoPreview&&(n.includes(this.state.stageElements,_.CallStageElementKeys.localUserKey)&&this.props.onVideoPreviewFloating?(a&&a.setUIPosition&&a.setUIPosition(_.CallingViewUIPostion.Stage),this.props.onVideoPreviewFloating(!1,void 0),this._isVideoPreviewFloatingOnTop=!1):this._isVideoPreviewFloatingOnTop||a&&a.setUIPosition&&a.setResizeFactor&&(this.props.callPanelHeaderLayout===_.CallPanelHeaderLayout.Window?(a.setUIPosition(_.CallingViewUIPostion.RibbonWidowsMode),a.setResizeFactor(1)):a.setUIPosition(_.CallingViewUIPostion.Ribbon))),this.props.topInset!==e.topInset&&this._updateRibbonVerticalOffset(e.topInset||0,!1,e.stageLayoutMode);let r=u.default.OngoingCallService.getStagedParticipantsSelection(this.props.callId);if(r&&t.connectedParticipants.length!==this.state.connectedParticipants.length){const e=n.difference(t.connectedParticipants,this.state.connectedParticipants);t.connectedParticipants.length>this.state.connectedParticipants.length?r=r.concat(e):n.pullAll(r,e),u.default.OngoingCallService.setStagedParticipantsSelection(this.props.callId,r)}}_getRibbonBackdropContainerHeightStyle(e,t){return s.Styles.createViewStyle({height:this._getBackdropContainerHeight(e,t)},!1)}_getHeaderBackdropContainerHeightStyle(e,t){return s.Styles.createViewStyle({height:this._getBackdropContainerHeight(e,t)+15},!1)}_getBackdropContainerHeight(e,t){return(t===_.RibbonType.Large?_.RibbonSizes.ribbonItemSizeLarge:_.RibbonSizes.ribbonItemSizeSmall)+b.CallUIUtils.getRibbonItemTopMargin(e)}_registerKeyboardHandlers(){B.default.addHandler(k.KeyboardShortcut.ResizeVideoPreview,this._resizeVideoPreviewFromKeyboard)}_unregisterKeyboardHandlers(){B.default.removeHandler(k.KeyboardShortcut.ResizeVideoPreview,this._resizeVideoPreviewFromKeyboard)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=ne.default.newCauseId();V.log(k.LogTraceArea.CallingUI,"CallStageView.componentDidUpdate causeId: "+a),this._updateElementLayout(!this._suppressElementAnimation,this.state,this.props,a),this._updateVideoLinks(a,t),this._startVideoSoundTimeout||t.stageMode!==_.CallStageViewMode.None||this.state.stageMode===_.CallStageViewMode.None||(V.log(k.LogTraceArea.CallingUI,"CallStageView: initiating startVideoSoundTimeout"),this._startVideoSoundTimeout=Date.now());const o=this._isDragging(this.state);o!==this._isDragging(t)&&(this.props.onDragChange&&this.props.onDragChange(o),this.state.draggingElementKey&&this._onElementStartDragging(this.state.draggingElementKey)),this.state.focusedParticipant!==t.focusedParticipant&&(this.state.focusedParticipant||u.default.OngoingCallService.setPreFocusStageParticipants(this.props.callId,[]),u.default.OngoingCallService.setFocusedParticipant(this.props.callId,this.state.focusedParticipant)),this.props.onStageChange&&this.props.onStageChange(this._localUserOnStage()),u.default.OngoingCallService.setStageParticipants(this.props.callId,this.state.stageElements),this.state.stageMode!==t.stageMode&&d.default.setDraggingParticipantConfig(void 0),this.state.useImmersiveMode!==t.useImmersiveMode&&this.props.onUseImmersiveModeChange(this.state.useImmersiveMode),this._suppressElementAnimation=!this.props.layoutAnimationEnabled,!t.anyVideoOrScreensharing&&this.state.anyVideoOrScreensharing&&this._maybePlayVideoAvailableSound(a);const s=!!this.state.screenshareElementInfo;if(s!==!!t.screenshareElementInfo){const e=this.state.screenshareElementInfo||t.screenshareElementInfo;this._announceScreensharingForAccessibility(s,e)}const r=b.CallUIUtils.shouldRenderStage(this.state)?this.state.stageElements:[],l=this._draggingElementKey();if(!n.includes(r,_.CallStageElementKeys.localUserKey)&&l!==_.CallStageElementKeys.localUserKey){const e=this._elementRenderInfo(_.CallStageElementKeys.localUserKey),t=!this.state.ribbonHidden;if(e&&this.props.enableFloatableResizableVideoPreview&&this.props.onVideoPreviewFloating){const i=this.state.isProvidingVideo,a=i&&!this.props.enableNewCallScreen?this._renderCallElementView(e,!0,this.state.enableTapToMoveCallParticipant,t):void 0;this.props.onVideoPreviewFloating(i,a)}}let c=this.state.stageElements;this._topElement&&n.includes(c,this._topElement)&&(c=n.without(c,this._topElement),c.push(this._topElement)),this._layoutController.setElementsPositions(c)}_announceScreensharingForAccessibility(e,t){if(!t)return;const i=h.default.extractMriFromKey(t.key),a=ae.default.getFullUserProfileByMriNoSubscription(i),n=e?"AccessibilityLabel.RemoteScreenShareStarted":"AccessibilityLabel.RemoteScreenShareStopped";X.default.maybeAnnounceForAccessibility(N.getString(n,{gender:x.getLocalizeParamForGender(a.gender),userName:M.default.getDisplayName(i)||""}))}_maybePlayVideoAvailableSound(e){const t=e=>{if(this.props.isRoutedToEarpiece&&this.isComponentMounted()){V.log(k.LogTraceArea.CallingUI,"CallStageView._maybePlayVideoAvailableSound playing sound - causeId: "+e),(this.state.enableNewIncomingVideoSound?$.default.SkypeIncomingVideoAvailable:$.default.SkypeNotification).playOnce(e)}};if(!this._startVideoSoundTimeout)return void V.warn(k.LogTraceArea.CallingUI,"CallStageView._maybePlayVideoAvailableSound requested to play sound too soon - causeId: "+e);const i=this._startVideoSoundTimeout+5e3-Date.now();i>0?this._soundDelayTimer?V.log(k.LogTraceArea.CallingUI,"CallStageView._maybePlayVideoAvailableSound already pending - causeId: "+e):(this._soundDelayTimer=te.default.setTimeout(()=>t(e),i),V.log(k.LogTraceArea.CallingUI,"CallStageView._maybePlayVideoAvailableSound delaying for "+i+"ms - causeId: "+e)):t(e)}componentWillUnmount(){super.componentWillUnmount();const e=ne.default.newCauseId();V.log(k.LogTraceArea.CallingUI,"CallStageView.componentWillUnmount causeId: "+e),this._callingStoreSubscriptionId&&(u.default.CallingStore.unsubscribe(this._callingStoreSubscriptionId),this._callingStoreSubscriptionId=void 0),u.default.CallingStore.isCallConnected(this.props.callId)?V.log(k.LogTraceArea.CallingUI,"CallStageView.componentWillUnmount: Call is still connected; leaving videos attached causeId: "+e):(V.log(k.LogTraceArea.CallingUI,"CallStageView.componentWillUnmount: Call is not connected; tearing down videos causeId: "+e),this._removeVideoLinks(e)),u.default.SpeakerViewTelemetryService.stopTracking(this.props.callId),this._unregisterKeyboardHandlers()}_collapseOrExpandRibbon(e,t,i){const a=e?0:1;this._stageReactionsAnimatedOpacityValue.setValue(e?0:1),this._layoutController.updateRibbonExpandedMultiplier(a,t,!0)}_localUserOnStage(){return b.CallUIUtils.shouldRenderStage(this.state)&&n.includes(this.state.stageElements,_.CallStageElementKeys.localUserKey)}_isDragging(e){return!!e.draggingElementKey}_updateElementLayout(e,t,i,a){if(V.log(k.LogTraceArea.CallingUI,"CallStageView._updateElementLayout causeId: "+a),0===i.viewRect.width||0===i.viewRect.height)return;const o=b.CallUIUtils.renderVideoPreview(t,i),s=b.CallUIUtils.shouldRenderStage(t)?t.stageElements:[],l=n.includes(s,_.CallStageElementKeys.localUserKey),c=n.size(s);let d;d=i.enableFloatableResizableVideoPreview?l||o&&this._isVideoPreviewFloatingOnTop?[]:[_.CallStageElementKeys.localUserKey]:l?[]:[_.CallStageElementKeys.localUserKey];const p=n.values(t.renderedRemoteElementInfo),g=u.default.CallingStore.getRankedSpeakerMris(i.callId);V.log(k.LogTraceArea.CallingUI,"CallStageView._updateElementLayout  causeId: "+a),n.each(p,e=>{const t=n.findIndex(g,t=>e.key===t);e.activeSpeakerRank=-1===t?Number.MAX_VALUE:t}),l&&p.push(this._localUserParticipantInfo);const C=p.sort((e,t)=>b.CallUIUtils.compareElementInfo(e,t,!!this.state.checkRaisedHandForReordering)),m=n.map(C,e=>e.key);d=d.concat(m);const S=!!t.ringingParticipants&&1===t.ringingParticipants.length,y=[];let f=0,v=_.RibbonExtraVisibility.None,w=_.RibbonExtraVisibility.None,T=!1,I=!1,P=!1;t.enableAddToCallRibbonItem&&i.showParticipantsButton&&(w=i.showRibbonExtras?_.RibbonExtraVisibility.Visible:_.RibbonExtraVisibility.Hidden),y.push.apply(y,n.map(d,(e,a)=>{const o={key:e,isScreenshare:e===b.CallUIUtils.screenShareKey(t),videoType:b.CallUIUtils.videoTypeForKey(e,t,i),videoAspectRatio:b.CallUIUtils.videoAspectRatioForKey(e,t,i),isLocal:_.CallStageElementKeys.localUserKey===e,isHostOfScreenshare:!!t.renderedRemoteElementInfo[e]&&t.renderedRemoteElementInfo[e].isScreensharing},l=n.indexOf(s,o.key);if(l>=0)o.stagePosition=l,o.participantRank=l,o.displayOnStage=!0,o.hidden=!1;else{o.ribbonPosition=f,o.participantRank=c+f,o.isHiddenBot=n.includes(A.default.getNonInteractiveInCallBotMris(),o.key),T=!!o.isLocal,I=b.CallUIUtils.renderVideoPreview(this.state,i),P=!0;const a=t.allCallElements[e],s=a?a.participantState:r.ParticipantState.None;h.default.isParticipantStateRinging(s)?o.hidden=!S:o.hidden=!1,f++}return o})),0!==this._latestVisibleRibbonCallItemKeys.length&&b.CallUIUtils.reorderLayoutInfoViaLeastVisibleItemSwaping(y,this._latestVisibleRibbonCallItemKeys);const M=this._ribbonItemHeight(t,T,I,P),R=this._shouldUseMobilePreviewPercentage(T,I,P)&&i.isLandscape,E=M,L=!!n.find(d,e=>e===_.CallStageElementKeys.localUserKey);if(i.enableFloatableResizableVideoPreview&&o&&L){const e=i.availableRibbonWidth-3*M,t=this._layoutControllerForLocalUser();if(t&&t.viewRect&&t.setResizeFactor){const i=t.viewRect(!0);if(e<=i.width&&t.getResizeFactor){const a=t.getResizeFactor(),n=e/i.width*a;t.setResizeFactor(Math.max(n,1))}}}const B=this._layoutController.updateLayoutInfo(y,b.CallUIUtils.adjustedStageViewRect(i),M,E,!1,i.availableRibbonWidth,v,w,i.useMobileControls?1:2,e,R,this._ribbonRightSideOffSetForVideoPreview,!1,this.state.enableNewLayoutPicker?_.LayoutPickerButtonWidth:void 0),O=n.filter(d,e=>this._layoutController.controllerForKey(e).isHidden());this._latestVisibleRibbonCallItemKeys=b.CallUIUtils.getVisibleSwapableRibbonItemKeys(y,O),V.log(k.LogTraceArea.CallingUI,"CallStageView._updateElementLayout  causeId: ' + "+a),y.push({key:_.CallStageElementKeys.remainderViewKey,ribbonPosition:f}),f++,t.enableAddToCallRibbonItem&&(y.push({key:_.CallStageElementKeys.addToCallViewKey,ribbonPosition:f}),f++),i.useMobileControls||(v=this._shouldShowRibbonModeSelector(t,i)?_.RibbonExtraVisibility.Visible:_.RibbonExtraVisibility.Hidden,y.push({key:_.CallStageElementKeys.ribbonModeViewKey,ribbonPosition:f}),f++),this._updateRibbonVerticalOffset(i.topInset||0,!0,i.stageLayoutMode);const D=t.ribbonHidden?0:Math.min(this._layoutController.ribbonWidth(),i.viewRect.width);this._ribbonAnimatedWidthValue.setValue(D);const x=n.sortBy(y,e=>e.participantRank),N=n.map(x,e=>e.key);u.default.CallingStore.setRemoteVideoPriorityOrder(i.callId,n.without(N,_.CallStageElementKeys.localUserKey,_.CallStageElementKeys.remainderViewKey,_.CallStageElementKeys.ribbonModeViewKey,_.CallStageElementKeys.addToCallViewKey),a),this._remainderView&&this._remainderView.showRemainder(B,!n.isEmpty(t.ringingParticipants))}_updateVideoLinks(e,t){V.log(k.LogTraceArea.CallingUI,"CallStageView._updateVideoLinks causeId: "+e),!t||t.isProvidingVideo===this.state.isProvidingVideo&&t.ribbonHidden===this.state.ribbonHidden?V.log(k.LogTraceArea.CallingUI,"CallStageView._updateVideoLinks ignored due to no state change causeId: "+e):this._updateLocalVideoLink(e,()=>{},this.state.isProvidingVideo);const i=n.clone(this.state.allCallElements);if(t){const e=b.CallUIUtils.screenShareKey(this.state),a=b.CallUIUtils.screenShareKey(t);a&&a!==e&&(i[a]=t.allCallElements[a])}n.each(i,(t,i)=>this._updateRemoteVideoLink(i,t,e))}_updateLocalVideoLink(e,t,i,a){if(V.log(k.LogTraceArea.CallingUI,"CallStageView._updateLocalVideoLink causeId: "+e),this.state.isProvidingVideo&&!this.state.ribbonHidden&&this.props.isVideoTarget||(this._mappedRefs[oe]=void 0),this.props.isVideoTarget&&(!this.state.ribbonHidden||!this.state.isProvidingVideo)){let o=this._mappedRefs[oe];this._mappedVideos[_.CallStageElementKeys.localUserKey]!==o&&(o?this._mappedVideos[_.CallStageElementKeys.localUserKey]=o:delete this._mappedVideos[_.CallStageElementKeys.localUserKey]);const s=this._videoScalingMode[oe]||r.ScalingMode.Crop,l=this.props.enableFloatableResizableVideoPreview&&!n.isUndefined(a)?a:o;u.default.CallingStore.setLocalVideoTarget(this.props.callId,!!i,l,{scalingMode:s,transparent:!1},e).then(this._updateBackgorundBlurCapabilityForAndroid).finally(()=>{t&&t()})}}_updateRemoteVideoLink(e,t,i,o){if(!t)return;const s=t.mri,l=t.endpointId,c=n.startsWith(e,"ss_")?r.StreamType.ScreenSharing:r.StreamType.Video,d=u.default.RemoteStreamHelper.isStreamAvailable(this.props.callId,s,c,l),h=this.state.disableVideosInRibbon&&b.CallUIUtils.isInGridStageMode(this.props.stageLayoutMode)&&!n.includes(this.state.stageElements,t.mri),p=this.state.isFullscreenBotCall&&!n.includes(this.state.stageElements,t.mri);(!this.props.isVideoTarget||!d||!b.CallUIUtils.shouldRenderParticipantState(t.participantState)||h||p&&c===r.StreamType.Video)&&(this._mappedRefs["video_"+e]=void 0);const g=this._mappedRefs["video_"+e];if(!this._mappedVideos[e]&&!g)return void(d&&(e===b.CallUIUtils.screenShareKey(this.state)?V.warn(k.LogTraceArea.CallingUI,"CallStageView._updateRemoteVideoLink "+j.mriOrId(s)+" is screensharing but no mapped view found"):V.warn(k.LogTraceArea.CallingUI,"CallStageView._updateRemoteVideoLink "+j.mriOrId(s)+" is streaming video but no mapped view found")));const C=u.default.RemoteStreamHelper.isStreamRenderingForTarget(this.props.callId,s,c,g),m=u.default.RemoteStreamHelper.isRemoteStreamInTransitState(this.props.callId,s,c);if(V.log(k.LogTraceArea.CallingUI,"CallStageView._updateRemoteVideoLink "+j.mriOrId(s)+" renderTargetChanged "+(this._mappedVideos[e]!==g)+" streamNotRendering "+!C+" streamNotAtTransitState "+!m),this._mappedVideos[e]!==g||!C&&!m){g?this._mappedVideos[e]=g:delete this._mappedVideos[e];const n=t.isScreenShare?r.StreamType.ScreenSharing:r.StreamType.Video,c=(n===r.StreamType.ScreenSharing?this._screenshareScalingMode:this._videoScalingMode)[s]||r.ScalingMode.Fit;if(g){const t=w.CallingCapabilities.directReparentingSupported()?u.default.RemoteStreamHelper.getRemoteStreamRenderer(this.props.callId,s,n):void 0;u.default.RemoteStreamHelper.startRemoteStream(this.props.callId,s,"CallStageView._updateRemoteVideoLink",n,g,{scalingMode:c,transparent:!1,rendererTobeReparented:t,disposeRendererWhenStreamisNotAvailable:()=>!1},i,[],l).catch(t=>{V.warn(k.LogTraceArea.CallingUI,"CallStageView._updateRemoteVideoLink key: "+a.pii.Omit(e)+" failed "+J.default.errorAsString(t)+" causeId: "+i),delete this._mappedVideos[e]}).finally(()=>{o&&o()})}else{if(!this.props.isVideoTarget&&w.CallingCapabilities.directReparentingSupported())return void V.log(k.LogTraceArea.CallingUI,"CallStageView._updateVideoLinks skipped stopRemoteStream  due to isVideoTarget "+this.props.isVideoTarget+" and directRepartingSupported "+i);u.default.RemoteStreamHelper.stopRemoteStream(this.props.callId,s,"CallStageView._updateRemoteVideoLink",n,i,l)}}}_removeVideoLinks(e){V.log(k.LogTraceArea.CallingUI,"CallStageView._removeVideoLinks causeId: "+e),n.each(this._mappedVideos,(t,i)=>{if(i===_.CallStageElementKeys.localUserKey)u.default.CallingStore.setLocalVideoTarget(this.props.callId,!1,void 0,void 0,e);else{const t=n.startsWith(i,"ss_")?i.substr("ss_".length):i;u.default.RemoteStreamHelper.stopRemoteStream(this.props.callId,t,"CallStageView._removeVideoLinks",r.StreamType.Video,e)}})}_updateRibbonVerticalOffset(e,t,i){const a=Math.max(b.CallUIUtils.getRibbonItemTopMargin(i),e);this._layoutController.updateRibbonVerticalOffset(a,t)}_getStageElementsForOnToggleParticipantUnfocus(){const e=n.keys(this.state.renderedRemoteElementInfo);return this.state.onlyVideoParticipantsOnStage?n.filter(e,e=>e!==_.CallStageElementKeys.localUserKey&&u.default.RemoteStreamHelper.isStreamRenderingForTarget(this.props.callId,e,r.StreamType.Video,this._getRenderTargetViaKey(e))):n.filter(e,e=>e!==_.CallStageElementKeys.localUserKey)}_cleanseStageElements(e,t,i){const a=t||this.state,o=n.keys(a.renderedRemoteElementInfo);a.isFullscreenBotCall||o.push(_.CallStageElementKeys.localUserKey);let s=n.intersection(e,o);const r=this._layoutController.getMaxNumberOfStageElements();return s.length>r&&(s=n.takeRight(s,r)),s&&!n.isEmpty(s)||(V.log(k.LogTraceArea.CallingUI,"CallStageView._cleanseStageElements: No renderedStageElements, falling back (renderedElements:"+o.length+"; currentStageElements:"+e.length+")  causeId:"+i),s=b.CallUIUtils.fallbackStageElements(a.renderedRemoteElementInfo||{},!!a.isProvidingVideo,this.props.baseStageMode)),s||[]}_ribbonDropTargetHeight(){return this.state.ribbonType===_.RibbonType.Small?_.RibbonSizes.ribbonDropTargetSmallHeight:_.RibbonSizes.ribbonDropTargetLargeHeight}_draggingElementConfig(e,t,i){const a=d.default.dangerouslyGetCurrentDraggingParticipantConfig(),o=this.props.enableFloatableResizableVideoPreview,s=e===_.CallStageElementKeys.localUserKey,r=o&&s&&this._isVideoPreviewFloatingOnTop;let l=!n.includes(this.state.stageElements,e)&&!r;const c=this._ribbonRightSideOffSetForVideoPreview,u=this._ribbonDropTargetHeight()+(this.props.topInset||0);let h=!1;const p=t.pageX-this.props.viewRect.x,g=t.pageY-this.props.viewRect.y;let C;h=a&&a.showCancel||l&&g>u,h&&l&&g<u&&(l=!1);let m,S=-1,y=!1;if(l){const e=this._stageDropTarget();C=e.rect,S=e.targetPosition,y=e.confirmOnly}else C=o&&r&&i?this._ribbonDropTargetForVideoPreview(this.props.topInset||0,this._ribbonItemHeight(this.state),i):this._ribbonDropTarget(this.props.topInset||0);if(l)if(o&&s)m=g>=u;else{const e=p<=C.width&&p>=0,t=g<=C.height&&g>=0;m=e&&t}else m=o&&s&&i?g<i.height&&p>this.props.viewRect.width-i.width:g<u;const f=l?0:this.props.topInset||0,b=!(o&&s&&!n.includes(this.state.stageElements,_.CallStageElementKeys.localUserKey))||r&&m;return V.log(k.LogTraceArea.CallingUI,"_draggingElementConfig showDropTarget "+b),o&&(this._ribbonRightSideOffSetForVideoPreview=i&&r&&m?C.width+_.RibbonSizes.ribbonItemMargin:0),c!==this._ribbonRightSideOffSetForVideoPreview&&(0!==this._ribbonRightSideOffSetForVideoPreview?this._updateElementLayout(!1,this.state,this.props,"_draggingElementConfig"):te.default.sleep(300).then(()=>this._updateElementLayout(!1,this.state,this.props,"_draggingElementConfig"))),a&&a.toStage===l&&a.showDropTarget===b&&a.selectDropTarget===m&&a.targetStagePosition===S&&a.showCancel===h&&a.confirmOnly===y&&a.topPadding===f&&E.default(a.dropTargetViewRect,C)&&a.isVideoPreviewAndFloatingOnTop===r?{config:a,changed:!1}:{config:{key:e,dropTargetViewRect:C,showDropTarget:b,selectDropTarget:m,toStage:l,targetStagePosition:S,showCancel:h,confirmOnly:y,topPadding:f,isVideoPreviewAndFloatingOnTop:r},changed:!0}}_stageDropTarget(){return{rect:b.CallUIUtils.adjustedStageViewBounds(this.props),targetPosition:this.state.stageElements.length,confirmOnly:0===this.state.stageElements.length}}_ribbonDropTarget(e){return{x:0,y:0,width:this.props.viewRect.width,height:this._ribbonDropTargetHeight()+e}}_ribbonDropTargetForVideoPreview(e,t,i){return{x:this.props.viewRect.width-t*i.width/i.height-_.RibbonSizes.ribbonItemMargin,y:b.CallUIUtils.getRibbonItemTopMargin(this.props.stageLayoutMode),width:t*i.width/i.height,height:t+e}}_moveCallElement(e,t,i){const o=ne.default.newCauseId();V.log(k.LogTraceArea.CallingUI,"CallStageView._moveCallElement: "+a.pii.Omit(e)+" toStage: "+t+" causeId: "+o);const s=n.includes(this.state.stageElements,e),r=this.props.enableFloatableResizableVideoPreview;if(t===s&&e!==_.CallStageElementKeys.localUserKey)return void d.default.setDraggingParticipantConfig(void 0);let l=n.clone(this.state.stageElements);const c=this._layoutControllerForLocalUser(),h=this._layoutController.getMaxNumberOfStageElements();t?(r&&e===_.CallStageElementKeys.localUserKey?(this._isVideoPreviewFloatingOnTop=!0,c&&c.setUIPosition&&c.setUIPosition(_.CallingViewUIPostion.FloatingOnTop)):(l.length>=h&&(l=n.dropRight(l)),l.push(e)),V.log(k.LogTraceArea.CallingUI,"CallStageView._moveCallElement toStage success: "+a.pii.Omit(e)+" causeId: "+o),f.default.updateCallTelemetry(this.props.callId,o,t=>e===_.CallStageElementKeys.localUserKey?t.moveSelfToStage():t.moveParticipantToStage())):(r&&e===_.CallStageElementKeys.localUserKey&&!n.includes(this.state.stageElements,_.CallStageElementKeys.localUserKey)?(this._isVideoPreviewFloatingOnTop=!1,c&&c.setUIPosition&&c.setResizeFactor&&(this.props.callPanelHeaderLayout===_.CallPanelHeaderLayout.Window?c.setUIPosition(_.CallingViewUIPostion.RibbonWidowsMode):c.setUIPosition(_.CallingViewUIPostion.Ribbon),c.setResizeFactor(1))):(l=n.without(l,e),this._updateRibbonAddTime(e,b.CallUIUtils.nextRibbonAddTime())),V.log(k.LogTraceArea.CallingUI,"CallStageView._moveCallElement toRibbon success: "+a.pii.Omit(e)+" causeId: "+o),f.default.updateCallTelemetry(this.props.callId,o,t=>e===_.CallStageElementKeys.localUserKey?t.moveSelfToRibbon():t.moveParticipantToRibbon())),this.props.enableFloatableResizableVideoPreview?e!==_.CallStageElementKeys.localUserKey&&(y.default.setStageMode(this.props.callId,_.StageMode.Manual,o),l=this._cleanseStageElements(l,this.state,o)):(y.default.setStageMode(this.props.callId,_.StageMode.Manual,o),l=this._cleanseStageElements(l,this.state,o)),u.default.OngoingCallService.setStagedParticipantsSelection(this.props.callId,l),this.setState({stageElements:l,focusedParticipant:void 0},()=>{d.default.setDraggingParticipantConfig(void 0)})}_updateRibbonAddTime(e,t){e!==_.CallStageElementKeys.localUserKey?this.state.renderedRemoteElementInfo[e]&&(this.state.renderedRemoteElementInfo[e].ribbonAddTime=t):this._localUserParticipantInfo.ribbonAddTime=t}_elementRenderInfo(e){if(e===_.CallStageElementKeys.localUserKey){const e=b.CallUIUtils.renderVideoPreview(this.state,this.props);return{renderKey:_.CallStageElementKeys.localUserKey,mri:H.default.getSkypeMri(),videoStatus:e?_.VideoStatus.Streaming:_.VideoStatus.None,videoDimensions:e?this.props.viewRect:b.DummyVideoSize,isAScreensharing:!1,isLocal:!0,isMuted:this.state.isMuted,isHandRaised:this.state.isHandRaised,streamsStatus:e?_.CallParticipantStreamsStatus.Single:_.CallParticipantStreamsStatus.None,streams:[{endpointId:_.CallStageElementKeys.localUserKey,videoStatus:e?_.VideoStatus.Streaming:_.VideoStatus.None,videoDimensions:e?this.props.viewRect:b.DummyVideoSize}]}}{const t=!this.props.enableNewCaptureActivityPip||this.props.isVideoTarget,i=this.state.renderedRemoteElementInfo[e];if(i)return{renderKey:e,mri:i.mri,isLocal:!1,videoStatus:t?i.videoStatus:_.VideoStatus.None,videoDimensions:t?i.videoDimensions:b.DummyVideoSize,isAScreensharing:i.isScreensharing,isScreenshareControlling:i.isScreenshareControlling,isRinging:i.isRinging,isOnHold:i.isOnHold,isMuted:i.isServerMuted,renderScreenShare:i.renderScreenShare,isPresenter:i.mri===this.state.screensharingUserMri,isHandRaised:i.isHandRaised,streamsStatus:i.streamsStatus,streams:i.streams}}}_getParticipantIconSize(e){const t=b.CallUIUtils.shouldRenderStage(this.state)&&n.includes(this.state.stageElements,e);let i=this._ribbonItemHeight(this.state);if(t)switch(this.state.stageElements.length){case 1:i=ie.UserIconSize.Size120;break;case 2:i=ie.UserIconSize.Size100}return i}_draggingElementKey(){return this.state.draggingElementKey}_getNameTagControlsHeight(){let e=70;return this.props.callControlsType===_.CallControlsType.DesktopMinSmallest&&(e=this.state.isMeetNow?160:140),e}_renderStage(){const e=[],t=n.size(this.state.stageElements);let i=this.state.stageElements;this._topElement&&n.includes(i,this._topElement)&&(i=n.without(this.state.stageElements,this._topElement),i.push(this._topElement));const a=n.map(i,e=>this._elementRenderInfo(e)),o=n.map(a,(e,i)=>this._renderStageParticipant(e,i,t));e.push.apply(e,o);const r=[se.stageContainerStyle];return this._getCurrentCallPanelHeaderLayout()===_.CallPanelHeaderLayout.Window&&r.push(se.windowTopOffsetStageContainerStyle),this._layoutController.shouldSwitchOrientation()&&r.push(se.modernStageLandscapeContainerStyle),s.createElement(s.View,{key:"callStage",style:r},e)}_shouldShowParticipantContextMenu(e){if(e.renderScreenShare||e.isLocal)return!1;if(!this.state.isFullscreenBotCall)return!0;return!(this.props.stageLayoutMode!==_.StageMode.TogetherMode)&&this.state.showChangeTogetherModeBackgroundOption}_renderStageParticipant(e,t,i){if(!e)return null;const a=this._draggingElementKey(),o=this.state.enableLayoutAnimation&&!this._suppressElementAnimation,r=e.isLocal;let l;(e.isMuted||e.isOnHold||e.isAScreensharing)&&(l=b.CallUIUtils.accessoryPosition(t,i,!!this.props.isLandscape));const c=b.CallUIUtils.nametagOffset(t,i,this._getNameTagControlsHeight(),!!this.props.isLandscape),d=!this.props.useMobileControls;d&&(c.offset=0),c&&void 0!==c.offset&&this.props.audioNotificationOffset&&(c.offset+=this.props.audioNotificationOffset);const u=a===e.renderKey,h=n.includes(this.state.nonInteractiveInCallBotMris,e.renderKey),p=e.renderScreenShare||this.state.isFullscreenBotCall||e.streamsStatus===_.CallParticipantStreamsStatus.Multiple;return s.createElement(g.CallParticipantView,{key:e.renderKey,ref:this._mountedRefsMap.onComponentRef(e.renderKey),callId:this.props.callId,conversationMri:this.props.conversationMri,nametagPosition:c,showContextMenu:this._shouldShowParticipantContextMenu(e)||r,showChangeTogetherModeBackgroundOption:this.state.showChangeTogetherModeBackgroundOption,renderKey:e.renderKey,renderInfo:e,isDragging:u,onUpdateElementLink:this._updateElementLink,iconOpacity:this.props.hideFullscreenIcon?0:1,onPan:this._onStageElementPan,onTap:this._onStageElementTap,onDoubleTap:this._onDoubleTap,onPressInOrOut:this._onElementPressInOrOut,onScalingModeChanged:this._onElementScalingModeChanged,getCallReactionsDisplayHelper:this._getCallReactionsDisplayHelper,animateIconChanges:o,accessoryPosition:l,isGroupCall:!this.state.isOneOnOneConversation,accessoryOpacityStyle:this.props.callParticipantOpacityStyle,nametagOpacityStyle:this.props.callParticipantTooltipStyle,enableVideoGestures:1===i,forceSizeToFit:p,shouldWaitForVideoSize:!1,useMobileReactionsLayout:this.props.useMobileControls,parentViewId:"CallStageView#StageView",onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,renderMobileNameTag:1===i,hideNameTag:this.props.hideNameTag||h,useDarkBackground:!0,enableFloatableResizableVideoPreview:e.isLocal&&!e.isAScreensharing?this.props.enableFloatableResizableVideoPreview:void 0,isSpeakerMode:this.props.stageLayoutMode===_.StageMode.Speaker,desktopNameTag:d,experimentalVideo:this.state.stageElements.length>4,isFullscreenBotCall:this.state.isFullscreenBotCall,layoutController:this._layoutControllerForKey,iconSize:this._getParticipantIconSize(e.renderKey),isScreenSharing:e.mri===this.state.screensharingUserMri})}_renderCelebrationAnimationView(){return s.createElement(T.default,{key:"celebrationAnimationView",conversationMri:this.props.reactionsConversationId,callId:this.props.callId,height:this.props.viewRect.height,width:this.props.viewRect.width,isLandscape:this.props.isLandscape})}_renderContent(){if(this.state.stageMode===_.CallStageViewMode.None||!this.state.isCallVisible)return;let e=[];if(b.CallUIUtils.shouldRenderStage(this.state)&&e.push(this._renderStage()),(!this.state.draggingElementKey||this.state.draggingElementKey===_.CallStageElementKeys.localUserKey&&this.props.enableFloatableResizableVideoPreview)&&!this.props.useHighContrastTheme)if(this.state.enableMultiGradientOverlay&&this.props.callStageOverlayOpacityStyle){const t=this.props.useMobileControls?.45:.25,i=[Y.Color.transparent,Y.Color.blackOverlay40],a=[this.props.callStageOverlayOpacityStyle,s.Styles.createViewStyle({height:this.props.viewRect.height*t},!1)];this._getCurrentCallPanelHeaderLayout()!==_.CallPanelHeaderLayout.Window&&e.push(s.createElement(s.Animated.View,{key:"callStageOverlayTop",blockPointerEvents:!0,ignorePointerEvents:!0,style:[a,se.overlayTopContainer]},s.createElement(o.GradientView,{style:Z.default.flexOne,colors:i,direction:o.GradientDirection.TOP,ignorePointerEvents:!0}))),this.props.useMobileControls&&e.push(s.createElement(s.Animated.View,{key:"callStageOverlayBottom",blockPointerEvents:!0,ignorePointerEvents:!0,style:[a,se.overlayBottomContainer]},s.createElement(o.GradientView,{style:Z.default.flexOne,colors:i,direction:o.GradientDirection.BOTTOM,ignorePointerEvents:!0})))}else if(this.props.useMobileControls){const t=[se.overlayContainer,s.Styles.createViewStyle({top:b.CallUIUtils.getStageTopOffset(this.props)},!1)];this.props.callStageOverlayOpacityStyle&&t.push(this.props.callStageOverlayOpacityStyle),this.state.enableTapToFlipCamera&&t.push(se.mobileOverlayShim),e.push(s.createElement(s.Animated.View,{key:"callStageOverlay",blockPointerEvents:!0,ignorePointerEvents:!0,style:t}))}if(this.props.useHighContrastHeaderTheme){const t=this._getHeaderBackdropContainerHeightStyle(this.props.stageLayoutMode,this.state.ribbonType),i=[se.backdropContainer,t,this._themeStyles.primaryBackgroundColorStyle,this.props.callHeaderOpacityStyle];e.push(s.createElement(s.Animated.View,{key:"headerbackdrop",style:i}))}return e.push.apply(e,this._renderRibbon()),this.state.isNavigatingWithKeyboard||e.push(s.createElement(p.default,{key:"nametag",getAnchorInfo:this._getAnchorInfo,getAnchorInfoChanges:this._getAnchorInfoChanges,parentDimensions:this.props.viewRect,opacityStyle:this.props.callParticipantTooltipStyle,callId:this.props.callId,conversationMri:this.props.conversationMri,onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,onNametagMouseEnter:this._onCallParticipantNametagMouseEnter,onNametagMouseLeave:this._onCallParticipantNametagMouseLeave})),e}_renderRibbon(){if(this.state.stageMode===_.CallStageViewMode.StageOnly)return;const e=[],t=this._getRibbonBackdropContainerHeightStyle(this.props.stageLayoutMode,this.state.ribbonType),i=[se.backdropContainer,t,this._ribbonAnimatedWidthStyle];e.push(s.createElement(s.Animated.View,{key:"ribbon",style:i,importantForAccessibility:s.Types.ImportantForAccessibility.NoHideDescendants},s.createElement(s.GestureView,{style:se.ribbonBackdrop,onPanHorizontal:this._onRibbonBackdropPan})));const a=b.CallUIUtils.shouldRenderStage(this.state)?this.state.stageElements:[],o=this._draggingElementKey(),r=!this.state.ribbonHidden;let l=!0,c=[];if(!n.includes(a,_.CallStageElementKeys.localUserKey)&&o!==_.CallStageElementKeys.localUserKey){const e=this._elementRenderInfo(_.CallStageElementKeys.localUserKey);e&&c.push(e)}let d=n.keys(this.state.renderedRemoteElementInfo);if(d=n.difference(d,a),o){if(this.props.enableFloatableResizableVideoPreview){const e=o!==_.CallStageElementKeys.localUserKey,t=o===_.CallStageElementKeys.localUserKey&&n.includes(this.state.stageElements,_.CallStageElementKeys.localUserKey);l=e||t}d=n.without(d,o)}e.push(this._renderCelebrationAnimationView());const u=this._ribbonItemHeight(this.state);e.push(s.createElement(W.default,{key:"remainder",ref:this._onRemainderViewRef,layoutController:this._layoutControllerForKey(_.CallStageElementKeys.remainderViewKey),dimensions:{height:u,width:u},useHighContrastTheme:this.props.useHighContrastHeaderTheme,onPress:this._onRemainderViewPressed})),this._shouldShowRibbonModeSelector()&&(this.state.enableNewLayoutPicker?e.push(s.createElement(O.default,{key:"ribbonMode",availableLayoutModes:b.CallUIUtils.getAvailableHeaderModes(this.props.useMobileControls,this.state.isOneOnOneConversation),callId:this.props.callId,conversationMri:this.props.conversationMri,layoutController:this._layoutControllerForKey(_.CallStageElementKeys.ribbonModeViewKey),dimensions:{height:u,width:_.LayoutPickerButtonWidth},useHighContrastTheme:this.props.useHighContrastHeaderTheme,isIncomingOrOutGoingRing:this.props.isIncomingOrOutgoingRing,showChevron:!0,useMobileCallControls:this.props.useMobileControls})):e.push(s.createElement(K.default,{key:"ribbonMode",availableLayoutModes:b.CallUIUtils.getAvailableHeaderModes(this.props.useMobileControls,this.state.isOneOnOneConversation),callId:this.props.callId,conversationMri:this.props.conversationMri,layoutController:this._layoutControllerForKey(_.CallStageElementKeys.ribbonModeViewKey),dimensions:{height:u,width:u},layoutMode:this._getCurrentCallPanelHeaderLayout(),useHighContrastTheme:this.props.useHighContrastHeaderTheme,onCallPanelHeaderLayoutChange:this.props.onCallPanelHeaderLayoutChange,showFullScreenOptionInRibbonSettings:this.props.showFullScreenOptionInRibbonSettings,isIncomingOrOutGoingRing:this.props.isIncomingOrOutgoingRing,showChevron:!0}))),this.state.enableAddToCallRibbonItem&&this.props.showParticipantsButton&&e.push(s.createElement(G.default,{key:"addtocall",layoutController:this._layoutControllerForKey(_.CallStageElementKeys.addToCallViewKey),dimensions:{height:u,width:u},coachMarkType:this.state.enableAddToCallCoachmark?P.CoachMarkType.CallPanelAddToCallButton:void 0,accessibilityLabel:N.getString("CallControlsOverFlowMenu.AddPeopleToCall"),useHighContrastTheme:this.props.useHighContrastHeaderTheme,onPress:this._onAddToCallViewPressed})),this._topElement&&n.includes(d,this._topElement)&&(d=n.without(d,this._topElement),d.push(this._topElement)),d=n.without(d,...this.state.nonInteractiveInCallBotMris);let h=n.map(d,e=>this._elementRenderInfo(e));c.push.apply(c,h);const p=n.map(c,e=>{const t=!n.includes(a,e.renderKey),i=this.props.enableFloatableResizableVideoPreview&&this.props.onVideoPreviewFloating&&this.state.isProvidingVideo;if(e.renderKey!==_.CallStageElementKeys.localUserKey||!i&&!this.props.enableNewCallScreen)return this._renderCallElementView(e,t,this.state.enableTapToMoveCallParticipant,r)});if(e.push.apply(e,p),e.push(s.createElement(m.CallStageDropTarget,{key:"background",type:m.CallStageDropTargetType.Background})),o&&l){const t=this._elementRenderInfo(o);if(t){const i=!n.includes(a,t.renderKey);if(i){const a=this._renderCallElementView(t,i,!1,r);e.push(a)}}}if(e.push(s.createElement(m.CallStageDropTarget,{key:"foreground",type:m.CallStageDropTargetType.Foreground})),!this.props.disableReactions){const t=s.createElement(R.default,{ref:this._onInlineCallStageReactionsViewRef,reactionsConversationMri:this.props.reactionsConversationId,ignorePointerEvents:!0,parentDimensions:this.props.viewRect,topOffsetForUnhandledReactions:u+(this.props.topInset||0)+20,alignRight:!0,getAnchorInfo:this._getAnchorInfo,getAnchorInfoChanges:this._getAnchorInfoChanges,getCallReactionsDisplayHelper:this._getCallReactionsDisplayHelper,onReactionTap:this._onTextReactionPressed});e.push(s.createElement(s.Animated.View,{style:[se.reactionsView,this._stageReactionsAnimatedStyle],key:_.CallStageElementKeys.callTextReactionViewKey,ignorePointerEvents:!0},t))}return e}_renderCallElementView(e,t,i=!1,a=!1){const n=this.state.enableTapToFlipCamera&&e.isLocal&&e.videoStatus===_.VideoStatus.Streaming&&t,o=e.renderKey===b.CallUIUtils.screenShareKey(this.state),r=e.isLocal,l=!e.renderScreenShare&&!e.isLocal;let c;c=t&&e.isRinging?this._onRemainderViewPressed:o?this._onScreenshareTap:i?this._onRibbonElementTapBinder:n?this.props.onParticipantViewTapped:this._onStageTapBinder;const d=t&&!e.isRinging&&!this.state.enableImmersiveMode&&this.state.enableTapToMoveCallParticipant?this._onToggleParticipantFocus:void 0,u=this.state.enableLayoutAnimation&&!this._suppressElementAnimation;let h=0;if(t){const t=e.renderScreenShare||e.isLocal;h=e.videoStatus===_.VideoStatus.Streaming&&t?_.RibbonSizes.ribbonItemRectBorderRadius:this._ribbonItemHeight(this.state)/2}return s.createElement(g.CallParticipantView,{key:e.renderKey,ref:this._mountedRefsMap.onComponentRef(e.renderKey),showContextMenu:l||r,renderInfo:e,renderKey:e.renderKey,isCompact:t,callId:this.props.callId,isGroupCall:!this.state.isOneOnOneConversation,conversationMri:this.props.conversationMri,isDragging:this._draggingElementKey()===e.renderKey,onUpdateElementLink:this._updateElementLink,onPan:!e.isRinging&&a?this._onElementPan:void 0,onResize:e.renderKey===_.CallStageElementKeys.localUserKey&&this.props.enableFloatableResizableVideoPreview?this._onElementResize:void 0,onPressInOrOut:!e.isRinging&&a?this._onElementPressInOrOut:void 0,onScalingModeChanged:this._onElementScalingModeChanged,onMouseOverOrOut:this._onElementMouseOverOrOut,onTap:c,onDoubleTap:d,getCallReactionsDisplayHelper:this._getCallReactionsDisplayHelper,iconOpacity:1,videoBorderRadius:h,animateIconChanges:u,useMobileReactionsLayout:this.props.useMobileControls,forceSizeToFit:e.renderScreenShare,parentViewId:"CallStageView#CallElementView",allowCameraFlip:n,onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,useDarkBackground:!0,enableFloatableResizableVideoPreview:e.isLocal&&!e.isAScreensharing?this.props.enableFloatableResizableVideoPreview:void 0,isSpeakerMode:this.props.stageLayoutMode===_.StageMode.Speaker,experimentalVideo:this.state.stageElements.length>4,isFullscreenBotCall:this.state.isFullscreenBotCall,layoutController:this._layoutControllerForKey,iconSize:this._getParticipantIconSize(e.renderKey),isCallStageV2:!1,isScreenSharing:this.state.screensharingUserMri===e.mri})}_ribbonItemHeight(e,t,i,a){return this._shouldUseMobilePreviewPercentage(!!t,!!i,!!a)?this._mobilePreviewPercentageSize():e.ribbonType===_.RibbonType.Large?_.RibbonSizes.ribbonItemSizeLarge:_.RibbonSizes.ribbonItemSizeSmall}_shouldUseMobilePreviewPercentage(e,t,i){return!1}_mobilePreviewPercentageSize(){return this.props.isLandscape?this.props.viewRect.width*this.state.mobilePreviewPercentage:this.props.viewRect.height*this.state.mobilePreviewPercentage}_anchorInfoForRect(e,t){const i=b.CallUIUtils.translateRect(e,this.props.viewRect.width);let a=t;return i&&(a||i.x<0)&&(i.x=0,a=!0),{rect:i,hidden:a}}render(){return s.createElement(s.View,{style:this.props.style},this._renderContent())}}t.CallStageView=re,t.default=re},3653:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallStageDropTarget=t.CallStageDropTargetType=t.CallStageDropTargetAnimationStyle=void 0;const a=i(1),n=i(116),o=i(0),s=i(15),r=i(1227),l=i(610),c=i(26),d=i(37),u=i(6),h=i(52),p=i(59),g=i(9),C=i(11),m=i(14),S=u.lazyProperties({container:()=>o.Styles.createViewStyle({position:"absolute",justifyContent:"center",alignItems:"center"}),gradientContainer:()=>o.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,opacity:.65}),gradientBorder:()=>o.Styles.createViewStyle({borderColor:g.Color.white,opacity:.2,borderWidth:10,top:0,left:0,borderStyle:"solid"}),gradientDashedBorder:()=>o.Styles.createViewStyle({borderColor:g.Color.white,opacity:.5,borderWidth:1,top:0,left:0,borderStyle:"dashed",borderRadius:10}),iconContainer:()=>o.Styles.createViewStyle({width:72,height:72,justifyContent:"center",alignItems:"center",overflow:"hidden"})});var y;!function(e){e[e.None=0]="None",e[e.SlideIn=1]="SlideIn",e[e.FadeIn=2]="FadeIn"}(t.CallStageDropTargetAnimationStyle||(t.CallStageDropTargetAnimationStyle={})),function(e){e[e.Foreground=0]="Foreground",e[e.Background=1]="Background"}(y=t.CallStageDropTargetType||(t.CallStageDropTargetType={}));class f extends s.ComponentBase{constructor(){super(...arguments),this._animatedTopValue=new o.Animated.Value(0),this._animatedHeightValue=new o.Animated.Value(0),this._animatedLeftValue=new o.Animated.Value(0),this._animatedWidthValue=new o.Animated.Value(0),this._animatedOpacityValue=new o.Animated.Value(0),this._animatedStyles=o.Styles.createAnimatedViewStyle({top:this._animatedTopValue,left:this._animatedLeftValue,height:this._animatedHeightValue,width:this._animatedWidthValue,opacity:this._animatedOpacityValue}),this._animatedScaleValue=new o.Animated.Value(1),this._animatedScaleStyle=o.Styles.createAnimatedViewStyle({transform:[{scale:this._animatedScaleValue}]})}_buildState(e,t){return{config:r.default.getCurrentDraggingParticipantConfig(),gradientColors:h.default.getGradientColors()}}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),!this.state.config)return this._animatedScaleValue.setValue(1),void(t.config&&l.default.unprepareFeedback());if(this.state.config&&!t.config){const e=this.state.config.dropTargetViewRect;this._animatedHeightValue.setValue(e.height),this._animatedWidthValue.setValue(e.width),this._animatedLeftValue.setValue(e.x),this._animatedTopValue.setValue(e.y-e.height),this._animatedOpacityValue.setValue(0)}a.isUndefined(this.state.config.showDropTarget)||(this._showOrHide(),l.default.prepareFeedback()),f._selectDropTarget(this.state.config)&&!f._selectDropTarget(t.config)&&l.default.triggerFeedback();const n=!!t.config&&t.config.selectDropTarget,s=!!this.state.config&&this.state.config.selectDropTarget;if(n!==s&&this.props.type!==y.Background){const e=[];e.push(o.Animated.timing(this._animatedScaleValue,{toValue:s?1.2:1,duration:300,easing:o.Animated.Easing.OutBack()})),o.Animated.parallel(e).start()}const r=this.state.config?this.state.config.dropTargetViewRect:void 0,c=t.config?t.config.dropTargetViewRect:void 0;!d.default(c,r)&&r&&(this._animatedTopValue.setValue(r.y),this._animatedLeftValue.setValue(r.x),this._animatedHeightValue.setValue(r.height),this._animatedWidthValue.setValue(r.width))}_showOrHide(e){if(!this.state.config)return;const t=this.state.config.showDropTarget,i=t?this.state.config.dropTargetViewRect.y:this.state.config.dropTargetViewRect.y-this.state.config.dropTargetViewRect.height,a=t?1:0;this._animatedOpacityValue.setValue(a),this._animatedTopValue.setValue(i)}_containerStyles(){return[S.container,this._animatedStyles]}render(){if(!this.state.config)return null;let e,t=[this.props.style];t.push(this._containerStyles()),this.props.type===y.Background||this.state.config.isVideoPreviewAndFloatingOnTop||(e=o.createElement(o.Animated.View,{style:[S.iconContainer,this._animatedScaleStyle]},o.createElement(c.default,{icon:this.state.config.selectDropTarget||this.state.config.confirmOnly?C.SkypeIcon.Ok:C.SkypeIcon.Plus,size:C.IconSize.size32,color:g.Color.white})),this.state.config.topPadding&&t.push(p.default.paddingTopStyle(this.state.config.topPadding)));const i=this.state.config.isVideoPreviewAndFloatingOnTop?S.gradientDashedBorder:S.gradientBorder,a=this.props.type===y.Foreground&&this.state.config.selectDropTarget?o.createElement(o.View,{style:[S.gradientContainer,i]}):void 0,s=this.props.type!==y.Background||this.state.config.isVideoPreviewAndFloatingOnTop?void 0:o.createElement(o.View,{style:S.gradientContainer},o.createElement(n.GradientView,{style:m.default.flexOne,colors:this.state.gradientColors,direction:n.GradientDirection.BOTTOM_RIGHT}));return o.createElement(o.Animated.View,{style:t,blockPointerEvents:!0,ignorePointerEvents:!0},s,e,a)}static _selectDropTarget(e){return!!e&&e.selectDropTarget}}t.CallStageDropTarget=f,t.default=f},3654:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallItemLayoutController=void 0;const a=i(1),n=i(0),o=i(51),s=i(1695),r=i(60),l=i(1766),c=i(110),d=i(6),u=i(23),h=i(9),p=i(20),g=i(14),C=i(10),m=d.lazyProperties({elementBase:()=>n.Styles.createViewStyle({position:"absolute",overflow:"visible"}),stageElementBase:()=>n.Styles.createViewStyle({position:"relative",overflow:"visible",flexGrow:0,flexShrink:1}),stageBackgroundStyle:()=>n.Styles.createViewStyle({backgroundColor:h.Color.callStageLight}),lightThemeBackgroundStyle:()=>n.Styles.createViewStyle({backgroundColor:h.Color.gray50,borderColor:h.Color.gray200})});class S{constructor(e,t,i,a,s){this._isCallStageV2=s,this._isHidden=!1,this._isDragging=!1,this._isTopRowElement=!1,this._currentBorderRadius=r.RibbonSizes.ribbonItemSizeSmall/2,this._currentRibbonRightInset=0,this._currentRibbonVerticalOffset=0,this._ribbonExpandedMultiplier=1,this._currentBackgroundOffset=0,this._useApproachValue=!1,this._panningThrottle=0,this._panEventCount=0,this._hasPositionedView=!1,this._globalResizeFactor=1,this._sessionStartResizeFactor=1,this._fullStageRect={x:0,y:0,width:0,height:0},this._currentRect={x:0,y:0,width:r.RibbonSizes.ribbonItemSizeSmall,height:r.RibbonSizes.ribbonItemSizeSmall},this._isResizing=!1,this._rawRibbonRect={x:0,y:0,width:r.RibbonSizes.ribbonItemSizeSmall,height:r.RibbonSizes.ribbonItemSizeSmall},this._animatedHorizontalValue=new n.Animated.Value(this._currentRect.x),this._animatedVerticalValue=new n.Animated.Value(this._currentRect.y),this._animatedWidthValue=new n.Animated.Value(this._currentRect.width),this._animatedHeightValue=new n.Animated.Value(this._currentRect.height),this._animatedBorderRadiusValue=new n.Animated.Value(this._currentBorderRadius),this._animatedBackgroundValue=new n.Animated.Value(this._currentBackgroundOffset),this._rectChangedEvent=new o.default,this._topRowChangedEvent=new o.default,this._isRTL=p.default.isRTL(),this._animatedStageHeightValue=new n.Animated.Value(1),this._animatedStageWidthValue=new n.Animated.Value(1),this._baseAnimatedStyle=n.Styles.createAnimatedViewStyle({width:this._animatedWidthValue,height:this._animatedHeightValue,top:this._animatedVerticalValue}),this._animatedStyleLTR=n.Styles.createAnimatedViewStyle({right:this._animatedHorizontalValue}),this._animatedStyleRTL=n.Styles.createAnimatedViewStyle({left:this._animatedHorizontalValue}),this._animatedInnerStyle=n.Styles.createAnimatedViewStyle({borderRadius:this._animatedBorderRadiusValue}),this._animatedBackgroundStyle=n.Styles.createAnimatedViewStyle({backgroundColor:this._animatedBackgroundValue.interpolate({inputRange:[0,1],outputRange:[h.Color.callStageDark,h.Color.callStageLight]})}),this._animatedStageContainerStyle=n.Styles.createAnimatedViewStyle({height:this._animatedStageHeightValue.interpolate({inputRange:[0,1],outputRange:["0%","100%"]}),width:this._animatedStageWidthValue.interpolate({inputRange:[0,1],outputRange:["0%","100%"]})}),this._key=e,this._currentRibbonRightInset=i,this._currentRibbonVerticalOffset=t,this._ribbonExpandedMultiplier=a}setHidden(e){this._isHidden!==e&&(this._isHidden=e,this._hiddenChangedCallback&&this._hiddenChangedCallback(e))}setResizeFactor(e){this._globalResizeFactor=e}getResizeFactor(){return this._globalResizeFactor}setUIPosition(e){this._uiPosition=e}getUIPosition(){return this._uiPosition}setFullStageRect(e){this._fullStageRect=e}setViewCanAnimateState(e,t){a.isUndefined(this._latestView)?(this._latestView=e,this._latestViewCanAnimate=t):this._latestView===e?(this._latestViewCanAnimate=t,t||(this._latestView=void 0)):this._latestView!==e&&t&&(this._latestView=e,this._latestViewCanAnimate=t)}onPan(e,t,i){if(!this._isDragging&&!e.isComplete&&(this._isDragging=!0,this._useApproachValue)){const e=i||this._currentRect,t={x:e.x+e.width/2,y:e.y+e.height/2};this._startApproach(t,e=>{const t=this._centerRectAroundPoint(e);this._updateAnimatedValues(t,this._currentBorderRadius,!1,void 0,0,!0)})}if(!e.isComplete&&this._panningThrottle>0&&this._panEventCount%this._panningThrottle>0)return void this._panEventCount++;const a=Math.max(Math.min(e.pageX-t.x,t.width),0),n=Math.max(Math.min(e.pageY-t.y,t.height),0),o=c.default.translatePoint({x:a,y:n},t.width);if(o)if(this._useApproachValue)this._approachValue&&this._approachValue.updateTarget(o);else{const e=this._centerRectAroundPoint(o);this._updateAnimatedValues(e,this._currentBorderRadius,!1,void 0,0,!0)}e.isComplete?(this._stopApproach(),this._isDragging=!1,this._panEventCount=0):this._panEventCount++}updateRibbonVerticalOffset(e,t,i=!1,a=r.CallStageConfig.animationDuration){if(this._currentRibbonVerticalOffset=e,this.isCompact()&&!this._isDragging){const e=this._ribbonViewRectFromRect(this._rawRibbonRect);this._updateAnimatedValues(e,this._currentBorderRadius,i,void 0,a)}}updateRibbonRightInset(e,t,i=!1,a=r.CallStageConfig.animationDuration){if(this._currentRibbonRightInset=e,this.isCompact()&&!this._isDragging){const e=this._ribbonViewRectFromRect(this._rawRibbonRect);this._updateAnimatedValues(e,this._currentBorderRadius,i,void 0,a)}}updateRibbonExpandedMultiplier(e,t,i=!1,a=r.CallStageConfig.animationDuration){if(this._ribbonExpandedMultiplier=e,this.isCompact()&&!this._isDragging){const e=this._ribbonViewRectFromRect(this._rawRibbonRect);this._updateAnimatedValues(e,this._currentBorderRadius,i,void 0,a)}}ribbonViewRect(){return this._ribbonViewRectFromRect(this._rawRibbonRect)}setRibbonPosition(e,t,i,a,n=!1){if(this._positionedInRibbon=!0,this._fullStageRect=i,this._rawRibbonRect=e,!this._isDragging){const i=this._ribbonViewRectFromRect(e);this._updateAnimatedValues(i,this._borderRadius(!1,t,a),n)}}resizeRect(e,t,i,n){if(!this._isDragging){if(this._isResizing||(this._sessionStartResizeFactor=this._globalResizeFactor,this._isResizing=!0),this._uiPosition===r.CallingViewUIPostion.FloatingOnTop){a.isUndefined(this._currentRectForResizingSession)&&(this._currentRectForResizingSession=this._currentRect),this._currentRectForResizingSession.height*e<r.RibbonSizes.ribbonItemSizeSmall&&(e=r.RibbonSizes.ribbonItemSizeSmall/this._currentRectForResizingSession.height),this._currentRectForResizingSession.width*e>this._fullStageRect.width/2&&(e=this._fullStageRect.width/2/this._currentRectForResizingSession.width);let t=this._currentRectForResizingSession;switch(i){case r.CallingViewCornerPostion.BottomLeft:t={x:this._currentRectForResizingSession.x,y:this._currentRectForResizingSession.y,width:this._currentRectForResizingSession.width*e,height:this._currentRectForResizingSession.height*e};break;case r.CallingViewCornerPostion.BottomRight:t={x:this._currentRectForResizingSession.x-this._currentRectForResizingSession.width*(e-1),y:this._currentRectForResizingSession.y,width:this._currentRectForResizingSession.width*e,height:this._currentRectForResizingSession.height*e};break;case r.CallingViewCornerPostion.UpperLeft:t={x:this._currentRectForResizingSession.x,y:this._currentRectForResizingSession.y-this._currentRectForResizingSession.height*(e-1),width:this._currentRectForResizingSession.width*e,height:this._currentRectForResizingSession.height*e};break;case r.CallingViewCornerPostion.UpperRight:t={x:this._currentRectForResizingSession.x-this._currentRectForResizingSession.width*(e-1),y:this._currentRectForResizingSession.y-this._currentRectForResizingSession.height*(e-1),width:this._currentRectForResizingSession.width*e,height:this._currentRectForResizingSession.height*e}}this._updateAnimatedValues(t,r.RibbonSizes.ribbonItemRectBorderRadius,!0),n&&(this._currentRectForResizingSession=void 0)}else this._uiPosition===r.CallingViewUIPostion.Ribbon&&(this._globalResizeFactor=Math.min(Math.max(this._sessionStartResizeFactor*e,1),4));n&&(this._isResizing=!1)}}setIsTopRowElement(e){this._isTopRowElement=e,this._topRowChangedEvent.fire(e)}getIsTopRowElement(){return this._isTopRowElement}setStagePosition(e,t,i,a,n,o=!1,s){this._positionedInRibbon=!1,this._fullStageRect=n,this._isDragging||this._updateAnimatedValues(t,this._borderRadius(!0,a,0),o,void 0,void 0,void 0,s),this._animatedBackgroundValue.setValue(i/e)}getStyles(e){return e?this._getStageStyles():[m.elementBase,this._baseAnimatedStyle,this._isRTL&&this._key===r.CallStageElementKeys.localUserKey?this._animatedStyleRTL:this._animatedStyleLTR]}getInnerStyles(){return[g.default.flexOne,this._animatedInnerStyle]}getBackgroundColorStyle(e){const t=e?m.lightThemeBackgroundStyle:m.stageBackgroundStyle;return this._isCallStageV2?t:this._animatedBackgroundStyle}onDimensionsChanged(e){this._dimensionsChangedCallback=e}onRectChanged(e){return this._rectChangedEvent.subscribe(e)}onHiddenChanged(e){this._hiddenChangedCallback=e}onTopRowChanged(e){return this._topRowChangedEvent.subscribe(e)}isCompact(){return this._positionedInRibbon}isHidden(){return this._isHidden}viewRect(e){if(e){const e=c.default.translateRect(this._currentRect,this._fullStageRect.width);return Object.assign(Object.assign({},e),{x:e.x+this._fullStageRect.x,y:e.y})}return this._currentRect}setCallHeaderPanelLayout(e){this._callPanelHeaderLayout=e}bgInfoCaptionOffset(e,t){let i;const a=t||16;{i=a;const t=this._callPanelHeaderLayout===r.CallPanelHeaderLayout.Float;this._isTopRowElement&&t&&(i+=l.DesktopMinTopMargin);const n=c.default.isDesktopMinCallPanelHeader(e);!this._isCallStageV2&&this._isTopRowElement&&n&&(u.default.isUsingStackNavigationContextNoSubscription()?i+=r.CallPanelHeaderHeight.mobile:i+=r.CallPanelHeaderHeight.window)}return{x:a,y:i,width:0,height:0}}_getStageStyles(){return[m.stageElementBase,this._animatedStageContainerStyle]}_centerRectAroundPoint(e){const t=this._currentRect.width,i=this._currentRect.height;return{x:e.x-t/2,y:e.y-i/2,width:t,height:i}}_stopApproach(){this._approachValue&&(this._approachValue.stop(),this._approachValue=void 0)}_startApproach(e,t){this._useApproachValue&&(this._stopApproach(),this._approachValue=new s.default(e,t),this._approachValue.start())}_borderRadius(e,t,i){return e?0:t?r.RibbonSizes.ribbonItemRectBorderRadius:i/2}_ribbonViewRect(e,t,i,a){const n=C.default.clampValue(this._ribbonExpandedMultiplier,0,1),o=e+this._currentRibbonRightInset,s=(this._maxY(this._rawRibbonRect)+this._currentRibbonVerticalOffset+30)*(1-n),r={x:o,y:t+this._currentRibbonVerticalOffset-s,width:i,height:a};return this._isRTL?c.default.translateRect(r,this._fullStageRect.width):r}_ribbonViewRectFromRect(e){return this._ribbonViewRect(e.x,e.y,e.width,e.height)}_maxY(e){return e.y+e.height}_updateAnimatedValues(e,t,i,o,s,l,d){if(!a.isUndefined(this._latestViewCanAnimate)&&!this._latestViewCanAnimate)return;if(i&&this._hasPositionedView&&c.default.enableLayoutAnimation()){const i=s||r.CallStageConfig.animationDuration,a=o||n.Animated.Easing.InOut();let c=[];c.push(n.Animated.timing(this._animatedVerticalValue,{toValue:e.y,duration:i,easing:a})),c.push(n.Animated.timing(this._animatedHorizontalValue,{toValue:e.x,duration:i,easing:a})),d&&(c.push(n.Animated.timing(this._animatedStageWidthValue,{toValue:d.width,duration:i,easing:a})),c.push(n.Animated.timing(this._animatedStageHeightValue,{toValue:d.height,duration:i,easing:a}))),l||(c.push(n.Animated.timing(this._animatedWidthValue,{toValue:e.width,duration:i,easing:a})),c.push(n.Animated.timing(this._animatedHeightValue,{toValue:e.height,duration:i,easing:a})),c.push(n.Animated.timing(this._animatedBorderRadiusValue,{toValue:t,duration:i,easing:a}))),c.length&&n.Animated.parallel(c).start()}else this._animatedVerticalValue.setValue(e.y),this._animatedHorizontalValue.setValue(e.x),d&&(this._animatedStageWidthValue.setValue(d.width),this._animatedStageHeightValue.setValue(d.height)),l||(this._animatedWidthValue.setValue(e.width),this._animatedHeightValue.setValue(e.height),this._animatedBorderRadiusValue.setValue(t));!this._dimensionsChangedCallback||this._currentRect.height===e.height&&this._currentRect.width===e.width?this._currentRect.x===e.x&&this._currentRect.y===e.y||this._rectChangedEvent.fire(e):(this._dimensionsChangedCallback(e),this._rectChangedEvent.fire(e)),this._currentRect=e,this._currentBorderRadius=t,this._hasPositionedView=!0}}t.CallItemLayoutController=S,t.default=S},3655:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(15),o=i(743),s=i(109),r=i(574),l=i(6),c=i(575),d=i(9),u=i(218),h=i(3656),p=l.lazyProperties({unhandledBubbleContainer:()=>a.Styles.createViewStyle({backgroundColor:d.Color.white,borderRadius:10,paddingVertical:5})});class g extends n.ComponentBase{constructor(){super(...arguments),this._animationConfig={presentOffset:{x:200,y:15},dismissOffset:{x:200,y:15},duration:350,easing:a.Animated.Easing.OutBack()},this.updateAnchorInfo=e=>{const t=e||this.props.getAnchorInfo(this.props.creatorKey);this._popupView&&t&&this._popupView.updatePosition(t)},this._onPopupViewRef=e=>{this._popupView=e||void 0},this._getAnchorInfo=()=>this.props.getAnchorInfo(this.props.creatorKey),this._getPopUpPositions=e=>[s.PopupAnchorPositon.Bottom],this._getAnimationDirection=e=>e?this.props.alignRight?s.PopupAnchorPositon.Right:s.PopupAnchorPositon.Left:s.PopupAnchorPositon.Bottom,this._renderPopupContent=(e,t,i,n,s)=>{const l=this.props.callParticipantReaction.reaction,c=a.createElement(h.default,{key:"reaction"+l.cuid,id:l.cuid,mri:l.creator,content:this.props.callParticipantReaction.content,reaction:this.props.callParticipantReaction.reaction,gradientColors:this.props.callParticipantReaction.gradientColors,textTimeoutMs:o.default.getTextTimeoutBasedOnContent(l.content),hideBackground:!0,hideUserIcon:!s,style:s?p.unhandledBubbleContainer:void 0,onPress:this.props.onReactionTap?this._onPress:void 0});return s?c:a.createElement(u.default,{anchorPosition:r.default.popupAnchorPositionToString(e),anchorOffset:t,popupWidth:i,popupHeight:n,borderRadius:10,strokeColor:d.Color.white,fillColor:d.Color.white,shadow:"0px 2px 4px rgba(0, 0, 0, 0.25)",skipPopupAutoFocus:!0},c)},this._onPress=()=>{this.dismiss(!1),this.props.onReactionTap&&this.props.onReactionTap()}}componentDidMount(){super.componentDidMount(),this.props.callParticipantReaction&&this.updateAnchorInfo(),this._rectChangeSubscriptionToken=this.props.getAnchorRectChanges(this.props.creatorKey,this.updateAnchorInfo)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.props.callParticipantReaction&&this.updateAnchorInfo()}componentWillUnmount(){super.componentWillUnmount(),this._rectChangeSubscriptionToken&&(this._rectChangeSubscriptionToken.unsubscribe(),this._rectChangeSubscriptionToken=void 0)}dismiss(e=!1){this._popupView&&this._popupView.dismiss(e)}render(){if(!this.props.callParticipantReaction)return null;const e=this.props.callParticipantReaction;return a.createElement(c.default,{key:"reaction"+this.props.callParticipantReaction.reaction.cuid,ref:this._onPopupViewRef,animateDismissal:!0,animationConfig:this._animationConfig,getAnchorInfo:this._getAnchorInfo,getPopupPositions:this._getPopUpPositions,getAnimationDirection:this._getAnimationDirection,renderPopup:this._renderPopupContent,timeoutMs:5e3,allowTaps:!0,onDismissPopup:()=>{this.props.onRemoveReaction&&this.props.onRemoveReaction(e)}})}}t.default=g},3656:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(116),n=i(0),o=i(15),s=i(53),r=i(17),l=i(3),c=i(4),d=i(6),u=i(360),h=i(21),p=i(9),g=i(14),C=i(31),m=i(101),S=i(65),y=d.lazyProperties({bubbleContainer:()=>n.Styles.createViewStyle({flex:-1,flexDirection:"row"}),simpleBubbleContainer:()=>n.Styles.createViewStyle({maxWidth:260}),bubble:()=>n.Styles.createViewStyle({flex:-1,alignSelf:"flex-start",backgroundColor:p.Color.gray400,borderTopRightRadius:10,borderBottomLeftRadius:10,borderBottomRightRadius:10,padding:15,marginBottom:4,marginHorizontal:20}),bubbleSelf:()=>n.Styles.createViewStyle({flex:-1,alignSelf:"flex-end",backgroundColor:p.Color.gray50,borderTopLeftRadius:10,borderTopRightRadius:10,borderBottomLeftRadius:10,padding:15,marginBottom:4,marginHorizontal:20}),simpleBubble:()=>n.Styles.createViewStyle({flex:-1,padding:8}),bubbleGradient:()=>n.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,borderTopRightRadius:10,borderBottomLeftRadius:10,borderBottomRightRadius:10}),bubbleText:()=>n.Styles.createTextStyle({color:p.Color.white,backgroundColor:p.Color.transparent}),bubbleTextSelf:()=>n.Styles.createTextStyle({color:p.Color.gray400,backgroundColor:p.Color.transparent}),userIcon:()=>n.Styles.createViewStyle({marginLeft:5})});class f extends o.ComponentBase{componentDidMount(){super.componentDidMount(),c.log(l.LogTraceArea.CallReactions,"TextReactionView.componentDidMount cuid: "+this.props.id),this._reactionOnScreenTimer=C.default.setTimeout(()=>{this._reactionOnScreenTimer=void 0,this.isComponentMounted()&&this.props.onAnimationEnd&&this.props.onAnimationEnd(this.props.id,this.props.mri)},this.props.textTimeoutMs||3e3)}componentWillUnmount(){super.componentWillUnmount(),c.log(l.LogTraceArea.CallReactions,"TextReactionView.componentWillUnmount cuid: "+this.props.id),this._reactionOnScreenTimer&&(C.default.clearTimeout(this._reactionOnScreenTimer),this._reactionOnScreenTimer=void 0)}render(){const e=h.default.isMyMri(this.props.mri),t=r.isAgent(this.props.mri),i=e||this.props.hideBackground?void 0:n.createElement(a.GradientView,{style:y.bubbleGradient,colors:this.props.gradientColors,direction:a.GradientDirection.RIGHT}),o=e||this.props.hideUserIcon?void 0:n.createElement(m.UserIcon,{style:y.userIcon,size:S.UserIconSize.Size30,userMri:this.props.mri}),l=this.props.hideBackground?y.simpleBubble:e?y.bubbleSelf:y.bubble,c=e||this.props.hideBackground?y.bubbleTextSelf:y.bubbleText;let d;if(this.props.reaction){const e={renderMedia:!1,allowLargeEmoticons:!0,textOverrideStyle:c,allowTextFallbackEmoticons:!0,numberOfLines:this.props.hideBackground&&!t&&s.UICapabilities.textNumberOfLinesSupported()?10:void 0};d=n.createElement(u.default,{message:this.props.reaction,options:e})}else this.props.content&&(d=n.createElement(n.Text,{style:c},this.props.content));const p=[];return this.props.hideBackground&&p.push(y.simpleBubbleContainer),this.props.onPress&&p.push(g.default.pointerCursor),this.props.style&&p.push(this.props.style),n.createElement(n.View,{style:p,onPress:this.props.onPress,activeOpacity:.8},n.createElement(n.View,{style:y.bubbleContainer},o,n.createElement(n.View,{style:l},i,d)))}}t.default=f},3657:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(7),s=i(219),r=i(60),l=i(110),c=i(254),d=i(914),u=i(6),h=i(5),p=i(35),g=i(23),C=i(915),m=i(9),S=i(24),y=i(11),f=i(100),_=i(10),b=u.lazyProperties({container:()=>n.Styles.createViewStyle({alignItems:"flex-end"}),innerContainer:()=>n.Styles.createViewStyle({justifyContent:"flex-end",alignItems:"center",overflow:"visible",flexDirection:"row",width:void 0})});class v extends C.default{constructor(){super(...arguments),this._showMenu=e=>{const t=()=>this._buttonRef,i=this._getRootViewId();c.default.showWithContent({menuId:c.default.menuId(),anchor:t,rootViewId:i,menuHeight:d.default.getLayoutPickerHeight(this.state.availableMenuItems),content:n.createElement(d.default,{anchor:t,rootViewId:i,callId:this.props.callId,conversationMri:this.props.conversationMri,useMobileControls:this.props.useMobileCallControls,isIncomingOrOutGoingRing:this.props.isIncomingOrOutGoingRing,showFullScreenOption:this.state.showFullScreenOptionInRibbonSettings,isInFullscreenMode:e,availableItems:this.state.availableMenuItems}),getTitle:()=>{},onCloseMenu:e=>c.default.close(i,e),onMenuClosed:this._onMenuClosed,colorThemeOverride:f.Theme.ColorfulDark,hidePopupArrow:!0,staticContent:!0,menuWidth:264,borderRadius:8,offset:{x:-r.RibbonSizes.ribbonItemSizeSmall-20,y:0}},_.default.newCauseId()),this.setState({isMenuShown:!0})},this._onMenuClosed=e=>{this.state.availableMenuItems.forEach(e=>{e.markAsSeen&&e.markAsSeen()})}}_buildState(e,t){const i=o.default.getS4LCMCFeatures().enableFullScreenOnWeb&&!g.default.isUsingSplitViewNoSubscription(),n=l.default.getAvailableMenuItems(e.callId,i,e.useMobileCallControls,e.conversationMri);return Object.assign(Object.assign({},super._buildState(e,t)),{stageMode:s.default.getStageMode(e.callId),showFullScreenOptionInRibbonSettings:i,menuContainsNewItem:a.some(n,e=>e.isNew),availableMenuItems:n})}_iconSize(){return y.IconSize.size16}_iconColor(){return m.Color.white}_labelStyle(){return[S.default.fontStyle.bodySmallDeprecated,n.Styles.createTextStyle({color:m.Color.white},!1)]}_containerStyle(){return b.innerContainer}_getMainContainerStyles(){return b.container}_iconBackgroundColor(){return this.props.useHighContrastTheme?this._themeColors.primaryBackgroundColor:m.Color.transparent}_icon(){return l.default.getIconForStageMode(this.state.stageMode,!1)}_label(){return l.default.getStageModeItemTitle(this.state.stageMode,!1)}_tooltip(){return this._intLabel()}_accessibilityLabel(){return this._intLabel()}_shouldRenderRedDot(){return this.state.menuContainsNewItem}_handleOnPress(e){this.state.isMenuShown&&c.default.close(this._getRootViewId(),_.default.newCauseId()),this.state.menuContainsNewItem&&this.setState({menuContainsNewItem:!1}),this.state.showFullScreenOptionInRibbonSettings?p.default.isFullScreenMode(this._getRootViewId()).then(e=>{this._showMenu(e)}):this._showMenu(!1)}_intLabel(){return h.getString("CallPanel.RibbonLayoutAccessibilityLabel")}}t.default=v},3658:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(5),n=i(915),o=i(9),s=i(11);class r extends n.default{_iconSize(){return s.IconSize.size20}_iconBackgroundColor(){return this.props.useHighContrastTheme?this._themeColors.primaryBackgroundColor:o.Color.gray300Overlay80}_icon(){return s.SkypeIcon.ContactAdd}_label(){}_tooltip(){return a.getString("CallBanner.AddPeopleToTheCallTooltip")}}t.default=r},3659:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(5),n=i(915),o=i(9),s=i(11);class r extends n.default{_buildState(e,t){const i=super._buildState(e,t);return t&&(i.remainder=void 0,i.ringing=void 0),i}showRemainder(e,t){!this.isComponentMounted()||this.state.remainder===e&&this.state.ringing===t||this.setState({remainder:e,ringing:t})}_iconBackgroundColor(){return this.props.useHighContrastTheme?this._themeColors.primaryBackgroundColor:o.Color.gray400Overlay80}_icon(){return this.state.ringing?s.SkypeIcon.CallAnimSmall4:s.SkypeIcon.Plus}_label(){return this.state.remainder&&this.state.remainder>0?this.state.remainder.toString():void 0}_tooltip(){return this._intTooltip()}_accessibilityLabel(){return this.props.accessibilityLabel||this._intTooltip()}_intTooltip(){return this.state.remainder&&this.state.remainder>0?a.getString("CallBanner.MorePeopleInTheCallTooltip",{count:this.state.remainder}):void 0}}t.default=r},3660:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(35),o=i(331),s=i(29),r=i(219),l=i(17),c=i(371),d=i(1108),u=i(5),h=i(915),p=i(3661),g=i(9),C=i(11);class m extends h.default{_buildState(e,t){const i=r.default.getStageMode(e.callId),a=s.default.CallScreenShareStore.hasIncomingScreensharing(e.callId),n={isPSTNCall:s.default.CallingStore.isPSTNCall(e.callId),isEncryptedCall:l.isEncryptedThread(e.conversationMri),conversationMri:e.conversationMri,callId:e.callId};this._changeCallLayoutCommand=new o.ChangeCallLayoutCommand(n,e.isIncomingOrOutGoingRing,i);const c=Object.assign(Object.assign({},super._buildState(e,t)),{isAudioOnlyCall:n.isPSTNCall&&n.isEncryptedCall,stageMode:i,hasIncomingScreenshare:a,callInfo:n});return t&&(c.hidden=e.layoutController.isHidden()),c}_iconSize(){return C.IconSize.size20}_iconBackgroundColor(){return this.props.useHighContrastTheme?this._themeColors.primaryBackgroundColor:g.Color.transparent}_icon(){return C.SkypeIcon.ViewSwitcher}_label(){}_tooltip(){return this._intLabel()}_accessibilityLabel(){return this._intLabel()}_handleOnPress(e){let t;const i=e;if(i.pageX&&i.pageY){d.default.setAnchorPosition({x:i.pageX,y:i.pageY});const e=this._getRootViewId();t=c.default.getMenuTargetCallback(e)}else t=()=>this._buttonRef;this.props.showFullScreenOptionInRibbonSettings?n.default.isFullScreenMode(this._getRootViewId()).then(i=>{this._showRibbonSettingsMenu(!0,i,t,e)}):this._showRibbonSettingsMenu(!1,!1,t,e)}_showRibbonSettingsMenu(e,t,i,n){const o=a.pick(n,"pageX","pageY");a.defer(()=>{p.default.show(this.props.availableLayoutModes,this.props.layoutMode,this.props.onCallPanelHeaderLayoutChange,i,this._getRootViewId(),o,this.state.isAudioOnlyCall,e,t,this.state.stageMode,this.state.hasIncomingScreenshare,this._changeCallLayoutCommand)})}_intLabel(){return u.getString("CallPanel.RibbonLayoutAccessibilityLabel")}}t.default=m},3661:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(35),o=i(0),s=i(7),r=i(29),l=i(88),c=i(87),d=i(60),u=i(110),h=i(13),p=i(3),g=i(4),C=i(6),m=i(5),S=i(72),y=i(10);var f;!function(e){e.Speaker="speaker",e.Content="content",e.Grid="grid",e.TogetherMode="togetherMode",e.LargeGrid="largeGrid",e.Window="window",e.Float="float",e.Presentation="presentation",e.EnterFullScreen="enterFullScreen",e.ExitFullScreen="exitFullScreen"}(f||(f={}));const _={[f.Speaker]:d.StageMode.Speaker,[f.Presentation]:d.StageMode.Presentation,[f.Content]:d.StageMode.FocusedScreenShare,[f.Grid]:d.StageMode.Grid,[f.TogetherMode]:d.StageMode.TogetherMode,[f.LargeGrid]:d.StageMode.LargeGrid},b={[f.Speaker]:l.CallViewMenuActions.SwitchToSpeaker,[f.Presentation]:l.CallViewMenuActions.SwitchToPresentation,[f.Content]:l.CallViewMenuActions.SwitchToContent,[f.Grid]:l.CallViewMenuActions.SwitchToModernGrid,[f.TogetherMode]:l.CallViewMenuActions.SwitchToTogetherMode,[f.LargeGrid]:l.CallViewMenuActions.SwitchToLargeGallery},v=C.lazyProperties({menuContainerStyles:()=>o.Styles.createViewStyle({paddingVertical:20,paddingBottom:10}),menuButtonStyles:()=>o.Styles.createButtonStyle({borderLeftWidth:0,paddingHorizontal:20})});class w{static show(e,t,i,n,o,s,r,l,c,d,u,h){const p={anchor:n,useTheme:!0,popupBeakSize:{height:0,width:0},popupOffset:{x:0,y:5},positionPriorities:["bottom","left"],menuStyles:{menuContainerStyles:v.menuContainerStyles,menuButtonStyles:v.menuButtonStyles},onCallPanelHeaderLayoutChange:i,changeCallLayoutCommand:h,hasIncomingScreenshare:u},g=[],C=[];if(h.canExecute()){const e=this._layoutMenuItemsForGridFocus(d,u,p);g.push({key:"stagelayoutsettings",menuItems:e})}a.each(e,e=>{const i=this._layoutMenuItemForMode(e,e===t);i&&C.push(i)}),C.length&&g.push({key:"ribbonlayoutsettings",menuItems:C}),l&&(c?g.push({key:"exitfullscreensetting",menuItems:[{text:m.getString("CallPanel.ExitFullScreen"),command:f.ExitFullScreen}]}):g.push({key:"enterfullscreensetting",menuItems:[{text:m.getString("CallPanel.EnterFullScreen"),command:f.EnterFullScreen}]})),S.default.showGroupWithOptions({id:"ribbonettingspopup",config:p,getMenuGroups:()=>g,handleMenuCommand:(e,t)=>this._selectOverflowMenuItem(e,t,o),cancelButtonTitleIOS:m.getString("Global.CancelLabel"),rootViewId:o,invokingEvent:s})}}t.default=w,w._layoutMenuItemsForGridFocus=(e,t,i)=>{const a=(e,t,i,a=!1,n=!0)=>({text:m.getString(e),command:t,selected:i,isCheckbox:n,disabled:a}),n=[a("CallPanel.CallHeaderGridViewLabel",f.Grid,u.default.isInGridStageMode(e))];if(t){const t=r.default.CallingFeaturesHelper.isPresentationModeEnabled(),i=t?f.Presentation:f.Content,o=t?d.StageMode.Presentation:d.StageMode.FocusedScreenShare;n.push(a(t?"CallPanel.CallHeaderPresentationViewLabel":"CallPanel.CallHeaderContentViewLabel",i,e===o))}else n.push(a("CallPanel.CallHeaderSpeakerViewLabel",f.Speaker,e===d.StageMode.Speaker));const o=s.default.getS4LCMCFeaturesNoSubscription();return o.callAudienceBotConfig.enabledGroupCall&&n.push(a("CallPanel.CallHeaderTogetherModeViewLabel",f.TogetherMode,e===d.StageMode.TogetherMode,!i.changeCallLayoutCommand.canExecuteForStageMode(d.StageMode.TogetherMode))),o.callGridViewBotConfig.enabled&&n.push(a("CallPanel.CallHeaderLargeGridViewLabel",f.LargeGrid,e===d.StageMode.LargeGrid,!i.changeCallLayoutCommand.canExecuteForStageMode(d.StageMode.LargeGrid))),n},w._layoutMenuItemForMode=(e,t)=>{switch(e){case d.CallPanelHeaderLayout.Float:return{text:m.getString("CallPanel.CallHeaderLayoutFloatLabel"),command:f.Float,selected:t,selectableType:h.SXMenuItemSelectableType.Checkbox};case d.CallPanelHeaderLayout.Window:return{text:m.getString("CallPanel.CallHeaderLayoutWindowLabel"),command:f.Window,selected:t,selectableType:h.SXMenuItemSelectableType.Checkbox}}},w._selectOverflowMenuItem=(e,t,i)=>{const a=y.default.newCauseId();if(g.log(p.LogTraceArea.Navigation,"RibbonSettingsUtils._selectOverflowMenuItem, causeId: "+a),S.default.dismiss("ribbonettingspopup",i),t.onCallPanelHeaderLayoutChange)switch(e){case f.Speaker:case f.Presentation:case f.Content:case f.Grid:case f.TogetherMode:case f.LargeGrid:t.changeCallLayoutCommand.execute(_[e]),c.default.trackCallViewMenuActions(b[e]);break;case f.Float:t.onCallPanelHeaderLayoutChange(d.CallPanelHeaderLayout.Float),c.default.trackCallViewMenuActions(l.CallViewMenuActions.SwitchToFloat);break;case f.Window:t.onCallPanelHeaderLayoutChange(d.CallPanelHeaderLayout.Window),c.default.trackCallViewMenuActions(l.CallViewMenuActions.SwitchToWindow);break;case f.EnterFullScreen:n.default.tryEnterFullScreenMode(i).then(e=>{e?(g.track(new l.RibbonSettingsMenuActionEvent(l.RibbonSettingsMenuActions.EnterFullScreen)),c.default.trackCallViewMenuActions(l.CallViewMenuActions.EnterFullScreen)):g.log(p.LogTraceArea.CallingUI,"Failed to Enter Full Screen Mode")});break;case f.ExitFullScreen:n.default.exitFullScreenMode(i).then(()=>{g.track(new l.RibbonSettingsMenuActionEvent(l.RibbonSettingsMenuActions.ExitFullScreen))}).catch(e=>{g.log(p.LogTraceArea.CallingUI,"Failed to exit full screen mode:")})}}},3662:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallStageViewV2=void 0;const a=i(1),n=i(0),o=i(29),s=i(743),r=i(103),l=i(60),c=i(3),d=i(4),u=i(6),h=i(3663),p=i(9),g=i(14),C=i(12),m=i(10),S=i(1773),y=i(1774),f=i(1776),_=i(121),b=i(740),v=i(588),w=i(583),T=i(87),I=i(219),P=u.lazyProperties({reactionsView:()=>g.default.absoluteFill,stageContainerStyle:()=>n.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:p.Color.transparent,flex:1,flexDirection:"column",flexWrap:"wrap",justifyContent:"center",alignSelf:"center"}),horizontalPaddingStyle:()=>n.Styles.createViewStyle({paddingHorizontal:4}),modernStageLandscapeContainerStyle:()=>n.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap"})});class M extends C.default{constructor(){super(...arguments),this._callReactionsDisplayHelper=new s.default,this._layoutController=new S.default(!0),this._mountedRefsMap=new _.default,this._updateElementLink=(e,t,i,a,n,s,r)=>{o.default.VideoLinksManager.updateElementLink(this.props.callId,e,t,i,a,n,s,r)},this._layoutControllerForKey=e=>this._layoutController.controllerForKey(e),this._onElementScalingModeChanged=(e,t,i,a)=>{o.default.VideoLinksManager.onElementScalingModeChanged(this.props.callId,e,t,i,a)},this._getCallReactionsDisplayHelper=()=>this._callReactionsDisplayHelper,this._onViewRef=e=>{this._parentViewRef=e||void 0},this._getParentRefForReactions=()=>this._parentViewRef,this._getChildRefForReactions=e=>this._mountedRefsMap.ref(e)}_buildState(e,t){return{stageElements:v.default.getStageElements(e.callId),showChangeTogetherModeBackgroundOption:w.ChangeTogetherModeBackgroundCommand.canExecute(e.callId,e.conversationMri),showMyselfInTheGrid:I.default.getSelfInTheGrid(e.callId)}}componentDidMount(){super.componentDidMount(),d.log(c.LogTraceArea.CallingUI,"CallStageView.componentDidMount"),o.default.SpeakerViewTelemetryService.startTracking(this.props.callId),T.default.setHadNewCallStageEnabled(this.props.callId,m.default.newCauseId())}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i);const a=m.default.newCauseId();d.log(c.LogTraceArea.CallingUI,"CallStageView.UNSAFE_componentWillUpdate causeId: "+a),this._updateElementLayout(t,e,a)}componentWillUnmount(){super.componentWillUnmount();const e=m.default.newCauseId();d.log(c.LogTraceArea.CallingUI,"CallStageView.componentWillUnmount causeId: "+e),o.default.CallingStore.isCallConnected(this.props.callId)?d.log(c.LogTraceArea.CallingUI,"CallStageView.componentWillUnmount: Call is still connected; leaving videos attached causeId: "+e):(d.log(c.LogTraceArea.CallingUI,"CallStageView.componentWillUnmount: Call is not connected; tearing down videos causeId: "+e),o.default.VideoLinksManager.removeVideoLinks(this.props.callId,e)),o.default.SpeakerViewTelemetryService.stopTracking(this.props.callId)}_renderCelebrationAnimationView(){return n.createElement(y.default,{key:"celebrationAnimationView",conversationMri:this.props.reactionsConversationId,callId:this.props.callId,height:this.props.viewRect.height,width:this.props.viewRect.width,isLandscape:this.props.isLandscape})}_updateElementLayout(e,t,i){if(d.log(c.LogTraceArea.CallingUI,"CallStageView._updateElementLayout causeId: "+i),0===t.viewRect.width||0===t.viewRect.height)return;const n=a.map(e.stageElements,t=>{const i=a.indexOf(e.stageElements,t);return{key:t,videoType:l.LayoutInfoVideoType.None,isLocal:l.CallStageElementKeys.localUserKey===t,isHostOfScreenshare:0===t.indexOf(r.ScreenSharingPrefix),stagePosition:i}});this._layoutController.updateLayoutInfoForStage(n,this._adjustedStageViewRectV2(t.viewRect)),v.default.setStageCapacity(this._layoutController.getMaxNumberOfStageElements())}_renderStageParticipant(e){return n.createElement(b.default,{key:e,renderKey:e,ref:t=>{this._onParticipantViewRef(t,e)},callId:this.props.callId,conversationMri:this.props.conversationMri,nametagPosition:{offset:0},onUpdateElementLink:this._updateElementLink,iconOpacity:1,isGroupCall:!this.props.isOneOnOneConversation,parentViewId:"CallStageView#StageView",onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,hideNameTag:this.props.hideNameTag,useDarkBackground:!0,desktopNameTag:!0,isCallStageV2:!0,useLightTheme:this.props.useLightTheme,experimentalVideo:this.state.stageElements.length>4,getCallReactionsDisplayHelper:this._getCallReactionsDisplayHelper,layoutController:this._layoutControllerForKey,iconSize:120,showChangeTogetherModeBackgroundOption:this.state.showChangeTogetherModeBackgroundOption,onScalingModeChanged:this._onElementScalingModeChanged})}_adjustedStageViewRectV2(e){return{x:e.x,y:e.y+l.DesktopNewHeaderHeight,width:e.width,height:e.height-l.DesktopCallControlsHeight-l.DesktopNewHeaderHeight}}_onParticipantViewRef(e,t){o.default.VideoLinksManager.getMountedRefsMapStage().onComponentRef(t).call(this,e),this._mountedRefsMap.onComponentRef(t).call(this,e)}_renderStage(){const e=a.map(this.state.stageElements,e=>this._renderStageParticipant(e)),t=[P.stageContainerStyle];return this.props.isOneOnOneConversation||t.push(P.horizontalPaddingStyle),this._layoutController.shouldSwitchOrientation()&&t.push(P.modernStageLandscapeContainerStyle),n.createElement(n.View,{key:"callStage",style:[t,this.props.style],ref:this._onViewRef},e,this._maybeRenderLocalVideoView())}_renderReactionsView(){return n.createElement(f.NewCallReactionsView,{reactionsConversationId:this.props.reactionsConversationId,parentDimensions:this.props.viewRect,getChildRef:this._getChildRefForReactions,getParentRef:this._getParentRefForReactions,onTextReactionPressed:this.props.onTextReactionPressed,disableReactions:this.props.disableReactions,getCallReactionsDisplayHelper:this._getCallReactionsDisplayHelper})}_maybeRenderLocalVideoView(){if(this.props.isOneOnOneConversation&&this.props.stageLayoutMode===l.StageMode.Grid&&!this.state.showMyselfInTheGrid)return n.createElement(h.default,{key:"localVideoView",onUpdateElementLink:this._updateElementLink,getCallReactionsDisplayHelper:this._getCallReactionsDisplayHelper,callId:this.props.callId,conversationMri:this.props.conversationMri,useLightTheme:this.props.useLightTheme})}render(){return[this._renderStage(),this._renderReactionsView(),this._renderCelebrationAnimationView()]}}t.CallStageViewV2=M},3663:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(740),o=i(60),s=i(45),r=i(6),l=i(9),c=i(14),d=r.lazyProperties({newLocalViewContainer:()=>a.Styles.createViewStyle({height:120,width:200,position:"absolute",right:0,top:0,overflow:"visible",shadowOffset:{width:0,height:4},shadowRadius:4,shadowColor:l.Color.blackOverlay70}),localParticipantBackgroundStyle:()=>a.Styles.createViewStyle({backgroundColor:l.Color.callStageLight}),backgroundStyleLightTheme:()=>a.Styles.createViewStyle({backgroundColor:l.Color.gray50})});class u extends s.default{constructor(){super(...arguments),this._participantLayoutController={getStyles:()=>[c.default.flexOne,d.newLocalViewContainer],getInnerStyles:()=>[c.default.flexOne],getBackgroundColorStyle:e=>e?d.backgroundStyleLightTheme:d.localParticipantBackgroundStyle,isHidden:()=>!1},this._layoutController=()=>this._participantLayoutController}render(){return a.createElement(n.CallParticipantView,{key:o.CallStageElementKeys.localUserKey,renderKey:o.CallStageElementKeys.localUserKey,parentViewId:"LocalCallParticipantView",onUpdateElementLink:this.props.onUpdateElementLink,getCallReactionsDisplayHelper:this.props.getCallReactionsDisplayHelper,callId:this.props.callId,conversationMri:this.props.conversationMri,useDarkBackground:!0,desktopNameTag:!0,isCallStageV2:!0,showContextMenu:!0,layoutController:this._layoutController,iconSize:64,iconOpacity:1,isGroupCall:!1,useLightTheme:this.props.useLightTheme})}}t.default=u},3665:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(15),s=i(7),r=i(1777),l=i(843),c=i(1258),d=i(41),u=i(37),h=i(6),p=i(5),g=i(9),C=i(11),m=i(16),S=i(31),y=C.IconSize.default,f=C.IconSize.size24,_=h.lazyProperties({container:()=>n.Styles.createViewStyle({alignItems:"stretch"}),captionsContainer:()=>n.Styles.createViewStyle({justifyContent:"flex-end",alignItems:"stretch"}),preview:()=>n.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:0,justifyContent:"flex-end",alignItems:"stretch"}),messageContainer:()=>n.Styles.createViewStyle({position:"absolute",bottom:0,borderRadius:15,alignItems:"center",alignSelf:"center",backgroundColor:g.Color.blackOverlay35}),messageText:()=>n.Styles.createTextStyle({paddingHorizontal:16,paddingVertical:5,color:g.Color.white}),buttonExpandContainer:()=>n.Styles.createViewStyle({alignItems:"center",alignSelf:"center",opacity:.9}),buttonExpandTitle:()=>n.Styles.createTextStyle({color:g.Color.white,paddingHorizontal:16,paddingVertical:5}),buttonExpand:()=>n.Styles.createViewStyle({width:y,height:y,justifyContent:"center",alignItems:"center",overflow:"visible"})});class b extends o.ComponentBase{constructor(){super(...arguments),this._renderItem=(e,t)=>n.createElement(r.default,{key:"item"+t,transcription:e,iconSize:c.SenderAvatarSize,isInterimCaptionConcatenated:this.state.isInterimCaptionConcatenated}),this._onLayout=e=>{!u.default(e,this.state.viewRect)&&this.isComponentMounted()&&this.setState({viewRect:e})},this._onPressOpen=e=>{e.stopPropagation(),this.props.onPressOpen&&this.props.onPressOpen()}}_buildState(e,t){const i=s.default.getS4LCMCFeatures(),a={captionsClearTimeout:i.callCaptionsClearTimeout,hasHistory:0!==l.default.transcriptionCount(e.reactionsMri),viewRect:t?{x:0,y:0,width:0,height:0}:this.state.viewRect,isInterimCaptionConcatenated:i.isInterimCaptionConcatenated};return a.transcriptions=l.default.getTranscriptions(e.reactionsMri,c.SubtitleMaxPreviewLines),a}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),a.isEmpty(this.state.transcriptions)||u.default(this.state.transcriptions,t.transcriptions)||(l.default.resetUnseenTranscriptionCount(this.props.reactionsMri),this._scheduleCaptionsClearTimer())}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),l.default.assignCallId(this.props.reactionsMri,this.props.callId)}componentDidMount(){super.componentDidMount(),this._scheduleCaptionsClearTimer()}render(){const e=this.state.hasHistory?void 0:this._renderMessage(p.getString("CallTranscription.StartSubtitles")),t=this._renderPreviewList();return n.createElement(n.View,{style:[_.container,this.props.style],onLayout:this._onLayout,ignorePointerEvents:!0},e,t)}_renderMessage(e){const t=[_.messageContainer];return this.props.bottomPadding&&t.push(n.Styles.createViewStyle({bottom:this.props.bottomPadding},!1)),n.createElement(n.View,{key:"message",style:t},n.createElement(m.BodyText,{style:_.messageText},e))}_renderPreviewList(){const e=this._getHorizontalPadding(),t=n.Styles.createViewStyle({left:e,right:e,bottom:this.props.bottomPadding},!1),i=[_.captionsContainer];let o=void 0;if(this.props.showControls&&this.state.hasHistory){const e=a.isEmpty(this.state.transcriptions)?n.createElement(m.BodyText,{style:_.buttonExpandTitle},p.getString("CallTranscription.Expand")):void 0,t=y;o=n.createElement(n.View,{key:"buttonExpandContainer",style:_.buttonExpandContainer},n.createElement(d.default,{style:_.buttonExpand,size:f,color:g.Color.gray50,hoverColor:g.Color.white,icon:C.SkypeIcon.UpChevron,onPress:this._onPressOpen,title:p.getString("CallTranscription.ExpandButton")}),e);const s=this.state.viewRect.height-t-(this.props.bottomPadding||0);s>0&&i.push(n.Styles.createViewStyle({maxHeight:s},!1))}const s=a.map(this.state.transcriptions,(e,t)=>this._renderItem(e,t)),r=n.createElement(n.View,{key:"captionsContainer",style:i},s);return n.createElement(n.View,{key:"subtitlePreview",style:[_.preview,t]},o,r)}_getHorizontalPadding(){return Math.max((this.state.viewRect.width-c.SubtitleMaxWidth)/2,30)}_scheduleCaptionsClearTimer(){this._stopCaptionsClearTimer(),this.state.captionsClearTimeout>0&&(this._onCaptionsClearTimer=S.default.setTimeout(()=>{var e,t;const i=null!==(t=null===(e=a.maxBy(this.state.transcriptions.map(e=>e.message),e=>e.createdTime))||void 0===e?void 0:e.createdTime)&&void 0!==t?t:0;l.default.setConsumptionHorizon(this.props.reactionsMri,i+1),this._onCaptionsClearTimer=void 0},this.state.captionsClearTimeout))}_stopCaptionsClearTimer(){this._onCaptionsClearTimer&&(S.default.clearTimeout(this._onCaptionsClearTimer),this._onCaptionsClearTimer=void 0)}}t.default=b},3666:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallTransientStateViewType=void 0;i(682);const a=i(0),n=i(15),o=i(26),s=i(6),r=i(9),l=i(11),c=i(14),d=i(16);var u;!function(e){e[e.Hold=0]="Hold",e[e.Reconnect=1]="Reconnect"}(u=t.CallTransientStateViewType||(t.CallTransientStateViewType={}));const h=s.lazyProperties({container:()=>a.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),innerContainer:()=>a.Styles.createViewStyle({height:160,width:160,borderRadius:10,paddingHorizontal:20,alignItems:"center",justifyContent:"center",backgroundColor:r.Color.blackOverlay50}),innerContainerIOS:()=>a.Styles.createViewStyle({backgroundColor:r.Color.transparent}),messageHeaderText:()=>a.Styles.createTextStyle({color:r.Color.white,textAlign:"center",backgroundColor:r.Color.transparent,marginTop:8}),messageText:()=>a.Styles.createTextStyle({color:r.Color.white,textAlign:"center",backgroundColor:r.Color.transparent,marginTop:4})});class p extends n.ComponentBase{constructor(){super(...arguments),this._opacityAnimationValue=new a.Animated.Value(0),this._opacityAnimationStyle=a.Styles.createAnimatedViewStyle({opacity:this._opacityAnimationValue})}componentDidMount(){super.componentDidMount(),a.Animated.timing(this._opacityAnimationValue,{duration:200,toValue:1,easing:a.Animated.Easing.Linear()}).start()}render(){const e=[c.default.absoluteFill,h.container,this._opacityAnimationStyle];this.props.style&&e.push(this.props.style);const t=[h.innerContainer,void 0],i=this.props.body?a.createElement(d.BodyText,{style:h.messageText,allowFontScaling:!1},this.props.body):void 0,n=this.props.type===u.Reconnect?l.SkypeIcon.Connecting:l.SkypeIcon.Pause;let s=a.createElement(a.View,{style:t},void 0,a.createElement(o.default,{icon:n,size:l.IconSize.default,color:r.Color.white}),a.createElement(d.RowTitle,{style:h.messageHeaderText,allowFontScaling:!1},this.props.header),i);return this.props.onPress&&(s=a.createElement(a.Button,{onPress:this.props.onPress},s)),a.createElement(a.Animated.View,{style:e,blockPointerEvents:this.props.blockPointerEvents,ignorePointerEvents:this.props.ignorePointerEvents},s)}}t.default=p},3667:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(177),o=i(35),s=i(91),r=i(0),l=i(74),c=i(7),d=i(3668),u=i(280),h=i(144),p=i(384),g=i(331),C=i(29),m=i(1256),S=i(325),y=i(88),f=i(87),_=i(60),b=i(110),v=i(53),w=i(695),T=i(17),I=i(109),P=i(54),M=i(13),k=i(1637),A=i(839),R=i(79),V=i(3),E=i(148),L=i(4),B=i(229),O=i(125),D=i(6),x=i(5),N=i(686),U=i(18),F=i(55),H=i(583),z=i(179),G=i(698),W=i(742),K=i(587),j=i(48),Q=i(19),q=i(72),X=i(66),$=i(9),J=i(24),Y=i(11),Z=i(28),ee=i(14),te=i(12),ie=i(515),ae=i(10),ne=i(3670),oe=i(3680),se=i(3682),re=i(3690),le=D.lazyProperties({spinner:()=>r.Styles.createViewStyle({minWidth:80,alignItems:"center",flex:1,justifyContent:"center",overflow:"visible"}),spinnerMargin:()=>r.Styles.createViewStyle({margin:6,overflow:"visible"}),container:()=>r.Styles.createViewStyle({flex:1,alignItems:"flex-end",justifyContent:"center",flexDirection:"row",overflow:"visible"}),buttonRow:()=>r.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"visible",alignSelf:"center",top:0}),leftButton:()=>r.Styles.createViewStyle({position:"absolute",left:0,bottom:0}),marginLeft:()=>r.Styles.createViewStyle({marginLeft:20}),chatPanelButton:()=>ee.default.alignItemsCenter,reactionsPickerButton:()=>r.Styles.createViewStyle({alignItems:"center",justifyContent:"center",width:72}),secondaryCallControlsUIContainer:()=>r.Styles.createWebViewStyle({position:"absolute",right:0,bottom:0,top:0,flexDirection:"row"}),marginRight:()=>r.Styles.createViewStyle({marginRight:20}),modernSecondaryCallControlsUIElement:()=>r.Styles.createWebViewStyle({justifyContent:"center"}),backgroundCircle:()=>r.Styles.createViewStyle({position:"absolute",width:40,height:40,borderRadius:20,backgroundColor:$.Color.white,opacity:.5}),caption:()=>r.Styles.createTextStyle({textAlign:"center",fontSize:J.default.controlFontSize.caption,paddingHorizontal:10,color:$.Color.white}),raiseHandImageWrapper:()=>r.Styles.createViewStyle({position:"absolute",top:-7,left:3,overflow:"visible"}),customCallReactionsButton:()=>r.Styles.createViewStyle({position:"absolute",bottom:18,right:0,overflow:"visible"})});class ce extends te.default{constructor(){super(...arguments),this._overflowMenuId=q.default.menuId(),this._screenshareOverflowMenuId=q.default.menuId(),this._secondaryCallControlsManager=new re.DesktopSecondaryCallControlsManager,this._autoLowerHandHelper=new d.default,this._onReactionsPickerHovered=e=>{a.delay(()=>{!this.state.isReactionsPickerSelected&&e&&this.props.onReactionPickerButtonHover()},50)},this._getShareCallLinkButton=()=>r.createElement(oe.default,{colorConfig:this._colorConfig(),isShowingAloneInCall:this.props.isShowingAloneInCall,conversationMri:this.props.conversationMri,callId:this.props.callId,isShowingRecents:this.props.isShowingRecents,useLightTheme:this.props.useLightTheme}),this._getShareQRButton=()=>r.createElement(se.default,{colorConfig:this._colorConfig(),conversationMri:this.props.conversationMri,callId:this.props.callId,isShowingRecents:this.props.isShowingRecents}),this._getRequestScreenShareControlButton=()=>{const e=x.getString("CallControls.CallButtonRequestScreenShareControl");return r.createElement(p.CallButton,{key:_.CallControlsKeys.ScreenShareControl,icon:Y.SkypeIcon.ScreenSharingRequestControl,accessibilityLabel:e,caption:e,size:p.CallButtonSize.ExtraSmall,anchorAccessibilityLabel:e,colorConfig:this._colorConfig(),onPress:()=>this._requestScreenShareCommand.execute()})},this._getStopScreenShareControlButton=()=>{const e=x.getString("CallControls.CallButtonStopScreenShareControlFromViewer");return r.createElement(p.CallButton,{key:_.CallControlsKeys.ScreenShareControl,icon:Y.SkypeIcon.ScreenSharingStopControl,accessibilityLabel:e,caption:e,size:p.CallButtonSize.ExtraSmall,anchorAccessibilityLabel:e,colorConfig:this._colorConfig(),onPress:()=>this._stopScreenShareCommand.execute()})},this._getScreenShareControlRequestInProgressIndicator=()=>{let e=r.createElement(X.default,{style:ee.default.overflowVisible,size:M.SXActivityIndicatorSize.Small,useRXIndicator:!0});return e=r.createElement(r.View,{style:le.spinnerMargin},e),r.createElement(r.View,{style:le.spinner},e,r.createElement(r.Text,{style:le.caption},x.getString("CallControls.ScreenShareControlRequesting")))},this._onChatPanelButtonPress=()=>{const e=ae.default.newCauseId();L.log(V.LogTraceArea.CallingUI,"_onChatPanelButtonPress causeId: "+e),this.props.onChatPanelButtonPress(e)},this._onRaiseHandPressed=()=>{this._raiseHandCommand.execute(),this.state.autoLowerHandEnabled&&this._autoLowerHandHelper.startAutoLowerHand(this.props.callId,this._lowerHandCommand)},this._onLowerHandPressed=()=>{this._lowerHandCommand.execute(),this.state.autoLowerHandEnabled&&this._autoLowerHandHelper.trackManuallyLowerHand()},this._onAnimatedChatCircleViewRef=e=>{this._animatedChatCircleView=e||void 0},this._onOverflowMenuButtonRef=e=>{this._overflowButton=e||void 0},this._onScreenShareOverflowMenuButtonRef=e=>{this._screenShareOverflowMenuButton=e||void 0},this._onCallReactionsDrawerItemRef=e=>{this._reactionsEntryPoint=e||void 0,this._setEngagementTooltipAnchor(e)},this._setEngagementTooltipAnchor=e=>{u.default.setAnchor(h.EngagementTooltipType.CallReactionsBar,e)},this._onReactionsPickerPressed=()=>{this.props.onReactionsPickerButtonPress(),this.props.onInteracting(this.state.isReactionsPickerSelected)},this._onParticipantsButtonPress=()=>{const e=ae.default.newCauseId();L.log(V.LogTraceArea.CallingUI,"DesktopCallControls._onParticipantsButtonPress "+e),this.props.onShowParticipants(e,_.CallRosterOrigin.CallControls,this.state.isHandRaised)},this._onAddParticipantsButtonPress=()=>{const e=ae.default.newCauseId();L.log(V.LogTraceArea.CallingUI,"DesktopCallControls._onAddParticipantsButtonPress "+e),this.props.onAddToCall(e,V.NavigationAddToCallOrigin.CallControls)},this._onTogetherModeBackgroundChangeButtonPress=()=>{this._changeTogetherModeBackgroundCommand.execute()},this._getOverflowMenuConfig=e=>({anchor:e,useTheme:!0,positionPriorities:["top","bottom"],popupBeakSize:{height:0,width:0},popupOffset:{x:0,y:-10}}),this._showOverflowMenuPopup=e=>{const t=this._getOverflowMenuConfig(this._getAnchorForOverflowMenu);q.default.showWithOptions({id:this._overflowMenuId,config:t,getMenuItems:this._getOverflowMenuItems,handleMenuCommand:this._selectOverflowMenuItem,onDismiss:this._overflowMenuDismissed,rootViewId:this._getRootViewId(),invokingEvent:e})},this._overflowMenuDismissed=()=>{f.default.trackOverflowMenuActions([])},this._getOverflowMenuItems=()=>this._getOverflowMenuItemsForCommands(this._secondaryCallControlsManager.getOverflowControls()),this._getActiveScreenShareOverflowItems=()=>{const e=[re.OverflowMenuCommands.StopSharing];return C.default.CallingFeaturesHelper.allowSwitchingScreenSharing()&&e.push(re.OverflowMenuCommands.SwitchScreen),this._getOverflowMenuItemsForCommands(e)},this._getReactionPickerText=()=>this.state.isReactionsPickerSelected?x.getString("ReactionsStream.ReactionBarCloseDrawerTitle"):x.getString("ReactionsStream.ReactionBarOpenDrawerTitle"),this._getScreenshareButtonTooltip=()=>this.state.isScreenShareActive&&!this.state.windowSharingEnabled&&this.state.numberAvailableScreens<=1?x.getString("CallControlsOverFlowMenu.StopShareScreen"):x.getString("CallControlsOverFlowMenu.ShareScreen"),this._getSnapshotText=()=>x.getString("CallReactionsBar.PhotoSnapshotButtonShortTitle"),this._selectOverflowMenuItem=e=>{const t=ae.default.newCauseId();L.log(V.LogTraceArea.CallingUI,"DesktopCallControls._selectOverflowMenuItem "+t);const i=this._getRootViewId();switch(q.default.dismiss(this._overflowMenuId,i),q.default.dismiss(this._screenshareOverflowMenuId,i),f.default.trackOverflowMenuActions([e]),e){case re.OverflowMenuCommands.Blur:C.default.DeviceStore.setBackgroundBlurred(!0),L.track(new y.LocalVideoActionsEvent(y.LocalVideoActions.BackgroundBlur));break;case re.OverflowMenuCommands.Unblur:C.default.DeviceStore.setBackgroundBlurred(!1),L.track(new y.LocalVideoActionsEvent(y.LocalVideoActions.BackgroundUnBlur));break;case re.OverflowMenuCommands.OnAddToCall:this.props.onAddToCall(t,V.NavigationAddToCallOrigin.OverflowMenu);break;case re.OverflowMenuCommands.OnShowParticipants:this.props.onShowParticipants(t,_.CallRosterOrigin.OverflowMenu,!1);break;case re.OverflowMenuCommands.BackgroundEffectsSettings:case re.OverflowMenuCommands.OnShowAVSettings:this._showAVSettings();break;case re.OverflowMenuCommands.OnShowAudioSettings:this._showAudioSettings();break;case re.OverflowMenuCommands.ShareScreen:this._onNewScreenShareButtonPress(void 0,t);break;case re.OverflowMenuCommands.ShareScreenAndSounds:this.state.isScreenShareActive?this._startSoundSharing():this._openScreenSharingModal(!0,t);break;case re.OverflowMenuCommands.StopSharing:this._stopScreenSharing();break;case re.OverflowMenuCommands.SwitchScreen:this._onSwitchScreen(t);break;case re.OverflowMenuCommands.ScreenShareControl:this._requestScreenShareCommand.execute();break;case re.OverflowMenuCommands.StopScreenShareControl:this._stopScreenShareCommand.execute();break;case re.OverflowMenuCommands.HoldCall:case re.OverflowMenuCommands.ResumeCall:this._toggleHoldState();break;case re.OverflowMenuCommands.StartRecording:this._startRecording();break;case re.OverflowMenuCommands.StopRecording:this._stopRecording();break;case re.OverflowMenuCommands.StartCaptions:this._startTranslator();break;case re.OverflowMenuCommands.StopCaptions:this._stopTranslator();break;case re.OverflowMenuCommands.EnableIncomingVideo:this._enableIncomingVideo();break;case re.OverflowMenuCommands.DisableIncomingVideo:this._disableIncomingVideo();break;case q.SXActionMenuCancel:break;case re.OverflowMenuCommands.Snap:this.props.onMomentsPress();break;case re.OverflowMenuCommands.React:this._onReactionsPickerPressed();break;case re.OverflowMenuCommands.CallStats:this._onCallStatsPressed();break;case re.OverflowMenuCommands.Invite:this._invitePeopleCommand.execute();break;case re.OverflowMenuCommands.MuteEveryone:this._muteEveryoneCommand.execute(),L.track(new y.CallMuteEveryoneEvent(y.MuteEveryoneOrigin.OverflowMenu));break;case re.OverflowMenuCommands.RaiseHand:this._onRaiseHandPressed();break;case re.OverflowMenuCommands.LowerHand:this._onLowerHandPressed();break;case re.OverflowMenuCommands.ChangeTogetherModeBackground:this._onTogetherModeBackgroundChangeButtonPress()}},this._getAnchorForOverflowMenu=()=>this._overflowButton,this._getAnchorForActiveScreenShareOverflowMenu=()=>this._screenShareOverflowMenuButton,this._toggleHoldState=()=>{const e=ae.default.newCauseId(),t=C.default.ActiveCallUIHelper.connectedToActiveCall(this.props.conversationMri),i=t?"HOLD":"RESUME";if(L.log(V.LogTraceArea.CallingUI,"DesktopCallControls._toggleHoldState to "+i+" causeId: "+e),t)C.default.CallingStore.hold(this.props.callId,e);else{const t=()=>C.default.CallingStore.unhold(this.props.callId,e);this.state.connectedAndNotOnHoldCallId&&this.state.connectedAndNotOnHoldCallId!==this.props.callId?C.default.CallingStore.hold(this.state.connectedAndNotOnHoldCallId,e).then(t):t()}},this._onCallStatsPressed=()=>{this._callStatsCommand.execute()},this._onNewScreenShareButtonPress=(e,t)=>{const i=t||ae.default.newCauseId();L.log(V.LogTraceArea.CallingUI,"_onNewScreenShareButtonPress causeId: "+i),C.default.CallingFeaturesHelper.isScreenSharingPermissionEnabled(i).then(t=>{if(t)if(this.state.isScreenShareActive)if(this.state.numberAvailableScreens>1||this.state.windowSharingEnabled){const t=this._getOverflowMenuConfig(this._getAnchorForActiveScreenShareOverflowMenu);q.default.showWithOptions({id:this._screenshareOverflowMenuId,config:t,getMenuItems:this._getActiveScreenShareOverflowItems,handleMenuCommand:this._selectOverflowMenuItem,onDismiss:this._overflowMenuDismissed,rootViewId:this._getRootViewId(),invokingEvent:e})}else this._stopScreenSharing();else this._onShareScreen(i);else z.default.showDeniedPromptWithSettingsOption(Z.PermissionType.ScreenRecording,this._getRootViewId(),o.default.openScreenRecordingPrivacyPane)})},this._openScreenSharingModal=(e,t)=>{L.log(V.LogTraceArea.CallingUI,"DesktopCallControls._openScreenSharingModal causeId: "+t),f.default.updateCallTelemetry(this.props.callId,t,e=>e.displayScreenSharingDialogCount()),R.dismissAll(),L.log(V.LogTraceArea.CallingUI,"got windows count 0 will navigate to screen share panel"),U.default.navigateToScreenSharePanel({conversationMri:this.props.conversationMri,currentScreenSharingSource:this._currentScreenSharingSource,currentScreenSharingSourceType:this._currentScreenSharingSourceType,isScreenSharingActive:this.state.isScreenShareActive,onSelectSource:this._selectScreenShareSource,onClose:this._closeScreenSharingModal,shareSounds:e},"_screenSharingModalId")},this._showAVSettings=()=>{const e=ae.default.newCauseId();L.log(V.LogTraceArea.CallingUI,"DesktopCallControls._showAVSettings causeId: "+e),U.default.navigateToDesktopSettingsGroup(F.SettingsGroup.AudioVideoSettings,this._getRootViewId(),e)},this._showAudioSettings=()=>{const e=ae.default.newCauseId();L.log(V.LogTraceArea.CallingUI,"DesktopCallControls._showAudioSettings causeId: "+e),U.default.navigateToDesktopSettingsGroup(F.SettingsGroup.AudioSettings,this._getRootViewId(),e)},this._closeScreenSharingModal=()=>{P.default.dismissModal("_screenSharingModalId",this._getRootViewId())},this._selectScreenShareSource=(e,t,i)=>{const a=ae.default.newCauseId();if(L.log(V.LogTraceArea.CallingUI,"DesktopCallControls._selectScreenShareSource causeId: "+a),f.default.updateCallTelemetry(this.props.callId,a,e=>e.didUserDisplayScreenSharingDialog()),this.state.isScreenShareActive){if(this._currentScreenSharingSource&&e.getId()===this._currentScreenSharingSource.getId())return void this._closeScreenSharingModal();C.default.CallingStore.setSwitchingScreen(!0),C.default.CallingStore.stopScreenSharing(this.props.callId,a).then(()=>{C.default.CallingStore.startScreenSharing(this.props.callId,a,e,t).then(()=>C.default.CallingStore.setSwitchingScreen(!1)),this._currentScreenSharingSource=e,this._currentScreenSharingSourceType=i}),this._incrementSourceTypeTelemetryCounts(i,a),f.default.updateCallTelemetry(this.props.callId,a,e=>e.switchScreenWhileSharing())}else this._startScreenSharing(a,t,e,i);j.default.maybeAnnounceForAccessibility(x.getString("AccessibilityLabel.ScreenShareStarted")),this._closeScreenSharingModal()},this._stopScreenSharing=()=>{const e=ae.default.newCauseId();L.log(V.LogTraceArea.CallingUI,"DesktopCallControls._stopScreenSharing causeId: "+e);const t=C.default.CallingStore.stopScreenSharing(this.props.callId,e,N.StopSharingOrigin.CallView);return j.default.maybeAnnounceForAccessibility(x.getString("AccessibilityLabel.ScreenShareStopped")),this._currentScreenSharingSource=void 0,this._currentScreenSharingSourceType=void 0,f.default.updateCallTelemetry(this.props.callId,e,e=>e.stopScreenSharing()),this._shouldDisableVideoDuringScreenSharing()&&this.props.showHideOutgoingVideoDisabledToast(!1,e),t},this._startSoundSharing=()=>{const e=ae.default.newCauseId();L.log(V.LogTraceArea.CallingUI,"DesktopCallControls._startSoundSharing causeId: "+e),C.default.CallingStore.startSoundSharing(this.props.callId,e).then(()=>{f.default.updateCallTelemetry(this.props.callId,e,e=>e.startSoundSharing())})},this._togglePstnDialpadShortcut=(e,t)=>!(t!==this._getRootViewId()||!this.props.isPSTNCall)&&(this.props.onOpenDialpad(),!0),this._toggleCallStatsShortcut=(e,t)=>t===this._getRootViewId()&&(this._onCallStatsPressed(),!0),this._onScreenShareEvent=(e,t)=>{this._openScreenSharingModal(e,t)},this._mediaActionEvent=e=>{C.default.CallingStore.getOutgoingCallIds().indexOf(this.props.callId)>=0?(L.track(new y.MediaActionEvent(y.CallControlContext.DesktopCallControls,y.MediaActionEventResult.EndCall)),L.log(V.LogTraceArea.CallingUI,"DesktopCallControls._mediaActionEvent ending call (causeId: "+e+")"),C.default.CallingStore.endCall(this.props.callId,e)):(L.track(new y.MediaActionEvent(y.CallControlContext.DesktopCallControls,y.MediaActionEventResult.Ignore)),L.log(V.LogTraceArea.CallingUI,"DesktopCallControls._mediaActionEvent no action (causeId: "+e+")"))}}_buildState(e,t){this._callStatsCommand=new H.ToggleCallStatsCommand(e.callId,this._getContext()),this._muteEveryoneCommand=new g.MuteEveryoneCommand(e.callId),this._changeTogetherModeBackgroundCommand=new H.ChangeTogetherModeBackgroundCommand(e.callId,e.conversationMri),this._invitePeopleCommand=new H.InvitePeopleCommand(e.conversationMri,this._getRootViewId());const i=C.default.CallingStore.isRecording(e.callId),a=C.default.InCallBotService.isTranslating(e.callId),n=C.default.CallingStore.isIncomingVideoDisabled(e.callId),o=C.default.CallingStore.isAudioOnly(e.callId),s=c.default.getS4LCMCFeatures(),r=s.customCallReactions,d=C.default.CallingStore.getCallRecordingInitiator(e.callId),u=w.default.getCelebrationData(e.conversationMri,e.callId),h=e.callUIState===_.CallUIState.Default,p=C.default.CallingStore.getCallState(e.callId),m=p===l.CallState.Connected?C.default.ScreenSharingControlStoreRegistrar.getStoreFromCallId(e.callId):void 0;this._requestScreenShareCommand=new g.RequestScreenShareCommand(m),this._stopScreenShareCommand=new g.StopScreenShareCommand(m);const S=s.enableAllCallButtonsVisible,y=e.callUIState===_.CallUIState.Default||e.callUIState===_.CallUIState.OutgoingRing||e.callUIState===_.CallUIState.GoLiveSinglePlayer,f=S&&!T.isGroupConversation(e.conversationMri)&&!C.default.CallingFeaturesHelper.hasConnectedParticipants(e),I=C.default.CallingFeaturesHelper.allowRecording(e),P=I&&h,M=C.default.CallingFeaturesHelper.allowScreenSharing(e),k=M&&!f,A=M&&h;this._lowerHandCommand=new G.LowerHandCommand(e.callId,K.LowerHandOrigin.CallControls),this._raiseHandCommand=new G.RaiseHandCommand(e.callId,e);const R=this._raiseHandCommand.isFeatureEnabled(),V=this._requestScreenShareCommand.canExecute(),E=this._stopScreenShareCommand.canExecute(),L=this._changeTogetherModeBackgroundCommand.canExecute(),O=S?I&&y:P,D=S?M&&y:A,x=R,N=this._lowerHandCommand.canExecute(),U=h&&C.default.CallingFeaturesHelper.allowCaptioning(e),F=C.default.CallingStore.getConnectedOrOutgoingAndNotOnHoldCallId(),z=C.default.DeviceStore.isBackgroundBlurCapable(),W=C.default.CallingStore.isProvidingVideo(e.callId),j=C.default.DeviceStore.isBackgroundReplacementEnabled(),Q=h&&C.default.CallingFeaturesHelper.allowIncomingVideoToBeDisabled(e),q=this._muteEveryoneCommand.canExecute(),X=h&&C.default.CallingFeaturesHelper.allowHoldCall(e),$=C.default.CallingStore.isCallOnHoldResumeable(e.callId),J=this._callStatsCommand.canExecute(),Y=C.default.CallingStore.isOneOnOneCall(e.callId),Z=C.default.CallingStore.isScreenSharing(e.callId),ee=C.default.DeviceStore.getAvailableScreens().length,te=v.CallingCapabilities.applicationSharingSupported(),ie=C.default.InCallBotUtils.isCallRecordingInitiator(d),ae=s.twinCamEnabled;let ne={isVideoActive:W,isScreenShareActive:Z,isReactionsPickerSelected:!t&&!!this.state&&this.state.isReactionsPickerSelected,useCompactLayout:e.availableWidth<360,connectedAndNotOnHoldCallId:F,isRecording:i,isIncomingVideoDisabled:n,audioOnlyEnabled:o,numberAvailableScreens:ee,emoticonReactionKey:b.default.getEmoticonReactionKey(u),useHighContrastTheme:b.default.useHighContrastThemeAndChanges(),callState:p,isReceivingScreensharing:C.default.CallingStore.isReceivingScreenSharing(e.callId),isChatBadgeOn:this._isUnreadInCallIncomingMessageAndPhoto(),allowScreenSharing:S?k:A,allowRecording:P,isNavigatingWithKeyboard:B.default.isNavigatingWithKeyboard(),screensharingIconFromECS:b.default.stringToScreenShareIconEnum(s.screensharingIconFromECS),windowSharingEnabled:te,isMinDesktop:b.default.isMinDesktop(e.controlsType),canRequestScreenShareControl:V,canStopScreenShareControl:E,screenShareRequestControlInProgress:m&&m.requestControlInProgress(),isConnecting1on1:f,isHandRaisedForCurrentUser:N,isHandRaised:C.default.CallingStore.isAnyHandRaised(e.callId),isOneOnOneCall:Y,enableNewMainCallControls:C.default.CallingFeaturesHelper.areNewMainCallControlsEnabled(),showCustomizeReactionsPencilButton:r&&r.enabled&&!r.useNewAddEmojiIcon,autoLowerHandEnabled:c.default.getS4LCMCFeatures().autoLowerHand,twinCamEnabled:ae};const oe={idealLeftControls:this._getIdealLeftControls(O,V,E,L,Y,ae),idealRightControls:this._getIdealRightControls(D,x,N),idealOverflowControls:this._getIdealOverflowControls(!1,U,a,F,z,W,j,Q,n,o,q,X,$,J),leftControlForDesktopMinSmallest:this._getLeftControlForDesktopMinSmallest(),controlsType:e.controlsType,isOneOnOneCall:Y,isScreenShareActive:Z,numberAvailableScreens:ee,windowSharingEnabled:te,canRequestScreenShareControl:V,allowRecording:P,isRecording:i,connectedAndNotOnHoldCallId:F,callId:e.callId,isCallRecordingInitiator:ie};return this._secondaryCallControlsManager.configure(oe),ne}componentDidMount(){super.componentDidMount(),this._screenSharingEventSub=C.default.dangerouslyGetCallNavigationUtils().screenSharePopupEvent.subscribe(this._onScreenShareEvent),this._mediaActionEventSub=n.default.mediaActionEvent.subscribe(this._mediaActionEvent),this._registerKeyboardHandlers()}UNSAFE_componentWillUpdate(e,t,i){if(super.UNSAFE_componentWillUpdate(e,t,i),this.state.isChatBadgeOn!==t.isChatBadgeOn&&L.log(V.LogTraceArea.CallingUI,"DesktopCallControls.UNSAFE_componentWillUpdate isChatBadgeOn changed from "+this.state.isChatBadgeOn+" to "+t.isChatBadgeOn),e.isShowingChat!==this.props.isShowingChat&&e.isShowingChat){const e=T.getReactionsThreadMriForCallId(this.props.callId);S.default.resetUnSeenIncomingPhotoCount(e),S.default.resetUnSeenIncomingTextCount(e)}}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),this.state.isScreenShareActive!==t.isScreenShareActive&&b.default.announceScreenShareState(this.state.isScreenShareActive),this._shouldDisableVideoDuringScreenSharing()&&t.isScreenShareActive&&!this.state.isScreenShareActive){const e=ae.default.newCauseId();this.props.showHideOutgoingVideoDisabledToast(!1,e)}}componentWillUnmount(){super.componentWillUnmount(),this._unregisterKeyboardHandlers(),this._screenSharingEventSub&&(this._screenSharingEventSub.unsubscribe(),this._screenSharingEventSub=void 0),this._mediaActionEventSub&&(this._mediaActionEventSub.unsubscribe(),this._mediaActionEventSub=void 0),this.state.autoLowerHandEnabled&&this._autoLowerHandHelper.cleanSpeakingTimer()}toggleReactionsPickerButton(e,t){L.log(V.LogTraceArea.CallingUI,"toggleReactionsPickerButton selected: "+e),this.setState({isReactionsPickerSelected:e},()=>{t&&this.isComponentMounted()&&!e&&this._reactionsEntryPoint&&this.state.isNavigatingWithKeyboard&&this._reactionsEntryPoint.requestFocus()})}animatedBubbleCircle(){const e=ae.default.newCauseId();L.log(V.LogTraceArea.CallingUI,"DesktopCallControls.animatedBubbleCircle causeId: "+e),this._animatedChatCircleView&&(this._chatCircleAnimation&&this._chatCircleAnimation.stop(),this._chatCircleAnimation=s.sequence([this._animatedChatCircleView.getAnimation({scale:5},e),this._animatedChatCircleView.getAnimation({scale:0},e)]),this._chatCircleAnimation.start(()=>{delete this._animatedChatCircleView}))}render(){const e=[le.container,this.props.opacityStyle];return r.createElement(r.Animated.View,{style:e,ignorePointerEvents:!0},this._renderLeftControls(this._secondaryCallControlsManager.getLeftControls()),r.createElement(ne.default,{callId:this.props.callId,callUIState:this.props.callUIState,conversationMri:this.props.conversationMri,onOpenDialpad:this.props.onOpenDialpad,onInteracting:this.props.onInteracting,isPSTNCall:this.props.isPSTNCall,isEncryptedCall:this.props.isEncryptedCall,disableMic:this.props.disableMic,onEndCallFailure:this.props.onEndCallFailure,onVideoButtonRef:this.props.onVideoButtonRef,useLightTheme:this.props.useLightTheme,shouldDisableVideoDuringScreenSharing:this._shouldDisableVideoDuringScreenSharing()}),this._renderRightControls(this._secondaryCallControlsManager.getRightControls()))}_getIdealLeftControls(e,t,i,a,n,o){const s=[];return n||s.push({priority:1,type:_.CallControlsKeys.ShareLink}),e&&s.push({priority:1,type:_.CallControlsKeys.Record}),(t||i)&&s.push({priority:2,type:_.CallControlsKeys.ScreenShareControl}),this.props.showParticipantsButton&&s.push({priority:1,type:_.CallControlsKeys.Participants}),a&&s.push({priority:3,type:_.CallControlsKeys.ChangeScene}),o&&s.push({priority:1,type:_.CallControlsKeys.TwinCam}),s}_getIdealRightControls(e,t,i){const a=[];return a.push({priority:2,type:_.CallControlsKeys.Chat}),e&&a.push({priority:5,type:_.CallControlsKeys.ScreenShare}),t&&a.push({priority:4,type:i?_.CallControlsKeys.LowerHand:_.CallControlsKeys.RaiseHand}),this.props.shouldShowReactions&&a.push({priority:3,type:_.CallControlsKeys.ReactionsDrawer}),a.push({priority:1,type:_.CallControlsKeys.Overflow}),a}_renderLeftControls(e){const t=[le.buttonRow,le.leftButton,this.state.enableNewMainCallControls?void 0:le.marginLeft];return r.createElement(r.View,{style:t},this._renderControls(e))}_getIdealOverflowControls(e,t,i,a,n,o,s,r,l,c,d,u,h,p){const g=[];e&&g.push(re.OverflowMenuCommands.Snap);const m=E.default.isConversationTranslated(this.props.conversationMri);if(t&&!m&&(i||a!==this.props.callId?i&&g.push(re.OverflowMenuCommands.StopCaptions):g.push(re.OverflowMenuCommands.StartCaptions)),n&&o&&!s&&(C.default.DeviceStore.isBackgroundBlurred()?g.push(re.OverflowMenuCommands.Unblur):g.push(re.OverflowMenuCommands.Blur)),a===this.props.callId&&s&&g.push(re.OverflowMenuCommands.BackgroundEffectsSettings),r){const e=!l&&!c;e&&a===this.props.callId?g.push(re.OverflowMenuCommands.DisableIncomingVideo):e||g.push(re.OverflowMenuCommands.EnableIncomingVideo)}return d&&g.push(re.OverflowMenuCommands.MuteEveryone),u?g.push(re.OverflowMenuCommands.HoldCall):h&&g.push(re.OverflowMenuCommands.ResumeCall),this.props.isEncryptedCall||this.props.isPSTNCall||this.props.isOutgoingVideoDisabled?g.push(re.OverflowMenuCommands.OnShowAudioSettings):g.push(re.OverflowMenuCommands.OnShowAVSettings),p&&g.push(re.OverflowMenuCommands.CallStats),g}_getLeftControlForDesktopMinSmallest(){return _.CallControlsKeys.Chat}_renderControls(e){return a.map(e,e=>this._renderControl(e))}_renderControl(e){switch(e){case _.CallControlsKeys.Mic:case _.CallControlsKeys.MicQuickSettings:case _.CallControlsKeys.Video:case _.CallControlsKeys.VideoQuickSettings:case _.CallControlsKeys.Dialpad:return;case _.CallControlsKeys.Participants:return this._getAppropriateParticipantsButton();case _.CallControlsKeys.ScreenShare:return this._getScreenshareButton();case _.CallControlsKeys.ScreenShareControl:return this._getScreenShareControlButton();case _.CallControlsKeys.EndCall:return;case _.CallControlsKeys.RaiseHand:return this._getRaiseOrLowerHandButton(!0);case _.CallControlsKeys.LowerHand:return this._getRaiseOrLowerHandButton(!1);case _.CallControlsKeys.ShareLink:return this._getShareCallLinkButton();case _.CallControlsKeys.TwinCam:return this._getShareQRButton();case _.CallControlsKeys.ChangeScene:return this._getTogetherModeBackgroundChangeButton();case _.CallControlsKeys.Record:return this._getRecordCallButton();case _.CallControlsKeys.ReactionsDrawer:return this._getReactionsDrawer();case _.CallControlsKeys.Overflow:return this._renderMoreButton();case _.CallControlsKeys.Moments:return this._getSnapshotButton();case _.CallControlsKeys.Chat:return this._getChatPanelButton();default:return ae.default.switchStatementExhaustiveChecking(e,"Missing case for an CallControlsKeys element")}}_renderRightControls(e){const t=[le.secondaryCallControlsUIContainer,this.state.enableNewMainCallControls?void 0:le.marginRight];return r.createElement(r.View,{style:t,ignorePointerEvents:!0},this._renderControls(e))}_getChatPanelButton(){let e=x.getString("CallPanel.ChatButton");const t=this.props.isShowingChat?x.getString("CallPanel.CloseConversation"):x.getString("CallPanel.OpenConversation"),i=this.state.enableNewMainCallControls&&this.props.controlsType===_.CallControlsType.DesktopMinSmallest;return r.createElement(r.View,{style:[le.chatPanelButton,le.modernSecondaryCallControlsUIElement]},r.createElement(s.View,{ref:this._onAnimatedChatCircleViewRef,style:le.backgroundCircle,opacity:0}),r.createElement(p.CallButton,{key:_.CallControlsKeys.Chat,ref:this.props.onChatButtonRef,icon:Y.SkypeIcon.Message,accessibilityLabel:t,size:p.CallButtonSize.ExtraSmall,onPress:this._onChatPanelButtonPress,isToggledOn:this.props.isShowingChat,colorConfig:this._colorConfig(),isBadgeOn:this.state.isChatBadgeOn,caption:i?void 0:e}))}_getScreenShareControlButton(){return this.state.canRequestScreenShareControl?this._getRequestScreenShareControlButton():this.state.canStopScreenShareControl?this._getStopScreenShareControlButton():this.state.screenShareRequestControlInProgress?this._getScreenShareControlRequestInProgressIndicator():void 0}_getScreenshareButton(){const e=this._getScreenshareButtonTooltip();return r.createElement(p.CallButton,{key:_.CallControlsKeys.ScreenShare,style:le.modernSecondaryCallControlsUIElement,ref:this._onScreenShareOverflowMenuButtonRef,icon:b.default.getShareScreenIcon(this.state.screensharingIconFromECS),accessibilityLabel:e,isDisabled:!this.state.allowScreenSharing,size:p.CallButtonSize.ExtraSmall,isToggledOn:this.state.isScreenShareActive,onPress:e=>this._onNewScreenShareButtonPress(e,void 0),coachMarkType:I.CoachMarkType.CallPanelScreenShareButton,anchorAccessibilityLabel:e,colorConfig:this._colorConfig(),caption:e})}_getTogetherModeBackgroundChangeButton(){const e=x.getString("CallControlsOverFlowMenu.ChangeTogetherModeBackground");return r.createElement(p.CallButton,{key:_.CallControlsKeys.ChangeScene,style:le.modernSecondaryCallControlsUIElement,icon:ie.default.getBackgroundChangeButtonIcon(),accessibilityLabel:e,size:p.CallButtonSize.ExtraSmall,onPress:this._onTogetherModeBackgroundChangeButtonPress,anchorAccessibilityLabel:e,colorConfig:this._colorConfig(),caption:e})}_getAppropriateParticipantsButton(){return this.state.isOneOnOneCall?this._getAddParticipantsButton():this._getParticipantsButton()}_getParticipantsButton(){const e=this._getParticipantsTitle(),t=this.state.isHandRaised?r.createElement(r.View,{style:le.raiseHandImageWrapper},r.createElement(W.default,{type:W.RaiseHandImageType.SmallSizeTopLeftAligned})):void 0;return r.createElement(p.CallButton,{key:_.CallControlsKeys.Participants,style:le.modernSecondaryCallControlsUIElement,icon:Y.SkypeIcon.ContactGroupTwoPersonas,accessibilityLabel:e,size:p.CallButtonSize.ExtraSmall,onPress:this._onParticipantsButtonPress,anchorAccessibilityLabel:e,colorConfig:this._getParticipantsButtonColorConfig(),caption:e,additionalImage:t,borderWidth:2})}_getParticipantsButtonColorConfig(){if(this.state.isHandRaised){const e=$.Color.raiseHandOrange;if(this.state.useHighContrastTheme){const t=b.default.highContrastColorConfig(this._themeColors);return Object.assign(Object.assign({},t),{borderColor:e})}if(this.props.useLightTheme){const t=this._lightThemeColorConfig();return Object.assign(Object.assign({},t),{borderColor:e})}return{iconColor:$.Color.white,backgroundColor:$.Color.transparent,selectedIconColor:$.Color.white,selectedBackgroundColor:$.Color.transparent,borderColor:e}}return this._colorConfig()}_getAddParticipantsButton(){const e=this._getAddParticipantsTitle();return r.createElement(p.CallButton,{key:_.CallControlsKeys.Participants,style:le.modernSecondaryCallControlsUIElement,icon:Y.SkypeIcon.ContactAdd,accessibilityLabel:e,size:p.CallButtonSize.ExtraSmall,onPress:this._onAddParticipantsButtonPress,anchorAccessibilityLabel:e,colorConfig:this._colorConfig(),caption:e})}_getAddParticipantsTitle(){return x.getString("CallControls.AddParticipants")}_getParticipantsTitle(){return x.getString("CallControls.Participants")}_getReactionsDrawer(){const e={key:this.state.emoticonReactionKey,type:_.ReactionsItemType.Emoticon},t=this._getReactionPickerText(),i=x.getString("MeetNowCallControls.ReactionBarDrawerTitle"),a=this.state.isConnecting1on1?r.createElement(p.CallButton,{ref:this._setEngagementTooltipAnchor,size:p.CallButtonSize.ExtraSmall,icon:Y.SkypeIcon.HeartOutline,isDisabled:!0,caption:i,showToolTip:!0,colorConfig:this._colorConfig()}):r.createElement(m.default,{key:e.key,ref:this._onCallReactionsDrawerItemRef,info:e,isAnimated:!this.props.isHidden,importantForAccessibility:r.Types.ImportantForAccessibility.Yes,accessibilityLabel:t,onPress:this._onReactionsPickerPressed,onHover:this.state.isNavigatingWithKeyboard?void 0:this._onReactionsPickerHovered,caption:i,useDesktopCallControls:!0,useLightTheme:this.props.useLightTheme,hideIcon:this.state.isReactionsPickerSelected});return r.createElement(r.View,{key:_.CallControlsKeys.ReactionsDrawer,style:[le.reactionsPickerButton,le.modernSecondaryCallControlsUIElement]},a,this.state.showCustomizeReactionsPencilButton&&r.createElement(k.default,{styles:le.customCallReactionsButton,iconSize:Y.IconSize.size12,origin:A.CustomReactionsType.Call}))}_renderMoreButton(){const e=x.getString("CallControls.CallButtonOverflowMenu"),t=x.getString("Global.MoreButtonTitle"),i=this.state.enableNewMainCallControls&&this.props.controlsType===_.CallControlsType.DesktopMinSmallest;return r.createElement(p.CallButton,{key:_.CallControlsKeys.Overflow,style:le.modernSecondaryCallControlsUIElement,ref:this._onOverflowMenuButtonRef,icon:Y.SkypeIcon.More,accessibilityLabel:e,size:p.CallButtonSize.ExtraSmall,onPress:this._showOverflowMenuPopup,coachMarkType:this.state.isMinDesktop&&this.state.allowScreenSharing?I.CoachMarkType.CallPanelScreenShareButton:void 0,anchorAccessibilityLabel:e,colorConfig:this._colorConfig(),caption:i?void 0:t})}_getRecordCallButton(){const e=this.state.isRecording?x.getString("CallControlsOverFlowMenu.StopRecording"):x.getString("CallControlsOverFlowMenu.StartRecording"),t=this.state.isRecording?x.getString("MeetNowCallControls.StopRecording"):x.getString("MeetNowCallControls.StartRecording"),i=this.props.useLightTheme?$.Color.gray400:$.Color.white,a=this.state.isRecording?[{icon:Y.SkypeIcon.CallRecordStroke,color:i},{icon:Y.SkypeIcon.CallRecordDot,color:$.Color.red}]:[{icon:Y.SkypeIcon.CallRecord,color:i}];return r.createElement(p.CallButton,{key:_.CallControlsKeys.Record,icon:a,accessibilityLabel:e,isDisabled:!this.state.allowRecording,size:p.CallButtonSize.ExtraSmall,colorConfig:this._colorConfig(),onPress:this.props.onRecordCallPress,caption:t})}_getSnapshotButton(){const e=this._getSnapshotText();return r.createElement(p.CallButton,{key:_.CallControlsKeys.Moments,icon:b.default.getMomentsIcon(),accessibilityLabel:e,title:e,showToolTip:!0,size:p.CallButtonSize.ExtraSmall,coachMarkType:this.state.isReceivingScreensharing?I.CoachMarkType.CallPanelPhotoMomentsForScreenShare:I.CoachMarkType.CallPanelPhotoMoments,anchorAccessibilityLabel:e,colorConfig:this._colorConfig(),onAnchorPress:this.props.onMomentsPress,onPress:this.props.onMomentsPress})}_isUnreadInCallIncomingMessageAndPhoto(){const e=T.getReactionsThreadMriForCallId(this.props.callId);return S.default.getUnseenIncomingTextCount(e)>0||S.default.getUnseenIncomingPhotoCount(e)>0}_colorConfig(){return this.state.useHighContrastTheme?b.default.highContrastColorConfig(this._themeColors):this.props.useLightTheme?this._lightThemeColorConfig():void 0}_lightThemeColorConfig(){return{iconColor:$.Color.gray400,backgroundColor:$.Color.transparent,selectedIconColor:$.Color.white,selectedBackgroundColor:$.Color.gray400,borderColor:$.Color.transparent,captionColor:$.Color.gray400,showHoverEffect:!0}}_getRaiseOrLowerHandButton(e){const{key:t,icon:i,buttonLabel:a,a11yLabel:n,onButtonPress:o}=e?this._getRaiseHandProps():this._getLowerHandProps();return r.createElement(p.CallButton,{key:t,style:le.modernSecondaryCallControlsUIElement,icon:i,title:a,size:p.CallButtonSize.ExtraSmall,isToggledOn:this.state.isHandRaisedForCurrentUser,onPress:o,accessibilityLabel:n,colorConfig:this._colorConfig(),anchorAccessibilityLabel:n,caption:a,isDisabled:!(this.state.callState===l.CallState.Connected)})}_getRaiseHandProps(){const e=x.getString("CallControls.RaiseHand"),t=x.getString("CallControls.RaiseHandLabel"),i=this._onRaiseHandPressed,a=Y.SkypeIcon.RaiseHand;return{key:_.CallControlsKeys.RaiseHand,icon:a,buttonLabel:e,a11yLabel:t,onButtonPress:i}}_getLowerHandProps(){const e=x.getString("CallControls.LowerHand"),t=x.getString("CallControls.LowerHandLabel"),i=this._onLowerHandPressed,a=Y.SkypeIcon.LowerHand;return{key:_.CallControlsKeys.LowerHand,icon:a,buttonLabel:e,a11yLabel:t,onButtonPress:i}}focusCallEndButton(){this._mainCallControls&&this._mainCallControls.focusCallEndButton()}_getOverflowMenuItemsForCommands(e){const t=a.map(e,e=>{const t=this._menuTextForCommand(e),i=this._menuIconForCommand(e);return t?{text:t,command:e,icon:i}:void 0});return a.compact(t)}_menuIconForCommand(e){switch(e){case re.OverflowMenuCommands.BackgroundEffectsSettings:case re.OverflowMenuCommands.Blur:case re.OverflowMenuCommands.Unblur:return M.SXMenuIcon.BlurBackground;case re.OverflowMenuCommands.StopSharing:return M.SXMenuIcon.ScreenshareOff;case re.OverflowMenuCommands.ShareScreen:case re.OverflowMenuCommands.ShareScreenAndSounds:return M.SXMenuIcon.Screenshare;case re.OverflowMenuCommands.SwitchScreen:return M.SXMenuIcon.ViewSwitch;case re.OverflowMenuCommands.ScreenShareControl:return M.SXMenuIcon.ScreenSharingRequestControl;case re.OverflowMenuCommands.StopScreenShareControl:return M.SXMenuIcon.ScreenSharingStopControl;case re.OverflowMenuCommands.Snap:return M.SXMenuIcon.Snapshot;case re.OverflowMenuCommands.React:return M.SXMenuIcon.React;case re.OverflowMenuCommands.RaiseHand:return M.SXMenuIcon.RaiseHand;case re.OverflowMenuCommands.LowerHand:return M.SXMenuIcon.LowerHand;case re.OverflowMenuCommands.OnAddToCall:return M.SXMenuIcon.SkypeContacts;case re.OverflowMenuCommands.OnShowParticipants:return M.SXMenuIcon.ContactGroupPair;case re.OverflowMenuCommands.OnShowAudioSettings:case re.OverflowMenuCommands.OnShowAVSettings:case re.OverflowMenuCommands.CallStats:return M.SXMenuIcon.Settings;case re.OverflowMenuCommands.Invite:return M.SXMenuIcon.AddSkypeContacts;case re.OverflowMenuCommands.HoldCall:return M.SXMenuIcon.HoldCall;case re.OverflowMenuCommands.ResumeCall:return M.SXMenuIcon.ResumeCall;case re.OverflowMenuCommands.StartRecording:case re.OverflowMenuCommands.StopRecording:return M.SXMenuIcon.Record;case re.OverflowMenuCommands.StartCaptions:case re.OverflowMenuCommands.StopCaptions:return M.SXMenuIcon.Subtitles;case re.OverflowMenuCommands.EnableIncomingVideo:return M.SXMenuIcon.VideoEnable;case re.OverflowMenuCommands.DisableIncomingVideo:return M.SXMenuIcon.VideoOff;case re.OverflowMenuCommands.MuteEveryone:return M.SXMenuIcon.MicrophoneOff;case re.OverflowMenuCommands.ChangeTogetherModeBackground:return M.SXMenuIcon.Picture;case re.OverflowMenuCommands.BingBackgrounds:return M.SXMenuIcon.Bing;default:return}}_menuTextForCommand(e){switch(e){case re.OverflowMenuCommands.Blur:case re.OverflowMenuCommands.Unblur:return C.default.DeviceStore.isBackgroundBlurred()?x.getString("CallControls.CallMenuUnBlurBackground"):x.getString("CallControls.CallMenuBlurBackground");case re.OverflowMenuCommands.StopSharing:case re.OverflowMenuCommands.ShareScreen:return this.state.isScreenShareActive?x.getString("CallControlsOverFlowMenu.StopShareScreen"):x.getString("CallControlsOverFlowMenu.ShareScreen");case re.OverflowMenuCommands.ShareScreenAndSounds:return x.getString("CallControlsOverFlowMenu.ShareScreenAndSounds");case re.OverflowMenuCommands.ScreenShareControl:return x.getString("CallControls.CallButtonRequestScreenShareControl");case re.OverflowMenuCommands.StopScreenShareControl:return x.getString("CallControls.CallButtonStopScreenShareControlFromViewer");case re.OverflowMenuCommands.SwitchScreen:return this.state.windowSharingEnabled?x.getString("CallControlsOverFlowMenu.SwitchScreenOrWindow"):x.getString("CallControlsOverFlowMenu.SwitchScreen");case re.OverflowMenuCommands.Snap:return this._getSnapshotText();case re.OverflowMenuCommands.React:return this._getReactionPickerText();case re.OverflowMenuCommands.RaiseHand:return x.getString("CallControls.RaiseHandLabel");case re.OverflowMenuCommands.LowerHand:return x.getString("CallControls.LowerHandLabel");case re.OverflowMenuCommands.OnAddToCall:return this._getAddParticipantsTitle();case re.OverflowMenuCommands.OnShowParticipants:return this._getParticipantsTitle();case re.OverflowMenuCommands.OnShowAudioSettings:return x.getString("CallControlsOverFlowMenu.AdjustAudioSettings");case re.OverflowMenuCommands.OnShowAVSettings:return x.getString("CallControlsOverFlowMenu.AdjustAVSettings");case re.OverflowMenuCommands.BackgroundEffectsSettings:return x.getString("CallControlsOverFlowMenu.BackgroundEffectsSettings");case re.OverflowMenuCommands.HoldCall:return x.getString("CallControlsOverFlowMenu.HoldCall");case re.OverflowMenuCommands.ResumeCall:return x.getString("CallControlsOverFlowMenu.ResumeCall");case re.OverflowMenuCommands.StartRecording:return x.getString("CallControlsOverFlowMenu.StartRecording");case re.OverflowMenuCommands.StopRecording:return x.getString("CallControlsOverFlowMenu.StopRecording");case re.OverflowMenuCommands.StartCaptions:return x.getString("CallControlsOverFlowMenu.StartSubtitles");case re.OverflowMenuCommands.StopCaptions:return x.getString("CallControlsOverFlowMenu.StopSubtitles");case re.OverflowMenuCommands.EnableIncomingVideo:return x.getString("CallControlsOverFlowMenu.StartIncomingVideo");case re.OverflowMenuCommands.DisableIncomingVideo:return x.getString("CallControlsOverFlowMenu.StopIncomingVideo");case re.OverflowMenuCommands.CallStats:return x.getString("CallPanel.CallStats");case re.OverflowMenuCommands.Invite:return x.getString("MeetNow.ShareInvite");case re.OverflowMenuCommands.MuteEveryone:return x.getString("CallControls.CallButtonMuteEveryone");case re.OverflowMenuCommands.ChangeTogetherModeBackground:return x.getString("CallControlsOverFlowMenu.ChangeTogetherModeBackground");case re.OverflowMenuCommands.BingBackgrounds:return x.getString("CallControls.BingBackgrounds");default:return}}_onSwitchScreen(e){this._stopScreenSharing().then(()=>{this._startBrowserScreenSharing(e),f.default.updateCallTelemetry(this.props.callId,e,e=>e.switchScreenWhileSharing())})}_onShareScreen(e){this._startBrowserScreenSharing(e)}_startBrowserScreenSharing(e){L.log(V.LogTraceArea.CallingUI,"DesktopCallControls._startBrowserScreenSharing for browser causeId: "+e),this._shouldDisableVideoDuringScreenSharing()&&this.state.isVideoActive?C.default.CallingStore.stopVideo(this.props.callId,e).then(()=>{this.props.showHideOutgoingVideoDisabledToast(!0,e),this._startScreenSharing(e,!1,void 0,void 0)}):this._startScreenSharing(e,!1,void 0,void 0)}_shouldDisableVideoDuringScreenSharing(){return!0}_startScreenSharing(e,t,i,a){C.default.CallingStore.startScreenSharing(this.props.callId,e,i,t).catch(t=>{t&&"permissionDeniedError"===t.type&&f.default.updateCallTelemetry(this.props.callId,e,e=>{e.cancelScreenSharing()})}),this._currentScreenSharingSource=i,this._currentScreenSharingSourceType=a,f.default.updateCallTelemetry(this.props.callId,e,e=>{e.startScreenSharing(),t&&e.startSoundSharing()}),a&&this._incrementSourceTypeTelemetryCounts(a,e)}_incrementSourceTypeTelemetryCounts(e,t){f.default.updateCallTelemetry(this.props.callId,t,t=>e===l.SharingSourceType.Monitor?t.wholeScreenSharedCount():t.appWindowSharedCount())}_registerKeyboardHandlers(){O.default.addHandler(V.KeyboardShortcut.OpenDialpad,this._togglePstnDialpadShortcut)}_unregisterKeyboardHandlers(){O.default.removeHandler(V.KeyboardShortcut.OpenDialpad,this._togglePstnDialpadShortcut)}_startRecording(){const e=ae.default.newCauseId();L.log(V.LogTraceArea.CallingUI,"DesktopCallControls._startRecording causeId: "+e),C.default.InCallBotService.startRecording(this.props.callId,e)}_stopRecording(){const e=ae.default.newCauseId();L.log(V.LogTraceArea.CallingUI,"DesktopCallControls._stopRecording causeId: "+e),C.default.InCallBotService.stopRecording(this.props.callId,e)}_startTranslator(){const e=ae.default.newCauseId();L.log(V.LogTraceArea.CallingUI,"DesktopCallControls._startTranslator causeId: "+e),b.default.announceSubtitleState(!0,!1),C.default.InCallBotService.startTranslator(this.props.callId,e).then(()=>{b.default.announceSubtitleState(!0,!0)}).catch(t=>{L.log(V.LogTraceArea.CallingUI,"DesktopCallControls._startTranslator error: "+Q.default.errorAsString(t)+" causeId: "+e)})}_stopTranslator(){const e=ae.default.newCauseId();L.log(V.LogTraceArea.CallingUI,"DesktopCallControls._stopTranslator causeId: "+e),b.default.announceSubtitleState(!1,!1),C.default.InCallBotService.stopTranslator(this.props.callId,e).then(()=>{b.default.announceSubtitleState(!1,!0)})}_enableIncomingVideo(){const e=ae.default.newCauseId();L.log(V.LogTraceArea.CallingUI,"DesktopCallControls._startIncomingVideo causeId: "+e),this.state.audioOnlyEnabled?C.default.CallingStore.stopAudioOnly(this.props.callId,e):C.default.CallingStore.enableIncomingVideo(this.props.callId,e).then(()=>{b.default.announceIncomingVideoAllowanceState(!0)})}_disableIncomingVideo(){const e=ae.default.newCauseId();L.log(V.LogTraceArea.CallingUI,"DesktopCallControls._stopIncomingVideo causeId: "+e),C.default.CallingStore.disableIncomingVideo(this.props.callId,e).then(()=>{b.default.announceIncomingVideoAllowanceState(!1)})}}t.default=ce},3668:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(7),n=i(3669),o=i(29),s=i(4),r=i(31);t.default=class{constructor(){this._speaksFor=0,this._notSpeaksFor=0,this._lastLoweredHand=0,this._handFalselyLowered=!1,this._avgNoiseLevel=900,this._checkIfSpeaking=()=>this._autoLowerHandConfig.hardcodedNoiseValue?o.default.DeviceStore.getMicrophoneVolumeLevel().then(e=>e&&e>this._autoLowerHandConfig.hardcodedNoiseValue&&!o.default.CallingStore.isMutedNoSubscription(this._callId)):o.default.DeviceStore.getMicrophoneNrgLevels().then(e=>e&&e>this._avgNoiseLevel*this._autoLowerHandConfig.noiseMultiplayer&&!o.default.CallingStore.isMutedNoSubscription(this._callId))}startAutoLowerHand(e,t){if(this._callId=e,this._lowerHandCommand=t,this._autoLowerHandConfig=a.default.getS4LCMCFeatures().autoLowerHandConfig,this.cleanSpeakingTimer(),this._setAvgNoiseLevel(),!this._handFalselyLowered){Date.now()-this._lastLoweredHand<=this._autoLowerHandConfig.failPeriod&&(this._handFalselyLowered=!0,s.track(new n.WronglyLoweredHandEvent));const e=this._autoLowerHandConfig.measurmentInterval;this._speakingTimer=r.default.setInterval(()=>{this._checkIfSpeaking().then(t=>{t?(this._speaksFor+=e,this._notSpeaksFor=0,this._speaksFor===this._autoLowerHandConfig.speakingTimeThreshold&&(this._lowerHandAutomatically(),this._lastLoweredHand=Date.now())):(this._notSpeaksFor+=e,this._notSpeaksFor>=this._autoLowerHandConfig.notSpeakingTimeThreshold&&(this._speaksFor=0))})},e)}}trackManuallyLowerHand(){this._handFalselyLowered||s.track(new n.ManuallyLoweredHandEvent),this.cleanSpeakingTimer()}_setAvgNoiseLevel(){const e=this._autoLowerHandConfig.measurmentInterval,t=this._autoLowerHandConfig.noiseMeasurmentThreshold;let i=0,a=0;this._noiseMeasurmentTimer=r.default.setInterval(()=>{o.default.DeviceStore.getMicrophoneNrgLevels().then(n=>{i+=n||0,a+=e,a===t&&(this._avgNoiseLevel=i/(t/e),r.default.clearInterval(this._noiseMeasurmentTimer))})},e)}_lowerHandAutomatically(){this._lowerHandCommand.execute(),s.track(new n.AutoLoweredHandEvent),this.cleanSpeakingTimer()}cleanSpeakingTimer(){this._speakingTimer&&(r.default.clearInterval(this._speakingTimer),this._speakingTimer=void 0,this._speaksFor=0)}}},3670:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(74),s=i(3671),r=i(384),l=i(331),c=i(1786),d=i(29),u=i(60),h=i(110),p=i(13),g=i(280),C=i(144),m=i(3),S=i(41),y=i(4),f=i(229),_=i(125),b=i(6),v=i(5),w=i(52),T=i(18),I=i(55),P=i(22),M=i(9),k=i(11),A=i(12),R=i(100),V=i(10),E=i(3678),L=b.lazyProperties({container:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"visible",alignSelf:"center",top:0}),newContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"stretch",justifyContent:"center",overflow:"visible",alignSelf:"center",top:0,marginHorizontal:10,backgroundColor:M.Color.gray400,borderRadius:20}),newContainerLightTheme:()=>n.Styles.createViewStyle({backgroundColor:M.Color.gray100Overlay80}),buttonPopupContainer:()=>n.Styles.createViewStyle({position:"absolute",bottom:0}),newButtonPopupContainer:()=>n.Styles.createViewStyle({}),divider:()=>n.Styles.createViewStyle({width:1,marginHorizontal:8,marginVertical:7,backgroundColor:M.Color.whiteOverlay30}),invisibleDivider:()=>n.Styles.createViewStyle({width:8}),chevron:()=>n.Styles.createViewStyle({justifyContent:"center",alignItems:"center",paddingHorizontal:4})});class B extends A.default{constructor(){super(...arguments),this._onMicButtonPopupRef=e=>{this._micButtonPopup=e||void 0},this._onVideoButtonPopupRef=e=>{this._videoButtonPopup=e||void 0},this._onCallEndButtonRef=e=>{this._callEndButton=e||void 0,this._callEndButton&&this.isComponentMounted()&&a.defer(()=>{this.focusCallEndButton()})},this._onMicButtonPopupClosed=()=>{this.setState({isMicPopupOpen:!1})},this._onVideoButtonPopupClosed=()=>{this.setState({isVideoPopupOpen:!1})},this._onMicButtonPopupAnchor=e=>{this._micButtonPopupAnchor=e||void 0},this._onVideoButtonPopupAnchor=e=>{this._videoButtonPopupAnchor=e||void 0,P.EnsureStarted(g.default).then(()=>{g.default.setAnchor(C.EngagementTooltipType.CallVideoSettings,e)})},this._onVideoButtonHover=e=>{this._videoButtonPopup&&(e?this._videoButtonPopup.onAnchorEnter():this._videoButtonPopup.onAnchorLeave())},this._onMicHover=e=>{this._micButtonPopup&&(e?this._micButtonPopup.onAnchorEnter():this._micButtonPopup.onAnchorLeave())},this._onMicQuickSettings=()=>{this.setState({isMicPopupOpen:!this.state.isMicPopupOpen},()=>{this._micButtonPopup&&(this.state.isMicPopupOpen?this._micButtonPopup.showImmediately():this._micButtonPopup.hideImmediately())})},this._onVideoQuickSettings=()=>{this.setState({isVideoPopupOpen:!this.state.isVideoPopupOpen},()=>{this._videoButtonPopup&&(this.state.isVideoPopupOpen?this._videoButtonPopup.showImmediately():this._videoButtonPopup.hideImmediately())})},this._onMicButtonLongPress=e=>{e.stopPropagation(),e.preventDefault(),this._micButtonPopup&&this._micButtonPopup.onAnchorLongPress()},this._onVideoButtonLongPress=e=>{e.stopPropagation(),e.preventDefault(),this._videoButtonPopup&&this._videoButtonPopup.onAnchorLongPress()},this._onToggleMicrophone=()=>{this._micButtonPopup&&this._micButtonPopup.onAnchorPress(),new l.ToggleMuteCommand(this.props.callId,this.state.isMuted,this.state.isServerMuted,!!this.props.disableMic,this._getRootViewId()).execute(),this.props.onInteracting(!1)},this._onToggleVideo=()=>{const e=V.default.newCauseId();this._videoButtonPopup&&this._videoButtonPopup.onAnchorPress(),this.state.isAwaitingCameraConfirmation?(d.default.CallControlsStore.setIsAwaitingCameraConfirmation(!1),d.default.DeviceStore.choosePreselectedDevices(e)):(this._videoCommand.execute(),this.props.onInteracting(!1))},this._onEndCallButtonLongPress=e=>{this._onContextMenuPress(e)},this._onEndCallButtonPress=()=>{const e=V.default.newCauseId();y.log(m.LogTraceArea.CallingUI,"DesktopCallControls._onEndCallButtonPress "+e),this._endCall(!1,e)},this._onContextMenuPress=e=>{e.stopPropagation(),e.preventDefault(),c.default.showEndCallMenuPopup(this._getRootViewId(),e,this._getAnchorForEndCallMenu,this._selectEndCallMenuItem)},this._getAnchorForEndCallMenu=()=>this._callEndButton,this._selectEndCallMenuItem=e=>{c.default.selectEndCallMenuItem(e,this._getRootViewId(),this._endCall)},this._endCall=(e,t)=>{if(y.log(m.LogTraceArea.CallingUI,"DesktopCallControls._endCall forEveryone: "+e+" causeId: "+t),e)this._endCallForAllCommand.execute();else{new l.EndCallCommand(this.props.callId,this.props.onEndCallFailure).execute()}},this._showAVSettings=()=>{const e=V.default.newCauseId();y.log(m.LogTraceArea.CallingUI,"DesktopMainCallControls._showAVSettings causeId: "+e),T.default.navigateToDesktopSettingsGroup(I.SettingsGroup.AudioVideoSettings,this._getRootViewId(),e)}}_buildState(e,t){return this._videoCommand=new l.ToggleVideoCommand(e.callId,e),this._endCallForAllCommand=new l.EndCallForEveryoneCommand(e.callId,e,e.callUIState,e.onEndCallFailure),{isMuted:h.default.isLocalOrServerMuted(e.callId),isServerMuted:d.default.CallingStore.isServerMuted(e.callId),isVideoButtonEnabled:this._videoCommand.canExecute(),isVideoActive:d.default.CallingStore.isProvidingVideo(e.callId),callState:d.default.CallingStore.getCallState(e.callId),isNavigatingWithKeyboard:f.default.isNavigatingWithKeyboard(),enableNewMainCallControls:d.default.CallingFeaturesHelper.areNewMainCallControlsEnabled(),useHighContrastTheme:h.default.useHighContrastThemeAndChanges(),isAwaitingCameraConfirmation:d.default.CallControlsStore.isAwaitingCameraConfirmation(),allowEndCallForEveryone:this._endCallForAllCommand.canExecute(),isScreenShareActive:d.default.CallingStore.isScreenSharing(e.callId),primaryColor:w.default.getPrimaryColor()}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),t.isServerMuted||!this.state.isServerMuted||this.state.isMuted||h.default.announceMicrophoneState(!0,!0),this._logMuteStateChanges(t)}componentDidMount(){super.componentDidMount(),a.delay(()=>{a.delay(()=>{this.isComponentMounted()&&this.focusCallEndButton()},100)},100)}render(){let e;const t=this.state.enableNewMainCallControls?L.newButtonPopupContainer:L.buttonPopupContainer;let i;return this.state.isNavigatingWithKeyboard&&!this.state.enableNewMainCallControls||(e=n.createElement(s.default,{colorThemeOverride:this.props.useLightTheme?R.Theme.Colorful:R.Theme.ColorfulDark,ref:this._onMicButtonPopupRef,style:t,callId:this.props.callId,onClosed:this._onMicButtonPopupClosed,isSticky:this.state.enableNewMainCallControls,popupId:"AudioSettingsPopup",anchor:()=>this._micButtonPopupAnchor})),this.state.isNavigatingWithKeyboard&&!this.state.enableNewMainCallControls||(i=n.createElement(E.default,{colorThemeOverride:this.props.useLightTheme?R.Theme.Colorful:R.Theme.ColorfulDark,ref:this._onVideoButtonPopupRef,style:t,callId:this.props.callId,isVideoButtonEnabled:this.state.isVideoButtonEnabled,onClosed:this._onVideoButtonPopupClosed,isVideoDisabledDuringScreenSharing:this._isVideoDisabledDuringScreenSharing(),onChangeBackgroundPress:this._showAVSettings,isOutgoingVideoDisabled:this.props.isOutgoingVideoDisabled,isSticky:this.state.enableNewMainCallControls,popupId:"VideoSettingsPopup",anchor:()=>this._videoButtonPopupAnchor,useLightTheme:this.props.useLightTheme})),this.state.enableNewMainCallControls?this._renderNewMainCallControls(e,i):n.createElement(n.View,{style:[L.container],ignorePointerEvents:!0},e,i,this._getMicButton(),this._getVideoOrDialpadButton(),this._getHangUpButton())}_shouldRenderVideoButton(){return!this.props.isPSTNCall&&!this.props.isEncryptedCall}_getVideoOrDialpadButton(){return this._shouldRenderVideoButton()?this._getVideoButton():this.props.isPSTNCall?this._getDialPadButton():void 0}_renderNewMainCallControls(e,t){const i=[L.newContainer,this.props.useLightTheme?L.newContainerLightTheme:void 0],a=d.default.CallingFeaturesHelper.isOutgoingVideoDisabled();let o,s;return this._shouldRenderVideoButton()?o=[this._getVideoButton(),this._getInvisibleDivider(),this._getChevronButton(u.CallControlsKeys.VideoQuickSettings,v.getString("CallControls.CallButtonCameraQuickSettings"),this.state.isVideoPopupOpen?p.FontWeight.bold:p.FontWeight.regular,this._onVideoQuickSettings,this._onVideoButtonPopupAnchor,a),this._getDivider()]:this.props.isPSTNCall&&(s=[this._getDialPadButton(),this._getDivider()]),n.createElement(n.View,{style:i,ignorePointerEvents:!0},e,t,this._getMicButton(),this._getInvisibleDivider(),this._getChevronButton(u.CallControlsKeys.MicQuickSettings,v.getString("CallControls.CallButtonMicrophoneQuickSettings"),this.state.isMicPopupOpen?p.FontWeight.bold:p.FontWeight.regular,this._onMicQuickSettings,this._onMicButtonPopupAnchor),this._getDivider(),this._shouldRenderVideoButton()?o:s,this._getHangUpButton())}_getInvisibleDivider(){return n.createElement(n.View,{style:[L.invisibleDivider]})}_getDivider(){return this.props.useLightTheme?this._getInvisibleDivider():n.createElement(n.View,{style:[L.divider]})}_getMicButton(){const e=v.getString(this.state.isMuted?"CallControls.CallButtonUnmuteLabel":"CallControls.CallButtonMute"),t=_.default.generateTooltipLabelWithShortcutForCondition(e,m.KeyboardShortcut.ToggleMicrophone);let i=this._colorConfig();return this.props.useLightTheme&&!i&&(i=this.state.isMuted?this._lightThemeDeviceOffColorConfig():this._lightThemeDeviceOnColorConfig()),n.createElement(r.CallButton,{key:u.CallControlsKeys.Mic,icon:this.state.isMuted?k.SkypeIcon.MicrophoneOff:k.SkypeIcon.Microphone,title:t,size:r.CallButtonSize.Small,isToggledOn:!this.state.isMuted,onPress:this._onToggleMicrophone,onHover:this._onMicHover,onLongPress:this._onMicButtonLongPress,accessibilityLabel:e,backgroundStyle:this.state.isMuted?r.CallButtonBackgroundStyle.Solid:r.CallButtonBackgroundStyle.Overlay,colorConfig:i,doNotAddHorizontalMargin:this.state.enableNewMainCallControls})}_getChevronButton(e,t,i,a,o,s){return n.createElement(S.default,{ref:o,key:e,icon:k.SkypeIcon.UpChevron,title:t,disabled:s,size:k.IconSize.size12,onPress:a,accessibilityLabel:t,hoverColor:this.props.useLightTheme?M.Color.gray400Overlay50:M.Color.whiteOverlay50,color:this.props.useLightTheme?M.Color.gray400:M.Color.white,style:L.chevron})}_getVideoButton(){let e,t;this.props.isOutgoingVideoDisabled?e=t=v.getString("AudioVideoSettings.OutgoingVideoDisabled"):(e=v.getString(this.state.isVideoActive?"CallControls.CallButtonTurnOffVideoLabel":"CallControls.CallButtonTurnOnVideoLabel"),t=_.default.generateTooltipLabelWithShortcutForCondition(e,m.KeyboardShortcut.ToggleCamera));let i=this.state.isAwaitingCameraConfirmation?this._cameraConfirmColorConfig():void 0;return this.props.useLightTheme&&!i&&(i=this.state.isVideoActive?this._lightThemeDeviceOnColorConfig():this._lightThemeDeviceOffColorConfig()),n.createElement(r.CallButton,{ref:this.props.onVideoButtonRef,key:u.CallControlsKeys.Video,icon:this.state.isAwaitingCameraConfirmation?k.SkypeIcon.Ok:this.state.isVideoActive?k.SkypeIcon.Video:k.SkypeIcon.VideoOff,title:t,size:r.CallButtonSize.Small,isDisabled:!this.state.isVideoButtonEnabled,isToggledOn:this.state.isVideoActive,onPress:this._onToggleVideo,onHover:this._onVideoButtonHover,onLongPress:this._onVideoButtonLongPress,accessibilityLabel:e,backgroundStyle:this.state.isVideoActive?r.CallButtonBackgroundStyle.Overlay:r.CallButtonBackgroundStyle.Solid,colorConfig:i,doNotAddHorizontalMargin:this.state.enableNewMainCallControls})}_getDialPadButton(){const e=v.getString("CallPanel.DialpadTooltipTitle");return n.createElement(r.CallButton,{key:u.CallControlsKeys.Dialpad,icon:k.SkypeIcon.Dialpad,title:e,size:r.CallButtonSize.Small,isDisabled:!(this.state.callState===o.CallState.Connected||this.state.callState===o.CallState.EarlyMedia),isToggledOn:!0,onPress:this.props.onOpenDialpad,accessibilityLabel:e,backgroundStyle:r.CallButtonBackgroundStyle.Overlay,colorConfig:this._colorConfig(),doNotAddHorizontalMargin:this.state.enableNewMainCallControls})}_getHangUpButton(){const e=v.getString("CallControls.CallButtonEndCall"),t=_.default.generateTooltipLabelWithShortcutForCondition(e,m.KeyboardShortcut.HangupOrRejectCall);return n.createElement(r.CallButton,{key:u.CallControlsKeys.EndCall,ref:this._onCallEndButtonRef,icon:k.SkypeIcon.CallEnd,title:t,size:r.CallButtonSize.Small,isToggledOn:!1,isCallEndButton:!0,onPress:this._onEndCallButtonPress,onLongPress:this.state.allowEndCallForEveryone?this._onEndCallButtonLongPress:void 0,onContextMenu:this.state.allowEndCallForEveryone?this._onContextMenuPress:void 0,accessibilityLabel:e,colorConfig:this._colorConfig(),doNotAddHorizontalMargin:this.state.enableNewMainCallControls})}focusCallEndButton(){this._callEndButton&&this.isComponentMounted()&&this.state.isNavigatingWithKeyboard&&this._callEndButton.requestFocus()}_isVideoDisabledDuringScreenSharing(){return this.props.shouldDisableVideoDuringScreenSharing&&this.state.isScreenShareActive}_logMuteStateChanges(e){this.state.isMuted!==e.isMuted&&y.log(m.LogTraceArea.CallingUI,`DesktopMainCallControls.componentDidUpdate, isMuted - ${e.isMuted} to ${this.state.isMuted}`),this.state.isServerMuted!==e.isServerMuted&&y.log(m.LogTraceArea.CallingUI,`DesktopMainCallControls.componentDidUpdate, isServerMuted - ${e.isServerMuted} to ${this.state.isServerMuted}`)}_colorConfig(){return this.state.useHighContrastTheme?h.default.highContrastColorConfig(this._themeColors):void 0}_cameraConfirmColorConfig(){return{iconColor:M.Color.white,backgroundColor:M.Color.blue,selectedIconColor:M.Color.white,selectedBackgroundColor:M.Color.blue}}_lightThemeDeviceOnColorConfig(){return{iconColor:M.Color.white,backgroundColor:this.state.primaryColor,selectedIconColor:M.Color.white,selectedBackgroundColor:this.state.primaryColor,showHoverEffect:!0}}_lightThemeDeviceOffColorConfig(){return{iconColor:M.Color.gray400,backgroundColor:M.Color.transparent,selectedIconColor:M.Color.gray400,selectedBackgroundColor:M.Color.transparent,showHoverEffect:!0}}}t.default=B},3671:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(437),o=i(29),s=i(88),r=i(87),l=i(67),c=i(1782),d=i(6),u=i(5),h=i(1783),p=i(1785),g=i(16),C=d.lazyProperties({popupContainer:()=>a.Styles.createViewStyle({width:300,paddingHorizontal:15,borderRadius:5,opacity:.85}),popupTitleRow:()=>a.Styles.createTextStyle({marginTop:15,flexDirection:"row",justifyContent:"space-between"})});class m extends c.HoverPopup{constructor(){super(...arguments),this._allowShowPopup=()=>this._defaultAllowShowPopupConditions()&&!this.state.isAwaitingCameraConfirmation,this._allowHidePopup=()=>this._defaultAllowHidePopupConditions(),this._onMicrophoneSelected=e=>{r.default.updateCallAudioSettingsPopupEvent(t=>{e&&t.markDidChangeMicDevice()})},this._onSpeakerSelected=e=>{r.default.updateCallAudioSettingsPopupEvent(t=>{e&&t.markDidChangeSpeakerDevice()})},this._onAdjustSpeakerVolume=()=>{r.default.updateCallAudioSettingsPopupEvent(e=>e.markDidAdjustSpeakerVolume())},this._onAdjustMicVolume=()=>{r.default.updateCallAudioSettingsPopupEvent(e=>e.markDidAdjustMicVolume())}}_buildState(e,t){return Object.assign(Object.assign({},super._buildState(e,t)),{isAwaitingCameraConfirmation:o.default.CallControlsStore.isAwaitingCameraConfirmation()})}componentWillUnmount(){super.componentWillUnmount(),this.onClosed()}renderContent(){return a.createElement(a.View,{style:[C.popupContainer,this._themeStyles.primaryBackgroundColorStyle]},a.createElement(a.View,{style:C.popupTitleRow},a.createElement(g.Subtitle,null,u.getString("CallControlsOverFlowMenu.AdjustAudioSettings"))),a.createElement(h.default,{colorThemeOverride:this._currentTheme,hideAutoAdjustSetting:!0,micLevelMeterSteps:13,labelMaxWidth:166,onMicrophoneSelected:this._onMicrophoneSelected,onAdjustVolume:this._onAdjustMicVolume,origin:n.MicrophoneSettingsOrigin.InCallPopup}),a.createElement(l.default,{colorThemeOverride:this._currentTheme}),a.createElement(p.default,{colorThemeOverride:this._currentTheme,compactView:!0,labelMaxWidth:166,onSpeakerSelected:this._onSpeakerSelected,onAdjustVolume:this._onAdjustSpeakerVolume}))}popupDescription(){return"AudioSettings"}onOpened(e){r.default.setCallAudioSettingsPopupEvent(new s.CallAudioSettingsPopup(this.props.callId,e)),o.default.CallControlsStore.setSettingsPopupVisibility(!0)}onClosed(){o.default.CallControlsStore.setSettingsPopupVisibility(!1)}}t.default=m},3672:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(45),s=i(218);class r extends o.default{constructor(){super(...arguments),this._checkIfContentDimensionsChanged=()=>{if(a.isUndefined(this._popupRef))return;const e=this._popupRef.getBoundingClientRect();a.isUndefined(this.state.prevContentRect)||Math.round(this.state.prevContentRect.width)===Math.round(e.width)&&Math.round(this.state.prevContentRect.height)===Math.round(e.height)||this.props.onContentDimensionsChanged&&this.props.onContentDimensionsChanged(),this.setState({prevContentRect:e})},this._onPopupRef=e=>{this._popupRef=e||void 0}}_buildState(e,t){const i={};return t&&(i.prevContentRect=void 0),i}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this._checkIfContentDimensionsChanged()}render(){return n.createElement("div",{ref:this._onPopupRef},n.createElement(s.default,{anchorPosition:this.props.anchorPosition,anchorOffset:this.props.anchorOffset,popupWidth:this.props.popupWidth,popupHeight:this.props.popupHeight,fillColor:this.props.fillColor,strokeColor:this.props.strokeColor,popupAccessibilityTitle:this.props.popupAccessibilityTitle,offset:this.props.offset},n.createElement(n.View,{style:this.props.style},this.props.renderContent())))}}t.default=r},3673:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(116),o=i(0),s=i(29),r=i(6),l=i(5),c=i(52),d=i(9),u=i(12),h=i(31),p=r.lazyProperties({progressContainer:()=>o.Styles.createViewStyle({height:20,flexDirection:"row",overflow:"hidden",marginBottom:10,alignSelf:"center",justifyContent:"center"}),progressDotContainer:()=>o.Styles.createViewStyle({width:21,height:20,overflow:"hidden",backgroundColor:d.Color.transparent}),progressDot:()=>o.Styles.createViewStyle({width:40,height:40,borderRadius:20,borderWidth:14,borderStyle:"solid",backgroundColor:d.Color.transparent,marginTop:-10,marginLeft:-10})});class g extends u.default{_buildState(e,t){return t?{level:0}:{}}componentDidMount(){super.componentDidMount(),this._timer=h.default.setInterval(()=>{s.default.DeviceStore.getMicrophoneVolumeLevel().then(e=>{this.isComponentMounted()&&this.setState({level:e||0})})},200)}componentWillUnmount(){super.componentWillUnmount(),this._timer&&(h.default.clearInterval(this._timer),this._timer=void 0)}render(){const e=this.props.steps||19,t=[p.progressDot];t.push(o.Styles.createViewStyle({borderColor:this.props.backgroundColor||this._themeColors.primaryBackgroundColor},!1));const i=a.range(e).map(i=>{const a=[t];return i*(1/e)>=this.state.level&&a.push(this._themeStyles.secondaryBackgroundColorStyle),o.createElement(o.View,{key:i.toString(),style:p.progressDotContainer},o.createElement(o.View,{style:a}))});return o.createElement(o.View,{accessibilityLabel:l.getString("AudioVideoSettings.MicrophoneLevelMeter"),accessibilityTraits:o.Types.AccessibilityTrait.Image,ariaRoleDescription:""},o.createElement(n.GradientView,{style:[p.progressContainer,this.props.style],colors:c.default.getGradientColorsNoSubscription(),direction:n.GradientDirection.LEFT},i))}}t.default=g},3674:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(29),n=i(5),o=i(1784);class s extends o.default{_getVolume(){return a.default.DeviceStore.getMicrophoneVolume()}_setVolume(e){a.default.DeviceStore.setMicrophoneVolume(100*e)}_getAccessibilityLabel(){return n.getString("CallControls.CallButtonMicrophoneVolumeLabel")}}t.default=s},3677:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(29),n=i(5),o=i(1784);class s extends o.default{_getVolume(){return a.default.DeviceStore.getSpeakerVolume()}_setVolume(e){a.default.DeviceStore.setSpeakerVolume(100*e)}_getAccessibilityLabel(){return n.getString("CallControls.CallButtonSpeakerVolumeLabel")}}t.default=s},3678:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(29),o=i(88),s=i(87),r=i(1787),l=i(13),c=i(1782),d=i(41),u=i(6),h=i(5),p=i(42),g=i(9),C=i(11),m=i(16),S=i(10),y=u.lazyProperties({popupContainer:()=>a.Styles.createViewStyle({width:300,paddingHorizontal:15,borderRadius:5,backgroundColor:g.Color.darkThemeBackgroundOverlay85}),popupContainerLightTheme:()=>a.Styles.createViewStyle({backgroundColor:g.Color.whiteOverlay90}),popupContainerBackground:()=>a.Styles.createViewStyle({backgroundColor:g.Color.darkThemeBackground}),popupTitleRow:()=>a.Styles.createTextStyle({marginTop:15,flexDirection:"row",justifyContent:"space-between"}),backgroundReplacementContainer:()=>a.Styles.createViewStyle({marginBottom:15})});class f extends c.HoverPopup{constructor(){super(...arguments),this._allowHidePopup=()=>this._defaultAllowHidePopupConditions()&&!this.state.isAwaitingConfirmation&&!this.state.shouldShowCloseButton,this._onClosePressed=()=>{this.state.shouldShowCloseButton&&this.setState({shouldShowCloseButton:!1},()=>{this._isAnchorHovered=!1,this._isAnchorLongPressed=!1,this._isPopupHovered=!1,this._hidePopup(!1)})},this._onCameraSelected=(e,t)=>{const i=S.default.newCauseId();e&&(n.default.CallControlsStore.setIsAwaitingCameraConfirmation(!0),s.default.updateCallVideoSettingsPopupEvent(e=>{e.markDidChangeCameraDevice()}),n.default.DeviceStore.preselectDevices({camera:t},i))},this._onToggleBlur=e=>{s.default.updateCallVideoSettingsPopupEvent(t=>{e?t.toggleBlurOn():t.toggleBlurOff()})},this._onBackgroundChangePress=e=>{this.props.onChangeBackgroundPress&&this.props.onChangeBackgroundPress()}}_buildState(e,t){return Object.assign(Object.assign({},super._buildState(e,t)),{isAwaitingConfirmation:n.default.CallControlsStore.isAwaitingCameraConfirmation(),enableBackgroundReplacement:n.default.DeviceStore.isBackgroundReplacementEnabled()})}componentWillUnmount(){super.componentWillUnmount(),this.state.isAwaitingConfirmation&&n.default.CallControlsStore.setIsAwaitingCameraConfirmation(!1),this.onClosed()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),t.isAwaitingConfirmation&&!this.state.isAwaitingConfirmation&&this._hidePopup(!0)}renderContent(){const e={backgroundColor:g.Color.blue,textColor:g.Color.white},t=this.state.enableBackgroundReplacement&&a.createElement(a.View,{style:y.backgroundReplacementContainer},a.createElement(p.default,{buttonSize:l.SXButtonSize.Medium,buttonStyle:l.SXButtonStyle.Custom,title:h.getString("AudioVideoSettings.CameraBackgroundReplacementLabel"),onPress:this._onBackgroundChangePress,buttonConfig:e,autoFocus:!1})),i=this.state.shouldShowCloseButton?a.createElement(d.default,{icon:C.SkypeIcon.ClosePanel,color:this._themeColors.primaryTextColor,hoverColor:this._themeColors.primaryIconColor,size:C.IconSize.size20,onPress:this._onClosePressed,title:h.getString("AudioVideoSettings.VideoSettingsClose")}):void 0;return a.createElement(a.View,{style:[y.popupContainer,this.props.useLightTheme?y.popupContainerLightTheme:void 0,this.props.isOutgoingVideoDisabled?y.popupContainerBackground:void 0]},a.createElement(a.View,{style:y.popupTitleRow},a.createElement(m.Subtitle,null,h.getString("CallControlsOverFlowMenu.AdjustVideoSettings")),i),a.createElement(r.default,{colorThemeOverride:this._currentTheme,hideVideoLabel:!0,labelMaxWidth:166,onCameraSelected:this._onCameraSelected,onToggleBlur:this._onToggleBlur,forceVideoOnClose:!0,forceUpdateDefaultDevice:!1,skipVideoOnClose:this.state.isAwaitingConfirmation,overrideVideoPreviewDimensions:{width:270,height:150},isVideoDisabledDuringScreenSharing:this.props.isVideoDisabledDuringScreenSharing,showNewBackgroundReplacementUI:!1,isOutgoingVideoDisabled:this.props.isOutgoingVideoDisabled}),t)}popupDescription(){return"VideoSettings"}onOpened(e){s.default.setCallVideoSettingsPopupEvent(new o.CallVideoSettingsPopup(this.props.callId,e)),n.default.CallControlsStore.setSettingsPopupVisibility(!0),this.state.shouldShowCloseButton||this.props.isVideoButtonEnabled||this.setState({shouldShowCloseButton:!0})}onClosed(){n.default.CallControlsStore.setSettingsPopupVisibility(!1)}}t.default=f},3690:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DesktopSecondaryCallControlsManager=t.OverflowMenuCommands=void 0;const a=i(1),n=i(60),o=i(37),s=i(10);var r;!function(e){e.OnAddToCall="OnAddToCall",e.OnShowParticipants="OnShowParticipants",e.OnShowAVSettings="OnShowAVSettings",e.OnShowAudioSettings="OnShowAudioSettings",e.ShareScreen="ShareScreen",e.ShareScreenAndSounds="ShareScreenAndSounds",e.StopSharing="StopSharing",e.SwitchScreen="SwitchScreen",e.ScreenShareControl="ScreenShareControl",e.StopScreenShareControl="StopScreenShareControl",e.HoldCall="HoldCall",e.ResumeCall="ResumeCall",e.StartRecording="StartRecording",e.StopRecording="StopRecording",e.StartCaptions="StartCaptions",e.StopCaptions="StopCaptions",e.Snap="Snapshot",e.React="React",e.EnableIncomingVideo="EnableIncomingVideo",e.DisableIncomingVideo="DisableIncomingVideo",e.Blur="BlurBackground",e.Unblur="UnblurBackground",e.CallStats="CallStats",e.BackgroundEffectsSettings="BackgroundEffectsSettings",e.MuteEveryone="MuteEveryone",e.RaiseHand="RaiseHand",e.LowerHand="LowerHand",e.ChangeTogetherModeBackground="ChangeTogetherModeBackground",e.BingBackgrounds="BingBackgrounds",e.Invite="Invite"}(r=t.OverflowMenuCommands||(t.OverflowMenuCommands={}));t.DesktopSecondaryCallControlsManager=class{configure(e){o.default(e,this._input)||(this._input=e,this._computeControlPlacement())}_computeControlPlacement(){if(this._input.controlsType===n.CallControlsType.DesktopMinSmallest){this._leftControls=[this._input.leftControlForDesktopMinSmallest];const e=a.flatMap(this._input.idealLeftControls,e=>this._callControlKeyToOverflowMenuCommands(e.type)),t=a.flatMap(this._input.idealRightControls,e=>this._callControlKeyToOverflowMenuCommands(e.type));this._overflowControls=e.concat(t).concat(this._input.idealOverflowControls);const i=this._callControlKeyToOverflowMenuCommands(this._input.leftControlForDesktopMinSmallest);return 1===i.length&&(this._overflowControls=a.filter(this._overflowControls,e=>e!==i[0])),void(this._rightControls=this._overflowControls.length>0?[n.CallControlsKeys.Overflow]:[])}const e=this._getCapacity(this._input.controlsType),t=this._restrictControls(this._input.idealLeftControls,e),i=this._restrictControls(this._input.idealRightControls,e);this._leftControls=a.map(t.controlsToKeep,e=>e.type),this._rightControls=a.map(i.controlsToKeep,e=>e.type);const o=a.map(t.controlsForOverflow,e=>e.type),s=a.map(i.controlsForOverflow,e=>e.type);var r=a.flatMap(o,e=>this._callControlKeyToOverflowMenuCommands(e)),l=a.flatMap(s,e=>this._callControlKeyToOverflowMenuCommands(e));r=a.filter(r,e=>-1===this._input.idealOverflowControls.indexOf(e)),l=a.filter(l,e=>-1===this._input.idealOverflowControls.indexOf(e)),this._overflowControls=r.concat(l).concat(this._input.idealOverflowControls)}getLeftControls(){return this._leftControls}getRightControls(){return this._rightControls}getOverflowControls(){return this._overflowControls}_restrictControls(e,t){for(var i=a.map(e,e=>({control:e,delete:!1})),n=e.length;n>t;){const e=a.filter(i,e=>!e.delete),o=a.max(a.map(e,e=>e.control.priority));for(let e=0;e<i.length&&!(n<=t);e++)i[e].delete||i[e].control.priority!==o||(i[e].delete=!0,--n)}const o=a.filter(i,e=>!e.delete),s=a.filter(i,e=>e.delete);return{controlsToKeep:a.map(o,e=>e.control),controlsForOverflow:a.map(s,e=>e.control)}}_callControlKeyToOverflowMenuCommands(e){switch(e){case n.CallControlsKeys.Participants:return this._input.isOneOnOneCall?[r.OnAddToCall]:[r.OnShowParticipants];case n.CallControlsKeys.ScreenShare:const t=[];return t.push(this._input.isScreenShareActive?r.StopSharing:r.ShareScreen),this._input.isScreenShareActive&&(this._input.numberAvailableScreens>1||this._input.windowSharingEnabled)&&t.push(r.SwitchScreen),t;case n.CallControlsKeys.ScreenShareControl:return this._input.canRequestScreenShareControl?[r.ScreenShareControl]:[r.StopScreenShareControl];case n.CallControlsKeys.RaiseHand:return[r.RaiseHand];case n.CallControlsKeys.LowerHand:return[r.LowerHand];case n.CallControlsKeys.ChangeScene:return[r.ChangeTogetherModeBackground];case n.CallControlsKeys.Record:if(this._input.allowRecording){if(!this._input.isRecording&&this._input.connectedAndNotOnHoldCallId===this._input.callId)return[r.StartRecording];if(this._input.isCallRecordingInitiator)return[r.StopRecording]}return[];case n.CallControlsKeys.ReactionsDrawer:return[r.React];case n.CallControlsKeys.Moments:return[r.Snap];case n.CallControlsKeys.ShareLink:return[r.Invite];case n.CallControlsKeys.Mic:case n.CallControlsKeys.MicQuickSettings:case n.CallControlsKeys.Video:case n.CallControlsKeys.VideoQuickSettings:case n.CallControlsKeys.Dialpad:case n.CallControlsKeys.EndCall:case n.CallControlsKeys.Overflow:case n.CallControlsKeys.Chat:case n.CallControlsKeys.TwinCam:return[];default:return s.default.switchStatementExhaustiveChecking(e,"Missing case for an CallControlsKeys element")}}_getCapacity(e){switch(e){case n.CallControlsType.CallMonitor:case n.CallControlsType.Mobile:case n.CallControlsType.DesktopIncomingRingToast:return Number.MAX_SAFE_INTEGER;case n.CallControlsType.Default:return 5;case n.CallControlsType.DesktopMin:return 4;case n.CallControlsType.DesktopMinStageTwo:return 3;case n.CallControlsType.DesktopMinSmallest:return 1;default:return s.default.switchStatementExhaustiveChecking(e,"Missing case for an CallControlsType element")}}}},3691:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DTMFDialpad=void 0;const a=i(34),n=i(1),o=i(0),s=i(15),r=i(29),l=i(375),c=i(1794),d=i(3693),u=i(3),h=i(41),p=i(4),g=i(37),C=i(6),m=i(5),S=i(9),y=i(20),f=i(24),_=i(11),b=i(10),v=C.lazyProperties({container:()=>o.Styles.createViewStyle({flex:1,alignItems:"stretch",backgroundColor:S.Color.transparent}),dialpadContainer:()=>o.Styles.createViewStyle({flex:1,backgroundColor:S.Color.transparent}),inputDisplayContainer:()=>o.Styles.createViewStyle({flexDirection:"row",height:60,alignSelf:"stretch",justifyContent:"center",paddingLeft:12}),inputDisplayContainerDesktop:()=>o.Styles.createViewStyle({alignSelf:"stretch"}),inputDisplayInnerContainer:()=>o.Styles.createScrollViewStyle({flex:1,backgroundColor:S.Color.transparent}),inputDisplayInnerContainerRTL:()=>o.Styles.createScrollViewStyle({flexDirection:"row-reverse",transform:[{scaleX:-1}]}),inputTextDisplay:()=>o.Styles.createTextStyle({color:S.Color.white,fontSize:f.default.controlFontSize.dialpadInput,font:f.default.font.uiDisplayRegular,backgroundColor:S.Color.transparent,textAlignVertical:"center",alignSelf:"center"}),inputTextDisplayDesktop:()=>o.Styles.createViewStyle({flex:1,borderWidth:0,height:32,alignSelf:"center"}),inputFieldButton:()=>o.Styles.createButtonStyle({flex:0,width:60,height:60}),gestureCatcher:()=>o.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:S.Color.transparent}),flippedView:()=>o.Styles.createViewStyle({transform:[{scaleX:-1}]})});class w extends s.ComponentBase{constructor(){super(...arguments),this._onDialpadButtonPress=e=>{const t=b.default.newCauseId();p.log(u.LogTraceArea.DialerPanel,"DTMFDialpad._onDialpadButtonPress callId: "+this.props.callId+" input: "+a.pii.Omit(e)+" causeId: "+t),e&&this._sendDtmfTonesAndUpdateState(e,t)},this._onDialpadButtonLongPress=e=>{if("0"===e){const e=this.state.inputText+"+";this._setInputAndFocus(e),this.setState({inputText:e})}},this._onKeyPress=e=>{const t=e.keyCode,i=b.default.newCauseId();if(p.log(u.LogTraceArea.DialerPanel,"DTMFDialpad._onKeyPress callId: "+this.props.callId+" keyCode: "+a.pii.Omit(t)+" causeId: "+i),d.isDialPadKeyCode(t,e.shiftKey)){const i=d.getStringFromKeyCode(t,e.shiftKey),n=b.default.newCauseId();p.log(u.LogTraceArea.DialerPanel,"DTMFDialpad._onKeyPress callId: "+this.props.callId+" input: "+a.pii.Omit(i)+" causeId: "+n),this._sendDtmfTonesAndUpdateState(i,n)}},this._onPasteDesktop=e=>{if(!e.clipboardData||!e.clipboardData.items||0===e.clipboardData.items.length)return;const t=n.find(e.clipboardData.items,e=>"text/plain"===e.type);t&&t.getAsString(e=>{this._onPaste(e)})},this._onPasteNative=()=>{o.Clipboard.getText().then(e=>{e&&this._onPaste(e)})},this._onScrollViewContentSizeChanged=(e,t)=>{if(!this.state.viewDimensions.width)return;const i=this.state.viewDimensions.width;this._scrollView&&e>i&&(y.default.isRTL()?this._scrollView.setScrollLeft(0):this._scrollView.setScrollLeft(e-i))},this._onScrollViewRef=e=>{this._scrollView=e||void 0},this._onDialpadInputRef=e=>{this._dialPadInput=e||void 0},this._onLayoutChange=e=>{const t={width:e.width,height:e.height};g.default(this.state.viewDimensions,t)||this.setState({viewDimensions:t})}}_buildState(e,t){let i={};return t&&(i.inputText="",i.viewDimensions={width:0,height:0}),i}componentDidMount(){super.componentDidMount(),this._setInputAndFocus(this.state.inputText,!0)}_sendDtmfTonesAndUpdateState(e,t){r.default.PstnUtils.sendDTMFTones(this.props.callId,e,t);const i=this.state.inputText+e;this._setInputAndFocus(i),this.setState({inputText:i})}_onPaste(e){const t=l.default.normalizePhoneNumber(e),i=b.default.newCauseId();p.log(u.LogTraceArea.DialerPanel,"DTMFDialpad._onPaste callId: "+this.props.callId+" pasted: "+a.pii.Omit(t)+" causeId: "+i),this._sendDtmfTonesAndUpdateState(t,i)}_setInputAndFocus(e,t){this._dialPadInput&&(this._dialPadInput.setValue(e),n.defer(()=>{if(this.isComponentMounted()&&this._dialPadInput){t||this._dialPadInput.requestFocus();const i=e.length;i>0&&this._dialPadInput.selectRange(i,i)}}))}render(){const e=y.default.isRTL(),t=[v.inputDisplayContainer],i=[v.inputTextDisplay],a=[v.inputDisplayInnerContainer];e&&(a.push(v.inputDisplayInnerContainerRTL),i.push(v.flippedView));let n=o.createElement(o.ScrollView,{ref:this._onScrollViewRef,style:a,horizontal:!0,showsHorizontalScrollIndicator:!1,onLayout:this._onLayoutChange,onContentSizeChange:this._onScrollViewContentSizeChanged},o.createElement(o.Text,{style:i,numberOfLines:1},this.state.inputText));return t.push(v.inputDisplayContainerDesktop),i.push(v.inputTextDisplayDesktop),n=o.createElement(o.TextInput,{style:i,ref:this._onDialpadInputRef,autoFocus:!0,onKeyPress:this._onKeyPress,value:this.state.inputText,clearButtonMode:"never",blurOnSubmit:!0,onPaste:this._onPasteDesktop}),o.createElement(o.View,{style:v.container},o.createElement(o.GestureView,{style:v.gestureCatcher}),o.createElement(o.View,{style:t},n,void 0,o.createElement(h.default,{style:v.inputFieldButton,size:_.IconSize.size20,onPress:this.props.onClose,color:S.Color.white,hoverColor:S.Color.gray300,icon:_.SkypeIcon.Cancel,title:m.getString("Global.CloseButtonTitle")})),o.createElement(o.View,{style:v.dialpadContainer},o.createElement(c.default,{onKeyPress:this._onDialpadButtonPress,onKeyLongPress:this._onDialpadButtonLongPress,isDtmfDialpad:!0,disableFontScaling:!0,enableExtensionDialing:!0})))}}t.DTMFDialpad=w,t.default=w},3692:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(29),o=i(3),s=i(4),r=i(6),l=(i(5),i(205)),c=i(1260),d=i(9),u=i(24),h=i(16),p=i(10),g=r.lazyProperties({dialpadButton:()=>a.Styles.createViewStyle({alignItems:"center",flexBasis:0,flexDirection:"row",flexGrow:1,flexShrink:0,justifyContent:"center",minHeight:46}),dialpadButtonContent:()=>a.Styles.createViewStyle({alignSelf:"center",flexDirection:"column",flexGrow:1,flexShrink:0}),dialpadButtonContentLandscape:()=>a.Styles.createViewStyle({flexDirection:"row",flexGrow:0,width:50,overflow:"visible",flexWrap:"nowrap"}),buttonLettersContainer:()=>a.Styles.createViewStyle({alignSelf:"center",alignItems:"center"}),buttonLettersContainerLandsape:()=>a.Styles.createViewStyle({paddingLeft:7,alignItems:"flex-start"}),dialpadButtonNumber:()=>a.Styles.createTextStyle({font:u.default.font.uiDisplayBold,textAlign:"center"}),dialpadButtonLetters:()=>a.Styles.createTextStyle({lineHeight:16})}),C=r.lazyProperties({dialpadButtonNumber:()=>a.Styles.createTextStyle({color:d.Color.white,font:u.default.font.uiDisplayBold}),dialpadButtonLetters:()=>a.Styles.createTextStyle({color:d.Color.white})}),m={dialpadButton:r.lazyProperties({MobileDefaultLandscape:()=>a.Styles.createViewStyle({margin:void 0}),MobileDefault:()=>a.Styles.createViewStyle({margin:5}),DesktopSmall:()=>a.Styles.createTextStyle({margin:void 0}),DesktopDefault:()=>a.Styles.createTextStyle({margin:5})}),dialpadButtonNumber:r.lazyProperties({MobileSmall:()=>a.Styles.createTextStyle({fontSize:u.default.controlFontSize.h4,lineHeight:30}),MobileMedium:()=>a.Styles.createTextStyle({fontSize:u.default.controlFontSize.dialpadNumber,lineHeight:36}),MobileDefault:()=>a.Styles.createTextStyle({fontSize:u.default.controlFontSize.dialpadNumberLarge,lineHeight:42}),DesktopDefault:()=>a.Styles.createTextStyle({fontSize:u.default.controlFontSize.h4,lineHeight:30})})};class S extends c.ResponsiveComponentBase{constructor(){super(...arguments),this._onPress=e=>{if(this.props.buttonDisabled)return;const t=p.default.newCauseId();s.log(o.LogTraceArea.DialerStore,"DialpadButton._onPress causeId: "+t),this.props.isDtmfDialpad||(l.default.appendCharToPhoneNumberInput(this.props.value),n.default.PstnUtils.playDTMFSound(this.props.value,t)),this.props.onPress(e)},this._onLongPress=e=>{if(!this.props.buttonDisabled){if(!this.props.isDtmfDialpad){const e=p.default.newCauseId();s.log(o.LogTraceArea.DialerStore,"DialpadButton._onLongPress causeId: "+e),l.default.appendCharToPhoneNumberInput(this.props.longPressValue||this.props.value),n.default.PstnUtils.playDTMFSound(this.props.value,e)}this.props.onLongPress&&this.props.onLongPress(e)}},this._onButtonRef=e=>{this._buttonRef=e||void 0},this._onFocus=e=>{this.isComponentMounted()&&(this.props.onButtonFocused&&this._buttonRef&&!this.props.buttonDisabled&&this.props.onButtonFocused(this._buttonRef),this.setState({isLastFocusedBtn:!0}))}}_buildState(e,t){const i=super._buildState(e,t);return t&&(i.isLastFocusedBtn="1"===e.value),i}requestFocus(){this._buttonRef&&this._buttonRef.requestFocus()}resetFocus(){this.setState({isLastFocusedBtn:!1})}setLastFocused(){this.setState({isLastFocusedBtn:!0})}toggleDisabledState(e){this.setState({isDisabled:e})}render(){var e;const t=[g.dialpadButton,this._chooseResponsiveStyle(m.dialpadButton)],i=[g.dialpadButtonContent],n=[g.buttonLettersContainer];this.props.isInLandscape&&(i.push(g.dialpadButtonContentLandscape),n.push(g.buttonLettersContainerLandsape));const o=[a.Types.AccessibilityTrait.Button];let s=this.props.accessibilityLabel||this.props.value;return this.props.buttonDisabled&&o.push(a.Types.AccessibilityTrait.Disabled),a.createElement(a.Button,{style:t,key:this.props.overrideKey||"button"+this.props.value,ref:this._onButtonRef,onPress:this._onPress,onFocus:this._onFocus,title:this.props.value,onLongPress:this._onLongPress,disabled:this.props.buttonDisabled||null!==(e=this.state.isDisabled)&&void 0!==e&&e,accessibilityTraits:o,accessibilityLabel:s,tabIndex:this.state.isLastFocusedBtn?0:-1},a.createElement(a.View,{style:i,key:"view_"+this.props.value+"button"},this._getValue(),a.createElement(a.View,{style:n,key:"view_"+this.props.value+"letters"},this._getLetters())))}_getValue(){const e=[g.dialpadButtonNumber,this._themeStyles.primaryTextColorStyle,this._chooseResponsiveStyle(m.dialpadButtonNumber)];return this.props.isDtmfDialpad&&e.push(C.dialpadButtonNumber),a.createElement(a.Text,{style:e,key:"value"+this.props.value,allowFontScaling:!this.props.disableFontScaling},this.props.value)}_getLetters(){const e=[g.dialpadButtonLetters,this._themeStyles.primaryTextColorStyle];this.props.isDtmfDialpad&&e.push(C.dialpadButtonLetters);const t=[];for(let i=0;i<this.props.rowCount-1;i++)this.props.letters&&i in this.props.letters?t.push(a.createElement(h.Caption,{style:e,key:"letters"+this.props.value+i,allowFontScaling:!this.props.disableFontScaling,forceDirection:!0},this.props.letters[i])):this.props.isInLandscape||t.push(a.createElement(h.Caption,{style:e,key:"letters"+this.props.value+i,allowFontScaling:!this.props.disableFontScaling},""));return t}}t.default=S},3693:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getStringFromKeyCode=t.isNumpadNumberKeyCode=t.isNumberKeyCode=t.isDialPadKeyCode=void 0;const a=i(106);function n(e){return 48<=e&&e<=57}function o(e){return 96<=e&&e<=105}t.isDialPadKeyCode=function(e,t){return t?e===a.default.THREE||e===a.default.EIGHT:n(e)||o(e)||42===e||106===e||35===e||e===a.default.COMMA},t.isNumberKeyCode=n,t.isNumpadNumberKeyCode=o,t.getStringFromKeyCode=function(e,t){return t?e===a.default.THREE?e=35:e===a.default.EIGHT&&(e=42):o(e)?e-=48:106===e?e=42:e===a.default.COMMA&&(e=44),String.fromCharCode(e)}},3694:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(26),o=i(6),s=i(48),r=i(9),l=i(11),c=i(16),d=i(12),u=o.lazyProperties({container:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",alignSelf:"center",backgroundColor:r.Color.white,minHeight:40,borderRadius:20,marginBottom:20,paddingHorizontal:20,paddingVertical:5,marginTop:-55}),statusText:()=>a.Styles.createTextStyle({color:r.Color.gray300}),statusTextAccessible:()=>a.Styles.createTextStyle({color:r.Color.gray400}),iconPadding:()=>a.Styles.createViewStyle({paddingRight:10}),iconPaddingRTL:()=>a.Styles.createViewStyle({paddingLeft:10}),warningAnimatedView:()=>a.Styles.createViewStyle({overflow:"visible",height:0})});class h extends d.default{constructor(){super(...arguments),this._warningViewAnimatedOpacityValue=new a.Animated.Value(1),this._warningViewAnimatedOpacityStyle=a.Styles.createAnimatedViewStyle({opacity:this._warningViewAnimatedOpacityValue})}componentDidMount(){super.componentDidMount(),s.default.maybeAnnounceForAccessibility(this.props.viewInformation.warningText)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),e.viewInformation.warningText!==this.props.viewInformation.warningText&&s.default.maybeAnnounceForAccessibility(this.props.viewInformation.warningText)}showOrHideWarningView(e,t=!0,i=0){if(this.isComponentMounted()){const n=e?1:0;t?a.Animated.timing(this._warningViewAnimatedOpacityValue,{toValue:n,duration:200,delay:i,easing:a.Animated.Easing.Out()}).start():this._warningViewAnimatedOpacityValue.setValue(n)}}render(){const e=[u.container];this.props.viewInformation.opacityStyle&&e.push(this.props.viewInformation.opacityStyle);const t=this.props.viewInformation.icon?this._getWarningIcon(this.props.viewInformation.icon):void 0,i=this.props.viewInformation.warningText?this._getWarningText(this.props.viewInformation.warningText):void 0;return a.createElement(a.Animated.View,{style:[this._warningViewAnimatedOpacityStyle,u.warningAnimatedView],blockPointerEvents:!0,ignorePointerEvents:!0},a.createElement(a.Animated.View,{style:e},t,i))}_getWarningText(e){return a.createElement(c.BodyText,{style:this._useAccessibleTheme()?u.statusTextAccessible:u.statusText},e)}_getWarningIcon(e){return a.createElement(n.default,{icon:e,size:l.IconSize.size15,color:this.props.viewInformation.optionalIconColor||r.Color.gray300,style:this._getContext().isRTL?u.iconPaddingRTL:u.iconPadding})}}t.default=h},3695:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(177),o=i(0),s=i(74),r=i(384),l=i(331),c=i(1786),d=i(29),u=i(88),h=i(60),p=i(110),g=i(3),C=i(41),m=i(4),S=i(6),y=i(5),f=i(23),_=i(3696),b=i(583),v=i(78),w=i(9),T=i(11),I=i(12),P=i(10),M=S.lazyProperties({container:()=>o.Styles.createViewStyle({flexDirection:"row",justifyContent:"space-between",paddingLeft:5,paddingRight:5,paddingBottom:20,overflow:"visible",alignItems:"center"}),primaryControlsContainer:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"visible"}),buttonControlsLeft:()=>o.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-start",minWidth:44}),buttonControlsRight:()=>o.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-end",minWidth:44}),iconControl:()=>o.Styles.createViewStyle({width:44,height:44})});class k extends I.default{constructor(){super(...arguments),this._onCallEndButtonRef=e=>{this._callEndButton=e||void 0,this._callEndButton&&this.isComponentMounted()&&this._maybeFocusCallEndButton()},this._onSnapshotPressed=()=>{this._snapshotCommand.execute(),this.props.onInteracting(!1)},this._onToggleVideoPressed=()=>{this._videoCommand.execute(),this.props.onInteracting(!1)},this._onEndCallPressed=()=>{const e=P.default.newCauseId();m.log(g.LogTraceArea.CallingUI,"MobileCallControls._onEndCallPressed "+e),this._endCall(!1,e)},this._onEndCallButtonLongPress=e=>{e.stopPropagation(),e.preventDefault(),c.default.showEndCallMenuPopup(this._getRootViewId(),e,this._getAnchorForEndCallMenu,this._selectEndCallMenuItem)},this._onChatPanelButtonPressed=e=>{const t=P.default.newCauseId();m.log(g.LogTraceArea.CallingUI,"MobileCallControls._onChatPanelButtonPressed "+t),this.props.onChatPanelButtonPress(t),this.props.onInteracting(!1)},this._getAnchorForEndCallMenu=()=>this._callEndButton,this._selectEndCallMenuItem=e=>{c.default.selectEndCallMenuItem(e,this._getRootViewId(),this._endCall)},this._endCall=(e,t)=>{if(m.log(g.LogTraceArea.CallingUI,"MobileCallControls._endCall forEveryone: "+e+" causeId: "+t),e)this._endCallForAllCommand.execute();else{new l.EndCallCommand(this.props.callId,this.props.onEndCallFailure).execute()}},this._onToggleMicrophonePressed=()=>{new l.ToggleMuteCommand(this.props.callId,this.state.isMuted,this.state.isServerMuted,!!this.props.disableMic,this._getRootViewId()).execute(),this.state.isMuted&&this.props.onLocalUnmute&&this.props.onLocalUnmute(),this.props.onInteracting(!1)},this._mediaActionEvent=e=>{d.default.CallingStore.getOutgoingCallIds().indexOf(this.props.callId)>=0?(m.track(new u.MediaActionEvent(u.CallControlContext.MobileCallControls,u.MediaActionEventResult.EndCall)),m.log(g.LogTraceArea.CallingUI,"MobileCallControls._mediaActionEvent ending call (causeId: "+e+")"),d.default.CallingStore.endCall(this.props.callId,e)):(m.track(new u.MediaActionEvent(u.CallControlContext.MobileCallControls,u.MediaActionEventResult.Ignore)),m.log(g.LogTraceArea.CallingUI,"MobileCallControls._mediaActionEvent no action (causeId: "+e+")"))}}_buildState(e,t){this._videoCommand=new l.ToggleVideoCommand(e.callId,e),this._snapshotCommand=new b.MomentCommand(e.callId,e,e.reactionsConversationMri),this._endCallForAllCommand=new l.EndCallForEveryoneCommand(e.callId,e,e.callUIState,e.onEndCallFailure);const i=d.default.CallingStore.isCallConnected(e.callId),a=e.callUIState!==h.CallUIState.None,n=d.default.CallingFeaturesHelper.allowReactionsInCallStageMobile();let o;this._reactionCommand=void 0,n&&(o=p.default.getReactionButtonType(e.conversationMri,e.callId),this._reactionCommand=p.default.getReactionCommand(o,e.callId,e,e.reactionsConversationMri));const s=n&&void 0!==this._reactionCommand&&a,r=!s&&this._snapshotCommand.canExecute()&&a;return{isMuted:p.default.isLocalOrServerMuted(e.callId),isServerMuted:d.default.CallingStore.isServerMuted(e.callId),isVideoActive:d.default.CallingStore.isProvidingVideo(e.callId),isMobileScreenReaderEnabled:v.default.isMobileScreenReaderEnabled(),isVideoButtonEnabled:this._videoCommand.canExecute(),hangupAllEnabled:this._endCallForAllCommand.canExecute(),isSnapshotButtonVisible:r,useHighContrastTheme:p.default.useHighContrastThemeAndChanges(),callState:d.default.CallingStore.getCallState(e.callId),isTablet:!f.default.isUsingStackNavigationContext(),isCallConnected:i,shouldMakeSecondaryActionsAvailable:a,showReactButton:s,reactionButtonType:o}}componentDidMount(){super.componentDidMount(),this._maybeFocusCallEndButton(100),this._mediaActionEventSub=n.default.mediaActionEvent.subscribe(this._mediaActionEvent),n.default.maybeEndCallFromAndroidBtScoDisconnectEvent&&(this._maybeEndCallFromAndroidBtScoDisconnectSub=n.default.maybeEndCallFromAndroidBtScoDisconnectEvent.subscribe(()=>{m.track(new u.MaybeEndCallFromAndroidBtScoDisconnectEvent(u.CallControlContext.MobileCallControls))}))}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),t.isServerMuted||!this.state.isServerMuted||this.state.isMuted||p.default.announceMicrophoneState(!0,!0),this._logMuteStateChanges(t)}componentWillUnmount(){super.componentWillUnmount(),this._mediaActionEventSub&&(this._mediaActionEventSub.unsubscribe(),this._mediaActionEventSub=void 0),this._maybeEndCallFromAndroidBtScoDisconnectSub&&(this._maybeEndCallFromAndroidBtScoDisconnectSub.unsubscribe(),this._maybeEndCallFromAndroidBtScoDisconnectSub=void 0)}_logMuteStateChanges(e){this.state.isMuted!==e.isMuted&&m.log(g.LogTraceArea.CallMonitor,`MobileCallControls.componentDidUpdate, isMuted - ${e.isMuted} to ${this.state.isMuted}`),this.state.isServerMuted!==e.isServerMuted&&m.log(g.LogTraceArea.CallMonitor,`MobileCallControls.componentDidUpdate, isServerMuted - ${e.isServerMuted} to ${this.state.isServerMuted}`)}_colorConfig(){return this.state.useHighContrastTheme?p.default.highContrastColorConfig(this._themeColors):void 0}_maybeFocusCallEndButton(e=0){const t=()=>{this._callEndButton&&this.isComponentMounted()&&this.state.isMobileScreenReaderEnabled&&this._callEndButton.requestFocus()};e?a.delay(t,e):a.defer(t)}_getPrimaryControls(){let e;return this.props.isPSTNCall?e=this._getPSTNDialPadButton():this.props.isEncryptedCall||(e=this._getVideoButton()),o.createElement(o.View,{style:M.primaryControlsContainer},this._getMicButton(),e,this._getHangUpButton())}_getHangUpButton(){return o.createElement(r.CallButton,{key:"endcall",ref:this._onCallEndButtonRef,icon:T.SkypeIcon.CallEnd,title:y.getString("CallControls.CallButtonEndCall"),size:r.CallButtonSize.Large,isToggledOn:!1,isCallEndButton:!0,onPress:this._onEndCallPressed,onLongPress:this.state.hangupAllEnabled?this._onEndCallButtonLongPress:void 0,accessibilityLabel:y.getString("CallControls.CallButtonEndCall"),backgroundStyle:r.CallButtonBackgroundStyle.Solid,colorConfig:this._colorConfig()})}_getMicButton(){const e=y.getString(this.state.isMuted?"CallControls.CallButtonUnmuteLabel":"CallControls.CallButtonMute");return o.createElement(r.CallButton,{key:h.CallControlsKeys.Mic,icon:this.state.isMuted?T.SkypeIcon.MicrophoneOff:T.SkypeIcon.Microphone,title:e,size:r.CallButtonSize.Large,isToggledOn:!this.state.isMuted,onPress:this._onToggleMicrophonePressed,accessibilityLabel:e,backgroundStyle:this.state.isMuted?r.CallButtonBackgroundStyle.Solid:r.CallButtonBackgroundStyle.Overlay,colorConfig:this._colorConfig()})}_getVideoButton(){const e=y.getString(this.state.isVideoActive?"CallControls.CallButtonTurnOffVideoLabel":"CallControls.CallButtonTurnOnVideoLabel");return o.createElement(r.CallButton,{ref:this.props.onVideoButtonRef,key:h.CallControlsKeys.Video,icon:this.state.isVideoActive?T.SkypeIcon.Video:T.SkypeIcon.VideoOff,title:e,size:r.CallButtonSize.Large,isDisabled:!this.state.isVideoButtonEnabled,isToggledOn:this.state.isVideoActive,onPress:this._onToggleVideoPressed,accessibilityLabel:e,backgroundStyle:this.state.isVideoActive?r.CallButtonBackgroundStyle.Overlay:r.CallButtonBackgroundStyle.Solid,colorConfig:this._colorConfig()})}_getPSTNDialPadButton(){return o.createElement(r.CallButton,{key:h.CallControlsKeys.Dialpad,icon:T.SkypeIcon.Dialpad,title:y.getString("CallPanel.DialpadTooltipTitle"),size:r.CallButtonSize.Large,isDisabled:!(this.state.callState===s.CallState.Connected||this.state.callState===s.CallState.EarlyMedia),isToggledOn:!0,onPress:this.props.onOpenDialpad,accessibilityLabel:y.getString("CallPanel.DialpadTooltipTitle"),backgroundStyle:r.CallButtonBackgroundStyle.Overlay,colorConfig:this._colorConfig()})}_getSnapshotButton(){if(this.state.isSnapshotButtonVisible)return o.createElement(C.default,{style:M.iconControl,icon:T.SkypeIcon.Snapshot,title:y.getString("CallReactionsBar.PhotoSnapshotButtonShortTitle"),size:T.IconSize.size24,onPress:this._onSnapshotPressed,accessibilityLabel:y.getString("CallReactionsBar.PhotoSnapshotButtonShortTitle"),color:w.Color.white,hoverColor:w.Color.whiteOverlay20})}_getReactionButton(){if(!this.state.showReactButton||!this._reactionCommand||void 0===this.state.reactionButtonType)return;const e=p.default.getReactionButtonDescriptors(this.state.reactionButtonType,this._reactionCommand);return o.createElement(C.default,Object.assign({style:M.iconControl,size:T.IconSize.size24,color:w.Color.white,hoverColor:w.Color.whiteOverlay20,disabled:!this.state.isCallConnected},e))}_getChatPanelButton(){if(!this.state.isTablet)return;const e=this.props.isShowingChat?y.getString("CallPanel.CloseConversation"):y.getString("CallPanel.OpenConversation"),t=this.props.isShowingChat?T.SkypeIcon.ChatsInverted:T.SkypeIcon.Message;return o.createElement(C.default,{style:M.iconControl,icon:t,title:e,accessibilityLabel:e,size:T.IconSize.size24,onPress:this._onChatPanelButtonPressed,color:w.Color.white,hoverColor:w.Color.whiteOverlay20})}render(){const e=!this.props.isEncryptedCall&&this.state.shouldMakeSecondaryActionsAvailable?o.createElement(_.default,{size:44,onOverflowPressed:this.props.onOverflowPressed}):void 0;return o.createElement(o.View,{style:[M.container,this.props.style],ignorePointerEvents:this.props.ignorePointerEvents,blockPointerEvents:this.props.blockPointerEvents},o.createElement(o.View,{style:M.buttonControlsLeft},this._getChatPanelButton(),this._getSnapshotButton(),this._getReactionButton()),this._getPrimaryControls(),o.createElement(o.View,{style:M.buttonControlsRight},e))}}t.default=k},3696:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(15),o=i(7),s=i(29),r=i(3),l=i(41),c=i(4),d=i(6),u=i(5),h=(i(30),i(9)),p=i(11),g=d.lazyProperties({redDot:()=>a.Styles.createViewStyle({width:10,height:10,borderRadius:5,backgroundColor:h.Color.red,position:"absolute",right:5})});class C extends n.ComponentBase{constructor(){super(...arguments),this._showOverflowMenu=()=>{c.log(r.LogTraceArea.CallingUI,"OverflowMenuButton._showOverflowMenu"),this.props.onOverflowPressed(()=>this._overflowButton),this.setState({showRedDot:!1})},this._onOverflowButtonRef=e=>{this._overflowButton=e||void 0}}_buildState(e,t){return{showRedDot:s.default.DeviceStore.isBackgroundBlurEnabled()&&o.default.getS4LCMCFeatures().enableBackgroundBlurNewLabel&&!1}}render(){const e=this.props.size||44,t=a.Styles.createViewStyle({width:e,height:e},!1),i=u.getString("CallControls.CallButtonOverflowMenu"),n=a.Styles.createViewStyle({top:e/2-10},!1);return a.createElement(a.View,null,this.state.showRedDot?a.createElement(a.View,{style:[g.redDot,n]}):void 0,a.createElement(l.default,{key:"overflow",style:t,ref:this._onOverflowButtonRef,icon:p.SkypeIcon.More,title:i,size:p.IconSize.size24,onPress:this._showOverflowMenu,accessibilityLabel:i,color:h.Color.white,hoverColor:h.Color.whiteOverlay20}))}}t.default=C},3697:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(7),o=i(384),s=i(29),r=i(88),l=i(88),c=i(110),d=i(17),u=i(532),h=i(254),p=i(3698),g=i(32),C=i(3),m=i(1796),S=i(4),y=i(6),f=i(5),_=i(9),b=i(11),v=i(16),w=i(10),T=y.lazyProperties({containerViewBase:()=>a.Styles.createViewStyle({flex:1,alignItems:"center",alignSelf:"stretch",backgroundColor:_.Color.transparent}),titleStyle:()=>a.Styles.createTextStyle({marginTop:30,marginHorizontal:50,textAlign:"center",color:_.Color.white}),messageStyle:()=>a.Styles.createTextStyle({marginTop:10,marginHorizontal:50,textAlign:"center",color:_.Color.whiteOverlay70}),buttonInfoStyle:()=>a.Styles.createTextStyle({marginTop:10,marginHorizontal:5,textAlign:"center",color:_.Color.whiteOverlay70}),actionPane:()=>a.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:30,alignItems:"center",alignSelf:"stretch"}),minorButtonsRowOneItem:()=>a.Styles.createViewStyle({marginBottom:30,alignContent:"center",justifyContent:"center"}),minorButtonsRowMultiItem:()=>a.Styles.createViewStyle({marginBottom:30,marginHorizontal:100,flexDirection:"row",alignSelf:"stretch",alignContent:"center",justifyContent:"space-between"}),majorButtonsRow:()=>a.Styles.createViewStyle({marginVertical:20,marginHorizontal:60,flexDirection:"row",alignSelf:"stretch",alignContent:"center",justifyContent:"space-between"})});class I extends m.IncomingRingControlsBase{constructor(e){super(l.CallControlContext.MobileIncomingRingPanel,e),this._onMessageButtonRef=e=>{this._callMessageButton=e||void 0},this._onRejectCall=()=>{this._rejectCommand.execute(),S.track(new r.MobileCallAnswerEvent(r.MobileCallAnswerActions.Declined,0))},this._onAnswerCallWithVideo=()=>{this._answerWithVideoCommand.execute(),S.track(new r.MobileCallAnswerEvent(r.MobileCallAnswerActions.AnsweredWithVideo,0))},this._onAnswerCall=()=>{this._answerCommand.execute(),S.track(new r.MobileCallAnswerEvent(r.MobileCallAnswerActions.AnsweredWithAudio,0))},this._onMesageBack=()=>{const e=w.default.newCauseId();s.default.OngoingCallService.stopCallSounds(this.props.callId,e);const t={callId:this.props.callId,conversationMri:this.props.conversationMri,onClose:this._closeMessagePrompt},i=a.createElement(p.default,Object.assign({},t)),n=p.default.getMenuHeight(),o={headerType:u.HeaderType.Slim,hideCloseButton:!0};h.default.showWithContent({menuId:h.default.menuId(),anchor:()=>this._callMessageButton,rootViewId:this._getRootViewId(),menuHeight:n,content:i,onCloseMenu:this._closeMessagePrompt,getTitle:()=>{},headerConfig:o,backgroundColor:_.Color.black},e)},this._closeMessagePrompt=()=>{const e=w.default.newCauseId();S.log(C.LogTraceArea.CallingUI,"MobileIncomingRingPanel._closeMessagePrompt causeId: "+e),h.default.close(this._getRootViewId(),e)}}_buildState(e,t){this._initializeCommands(e,!0);const i=s.default.CallingStore.getConnectedAndNotOnHoldCallId();return{conversationName:g.default.getDisplayName(e.conversationMri)||f.getString("Notifications.UnknownUserShort"),useHighContrastTheme:c.default.useHighContrastThemeAndChanges(),allowVideoButton:this._answerWithVideoCommand.canExecute(),withVideo:s.default.CallingStore.incomingCallHasVideo(e.callId),isGroupCall:d.isGroupConversation(e.conversationMri),connectedToAnotherCall:!!i&&i!==e.callId,showMessageButton:n.default.getS4LCMCFeatures().enableDeclineAndMessageOnRingControls&&!s.default.CallingStore.isPSTNCall(e.callId)}}_colorConfig(e){return this.state.useHighContrastTheme?c.default.highContrastColorConfig(this._themeColors):{iconColor:_.Color.white,backgroundColor:e,selectedIconColor:_.Color.white,selectedBackgroundColor:e}}render(){return a.createElement(a.View,{style:[T.containerViewBase,this.props.style]},this._renderTitle(),this._renderCallInfo(),a.createElement(a.View,{style:T.actionPane},this._renderCallButtons()))}_renderTitle(){return a.createElement(v.PanelHeader,{style:T.titleStyle,numberOfLines:1},this.state.conversationName)}_renderCaption(e,t){return a.createElement(v.Caption,{style:t},e)}_renderCallInfo(){return this._renderCaption(this._getIncomingCallStrings(),T.messageStyle)}_renderCallButtons(){let e;if(this.state.allowVideoButton){const t=f.getString("MobileIncomingCallPanel.CallButtonVideoLabel",{conversationName:this.state.conversationName});e=a.createElement(a.View,null,a.createElement(o.CallButton,{icon:b.SkypeIcon.Video,isToggledOn:!1,title:t,onPress:this._onAnswerCallWithVideo,size:o.CallButtonSize.ExtraLarge,accessibilityLabel:t,colorConfig:this._colorConfig(_.Color.green)}),this._renderCaption(f.getString("MobileIncomingCallPanel.VideoButtonText"),T.buttonInfoStyle))}const t=f.getString("MobileIncomingCallPanel.CallButtonAudioLabel",{conversationName:this.state.conversationName}),i=f.getString("MobileIncomingCallPanel.CallButtonDeclineLabel"),n=f.getString("MobileIncomingCallPanel.CallButtonMessageBackLabel",{conversationName:this.state.conversationName}),s=a.createElement(a.View,null,a.createElement(o.CallButton,{ref:this._onAnswerCallButtonRef,icon:b.SkypeIcon.CallStart,isToggledOn:!1,title:t,onPress:this._onAnswerCall,size:e?o.CallButtonSize.Small:o.CallButtonSize.ExtraLarge,accessibilityLabel:t,colorConfig:this._colorConfig(e?_.Color.gray200Overlay20:_.Color.green),isSquareButton:!!e}),this._renderCaption(f.getString("MobileIncomingCallPanel.AudioButtonText"),T.buttonInfoStyle)),r=a.createElement(a.View,null,a.createElement(o.CallButton,{icon:b.SkypeIcon.CallEnd,isToggledOn:!1,title:i,onPress:this._onRejectCall,isCallEndButton:!0,size:o.CallButtonSize.ExtraLarge,accessibilityLabel:i,colorConfig:this._colorConfig(_.Color.red)}),this._renderCaption(f.getString("MobileIncomingCallPanel.DeclineButtonText"),T.buttonInfoStyle));let l;if(this.state.showMessageButton&&(l=a.createElement(a.View,null,a.createElement(o.CallButton,{ref:this._onMessageButtonRef,icon:b.SkypeIcon.Message,isToggledOn:!1,title:n,onPress:this._onMesageBack,size:o.CallButtonSize.Small,accessibilityLabel:n,colorConfig:this._colorConfig(_.Color.gray200Overlay20),isSquareButton:!0}),this._renderCaption(f.getString("MobileIncomingCallPanel.MessageButtonText"),T.buttonInfoStyle))),e){const t=l?T.minorButtonsRowMultiItem:T.minorButtonsRowOneItem;return[a.createElement(a.View,{key:"minorRow",style:t},l,s),a.createElement(a.View,{key:"majorRow",style:T.majorButtonsRow},r,e)]}return[a.createElement(a.View,{key:"minorRow",style:T.minorButtonsRowOneItem},l),a.createElement(a.View,{key:"majorRow",style:T.majorButtonsRow},r,s)]}_getIncomingCallStrings(){return this.state.connectedToAnotherCall?f.getString("CallBanner.IncomingCallMergeCallWarning"):this.state.isGroupCall?f.getString("MobileIncomingCallPanel.IncomingCall"):this.state.withVideo?f.getString("MobileIncomingCallPanel.IncomingVideoCall"):f.getString("MobileIncomingCallPanel.IncomingAudioCall")}}t.default=I},3698:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(88),n=i(600),o=i(378),s=i(3),r=i(1261),l=i(4),c=i(5),d=i(9);class u extends n.default{constructor(e){super(e),this._messages=[],this._onMessageBack=e=>{this.props.onClose(),this._rejectCommand.execute(),this._messageCommand.execute(this._messages[e],s.PostSource.DeclineAndMessageMenu),l.track(new a.MobileCallAnswerEvent(a.MobileCallAnswerActions.DeclinedWithMessage,e+1))},this._onDefaultOption=()=>{this.props.onClose(),this._rejectCommand.execute(),l.track(new a.MobileCallAnswerEvent(a.MobileCallAnswerActions.DeclinedWithMessage,this._messages.length+1))},this._messages.push(c.getString("MobileIncomingCallPanel.CantTalkMessage")),this._messages.push(c.getString("MobileIncomingCallPanel.CallRightBackMessage")),this._messages.push(c.getString("MobileIncomingCallPanel.CallLaterMessage")),this._messages.push(c.getString("MobileIncomingCallPanel.CallMeLaterMessage")),this._rejectCommand=new r.RejectIncomingCallCommand(e.callId,!1),this._messageCommand=new r.MessageConversationCommand(e.conversationMri)}_buildRows(e,t){const i=[];for(let e=0;e<this._messages.length;e++){let t=this._messages[e];const a={key:"Message: "+t,titleText:t,accessibilityLabel:t,hideBorder:!0,onRowPress:this._onMessageBack.bind(this,e),titleTextColor:d.Color.white};i.push({props:a,builder:o.default.buildRow})}const a=c.getString("MobileIncomingCallPanel.DefaultOption"),n={key:"DefaultOption",titleText:a,accessibilityLabel:a,hideBorder:!0,onRowPress:this._onDefaultOption,titleTextColor:d.Color.blue};return i.push({props:n,builder:o.default.buildRow}),i}static getMenuHeight(){return 5*o.default.getMenuItemHeight()}}t.default=u},3699:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(15),s=i(7),r=i(29),l=i(123),c=i(325),d=i(60),u=i(110),h=i(17),p=i(32),g=i(3),C=i(3700),m=i(148),S=i(4),y=i(6),f=i(21),_=i(3703),b=i(324),v=i(39),w=i(28),T=i(14),I=i(31),P=y.lazyProperties({container:()=>n.Styles.createViewStyle({flex:1,overflow:"visible"}),fullScreenView:()=>T.default.absoluteFill,eventsContainer:()=>n.Styles.createViewStyle({paddingBottom:20,overflow:"visible"}),mobileEventsContainerWithCallControls:()=>n.Styles.createViewStyle({paddingBottom:75}),streamContainer:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",overflow:"visible"})});class M extends o.ComponentBase{constructor(){super(...arguments),this._subscriptions=[],this._onSelectSceneResponseFailedEvent=e=>{if(this._eventStream){const t=this._getAudienceBotMri(this.props.callId);a.isUndefined(t)||this._eventStream.participantEvent(t,e)}},this._onSceneChangedEvent=(e,t)=>{this._eventStream&&this._eventStream.participantEvent(t,d.ParticipantEventType.TogetherModeBackgroundChanged)},this._onEventStreamRef=e=>{this._eventStream=e||void 0},this._onPhotoEventStreamRef=e=>{this._photoEventStream=e||void 0}}_buildState(e,t){t&&(this._subscriptions.push(r.default.AudienceBotService.selectSceneResponseFailedEvent(e.callId).subscribe(this._onSelectSceneResponseFailedEvent)),this._subscriptions.push(r.default.AudienceBotService.sceneChangedEvent(e.callId).subscribe(this._onSceneChangedEvent)));const i=s.default.getS4LCMCFeatures(),n=i.enableRingingNotifications,o=[],l=[],d=m.default.getNonVisibleInCallBotMris(),h=m.default.getNonInteractiveInCallBotMris(),p=[];a.each(r.default.CallingStore.getRemoteCallMembers(e.callId),t=>{const i=r.default.CallingStore.getRemoteCallMemberMri(e.callId,t);u.default.shouldRenderConnectedParticipantInEventStream(t,i,h)?o.push(i):n&&u.default.shouldRenderRingingParticipantInEventStream(t,i,d)&&l.push(i)}),i.enableRaiseHands&&r.default.CallingStore.getParticipantsWithRaisedHands(e.callId).map(e=>{const t=a.concat(o,[f.default.getSkypeMri()]);a.find(t,t=>t===e.id)&&p.push(e.id)});const g=c.default.hasPostedReactions(e.reactionsConversationMri);let C;if(!t&&this._reactionsInteropMessageAllowed()&&g&&!this.state.hasPostedReactions){const t=r.default.CallingStore.getRemoteMembersNotSupportingCallingReactions(e.callId);t&&(C=u.default.getFeatureUnsupportedParticipantsInfo(e.callId,t,e.conversationMri))}const S=t?Date.now():this.state.callEntryTime,y=a.last(c.default.getPictureReactions(e.reactionsConversationMri,S)),_=this._photoInfoForMessage(y,e.conversationMri),b=c.default.getEventsReaction(e.reactionsConversationMri,S);let v={callParticipantMris:o,ringingParticipantMris:l,reactionsMessageInfo:C,hasPostedReactions:g,lastPhotoInfo:_,eventReactions:b,enableRingingNotifications:n,enableNotifyUsersMuteKick:i.enableNotifyUsersMuteKick,handRaisedMris:p};return t&&(v.suppressParticipantEvents=!0,v.callEntryTime=S),v}componentWillUnmount(){super.componentWillUnmount(),this._subscriptions.forEach(e=>e.unsubscribe()),this._subscriptions=[]}_getAudienceBotMri(e){const t=m.default.getCallAudienceBotMri(),i=m.default.getCallAudienceBotMriFilter();return r.default.InCallBotService.findActualBotMri(e,t,i)}_reactionsInteropMessageAllowed(){return h.isThread(this.props.conversationMri)||h.isSkypeIdMri(this.props.conversationMri)}_photoInfoForMessage(e,t){return e?{message:e,user:p.default.getMemberShortNameForConversation(t,e.creator)}:void 0}_identifyParticipantChange(e,t){if(this.state.suppressParticipantEvents||h.isOneOnOneConversation(this.props.conversationMri))return;const i=a.difference(e,t),n=a.difference(t,e);n.length&&this._onJoin(n),i.length&&this._onLeave(i)}_identifyParticipantRaiseHandChange(e,t){const i=a.difference(t,e);i.length&&this._onRaised(i)}_identifyParticipantRingingChange(e,t){if(!this.state.enableRingingNotifications||this.state.suppressParticipantEvents)return;const i=a.difference(e,t);(a.difference(t,e).length||i.length)&&this._onParticipantsRinging(t),i.length&&this._onStopRinging(i)}_onJoin(e){a.each(e,(e,t)=>{this._eventStream&&this._eventStream.participantEvent(e,d.ParticipantEventType.Join)})}_onRaised(e){a.each(e,(e,t)=>{this._eventStream&&this._eventStream.participantEvent(e,d.ParticipantEventType.HandRaised)})}_onLeave(e){a.each(e,(e,t)=>{this._eventStream&&this._eventStream.participantEvent(e,d.ParticipantEventType.Leave)})}_onMuted(e){this._eventStream&&this._eventStream.participantActionEvent(e.mri,e.actionMri,d.ParticipantEventType.Muted)}_onKickedOut(e){this._eventStream&&this._eventStream.participantActionEvent(e.mri,e.actionMri,d.ParticipantEventType.KickedOut)}_onStopRinging(e){a.each(e,(t,i)=>{if(this._eventStream){const i=r.default.CallingStore.findRemoteCallMember(this.props.callId,t);l.default.isParticipantConnected(i)||this._eventStream.participantEvent(t,this._getStopRingingEventType(e))}})}_getStopRingingEventType(e){return e.length&&a.intersection(r.default.InCallBotMriUtils.getCallFullscreenBotMris(),e).length?d.ParticipantEventType.BotUnavailable:d.ParticipantEventType.Unavailable}_onParticipantsRinging(e){this._eventStream&&this._eventStream.participantsRingingEvent(e)}componentDidMount(){super.componentDidMount(),h.isOneOnOneConversation(this.props.conversationMri)?I.default.setTimeout(()=>{this.isComponentMounted()&&this.setState({suppressParticipantEvents:!1})},3e3):I.default.setTimeout(()=>{this.isComponentMounted()&&this.setState({suppressParticipantEvents:!1})},1e4)}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),this._identifyParticipantRingingChange(t.ringingParticipantMris,this.state.ringingParticipantMris),this._identifyParticipantChange(t.callParticipantMris,this.state.callParticipantMris),this._identifyParticipantRaiseHandChange(t.handRaisedMris,this.state.handRaisedMris),this.state.reactionsMessageInfo&&!t.reactionsMessageInfo){const e=this.state.reactionsMessageInfo.count;if(0===e)return;S.log(g.LogTraceArea.CallReactions,"ReactionsPanel.componentDidUpdate: reactionsMessageInfo,  count: "+e+" firstUser: "+(v.mriOrId(this.state.reactionsMessageInfo.firstUser)||"none")+" secondUser: "+(v.mriOrId(this.state.reactionsMessageInfo.secondUser)||"none"));const t=u.default.getFeatureUnsupportedMessage(this.state.reactionsMessageInfo,u.UnsupportedFeature.CallReactions);t&&this._eventStream&&this._eventStream.textEvent(t)}if(this._photoEventStream&&this.state.lastPhotoInfo){this.state.lastPhotoInfo.message.cuid!==(t.lastPhotoInfo?t.lastPhotoInfo.message.cuid:void 0)&&this._photoEventStream.photoEvent(this.state.lastPhotoInfo.message,this.state.lastPhotoInfo.message.creator)}if(this.state.enableNotifyUsersMuteKick&&this.state.eventReactions){const e=a.last(this.state.eventReactions),i=a.last(t.eventReactions);(e?e.cuid:void 0)!==(i?i.cuid:void 0)&&this.state.eventReactions.forEach(e=>{const t=b.default.parseCallEventReaction(e);t&&(t.eventType===w.ReactionsTextType.CallEventMuted?this._onMuted(t):t.eventType===w.ReactionsTextType.CallEventKickedOut&&this._onKickedOut(t))})}}render(){const e=[P.fullScreenView,P.eventsContainer,this.props.bottomStyle];return this.props.areMobileCallControlsVisible&&e.push(P.mobileEventsContainerWithCallControls),n.createElement(n.View,{style:P.container,ignorePointerEvents:!0},n.createElement(n.Animated.View,{style:e,ignorePointerEvents:!0,blockPointerEvents:!0},n.createElement(C.default,{style:P.streamContainer,ref:this._onEventStreamRef,useHighContrastTheme:this.props.useHighContrastTheme})),n.createElement(_.default,{style:P.fullScreenView,ref:this._onPhotoEventStreamRef,isDesktop:this.props.isDesktop,bottomMargin:this.props.desktopBottomMargin,desktopSideMargin:this.props.desktopSideMargin,sizePhotosToFit:this.props.sizePhotosToFit,photoTapDelay:this.props.photoTapDelay,onPhotoTap:this.props.onPhotoTap,onPhotoDismissed:this.props.onPhotoDismissed,reactionsConversationMri:this.props.reactionsConversationMri}))}}t.default=M},3700:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(34),n=i(1),o=i(0),s=i(3701),r=i(29),l=i(60),c=i(110),d=i(17),u=i(32),h=i(3),p=i(824),g=i(4),C=i(181),m=i(5),S=i(21),y=i(36),f=i(9),_=i(31),b=i(46);class v extends p.InitialStateComponent{constructor(){super(...arguments),this._bottomOffset=0,this._renderItem=e=>{const t=e.id;if(e.item){const i=e.item,a=i.eventType!==l.ParticipantEventType.Join||this.props.useHighContrastTheme?f.Color.blackOverlay70:f.Color.blue;return o.createElement(s.default,{key:t,mri:i.mri,isLeaveEvent:i.eventType===l.ParticipantEventType.Leave||i.eventType===l.ParticipantEventType.Unavailable,isRaiseHandEvent:i.eventType===l.ParticipantEventType.HandRaised,useLightText:!0,displayString:this._getParticipantItemDisplayString(i),backgroundColor:a,layoutController:e.layoutController,horizontalSafeAreaInsets:this.state.horizontalSafeAreaInsets})}if(e.text)return o.createElement(s.default,{key:t,mri:e.text.mri,displayString:e.text.text,backgroundColor:f.Color.blackOverlay70,useLightText:!0,isTextEvent:!0,layoutController:e.layoutController,horizontalSafeAreaInsets:this.state.horizontalSafeAreaInsets})},this._onLayoutChange=e=>{this._layoutController.updateViewDimensions({width:e.width,height:e.height})}}_buildState(e,t){let i={horizontalSafeAreaInsets:y.default.horizontalInsets(),audienceBotMris:r.default.InCallBotMriUtils.getCallAudienceBotMriFilter(),gridViewBotMris:r.default.InCallBotMriUtils.getCallGridViewBotMriFilter()};return t&&(this._eventCount=0,this._layoutController=new T,i.itemRenderInfos=[]),i}componentMounting(e){super.componentMounting(e),this._layoutController.setCallbacks(e=>this._onRemoveItem(e))}textEvent(e,t){this.setState(this._onTextEvent(e,t))}participantEvent(e,t){const i=d.sanitizeMri(e,d.Namespaces.SkypeId),a={mri:i,userName:u.default.getDisplayName(i)||m.getString("Notifications.UnknownUserShort"),eventType:t,gender:b.default.getFullUserProfileByMri(i).gender,isCurrentUser:S.default.isMyMri(i)};this.setState(this._onParticipantEvent(a))}participantActionEvent(e,t,i){const a=d.sanitizeMri(e,d.Namespaces.SkypeId),n=this._getUserNameForEvent(a),o=d.sanitizeMri(t,d.Namespaces.SkypeId),s={mri:a,userName:n,actionMri:o,actionUserName:u.default.getDisplayName(o)||m.getString("Notifications.UnknownUserShort"),eventType:i};this.setState(this._onParticipantEvent(s))}participantsRingingEvent(e){const t={displayString:c.default.getRingingItemDisplayString(e),mri:e[0],participantCount:e.length};this.setState(this._onParticipantsRingingEvent(t))}clearEvents(){this._layoutController.clearEvents()}_onRemoveItem(e){this.isComponentMounted()&&(this._layoutController.removeControllerForKey(e),"FixedPositionItem"===e?this.setState({fixedPositionItem:void 0}):this.setState(this._removeStreamItemsAndReturnNewState(e,this.state)))}_onParticipantEvent(e){let t=n.clone(this.state.itemRenderInfos);const i="participant_"+this._eventCount++;let a=this._bottomOffset;return e.eventType===l.ParticipantEventType.Unavailable&&(a=48),t.push({id:i,item:e,layoutController:this._layoutController.controllerForKey(i,!0,a)}),{itemRenderInfos:t}}_onParticipantsRingingEvent(e){let t=this._layoutController.getFixedPositionItemController(!0),i={id:"FixedPositionItem",ringingItem:e,layoutController:t};if(!this.state.fixedPositionItem&&e.participantCount>0)this._bottomOffset=48,null==t||t.setDismissTimerTimeout(3e4);else{if(0===e.participantCount)return null==t||t.dismissItem(!0),this._bottomOffset=0,this.state;null==t||t.restartDismissTimer()}return{fixedPositionItem:i}}_onTextEvent(e,t){const i=n.clone(this.state.itemRenderInfos),a="text_"+this._eventCount++;return i.push({id:a,text:{mri:t,text:e},layoutController:this._layoutController.controllerForKey(a,!0)}),{itemRenderInfos:i}}_removeStreamItemsAndReturnNewState(e,t){const i=n.clone(t.itemRenderInfos);return{itemRenderInfos:n.filter(i,t=>t.id!==e)}}_getParticipantItemDisplayString(e){const{eventType:t,userName:i,actionUserName:a,gender:o,isCurrentUser:s}=e;let r;switch(t){case l.ParticipantEventType.Join:r=m.getString("ReactionsStream.ParticipantJoined",{participant:i});break;case l.ParticipantEventType.Leave:r=m.getString("ReactionsStream.ParticipantLeft",{participant:i});break;case l.ParticipantEventType.Muted:r=m.getString("CallPanel.MicrophoneServerMutedPersonalize",{initiator:i,person:a||""});break;case l.ParticipantEventType.HandRaised:r=s?m.getString("ReactionsStream.RaiseHandEventForCurrentUser"):m.getString("ReactionsStream.RaiseHandEvent",{gender:C.getLocalizeParamForGender(o),initiator:i||""});break;case l.ParticipantEventType.KickedOut:r=m.getString("CallPanel.RemoveFromCallPersonalize",{initiator:i,person:a||""});break;case l.ParticipantEventType.BotUnavailable:r=n.includes(this.state.audienceBotMris,e.mri)?m.getString("ReactionsStream.TogetherModeUnavailable"):n.includes(this.state.gridViewBotMris,e.mri)?m.getString("ReactionsStream.LargeGridUnavailable"):m.getString("ReactionsStream.ParticipantUnavailable",{participant:i});break;case l.ParticipantEventType.TogetherModeBackgroundChangeFailed:r=m.getString("ReactionsStream.TogetherModeBackgroundChangeFailed");break;case l.ParticipantEventType.TogetherModeDesiredBackgroundAlreadySet:r=m.getString("ReactionsStream.TogetherModeDesiredBackgroundAlreadySet");break;case l.ParticipantEventType.TogetherModeBackgroundChanged:r=m.getString("ReactionsStream.TogetherModeBackgroundChanged",{participant:i});break;case l.ParticipantEventType.Unavailable:default:r=m.getString("ReactionsStream.ParticipantUnavailable",{participant:i})}return r}_renderFixedPositionItem(){if(!this.state.fixedPositionItem)return;const e=this.state.fixedPositionItem,t=e.id;return e.ringingItem?o.createElement(s.default,{key:t,mri:e.ringingItem.mri,isLeaveEvent:!1,useLightText:!0,displayString:e.ringingItem.displayString,backgroundColor:this.props.useHighContrastTheme?f.Color.blackOverlay70:f.Color.blue,layoutController:e.layoutController,horizontalSafeAreaInsets:this.state.horizontalSafeAreaInsets}):void 0}_getUserNameForEvent(e){const t=d.sanitizeMri(e,d.Namespaces.SkypeId);return u.default.getDisplayName(t)||m.getString("Notifications.UnknownUserShort")}render(){const e=n.map(this.state.itemRenderInfos,this._renderItem),t=this._renderFixedPositionItem();return o.createElement(o.View,{style:this.props.style,onLayout:this._onLayoutChange,ignorePointerEvents:!0},e,t)}}t.default=v;class w{constructor(e,t,i,n=0){this._hasBeenPresented=!1,this._hasBeenDismissed=!1,this._dismissTimerTimeout=5e3,this._currentHeight=0,this._currentBottomOffset=0,this._currentOpacity=0,this._animatedOpacityValue=new o.Animated.Value(this._currentOpacity),this._animatedVerticalValue=new o.Animated.Value(this._currentBottomOffset),this._animatedStyle=o.Styles.createAnimatedViewStyle({opacity:this._animatedOpacityValue,bottom:this._animatedVerticalValue}),g.log(h.LogTraceArea.CallingUI,"EventItemLayoutController constructor "+a.pii.Omit(e)),this._id=e,this._onIntrinsicHeightChange=t,this._onRemoveItem=i,this._currentBottomOffset=n}getStyles(){return[this._animatedStyle]}setIntrinsicHeight(e){Math.abs(e-this._currentHeight)>1&&(this._currentHeight=e,this._onIntrinsicHeightChange(this._id,e,!this._hasBeenPresented))}presentItemIfNeeded(e=!1){return!this._hasBeenPresented&&(g.log(h.LogTraceArea.CallingUI,"EventItemLayoutController presentItemIfNeeded "+a.pii.Omit(this._id)),this._hasBeenPresented=!0,this._animatedVerticalValue.setValue(-1.2*this._currentHeight),this._updateAnimatedPosition(this._currentBottomOffset,this._currentOpacityValue(),e,!0,450,()=>this._startDismissTimer()),!0)}setDismissTimerTimeout(e){this._dismissTimerTimeout=e}restartDismissTimer(){this._startDismissTimer()}dismissItem(e=!1){return!this._hasBeenDismissed&&(g.log(h.LogTraceArea.CallingUI,"EventItemLayoutController dismissItem "+a.pii.Omit(this._id)),this._clearDismissTimer(),this._updateAnimatedPosition(this._currentBottomOffset+40,0,e,!1,750,()=>{this._onRemoveItem&&this._onRemoveItem(this._id)}),this._hasBeenDismissed=!0,!0)}addtoBottomOffset(e,t=!1){this._updateAnimatedPosition(this._currentBottomOffset+e,this._currentOpacityValue(),t)}_clearDismissTimer(){this._dismissTimer&&(_.default.clearTimeout(this._dismissTimer),this._dismissTimer=void 0)}_startDismissTimer(){this._clearDismissTimer(),this._dismissTimer=_.default.setTimeout(()=>this.dismissItem(!0),this._dismissTimerTimeout)}_currentOpacityValue(){return this._hasBeenPresented&&!this._hasBeenDismissed?1:0}_updateAnimatedPosition(e,t=1,i=!1,a=!1,n=300,s,r){if(!this._hasBeenDismissed){if(this._animation&&(this._animation.stop(),this._animation=void 0),i){let i=r||[];0!==t&&i.push(o.Animated.timing(this._animatedVerticalValue,{toValue:e,duration:n,easing:a?o.Animated.Easing.CubicBezier(.87,-.41,.19,1.44):o.Animated.Easing.InOut()})),i.push(o.Animated.timing(this._animatedOpacityValue,{toValue:t,duration:n,easing:o.Animated.Easing.InOut()})),this._animation=o.Animated.parallel(i),this._animation.start(e=>{s&&s()})}else this._animatedVerticalValue.setValue(e),this._animatedOpacityValue.setValue(t),s&&s();this._currentOpacity=t,this._currentBottomOffset=e}}}class T{constructor(){this._controllers={},this._orderedKeys=[],this._onIntrinsicHeightChange=(e,t,i)=>{let a=n.indexOf(this._orderedKeys,e);if(i)if("FixedPositionItem"===e){const e=this.getFixedPositionItemController(!1);null==e||e.presentItemIfNeeded()}else{const e=this.controllerForKey(this._orderedKeys[a],!1);e&&e.presentItemIfNeeded(!0)}for(a-=1;a>=0;a--){const e=this.controllerForKey(this._orderedKeys[a],!1);e&&e.addtoBottomOffset(t,!0)}}}updateViewDimensions(e){}setCallbacks(e){this._onRemoveItem=e}clearEvents(){n.each(this._controllers,e=>e.dismissItem())}controllerForKey(e,t,i=0){let a=this._controllers[e];return!a&&t&&(a=new w(e,this._onIntrinsicHeightChange,this._onRemoveItem,i),this._controllers[e]=a,this._orderedKeys.push(e)),a}getFixedPositionItemController(e){return!this._fixedPositionItemController&&e&&(this._fixedPositionItemController=new w("FixedPositionItem",this._onIntrinsicHeightChange,this._onRemoveItem,0)),this._fixedPositionItemController}removeControllerForKey(e){"FixedPositionItem"===e?delete this._fixedPositionItemController:(delete this._controllers[e],this._orderedKeys=n.without(this._orderedKeys,e))}}},3701:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallEventStreamItem=void 0;const a=i(0),n=i(15),o=(i(153),i(3702),i(6)),s=i(742),r=i(9),l=i(16),c=i(101),d=o.lazyProperties({container:()=>a.Styles.createViewStyle({position:"absolute",left:16,right:16,paddingTop:12,flexDirection:"row",alignSelf:"stretch",overflow:"visible"}),contentContainer:()=>a.Styles.createViewStyle({flex:-1,alignItems:"stretch",alignSelf:"center",paddingLeft:5,paddingRight:10}),middleContainer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignSelf:"stretch",overflow:"visible"}),middleContentInner:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"flex-start",overflow:"visible"}),contentText:()=>a.Styles.createTextStyle({color:r.Color.black,paddingVertical:8}),contentTextLight:()=>a.Styles.createTextStyle({color:r.Color.white}),wrapper:()=>a.Styles.createViewStyle({flex:-1,paddingHorizontal:8,flexDirection:"row",minHeight:40,borderRadius:20,backgroundColor:r.Color.blackOverlay50,justifyContent:"center",alignItems:"center",overflow:"visible"}),flipSide:()=>a.Styles.createViewStyle({height:26,width:26,alignItems:"center",justifyContent:"center"}),flipContainer:()=>a.Styles.createViewStyle({height:26,width:26,overflow:"visible"}),raiseHandBorderStyle:()=>a.Styles.createViewStyle({borderColor:r.Color.raiseHandOrange,borderWidth:2})});class u extends n.ComponentBase{constructor(){super(...arguments),this._onLayoutChange=e=>{this.props.layoutController&&this.props.layoutController.setIntrinsicHeight(e.height)}}_getColorStyle(){return a.Styles.createViewStyle({backgroundColor:this.props.backgroundColor},!1)}_getUserIconElement(){if(!this.props.mri)return;const e=a.createElement(c.UserIcon,{size:26,userMri:this.props.mri,imageBorderStyleOverride:this.props.isRaiseHandEvent?d.raiseHandBorderStyle:void 0});return this.props.isLeaveEvent||this.props.isRaiseHandEvent||this.props.isTextEvent,e}componentDidMount(){super.componentDidMount(),a.Accessibility.announceForAccessibility(this.props.displayString)}render(){const e=[d.wrapper,this._getColorStyle()],t=[d.contentText];(this.props.isLeaveEvent||this.props.useLightText)&&t.push(d.contentTextLight);const i=this.props.isRaiseHandEvent?a.createElement(s.default,{type:s.RaiseHandImageType.SmallSizeTopLeftAligned}):void 0,n=a.createElement(a.View,{key:"contentContainerWrapper",style:e},this._getUserIconElement(),i,a.createElement(a.View,{key:"contentContainer",style:d.contentContainer},a.createElement(l.BodyText,{size:l.BodyTextSize.SmallDeprecated,style:t},this.props.displayString))),o=a.createElement(a.View,{key:"middleContentInner",style:d.middleContentInner,ignorePointerEvents:!0},n),r=[d.container];return this.props.layoutController&&r.push(this.props.layoutController.getStyles()),this.props.horizontalSafeAreaInsets&&this.props.horizontalSafeAreaInsets.left>16&&r.push(a.Styles.createViewStyle({left:this.props.horizontalSafeAreaInsets.left,right:this.props.horizontalSafeAreaInsets.right},!1)),a.createElement(a.Animated.View,{style:r,ignorePointerEvents:!0,onLayout:this._onLayoutChange},a.createElement(a.View,{key:"middleContent",style:d.middleContainer,ignorePointerEvents:!0},o))}}t.CallEventStreamItem=u,t.default=u},3702:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(15),o=i(6),s=i(14),r=i(31),l=o.lazyProperties({backFlippedHorizontal:()=>a.Styles.createViewStyle({transform:[{rotateY:"180deg"}]}),backFlippedVertical:()=>a.Styles.createViewStyle({transform:[{rotateX:"180deg"}]})});class c extends n.ComponentBase{constructor(){super(...arguments),this._rotationYValue=new a.Animated.Value(0),this._rotationYStyle=a.Styles.createAnimatedViewStyle({transform:[{rotateY:this._rotationYValue.interpolate({inputRange:[0,360],outputRange:["0deg","360deg"]})}]}),this._rotationXValue=new a.Animated.Value(0),this._rotationXStyle=a.Styles.createAnimatedViewStyle({transform:[{rotateX:this._rotationXValue.interpolate({inputRange:[0,360],outputRange:["0deg","360deg"]})}]}),this._onToggle=()=>{this._flipAnimation(!this.state.isFlipped)}}_buildState(e,t){const i={};return t&&(i.isFlipped=!1),i}componentDidMount(){super.componentDidMount(),this.props.autoflipTimeout&&r.default.setTimeout(()=>{this.isComponentMounted()&&this._onToggle()},this.props.autoflipTimeout)}_flipAnimation(e){const t=this.props.duration||1e3;this.props.flipHorizontal?a.Animated.timing(this._rotationYValue,{toValue:e?180:0,duration:t,easing:a.Animated.Easing.InOutBack()}).start():a.Animated.timing(this._rotationXValue,{toValue:e?180:0,duration:t,easing:a.Animated.Easing.InOutBack()}).start(),r.default.setTimeout(()=>{this.isComponentMounted()&&this.setState({isFlipped:e})},t/2)}render(){const e=this.props.children;let t;t=this.state.isFlipped?a.createElement(d,{key:"back",isBack:!0,flipHorizontal:this.props.flipHorizontal},e[1]):a.createElement(d,{key:"front",flipHorizontal:this.props.flipHorizontal},e[0]);const i=[s.default.flexOne,this.props.flipHorizontal?this._rotationYStyle:this._rotationXStyle];return a.createElement(a.View,{style:this.props.style},a.createElement(a.Animated.View,{style:i},t))}}t.default=c;class d extends n.ComponentBase{render(){const e=[s.default.flexOne];return this.props.isBack&&e.push(this.props.flipHorizontal?l.backFlippedHorizontal:l.backFlippedVertical),a.createElement(a.View,{style:e},this.props.children)}}},3703:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(34),n=i(1),o=i(0),s=i(15),r=i(325),l=i(60),c=i(104),d=i(3),u=i(4),h=i(6),p=i(105),g=i(21),C=i(23),m=i(3704),S=i(3705),y=i(9),f=i(31),_=i(10),b=h.lazyProperties({container:()=>o.Styles.createViewStyle({backgroundColor:y.Color.transparent}),dismissalView:()=>o.Styles.createViewStyle({position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:y.Color.transparent})});class v extends s.ComponentBase{constructor(){super(...arguments),this._backgroundColorValue=new o.Animated.Value(0),this._backgroundColorStyle=o.Styles.createAnimatedViewStyle({backgroundColor:this._backgroundColorValue.interpolate({inputRange:[0,1],outputRange:[y.Color.transparent,y.Color.blackOverlay50]})}),this._isPanning=!1,this._onWillRemoveItem=e=>{this.state.itemRenderInfo.length<=1&&this._toggleBackgroundColor(!1)},this._onDidRemoveItem=e=>{this.isComponentMounted()&&(this._layoutController.removeControllerForKey(e),this.setState(this._removeStreamItemsAndReturnNewState(e)))},this._onPanItem=e=>{this._isPanning=e},this._renderItem=e=>{const t=e.id,i=e.item;return o.createElement(S.default,{key:t,eventId:t,mri:i.mri,message:i.message,layoutController:e.layoutController,onPan:this._onPan,onTap:this._onTap,onLoad:this._onItemLoad,onClose:this._onClose})},this._onClose=e=>{this._layoutController.dismissItem(e),this.props.onPhotoDismissed&&this.props.onPhotoDismissed()},this._onPan=(e,t)=>{const i=this._layoutController.existingControllerForKey(e);i&&i.onPan(t)},this._onTap=(e,t)=>{const i=_.default.newCauseId(),o=n.findIndex(this.state.itemRenderInfo,t=>t.id===e),s=-1!==o?this.state.itemRenderInfo[o].item.message:void 0;u.log(d.LogTraceArea.CallReactions,"PhotoEventStream onTap "+a.pii.Omit(e)+" message: "+(s?s.cuid:"none")+" causeId: "+i),this.props.isDesktop||this._layoutController.clearEvents(),this.props.photoTapDelay?f.default.setTimeout(()=>{this.isComponentMounted()&&this.props.onPhotoTap&&this.props.onPhotoTap(s,t,i)},this.props.photoTapDelay):this.props.onPhotoTap&&this.props.onPhotoTap(s,t,i),this.props.isDesktop&&f.default.setTimeout(()=>{this._layoutController.clearEvents()},500),s&&!g.default.isMyMri(s.creator)&&r.default.markOneIncomingPhotoSeen(this.props.reactionsConversationMri)},this._onDismissalTap=()=>{this.clearEvents()},this._onItemLoad=e=>{this.isComponentMounted()&&(this.props.isDesktop||this._toggleBackgroundColor(!0),this._layoutController.clearEvents(e),this._layoutController.presentItemIfReady(e))},this._toggleBackgroundColor=(e,t)=>{o.Animated.timing(this._backgroundColorValue,{toValue:e?1:0,duration:200,easing:o.Animated.Easing.InOut()}).start(t)},this._onLayoutChange=e=>{this._layoutController.updateViewDimensions({width:e.width,height:e.height})}}_buildState(e,t){let i={};if(t){this._eventCount=0;let t=e.isDesktop?l.PhotoAnimationDirection.Zoom:C.default.isUsingStackNavigationContext()?l.PhotoAnimationDirection.Right:l.PhotoAnimationDirection.Left;this._layoutController=new m.PhotoEventsLayoutController(!!e.isDesktop,t,e.bottomMargin,e.desktopSideMargin),i.itemRenderInfo=[]}return i}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this._layoutController.setCallbacks(e=>this._onWillRemoveItem(e),e=>this._onDidRemoveItem(e),e=>this._onPanItem(e))}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.itemRenderInfo.length&&!t.itemRenderInfo.length&&this._toggleBackgroundColor(!1)}photoEvent(e,t){if(this._isPanning)return;let i=n.clone(this.state.itemRenderInfo);const a="photo_"+this._eventCount++,o=g.default.isMyMri(e.creator),s=c.decode(e);let r;if(this.props.sizePhotosToFit){const e=s.getFirstUriObjectChild(p.PictureNode);if(e){const t=e.getOriginalDimensions();t.width&&t.height&&(r=t)}}u.log(d.LogTraceArea.CallReactions,"PhotoEventStream photoEvent  intrinsicSize "+(r?r.width+", "+r.height:"none")+" message: "+e.cuid);const l=this._layoutController.controllerForKey(a,o,r);i.push({id:a,item:{mri:t,message:e},layoutController:l}),this.setState({itemRenderInfo:i})}clearEvents(){this._layoutController.clearEvents()}_removeStreamItemsAndReturnNewState(e){let t=n.clone(this.state.itemRenderInfo);return{itemRenderInfo:n.filter(t,t=>t.id!==e)}}render(){const e=n.map(this.state.itemRenderInfo,this._renderItem),t=[b.container,this.props.isDesktop?void 0:this._backgroundColorStyle,this.props.style],i=!this.props.isDesktop&&e.length>0?o.createElement(o.View,{style:b.dismissalView,onPress:this._onDismissalTap}):void 0;return o.createElement(o.Animated.View,{style:t,onLayout:this._onLayoutChange,ignorePointerEvents:!0},i,e)}}t.default=v},3704:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PhotoEventsLayoutController=t.PhotoEventItemLayoutController=void 0;const a=i(1),n=i(0),o=i(7),s=i(60),r=i(3),l=i(4),c=i(345),d=i(399),u=i(31),h=i(10),p={width:300,height:300};class g{constructor(e,t,i,a,o,s,r,l,d=10,u=10){if(this._hasBeenPresented=!1,this._hasBeenDismissed=!1,this._isPanning=!1,this._viewRect={x:0,y:0,width:0,height:0},this._animatedVerticalValue=new n.Animated.Value(0),this._animatedHorizontalValue=new n.Animated.Value(0),this._animatedHeightValue=new n.Animated.Value(1),this._animatedWidthValue=new n.Animated.Value(1),this._animatedTransfromValueForScale=new n.Animated.Value(0),this._animatedTransformValueForX=new n.Animated.Value(0),this._animatedTransformValueForY=new n.Animated.Value(0),this._incomingPhotoSound=c.default.SkypeShutter,this._id=e,this._parentViewDimensions=t,this._onWillRemoveItem=a,this._onDidRemoveItem=o,this._onPanItem=i,this._isDesktop=s,this._animationDirection=r,this._bottomMargin=d,this._desktopSideMargin=u,l&&l.width&&l.height){let e,t;l.width>l.height?(e=p.width,t=p.width*(l.height/l.width)):(t=260,e=p.height*(l.width/l.height)),e=Math.max(e,260),t=Math.max(t,260),this._containerDimensions={width:e,height:t}}else this._containerDimensions=p;const h=this._animationOffset();this._animatedTransformValue=new n.Animated.Value(h),this._rectStyleForMobile=n.Styles.createAnimatedViewStyle({left:this._animatedHorizontalValue,bottom:this._animatedVerticalValue,height:this._animatedHeightValue,width:this._animatedWidthValue});const g={bottom:this._bottomMargin,height:this._containerDimensions.height,width:this._containerDimensions.width};g.right=this._desktopSideMargin,this._rectStyleForDesktop=n.Styles.createViewStyle(g,!1),this._setPositionStyle(),this._imageStyle=n.Styles.createImageStyle({width:this._containerDimensions.width,height:this._containerDimensions.height},!1)}_setPositionStyle(){switch(this._animationDirection){case s.PhotoAnimationDirection.Zoom:this._positionStyle=n.Styles.createAnimatedViewStyle({transform:[{translateX:this._animatedTransformValueForX},{translateY:this._animatedTransformValueForY},{scale:this._animatedTransfromValueForScale}],opacity:this._animatedTransfromValueForScale});break;case s.PhotoAnimationDirection.Up:this._positionStyle=n.Styles.createAnimatedViewStyle({transform:[{translateY:this._animatedTransformValue}]});break;default:this._positionStyle=n.Styles.createAnimatedViewStyle({transform:[{translateX:this._animatedTransformValue}]})}}getRectStyles(){return this._isDesktop?this._rectStyleForDesktop:this._rectStyleForMobile}getPositionStyles(){return this._positionStyle}getImageStyle(){return this._imageStyle}presentItemIfReady(e=!0){if(this._hasBeenPresented)return!1;this._hasBeenPresented=!0;const t=h.default.newCauseId();l.log(r.LogTraceArea.GenericUnsafe,"PhotoEventItemLayoutController.presentItemIfReady causeId: "+t),this._incomingPhotoSound.playOnce(t);const i=o.default.getS4LCMCFeaturesNoSubscription().photoEventTimeoutMs;return this._isDesktop?this._updateAnimatedPositionForDesktop(this._itemRect(),0,!0,1,!1,()=>this._startDismissTimer(i)):this._updateAnimatedPosition(this._itemRect(),0,!1,e,()=>this._startDismissTimer(i)),!0}_itemRect(){const e=this._containerDimensions;let t,i;return this._isDesktop?(t=this._desktopSideMargin,i=this._bottomMargin):(t=(this._parentViewDimensions.width-e.width)/2,i=(this._parentViewDimensions.height-e.height)/2),Object.assign({x:t,y:i},e)}dismissItem(e=!0){return!this._hasBeenDismissed&&!this._isPanning&&(this._onWillRemoveItem&&this._onWillRemoveItem(this._id),this._clearDismissTimer(),this._isDesktop?this._updateAnimatedPositionForDesktop({x:this._desktopSideMargin-this._desktopSideMargin/2,y:this._bottomMargin-this._bottomMargin/2,width:0,height:0},this._animationOffset(),e,0,e,()=>{u.default.setTimeout(()=>{this._onDidRemoveItem&&this._onDidRemoveItem(this._id)},1e3)}):this._updateAnimatedPosition(this._viewRect,this._animationOffset(),!1,e,()=>{this._onDidRemoveItem&&this._onDidRemoveItem(this._id)}),this._hasBeenDismissed=!0,!0)}onPan(e){if(this._hasBeenDismissed||!this._hasBeenPresented||this._animationDirection===s.PhotoAnimationDirection.Up)return;let t=e.pageX-e.initialPageX;this._animationDirection===s.PhotoAnimationDirection.Left&&t<0?t=-1*Math.sqrt(Math.abs(t)):this._animationDirection===s.PhotoAnimationDirection.Right&&t>0&&(t=Math.sqrt(Math.abs(t))),this._animatedTransformValue.setValue(t),e.isComplete?this._isPanning&&(this._isPanning=!1,this._onPanItem(!1),this.dismissItem()):this._isPanning||(this._isPanning=!0,this._onPanItem(!0))}_animationOffset(){if(!this._parentViewDimensions)return 0;switch(this._animationDirection){case s.PhotoAnimationDirection.Left:return this._parentViewDimensions.width-this._viewRect.x;case s.PhotoAnimationDirection.Right:return-1*(this._parentViewDimensions.width-this._viewRect.x);case s.PhotoAnimationDirection.Up:return this._containerDimensions.height+300;case s.PhotoAnimationDirection.Zoom:return(this._containerDimensions.height+10)/2}return 0}_clearDismissTimer(){this._dismissTimer&&(u.default.clearTimeout(this._dismissTimer),this._dismissTimer=void 0)}_startDismissTimer(e){this._clearDismissTimer(),this._dismissTimer=u.default.setTimeout(()=>this.dismissItem(!0),e)}updateViewDimensions(e){this._parentViewDimensions=e;const t=this._itemRect();this._animatedVerticalValue.setValue(t.y),this._animatedHorizontalValue.setValue(t.x),this._animatedWidthValue.setValue(t.width),this._animatedHeightValue.setValue(t.height)}_updateAnimatedPositionForDesktop(e,t,i=!0,o,s=!0,r,l){if(this._hasBeenDismissed)return;let c=l||[];i?c.push(d.default.easeOut({value:this._animatedTransfromValueForScale,toValue:o})):this._animatedTransfromValueForScale.setValue(o),s?(c.push(d.default.easeOut({value:this._animatedTransformValueForX,toValue:-1*t})),c.push(d.default.easeOut({value:this._animatedTransformValueForY,toValue:t}))):(this._animatedTransformValueForX.setValue(-1*t),this._animatedTransformValueForY.setValue(t)),a.isEmpty(c)?r&&r():n.Animated.parallel(c).start(e=>{r&&r()}),this._viewRect=e}_updateAnimatedPosition(e,t,i=!0,o=!0,s,r){if(this._hasBeenDismissed)return;let l=r||[];i?(l.push(d.default.easeOut({value:this._animatedVerticalValue,toValue:e.y})),l.push(d.default.easeOut({value:this._animatedHorizontalValue,toValue:e.x})),l.push(d.default.easeOut({value:this._animatedWidthValue,toValue:e.width})),l.push(d.default.easeOut({value:this._animatedHeightValue,toValue:e.height}))):(this._animatedVerticalValue.setValue(e.y),this._animatedHorizontalValue.setValue(e.x),this._animatedWidthValue.setValue(e.width),this._animatedHeightValue.setValue(e.height)),o?l.push(d.default.easeOut({value:this._animatedTransformValue,toValue:t})):this._animatedTransformValue.setValue(t),a.isEmpty(l)?s&&s():n.Animated.parallel(l).start(e=>{s&&s()}),this._viewRect=e}}t.PhotoEventItemLayoutController=g;t.PhotoEventsLayoutController=class{constructor(e,t,i,a){this._controllers={},this._orderedKeys=[],this._isDesktop=e,this._animationDirection=t,this._bottomMargin=i,this._desktopSideMargin=a}updateViewDimensions(e){this._viewDimensions=e,a.each(this._controllers,t=>t.updateViewDimensions(e))}setCallbacks(e,t,i){this._onWillRemoveItem=e,this._onDidRemoveItem=t,this._onPanItem=i}clearEvents(e){a.each(this._controllers,(t,i)=>{i!==e&&(this._isDesktop?t.dismissItem(!1):t.dismissItem())})}dismissItem(e){const t=this.existingControllerForKey(e);t&&t.dismissItem()}presentItemIfReady(e,t=!0){const i=this.existingControllerForKey(e);i&&i.presentItemIfReady(t)}existingControllerForKey(e){return this._intControllerForKey(e,!1)}controllerForKey(e,t,i){return this._intControllerForKey(e,!0,t,i)}_intControllerForKey(e,t,i,a){let n=this._controllers[e];return!n&&t&&(n=new g(e,this._viewDimensions,this._onPanItem,this._onWillRemoveItem,this._onDidRemoveItem,this._isDesktop,i&&!this._isDesktop?s.PhotoAnimationDirection.Up:this._animationDirection,a,this._bottomMargin,this._desktopSideMargin),this._controllers[e]=n,this._orderedKeys.push(e)),n}removeControllerForKey(e){delete this._controllers[e],this._orderedKeys=a.without(this._orderedKeys,e)}}},3705:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PhotoEventStreamItem=void 0;const a=i(0),n=i(15),o=i(104),s=i(117),r=i(86),l=i(141),c=i(26),d=i(6),u=i(5),h=i(105),p=i(21),g=i(9),C=i(11),m=i(14),S=i(204),y=i(101),f=i(65),_=d.lazyProperties({container:()=>a.Styles.createViewStyle({position:"absolute"}),innerContainer:()=>a.Styles.createViewStyle({borderRadius:10,backgroundColor:g.Color.white,justifyContent:"center",alignItems:"flex-end",flexDirection:"row"}),imageView:()=>a.Styles.createViewStyle({borderTopLeftRadius:10,borderTopRightRadius:10}),imageViewNoFooter:()=>a.Styles.createViewStyle({borderRadius:10}),attributionView:()=>a.Styles.createViewStyle({position:"absolute",top:10,left:10}),closeButtonContainer:()=>a.Styles.createViewStyle({position:"absolute",top:0,right:0,width:50,height:50,alignItems:"center",justifyContent:"center"}),closeButton:()=>a.Styles.createViewStyle({backgroundColor:g.Color.blackOverlay35,width:30,height:30,borderRadius:15,alignItems:"center",justifyContent:"center"})});class b extends n.ComponentBase{constructor(){super(...arguments),this._onPan=e=>{this.props.onPan&&this.props.onPan(this.props.eventId,e)},this._onComponentRef=e=>{this._viewRef=e||void 0},this._onTap=e=>{this.props.onTap&&this.props.onTap(this.props.eventId,this._getRef)},this._getRef=()=>this.isComponentMounted()?this._viewRef:void 0,this._onLoad=e=>{this.props.onLoad&&this.props.onLoad(this.props.eventId)},this._onClose=()=>{this.props.onClose&&this.props.onClose(this.props.eventId)}}_buildState(e,t){let i,a=!1;if(e.message){const t=o.decode(e.message).getFirstUriObjectChild(h.PictureNode);i=t&&t.getDisplayUrlAsThumbnailSanitized(),a=p.default.isMyMri(e.message.creator)}return{thumbnailUrl:i?S.default.getAuthenticatedUrl(i):void 0,postedByCurrentUser:a}}render(){const e=[_.container,m.default.overflowVisible],t=[m.default.absoluteFill,_.innerContainer],i=[this.state.postedByCurrentUser?_.imageViewNoFooter:_.imageView];this.props.layoutController&&(e.push(this.props.layoutController.getRectStyles()),i.push(this.props.layoutController.getImageStyle()),t.push(this.props.layoutController.getPositionStyles()));const n=a.createElement(r.default,{key:"attribution",style:_.attributionView},a.createElement(y.UserIcon,{userMri:this.props.message.creator,size:f.UserIconSize.Size30,showBorder:!0})),o=this.props.onClose?a.createElement(l.HoverableButton,{key:"closebutton",style:_.closeButtonContainer,accessibilityLabel:u.getString("CallPanel.ClosePhoto"),onPress:this._onClose},a.createElement(a.View,{style:_.closeButton},a.createElement(c.default,{icon:C.SkypeIcon.Cancel,size:C.IconSize.size16,color:g.Color.white}))):void 0,d=[m.default.absoluteFill,m.default.pointerCursor],h=[a.createElement(a.GestureView,{key:"imagecontainer",style:d,onPanHorizontal:this._onPan,onTap:this._onTap},a.createElement(s.default,{origin:"PhotoEvent",containerStyle:m.default.absoluteFill,style:i,source:this.state.thumbnailUrl,resizeMode:"cover",onLoad:this._onLoad})),n,o],p=a.createElement(a.Animated.View,{style:t,ignorePointerEvents:!0},h);return a.createElement(a.Animated.View,{ref:this._onComponentRef,style:e,ignorePointerEvents:!0},p)}}t.PhotoEventStreamItem=b,t.default=b},3706:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(1797),o=i(421);class s extends o.StackNavHeightBasedToast{_getContainerStyle(){return o.CommonToastStyles.container}_renderContent(){return a.createElement(n.default,{callId:this.props.callId,conversationMri:this.props.conversationMri,textStyle:o.CommonToastStyles.titleStyle,linkStyle:o.CommonToastStyles.linkStyle})}}t.default=s},3707:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStackNavCallMediaCapturerToast=t.RemoteStackNavCallMediaCapturerToast=void 0;const a=i(0),n=i(15),o=i(512),s=i(1798),r=i(100);class l extends n.ComponentBase{render(){return a.createElement(s.RemoteStackNavPrivacyToast,{conversationMri:this.props.conversationMri,initiatorMri:this.props.initiatorMri,topInset:this.props.topInset,viewWidth:this.props.viewWidth,onDesiredHeightChanged:this.props.onDesiredHeightChanged,notificationTextPath:"CallMediaCapturerToast.NotificationText",startedAccessibilityLabelTextPath:"CallMediaCapturerToast.StartedAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallMediaCapturerToast.StoppedAccessibilityLabel"})}}t.RemoteStackNavCallMediaCapturerToast=l;class c extends n.ComponentBase{constructor(){super(...arguments),this._getTimestamp=()=>{},this._onStopPress=()=>{o.default.setNdiEnabled(!1)}}render(){return a.createElement(s.LocalStackNavPrivacyToast,{topInset:this.props.topInset,viewWidth:this.props.viewWidth,onDesiredHeightChanged:this.props.onDesiredHeightChanged,onStopPress:this._onStopPress,getTimestamp:this._getTimestamp,colorThemeOverride:r.Theme.ColorfulDark,privacyStatementTextPath:"CallMediaCapturerToast.PrivacyStatementText",morePrivacyInfoLinkTextPath:"CallMediaCapturerToast.MorePrivacyInfoLinkText",stopLinkTextPath:"CallMediaCapturerToast.StopLinkText",startedAccessibilityLabelTextPath:"CallMediaCapturerToast.StartedInitiatorAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallMediaCapturerToast.StoppedInitiatorAccessibilityLabel"})}}t.LocalStackNavCallMediaCapturerToast=c},3708:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(15),o=i(29),s=i(1798),r=i(100);class l extends n.ComponentBase{constructor(){super(...arguments),this._getTimestamp=()=>o.default.CallingStore.getCallRecordingTimestamp(this.props.callId)}_buildState(e,t){const i=o.default.CallingStore.getCallRecordingInitiator(e.callId);return{initiatorMri:i,isLocalInitiator:o.default.InCallBotUtils.isCallRecordingInitiator(i)}}render(){return this.state.initiatorMri&&this.state.isLocalInitiator?a.createElement(s.LocalStackNavPrivacyToast,{topInset:this.props.topInset,viewWidth:this.props.viewWidth,onDesiredHeightChanged:this.props.onDesiredHeightChanged,onStopPress:this.props.onPress,getTimestamp:this._getTimestamp,colorThemeOverride:r.Theme.ColorfulDark,privacyStatementTextPath:"CallRecorderToast.PrivacyStatementText",morePrivacyInfoLinkTextPath:"CallRecorderToast.RecordingInitiatorMorePrivacyInfoLinkText",stopLinkTextPath:"CallRecorderToast.StopRecordingLinkText",startedAccessibilityLabelTextPath:"CallRecorderToast.StartedRecordingInitiatorAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallRecorderToast.StoppedRecordingInitiatorAccessibilityLable"}):a.createElement(s.RemoteStackNavPrivacyToast,{conversationMri:this.props.conversationMri,initiatorMri:this.state.initiatorMri,topInset:this.props.topInset,viewWidth:this.props.viewWidth,onDesiredHeightChanged:this.props.onDesiredHeightChanged,notificationTextPath:"CallRecorderToast.IsRecordingText",initialNotficationTextPath:"CallRecorderToast.StartingRecordingText",startedAccessibilityLabelTextPath:"CallRecorderToast.StartedRecordingAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallRecorderToast.StoppedRecordingAccessibilityLabel"})}}t.default=l},3709:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(100),o=i(1800),s=i(421);class r extends s.StackNavHeightBasedToast{_getContainerStyle(){}_renderContent(){return a.createElement(o.default,{closeToast:this.props.closeToast,colorThemeOverride:n.Theme.ColorfulDark})}}t.default=r},3710:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(1801),o=i(421);class s extends o.StackNavHeightBasedToast{_getContainerStyle(){return o.CommonToastStyles.container}_renderContent(){return a.createElement(n.default,{toastType:this.props.type,textStyle:o.CommonToastStyles.titleStyle,conversationMri:this.props.conversationMri,onDismiss:this.props.closeToast})}}t.default=s},3711:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(1802),o=i(421);class s extends o.StackNavHeightBasedToast{_getContainerStyle(){return o.CommonToastStyles.container}_renderContent(){return a.createElement(n.default,{callId:this.props.callId,textStyle:o.CommonToastStyles.titleStyle,linkStyle:o.CommonToastStyles.linkStyle})}}t.default=s},3712:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(3713),o=i(421);class s extends o.StackNavHeightBasedToast{_getContainerStyle(){return o.CommonToastStyles.container}_renderContent(){return a.createElement(n.default,{callId:this.props.callId,conversationMri:this.props.conversationMri,isEncryptedCall:this.props.isEncryptedCall,isPSTNCall:this.props.isPSTNCall,textStyle:o.CommonToastStyles.titleStyle,linkStyle:o.CommonToastStyles.linkStyle})}}t.default=s},3713:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(15),o=i(3),s=i(26),r=i(4),l=i(6),c=i(5),d=i(1546),u=i(9),h=i(11),p=i(16),g=l.lazyProperties({container:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center"}),icon:()=>a.Styles.createViewStyle({marginRight:10})});class C extends n.ComponentBase{constructor(){super(...arguments),this._onStopPress=e=>{r.log(o.LogTraceArea.CallingUI,"MobileScreenShareBanner disable screen-share clicked"),new d.MobileScreenShareToggleCommand(this.props).execute()}}render(){return a.createElement(a.View,{style:g.container},a.createElement(s.default,{style:g.icon,icon:h.SkypeIcon.ScreenShare,size:h.IconSize.size24,color:u.Color.white}),a.createElement(a.View,{style:this.props.containerStyle},a.createElement(p.BodyText,{bold:!0,style:this.props.textStyle,numberOfLines:1},c.getString("MobileScreenSharingToast.BannerTitle")),a.createElement(a.Button,{onPress:this._onStopPress},a.createElement(p.BodyText,{style:this.props.linkStyle},c.getString("MobileScreenSharingToast.StopSharingLinkText")))))}}t.default=C},3714:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(26),o=i(6),s=i(5),r=i(421),l=i(9),c=i(11),d=i(16),u=o.lazyProperties({containerstyle:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),titleStyle:()=>a.Styles.createTextStyle({paddingLeft:7})});class h extends r.StackNavHeightBasedToast{_getContainerStyle(){return r.CommonToastStyles.container}_renderContent(){return a.createElement(a.View,{style:u.containerstyle},a.createElement(n.default,{icon:c.SkypeIcon.MicrophoneOff,size:c.IconSize.size14,color:l.Color.white}),a.createElement(d.BodyText,{bold:!0,style:[r.CommonToastStyles.titleStyle,u.titleStyle],numberOfLines:1},s.getString("CallPanel.MicrophoneServerMuted")))}}t.default=h},3715:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(29),o=i(3),s=i(4),r=i(6),l=i(1803),c=i(421),d=r.lazyProperties({metadataContainer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center"})});class u extends c.StackNavHeightBasedToast{constructor(){super(...arguments),this._dismiss=()=>{s.log(o.LogTraceArea.CallingUI,"StackNavSpokenLanguageConflictResolutionToast._dismiss"),n.default.InCallBotService.setSpokenLanguageConflictToastShown(this.props.callId,!0),n.default.InCallBotService.hideSubtitlesStartedMessage(this.props.callId)}}_getContainerStyle(){return c.CommonToastStyles.container}_renderContent(){return a.createElement(l.default,{containerStyle:d.metadataContainer,textStyle:c.CommonToastStyles.titleStyle,callId:this.props.callId,onDismiss:this._dismiss})}}t.default=u},3716:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(421),o=i(3717);class s extends n.StackNavHeightBasedToast{_getContainerStyle(){return n.CommonToastStyles.container}_renderContent(){return a.createElement(o.default,{textStyle:n.CommonToastStyles.titleStyle,conversationMri:this.props.conversationMri,onDismiss:this.props.closeToast})}}t.default=s},3717:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(15),o=i(32),s=i(26),r=i(6),l=i(5),c=i(9),d=i(24),u=i(11),h=i(16),p=r.lazyProperties({contentContainer:()=>a.Styles.createButtonStyle({flex:1,flexDirection:"row",alignItems:"center",marginVertical:10}),textContentContainer:()=>a.Styles.createViewStyle({flex:1,alignSelf:"center"}),textContent:()=>a.Styles.createTextStyle({paddingLeft:10,paddingRight:15,flexWrap:"wrap",flex:1}),textContentMobile:()=>a.Styles.createTextStyle({fontSize:d.default.controlFontSize.caption}),container:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"flex-start"}),dismissButtonDesktop:()=>a.Styles.createViewStyle({margin:10}),dismissButtonMobile:()=>a.Styles.createViewStyle({marginTop:10}),translationIconDesktop:()=>a.Styles.createViewStyle({marginLeft:15})});class g extends n.ComponentBase{constructor(){super(...arguments),this._onDismiss=()=>{this.props.onDismiss&&this.props.onDismiss()}}_buildState(e,t){return{conversationName:o.default.getDisplayName(e.conversationMri)||""}}render(){return a.createElement(a.View,{style:[this.props.containerStyle,p.container]},a.createElement(a.View,{style:p.contentContainer},this._renderTeamsIcon(),this._renderTextContent()),this._renderDismissButton())}_renderTeamsIcon(){return a.createElement(s.default,{key:"teamsIcon",style:p.translationIconDesktop,icon:u.SkypeIcon.MSTeams,color:c.Color.white,size:u.IconSize.size24})}_renderTextContent(){return a.createElement(a.View,{key:"textContentContainer",style:p.textContentContainer},a.createElement(h.BodyText,{style:this._getTextStyles()},l.getString("TeamsInteropBanner.TeamsInteropInCallBannerText",{userName:this.state.conversationName})))}_renderDismissButton(){return a.createElement(s.default,{key:"dismissButton",style:p.dismissButtonDesktop,color:c.Color.white,onPress:this._onDismiss,size:u.IconSize.size24,icon:u.SkypeIcon.Cancel})}_getTextStyles(){return[this.props.textStyle,p.textContent]}}t.default=g},3718:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(421),o=i(1804);class s extends n.StackNavHeightBasedToast{_getContainerStyle(){return n.CommonToastStyles.container}_renderContent(){return a.createElement(o.default,{callId:this.props.callId,textStyle:n.CommonToastStyles.titleStyle,linkStyle:n.CommonToastStyles.linkStyle,conversationMri:this.props.conversationMri})}}t.default=s},3719:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(74),s=i(7),r=i(29),l=i(88),c=i(87),d=i(413),u=i(109),h=i(45),p=i(32),g=i(3),C=i(417),m=i(4),S=i(5),y=i(30),f=i(3720);class _ extends h.default{constructor(){super(...arguments),this._toolTipAnimationConfig={duration:250,easing:n.Animated.Easing.OutBack()},this._show=()=>{m.log(g.LogTraceArea.CallingUI,"VideoSuggestionTooltip._show, visible: true"),c.default.setVideoSuggestionTooltipEvent(new l.VideoSuggestionTooltipEvent(this.props.callId)),d.default.setVideoSuggestionTooltipVisibility(this.props.callId,!0)},this._onDismiss=()=>{m.log(g.LogTraceArea.CallingUI,"VideoSuggestionTooltip._onDismiss, visible: false"),c.default.sendVideoSuggestionTooltipEvent(),d.default.setVideoSuggestionTooltipVisibility(this.props.callId,!1)},this._toolTipConfig=()=>{const e=f.default.getTooltipText(this.props.callId);return{getElement:this.props.anchor,positions:[u.PopupAnchorPositon.Top],durationMs:1e4,title:e,anchorAccessibilityLabel:e,instanceId:"videobutton",rootViewId:this._getRootViewId()}},this._onTooltipRef=e=>{this._tooltipRef=e||void 0}}_buildState(e,t){let i,n=!1,l=0;const c=r.default.CallingStore.isProvidingVideo(e.callId),u=d.default.hasVideoSuggestionTooltipBeenSeen(e.callId),h=(y.default.getUserPreferencesLocal().videoSuggestionTooltipInteractionCount||0)<s.default.getS4LCMCFeatures().maximumVideoSuggestionTooltipInteraction;if(!u&&h&&!c){a.each(r.default.CallingStore.getRemoteCallMembers(e.callId),t=>{l+=1,i=p.default.getDisplayName(t.id);const a=r.default.CallingStore.getRemoteCallMemberMri(e.callId,t);n=n||r.default.RemoteStreamHelper.isStreamAvailable(e.callId,a,o.StreamType.Video)});const t=1===l&&i?S.getString("CallControls.VideoSuggestionTooltipOneOnOne",{displayName:i}):S.getString("CallControls.VideoSuggestionTooltipGroup");f.default.setTooltipText(e.callId,t)}return{hasBeenSeen:u,isProvidingVideo:c,hasProvidedVideo:this.state&&this.state.hasProvidedVideo||c,hasCallPreviewViewBeenSeen:d.default.hasCallPreviewViewBeenSeen(e.callId),hasCameras:r.default.DeviceStore.hasCameras(),isAnyRemoteVideoAvailable:n,isVisible:d.default.isVideoSuggestionTooltipVisible(e.callId),interactionCountBelowMaximum:h}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=!!this.props.anchor(),n=!!f.default.getTooltipText(this.props.callId);m.log(g.LogTraceArea.CallingUI,`VideoSuggestionTooltip.componentDidUpdate,\n            hasMountedAnchor: ${a},\n            !hasBeenSeen: ${!this.state.hasBeenSeen},\n            !hasProvidedVideo: ${!this.state.hasProvidedVideo},\n            !hasCallPreviewBeenSeen: ${!this.state.hasCallPreviewViewBeenSeen},\n            hasCameras: ${this.state.hasCameras},\n            interactionCountBelowMaximum: ${this.state.interactionCountBelowMaximum},\n            !isProvidingVideo: ${!this.state.isProvidingVideo},\n            isAnyRemoteVideoAvailable: ${this.state.isAnyRemoteVideoAvailable},\n            !isVisible: ${!this.state.isVisible}\n            tooltipExists: ${!!n}`),t.isVisible&&!this.state.isVisible&&this._tooltipRef&&this._tooltipRef.dismiss(!0),a&&!this.state.hasBeenSeen&&!this.state.hasProvidedVideo&&!this.state.hasCallPreviewViewBeenSeen&&this.state.hasCameras&&this.state.interactionCountBelowMaximum&&!this.state.isProvidingVideo&&this.state.isAnyRemoteVideoAvailable&&!this.state.isVisible&&n&&this._show()}render(){return this.state.isVisible?n.createElement(C.default,{ref:this._onTooltipRef,toolTipInfo:this._toolTipConfig(),animationConfig:this._toolTipAnimationConfig,animateDismissal:!0,onDismiss:this._onDismiss,containerOffsetY:7,containerOffsetX:this.props.containerOffsetX}):null}}t.default=_},3720:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=new class{constructor(){this._tooltipTextDict={}}getTooltipText(e){return this._tooltipTextDict[e]}setTooltipText(e,t){this._tooltipTextDict[e]=t}}},3721:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(177),o=i(0),s=i(74),r=i(7),l=i(1767),c=i(331),d=i(29),u=i(1769),h=i(1768),p=i(219),g=i(60),C=i(110),m=i(113),S=i(17),y=i(13),f=i(532),_=i(254),b=i(3),v=i(41),w=i(4),T=(i(1771),i(914)),I=i(6),P=i(5),M=i(78),k=i(9),A=i(24),R=i(11),V=i(77),E=i(14),L=i(12),B=i(100),O=i(31),D=i(10),x=i(23),N=i(286),U=i(65),F=i(3722),H=i(32);var z;!function(e){e[e.Closed=0]="Closed",e[e.Opening=1]="Opening",e[e.Open=2]="Open"}(z||(z={}));const G=I.lazyProperties({callPanelHeaderDesktop:()=>o.Styles.createViewStyle({appRegion:"drag",flexDirection:"row",alignSelf:"stretch",overflow:"visible",backgroundColor:k.Color.transparent,alignItems:"center",height:g.DesktopNewHeaderHeight}),leftControlDesktop:()=>o.Styles.createViewStyle({width:R.IconSize.size28,height:R.IconSize.size28,flexDirection:"row",justifyContent:"center",alignItems:"center",backgroundColor:k.Color.transparent,paddingTop:0,paddingLeft:10,paddingRight:0}),recentsButton:()=>o.Styles.createViewStyle({borderRadius:R.IconSize.size28/2,backgroundColor:k.Color.white,paddingLeft:0,marginLeft:10}),rightControls:()=>o.Styles.createViewStyle({flexGrow:1,flexDirection:"row",justifyContent:"flex-end",marginRight:10}),rightControlsButton:()=>o.Styles.createButtonStyle({alignSelf:"stretch",alignItems:"center",marginRight:16,height:30}),conversationIcon:()=>o.Styles.createViewStyle({marginLeft:6,marginRight:4}),titleContainerInner:()=>o.Styles.createViewStyle({flex:-1,justifyContent:"center",paddingRight:20}),titleContainer:()=>o.Styles.createViewStyle({alignItems:"stretch",justifyContent:"flex-start",backgroundColor:k.Color.transparent,overflow:"visible",marginRight:16}),titleContainerTablet:()=>E.default.flexOne,undraggableRegion:()=>o.Styles.createViewStyle({appRegion:"no-drag"}),backButtonSpacer:()=>o.Styles.createViewStyle({width:64}),bingBackgroundsFontLightTheme:()=>o.Styles.createTextStyle({color:k.Color.gray400,fontSize:A.default.fontSize.size13Deprecated,font:A.default.font.uiDisplayRegular})});class W extends L.default{constructor(){super(...arguments),this._handleBackButtonClick=e=>{e.stopPropagation();const t=D.default.newCauseId();w.log(b.LogTraceArea.CallingUI,"CallPanelHeaderV2._handleBackButtonClick, causeId: "+t),this.props.onBackButtonPressed(t)},this._handleRecentsButtonPress=e=>{e.stopPropagation();const t=D.default.newCauseId();w.log(b.LogTraceArea.CallingUI,"CallPanelHeaderV2._handleRecentsButtonPress, causeId: "+t),this.props.onRecentsButtonPressed(t)},this._onTitleLayout=e=>{if(this.props.onTitleLayout){const t={x:e.x,y:e.y,width:e.width+60,height:e.height};this.props.onTitleLayout(t)}},this._onTitlePress=()=>{const e=D.default.newCauseId();w.log(b.LogTraceArea.CallingUI,"CallPanelHeaderV2._onTitlePress, causeId: "+e),this.props.onTitlePress&&this.props.onTitlePress(e,g.CallRosterOrigin.FromGroupTitle)},this._onOpenRosterFromConversationIcon=()=>{const e=D.default.newCauseId();this._onOpenRoster(e,g.CallRosterOrigin.FromConversationIcon)},this._onOpenRoster=(e,t)=>{w.log(b.LogTraceArea.CallingUI,"CallPanelHeaderV2._onOpenRoster, causeId: "+e),this.props.onRosterPressed&&this.props.onRosterPressed(e,t)},this._onDynamicAudioChoice=e=>{this.props.onDynamicAudioChoice&&this.props.onDynamicAudioChoice(e,()=>this._audioOutputButton)},this._onAudioOutputButtonRef=e=>{this._audioOutputButton=e||void 0},this._onLayoutButtonRef=e=>{this._layoutButton=e||void 0},this._onNewPickerPress=()=>{const e=()=>this._layoutButton,t=this._getRootViewId();_.default.showWithContent({menuId:_.default.menuId(),anchor:e,rootViewId:t,menuHeight:T.default.getLayoutPickerHeight(this.state.availableMenuItems),content:o.createElement(T.default,{anchor:e,rootViewId:t,useMobileControls:this.props.useMobileControls,isIncomingOrOutGoingRing:this.props.incomingOrOutgoingRing,callId:this.props.callId,conversationMri:this.props.conversationId,availableItems:this.state.availableMenuItems}),useBlurredBackground:!0,colorThemeOverride:B.Theme.DelphiDark,headerConfig:{headerType:f.HeaderType.Slim},staticContent:!0,useTransparentShim:!0,hidePopupArrow:!0,getTitle:()=>{},onCloseMenu:e=>_.default.close(t,e),onMenuClosed:this._onMenuClosed},D.default.newCauseId())},this._toggleGridFocusView=()=>{const e=this.state.hasIncomingScreenshare?g.StageMode.FocusedScreenShare:g.StageMode.Speaker,t=C.default.isInGridStageMode(this.state.stageMode)?e:g.StageMode.Grid;this._changeCallLayoutCommand.execute(t)},this._onMenuClosed=e=>{this.state.availableMenuItems.forEach(e=>{e.markAsSeen&&e.markAsSeen()})}}_buildState(e,t){const i=p.default.getStageMode(e.callId),n=d.default.CallScreenShareStore.hasIncomingScreensharing(e.callId),o={isPSTNCall:d.default.CallingStore.isPSTNCall(e.callId),isEncryptedCall:S.isEncryptedThread(e.conversationId),conversationMri:e.conversationId,callId:e.callId};this._changeCallLayoutCommand=new c.ChangeCallLayoutCommand(o,e.incomingOrOutgoingRing,i);const u=d.default.CallingStore.isProvidingVideo(e.callId),h=d.default.OngoingCallService.getStageParticipants(e.callId),y=M.default.isMobileScreenReaderEnabled(),f=e.useMobileControls&&u&&(!(e.isNewCameraFlipEnabled&&!y)||a.includes(h,g.CallStageElementKeys.localUserKey));let _=s.CameraPosition.Unknown;if(f){const e=d.default.DeviceStore.getSelectedCamera();_=e?e.position:s.CameraPosition.Unknown}const b=r.default.getS4LCMCFeatures().enableFullScreenOnWeb&&!x.default.isUsingSplitViewNoSubscription(),v=C.default.getAvailableMenuItemsV2(e.callId,b,e.useMobileControls,e.conversationId),w={showCameraToggle:f,cameraPosition:_,showRecentsButton:m.default.navigation().canAccessRecentsList,outputRoute:d.default.CallControlsStore.getAudioOutput(),useiOSRoutePicker:l.AudioOutputRouteHelper.useiOSRoutePicker(),stageMode:i,hasIncomingScreenshare:n,changeCallLayoutEnabled:e.useMobileControls&&this._changeCallLayoutCommand.canExecute(),moreOutputRoutesAvailable:!1,newLayoutPickerEnabled:r.default.getS4LCMCFeatures().enableNewLayoutPicker,isOneOnOneCall:d.default.CallingStore.isOneOnOneCall(e.callId),availableMenuItems:v,isOneOnOneConversation:S.isOneOnOneConversation(e.conversationId),conversationName:H.default.getDisplayName(e.conversationId)||P.getString("Notifications.UnknownUserShort")};!t&&e.isRecentsOpen&&this.state?e.isRecentsOpen&&this.state.recentsOpenState===z.Closed&&(w.recentsOpenState=z.Opening,this._clearIsRecentsOpenTimeout(),this._isRecentsOpeUpEdgeTimeout=O.default.setTimeout(()=>{this.isComponentMounted()&&this.setState({recentsOpenState:z.Open}),this._isRecentsOpeUpEdgeTimeout=void 0},300)):(w.recentsOpenState=e.isRecentsOpen?z.Open:z.Closed,this._clearIsRecentsOpenTimeout());const T=r.default.getS4LCMCFeatures().bingBackgrounds,I=d.default.CallParticipantBackgroundInfoStore.captionsReceivedCount(e.callId);return w.shouldShowBingBackgrounds=I>0&&(i===g.StageMode.LargeGrid||i!==g.StageMode.TogetherMode&&i!==g.StageMode.FocusedScreenShare&&T.showInCallHeader),w}_areMoreAudioOutputsAvailable(e){if(!r.default.getS4LCMCFeatures().earpieceHiddenForVideoCalls)return w.log(b.LogTraceArea.CallingUI,"CallPanelHeaderV2.areMoreAudioRoutesAvailable - ECS disabled.  Showing all audio routes."),!0;const t=d.default.CallControlsStore.getAvailableAudioRoutes();w.log(b.LogTraceArea.CallingUI,`CallPanelHeaderV2.areMoreAudioRoutesAvailable video: ${e} availableRoutes: ${t}`);let i=a.size(t);return e&&a.includes(t,n.default.AudioOutputEarpiece)&&i--,i>1}_clearIsRecentsOpenTimeout(){this._isRecentsOpeUpEdgeTimeout&&(O.default.clearTimeout(this._isRecentsOpeUpEdgeTimeout),this._isRecentsOpeUpEdgeTimeout=void 0)}render(){const e=this.props.useHighContrastTheme||this.props.useLightTheme;let t=e?this._themeColors.headerIconColor:k.Color.white;const i=e?this._themeColors.iconHoverColor:k.Color.gray200,a=this._renderNavigationButton(t,e),n=this._renderConversationIcon(),s=this._renderTitleView(),r=this._renderLayoutButton(),l=this._renderFlipCameraButton(t,i),c=this._renderSpeakerButton(t,i),d=this._renderGridFocusToggleButton(t,i),u=this._renderBingBackgroundsButton(),h=[G.titleContainer,G.undraggableRegion];this.props.useMobileControls&&h.push(G.titleContainerTablet);let p=[n,o.createElement(o.Animated.View,{key:"titleControls",style:h,ignorePointerEvents:!0},s),o.createElement(o.View,{key:"rightControls",style:[G.rightControls,G.undraggableRegion]},u,d,c,l,r)];return o.createElement(o.View,{style:G.callPanelHeaderDesktop,ignorePointerEvents:!0},a,p)}_renderNavigationButton(e,t){if(this.props.hideBackButton)return null;let i;const a=this._getRootViewType()===y.RootViewType.SplitViewContent,n=this.state.recentsOpenState===z.Closed,s=t?this._themeColors.iconHoverColor:a||n?k.Color.gray200:k.Color.gray300,r=[G.leftControlDesktop];if(this.state.showRecentsButton){let a,n=e,l=s;this._getRootViewType()===y.RootViewType.SplitViewContent?a=P.getString("CallPanel.ShowRecentsButtonTitle"):(a=this.state.recentsOpenState===z.Open?P.getString("CallPanel.CloseRecentsButtonTitle"):P.getString("CallPanel.OpenRecentsButtonTitle"),this.state.recentsOpenState!==z.Closed&&(r.push(G.recentsButton),t?(r.push(this._themeStyles.primaryViewColorStyle),n=this._themeColors.primaryBackgroundColor,l=n):n=k.Color.gray400)),i=o.createElement(v.default,{key:"recents",style:r,size:R.IconSize.size15,onPress:this._handleRecentsButtonPress,color:n,hoverColor:l,icon:R.SkypeIcon.Menu,title:a})}else i=o.createElement(v.default,{key:"back",style:r,size:R.IconSize.size15,onPress:this._handleBackButtonClick,color:e,hoverColor:s,icon:V.backIcon(),title:P.getString("Global.BackButtonTitle")});const l=[G.undraggableRegion];return o.createElement(o.View,{key:"leftControl",style:l},i)}_renderConversationIcon(){const e=this.state.isOneOnOneConversation?this.state.conversationName:P.getString("CallPanel.CallRosterHeaderEntryButtonAccessibilityLabel",{groupName:this.state.conversationName});return o.createElement(o.View,{style:G.conversationIcon},o.createElement(N.default,{conversationId:this.props.conversationId,size:U.ConversationIconSize.Size28,onPress:this._onOpenRosterFromConversationIcon,accessibilityLabel:e}))}_renderTitleView(){return o.createElement(h.default,{onLayout:this.props.onTitleLayout?this._onTitleLayout:void 0,callId:this.props.callId,conversationMri:this.props.conversationId,isCallActive:this.props.isCallActive,outgoingRingStatus:this.props.outgoingRingStatus,onTitlePress:this.props.onTitlePress?this._onTitlePress:void 0,onOpenRoster:this._onOpenRoster,isSeen:!this.props.minimized,showParticipantCount:this.props.showParticipantCount,maxTitleWidth:this.props.maxTitleWidth,containerStyle:G.titleContainerInner,v2:!0,useHighContrastTheme:this.props.useHighContrastTheme,useLightTheme:this.props.useLightTheme,renderGalleryIfAllowed:!1,showCompactManageGroup:!0})}_renderLayoutButton(){return o.createElement(F.default,{availableLayoutModes:C.default.getAvailableHeaderModes(this.props.useMobileControls,this.state.isOneOnOneConversation),callId:this.props.callId,conversationMri:this.props.conversationId,useHighContrastTheme:this.props.useHighContrastTheme,useLightTheme:this.props.useLightTheme,isIncomingOrOutGoingRing:this.props.incomingOrOutgoingRing,useMobileCallControls:this.props.useMobileControls,height:g.DesktopNewHeaderHeight})}_renderSpeakerButton(e,t){return null}_renderFlipCameraButton(e,t){if(!this.props.useMobileControls||!this.state.showCameraToggle)return null;let i=this.props.isNewCameraFlipEnabled?R.SkypeIcon.NewSwitchCamera:R.SkypeIcon.SwitchCamera,a=this.state.cameraPosition===s.CameraPosition.Front?P.getString("CallControls.CallButtonSwitchCameraBackwardLabel"):P.getString("CallControls.CallButtonSwitchCameraForwardLabel");return o.createElement(v.default,{key:"camera",style:G.rightControlsButton,size:R.IconSize.size24,onPress:this.props.onToggleCameraDirection,color:e,hoverColor:t,icon:i,title:P.getString("CapturePanel.SwitchCameraButtonTitle"),accessibilityLabel:a})}_renderGridFocusToggleButton(e,t){return this.state.changeCallLayoutEnabled?o.createElement(v.default,{ref:this._onLayoutButtonRef,key:"changeLayoutButton",icon:this._getIcon(),title:this._getTitle(),size:R.IconSize.size24,hoverColor:t,onPress:this.state.newLayoutPickerEnabled?this._onNewPickerPress:this._toggleGridFocusView,accessibilityLabel:this._getTitle(),color:e,style:G.rightControlsButton}):null}_getTitle(){if(this.state.newLayoutPickerEnabled)return C.default.getStageModeItemTitle(this.state.stageMode,!0);return C.default.isInGridStageMode(this.state.stageMode)?this.state.hasIncomingScreenshare?P.getString("CallControls.CallButtonSwitchToContentView"):P.getString("CallControls.CallButtonSwitchToSpeakerView"):P.getString("CallControls.CallButtonSwitchToGridView")}_getIcon(){if(this.state.newLayoutPickerEnabled)return C.default.getIconForStageMode(this.state.stageMode,!0);return C.default.isInGridStageMode(this.state.stageMode)?R.SkypeIcon.GridView:R.SkypeIcon.FocusedView3}_renderBingBackgroundsButton(){return this.state.shouldShowBingBackgrounds?o.createElement(u.default,{callId:this.props.callId,height:g.DesktopNewHeaderHeight,textStyleOverride:this.props.useLightTheme?G.bingBackgroundsFontLightTheme:void 0,onBingBackgroundsPressed:this.props.onBingBackgroundsPressed,useLightTheme:this.props.useLightTheme}):null}}t.default=W},3722:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(7),s=i(219),r=i(110),l=i(254),c=i(914),d=i(6),u=i(5),h=i(35),p=i(23),g=i(9),C=i(24),m=i(11),S=i(100),y=i(10),f=i(12),_=i(141),b=i(16),v=i(26),w=g.Color.gray400,T=d.lazyProperties({innerContainer:()=>n.Styles.createViewStyle({justifyContent:"flex-end",alignItems:"center",overflow:"visible",flexDirection:"row",width:void 0}),label:()=>n.Styles.createTextStyle({backgroundColor:g.Color.transparent,textAlign:"center",textAlignVertical:"center",marginHorizontal:5,paddingBottom:1,color:g.Color.white,fontSize:C.default.fontSize.size13Deprecated,font:C.default.font.uiDisplayRegular}),labelLightTheme:()=>n.Styles.createTextStyle({color:w}),iconStyle:()=>n.Styles.createViewStyle({overflow:"visible"}),chevronIcon:()=>n.Styles.createViewStyle({marginLeft:5}),redDot:()=>n.Styles.createViewStyle({width:8,height:8,borderRadius:4,backgroundColor:g.Color.red,position:"absolute",left:10,top:8})});class I extends f.default{constructor(){super(...arguments),this._handleOnPress=e=>{this.state.isMenuShown&&l.default.close(this._getRootViewId(),y.default.newCauseId()),this.state.menuContainsNewItem&&this.setState({menuContainsNewItem:!1}),this.state.showFullScreenOption?h.default.isFullScreenMode(this._getRootViewId()).then(e=>{this._showMenu(e)}):this._showMenu(!1)},this._onButtonRef=e=>{this._buttonRef=e||void 0},this._showMenu=e=>{const t=()=>this._buttonRef,i=this._getRootViewId();l.default.showWithContent({menuId:l.default.menuId(),anchor:t,rootViewId:i,menuHeight:c.default.getLayoutPickerHeight(this.state.availableMenuItems),content:n.createElement(c.default,{anchor:t,rootViewId:i,callId:this.props.callId,conversationMri:this.props.conversationMri,useMobileControls:this.props.useMobileCallControls,isIncomingOrOutGoingRing:this.props.isIncomingOrOutGoingRing,showFullScreenOption:this.state.showFullScreenOption,isInFullscreenMode:e,availableItems:this.state.availableMenuItems,itemColor:this.props.useLightTheme?w:void 0,dividerColor:this.props.useLightTheme?this._themeColors.dividerColor:void 0}),getTitle:()=>{},onCloseMenu:e=>l.default.close(i,e),onMenuClosed:this._onMenuClosed,colorThemeOverride:this.props.useLightTheme?S.Theme.Colorful:S.Theme.ColorfulDark,hidePopupArrow:!0,staticContent:!0,menuWidth:302,borderRadius:8,backgroundColor:this.props.useLightTheme?this._themeColors.primaryBackgroundColor:"#292828"},y.default.newCauseId()),this.setState({isMenuShown:!0})},this._onMenuClosed=e=>{this.state.availableMenuItems.forEach(e=>{e.markAsSeen&&e.markAsSeen()})}}_buildState(e,t){const i=o.default.getS4LCMCFeatures().enableFullScreenOnWeb&&!p.default.isUsingSplitViewNoSubscription(),n=r.default.getAvailableMenuItemsV2(e.callId,i,e.useMobileCallControls,e.conversationMri);return{isMenuShown:this.state&&this.state.isMenuShown,stageMode:s.default.getStageMode(e.callId),showFullScreenOption:i,menuContainsNewItem:a.some(n,e=>e.isNew),availableMenuItems:n}}render(){const e=[T.label,this.props.useLightTheme?T.labelLightTheme:void 0],t=n.createElement(b.BodyText,{style:e},u.getString("CallPanel.CallHeaderViewLabel"));let i=this.props.useLightTheme?w:g.Color.white;const a=n.createElement(v.default,{icon:m.SkypeIcon.GridView,size:m.IconSize.size16,color:i,style:T.iconStyle}),o=[T.innerContainer,n.Styles.createViewStyle({backgroundColor:this.props.useHighContrastTheme?this._themeColors.primaryBackgroundColor:g.Color.transparent,height:this.props.height},!1)],s=this._intLabel(),r={style:o,title:this._intLabel(),accessibilityLabel:s,onPress:this._handleOnPress};return n.createElement(_.HoverableButton,Object.assign({},r,{ref:this._onButtonRef}),a,t,this.state.menuContainsNewItem?n.createElement(n.View,{style:T.redDot}):void 0)}_intLabel(){return u.getString("CallPanel.RibbonLayoutAccessibilityLabel")}}t.default=I},3723:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallTrayView=void 0;const a=i(1),n=i(0),o=i(29),s=i(740),r=i(743),l=i(60),c=i(6),d=i(9),u=i(14),h=i(12),p=i(121),g=i(1776),C=i(3724),m=i(588),S=i(110),y=c.lazyProperties({reactionsView:()=>u.default.absoluteFill,participantVideoContainer:()=>n.Styles.createViewStyle({width:l.BigTrayCallParticipantWidth.video,flexGrow:0,flexShrink:0}),participantAudioContainer:()=>n.Styles.createViewStyle({width:l.BigTrayCallParticipantWidth.audio,flexGrow:0,flexShrink:0}),trayContainer:()=>n.Styles.createViewStyle({position:"absolute",top:l.DesktopNewHeaderHeight,left:0,right:0,backgroundColor:d.Color.transparent,flex:1,flexDirection:"row-reverse",alignSelf:"center",justifyContent:"space-between",borderBottomWidth:8,borderLeftWidth:8,borderRightWidth:8,borderColor:d.Color.transparent,height:l.DesktopTopTrayHeight,alignItems:"stretch"}),participantsContainer:()=>n.Styles.createViewStyle({flexDirection:"row-reverse",justifyContent:"flex-start",alignSelf:"stretch",flexBasis:0,flexGrow:1}),presenterContainer:()=>n.Styles.createViewStyle({flexGrow:0,flexShrink:0,alignSelf:"stretch",flexDirection:"row"}),participantBackgroundStyle:()=>n.Styles.createViewStyle({backgroundColor:d.Color.callStageLight}),participantBackgroundStyleLightTheme:()=>n.Styles.createViewStyle({backgroundColor:d.Color.gray100Overlay80})});class f extends h.default{constructor(){super(...arguments),this._callReactionsDisplayHelper=new r.default,this._mountedRefsMap=new p.default,this._videoParticipantLayoutController={getStyles:()=>[y.participantVideoContainer],getInnerStyles:()=>[u.default.flexOne],getBackgroundColorStyle:e=>e?y.participantBackgroundStyleLightTheme:y.participantBackgroundStyle,isHidden:()=>!1},this._audioParticipantLayoutController={getStyles:()=>[y.participantAudioContainer],getInnerStyles:()=>[u.default.flexOne],getBackgroundColorStyle:e=>e?y.participantBackgroundStyleLightTheme:y.participantBackgroundStyle,isHidden:()=>!1},this._updateElementLink=(e,t,i,a,n,s,r)=>{o.default.VideoLinksManager.updateElementLink(this.props.callId,e,t,i,a,n,s,r)},this._layoutController=(e,t,i)=>i!==l.VideoStatus.None?this._videoParticipantLayoutController:this._audioParticipantLayoutController,this._onElementScalingModeChanged=(e,t,i,a)=>{o.default.VideoLinksManager.onElementScalingModeChanged(this.props.callId,e,t,i,a)},this._getCallReactionsDisplayHelper=()=>this._callReactionsDisplayHelper,this._onViewRef=e=>{this._parentViewRef=e||void 0},this._getParentRefForReactions=()=>this._parentViewRef,this._getChildRefForReactions=e=>this._mountedRefsMap.ref(e),this._onTrayLayout=e=>{this.isComponentMounted()&&m.default.setTrayWidth(e.width)},this._onTrayLayoutDebounced=a.debounce(this._onTrayLayout,150)}_buildState(e,t){const i=m.default.getTrayElements(e.callId),n=S.default.isInIncomingScreenshareMode(e.stageMode)?o.default.CallScreenShareStore.getPresenter(e.callId):void 0;return{presenter:n,nonPresentingParticipants:a.compact(a.without(i,n)),hiddenParticipantsNumber:m.default.getTrayRemainder(e.callId)}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i)}_renderTrayParticipant(e){return n.createElement(s.CallParticipantView,{key:e,ref:t=>this._onParticipantViewRef(t,e),callId:this.props.callId,conversationMri:this.props.conversationMri,nametagPosition:{offset:0},renderKey:e,onUpdateElementLink:this._updateElementLink,isGroupCall:!this.props.isOneOnOneConversation,iconOpacity:1,nametagOpacityStyle:this.props.callParticipantTooltipStyle,parentViewId:"CallTrayView#TrayView",onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,hideNameTag:this.props.hideNameTag,useDarkBackground:!0,desktopNameTag:!0,isCallStageV2:!0,useLightTheme:this.props.useLightTheme,getCallReactionsDisplayHelper:this._getCallReactionsDisplayHelper,layoutController:this._layoutController,iconSize:l.BigTrayCallParticipantAvatarSize,onScalingModeChanged:this._onElementScalingModeChanged,isInTray:!0})}_onParticipantViewRef(e,t){o.default.VideoLinksManager.getMountedRefsMapTray().onComponentRef(t).call(this,e),this._mountedRefsMap.onComponentRef(t).call(this,e)}_renderPresenterPart(){return this.state.presenter?n.createElement(n.View,{key:"presenter",style:y.presenterContainer},this._renderTrayParticipant(this.state.presenter)):void 0}_renderNonPresentingParticipants(){const e=a.map(this.state.nonPresentingParticipants,e=>this._renderTrayParticipant(e));return n.createElement(n.View,{key:"nonPresenters",style:y.participantsContainer},e,n.createElement(C.TrayOverflowButton,{hiddenParticipantsNumber:this.state.hiddenParticipantsNumber,onOverflowButtonPress:this.props.onOverflowButtonPress,useLightTheme:this.props.useLightTheme}))}_renderTray(){return n.createElement(n.View,{key:"callTray",ref:this._onViewRef,style:y.trayContainer,onLayout:this._onTrayLayoutDebounced},this._renderNonPresentingParticipants(),this._renderPresenterPart())}_renderReactionView(){return n.createElement(g.NewCallReactionsView,{key:"reactionView",reactionsConversationId:this.props.reactionsConversationId,parentDimensions:this.props.viewRect,getChildRef:this._getChildRefForReactions,getParentRef:this._getParentRefForReactions,onTextReactionPressed:this.props.onTextReactionPressed,disableReactions:this.props.disableReactions,getCallReactionsDisplayHelper:this._getCallReactionsDisplayHelper})}render(){return[this._renderTray(),this._renderReactionView()]}}t.CallTrayView=f},3724:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TrayOverflowButton=void 0;const a=i(0),n=i(12),o=i(9),s=i(6),r=i(24),l=i(141),c=i(16),d=i(60),u=i(10),h=i(4),p=i(185),g=d.BigTrayCallParticipantAvatarSize,C=s.lazyProperties({overflowButtonContainer:()=>a.Styles.createViewStyle({backgroundColor:o.Color.transparent,width:d.BigTrayOverflowButtonWidth,flexShrink:0,flexGrow:0,alignContent:"center",justifyContent:"center",alignItems:"center",alignSelf:"stretch"}),overflowButton:()=>a.Styles.createButtonStyle({width:g,height:g,borderRadius:g/2,backgroundColor:o.Color.gray200Overlay60,alignContent:"center",justifyContent:"center"}),overflowButtonLightTheme:()=>a.Styles.createButtonStyle({backgroundColor:o.Color.gray100}),overflowButtonLabel:()=>a.Styles.createTextStyle({color:o.Color.whiteOverlay80,backgroundColor:o.Color.transparent,textAlign:"center",textAlignVertical:"center",paddingBottom:1,fontSize:r.default.fontSize.size18}),overflowButtonLabelLightTheme:()=>a.Styles.createTextStyle({color:o.Color.gray400})});class m extends n.default{constructor(){super(...arguments),this._onPress=()=>{const e=u.default.newCauseId();h.log(p.LogTraceArea.CallingUI,"OverflowButton._onPress "+e),this.props.onOverflowButtonPress(e,d.CallRosterOrigin.TrayOverflowButton,!1)}}render(){return this.props.hiddenParticipantsNumber?a.createElement(a.View,{style:C.overflowButtonContainer},a.createElement(l.HoverableButton,{style:[C.overflowButton,this.props.useLightTheme?C.overflowButtonLightTheme:void 0],onPress:this._onPress},a.createElement(c.BodyText,{style:[C.overflowButtonLabel,this.props.useLightTheme?C.overflowButtonLabelLightTheme:void 0]},"+"+this.props.hiddenParticipantsNumber))):null}}t.TrayOverflowButton=m},3725:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(168),o=i(0),s=i(7),r=i(29),l=i(3726),c=i(328),d=i(13),u=i(67),h=i(3),p=i(544),g=i(744),C=i(4),m=i(6),S=i(5),y=i(878),f=i(36),_=i(83),b=i(9),v=i(14),w=i(369),T=i(16),I=i(12),P=i(10),M="groupShareButton",k="activeParticipantHeader",A="inactiveParticipantHeader",R=m.lazyProperties({itemDivider:()=>o.Styles.createViewStyle({height:1}),itemContainer:()=>o.Styles.createViewStyle({paddingHorizontal:20}),participantDividerPadding:()=>o.Styles.createViewStyle({marginLeft:50}),sectionTitle:()=>o.Styles.createViewStyle({height:48,flexDirection:"row",alignItems:"center",justifyContent:"flex-start"}),sectionTitleWithButton:()=>o.Styles.createViewStyle({height:48,flexDirection:"row",alignItems:"center",justifyContent:"space-between"}),ringAllButton:()=>o.Styles.createTextStyle({color:b.Color.blue})});class V extends I.default{constructor(){super(...arguments),this._handleRingAgain=e=>{r.default.CallParticipantUtils.addUsersToCallOrRing([e],this.props.callId,this.props.conversationMri,[e],h.NavigationAddToCallOrigin.RosterView);const t=P.default.newCauseId();C.log(h.LogTraceArea.CallingUI,"[CallRosterContent] _addParticipantsToCall, causeId: "+t),w.default.updateCallRosterTelemetry(this.props.callId,t,e=>e.callRosterRangUser()),a.every(this.state.inactiveParticipants,t=>!0===t.isRinging||t.key===e)&&this.props.onCloseRoster&&this.props.onCloseRoster()},this._onRingTheGroupButtonPress=()=>{y.default.handleRingTheGroup(this.props.conversationMri,this.props.callId);const e=S.getString("CallPanel.GroupCallRingingStatusMessage");o.Accessibility.announceForAccessibility(e);const t=P.default.newCauseId();C.log(h.LogTraceArea.CallingUI,"[CallRosterContent] _onRingTheGroupButtonPress, causeId: "+t),w.default.updateCallRosterTelemetry(this.props.callId,t,e=>e.callRosterRingTheGroup()),this.props.onCloseRoster&&this.props.onCloseRoster()},this._renderItem=e=>{if(e.key===k){const t=S.getString("CallPanel.CallRosterPresentTitle");return o.createElement(o.View,{key:e.key,style:[R.sectionTitle,R.itemContainer]},o.createElement(_.SectionTitle,{key:e.key,title:t,titleStyles:v.default.flexOne}))}const t=this._renderRingTheGroupButton();if(e.key===A){const i=S.getString("CallPanel.CallRosterAbsentTitle"),a=t?R.sectionTitleWithButton:R.sectionTitle;return o.createElement(o.View,{key:e.key,style:[a,R.itemContainer]},o.createElement(_.SectionTitle,{key:e.key,title:i,titleStyles:v.default.flexOne}),t)}let i,a=[R.itemDivider,this._themeStyles.dividerColorStyle];if(e.key===M)i=o.createElement(g.default,{key:e.key,conversationId:this.props.conversationMri,callId:this.props.callId,origin:p.ShareGroupButtonOrigin.CallRosterPanel,hideDivider:!0,renderAsListItem:!0});else{const t=this.state.allParticipants[e.key];i=o.createElement(l.default,{key:e.key,userMri:e.key,callId:this.props.callId,isPresent:t.isActive,isTalking:t.isTalking,isLocal:t.isLocal,isLocalMuteSupported:t.isLocalMuteSupported,isRinging:t.isRinging,isServerMuted:t.isServerMuted,isServerMutedSupported:t.isServerMutedSupported,isLocalMuted:t.isLocalMuted,onRingAgainClicked:this._handleRingAgain}),a.push(R.participantDividerPadding)}return o.createElement(o.View,{style:R.itemContainer},i,o.createElement(u.default,{key:"itemDivider",style:a}))}}_buildState(e,t){let i=c.default.getAllMembersWithActiveAndInactiveParticipants(e.conversationMri,e.callId,t?{}:this.state.allParticipants),a=i.activeParticipants,n=i.inactiveParticipants;return{allParticipants:i.allParticipants,activeParticipants:a,inactiveParticipants:n,safeAreaHorizontalInsets:f.default.horizontalInsets(d.HorizontalInsetDefault),isGroupJoinLinkEnabled:s.default.getS4LCMCFeatures().enableCallRosterGroupJoinLink,ringlessCallType:y.default.getRinglessCallType(e.conversationMri,e.callId)}}render(){let e=[];this.state.isGroupJoinLinkEnabled&&e.push({key:M,height:70,template:"dcrp_action",accessibilityTrait:o.Types.AccessibilityTrait.Button});let t=[];this.state.activeParticipants.length&&(t.push({key:k,height:48,template:"crv_header"}),a.each(this.state.activeParticipants,e=>{t.push({key:e.key,height:55,template:"crv_participant"})}));let i=[];return this.state.inactiveParticipants.length&&(i.push({key:A,height:48,template:"crv_header"}),a.each(this.state.inactiveParticipants,e=>{i.push({key:e.key,height:55,template:"crv_participant"})})),o.createElement(o.View,{style:v.default.flexOne},o.createElement(n.VirtualListView,{itemList:a.union(e,t,i),renderItem:this._renderItem,animateChanges:!0,keyboardShouldPersistTaps:!0,horizontalPadding:this.state.safeAreaHorizontalInsets}))}_renderRingTheGroupButton(){if(!y.default.isLocallyStartedRinglessCall(this.props.conversationMri,this.props.callId)||r.default.CallingStore.hasRingingParticipants(this.props.callId,!0)||this.state.ringlessCallType!==y.LocallyStartedRinglessCallType.SmallGroup)return;const e=S.getString("CallPanel.GroupCallRingAllButtonTitle");return o.createElement(o.Button,{accessibilityLabel:e,onPress:this._onRingTheGroupButtonPress},o.createElement(T.Caption,{style:R.ringAllButton,selected:!0},e))}}t.default=V},3726:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(7),o=i(29),s=i(328),r=i(110),l=i(17),c=i(33),d=i(3),u=i(86),h=i(41),p=i(26),g=i(4),C=i(6),m=i(5),S=i(135),y=i(178),f=i(698),_=i(742),b=i(587),v=i(9),w=i(11),T=i(14),I=i(369),P=i(16),M=i(12),k=i(101),A=i(65),R=i(46),V=i(212),E=i(10),L=A.UserIconSize.Size40,B=C.lazyProperties({listItem:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),userIconContainer:()=>a.Styles.createViewStyle({width:50,height:50,alignItems:"flex-start",justifyContent:"center",overflow:"visible"}),ringingView:()=>a.Styles.createViewStyle({position:"absolute",width:L,height:L,borderRadius:L/2,alignItems:"center",justifyContent:"center",backgroundColor:v.Color.blackOverlay50}),optionalMuteButton:()=>a.Styles.createViewStyle({alignItems:"center",backgroundColor:v.Color.transparent,paddingLeft:25,paddingRight:10}),optionalButton:()=>a.Styles.createViewStyle({alignItems:"center",backgroundColor:v.Color.transparent,paddingLeft:25}),raiseHandBorderStyle:()=>a.Styles.createViewStyle({borderColor:v.Color.raiseHandOrange,borderWidth:2})});class O extends M.default{constructor(){super(...arguments),this._handleLocalHangup=e=>{const t=E.default.newCauseId();g.log(d.LogTraceArea.CallingUI,"[CallRosterListItem] _handleLocalHangup, causeId: "+t),o.default.CallingStore.endCall(this.props.callId,t),I.default.updateCallRosterTelemetry(this.props.callId,t,e=>e.callRosterRemovedUser())},this._handleRemoteHangup=e=>{const t=E.default.newCauseId();g.log(d.LogTraceArea.CallingUI,"[CallRosterListItem] _handleRemoteHangup, causeId: "+t),s.default.handleRemoteHangup(e,this.props.callId,t),I.default.updateCallRosterTelemetry(this.props.callId,t,e=>e.callRosterRemovedUser())},this._onMuteOrUnMuteButtonPress=e=>{e.stopPropagation();const t=E.default.newCauseId();this.props.isLocal?(g.log(d.LogTraceArea.CallingUI,"[CallRosterListItem:_onMuteOrUnMuteButtonPress] handleLocalMuteOrUnmute, causeId: "+t),r.default.announceMicrophoneState(s.default.handleLocalMuteOrUnmute(this.props.callId,t))):(g.log(d.LogTraceArea.CallingUI,"[CallRosterListItem:_onMuteOrUnMuteButtonPress] _handleRemoteMute, causeId: "+t),s.default.handleRemoteMute(this.props.userMri,this.props.callId,t))},this._onRingAgainOrHangUpButtonPress=e=>{e.stopPropagation(),this.props.isPresent?this.props.isLocal?this._handleLocalHangup(this.props.userMri):this._handleRemoteHangup(this.props.userMri):this.props.onRingAgainClicked(this.props.userMri)},this._onLowerHandPressed=()=>{this._lowerHandParticipantCommand.execute(),r.default.announceLoweredHandState(!!this.props.isLocal,this.state.displayName)}}_buildState(e,t){const i=R.default.getDisplayableUserByMri(e.userMri),a=o.default.CallingStore.getCallConversationMri(e.callId),s=a&&c.default().getConversation(a),r=i?i.getDisplayName():m.getString("DisplayInfoStore.ListMyName");return this._lowerHandParticipantCommand=new f.LowerHandParticipantCommand(e.callId,e.userMri,b.LowerHandOrigin.ParticipantsPanel,!!e.isLocal,r),{userProfile:l.isAgent(e.userMri)?void 0:i,displayName:r,isEnabledRemoteMute:n.default.getS4LCMCFeatures().enableRemoteMute,hideMuteIcon:y.isRegularMemberInModeratedGroup(s)&&!e.isLocal,hideCallIcon:y.isRegularMemberInModeratedGroup(s),canHandBeLowered:this._lowerHandParticipantCommand.canExecute(),isHandRaised:this._lowerHandParticipantCommand.isHandRaised()}}_renderRingAgainOrHangUpIcon(){let e;if(!this.props.isRinging&&!this.state.hideCallIcon){let t,i;this.props.isPresent?(t=w.SkypeIcon.CallEnd,i=m.getString("CallControls.CallButtonEndCall")):(t=w.SkypeIcon.CallStart,i=m.getString("SkypeUserListItem.RingButtonLabel")),e=a.createElement(h.default,{size:w.IconSize.size24,onPress:this._onRingAgainOrHangUpButtonPress,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,icon:t,style:B.optionalButton,title:i,accessibilityLabel:this.state.displayName+","+i})}return e}_renderRemoteMuteOrUnMuteIcon(){let e;if(!this.state.isEnabledRemoteMute||this.state.hideMuteIcon)return e;if(!this.props.isRinging&&this.props.isPresent){let t=s.default.getIconTitleForMuteOrUnMute(this.props.isLocalMuteSupported,this.props.isLocal,this.props.isLocalMuted,this.props.isServerMutedSupported,this.props.isServerMuted);e=a.createElement(h.default,{size:w.IconSize.size24,onPress:this._onMuteOrUnMuteButtonPress,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,icon:t.icon,style:B.optionalMuteButton,title:t.title,disabled:t.disableIcon,accessibilityLabel:this.state.displayName+","+t.title})}return e}_renderOptionalLowerHandIcon(){if(!this.state.canHandBeLowered)return;const e=m.getString("CallControls.LowerHand");return a.createElement(h.default,{size:w.IconSize.size24,onPress:this._onLowerHandPressed,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,icon:w.SkypeIcon.RaiseHandCrossed,style:B.optionalMuteButton,title:e,accessibilityLabel:this.state.displayName+","+e})}render(){const e=this.props.isRinging?a.createElement(a.View,{style:B.ringingView},a.createElement(p.default,{icon:w.SkypeIcon.CallAnimSmall4,color:v.Color.white,size:w.IconSize.size20})):void 0,t=this.state.isHandRaised?a.createElement(_.default,{type:_.RaiseHandImageType.SmallSizeTopLeftAligned}):void 0;return a.createElement(S.default.View,{style:[B.listItem,T.default.defaultCursor],importantForAccessibility:a.Types.ImportantForAccessibility.Yes,accessibilityLabel:this.state.displayName},a.createElement(u.default,{style:B.userIconContainer},a.createElement(k.UserIcon,{key:"userIcon",userMri:this.props.userMri,size:L,useCircleForAgentMask:!0,statusBorderColor:this._themeColors.primaryBackgroundColor,statusTypes:V.getAllowedStatuses(this.props.userMri),imageBorderStyleOverride:this.state.isHandRaised?B.raiseHandBorderStyle:void 0}),e,t),a.createElement(a.View,{key:"text",style:T.default.flexOne,importantForAccessibility:a.Types.ImportantForAccessibility.NoHideDescendants},a.createElement(P.RowTitle,{numberOfLines:1,textThemeColor:P.TextThemeColor.Primary},this.state.displayName)),this._renderOptionalLowerHandIcon(),this._renderRemoteMuteOrUnMuteIcon(),this._renderRingAgainOrHangUpIcon())}}t.default=O},3727:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(69),o=i(1257),s=i(413),r=i(3),l=i(4),c=i(36),d=i(10);class u extends n.default{_buildState(e,t){return{topPadding:c.default.statusBarPadding()}}componentDidMount(){super.componentDidMount();const e=d.default.newCauseId();l.log(r.LogTraceArea.CallingUI,"CallTranscriptionStackPanel.componentDidMount causeId: "+e),s.default.setCallViewVisible(this.props.callId,!1,e)}componentWillUnmount(){super.componentWillUnmount();const e=d.default.newCauseId();l.log(r.LogTraceArea.CallingUI,"CallTranscriptionStackPanel.componentWillUnmount causeId: "+e),s.default.setCallViewVisible(this.props.callId,!0,e)}render(){return a.createElement(o.default,{key:"callTranscriptionPanelView",callId:this.props.callId,reactionsMri:this.props.conversationMri,onPressClose:this.props.onClose,topPadding:this.state.topPadding})}_componentId(){return"CallTranscriptionStackPanel"}}t.default=u},375:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(34),n=i(1),o=i(7),s=i(17),r=i(3),l=i(4),c=i(30),d=i(64),u=i(239),h=i(275),p=i(19),g=i(20),C={a:2,b:2,c:2,d:3,e:3,f:3,g:4,h:4,i:4,j:5,k:5,l:5,m:6,n:6,o:6,p:7,q:7,r:7,s:7,t:8,u:8,v:8,w:9,x:9,y:9,z:9,"":2,"":2,"":2,"":2,"":2,"":3,"":3,"":4,"":4,"":4,"":5,"":5,"":6,"":6,"":6,"":6,"":6,"":7,"":8,"":8,"":8,"":9,"":2,"":2,"":2,"":2,"":3,"":3,"":3,"":3,"":4,"":4,"":4,"":4,"":5,"":5,"":5,"":5,"":6,"":6,"":6,"":6,"":7,"":7,"":7,"":7,"":8,"":8,"":8,"":8,"":9,"":9,"":9,"":9};t.default=class{static isEmergencyNumber(e){return!!e.suffix&&g.default.isValidEmergencyNumber(e.suffix)}static getEmergencyCallingCountrySubstitute(e){const t=this.getDefaultEmergencyCallingCountry();if(t&&e!==t&&this.allowedEmergencyCallingDestinationCountry(t))return u.default.getCountryByCode(t)}static isCallableNumber(e){return e.emergency?this.allowedEmergencyCallingDestinationCountry(n.toLower(e.countryCode)):!!e.prefix&&!!e.suffix&&e.suffix.length>1}static isValidPhoneNumberInput(e){return!!e&&/^\+?[\d\s]*(,[\d\s\*\#,]*$|$)/.test(e)}static getDefaultEmergencyCallingCountry(){return d.default.getEmergencyCallDefaultCountry()}static allowedEmergencyCallingDestinationCountry(e){return n.includes(o.default.getS4LEntitlementFeatures().SCE.Dialpad.EmergencyCall.allowedCountries,e)}static normalizePhoneNumber(e){if(!e)return"";let t,i=0;const n=o.default.getS4LEntitlementFeatures().SCE.Dialpad.NumberInput.decodeHtmlMaxIterations;try{do{t=e,e=decodeURIComponent(e),i++}while(t!==e&&i<n)}catch(t){l.error(r.LogTraceArea.DialerPanel,"[DialerPhoneNumberUtils] Failed to decode input number: "+a.pii.Omit(e))}let s=e.replace(/[^\d\+\*\#,]/g,"");return s.lastIndexOf("+")===s.length-1?"+":(s=s.replace(/(?!^)\+/g,""),s=s.replace(/^00/,"+"),"00"===s?"+":s)}static filterPhoneNumberChar(e,t){return t&&/[\d\+\*\#,]/.test(t)&&this.isValidPhoneNumberInput(e+t)?t:""}static getCountryDestinationPrefixIndex(e){let t={},i=-1,a=0;return n.each(e,(e,n)=>{t[e.countryCode]||(t[e.countryCode]=[],++a),t[e.countryCode].push(n),i<e.countryCode&&(i=e.countryCode)}),{index:t,indexSize:a,maxLength:i>=0?i.toString().length:0}}static getFormattedPhoneNumber(e,t){if(!t)return e;const i=t.length+1;return e.length===i?e:e.substr(0,i)+" "+e.substr(i)}static isE164Format(e){return 0===e.indexOf("+")}static getE164FormattedPhoneNumber(e,t){return e?"+"+e+(t||""):""}static getPhoneNumberSuffix(e,t){return t?this.isE164Format(e)?e.slice(t.length+1):e:n.trimStart(e,"+")}static getPhoneNumberPrefixCountry(e,t){if(!e)return;const i=t.index[n.parseInt(e)];if(!i||0===i.length)return;if(1===i.length)return u.default.getCountryByCode(i[0]);const a=o.default.getS4LEntitlementFeatures().SCE.Dialpad.CountryCodeToCountryDefault[e];return a?u.default.getCountryByCode(a.toLowerCase()):u.default.getCountryByCode(i[0])}static getPhoneNumberPrefix(e,t){if(e.length<2||0!==e.indexOf("+"))return;if(!t)return;const i=t.maxLength+1;for(let a=2;a<=i;++a){const i=n.toInteger(e.substring(1,a));if(t.index[i])return i.toString();if(n.includes(o.default.getS4LEntitlementFeatures().SCE.Dialpad.Calling.TestPrefixes,i))return i.toString();if(n.includes(o.default.getS4LEntitlementFeatures().SCE.Dialpad.Calling.NonGeographicPrefixes,i))return i.toString()}}static getDefaultPstnDestinationCountry(){const e=this._getStoredDefaultPstnDestinationCountryCode()||this._getGeoIpCountryCode();if(e)return u.default.getCountryByCode(e)}static setDefaultPstnDestinationCountryCode(e){const t=this._getStoredDefaultPstnDestinationCountryCode();if(t!==e){const i=this._getGeoIpCountryCode();void 0===t&&e!==i&&l.track(new h.DefaultCountryStored(i,e)),c.default.setUserPreferencesLocal({defaultPstnDestinationCountryCode:e})}}static _getStoredDefaultPstnDestinationCountryCode(){return c.default.getUserPreferencesLocal().defaultPstnDestinationCountryCode}static _getGeoIpCountryCode(){return o.default.getHeaders().CountryCode.toLowerCase()}static getPhoneNumberMri(e){return s.sanitizeMri(e.E164,s.Namespaces.PSTN)}static phoneNumberToString(e){return"PhoneNumber(input: "+this.maskPhoneNumber(e.inputValue)+", E164: "+this.maskPhoneNumber(e.E164)+", prefix: "+e.prefix+", suffix: "+this.maskPhoneNumber(e.suffix)+", country: "+e.countryCode+", callable: "+e.callable+", emergency: "+e.emergency+", searchable: "+e.searchable+", fcp: "+e.forceChangedPrefix+")"}static maskPhoneNumber(e){return e?a.pii.Omit(e):""}static containsNonGeographicOrTestPrefixes(e){const t=o.default.getS4LEntitlementFeatures().SCE.Dialpad.Calling;if(t){const i=t.NonGeographicPrefixes?t.NonGeographicPrefixes:[],a=t.TestPrefixes?t.TestPrefixes:[],o=i.concat(a);return n.some(o,t=>0===e.indexOf("+"+t))}return!1}static isCursorPlacedInPrefixArea(e,t){if(!this._isSingleCursorPlaced(t))return!1;const i=e.inputValue.length-(e.suffix?e.suffix.length:0);return t.start<i}static mapKeypadLettersToNumbers(e){const t=[];let i;e=p.default.deburrLowerCase(e);for(const a of e)i=C[a],i||0===i?t.push(i):t.push(a);return t.join("")}static _isSingleCursorPlaced(e){return e.start===e.end}}},3751:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(14),o=i(12);class s extends o.default{constructor(){super(...arguments),this._isBalancePanelCollapsed=!1,this._balancePanelExpandedAnimatedHeight=new a.Animated.Value(0),this._balancePanelExpandedAnimatedStyles=a.Styles.createAnimatedViewStyle({height:this._balancePanelExpandedAnimatedHeight}),this._isBalancePanelCollapsedOnCompletion=!1,this._isCollapsed=()=>this._isBalancePanelCollapsed||this._isBalancePanelCollapsedOnCompletion,this.toggleBalancePanelVisibility=e=>{if(!this.state.balancePanelExpandedHeight||!this._balancePanelExpandedAnimatedHeight)return;if(this._isBalancePanelCollapsed===e)return;if(this.props.onCannotToggle&&this.props.onCannotToggle(e))return;if(this._balancePanelInProgressAnimation){if(this._isBalancePanelCollapsedOnCompletion===e)return;this._balancePanelInProgressAnimation.stop(),this._balancePanelInProgressAnimation=void 0}this._isBalancePanelCollapsedOnCompletion=e;const t=[];e?t.push(a.Animated.timing(this._balancePanelExpandedAnimatedHeight,{toValue:0,duration:10,easing:a.Animated.Easing.Out(),isInteraction:!1})):t.push(a.Animated.timing(this._balancePanelExpandedAnimatedHeight,{toValue:this.state.balancePanelExpandedHeight,duration:10,easing:a.Animated.Easing.In()}));const i=e=>{this._balancePanelInProgressAnimation=void 0,this._isBalancePanelCollapsed=e,this.forceUpdate()};this._balancePanelInProgressAnimation=a.Animated.parallel(t),this._balancePanelInProgressAnimation.start(()=>{i(e)})},this._onLayout=e=>{this.state.balancePanelExpandedHeight||!this.isComponentMounted()||this.props.isInLandscape||this._isCollapsed()||(this._balancePanelExpandedAnimatedHeight.setValue(e.height),this.setState({balancePanelExpandedHeight:e.height,useAnimatedLayout:!0}))}}_buildState(e,t){return{balancePanelExpandedHeight:t?void 0:this.state.balancePanelExpandedHeight,useAnimatedLayout:!t&&this.state.useAnimatedLayout}}render(){let e;return a.UserInterface.isNavigatingWithKeyboard()&&this._isBalancePanelCollapsed&&(e=n.default.displayNone),!this.props.isInLandscape&&this.state.useAnimatedLayout?a.createElement(a.View,{style:e,onLayout:this._onLayout},a.createElement(a.Animated.View,{style:this._balancePanelExpandedAnimatedStyles},this.props.children)):a.createElement(a.View,{style:e,onLayout:this._onLayout},this.props.children)}}t.default=s},3753:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(57),o=i(534),s=i(4),r=i(37),l=i(6),c=i(275),d=i(48),u=i(9),h=i(14),p=i(16),g=i(12),C=l.lazyProperties({callRateStyle:()=>a.Styles.createTextStyle({paddingHorizontal:20,color:u.Color.white,backgroundColor:u.Color.transparent,marginBottom:10}),image:()=>a.Styles.createViewStyle({height:110,width:158})});class m extends g.default{_buildState(e,t){const i=o.default.getCallRate(),a=o.default.tasterImageEnabled();return{callRateMessage:i.message,isTasterEligible:i.isTasterEligible,tasterImageEnabled:a}}componentDidMount(){super.componentDidMount(),this.state.isTasterEligible&&this.state.tasterImageEnabled&&s.track(new c.TasterImageShown)}shouldComponentUpdate(e,t){return!r.default(this.state,t)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),t.isTasterEligible&&t.tasterImageEnabled||!this.state.isTasterEligible||!this.state.tasterImageEnabled||s.track(new c.TasterImageShown),t.callRateMessage!==this.state.callRateMessage&&this.state.callRateMessage&&d.default.shouldAnnounceForAccessibility()&&a.Accessibility.announceForAccessibility(this.state.callRateMessage)}render(){if(void 0===this.state.callRateMessage)return null;const e=[C.callRateStyle];!this._useDarkTheme()&&this._useAccessibleTheme()&&e.push(this._themeStyles.primaryTextColorStyle);const t=a.createElement(p.Subtitle,{style:e},this.state.callRateMessage);return this.state.isTasterEligible&&this.state.tasterImageEnabled?a.createElement(a.View,{style:h.default.alignItemsCenter},a.createElement(a.Image,{source:n.Collection.TASTER_POST_CALL_ILLUSTRATION,style:C.image,resizeMode:"contain"}),t):t}}t.default=m},3754:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(41),o=i(6),s=i(5),r=i(27),l=i(9),c=i(11),d=i(14),u=i(12),h=o.lazyProperties({dialerWrapper:()=>a.Styles.createViewStyle({backgroundColor:l.Color.darkThemeSecondaryBackground,flexDirection:"column",flexGrow:1,flexShrink:0,overflow:"visible"}),collapsedDialpadButtonContainer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"center"}),dialpadIcon:()=>a.Styles.createButtonStyle({borderRadius:20,flexGrow:1,paddingVertical:15})});class p extends u.default{constructor(){super(...arguments),this._isDialpadCollapsed=!1,this._useAnimatedLayout=!1,this._dialpadExpandedAnimatedHeight=new a.Animated.Value(0),this._dialpadExpandedAnimatedStyles=a.Styles.createAnimatedViewStyle({height:this._dialpadExpandedAnimatedHeight}),this._dialpadCollapsedAnimatedHeight=new a.Animated.Value(0),this._dialpadCollapsedAnimatedStyles=a.Styles.createAnimatedViewStyle({height:this._dialpadCollapsedAnimatedHeight}),this._isDialpadCollapsedOnCompletion=!1,this.toggleDialpadToCollapsedState=e=>{this._isDialpadCollapsed!==e&&this._dialpadAnimation(e)},this.isCollapsed=()=>this._isDialpadCollapsed||this._isDialpadCollapsedOnCompletion,this._dialpadAnimation=e=>{if(!this.state.dialpadExpandedHeight||!this._useAnimatedLayout)return;if(this._dialpadInProgressAnimation){if(this._isDialpadCollapsedOnCompletion===e)return;this._dialpadInProgressAnimation.stop(),this._dialpadInProgressAnimation=void 0}this._isDialpadCollapsedOnCompletion=e,this.props.onToggleStart&&this.props.onToggleStart(e);const t=[];e?(t.push(a.Animated.timing(this._dialpadExpandedAnimatedHeight,{toValue:0,duration:210,easing:a.Animated.Easing.Out()})),t.push(a.Animated.timing(this._dialpadCollapsedAnimatedHeight,{toValue:54,duration:30,easing:a.Animated.Easing.In()}))):(t.push(a.Animated.timing(this._dialpadCollapsedAnimatedHeight,{toValue:0,duration:30,easing:a.Animated.Easing.Out()})),t.push(a.Animated.timing(this._dialpadExpandedAnimatedHeight,{toValue:this.state.dialpadExpandedHeight,duration:210,easing:a.Animated.Easing.In()})));const i=e=>{this._dialpadInProgressAnimation=void 0,this.isComponentMounted()&&(this._isDialpadCollapsed=e,this.props.onToggleCompletion&&this.props.onToggleCompletion(e),this.forceUpdate())};this._dialpadInProgressAnimation=a.Animated.sequence(t),this._dialpadInProgressAnimation.start(()=>{i(e)})},this._onPanVertical=e=>{this.props.isInLandscape||e.isComplete&&Math.abs(e.velocityY)>.2&&(e.velocityY<0?this.toggleDialpadToCollapsedState(!1):this.toggleDialpadToCollapsedState(!0))},this._onPressDialpadViewCollapsed=e=>{e&&(e.stopPropagation(),e.preventDefault()),this.toggleDialpadToCollapsedState(!1)},this._onLayout=e=>{!this.isComponentMounted()||this.props.isInLandscape||this.isCollapsed()||this._useAnimatedLayout||(this._useAnimatedLayout=!0,this.setState({dialpadExpandedHeight:e.height}),this.props.onHeightsChanged&&this.props.onHeightsChanged(e.height,54))},this._renderDialpadViewCollapsed=()=>{const e=[h.dialerWrapper];this._useDarkTheme()||e.push(this._themeStyles.searchBoxColorStyle);const t=this._isDialpadCollapsed||!1,i=s.getString("PeopleList.PstnDialpadLabel");return a.createElement(a.Animated.View,{style:[this._dialpadCollapsedAnimatedStyles,e]},a.createElement(a.View,{style:h.collapsedDialpadButtonContainer,importantForAccessibility:t?a.Types.ImportantForAccessibility.No:a.Types.ImportantForAccessibility.NoHideDescendants},a.createElement(n.default,{icon:c.SkypeIcon.Dialpad,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.primaryIconColor,size:c.IconSize.size24,style:h.dialpadIcon,onPress:this._onPressDialpadViewCollapsed,tabIndex:t?void 0:-1,title:i,accessibilityLabel:i})))}}_buildState(e,t){const i=this._getRootViewId();return{dialpadExpandedHeight:t?void 0:this.state.dialpadExpandedHeight,viewWidth:r.default.getWidth(i),viewHeight:r.default.getHeight(i)}}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),t.dialpadExpandedHeight&&this.state.dialpadExpandedHeight!==t.dialpadExpandedHeight?this._dialpadExpandedAnimatedHeight.setValue(t.dialpadExpandedHeight):this.props.isInLandscape||e.isInLandscape||this.state.viewWidth===t.viewWidth&&this.state.viewHeight===t.viewHeight||(this._useAnimatedLayout=!1,this.isCollapsed()&&(this._dialpadInProgressAnimation&&(this._dialpadInProgressAnimation.stop(),this._dialpadInProgressAnimation=void 0),this._dialpadCollapsedAnimatedHeight.setValue(0),this._isDialpadCollapsed=!1,this._isDialpadCollapsedOnCompletion=!1))}render(){if(this.props.isInLandscape)return a.createElement(a.View,{style:d.default.flexOne},this.props.children);let e;if(this._useAnimatedLayout){const t=[this._dialpadExpandedAnimatedStyles];a.UserInterface.isNavigatingWithKeyboard()&&this._isDialpadCollapsed&&t.push(d.default.displayNone),e=a.createElement(a.View,{onLayout:this._onLayout},a.createElement(a.Animated.View,{style:t},this.props.children),this._renderDialpadViewCollapsed())}else e=a.createElement(a.View,{onLayout:this._onLayout},this.props.children,this._renderDialpadViewCollapsed());return e}}t.default=p},3755:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(3756),o=i(3757),s=i(534),r=i(173),l=i(6),c=i(205),d=i(3758),u=i(12),h=l.lazyProperties({buttonsContainer:()=>a.Styles.createViewStyle({flex:0,flexDirection:"row",justifyContent:"center",marginBottom:15,minHeight:60,overflow:"visible",paddingLeft:5,paddingRight:5}),buttonWrapper:()=>a.Styles.createViewStyle({alignItems:"center",flex:1,flexBasis:0,flexDirection:"row",justifyContent:"center",minHeight:60})});class p extends u.default{constructor(){super(...arguments),this._callAllowed=()=>this.state.phoneNumber.callable&&!this.state.disableHighBandwidthOperations}shouldComponentUpdate(e,t){return!0}_buildState(e,t){return{isCollapsed:s.default.isDialpadCollapsed(),phoneNumber:c.default.getPhoneNumber(c.TriggerKeys.Callable),disableHighBandwidthOperations:r.default.isUsingGogoNetwork()}}render(){return a.createElement(a.View,{style:h.buttonsContainer,importantForAccessibility:this.state.isCollapsed?a.Types.ImportantForAccessibility.NoHideDescendants:a.Types.ImportantForAccessibility.No},a.createElement(a.View,{style:h.buttonWrapper},a.createElement(d.default,{phoneNumber:this.state.phoneNumber,canSendSms:this.state.phoneNumber.callable})),a.createElement(a.View,{style:h.buttonWrapper},a.createElement(o.default,{phoneNumber:this.state.phoneNumber,canCall:this._callAllowed(),callId:this.props.callId,conversationMri:this.props.conversationId})),a.createElement(a.View,{style:h.buttonWrapper},a.createElement(n.default,null)))}}t.default=p},3756:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(3),o=i(41),s=i(6),r=i(5),l=i(205),c=i(48),d=i(9),u=i(20),h=i(11),p=i(12),g=s.lazyProperties({backspaceButton:()=>a.Styles.createButtonStyle({width:60,height:60,alignItems:"center",flexBasis:0,flexDirection:"row",flexGrow:1,flexShrink:0,justifyContent:"center",minHeight:46})});class C extends p.default{constructor(){super(...arguments),this._onBackspace=e=>{const[t,i]=l.default.eraseCharFromPhoneNumberInput();t&&i?c.default.maybeAnnounceForAccessibility(r.getString("PSTNPhoneNumberInput.OnBackspaceAnnouncement",{symbol:t})):c.default.maybeAnnounceForAccessibility(r.getString("PSTNPhoneNumberInput.OnLongBackspaceAnnouncement"))},this._onLongBackspace=e=>{l.default.cleanupPhoneNumberInput(),c.default.maybeAnnounceForAccessibility(r.getString("PSTNPhoneNumberInput.OnLongBackspaceAnnouncement"))}}render(){const e=this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.headerIconColor:d.Color.black,t=r.getString("Pstn.RemoveNumberButton");return a.createElement(o.default,{icon:h.SkypeIcon.Backspace,color:e,hoverColor:e,size:h.IconSize.size24,style:g.backspaceButton,onPress:this._onBackspace,onLongPress:this._onLongBackspace,title:t,accessibilityLabel:t,flipIcon:this._getContext().isRTL&&u.default.getPlatformType()!==n.PlatformType.Android})}}t.default=C},3757:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(215),o=i(29),s=i(241),r=i(109),l=i(33),c=i(866),d=i(534),u=i(3),h=i(4),p=i(6),g=i(5),C=i(18),m=i(23),S=i(205),y=i(275),f=i(9),_=i(11),b=i(12),v=i(10),w=p.lazyProperties({roundButton:()=>a.Styles.createButtonStyle({height:60,overflow:"visible",width:60})});class T extends b.default{constructor(){super(...arguments),this._coachMarkContext={coachMarkArea:r.CoachMarkAreaType.Dialer},this._startPstnCall=()=>{const e=v.default.newCauseId();h.log(u.LogTraceArea.CallingUI,"[action]: Start Call Button, causeId: "+e),h.track(new y.DialerPanelComponentClick(y.DialerPanelClickTarget.CallButton)),c.default.startOrAddPstnCall(this.props.phoneNumber.E164,this.props.phoneNumber.emergency,this.props.phoneNumber.countryCode,this.props.phoneNumber.suffix,this.props.callId,this.props.conversationMri,this.props.phoneNumber.extension),this._isJoinCallRequest()&&(this.state.isUsingStackNavigationContext?this.props.conversationMri&&this.props.callId&&(h.log(u.LogTraceArea.CallingUI,"CallControl._startPstnCall causeId: "+e),o.default.CallNavigationHelper.rejoinCall(this.props.conversationMri,this.props.callId,e,S.default.getPhoneNumberOrigin()||u.NavigationCallOrigin.PstnDialpad)):C.default.closeGenericDesktopModal(e,this._getContext()))}}_buildState(e,t){const i={isUsingStackNavigationContext:m.default.isUsingStackNavigationContext(),conversationMembersMris:[],tasterCoachmarkEnabled:d.default.tasterCoachmarkEnabled(),tasterGreenCallButtonEnabled:d.default.tasterGreenCallButtonEnabled(),isTasterEligible:d.default.getCallRate().isTasterEligible};if(e.callId&&e.conversationMri){const t=l.default().getConversation(e.conversationMri);t&&(i.conversationMembersMris=t.getMemberMris())}return i}render(){const e=this.state.isTasterEligible&&this.state.tasterGreenCallButtonEnabled?f.Color.green:void 0,t=this.state.isTasterEligible&&this.state.tasterCoachmarkEnabled?a.createElement(s.default.ActionButton,{coachMarkType:r.CoachMarkType.PlaceTasterCall,anchorAccessibilityLabel:g.getString("PSTNDialerPanel.PlaceTasterCallCoachmarkTitle"),positions:[r.PopupAnchorPositon.Top],accessibilityLabel:g.getString("PSTNDialerPanel.CallButtonAccessibilityLabel"),accessibilityTraits:a.Types.AccessibilityTrait.Button,title:g.getString("PSTNDialerPanel.CallButtonAccessibilityLabel"),icon:_.SkypeIcon.CallStart,onPress:this._startPstnCall,disabled:!this.props.canCall,style:w.roundButton,backgroundColor:e}):a.createElement(n.default,{title:g.getString("PSTNDialerPanel.CallButtonAccessibilityLabel"),icon:_.SkypeIcon.CallStart,onPress:this._startPstnCall,disabled:!this.props.canCall,style:w.roundButton,backgroundColor:e});return a.createElement(r.CoachMarkContext.Provider,{value:this._coachMarkContext},t)}_isJoinCallRequest(){return this.props.callId&&this.props.conversationMri}}t.default=T},3758:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(35),n=i(0),o=i(7),s=i(221),r=i(61),l=i(375),c=i(134),d=i(3),u=i(41),h=i(4),p=i(6),g=i(5),C=i(18),m=i(205),S=i(275),y=i(311),f=i(9),_=i(20),b=i(11),v=i(12),w=i(10),T=p.lazyProperties({smsButtonDimensions:()=>n.Styles.createButtonStyle({width:60,height:60,alignItems:"center",flexBasis:0,flexDirection:"row",flexGrow:1,flexShrink:0,justifyContent:"center",minHeight:46})});class I extends v.default{constructor(){super(...arguments),this._onPress=()=>{if(!this.props.canSendSms)return;const e=w.default.newCauseId();h.log(d.LogTraceArea.DialerPanel,"[action]: Send SMS Button, causeId: "+e),this.props.phoneNumber.emergency?this._startEmergencySMS(e):this._startSkypeSMS(e)}}_buildState(e,t){const i=c.default.getCreditEntitlement(),a=c.default.getSubscriptions(),n={searchResult:m.default.getSearchResults().exactMatch,canShowSmsEntryPoint:o.default.getS4LEntitlementFeatures().SCE.Dialpad.Features.SmsButtonEnabled,supportsEmergencySms:t?void 0:this.state.supportsEmergencySms,sendButtonEnabled:!t&&this.state.sendButtonEnabled,useSmsThreadsFor2way:o.default.getS4LMessagingFeatures().useSmsThreadsFor2way,userEntitlementsSummary:s.getEntitlementCombination(i,a)};return e.canSendSms?e.phoneNumber.emergency&&!n.supportsEmergencySms?n.sendButtonEnabled=!1:n.sendButtonEnabled=!0:n.sendButtonEnabled=!1,n}render(){if(!this.state.canShowSmsEntryPoint)return null;const e=this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.headerIconColor:f.Color.black;return n.createElement(u.default,{icon:b.SkypeIcon.MobileSmsNew,title:g.getString("SMSMessaging.ContactOptionsPopupSendSMSLabel"),disabled:!this.state.sendButtonEnabled,color:e,hoverColor:e,size:b.IconSize.size24,style:T.smsButtonDimensions,onPress:this._onPress,flipIcon:this._getContext().isRTL&&_.default.getPlatformType()!==d.PlatformType.Android})}componentDidMount(){super.componentDidMount(),void 0===this.state.supportsEmergencySms&&a.default.supportsNativeEmergencyCalling().catch(()=>!1).then(e=>{this.isComponentMounted()&&this.setState({supportsEmergencySms:e})})}_startEmergencySMS(e){h.log(d.LogTraceArea.DialerPanel,"SMSControl._startEmergencySMS, causeId: "+e);const t=this.props.phoneNumber.suffix;t?(h.log(d.LogTraceArea.GenericUnsafe,"Placing emergency SMS to "+l.default.maskPhoneNumber(t)+", destination country: "+this.props.phoneNumber.countryCode),a.default.makeNativeEmergencySMS(t).then(e=>{e||h.warn(d.LogTraceArea.GenericUnsafe,"Failed to place emergency SMS")})):h.warn(d.LogTraceArea.GenericUnsafe,"Refusing to place emergency SMS, reason: no information about phone number suffix")}_startSkypeSMS(e){h.log(d.LogTraceArea.DialerPanel,"SMSControl._startSkypeSMS, causeId: "+e);const t=l.default.getPhoneNumberMri(this.props.phoneNumber);r.default.ensureConversationLoadedOrFaked(t,d.ConversationFakedOrigin.SmsButton).then(i=>{const a={convId:t,origin:d.NavigationConversationOrigin.SmsControl,isNewConversation:i,causeId:e};!this.state.useSmsThreadsFor2way&&this.state.searchResult&&(this.state.searchResult.contact.userMri&&(a.convId=this.state.searchResult.contact.userMri),a.selectedNumberForSMS=this.state.searchResult.phone),y.default.setNextFlowId(y.SmsFlowId.Dialer),h.track(new S.DialerPanelComponentClick(S.DialerPanelClickTarget.SmsButton,this.state.userEntitlementsSummary)),C.default.navigateToConversation(a)})}}t.default=I},3759:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(54),o=i(745),s=i(67),r=i(3),l=i(86),c=i(26),d=i(4),u=i(6),h=i(5),p=i(18),g=i(239),C=i(205),m=i(275),S=i(48),y=i(483),f=i(44),_=i(9),b=i(11),v=i(218),w=i(14),T=i(16),I=i(12),P=i(10),M=u.lazyProperties({headerControlWrap:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"center",alignItems:"center",height:b.IconSize.default}),headerControlText:()=>a.Styles.createTextStyle({flexGrow:0,flexShrink:1,color:_.Color.white,marginRight:5}),dividerContainer:()=>a.Styles.createViewStyle({height:1}),divider:()=>a.Styles.createViewStyle({position:"absolute",left:10,right:10,bottom:0,height:1}),iconStyle:()=>a.Styles.createViewStyle({paddingLeft:3}),countrySelectorPopupContainer:()=>a.Styles.createViewStyle({height:350,width:300}),titleWrapperStyle:()=>a.Styles.createViewStyle({flexGrow:0,flexShrink:1,flexDirection:"row",alignItems:"center"}),filterInputControl:()=>a.Styles.createViewStyle({height:50,paddingTop:10})});class k extends I.default{constructor(){super(...arguments),this._close=()=>{const e=P.default.newCauseId();d.log(r.LogTraceArea.Navigation,"DialpadHeader._close, causeId: "+e),p.default.goBack(e,this._getContext())},this._goCallSettings=()=>{d.track(new m.DialerPanelComponentClick(m.DialerPanelClickTarget.SettingsButton)),p.default.navigateToCallingSettingsPanel(!1,this._getContext())},this._onCenterControlsRef=e=>{this._centerControls=e||void 0},this._onCountryTitleRef=e=>{this._countryTitleRef=e||void 0},this._onCountryListRef=e=>{this._countryListRef=e||void 0},this._onCountrySelectorPress=e=>{this.props.isUsingStackNavigationContext?p.default.navigateToCountrySelector(this._getRootViewId()):this._openCountrySelectorModal()},this._openCountrySelectorModal=()=>{const e=e=>{const t=this.state.countries[e];C.default.setSelectedCountry(t,!0),n.default.dismissPopup("countrySelectorPopup",this._getRootViewId())},t={getAnchor:()=>this._countryTitleRef,renderPopup:(t,i,n,r)=>a.createElement(v.default,{anchorPosition:t,anchorOffset:i,popupWidth:n,popupHeight:r,fillColor:this._themeColors.popoverBackgroundColor,strokeColor:this._useDarkTheme()?this._themeColors.popupBorderColor:void 0,skipPopupAutoFocus:!0,popupAccessibilityTitle:h.getString("PSTNCountryList.CountryList")},a.createElement(a.View,{style:M.countrySelectorPopupContainer},a.createElement(a.View,{style:w.default.flexZero},a.createElement(y.default,{style:M.filterInputControl,placeholderText:h.getString("PSTNCountryList.SearchCountryPlaceholder"),onInputTextChange:this._onSearch,showSearchIcon:!0,hideBackground:!0,useBoldFont:!0})),a.createElement(a.View,{style:M.dividerContainer},a.createElement(s.default,{style:M.divider})),a.createElement(o.default,{ref:this._onCountryListRef,countries:this.state.countries,recentCountries:C.default.getLast5CalledCountriesNoSubscription(),onSelect:e}))),positionPriorities:["top","bottom"],dismissIfShown:!0,rootViewId:this._getRootViewId()};n.default.showPopup(t,"countrySelectorPopup")},this._onSearch=e=>{this.isComponentMounted()&&(this.setState({query:e}),this._countryListRef&&this._countryListRef.onFilterChange(e))}}requestFocus(){this._centerControls&&this._centerControls.requestFocus()}render(){return a.createElement(f.SimplePanelHeader,{useTransparentBackground:!0,hideBottomBorder:!0,leftButton:this._getCloseButton(),rightButtons:this._getCallingSettingseButton(),titleView:this._getHeaderCenterControls(),headerPosition:this.props.isInLandscape?f.HeaderPosition.Start:f.HeaderPosition.Default})}_buildState(e,t){const i={countries:g.default.getCountries(),selectedCountry:C.default.getSelectedCountry()};return t&&(i.selectedCountry&&(i.selectedCountry=g.default.getCountryByCode(i.selectedCountry.country)),this._titleWrapperStyle=[M.titleWrapperStyle,a.Styles.createViewStyle({maxWidth:e.maxWidth},!1)]),i}_getCloseButton(){return{closeButtonType:this.props.isUsingStackNavigationContext||this.props.isAloneInNavStack?f.CloseButtonType.Close:f.CloseButtonType.Back,title:this.props.isUsingStackNavigationContext||this.props.isAloneInNavStack?h.getString("Global.CloseButtonTitle"):h.getString("Global.BackButtonTitle"),onPress:this._close,color:this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.headerIconColor:_.Color.white,hoverColor:this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.iconHoverColor:_.Color.whiteOverlay50,accessibilityLabel:this.props.isUsingStackNavigationContext||this.props.isAloneInNavStack?h.getString("Global.CloseButtonTitle"):h.getString("Global.BackButtonTitle")}}_getCallingSettingseButton(){const e=h.getString("UserSettingsPanel.CallSettingsTitle");return{icon:b.SkypeIcon.Settings,title:e,onPress:this._goCallSettings,color:this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.headerIconColor:_.Color.white,hoverColor:this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.iconHoverColor:_.Color.whiteOverlay50,accessibilityLabel:e}}_getHeaderCenterControls(){let e=h.getString("PSTNCountrySelectorPanel.Title"),t=h.getString("PSTNCountrySelectorPanel.Title");const i=[M.headerControlText];return this.state.selectedCountry&&(e=this.state.selectedCountry.countryName,t=h.getString("PSTNDialerPanel.CountriesAndRegionsAccessibilityLabel",{countryTitle:e})),(this._useDarkTheme()||this._useAccessibleTheme())&&i.push(this._themeStyles.headerTextColorStyle),a.createElement(a.Button,{ref:this._onCenterControlsRef,style:M.headerControlWrap,onPress:this._onCountrySelectorPress,accessibilityLabel:t,accessibilityTraits:[a.Types.AccessibilityTrait.Button,a.Types.AccessibilityTrait.HasPopup]},a.createElement(l.default,{ref:this._onCountryTitleRef,style:this._titleWrapperStyle},a.createElement(T.PanelHeader,{style:i,numberOfLines:1},e),a.createElement(c.default,{icon:b.SkypeIcon.DownChevron,size:b.IconSize.size12,color:this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.headerIconColor:_.Color.white,style:M.iconStyle})))}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),C.default.initializeCountrySelection()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.selectedCountry&&this._announceCountrySelectedForAccessibility(this.state.selectedCountry.countryName)}shouldComponentUpdate(e,t){return!!this.state.selectedCountry!=!!t.selectedCountry||!!this.state.selectedCountry&&!!t.selectedCountry&&this.state.selectedCountry.country!==t.selectedCountry.country||this.props.isInLandscape!==e.isInLandscape}_announceCountrySelectedForAccessibility(e){this._announceForAccessibility(h.getString("PSTNDialerPanel.CountryAnnouncement",{countryTitle:e}))}_announceForAccessibility(e){S.default.maybeAnnounceForAccessibility(e,1e3)}}t.default=k},3760:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(168),o=i(0),s=i(13),r=i(1164),l=i(3),c=i(4),d=i(6),u=i(5),h=i(135),p=i(479),g=i(205),C=i(275),m=i(27),S=i(154),y=i(9),f=i(24),_=i(28),b=i(14),v=i(16),w=i(12),T=i(101),I=i(65),P=d.lazyProperties({searchResultPanelStyle:()=>o.Styles.createViewStyle({flex:1,minHeight:100}),searchResultPanelDarkThemeStyle:()=>o.Styles.createViewStyle({backgroundColor:y.Color.gray400}),itemDivider:()=>o.Styles.createViewStyle({height:1,marginLeft:50,marginRight:10}),itemDividerDarkTheme:()=>o.Styles.createViewStyle({backgroundColor:y.Color.dialPadHoverDark}),itemDividerLightTheme:()=>o.Styles.createViewStyle({backgroundColor:y.Color.whiteOverlay20}),itemDividerSmallScreen:()=>o.Styles.createViewStyle({marginRight:16}),singleItemDivider:()=>o.Styles.createViewStyle({height:1,marginLeft:10,marginRight:10}),transparentBg:()=>o.Styles.createViewStyle({backgroundColor:y.Color.transparent}),textOnGradient:()=>o.Styles.createTextStyle({color:y.Color.white}),rowHighlightDarkStyle:()=>o.Styles.createViewStyle({backgroundColor:y.Color.dialPadHoverDark})});class M extends w.default{constructor(){super(...arguments),this._onScrollFlag=!1,this._renderItem=e=>{const t=o.createElement(k,{key:e.key,mri:e.profile.userMri,displayName:e.profile.displayName,phoneNumber:this.state.isSingleSelection?void 0:e.phone,itemHeight:e.height,textToHighlight:e.textToHighlight,onResultPress:this._onSearchItemPressed,searchIndex:e.searchIndex});if(e.isLastItem&&!this.state.isSingleSelection)return t;const i=[P.itemDivider];this._useDarkTheme()?i.push(P.itemDividerDarkTheme):i.push(this._themeStyles.dividerColorStyle),this.state.isMobileScreenSize&&i.push(P.itemDividerSmallScreen);const a=o.createElement(o.View,{key:"itemDivider",style:i});if(this.state.isSingleSelection){const e=[P.singleItemDivider];return this._useDarkTheme()?e.push(P.itemDividerDarkTheme):e.push(P.itemDividerLightTheme),[o.createElement(o.View,{key:"itemDivider",style:e}),t]}return[t,a]},this._onSearchItemPressed=(e,t)=>{c.log(l.LogTraceArea.DialerPanel,"[action]: Contact Selection"),c.track(new C.ContactSelected(g.default.getPhoneNumber(g.TriggerKeys.InputValue).E164.length)),g.default.selectSearchResultItem(t),this.props.onItemPressed&&this.props.onItemPressed()},this._onScroll=()=>{this.props.onScroll&&this._onScrollFlag?(this.props.onScroll(),this._onScrollFlag=!1):this._onScrollFlag=!0}}_buildState(e,t){const i=g.default.getSearchResults(),n=S.SearchItemHeights.baseListItemHeight+Math.round(S.SearchItemHeights.scaledListItemHeight*Math.min(m.default.getContentSizeMultiplier(),s.MaxContentSizeMultiplier)),o=this._getRootViewId(),r={isMobileScreenSize:m.default.isMobileScreenSize(o),searchQuery:i.query,profiles:[],isSingleSelection:!!i.selectedResult};return i.results.length>0&&!i.selectedResult&&(a.each(i.results,(e,t)=>{r.profiles.push({profile:e.contact,phone:e.phone.number,textToHighlight:e.matchedString,template:"profile",height:n,key:"ct_"+e.contact.uniqueId+t,searchIndex:t,isLastItem:!1})}),r.profiles[r.profiles.length-1].isLastItem=!0),r}render(){const e=[P.searchResultPanelStyle];return this.state.isSingleSelection||0===this.state.profiles.length?e.push(P.transparentBg):this._useDarkTheme()?e.push(P.searchResultPanelDarkThemeStyle):e.push(this._themeStyles.primaryBackgroundColorStyle),o.createElement(o.View,{style:e,importantForAccessibility:this._accessibilityForSearchResultsView()},o.createElement(n.VirtualListView,{itemList:this.state.profiles,renderItem:this._renderItem,animateChanges:!1,skipRenderIfItemUnchanged:!1,keyboardDismissMode:"on-drag",keyboardShouldPersistTaps:!0,horizontalPadding:this.props.safeAreaHorizontalInsets,hoveredItemStyle:this.state.isSingleSelection?void 0:this._themeStyles.rowHoverViewStyle,onScroll:this._onScroll,accessibilityLabel:u.getString("PSTNDialerPanel.FastContactsSearchList")}))}componentDidMount(){super.componentDidMount(),g.default.initializeSearch()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this._onScrollFlag=!1,this.props.onRender&&this.props.onRender()}componentWillUnmount(){super.componentWillUnmount(),g.default.destroySearch()}_accessibilityForSearchResultsView(){return 0===this.state.profiles.length?o.Types.ImportantForAccessibility.NoHideDescendants:void 0}}class k extends w.default{constructor(){super(...arguments),this._onHoverOverItemStart=e=>{this.isComponentMounted()&&this.setState({isHoveringOverItem:!0})},this._onHoverOverItemEnd=e=>{this.isComponentMounted()&&this.setState({isHoveringOverItem:!1})},this._onItemPressed=()=>{this.props.phoneNumber&&(this.props.onResultPress(this.props.phoneNumber,this.props.searchIndex),this.isComponentMounted()&&this.setState({isHoveringOverItem:!1}))}}render(){const e=p.getItemHeightStyle(this.props.itemHeight-1),t=[p.styles.listItem];e&&t.push(e),this.state.isHoveringOverItem&&this.props.phoneNumber&&(this._useDarkTheme()?t.push(P.rowHighlightDarkStyle):t.push(this._themeStyles.rowHighlightViewStyle));const i=[f.default.fontStyle.body,this._themeStyles.secondaryTextColorStyle,b.default.flexNegativeOne],a=[...i,p.styles.statusTextInnerContainer],n=this.props.displayName,s=this.props.phoneNumber;let l,c;if(s)c=o.createElement(o.View,{style:p.styles.statusContainer,title:s},o.createElement(r.default,{displayText:s,textToHighlight:this.props.textToHighlight,containerStyles:a,inlineTextStyle:i,highlightType:_.TextToHighlightType.PhoneNumber}));else{c=void 0;let e=P.textOnGradient;!this._useDarkTheme()&&this._useAccessibleTheme()&&(e=this._themeStyles.primaryTextColorStyle),l=e}const d=-1!==n.indexOf(this.props.textToHighlight)?o.createElement(r.default,{displayText:n,textToHighlight:this.props.textToHighlight,containerStyles:a,inlineTextStyle:[f.default.rowTitleFontStyle(this._currentTheme),l],highlightType:_.TextToHighlightType.DisplayName}):o.createElement(v.RowTitle,{style:l,numberOfLines:1},n);return o.createElement(h.default.Button,{style:t,onPress:s?this._onItemPressed:void 0,onHoverStart:s?this._onHoverOverItemStart:void 0,onHoverEnd:s?this._onHoverOverItemEnd:void 0,underlayColor:this._useDarkTheme()?y.Color.dialPadHoverDark:this._themeColors.rowHighlightColor,accessibilityTraits:o.Types.AccessibilityTrait.Button,accessibilityLabel:n+(s?", "+s:"")},o.createElement(T.UserIcon,{key:"userIcon",size:I.UserIconSize.Size40,userMri:this.props.mri,statusBorderColor:this._themeColors.primaryBackgroundColor}),o.createElement(o.View,{key:"text",style:p.styles.textContainer},d,c))}}t.default=M},3761:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(7),s=i(13),r=i(234),l=i(866),c=i(375),d=i(3),u=i(26),h=i(173),p=i(4),g=i(6),C=i(5),m=i(18),S=i(23),y=i(1829),f=i(205),_=i(275),b=i(48),v=i(42),w=i(9),T=i(24),I=i(11),P=i(14),M=i(16),k=i(10),A=g.lazyProperties({numberInputContainer:()=>n.Styles.createViewStyle({alignItems:"center",flexDirection:"row",paddingBottom:10,paddingLeft:20,paddingRight:10}),numberInput:()=>n.Styles.createTextStyle({backgroundColor:w.Color.transparent,color:w.Color.white,flex:0,font:T.default.font.uiDisplayBold}),emergencyCallContainerStyle:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),emergencyCallContainerStyleLandscape:()=>n.Styles.createViewStyle({flexDirection:"column"}),emergencyCallStyle:()=>n.Styles.createTextStyle({backgroundColor:w.Color.transparent,color:w.Color.white,marginBottom:5,paddingHorizontal:10,flexShrink:1}),emergencyCallLearnMoreStyle:()=>n.Styles.createViewStyle({alignSelf:"flex-start",marginRight:10}),emergencyCallLearnMoreStyleLandscape:()=>n.Styles.createViewStyle({alignSelf:"flex-start",marginLeft:10}),emergencyCallBackground:()=>n.Styles.createViewStyle({backgroundColor:w.Color.red,height:r.DefaultHeight}),errorNotificationFlexStyle:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",marginLeft:10,marginRight:40}),invalidNumberNotificationStyle:()=>n.Styles.createTextStyle({flex:1,backgroundColor:w.Color.transparent,color:w.Color.white,marginBottom:5,marginLeft:10})}),R={numberInput:g.lazyProperties({MobileSmall:()=>n.Styles.createTextStyle({fontSize:T.default.controlFontSize.h4}),MobileMedium:()=>n.Styles.createTextStyle({fontSize:T.default.controlFontSize.dialpadNumber}),MobileDefault:()=>n.Styles.createTextStyle({fontSize:T.default.controlFontSize.dialpadNumberLarge}),DesktopDefault:()=>n.Styles.createTextStyle({fontSize:T.default.controlFontSize.h4})})};class V extends y.PhoneNumberInputBase{constructor(){super(...arguments),this._onChangeTextEvent={isLocked:!1,newValue:""},this._onPressPhoneNumberContainer=e=>{this.props.onPress&&this.props.onPress()},this._onSubmit=()=>{if(!this.state.phoneNumber.callable||this.state.disableHighBandwidthOperations)return void p.log(d.LogTraceArea.DialerPanel,"PhoneNumberInputDesktop._onSubmit not callable phone number");const e=k.default.newCauseId();p.log(d.LogTraceArea.DialerPanel,"PhoneNumberInputDesktop._onSubmit, causeId: "+e),l.default.startOrAddPstnCall(this.state.phoneNumber.E164,this.state.phoneNumber.emergency,this.state.phoneNumber.countryCode,this.state.phoneNumber.suffix,this.props.callId,this.props.conversationId),!S.default.isUsingStackNavigationContext()&&this._isJoinCallRequest()&&m.default.closeGenericDesktopModal(e,this._getContext())},this._onPaste=e=>{if(!e.clipboardData||!e.clipboardData.items||0===e.clipboardData.items.length)return;const t=a.find(e.clipboardData.items,e=>"text/plain"===e.type),i=!!this._textInputRef&&c.default.isCursorPlacedInPrefixArea(this.state.phoneNumber,this._textInputRef.getSelectionRange());t&&(this._onChangeTextEvent.isLocked=!0,t.getAsString(e=>{this._onChangeTextEvent.isLocked=!1;const t=c.default.normalizePhoneNumber(e);if(c.default.isE164Format(t))this._onChangeText(t,d.NavigationCallOrigin.PstnDialpadPasted);else if(i)this._onChangeText(t,d.NavigationCallOrigin.PstnDialpadPasted);else if(!a.isEmpty(this._onChangeTextEvent.newValue)){const e=c.default.normalizePhoneNumber(this._onChangeTextEvent.newValue);this._onChangeText(e,d.NavigationCallOrigin.PstnDialpadPasted)}p.track(new _.PasteNumber)}))},this._renderEmergencyCallElements=()=>{if(!this._isEmergencyMode())return;const e=[],t=[];if(this.state.phoneNumber.forceChangedPrefix){p.debug(()=>"PhoneNumberInputDesktop._renderOptionalEmergencyCallNotification: 0");const i=C.getString("PSTNDialerPanel.EmergencyCallingDefaultCountryAppliedLabel",{number:this.state.phoneNumber.suffix?this.state.phoneNumber.suffix:"",country:this.state.selectedCountry?this.state.selectedCountry.countryName:""});e.push(n.createElement(M.BodyText,{key:"EmergencyCallingDefaultCountryAppliedLabel",size:M.BodyTextSize.SmallDeprecated,style:A.emergencyCallStyle},i)),t.push(i)}if(this.state.phoneNumber.callable){p.debug(()=>"PhoneNumberInputDesktop._renderOptionalEmergencyCallNotification: 1");const i=C.getString("PSTNDialerPanel.EmergencyCallingLimitedLabel"),a=C.getString("PstnUtils.EmergencyCallWarning");e.push(n.createElement(n.View,{key:"EmergencyCallingContainer",style:this.props.isInLandscape?A.emergencyCallContainerStyleLandscape:A.emergencyCallContainerStyle},n.createElement(M.Subtitle,{key:"EmergencyCallingLimitedLabel",style:A.emergencyCallStyle},i,"",a),n.createElement(v.default,{key:"EmergencyCallingLimitedLabelContainer",buttonSize:s.SXButtonSize.Small,buttonStyle:s.SXButtonStyle.LightFill,style:this.props.isInLandscape?A.emergencyCallLearnMoreStyleLandscape:A.emergencyCallLearnMoreStyle,title:C.getString("PstnUtils.EmergencyCallingLearnMore"),allowTextWrap:!0,onPress:this._onPressEmergencyCallLearnMoreHandler}))),t.push(i),t.push(a)}else{p.debug(()=>"PhoneNumberInputDesktop._renderOptionalEmergencyCallNotification: 2");const i=C.getString("PSTNDialerPanel.EmergencyCallingNoCallingLabel"),a=C.getString("PstnUtils.EmergencyCallingNotSupportedRegion");e.push(n.createElement(M.Subtitle,{key:"EmergencyCallingNoCallingLabel",style:A.emergencyCallStyle},i),n.createElement(M.Caption,{key:"EmergencyCallingNotSupportedRegion",style:A.emergencyCallStyle},a)),t.push(i),t.push(a)}return t.length>0&&b.default.maybeAnnounceForAccessibility(t.join(" ")),e},this._renderInvalidNotification=()=>{if(this.state.showInvalidNumberNote)return n.createElement(n.View,{style:A.errorNotificationFlexStyle},n.createElement(u.default,{key:"infoIcon",icon:I.SkypeIcon.Info,size:I.IconSize.size20,color:w.Color.white}),n.createElement(M.BodyText,{size:M.BodyTextSize.BigDeprecated,bold:!0,style:A.invalidNumberNotificationStyle,numberOfLines:2},C.getString("PSTNDialerPanel.InvalidNumberError")))},this._onPressEmergencyCallLearnMoreHandler=()=>{n.Linking.openUrl(o.default.getConfigSettingsNoSubscription().calling.emergencyCallingLearnMoreLink)},this._onTextInputRef=e=>{this._textInputRef=e||void 0},this._handleChangeText=e=>{this._onChangeText(e,d.NavigationCallOrigin.PstnDialpadTyped)},this._onChangeText=(e,t)=>{this._onChangeTextEvent.isLocked?this._onChangeTextEvent.newValue=e:e!==this.state.value&&(e&&!c.default.isValidPhoneNumberInput(e)?this._textInputRef&&this._textInputRef.setValue(this.state.value):f.default.overwritePhoneNumberInput(e,!0,t),this.props.onPress&&this.props.onPress())}}_buildState(e,t){let i=super._buildState(e,t);return i.selectedCountry=f.default.getSelectedCountry(),i.disableHighBandwidthOperations=h.default.isUsingGogoNetwork(),i}_getTextInput(){const e=[A.numberInput,this._chooseResponsiveStyle(R.numberInput)];(this._useDarkTheme()||this._useAccessibleTheme())&&e.push(this._themeStyles.headerTextColorStyle);let t=n.createElement(n.View,{style:P.default.flexOne,onPress:this._onPressPhoneNumberContainer},n.createElement(n.TextInput,{style:e,autoFocus:!0,value:this.state.value,placeholder:C.getString("PSTNPhoneNumberInput.NumberPlaceholder"),accessibilityLabel:this._getAccessibilityLabel(),placeholderTextColor:this._useAccessibleTheme()?w.Color.whiteOverlay80:w.Color.whiteOverlay50,onChangeText:this._handleChangeText,ref:this._onTextInputRef,onPaste:this._onPaste,onSubmitEditing:this._onSubmit,clearButtonMode:"never"}));return t=n.createElement("div",{className:this._useAccessibleTheme()?void 0:"inputGradient"},t),t}_isJoinCallRequest(){return this.props.callId&&this.props.conversationId}_isInputFocused(){return this._textInputRef&&this._textInputRef.isFocused()}render(){const e=this._isEmergencyMode()||this.state.showInvalidNumberNote?n.createElement(n.View,null,this._renderEmergencyCallElements(),this._renderInvalidNotification()):void 0;return n.createElement(n.View,{style:this._isEmergencyMode()?A.emergencyCallBackground:void 0},n.createElement(n.View,{style:A.numberInputContainer},n.createElement(n.View,{style:P.default.flexOne},this._getTextInput()),this._getOptionalContactsIcon()),e)}componentDidMount(){super.componentDidMount(),this._textInputRef&&this._textInputRef.selectRange(-1,-1)}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),this.state.showInvalidNumberNote&&this.props.prefilledInput!==this.state.phoneNumber.E164&&this.setState({showInvalidNumberNote:!1}),this._isInputFocused()||!this.state.phoneNumber.inputValue)return void(this.state.isRateIntegrationEnabled&&this.state.callRate&&b.default.maybeAnnounceForAccessibility(this.state.callRate));const a=this._getAccessibilityLabel(!0);a&&b.default.maybeAnnounceForAccessibility(a,500),this.state.selectedResult&&!t.selectedResult&&this.requestFocus()}requestFocus(){a.defer(()=>{if(this.isComponentMounted()&&this._textInputRef){this._textInputRef.requestFocus();const e=this.state.phoneNumber.inputValue.length;e>0&&this._textInputRef.selectRange(e,e)}})}_getCallAccessibilityLabel(){return this._isInputFocused()?C.getString("PSTNPhoneNumberInput.AccessibilityLabelEnterToCall"):C.getString("PSTNPhoneNumberInput.AccessibilityLabel")}_getAccessibilityLabel(e=!1){const t=e?[this.state.value]:[];return this.state.showInvalidNumberNote?t.push(C.getString("PSTNDialerPanel.InvalidNumberError")):this.state.phoneNumber.callable&&t.push(this._getCallAccessibilityLabel()),this.state.accessibilitySummary&&(this.state.accessibilitySummary.searchHasResults&&t.push(C.getString("PSTNPhoneNumberInput.A11yLabelContactsFound")),this.state.accessibilitySummary.selectedContactDisplayName&&t.push(C.getString("PSTNPhoneNumberInput.A11yLabelSingleContactSelected",{contactName:this.state.accessibilitySummary.selectedContactDisplayName})),!c.default.isE164Format(this.state.value)&&this.state.accessibilitySummary.selectedCountryName&&t.push(C.getString("PSTNPhoneNumberInput.AccessibilityLabelDestinationCountry",{country:this.state.accessibilitySummary.selectedCountryName}))),this.state.isRateIntegrationEnabled&&!this._isInputFocused()&&this.state.callRate&&t.push(this.state.callRate),t.length?t.join(", "):void 0}}t.default=V},3762:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1544),n=i(0),o=i(3),s=i(26),r=i(4),l=i(6),c=i(5),d=i(23),u=i(1829),h=i(275),p=i(9),g=i(24),C=i(11),m=i(14),S=i(16),y=i(346),f=l.lazyProperties({numberInputContainer:()=>n.Styles.createViewStyle({alignItems:"center",flexDirection:"row",paddingBottom:10,paddingLeft:10,paddingRight:0,minHeight:45}),inputWrapper:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row"}),numberInput:()=>n.Styles.createTextStyle({backgroundColor:"transparent",color:p.Color.white,flex:0,font:g.default.font.uiDisplayBold,paddingRight:10}),numberInputFade:()=>n.Styles.createTextStyle({color:p.Color.whiteOverlay50}),numberInputFadeAccessibleLight:()=>n.Styles.createTextStyle({color:p.Color.blackOverlay60}),numberInputFadeAccessibleDark:()=>n.Styles.createTextStyle({color:p.Color.whiteOverlay80}),contextMenu:()=>n.Styles.createViewStyle({alignSelf:"stretch",flex:1}),errorNotificationFlexStyle:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",marginRight:40}),invalidNumberNotificationStyle:()=>n.Styles.createTextStyle({flex:1,backgroundColor:p.Color.transparent,color:p.Color.white,textAlignVertical:"top",marginBottom:5,marginLeft:10}),extendedHeight:()=>n.Styles.createTextStyle({minHeight:150})}),_={numberInput:l.lazyProperties({MobileSmall:()=>n.Styles.createTextStyle({fontSize:g.default.controlFontSize.h4}),MobileMedium:()=>n.Styles.createTextStyle({fontSize:g.default.controlFontSize.dialpadNumber}),MobileDefault:()=>n.Styles.createTextStyle({fontSize:g.default.controlFontSize.dialpadNumberLarge}),DesktopDefault:()=>n.Styles.createTextStyle({fontSize:g.default.controlFontSize.h4})})};class b extends u.PhoneNumberInputBase{constructor(){super(...arguments),this._onPress=e=>{this.props.onPress&&this.props.onPress()},this._onContextMenuRef=e=>{this._contextMenu=e||void 0},this._showContextMenu=()=>{this._contextMenu&&this._contextMenu.showContextMenu()},this._handleItemSelected=e=>{switch(e){case"copy":const e=this.state.value;e&&y.default.writeText(e);break;case"paste":r.track(new h.PasteNumber),n.Clipboard.getText().then(e=>{this._writeToStore(e,o.NavigationCallOrigin.PstnDialpadPasted)})}},this._renderInvalidNotification=()=>{if(this.state.showInvalidNumberNote)return n.createElement(n.View,{style:f.errorNotificationFlexStyle},n.createElement(s.default,{icon:C.SkypeIcon.Info,color:p.Color.white,size:C.IconSize.size20}),n.createElement(S.BodyText,{size:S.BodyTextSize.BigDeprecated,bold:!0,style:f.invalidNumberNotificationStyle},c.getString("PSTNDialerPanel.InvalidNumberError")))}}_buildState(e,t){const i=super._buildState(e,t);return i.isUsingStackNavigationContext=d.default.isUsingStackNavigationContext(),i}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),this.state.showInvalidNumberNote)return this.props.prefilledInput!==this.state.phoneNumber.E164&&this.setState({showInvalidNumberNote:!1}),void(t.showInvalidNumberNote||this._announceForAccessibility(c.getString("PSTNDialerPanel.InvalidNumberError")));this.state.accessibilitySummary&&t.value===this.state.value&&(this.state.accessibilitySummary.searchHasResults?this._announceForAccessibility(c.getString("PSTNPhoneNumberInput.A11yLabelContactsFound")):this.state.accessibilitySummary.selectedContactDisplayName&&this._announceForAccessibility(c.getString("PSTNPhoneNumberInput.A11yLabelSingleContactSelected",{contactName:this.state.accessibilitySummary.selectedContactDisplayName})))}_announceForAccessibility(e){n.Accessibility.announceForAccessibility(e)}_getTextInput(){const e=[f.numberInput,this._chooseResponsiveStyle(_.numberInput)];(this._useDarkTheme()||this._useAccessibleTheme())&&e.push(this._themeStyles.headerTextColorStyle),0===this.state.value.length&&(this._useAccessibleTheme()?e.push(this._useDarkTheme()?f.numberInputFadeAccessibleDark:f.numberInputFadeAccessibleLight):e.push(f.numberInputFade));const t=this.state.value;return n.createElement(n.Text,{style:e,numberOfLines:1,allowFontScaling:!1,ellipsizeMode:"head"},t||c.getString("PSTNPhoneNumberInput.NumberPlaceholder"))}render(){let e;this.state.isUsingStackNavigationContext&&(e=[f.inputWrapper]);const t=this.state.value.length?c.getString("PSTNPhoneNumberInput.AccessibilityLabelEnteredPhoneNumber",{number:this.state.value}):c.getString("PSTNPhoneNumberInput.AccessibilityLabelNumberPlaceholder");return n.createElement(n.View,{style:this.state.showInvalidNumberNote?[f.numberInputContainer,f.extendedHeight]:f.numberInputContainer},n.createElement(a.ContextMenu,{items:this._getMenuItems(),onItemSelected:this._handleItemSelected,style:f.contextMenu,ref:this._onContextMenuRef},n.createElement(n.View,{onLongPress:this._showContextMenu,onPress:this._onPress,style:m.default.flexOne},n.createElement(n.View,{style:e,accessibilityLabel:t},this._getTextInput()),this._renderInvalidNotification())),this._getOptionalContactsIcon())}_getMenuItems(){return[{text:c.getString("Pstn.CopyContextMenu"),command:"copy"},{text:c.getString("Pstn.PasteContextMenu"),command:"paste"}]}}t.default=b},3763:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(13),s=i(285),r=i(71),l=i(375),c=i(1830),d=i(67),u=(i(3),i(723)),h=i(4),p=i(6),g=i(5),C=i(18),m=i(205),S=i(205),y=i(275),f=i(27),_=i(9),b=i(24),v=i(11),w=i(28),T=i(12),I=p.lazyProperties({buttonContainer:()=>n.Styles.createViewStyle({backgroundColor:_.Color.transparent,marginBottom:12,alignItems:"flex-start"}),buttonStyle:()=>n.Styles.createViewStyle({paddingHorizontal:20}),titleStyle:()=>n.Styles.createTextStyle({paddingLeft:12}),topBorderDividerDarkTheme:()=>n.Styles.createViewStyle({backgroundColor:_.Color.dialPadHoverDark}),topBorderDividerLightTheme:()=>n.Styles.createViewStyle({backgroundColor:_.Color.whiteOverlay20})});class P extends T.default{constructor(){super(...arguments),this._onButtonPress=e=>{if(e.stopPropagation(),this.state.phoneNumber){const e=l.default.getPhoneNumberMri(this.state.phoneNumber);if(r.default.isContact(e))return;c.default.savePhoneNumberInput(this.state.phoneNumber.inputValue),h.track(new y.DialerPanelComponentClick(y.DialerPanelClickTarget.SaveContactButton));const t={number:a.isEmpty(this.state.phoneNumber.E164)?this.state.phoneNumber.suffix:this.state.phoneNumber.E164,type:w.PhoneNumberTypes.Mobile};C.default.navigateToAddPhoneNumberPanel(s.AddPhoneNumberPanelOrigin.DialpadPanel,this._getRootViewId(),void 0,[t],void 0,this._onPhoneNumberSaved,this._onSaveNumberCancelled)}},this._onPhoneNumberSaved=e=>{S.default.preselectSavedContact(e),this.props.onContactSaved&&this.props.onContactSaved(),h.track(new y.SaveContactDialpadFlowStep(y.SaveContactFlowStep.SaveContactSuceeded))},this._onSaveNumberCancelled=()=>{c.default.shouldRestoreState(),h.track(new y.SaveContactDialpadFlowStep(y.SaveContactFlowStep.SaveContactCancelled))}}_buildState(e,t){return{phoneNumber:S.default.getPhoneNumber(m.TriggerKeys.E164),contentSizeMultiplier:f.default.getContentSizeMultiplier()}}render(){const e=this._useAccessibleTheme()?this._themeColors.primaryIconColor:_.Color.white,t=n.Styles.createTextStyle({color:e},!1),i=[I.titleStyle,b.default.bodyFontStyle(this._currentTheme),t];return!this._useDarkTheme()&&this._useAccessibleTheme()&&i.push(this._themeStyles.primaryTextColorStyle),h.track(new y.SaveContactDialpadFlowStep(y.SaveContactFlowStep.SaveContactButtonShow)),n.createElement(n.View,{style:I.buttonContainer},n.createElement(d.default,{marginLeft:10,marginRight:10,marginBottom:10,style:this._useDarkTheme()?I.topBorderDividerDarkTheme:I.topBorderDividerLightTheme}),n.createElement(u.default,{size:this._getContentSizeHeight(v.IconSize.size24),color:this._useAccessibleTheme()?this._themeColors.primaryIconColor:_.Color.white,icon:v.SkypeIcon.ContactAdd,title:g.getString("PSTNDialerPanel.PSTNDialerSaveContactButtonLabel"),accessibilityLabel:g.getString("PSTNDialerPanel.PSTNDialerSaveContactButtonLabel"),titleStyle:i,useTrailingIcon:!1,onPress:this._onButtonPress,style:I.buttonStyle}))}_getContentSizeHeight(e){return e*Math.min(this.state.contentSizeMultiplier||1,o.MaxContentSizeMultiplier)}}t.default=P},3764:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(12);class o extends n.default{constructor(){super(...arguments),this._animatedHeight=new a.Animated.Value(0),this._animatedStyles=a.Styles.createAnimatedViewStyle({height:this._animatedHeight})}toggleToCollapsedState(){this._animatedHeight.setValue(this.state.collapsedHeight)}toggleToExpandedState(){this._animatedHeight.setValue(this.state.expandedHeight)}toggleToHiddenState(){this._animatedHeight.setValue(0)}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.expandedHeight!==t.expandedHeight&&this._animatedHeight.setValue(t.expandedHeight)}render(){return this.props.isInLandscape?null:a.createElement(a.Animated.View,{style:this._animatedStyles})}}t.default=o},3765:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(6),o=(i(5),i(205)),s=(i(48),i(9)),r=i(16),l=i(12),c=i(101),d=i(65),u=n.lazyProperties({container:()=>a.Styles.createButtonStyle({flex:0,flexDirection:"row",alignItems:"center",paddingHorizontal:10,paddingVertical:4}),textContainer:()=>a.Styles.createViewStyle({flex:1,marginHorizontal:10}),textStyle:()=>a.Styles.createTextStyle({backgroundColor:s.Color.transparent,color:s.Color.white})});class h extends l.default{_buildState(e,t){return{selectedResult:o.default.getSearchResults().selectedResult}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i)}render(){if(!this.state.selectedResult)return null;const e=!this._useDarkTheme()&&this._useAccessibleTheme();return a.createElement(a.View,{style:u.container},a.createElement(c.default,{key:"selectedContactUserIcon",size:d.UserIconSize.Size40,userMri:this.state.selectedResult.contact.userMri,statusBorderColor:this._themeColors.primaryBackgroundColor}),a.createElement(a.View,{style:u.textContainer},a.createElement(r.RowTitle,{style:e?this._themeStyles.primaryTextColorStyle:u.textStyle,numberOfLines:1},this.state.selectedResult.contact.displayName)))}}t.default=h},377:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(8),n=i(460),o=i(29),s=i(3234),r=i(1138),l=i(5),c=i(72);t.default=new class{showForSkypeMri(e,t,i,a,n,o,s,l,c,d,u,h,p){r.default.showForSkypeMri(e,t,i,a,n,o,s,l,c,d,u,h,p)}showForPhoneNumber(e,t,i,a,n){r.default.showForPhoneNumber(e,t,i,a,n)}showForAddressContact(e,t,i,a,n,o,s,l,c,d){r.default.showForAddressContact(e,t,i,a,n,o,s,l,c,d)}startCallOrMaybePrompt(e,t,i,d,u,h){const p=(e,t)=>o.default.CallNavigationHelper.startCall({conversationMri:e,withVideo:t,origin:i.callOrigin,openInMainWindow:u,view:h},d),g=i=>{const n=[{text:l.getString("CallOrInviteMenu.UnencryptedCallAlertYes"),command:""}],o={anchor:e,buttons:n,positionPriorities:["bottom"],title:i?l.getString("CallOrInviteMenu.UnencryptedVideoCallAlertTitle"):l.getString("CallOrInviteMenu.UnencryptedAudioCallAlertTitle"),message:i?l.getString("CallOrInviteMenu.UnencryptedVideoCallAlertBody"):l.getString("CallOrInviteMenu.UnencryptedAudioCallAlertBody"),cancelButtonTitle:l.getString("CallOrInviteMenu.UnencryptedCallAlertNo"),cancelButtonPosition:c.CancelButtonPosition.End,destructiveButtonIndex:0},s=a.Defer();return c.default.showWithActionMenuConfig({options:o,callback:e=>{e!==c.SXActionMenuCancel?s.resolve(void 0):s.reject()},rootViewId:t,useAlertForDesktop:!0,useAlertForMobile:!1,invokingEvent:void 0}),s.promise()},C=(e,t,a)=>o.default.CallNavigationHelper.answerOrJoinCall({conversationMri:e,callId:t,withVideo:a,origin:i.callOrigin,openInMainWindow:u,view:h},d),m=(e,t,a)=>o.default.CallPreviewUtils.answerOrJoinCall({conversationMri:e,callId:t,withVideo:a,origin:i.callOrigin},d),S=(a,n,o,s,l,c,d,u)=>{r.default.showForSkypeMri(e,t,a,n,o,i.inviteOrigin,i.callOrigin,s,l,c,d,u,i.popupTitleOverride)},y=(a,n,o)=>{r.default.showForAddressContact(e,t,a,i.inviteOrigin,i.callOrigin,n,o,!1)};return n.default.loadCallingBundle().then(()=>s.default.startCallOrMaybePromptHelper(i,p,C,m,S,y,g,d))}}},3781:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(7),o=i(29),s=i(103),r=i(13),l=i(33),c=i(32),d=i(3),u=i(41),h=i(26),p=i(148),g=i(4),C=i(6),m=i(5),S=i(64),y=i(18),f=i(23),_=i(27),b=i(39),v=i(42),w=i(9),T=i(11),I=i(114),P=i(14),M=i(16),k=i(12),A=i(1825),R=i(10),V=C.lazyProperties({container:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",borderTopWidth:1,borderStyle:"solid",backgroundColor:w.Color.whiteOverlay20,justifyContent:"flex-start",alignItems:"center"}),textContent:()=>a.Styles.createTextStyle({flexShrink:1,paddingLeft:10,paddingRight:45,marginVertical:8}),textContentContainer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",flexWrap:"wrap",alignItems:"center"}),textContentContainerMobile:()=>a.Styles.createTextStyle({flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start"}),textContentContainerDeprecateDesktop:()=>a.Styles.createTextStyle({flexWrap:"nowrap"}),textContentDeprecationDesktop:()=>a.Styles.createTextStyle({flexShrink:1,flex:1}),textStyleMobile:()=>a.Styles.createTextStyle({fontSize:12}),buttonsContainer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",marginVertical:8,alignSelf:"center"}),buttonsContainerMobile:()=>a.Styles.createViewStyle({alignSelf:"flex-start"}),iconStyle:()=>a.Styles.createViewStyle({marginVertical:10,marginLeft:20}),closeIconStyle:()=>a.Styles.createViewStyle({marginVertical:10,marginRight:20}),actionButton:()=>a.Styles.createViewStyle({marginHorizontal:10})});class E extends k.default{constructor(){super(...arguments),this._onAcceptRequestPress=()=>{A.default.acceptTranslation(this.props.conversationId,this.state.spokenLanguageLocale)},this._onDeclineRequestPress=()=>{A.default.declineTranslationRequest(this.props.conversationId,this.state.spokenLanguageLocale)},this._onDeprecationAcceptPress=()=>{const e=R.default.newCauseId(),t=this.state.remoteUser.getMri();t?(A.default.requestTranslation(t,this.state.spokenLanguageLocale),y.default.navigateToConversation({convId:t,causeId:e,origin:d.NavigationConversationOrigin.EngagementNotice})):g.log(d.LogTraceArea.Calling,"TranslationConversationBanner._onDeprecationAcceptPress conversationId: "+b.mriOrId(this.props.conversationId)+" causeId: "+e)},this._onLearnMoreLinkPress=e=>{a.Linking.openUrl(n.default.getConfigSettingsNoSubscription().translator.learnMoreUrl)},this._onDismiss=e=>{e.stopPropagation(),this.state.translationState===s.TranslationState.Pending?A.default.declineTranslationRequest(this.props.conversationId,this.state.spokenLanguageLocale):this.state.translationState!==s.TranslationState.Requested&&this.state.translationState!==s.TranslationState.Enabled||S.default.setConversationTranslationBannerDismissState(this.props.conversationId,!0)},this._onSpokenLanguageLinkPress=e=>{e.preventDefault(),o.default.CallNavigationHelper.navigateToTranslationSettingsPanel(!1,this._getRootViewId())}}_buildState(e,t){const i=l.default().getConversation(e.conversationId),a=n.default.getS4LCMCFeatures().translatorAgentId;let o=e.conversationId;return i&&e.isDeprecated&&a&&(o=i.getMemberMrisWithoutMe().filter(e=>e!==a)[0]||o),{isDismissed:S.default.getConversationTranslationBannerDismissState(e.conversationId),isUsingStackNavigationContext:f.default.isUsingStackNavigationContextNoSubscription(),translationState:p.default.getConversationTranslationState(e.conversationId)||s.TranslationState.Disabled,spokenLanguageLocale:p.default.getLocalCallTranslatorBotSpokenLanguageLocale(),isDeviceLanguageSupported:p.default.isDeviceLanguageSupportedForTranslation(),remoteUser:c.default.getDisplayableProfile(o),isSmallScreen:_.default.isWidthSmallerThanThreshold(1024,this._getRootViewId())}}render(){if(this.state.isDismissed||this.state.translationState===s.TranslationState.Disabled&&!this.props.isDeprecated)return null;if(this.state.isDeviceLanguageSupported&&this.state.translationState===s.TranslationState.Enabled)return null;const e=a.createElement(u.default,{style:V.closeIconStyle,hoverColor:this._getIconColor(),color:this._getIconColor(),onPress:this._onDismiss,title:m.getString("Global.CloseButtonTitle"),size:T.IconSize.size24,icon:T.SkypeIcon.Cancel});return a.createElement(a.View,{style:this._getContainerStyles()},this._renderTranslationIcon(),a.createElement(a.View,{style:this._getTextContentContainerStyle()},a.createElement(M.BodyText,{style:this._getTextStyles()},this._getText()),this._renderOptionalActionButtons()),e)}_renderOptionalActionButtons(){const{translationState:e,remoteUser:t}=this.state;return e===s.TranslationState.Pending?a.createElement(a.View,{style:this._getButtonContainerStyle()},a.createElement(v.default,{style:V.actionButton,buttonSize:r.SXButtonSize.Small,buttonStyle:r.SXButtonStyle.ColorFill,title:m.getString("TranslationBanner.AcceptButtonTitle"),onPress:this._onAcceptRequestPress}),a.createElement(v.default,{style:V.actionButton,buttonSize:r.SXButtonSize.Small,buttonStyle:r.SXButtonStyle.LightFill,title:m.getString("TranslationBanner.DeclineButtonTitle"),onPress:this._onDeclineRequestPress})):this.props.isDeprecated?a.createElement(a.View,{style:this._getButtonContainerStyle()},a.createElement(v.default,{style:V.actionButton,buttonSize:r.SXButtonSize.Small,buttonStyle:r.SXButtonStyle.ColorFill,title:m.getString("TranslationBanner.TryNewTranslationsButtonV2",{userName:t.getShortName()}),onPress:this._onDeprecationAcceptPress})):void 0}_getButtonContainerStyle(){return[V.buttonsContainer,void 0,this.props.isDeprecated?P.default.flexZero:void 0]}_getTextContentContainerStyle(){return[V.textContentContainer,void 0,this._isDeprecatedOnWideScreen()?V.textContentContainerDeprecateDesktop:void 0]}_getContainerStyles(){let e=[V.container,this._themeStyles.headerShadowBorderColorStyle];return this._useAccessibleTheme()&&e.push(this._themeStyles.primaryBackgroundColorStyle),e}_renderTranslationIcon(){return a.createElement(h.IconView,{style:V.iconStyle,icon:T.SkypeIcon.SkypeTranslator,color:this._themeColors.primaryIconColor,size:T.IconSize.size24})}_getIconColor(){return this._themeColors.primaryTextColor}_getText(){return this.state.translationState===s.TranslationState.Requested?m.getString("TranslationBanner.RequestSentText",{userName:this.props.conversationName}):this.state.translationState===s.TranslationState.Pending?m.getParts("TranslationBanner.RequestReceivedTextv2",{userName:this.props.conversationName,learnMoreLink:this._getLearnMoreLink()}):this.props.isDeprecated?m.getParts("TranslationBanner.OldBotDeprecationTextV2",{date:this.props.translatorBotDeprecationDate||""}):this.state.isDeviceLanguageSupported||this.state.translationState!==s.TranslationState.Enabled?void 0:m.getParts("UserSettingsPanel.TranslateMessagesAndCallsAppLanguageNotSupportedExplanation",{spokenLanguageLink:this._getLanguageSettingsLink()})}_getLearnMoreLink(){return a.createElement(I.default,{url:"#",key:"keyLearnMore",blue:!0,onPress:this._onLearnMoreLinkPress},m.getString("UserSettingsPanel.TranslationCELAStatementLearnMore"))}_getTextStyles(){return[V.textContent,this._themeStyles.primaryTextColorStyle,void 0,this._isDeprecatedOnWideScreen()?V.textContentDeprecationDesktop:void 0]}_isDeprecatedOnWideScreen(){return!!this.props.isDeprecated&&!this.state.isSmallScreen}_getLanguageSettingsLink(){return a.createElement(I.default,{url:"#",key:"keySpokenLanguage",blue:!0,onPress:this._onSpokenLanguageLinkPress},m.getString("UserSettingsPanel.TranslateMessagesAndCallsAppLanguageNotSupportedSelectLinkText"))}}t.default=E},384:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallButton=t.CallButtonSpacing=t.CallButtonBackgroundStyle=t.CallButtonSize=void 0;const a=i(1),n=i(91),o=i(0),s=i(60),r=i(241),l=i(109),c=i(45),d=i(1225),u=i(3),h=i(41),p=i(4),g=i(6),C=i(9),m=i(20),S=i(24),y=i(11),f=i(14),_=i(10);var b,v,w;!function(e){e[e.ExtraSmall=0]="ExtraSmall",e[e.Small=1]="Small",e[e.Large=2]="Large",e[e.ExtraLarge=3]="ExtraLarge"}(b=t.CallButtonSize||(t.CallButtonSize={})),function(e){e[e.None=0]="None",e[e.Solid=1]="Solid",e[e.Overlay=2]="Overlay"}(v=t.CallButtonBackgroundStyle||(t.CallButtonBackgroundStyle={})),function(e){e[e.Default=0]="Default",e[e.Small=1]="Small",e[e.None=2]="None"}(w=t.CallButtonSpacing||(t.CallButtonSpacing={}));const T=s.CallButtonSizes.callbuttonExtraLargeSize,I=s.CallButtonSizes.callbuttonLargeSize,P=s.CallButtonSizes.callbuttonSmallSize,M=s.CallButtonSizes.callbuttonExtraSmallSize,k=m.default.getPlatformType()===u.PlatformType.iOS,A=g.lazyProperties({buttonSolidBackground:()=>o.Styles.createViewStyle({backgroundColor:C.Color.gray400}),buttonOverlayBackground:()=>o.Styles.createViewStyle({backgroundColor:C.Color.gray400Overlay10}),callingButtonExtraLarge:()=>o.Styles.createViewStyle({width:T,height:T,borderRadius:T/2}),callingButtonLarge:()=>o.Styles.createViewStyle({width:I,height:I,borderRadius:I/2}),callingButtonSmall:()=>o.Styles.createViewStyle({width:P,height:P,borderRadius:P/2}),callingButtonExtraSmall:()=>o.Styles.createViewStyle({width:M,height:M,borderRadius:M/2}),squareButtonExtraLarge:()=>o.Styles.createViewStyle({width:T,height:T,borderRadius:T/4}),squareButtonLarge:()=>o.Styles.createViewStyle({width:I,height:I,borderRadius:I/4}),squareButtonSmall:()=>o.Styles.createViewStyle({width:P,height:P,borderRadius:P/4}),squareButtonExtraSmall:()=>o.Styles.createViewStyle({width:M,height:M,borderRadius:M/4}),startCallButton:()=>o.Styles.createButtonStyle({backgroundColor:k?C.Color.greenIOS:C.Color.green}),endCallButton:()=>o.Styles.createButtonStyle({backgroundColor:k?C.Color.redIOS:C.Color.red}),mergeCallButton:()=>o.Styles.createButtonStyle({backgroundColor:C.Color.gray200}),innerContainer:()=>o.Styles.createViewStyle({justifyContent:"center",alignItems:"center",overflow:"visible"}),innerContainerMargin:()=>o.Styles.createViewStyle({marginHorizontal:10}),smallButtonMargin:()=>o.Styles.createViewStyle({marginHorizontal:5}),noButtonMargin:()=>o.Styles.createViewStyle({marginHorizontal:0}),mergeIconColor:()=>o.Styles.createTextStyle({color:C.Color.black}),selected:()=>o.Styles.createViewStyle({backgroundColor:C.Color.white}),modernChatIconBadge:()=>o.Styles.createViewStyle({height:8,width:8,backgroundColor:C.Color.red,borderRadius:4,position:"absolute",right:7,top:7,justifyContent:"center",alignItems:"center"}),containerWithCaption:()=>o.Styles.createViewStyle({justifyContent:"center"}),buttonWithCaption:()=>o.Styles.createViewStyle({minWidth:80,justifyContent:"center",overflow:"visible"}),caption:()=>o.Styles.createTextStyle({paddingTop:0,textAlign:"center",fontSize:S.default.controlFontSize.caption,paddingHorizontal:10,color:C.Color.white,marginTop:4}),iconButtonWithCaption:()=>o.Styles.createViewStyle({justifyContent:"center"}),mainAndAdditionalImageWrapper:()=>o.Styles.createViewStyle({overflow:"visible"})});class R extends c.default{constructor(){super(...arguments),this._pressed=!1,this._hovered=!1,this._onAnimatedViewRef=e=>{this._animatedView=e||void 0},this._onPressIn=()=>{this._updateButton(!0),this._pressed=!0,this.props.onPressIn&&this.props.onPressIn()},this._onPressOut=()=>{this._pressed&&(this._updateButton(!1),this._pressed=!1),this.props.onPressOut&&this.props.onPressOut()},this._onPress=e=>{e.stopPropagation(),this.props.showToolTip&&d.default.clearToolTip(),this.props.onPress&&this.props.onPress(e)},this._onContentIconButtonRef=e=>{this._contentIconButton=e||void 0},this._onHover=e=>{this._hovered=e;const t=()=>!(!(this.isComponentMounted()&&this.props.showToolTip&&this.props.title&&this._hovered)||o.UserInterface.isNavigatingWithKeyboard());t()?a.delay(()=>{t()&&d.default.showToolTip(()=>this.isComponentMounted()?this:void 0,this._getRootViewId(),t,this.props.title||"")},150):d.default.clearToolTip(),this.props.onHover&&this.props.onHover(e)}}static sizeForCallButtonSize(e){switch(e){case b.ExtraLarge:return T;case b.Large:return I;case b.Small:return P;case b.ExtraSmall:return M}}componentWillUnmount(){super.componentWillUnmount(),this.props.showToolTip&&this._hovered&&d.default.clearToolTip()}componentDidMount(){super.componentDidMount(),this._updateButtonVisibility()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.props.show!==e.show&&this._updateButtonVisibility()}_updateButtonVisibility(){var e,t;void 0!==this.props.show&&(this.props.show?null===(e=this._animatedView)||void 0===e||e.fadeIn():null===(t=this._animatedView)||void 0===t||t.fadeOut())}_updateButton(e){const t=e?.8:1,i=e?.92:1;this._internalUpdateButton(t,i)}_internalUpdateButton(e,t){const i=_.default.newCauseId();p.log(u.LogTraceArea.SXAnimated,"CallButton._internalUpdateButton causeId: "+i),this._animatedView&&this._animatedView.getAnimation({opacity:e,scale:t},i).start()}_renderIconButton(e,t,i,a,n={}){var s;const c=null!=i?i:this.props.colorConfig?a?this.props.colorConfig.selectedIconColor:this.props.colorConfig.iconColor:a?C.Color.gray400:C.Color.white,d=this.props.colorConfig?c:a?C.Color.blackOverlay20:C.Color.whiteOverlay80,u=null===(s=this.props.colorConfig)||void 0===s?void 0:s.showHoverEffect,p=Object.assign(Object.assign({},n),{style:e,hoverColor:d,size:t,title:this.props.showToolTip?void 0:this.props.title,icon:this.props.icon,color:c,onHover:this.props.onHover||this.props.showToolTip?this._onHover:void 0,showHoverEffect:u});return this.props.coachMarkType&&this.props.anchorAccessibilityLabel?this.props.caption?o.createElement(r.default.View,{anchorRef:this._onContentIconButtonRef,coachMarkType:this.props.coachMarkType,anchorAccessibilityLabel:this.props.anchorAccessibilityLabel,onAnchorPress:this.props.onAnchorPress,positions:[l.PopupAnchorPositon.Top],key:this.props.coachMarkType},o.createElement(h.default,Object.assign({},p))):o.createElement(r.default.IconButton,Object.assign({anchorRef:this._onContentIconButtonRef},p,{coachMarkType:this.props.coachMarkType,anchorAccessibilityLabel:this.props.anchorAccessibilityLabel,onAnchorPress:this.props.onAnchorPress,positions:[l.PopupAnchorPositon.Top],key:this.props.coachMarkType})):o.createElement(h.default,Object.assign({ref:this._onContentIconButtonRef},p))}requestFocus(){this._contentIconButton&&this._contentIconButton.requestFocus()}render(){var e,t;const i=[f.default.overflowVisible,f.default.noncollapsibleView,f.default.alignItemsCenter,this.props.style],a=this.props.isToggledOn||this.props.colorConfig&&(this.props.isCallEndButton||this.props.isCallStartButton||this.props.isCallMergeButton),s=this._getIconButtonStylesBySize(),r=[s,this._getIconButtonBackgroundStyle(),a?this._getIconButtonToggledBackgroundStyle():void 0],l=[s,A.innerContainer,this.props.doNotAddHorizontalMargin?void 0:A.innerContainerMargin,this._getSpacing()];this.props.colorConfig?this.props.colorConfig.borderColor&&l.push(o.Styles.createViewStyle({borderColor:this.props.colorConfig.borderColor,borderWidth:null!==(e=this.props.borderWidth)&&void 0!==e?e:1},!1)):(this.props.isCallEndButton&&r.push(A.endCallButton),this.props.isCallStartButton&&r.push(A.startCallButton),this.props.isCallMergeButton&&r.push(A.mergeCallButton)),this.props.caption&&(r.push(A.iconButtonWithCaption),i.push(A.containerWithCaption));const c=this._getIconBySize();let d;this.props.isBadgeOn&&(d=o.createElement(o.View,{style:A.modernChatIconBadge}));const u=this._getDefaultButtonProps(),h=null===(t=this.props.colorConfig)||void 0===t?void 0:t.showHoverEffect;let p=o.createElement(n.View,{ref:this._onAnimatedViewRef,style:i},o.createElement(o.View,{onMouseLeave:this._onPressOut,style:A.mainAndAdditionalImageWrapper},o.createElement(o.View,{style:l},this._renderIconButton(r,c,this.props.isCallMergeButton?C.Color.black:void 0,!!a,!this.props.caption||h?u:void 0),d),this.props.additionalImage),this._getOptionalCaption());return this.props.caption&&(p=o.createElement(o.Button,Object.assign({},u,{importantForAccessibility:o.Types.ImportantForAccessibility.Yes,style:A.buttonWithCaption}),p)),p}_getOptionalCaption(){if(!this.props.caption)return;const e=[A.caption,...this.props.colorConfig&&this.props.colorConfig.captionColor?[{color:this.props.colorConfig.captionColor}]:[]];return o.createElement(o.Text,{style:e},this.props.caption)}_getDefaultButtonProps(){return{onPress:this._onPress,onPressIn:this._onPressIn,onPressOut:this._onPressOut,onLongPress:this.props.onLongPress,onContextMenu:this.props.onContextMenu,disabled:this.props.isDisabled,disableTouchOpacityAnimation:!0,accessibilityLabel:this.props.accessibilityLabel,importantForAccessibility:this.props.importantForAccessibility}}_getIconButtonStylesBySize(){let e;switch(this.props.size){case b.ExtraSmall:e=this.props.isSquareButton?A.squareButtonExtraSmall:A.callingButtonExtraSmall;break;case b.Small:e=this.props.isSquareButton?A.squareButtonSmall:A.callingButtonSmall;break;case b.Large:e=this.props.isSquareButton?A.squareButtonLarge:A.callingButtonLarge;break;case b.ExtraLarge:e=this.props.isSquareButton?A.squareButtonExtraLarge:A.callingButtonExtraLarge}return e}_getIconButtonBackgroundStyle(){return this.props.colorConfig?o.Styles.createViewStyle({backgroundColor:this.props.colorConfig.backgroundColor},!1):this.props.backgroundStyle===v.Solid?A.buttonSolidBackground:this.props.backgroundStyle===v.Overlay?A.buttonOverlayBackground:void 0}_getIconButtonToggledBackgroundStyle(){return this.props.colorConfig?o.Styles.createViewStyle({backgroundColor:this.props.colorConfig.selectedBackgroundColor},!1):A.selected}_getIconBySize(){switch(this.props.size){case b.ExtraSmall:return y.IconSize.size16;case b.Small:return y.IconSize.size20;case b.Large:return y.IconSize.size24;case b.ExtraLarge:return y.IconSize.size28}}_getSpacing(){let e;switch(this.props.spacing){case w.Small:e=A.smallButtonMargin;break;case w.None:e=A.noButtonMargin}return e}}t.CallButton=R,t.default=R},3851:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(3852),o=i(1238),s=i(3853);class r extends o.LayoutExperiment{constructor(e){super(e,"DialpadBar")}_getOptionFromConf(){return"revert"}render(){const e=this._getLayoutToDisplay();if(e)return a.createElement(n.default,Object.assign({layoutComponent:e,experimentSettings:this._getExperimentSettings()},this.props));if(this.props.defaultComponent){const e=this.props.defaultComponent;return a.createElement(e,Object.assign({experimentSettings:this._getExperimentSettings()},this.props))}return null}_getLayoutToDisplay(){return s.default}}t.default=r},3852:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(15),o=i(7),s=i(173);class r extends n.ComponentBase{_buildState(e,t){const i=o.default.getS4LEntitlementFeatures().SCE.UserServices.Client.Features.DarkerDialerBarEnabled;return{onPress:e.onPress,enableDarkerColors:i,disableHighBandwidthOperations:s.default.isUsingGogoNetwork()}}render(){const e=this.props.layoutComponent;return a.createElement(e,{experimentSettings:this.props.experimentSettings,onPress:this.state.onPress,onCallButtonPress:this.props.onCallButtonPress,enableDarkerColors:this.state.enableDarkerColors,disabled:this.state.disableHighBandwidthOperations})}}t.default=r},3853:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});i(35);const a=i(116),n=i(0),o=i(26),s=i(901),r=i(6),l=i(5),c=i(52),d=i(27),u=i(264),h=i(9),p=i(11),g=(i(56),i(16)),C=i(12),m=r.lazyProperties({container:()=>n.Styles.createViewStyle({flexDirection:"row",flex:1,paddingVertical:12,justifyContent:"center",bottom:0}),buttonContainer:()=>n.Styles.createViewStyle({alignItems:"center",flex:1,flexGrow:0,flexDirection:"row",height:50,borderRadius:28}),actionButtonStyle:()=>n.Styles.createViewStyle({flex:1,alignItems:"center",flexDirection:"row",borderRadius:20,paddingHorizontal:20}),buttonText:()=>n.Styles.createTextStyle({color:h.Color.white,flex:0,maxWidth:180}),addToCallMargins:()=>n.Styles.createViewStyle({marginLeft:6,marginRight:3}),dialpadMargin:()=>n.Styles.createViewStyle({marginRight:6}),dialpadMarginMulti:()=>n.Styles.createViewStyle({marginLeft:3})});class S extends C.default{constructor(){super(...arguments),this._callButtonLabelName="QuickCallPanel.SkypeCallLabel",this._onPress=()=>{this.props.onPress&&this.props.experimentSettings&&(s.default.registerDialerButtonClickAction(this.props.experimentSettings),this.props.onPress())},this._onCallButtonPress=e=>{this.props.onCallButtonPress&&this.props.experimentSettings&&(s.default.registerCallButtonClickAction(this.props.experimentSettings),this.props.onCallButtonPress(e))},this._onLayout=e=>{this.isComponentMounted()&&this._useLayoutWidth()&&this.setState({width:e.width})}}_buildState(e,t){const i=this._getRootViewId();return{orientation:d.default.getDeviceOrientation(i),useIOSLandscapeStyles:!1,width:this._useLayoutWidth()?void 0:this._getContext().isPresentedInDesktopLeftNav?u.default.getWidth():d.default.getWidth(i),gradientColors:c.default.getGradientColors(),primaryColor:c.default.getPrimaryColor()}}componentDidMount(){super.componentDidMount(),this.props.experimentSettings&&s.default.registerOpenAction(this.props.experimentSettings)}render(){const e=this._useAccessibleTheme()?this._themeColors.primaryIconColor:this.state.primaryColor,t=n.Styles.createViewStyle({borderColor:e,borderWidth:2,backgroundColor:this._themeColors.primaryBackgroundColor},!1),i=n.Styles.createTextStyle({color:e},!1);let s,r;const c=this._isPresentedInDesktopLeftNav()?1:2;if(this.state.width){const e=this.state.width-(this.state.useIOSLandscapeStyles?60:0);s=n.Styles.createViewStyle({position:"absolute",width:this.state.width,paddingHorizontal:this.state.useIOSLandscapeStyles?20:void 0},!1),r=n.Styles.createViewStyle({width:.9*e/c},!1)}const d=this._isPresentedInDesktopLeftNav()?void 0:n.createElement(n.View,{key:"AddCallButton",style:[m.buttonContainer,t,r,m.addToCallMargins]},n.createElement(n.Button,{style:[m.actionButtonStyle,r],onPress:this._onCallButtonPress,accessibilityLabel:l.getString("QuickCallPanel.PanelHeaderNewCall"),disabled:this.props.disabled},n.createElement(o.default,{icon:p.SkypeIcon.CallAdd,color:e,size:p.IconSize.size24}),n.createElement(g.BodyText,{bold:!0,style:[m.buttonText,i],allowFontScaling:!1},l.getString(this._callButtonLabelName)))),u=this._useAccessibleTheme()?n.Styles.createTextStyle({color:this._themeColors.primaryBackgroundColor},!1):void 0,h=n.createElement(n.Button,{key:"DialpadButton",style:[m.actionButtonStyle,r],onPress:this._onPress,accessibilityLabel:l.getString("QuickCallPanel.DialpadButtonAccessibilityLabel"),disabled:this.props.disabled},n.createElement(o.default,{icon:p.SkypeIcon.Dialpad,color:this._themeColors.primaryBackgroundColor,size:p.IconSize.size24}),n.createElement(g.BodyText,{bold:!0,style:[m.buttonText,u],allowFontScaling:!1},l.getString("QuickCallPanel.DialpadButtonLabelShort"))),C=[m.dialpadMargin,c>1?m.dialpadMarginMulti:void 0];let S;if(this._useAccessibleTheme()){const e=[m.buttonContainer,r,C,n.Styles.createViewStyle({backgroundColor:this._themeColors.primaryIconColor},!1)];S=n.createElement(n.View,{key:"Container_View",style:e},h)}else S=n.createElement(a.GradientView,{key:"Gradient_View",style:[m.buttonContainer,r,C],colors:this.state.gradientColors,direction:a.GradientDirection.BOTTOM_RIGHT},h);return n.createElement(n.View,{style:[m.container,s],onLayout:this._useLayoutWidth()?this._onLayout:void 0},d,S)}_useLayoutWidth(){return!0}}t.default=S},3854:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QuickCallPanelMenuItemCommand=t.QuickCallPanelFilter=void 0,function(e){e[e.All=0]="All",e[e.Skype=1]="Skype",e[e.Phone=2]="Phone"}(t.QuickCallPanelFilter||(t.QuickCallPanelFilter={})),t.QuickCallPanelMenuItemCommand={all:"all",skype:"skype",phone:"phone"}},3855:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(7),o=i(1238),s=i(3856),r=i(3857);class l extends o.LayoutExperiment{constructor(e){super(e,"SkypeToPhoneBanner")}_getOptionFromConf(){return n.default.getS4LEntitlementFeatures().SCE.UserServices.Client.Experiments.SkypeToPhoneBanner}render(){return a.createElement(r.default,Object.assign({layoutComponent:s.default,experimentSettings:this._getExperimentSettings()},this.props))}}t.default=l},3856:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LayoutOptionDefault=void 0;const a=i(0),n=i(7),o=i(13),s=i(510),r=i(67),l=i(3),c=i(472),d=i(41),u=i(901),h=i(6),p=i(5),g=i(99),C=i(30),m=i(162),S=i(18),y=i(68),f=i(124),_=i(42),b=i(9),v=i(20),w=i(11),T=i(16),I=i(12);var P,M;!function(e){e[e.GetFreeTrial=0]="GetFreeTrial",e[e.GetCredit=1]="GetCredit",e[e.GetSubscription=2]="GetSubscription"}(P||(P={})),function(e){e[e.SkypeToPhone=0]="SkypeToPhone",e[e.Credit=1]="Credit",e[e.Subscription=2]="Subscription"}(M||(M={}));const k=h.lazyProperties({container:()=>a.Styles.createViewStyle({flex:0,minHeight:80,paddingVertical:15,paddingLeft:10,paddingRight:6,flexDirection:"row",alignItems:"flex-start",justifyContent:"space-between"}),buttonContainer:()=>a.Styles.createViewStyle({flex:0,alignSelf:"flex-start",paddingTop:18,paddingLeft:5}),buttonContainerPadding:()=>a.Styles.createViewStyle({paddingRight:10}),buttonContainerBroad:()=>a.Styles.createViewStyle({flex:0,alignSelf:"flex-end",paddingTop:5}),bannerContainer:()=>a.Styles.createViewStyle({alignItems:"stretch",justifyContent:"space-between",backgroundColor:b.Color.transparent}),closeIconContainer:()=>a.Styles.createViewStyle({position:"absolute",top:12,right:6}),textContainer:()=>a.Styles.createViewStyle({flex:1,marginLeft:10,justifyContent:"space-between",alignItems:"flex-start"}),bodyStyle:()=>a.Styles.createTextStyle({flex:1,lineHeight:22}),caption:()=>a.Styles.createTextStyle({flex:1,lineHeight:16})}),A={skypeToPhone:{icon:[{icon:w.SkypeIcon.GlobeCredit,color:b.Color.yellow},{icon:w.SkypeIcon.CreditGlobe,color:b.Color.blue}],buttonType:P.GetCredit,labelType:M.SkypeToPhone},credit:{icon:[{icon:w.SkypeIcon.GlobeCredit,color:b.Color.yellow},{icon:w.SkypeIcon.CreditGlobe,color:b.Color.blue}],buttonType:P.GetCredit,labelType:M.Credit},subscription:{icon:[{icon:w.SkypeIcon.Globe,color:b.Color.blue}],buttonType:P.GetSubscription,labelType:M.Subscription},freeTrial:{icon:[{icon:w.SkypeIcon.GlobeCredit,color:b.Color.yellow},{icon:w.SkypeIcon.CreditGlobe,color:b.Color.blue}],buttonType:P.GetFreeTrial,labelType:M.SkypeToPhone}};class R extends I.default{constructor(){super(...arguments),this._appVersion=v.default.getAppVersion(),this._telemetrySent=!1,this._renderActionButton=(e,t)=>t?this._renderButton(P.GetFreeTrial):"credit_only"===e?this._renderButton(P.GetSubscription):this._renderButton(P.GetCredit),this._renderButton=e=>{let t="";const i={textColor:b.Color.white,backgroundColor:this._themeColors.buttonBackgroundColor};switch(e){case P.GetFreeTrial:i.backgroundColor=b.Color.green,t=p.getString("SkypeToPhonePanel.GetFreeTrialButton");break;case P.GetCredit:i.backgroundColor=b.Color.orange,t=p.getString("SkypeToPhonePanel.GetCreditButton");break;case P.GetSubscription:i.backgroundColor=b.Color.blue,t=p.getString("SkypeToPhonePanel.GetSubscriptionButton")}if(this._useAccessibleTheme()){const e=this._useDarkTheme();i.backgroundColor=e?b.Color.white:b.Color.black,i.textColor=e?b.Color.black:b.Color.white}let n=this.state.isCompactView?[k.buttonContainer,k.buttonContainerPadding]:k.buttonContainer;return t.length>16&&!this.state.isCompactView&&(n=k.buttonContainerBroad),{button:a.createElement(_.default,{key:"banner_content_button",style:n,backgroundStyle:{paddingLeft:10,paddingRight:10},title:t,onPress:this._onProceedButtonPress,buttonStyle:o.SXButtonStyle.Custom,buttonSize:o.SXButtonSize.Small,buttonConfig:i}),titleLength:t.length}},this._onProceedButtonPress=e=>{let t;e.stopPropagation(),this.props.experimentSettings&&(u.default.registerBalanceStateButtonClickAction(this.props.experimentSettings,this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable),t=c.ExperimentLocation[this.props.experimentSettings.location]),S.default.navigateToBalanceStatePanel(t||"SkypeToPhoneBanner.Generic",this._getRootViewId(),void 0,"credit_only"===this.props.userEntitlementsSummary?l.BalanceStatePanelSection.Subscriptions:void 0)},this._getBannerTheme=(e,t)=>t?A.freeTrial:"credit_only"===e?A.subscription:"none"===e?A.skypeToPhone:A.credit,this._onPressClose=()=>{this.props.experimentSettings&&u.default.registerCloseButtonClickAction(this.props.experimentSettings,this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable),C.default.setUserPreferencesLocal({entitlementsBannerOptions:{visible:!1,closedForClientVersion:this._appVersion}}),this.props.onClose()}}_buildState(e,t){const i=C.default.getUserPreferencesLocal().entitlementsBannerOptions,a=i&&(i.visible||i.closedForClientVersion!==this._appVersion),o=n.default.getS4LEntitlementFeatures().SCE.SkypeToPhoneBanner.Features.BannerEnabled,s=n.default.getS4LEntitlementFeatures().SCE.SkypeToPhoneBanner.Features.ForceShowBanner;return{isEntitlementsBannerVisible:a&&(o||s)||"both"!==e.userEntitlementsSummary&&s,isCompactView:y.default.isSplitNavStackCollapsed(f.StackNavigatorId.DesktopContent),modernizeConversationList:g.default.canModernizeConversationList()}}_sendTelemetry(){this.props.experimentSettings&&this.state.isEntitlementsBannerVisible&&!this._telemetrySent&&(u.default.registerOpenAction(this.props.experimentSettings,this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable),this._telemetrySent=!0)}componentDidMount(){super.componentDidMount(),this._sendTelemetry()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this._sendTelemetry()}render(){if(!this.state.isEntitlementsBannerVisible)return null;let e,t=this._getBannerTheme(this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable),i=p.getString("SkypeToPhonePanel.CallPhonesSendSMS");switch(t.labelType){case M.Subscription:i=p.getString("SkypeToPhonePanel.SaveMoreText"),e=p.getString("SkypeToPhonePanel.Subscriptions");break;case M.Credit:e=p.getString("ProfileCard.SkypeCreditsLabel");break;case M.SkypeToPhone:e=p.getString("Entitlements.SkypeToPhoneTitle")}const n=a.createElement(s.default,{iconSize:this.props.useCompactLayout?w.IconSize.size24:w.IconSize.size40,icons:t.icon}),o=this._renderActionButton(this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable),l=this.state.isCompactView||o.titleLength<17?[a.createElement(a.View,{style:k.textContainer,key:"text_section"},a.createElement(T.Caption,{style:k.caption},e),a.createElement(T.BodyText,{style:k.bodyStyle,size:this.props.useCompactLayout?T.BodyTextSize.SmallDeprecated:void 0},i)),o.button]:a.createElement(a.View,{style:k.textContainer},a.createElement(T.Caption,{style:k.caption},e),a.createElement(T.BodyText,{style:k.bodyStyle},i),o.button),c=a.createElement(d.default,{style:k.closeIconContainer,size:w.IconSize.size14,color:this._themeColors.secondaryTextColor,hoverColor:this._themeColors.iconHoverColor,onPress:this._onPressClose,icon:w.SkypeIcon.ClosePanel,title:p.getString("Global.CloseButtonTitle")}),u=this.state.modernizeConversationList?m.default.getBannerBackgroundColorStyle(this._useDarkTheme(),this._useAccessibleTheme(),this._themeStyles):this._themeStyles.secondaryBackgroundColorStyle;return a.createElement(a.View,{style:k.bannerContainer},a.createElement(r.default,null),a.createElement(a.View,{style:[k.container,u]},n,l),c)}}t.LayoutOptionDefault=R,t.default=R},3857:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(0),o=i(15),s=i(221),r=i(134),l=(i(284),i(227)),c=i(222);class d extends o.ComponentBase{_buildState(e,t){const i=r.default.getSubscriptions(),n=r.default.getCreditEntitlement(),o=l.default.getLoadedPersonalizedRecommendations();return{userEntitlementsSummary:s.getEntitlementCombination(n,i),isFreeTrialAvailable:o&&a.some(o.callingOffers,e=>e.isFreeTrial),shouldUseGPlayBilling:c.default.shouldUseGooglePlayBillingForCredit()||c.default.shouldUseGooglePlayBillingForSubscriptions()}}componentDidMount(){super.componentDidMount(),this.state.shouldUseGPlayBilling?c.default.requestUpdate():l.default.requestPersonalizedRecommendationsUpdate()}render(){const e=this.props.layoutComponent;return n.createElement(e,{experimentSettings:this.props.experimentSettings,userEntitlementsSummary:this.state.userEntitlementsSummary,isFreeTrialAvailable:this.state.isFreeTrialAvailable,useCompactLayout:this.props.useCompactLayout,onClose:this.props.onClose})}}t.default=d},3972:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(1797),o=i(29),s=i(123),r=i(913),l=i(13),c=i(193),d=i(3),u=i(4),h=i(6),p=i(9),g=i(14),C=i(12),m=h.lazyProperties({container:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"space-between",paddingHorizontal:20,paddingVertical:l.CompositeNotificationToastInfo.vertical}),metadataContainer:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center",marginVertical:3}),notificationTextStyle:()=>a.Styles.createTextStyle({flex:-1,wordBreak:"break-word",paddingRight:5}),linkStyle:()=>a.Styles.createTextStyle({flex:1,wordBreak:"break-word",color:p.Color.blue})});class S extends C.default{_buildState(e,t){const i={};let a=c.default.getToast(e.toastId);if(a&&a.state){const e=a.state,t=e.callId;i.callId=t,i.callState=o.default.CallingStore.getCallState(t),i.audioOnlyEnabled=o.default.CallingStore.isAudioOnly(t),i.callNetworkQualityPoor=r.default().isCallQualityPoor(t),i.conversationMri=e.conversationMri}return i}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=this.state.callState&&s.default.isCallStateActive(this.state.callState)&&!s.default.isCallStateOnHold(this.state.callState);(this.state.audioOnlyEnabled||this.state.callNetworkQualityPoor)&&a||(u.log(d.LogTraceArea.CallingUI,"CompositeCallConnectionQualityToast.componentDidUpdate removing toast"),c.default.removeToast(this.props.toastId))}render(){return a.createElement(a.View,{style:m.container},a.createElement(n.default,{callId:this.state.callId,conversationMri:this.state.conversationMri,containerStyle:[m.metadataContainer,g.default.flexNegativeOne],iconColor:this._themeColors.headerIconColor,textStyle:[m.notificationTextStyle,this._themeStyles.headerTextColorStyle],linkStyle:m.linkStyle}))}}t.default=S},3973:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalCompositeCallMediaCapturerToast=t.RemoteCompositeCallMediaCapturerToast=void 0;const a=i(0),n=i(15),o=i(74),s=i(29),r=i(123),l=i(193),c=i(512),d=i(1922),u=i(12);class h extends u.default{constructor(){super(...arguments),this._shouldToastBeRemoved=e=>!this.state.callId||e!==o.CallState.Connected||!this.state.initiatorMri||!s.default.CallingStore.isCallMediaCaptured(this.state.callId,this.state.initiatorMri)}_buildState(e,t){const i=l.default.getToast(e.toastId);let a,n;if(i&&i.state){let e=i.state;n=e.callId,a=e.initiatorMri}return{initiatorMri:a,callId:n}}render(){return a.createElement(d.RemotePrivacyToastComponent,{id:this.props.toastId,colorThemeOverride:this.props.colorThemeOverride,notificationTextPath:"CallMediaCapturerToast.NotificationText",startedAccessibilityLabelTextPath:"CallMediaCapturerToast.StartedAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallMediaCapturerToast.StoppedAccessibilityLabel",initiatorMri:this.state.initiatorMri,shouldToastBeRemoved:this._shouldToastBeRemoved})}}t.RemoteCompositeCallMediaCapturerToast=h;class p extends n.ComponentBase{constructor(){super(...arguments),this._getTimeStamp=()=>{},this._onStopPress=(e,t)=>{c.default.setNdiEnabled(!1)},this._shouldToastBeRemoved=e=>{const t=r.default.isCallStateActive(e)&&!r.default.isCallStateOnHold(e);return!c.default.isNdiEnabled()||!t}}render(){return a.createElement(d.LocalPrivacyToastComponent,{id:this.props.toastId,colorThemeOverride:this.props.colorThemeOverride,stopLinkTextPath:"CallMediaCapturerToast.StopLinkText",privacyStatementTextPath:"CallMediaCapturerToast.PrivacyStatementText",morePrivacyInfoLinkTextPath:"CallMediaCapturerToast.MorePrivacyInfoLinkText",startedAccessibilityLabelTextPath:"CallMediaCapturerToast.StartedInitiatorAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallMediaCapturerToast.StoppedInitiatorAccessibilityLabel",shouldToastBeRemoved:this._shouldToastBeRemoved,onStopPress:this._onStopPress,getTimestamp:this._getTimeStamp})}}t.LocalCompositeCallMediaCapturerToast=p},3974:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(29),o=i(123),s=i(193),r=i(1922),l=i(12);class c extends l.default{constructor(){super(...arguments),this._onStopPress=(e,t)=>{n.default.InCallBotService.stopRecording(e,t)},this._getTimeStamp=()=>n.default.CallingStore.getCallRecordingTimestamp(this.state.callId),this._shouldLocalToastBeRemoved=e=>!this.state.callId||!n.default.CallingStore.isRecording(this.state.callId)||!o.default.isCallStateActive(e),this._shouldRemoteToastBeRemoved=()=>!n.default.CallingStore.isRecording(this.state.callId)}_buildState(e,t){let i=s.default.getToast(e.toastId);if(i&&i.state){const e=i.state.callId,t=this.state&&this.state.initiatorMri?this.state.initiatorMri:n.default.CallingStore.getCallRecordingInitiator(e);return{initiatorMri:t,callId:e,isLocalInitiator:n.default.InCallBotUtils.isCallRecordingInitiator(t)}}return{}}render(){return this.state.initiatorMri&&this.state.isLocalInitiator?a.createElement(r.LocalPrivacyToastComponent,{id:this.props.toastId,colorThemeOverride:this.props.colorThemeOverride,stopLinkTextPath:"CallRecorderToast.StopRecordingLinkText",privacyStatementTextPath:"CallRecorderToast.PrivacyStatementText",morePrivacyInfoLinkTextPath:"CallRecorderToast.RecordingInitiatorMorePrivacyInfoLinkText",startedAccessibilityLabelTextPath:"CallRecorderToast.StartedRecordingInitiatorAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallRecorderToast.StoppedRecordingInitiatorAccessibilityLable",shouldToastBeRemoved:this._shouldLocalToastBeRemoved,onStopPress:this._onStopPress,getTimestamp:this._getTimeStamp}):a.createElement(r.RemotePrivacyToastComponent,{id:this.props.toastId,colorThemeOverride:this.props.colorThemeOverride,notificationTextPath:"CallRecorderToast.IsRecordingText",initialNotificationTextPath:"CallRecorderToast.StartingRecordingText",startedAccessibilityLabelTextPath:"CallRecorderToast.StartedRecordingAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallRecorderToast.StoppedRecordingAccessibilityLabel",initiatorMri:this.state.initiatorMri,shouldToastBeRemoved:this._shouldRemoteToastBeRemoved})}}t.default=c},3975:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(29),o=i(123),s=i(60),r=i(1800),l=i(193),c=i(12);class d extends c.default{constructor(){super(...arguments),this._closeToast=e=>{l.default.removeToast(this.props.toastId,e)}}_buildState(e,t){let i=l.default.getToast(e.toastId);if(i&&i.state){const e=i.state.callId;return{callId:e,callState:n.default.CallingStore.getCallState(e)}}return{}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),!!this.state.callState&&o.default.isCallStateActive(this.state.callState)||this._closeToast(s.ToastActionType.AutoDismissed)}render(){return a.createElement(r.default,{closeToast:this._closeToast,colorThemeOverride:this.props.colorThemeOverride})}}t.default=d},3976:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(29),o=i(123),s=i(60),r=i(13),l=i(193),c=i(3),d=i(1801),u=i(4),h=i(6),p=i(11),g=i(12),C=h.lazyProperties({metadataContainer:()=>a.Styles.createViewStyle({paddingHorizontal:r.CompositeNotificationToastInfo.horizontal}),notificationTextStyle:()=>a.Styles.createTextStyle({flex:-1,wordBreak:"break-word"})});class m extends g.default{constructor(){super(...arguments),this._dismiss=e=>{u.log(c.LogTraceArea.CallingUI,"CompositeGeneralPurposeInCallToast._dismiss type: "+this.props.toastType),l.default.removeToast(this.props.toastId,e),this.props.onDismiss&&e===s.ToastActionType.ManualDismissed&&this.props.onDismiss()},this._onManualDismiss=()=>{this._dismiss(s.ToastActionType.ManualDismissed)}}_buildState(e,t){const i=l.default.getToast(e.toastId);if(i&&i.state){const e=i.state,t=e.callId,a=e.conversationMri;return{callState:n.default.CallingStore.getCallState(t),conversationMri:a}}return{}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),!!this.state.callState&&o.default.isCallStateActive(this.state.callState)||this._dismiss(s.ToastActionType.AutoDismissed)}render(){return a.createElement(d.default,{toastType:this.props.toastType,containerStyle:C.metadataContainer,textStyle:[C.notificationTextStyle,this._themeStyles.headerTextColorStyle],onDismiss:this._onManualDismiss,conversationMri:this.state.conversationMri,iconColor:this._themeColors.headerIconColor,iconSize:p.IconSize.size20})}}t.default=m},3977:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(15),o=i(384),s=i(29),r=i(110),l=i(53),c=i(17),d=i(13),u=i(193),h=i(286),p=i(32),g=i(3),C=i(86),m=i(1795),S=i(4),y=i(125),f=i(6),_=i(5),b=i(14),v=i(209),w=i(16),T=i(100),I=i(95),P=i(65),M=f.lazyProperties({container:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"space-between",paddingHorizontal:d.CompositeNotificationToastInfo.horizontal,paddingVertical:d.CompositeNotificationToastInfo.vertical}),metadataContainer:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center",marginVertical:3}),userIcon:()=>a.Styles.createViewStyle({marginRight:10}),callButtonsContainer:()=>a.Styles.createViewStyle({justifyContent:"center"})});class k extends n.ComponentBase{constructor(){super(...arguments),this._onComponentRef=e=>{this._view=e||void 0},this._getIncomingCallStrings=()=>{let e;e=this.state.isEncrypted?{message:_.getString("CallBanner.IncomingCallEncryptedCaption"),accessibilityLabel:_.getString("CallBanner.IncomingCallEncryptedAccessibilityLabel",{callerName:this.state.callerDisplayName})}:c.isGroupConversation(this.state.conversationMri)?{message:_.getString("CallBanner.IncomingCallGroupCaption",{callerName:this.state.callerDisplayName}),accessibilityLabel:_.getString("CallBanner.IncomingCallGroupAccessibilityLabel",{groupName:this.state.conversationDisplayName,callerName:this.state.callerDisplayName})}:{message:_.getString("CallBanner.IncomingCallOneOnOneCaption"),accessibilityLabel:_.getString("CallBanner.IncomingCallOneOnOneAccessibilityLabel",{callerName:this.state.callerDisplayName})};{const t=y.default.shortcutListItemForShortcut(g.KeyboardShortcut.AcceptIncomingCall),i=y.default.shortcutListItemForShortcut(g.KeyboardShortcut.HangupOrRejectCall);if(t&&i){const a=_.getString("CallBanner.KeyboardShortcutAccessibilityLabel",{acceptCall:t.command,rejectCall:i.accessibleCommand});e.accessibilityLabel=_.getString("CallBanner.IncomingCallAccessibilityLabelWithKeyboardShortcut",{incomingCall:e.accessibilityLabel,keyboardShortcut:a})}}return e}}_buildState(e){const t=u.default.getToast(e.id);if(t){let e;const i=r.default.useHighContrastThemeAndChanges();e=I.default.useDarkTheme()?i?T.Theme.Accessible:T.Theme.Colorful:i?T.Theme.AccessibleDark:T.Theme.ColorfulDark;const a=s.default.CallingStore.getConnectedAndNotOnHoldCallId(),n=t.state,o=s.default.CallingStore.isEncryptedCall(n.callId),c=s.default.CallingStore.isPSTNCall(n.callId),d=s.default.CallingFeaturesHelper.allowMergeCall({isEncryptedCall:o,isPSTNCall:c,conversationMri:n.conversationMri,callId:n.callId,connectedCallId:a});return{callId:n.callId,conversationMri:n.conversationMri,callerMri:n.callerMri,isCallIncoming:s.default.CallingStore.isCallIncoming(n.callId),callerDisplayName:p.default.getDisplayName(n.callerMri),conversationDisplayName:p.default.getDisplayName(n.conversationMri),connectedToAnotherCall:!!a&&a!==n.callId,themeOverride:e,isEncrypted:o,isPSTN:c,hasAnsweredCallLocally:s.default.CallingStore.hasAnsweredCallLocally(n.callId),callDidExist:s.default.CallingStore.callDidExist(n.callId),isMergePossible:d,callMergeSupported:l.CallingCapabilities.callMergeSupported()}}return{}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this._shouldIgnore()&&(S.log(g.LogTraceArea.CallingUI,"CompositeIncomingRingToast.componentDidUpdate removing toast for callId: "+this.state.callId),u.default.removeToast(this.props.id))}componentDidMount(){super.componentDidMount(),this._shouldIgnore()&&(S.log(g.LogTraceArea.CallingUI,"CompositeIncomingRingToast.componentDidMount removing toast for callId: "+this.state.callId),u.default.removeToast(this.props.id)),this._view&&this._view.requestFocus(),this.state.connectedToAnotherCall&&a.Accessibility.announceForAccessibility(this.state.isMergePossible?_.getString("CallBanner.IncomingCallMergeCallWarning"):_.getString("CallBanner.IncomingCallMultiCallWarning"))}_shouldIgnore(){return!this.state.isCallIncoming||this.state.hasAnsweredCallLocally||this.state.callDidExist}renderCallControls(){return a.createElement(m.default,{conversationMri:this.state.conversationMri,callId:this.state.callId,forMobile:!1,isEncryptedCall:!!this.state.isEncrypted,isPSTNCall:!!this.state.isPSTN,buttonSize:o.CallButtonSize.Small,colorThemeOverride:this.state.themeOverride,showMergeButton:this.state.connectedToAnotherCall&&this.state.callMergeSupported,isMergePossible:this.state.isMergePossible})}render(){if(this._shouldIgnore())return null;const e=v.default.themeStylesForTheme(this.state.themeOverride),t=this.state.isMergePossible?_.getString("CallBanner.IncomingCallMergeCallWarning"):_.getString("CallBanner.IncomingCallMultiCallWarning"),i=this.state.connectedToAnotherCall?a.createElement(w.Caption,{style:e.headerTextColorStyle},t):void 0,n=this._getIncomingCallStrings();return a.createElement(a.View,{style:[M.container,e.buttonBackgroundColorStyle],ref:this._onComponentRef,tabIndex:0,accessibilityLabel:n.accessibilityLabel},a.createElement(a.View,{style:[M.metadataContainer,b.default.flexNegativeOne]},a.createElement(C.default,{style:M.userIcon},a.createElement(h.default,{size:P.ConversationIconSize.Size40,conversationId:this.state.conversationMri})),a.createElement(a.View,{style:b.default.flexNegativeOne},a.createElement(w.BodyText,{bold:!0,style:[b.default.flexNegativeOne,e.primaryTextColorStyle],numberOfLines:1},this.state.conversationDisplayName),a.createElement(w.Caption,{style:[b.default.flexNegativeOne,e.secondaryTextColorStyle]},n.message),i)),a.createElement(a.View,{style:M.callButtonsContainer},this.renderCallControls()))}}t.default=k},3978:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ToastHeight=void 0;const a=i(0),n=i(29),o=i(123),s=i(13),r=i(193),l=i(3),c=i(1802),d=i(4),u=i(6),h=i(9),p=i(14),g=i(12);t.ToastHeight=40;const C=u.lazyProperties({container:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"space-between",paddingHorizontal:20,paddingVertical:s.CompositeNotificationToastInfo.vertical,height:t.ToastHeight}),metadataContainer:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center",marginVertical:3}),notificationTextStyle:()=>a.Styles.createTextStyle({flex:-1,wordBreak:"break-word",paddingRight:5}),linkStyle:()=>a.Styles.createTextStyle({flex:1,wordBreak:"break-word",color:h.Color.blue})});class m extends g.default{_buildState(e,t){let i=r.default.getToast(e.toastId);if(i&&i.state){const e=i.state.callId;return{callId:e,callState:n.default.CallingStore.getCallState(e),shouldBeRemoved:!n.default.CallingStore.isIncomingVideoDisabled(e)}}return{}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=this.state.callState&&o.default.isCallStateActive(this.state.callState)&&o.default.isCallStateOnHold(this.state.callState);!this.state.shouldBeRemoved&&a||(d.log(l.LogTraceArea.CallingUI,"CompositeIncomingVideoDisabledToast.componentDidUpdate removing toast"),r.default.removeToast(this.props.toastId))}render(){return a.createElement(a.View,{style:[C.container]},a.createElement(c.default,{callId:this.state.callId,containerStyle:[C.metadataContainer,p.default.flexNegativeOne],textStyle:[C.notificationTextStyle,this._themeStyles.headerTextColorStyle],linkStyle:C.linkStyle}))}}t.default=m,m.height=t.ToastHeight},3980:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(29),o=i(60),s=i(13),r=i(193),l=i(3),c=i(41),d=i(26),u=i(4),h=i(6),p=i(5),g=i(42),C=i(9),m=i(11),S=i(16),y=i(12),f=i(31),_=i(10),b=m.IconSize.size20,v=h.lazyProperties({container:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingHorizontal:20,paddingVertical:10}),contentContainer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",flexWrap:"wrap",paddingHorizontal:10,alignItems:"center"}),textComposite:()=>a.Styles.createTextStyle({flex:-1,lineHeight:24,alignSelf:"center",wordBreak:"break-word"}),avSettingsLinkStyle:()=>a.Styles.createTextStyle({flex:-1,lineHeight:24,alignSelf:"center",wordBreak:"break-word",marginLeft:4,color:C.Color.sxBlue}),buttonContainer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",flexWrap:"wrap",paddingLeft:10}),buttonStyle:()=>a.Styles.createButtonStyle({paddingLeft:10})});class w extends y.default{constructor(){super(...arguments),this._onCloseButtonPress=e=>{r.default.removeToast(this.props.toastId,o.ToastActionType.ManualDismissed)},this._onAVSettingsLinkPress=e=>{const t=_.default.newCauseId();u.log(l.LogTraceArea.Navigation,"CompositeNotificationToast._onAVSettingsLinkPress causeId: "+t),n.default.CallNavigationHelper.navigateToAVDesktopSettings(this._getRootViewId(),t),r.default.removeToast(this.props.toastId,o.ToastActionType.Actioned)}}_buildState(e){const t=r.default.getToast(e.toastId);if(t&&t.state){const e=t.state;return{notificationText:e.notificationText,showAvSettingsLink:e.showAvSettingsLink,timeout:e.buttons?void 0:e.timeout,icon:e.icon,buttons:e.buttons}}return{}}_getIcon(){if(this.state.icon)return a.createElement(d.default,{icon:this.state.icon,size:m.IconSize.size24,color:this._themeColors.headerIconColor})}render(){const e=this._getIcon(),t=this.state.notificationText,i=this.state.showAvSettingsLink?a.createElement(S.BodyText,{style:v.avSettingsLinkStyle,onPress:this._onAVSettingsLinkPress},p.getString("DesktopProfileMenu.AudioVideoSettingsTitle")):void 0,n=this.state.buttons?a.createElement(a.View,{style:v.buttonContainer},this.state.buttons.map(e=>a.createElement(g.default,{style:v.buttonStyle,buttonStyle:s.SXButtonStyle.LightFill,buttonSize:s.SXButtonSize.Small,title:p.getString(e.labelKey),onPress:e.callback}))):void 0,o=[this._themeStyles.headerTextColorStyle,v.textComposite];return a.createElement(a.View,{style:v.container},e,a.createElement(a.View,{style:v.contentContainer},a.createElement(S.BodyText,{style:o},t),i,n),a.createElement(c.default,{icon:m.SkypeIcon.ClosePanel,size:b,color:this._themeColors.headerIconColor,hoverColor:this._themeColors.primaryIconColor,title:p.getString("Global.CloseButtonTitle"),onPress:this._onCloseButtonPress}))}componentDidMount(){super.componentDidMount(),this.state.timeout&&(this._timeoutId=f.default.setTimeout(()=>{r.default.removeToast(this.props.toastId,o.ToastActionType.AutoDismissed),this._timeoutId=void 0},this.state.timeout))}componentWillUnmount(){super.componentWillUnmount(),this._timeoutId&&(f.default.clearTimeout(this._timeoutId),this._timeoutId=void 0)}}t.default=w},3981:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(29),o=i(123),s=i(13),r=i(193),l=i(3),c=i(4),d=i(6),u=i(1803),h=i(12),p=d.lazyProperties({metadataContainer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",paddingHorizontal:20,paddingVertical:s.CompositeNotificationToastInfo.vertical}),notificationTextStyle:()=>a.Styles.createTextStyle({flex:-1,wordBreak:"break-word"})});class g extends h.default{constructor(){super(...arguments),this._dismiss=()=>{c.log(l.LogTraceArea.CallingUI,"CompositeSpokenLanguageConflictResolutionToast._dismiss"),r.default.removeToast(this.props.toastId)}}_buildState(e,t){let i=r.default.getToast(e.toastId);if(i&&i.state){const e=i.state.callId;return{callId:e,callState:n.default.CallingStore.getCallState(e),shouldBeRemoved:!n.default.CallingStore.isIncomingVideoDisabled(e)}}return{}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=this.state.callState&&o.default.isCallStateActive(this.state.callState)&&o.default.isCallStateOnHold(this.state.callState);!this.state.shouldBeRemoved&&a||this._dismiss()}render(){return a.createElement(u.default,{containerStyle:p.metadataContainer,textStyle:[p.notificationTextStyle,this._themeStyles.headerTextColorStyle],onDismiss:this._dismiss,callId:this.state.callId,iconColor:this._themeColors.headerIconColor})}}t.default=g},3982:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(0),n=i(29),o=i(123),s=i(13),r=i(193),l=i(3),c=i(4),d=i(6),u=i(9),h=i(11),p=i(1804),g=i(12),C=d.lazyProperties({metadataContainer:()=>a.Styles.createViewStyle({paddingHorizontal:s.CompositeNotificationToastInfo.horizontal}),notificationTextStyle:()=>a.Styles.createTextStyle({flex:-1,wordBreak:"break-word"}),linkStyle:()=>a.Styles.createTextStyle({flex:1,wordBreak:"break-word",color:u.Color.blue})});class m extends g.default{constructor(){super(...arguments),this._dismiss=()=>{c.log(l.LogTraceArea.CallingUI,"CompositeTranslationInCallToast._dismiss"),r.default.removeToast(this.props.toastId)}}_buildState(e,t){let i=r.default.getToast(e.toastId);if(i&&i.state){const e=i.state,t=e.callId,a=e.conversationMri;return{callId:t,callState:n.default.CallingStore.getCallState(t),conversationMri:a}}return{}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.callState&&o.default.isCallStateActive(this.state.callState)&&o.default.isCallStateOnHold(this.state.callState)||this._dismiss()}render(){return a.createElement(p.default,{containerStyle:C.metadataContainer,textStyle:[C.notificationTextStyle,this._themeStyles.headerTextColorStyle],callId:this.state.callId,linkStyle:C.linkStyle,iconColor:this._themeColors.headerIconColor,iconSize:h.IconSize.size20,onDismiss:this._dismiss,conversationMri:this.state.conversationMri})}}t.default=m},413:function(e,t,i){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0});const n=i(25),o=i(1),s=i(15),r=i(3),l=i(4);var c;!function(e){e[e.CallVisible=0]="CallVisible"}(c||(c={}));let d=a=class extends s.StoreBase{constructor(){super(...arguments),this._visibleCalls={},this._hasVisibleCall=!1,this._videoSuggestionTooltips={},this._callPreviewViews={}}isCallVisible(e){return!!this._visibleCalls[e]}hasVisibleCall(){return this._hasVisibleCall}isVideoSuggestionTooltipVisible(e){return!!this._videoSuggestionTooltips[e]}hasVideoSuggestionTooltipBeenSeen(e){return void 0!==this._videoSuggestionTooltips[e]}hasCallPreviewViewBeenSeen(e){return!!this._callPreviewViews[e]}setVideoSuggestionTooltipVisibility(e,t){this._videoSuggestionTooltips[e]=t,this.trigger(e)}setCallPreviewViewSeen(e){this._callPreviewViews[e]=!0,this.trigger(e)}setCallViewVisible(e,t,i){if(l.log(r.LogTraceArea.CallingUI,"CallVisibilityStore.setCallViewVisible: "+e+" visible: "+(t?"true":"false")+" causeId: "+i),!e)return;const n=!o.isEmpty(this._visibleCalls);if(t){let t=o.find(this._visibleCalls,t=>t.callId===e);o.isUndefined(t)?this._visibleCalls[e]=a._visibleCall(e):t.refCounter++}else void 0!==this._visibleCalls[e]?(this._visibleCalls[e].refCounter--,this._visibleCalls[e].refCounter<=0&&delete this._visibleCalls[e]):l.warn(r.LogTraceArea.CallingUI,"CallVisibilityStore.setCallViewVisible: "+e+" trying to set visiblity false at a already invisible call");this._triggerUpdates(e,n)}_triggerUpdates(e,t=!0){this.trigger(e);const i=!o.isEmpty(this._visibleCalls);t!==i&&(this._hasVisibleCall=i,this.trigger(c.CallVisible))}static _visibleCall(e){return{callId:e,refCounter:1}}};n.__decorate([s.autoSubscribe,n.__param(0,s.key)],d.prototype,"isCallVisible",null),n.__decorate([s.autoSubscribeWithKey(c.CallVisible)],d.prototype,"hasVisibleCall",null),n.__decorate([s.autoSubscribe,n.__param(0,s.key)],d.prototype,"isVideoSuggestionTooltipVisible",null),n.__decorate([s.autoSubscribe,n.__param(0,s.key)],d.prototype,"hasVideoSuggestionTooltipBeenSeen",null),n.__decorate([s.autoSubscribe,n.__param(0,s.key)],d.prototype,"hasCallPreviewViewBeenSeen",null),d=a=n.__decorate([s.AutoSubscribeStore],d),t.default=new d},421:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StackNavHeightBasedToast=t.CommonToastStyles=void 0;const a=i(0),n=i(15),o=i(6),s=i(9),r=i(24),l=o.lazyProperties({hidden:()=>a.Styles.createViewStyle({opacity:0})});t.CommonToastStyles=o.lazyProperties({titleStyle:()=>a.Styles.createTextStyle({color:s.Color.white}),linkStyle:()=>a.Styles.createTextStyle({color:s.Color.sxBlue,fontSize:r.default.controlFontSize.smallButton}),container:()=>a.Styles.createViewStyle({paddingLeft:10,paddingRight:10,paddingVertical:10,backgroundColor:s.Color.gray400Overlay70})});class c extends n.ComponentBase{constructor(){super(...arguments),this.onLayout=e=>{const t=this.props.topInset,i=e.height-(t||0);i!==this.state.desiredHeight&&this.setState({desiredHeight:i,initialLayoutComplete:!0})}}_buildState(e,t){const i={};return t&&(i.initialLayoutComplete=!1,i.desiredHeight=0),i}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.desiredHeight!==t.desiredHeight&&this.props.onDesiredHeightChanged(t.desiredHeight)}componentWillUnmount(){super.componentWillUnmount(),this.props.onDesiredHeightChanged(0)}render(){const e=[this._getContainerStyle()];return this.props.topInset&&e.push(a.Styles.createViewStyle({paddingTop:this.props.topInset},!1)),this.state.initialLayoutComplete||e.push(l.hidden),a.createElement(a.View,{style:e,onLayout:this.onLayout},this._renderContent())}}t.StackNavHeightBasedToast=c},437:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MicrophoneSettingsOrigin=t.SettingsMode=void 0,function(e){e[e.All=0]="All",e[e.Audio=1]="Audio",e[e.Video=2]="Video"}(t.SettingsMode||(t.SettingsMode={})),function(e){e[e.AVSettings=0]="AVSettings",e[e.InCallPopup=1]="InCallPopup"}(t.MicrophoneSettingsOrigin||(t.MicrophoneSettingsOrigin={}))},475:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(25),n=i(1),o=i(15),s=i(3237),r=i(17),l=i(343),c=i(722),d=i(102);let u=class extends o.StoreBase{constructor(){super(...arguments),this._phoneNumberRates={},this._phoneNumberSkypeCallRates={},this._lookups={},this._getPhoneNumberFromPhoneMri=e=>{const t=r.getPhoneNumberFromMri(e);return t?d.default.stripPlusSign(t):e},this._getPhoneNumberRates=e=>this._phoneNumberRates[e]&&this._phoneNumberRates[e][e]?this._phoneNumberRates[e][e]:void 0,this._getCallRateFundingSourceForPhoneNumber=e=>this._phoneNumberSkypeCallRates[e]&&this._phoneNumberSkypeCallRates[e][e]?this._phoneNumberSkypeCallRates[e][e].callFundedBy:void 0}_startedTrackingKey(e){const t=r.isMri(e)?this._getPhoneNumberFromPhoneMri(e):e;this._lookups[t]||(this._lookups[t]=c.default.getRates([t]).finally(()=>{delete this._lookups[t]}).then(i=>{const a={};n.transform(i,(e,t)=>{const i=s.compileCallRateLabel(t);i&&(e[t.pstnNumber]=i)},a),this._phoneNumberRates[t]=a,this._phoneNumberSkypeCallRates[t]=i,this.trigger(e)}))}_stoppedTrackingKey(e){const t=this._lookups[e];t&&(delete this._lookups[e],t.cancel()),delete this._phoneNumberRates[e],delete this._phoneNumberSkypeCallRates[e]}getCallRateByPhoneNumber(e){return this._getPhoneNumberRates(e)}getCallRateByMri(e){const t=this._getPhoneNumberFromPhoneMri(e);return this._getPhoneNumberRates(t)}isPhoneNumberEligibleForTaster(e){const t=this._getCallRateFundingSourceForPhoneNumber(e);return!!t&&t===l.CallRateFundingSource.TasterCall}isPhoneMriTollFree(e){const t=this._getPhoneNumberFromPhoneMri(e),i=this._getCallRateFundingSourceForPhoneNumber(t);return!!i&&i===l.CallRateFundingSource.FreeCall}};a.__decorate([o.disableWarnings],u.prototype,"_startedTrackingKey",null),a.__decorate([o.disableWarnings],u.prototype,"_stoppedTrackingKey",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],u.prototype,"getCallRateByPhoneNumber",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],u.prototype,"getCallRateByMri",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],u.prototype,"isPhoneNumberEligibleForTaster",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],u.prototype,"isPhoneMriTollFree",null),u=a.__decorate([o.AutoSubscribeStore],u),t.default=new u},503:function(e,t,i){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),t.EmailABCHEntry=t.PhoneABCHEntry=t.ABCHEntry=t.VerificationState=void 0;const n=i(25),o=i(34),s=i(1),r=i(15),l=i(8),c=i(806),d=i(1050),u=i(3),h=i(4),p=i(30),g=i(170),C=i(19),m=i(10);var S,y;!function(e){e[e.ProfileChanged=0]="ProfileChanged"}(S||(S={})),function(e){e[e.Unverified=0]="Unverified",e[e.VerificationPending=1]="VerificationPending",e[e.Verified=2]="Verified"}(y=t.VerificationState||(t.VerificationState={}));class f{constructor(e){switch(this.Searchable=e.Searchable,this.Source=e.Source,e.State){case c.VerificationStrings.Verified:this.VerifiedState=y.Verified;break;case c.VerificationStrings.VerificationPending:this.VerifiedState=y.VerificationPending;break;case c.VerificationStrings.Unverified:default:this.VerifiedState=y.Unverified}}}t.ABCHEntry=f;class _ extends f{constructor(e){super(e),this.Phone=d.default.getPhonePartsFromViewValue(e)}}t.PhoneABCHEntry=_;class b extends f{constructor(e){super(e),this.EmailAddress=e.Name}}t.EmailABCHEntry=b;let v=a=class extends r.StoreBase{constructor(){super(...arguments),this._shortCircuitEntries={}}getEntries(){return this._profile||this._initialize(),s.cloneDeep(this._shortCircuitEntries)}getProfile(e=!1){return!this._profile||e?this._initialize():l.Resolved(this._profile)}hidePhoneNumberInSearch(e){const t={Name:e.Number,Country:a.getCountryForVerification(e.CountryIsoCode,e.CountryCallingCode),Searchable:!1},i={Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Edit:[t]}]};return h.log(u.LogTraceArea.ABCHStore,"Hide phone number in search "+o.pii.Omit(e.Number)),c.default.postActionOnPhoneNumber(i).then(e=>this._parseProfile(e))}showPhoneNumberInSearch(e,t){const i={Name:e.Number,Country:a.getCountryForVerification(e.CountryIsoCode,e.CountryCallingCode),Searchable:!0},n="Msa"===t;n&&(i.Label=c.Phone_Other_Label);const s=n?{Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Add:[i]}]}:{Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Edit:[i]}]};return h.log(u.LogTraceArea.ABCHStore,"Show phone number in search "+o.pii.Omit(e.Number)),c.default.postActionOnPhoneNumber(s).then(e=>this._parseProfile(e))}deletePhoneNumber(e){const t={Name:e.Number,Country:a.getCountryForVerification(e.CountryIsoCode,e.CountryCallingCode),Label:c.Phone_Other_Label},i={Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Delete:[t]}]};return h.log(u.LogTraceArea.ABCHStore,"Delete phone number "+o.pii.Omit(e.Number)),c.default.postActionOnPhoneNumber(i).then(e=>this._parseProfile(e))}verifyPhoneNumber(e,t){const i={Token:t,Name:e.Number,Country:a.getCountryForVerification(e.CountryIsoCode,e.CountryCallingCode)},n={Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Edit:[i]}]};return h.log(u.LogTraceArea.ABCHStore,"Verify phone number "+o.pii.Omit(e.Number)),c.default.postActionOnPhoneNumber(n).then(e=>this._parseProfile(e))}provisionExistingPhoneNumber(e,t,i){const n={Name:e.Number,Country:a.getCountryForVerification(e.CountryIsoCode,e.CountryCallingCode),Searchable:!0,VerifyMethod:t,VerifyLanguage:i},s={Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Edit:[n]}]};return h.log(u.LogTraceArea.ABCHStore,"Provision exisiting phone number "+o.pii.Omit(e.Number)),c.default.postActionOnPhoneNumber(s).then(e=>this._parseProfile(e))}provisionNewPhoneNumber(e,t,i){const n={Name:e.Number,Country:a.getCountryForVerification(e.CountryIsoCode,e.CountryCallingCode),Searchable:!0,VerifyMethod:t,VerifyLanguage:i,Label:c.Phone_Other_Label},s={Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Add:[n]}]};return h.log(u.LogTraceArea.ABCHStore,"Provision new phone number "+o.pii.Omit(e.Number)),c.default.postActionOnPhoneNumber(s).then(e=>this._parseProfile(e))}getUnverifiedPhoneNumberFromProfile(e){let t="";return s.eachRight(this._shortCircuitEntries,(i,a)=>!(i instanceof _&&i.VerifiedState!==y.Verified&&i.Source===e)||(t=i.Phone.Number,!1)),t}updateEntrySearchability(e,t){this._shortCircuitEntries[e]&&(this._shortCircuitEntries[e].Searchable=t,this.trigger())}registerMsaVerifiedEmailWithShortCircuit(){return this.getProfile(!0).then(e=>{let t,i;return s.each(e.Views,e=>{s.each(e.Attributes,e=>{e.Name===c.AttributeNames.PersonalContactProfileEmails&&s.each(e.Value,e=>{"Msa"===e.Source&&e.State===c.VerificationStrings.Verified&&!e.Searchable&&e.Name&&(t=e.Name,i=e.Label)})})}),!(!t||!i)&&c.default.registerEmailWithShortCircuit(t,i).then(()=>!0)})}_initialize(){return this._initializationPromise||(this._initializationPromise=c.default.getMyProfile(),h.log(u.LogTraceArea.ABCHStore,"Profile loading started.")),this._initializationPromise.then(e=>(h.log(u.LogTraceArea.ABCHStore,"Profile successfully loaded. Views length: "+e.Views.length),this._parseProfile(e))).catch(e=>(h.track(new g.MyProfileFetch({isSuccess:!1,isV2:!0,isMigrationSuggested:!1,isMigratedToV2:!1,origin:u.MyProfileFetchOrigin.ABCHStore})),l.Rejected(e))).finally(()=>{this.trigger(S.ProfileChanged),this._initializationPromise=void 0})}getParsedProfile(){var e;const t={phoneNumbersAndParts:[],emails:[]};if(!this._profile)return this._initialize(),t;const i=s.flatten(s.map(null===(e=this._profile)||void 0===e?void 0:e.Views,"Attributes")),a=s.filter(i,e=>s.includes([c.AttributeNames.PersonalContactProfilePhones,c.AttributeNames.PersonalContactProfileEmails],e.Name));return s.each(a,e=>{s.each(e.Value,i=>{if(e.Name===c.AttributeNames.PersonalContactProfilePhones&&0===t.phoneNumbersAndParts.length){const e=d.default.getPhonePartsFromViewValue(i);t.phoneNumbersAndParts.push({phoneNumber:d.default.getPhoneKey(e.Number,e.CountryIsoCode,e.CountryCallingCode,!0),phoneParts:e,source:i.Source})}else e.Name===c.AttributeNames.PersonalContactProfileEmails&&0===t.emails.length&&t.emails.push(i.Name)})}),t}_parseProfile(e){this._profile=e,this._shortCircuitEntries={};let t=!1;s.each(e.Views,e=>{s.each(e.Attributes,e=>{s.each(e.Value,i=>{if(e.Name===c.AttributeNames.PersonalContactProfilePhones){const e=d.default.calculatePhoneKeyFromViewValue(i);this._shortCircuitEntries[e]=new _(i)}else if(e.Name===c.AttributeNames.PersonalContactProfileEmails){const e=this._calculateEmailKeyFromViewValue(i);this._shortCircuitEntries[e]=new b(i),i.State===c.VerificationStrings.Verified&&(t=!0)}})})});const i=s.map(this._shortCircuitEntries,(e,t)=>`${this._getEntryName(e)}:${o.pii.Omit(t)}`).join("\n");return h.log(u.LogTraceArea.ABCHStore,"Updated profile info:\n"+i),p.default.setUserPreferencesLocal({hasVerifiedEmail:t}),this.trigger(),e}_getEntryName(e){return e instanceof _?"Phone":e instanceof b?"Email":m.default.switchStatementExhaustiveChecking(e)}static getCountryForVerification(e,t){return C.default.toUpper(e)+"-"+t}_calculateEmailKeyFromViewValue(e){return e.Name.trim().toLowerCase()}test_reset_store(){this._profile=void 0,this._initializationPromise=void 0}};n.__decorate([r.autoSubscribe],v.prototype,"getEntries",null),n.__decorate([r.autoSubscribe],v.prototype,"getProfile",null),n.__decorate([r.autoSubscribeWithKey(S.ProfileChanged)],v.prototype,"getParsedProfile",null),v=a=n.__decorate([r.AutoSubscribeStore],v),t.default=new v},512:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TestableNdiConfigStore=void 0;const a=i(25),n=i(115),o=i(15),s=i(49),r=i(4),l=i(75),c=i(19),d=i(10);let u=class extends o.StoreBase{constructor(){super(),this._ndiConfig={isNdiEnabled:!1,watermarkLocation:"1,0"}}initialize(){const e=d.default.newCauseId(),t=l.default.getDataExclusive(s.InternalKeys.NdiConfig);if(r.log(n.LogTraceArea.Ndi,"NdiConfigStore.initialize. causeId: "+e),t){let e=!1;this._ndiConfig.isNdiEnabled===t.isNdiEnabled&&this._ndiConfig.watermarkLocation===t.watermarkLocation||(e=!0),this._ndiConfig.isNdiEnabled=t.isNdiEnabled,this._ndiConfig.watermarkLocation=t.watermarkLocation,e&&this.trigger()}r.log(n.LogTraceArea.Ndi,"Initial ndi config is "+JSON.stringify(this._ndiConfig))}isNdiEnabled(){return this._ndiConfig.isNdiEnabled}setNdiEnabled(e){const t=d.default.newCauseId();this._ndiConfig.isNdiEnabled!==e?(r.log(n.LogTraceArea.Ndi,`updating isNdiEnabled to ${e}. causeId: ${t}`),this._ndiConfig.isNdiEnabled=e,this.trigger(),this._writeToUserConfig(t)):r.log(n.LogTraceArea.Ndi,`setNdiEnabled called with value same as current (${e}). causeId: ${t}`)}getWatermarkLocation(){return this._ndiConfig.watermarkLocation}setWatermarkLocation(e){const t=d.default.newCauseId();this._ndiConfig.watermarkLocation!==e?(r.log(n.LogTraceArea.Ndi,`updating watermarkLocation to ${e} causeId: ${t}`),this._ndiConfig.watermarkLocation=e,this.trigger(),this._writeToUserConfig(t)):r.log(n.LogTraceArea.Ndi,`setWatermarkLocation called with value same as current (${e}). causeId: ${t}`)}_writeToUserConfig(e){r.log(n.LogTraceArea.Ndi,`Writing ${JSON.stringify(this._ndiConfig)} to internalDataStore. causeId: ${e}`),l.default.putData(s.InternalKeys.NdiConfig,this._ndiConfig,void 0,e).catch(t=>r.warn(n.LogTraceArea.Ndi,`putData Failed. causeId: ${e} error: ${c.default.errorAsString(t)}`)).finally(()=>{r.log(n.LogTraceArea.Ndi,"Done writing. causeId: "+e)})}};a.__decorate([o.autoSubscribe],u.prototype,"isNdiEnabled",null),a.__decorate([o.autoSubscribe],u.prototype,"getWatermarkLocation",null),u=a.__decorate([o.AutoSubscribeStore],u),t.TestableNdiConfigStore=u,t.default=new u},515:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(7),o=i(5),s=i(11),r=new Set(["Auditorium","AuditoriumDark","AuditoriumGold","Amphitheater","DiningRoom","ConferenceRoom","CoffeeShop","BigConferenceRoom","AbstractDark","Halo","Underwater","Classroom","Minecraft","HolidaySnow","HolidayCave","Restaurant","WinterLodge","KitchenDining","WarmSantorini","Dinner","Celebration","Outdoors","Crowd","TropicalSunset","PowerTogether","Airplane","Birthday"]);class l{static getTogetherModeBackgrounds(){const{backgrounds:e}=n.default.getS4LCMCFeatures().callAudienceBotConfig;return a.map(e,e=>{const t=this._getTranslatedLabel(e);return{sceneId:e.sceneId,untranslatedName:e.name,label:t,url:e.thumbSrc,maxAudience:e.maxAudience}})}static getTogetherModeBackgroundName(e){var t;return null===(t=l.getTogetherModeBackgrounds().find(t=>t.sceneId===e))||void 0===t?void 0:t.untranslatedName}static getPanelId(){return"_togetherModeModalId"}static getBackgroundChangeButtonIcon(){return s.SkypeIcon.Picture}static _getTranslatedLabel(e){const t=e.humanFriendlyId;if(!r.has(t))return e.name;const i="TogetherModeBackgroundNames."+t;return o.getString(i)}}t.default=l},518:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(25),n=i(1),o=i(15),s=i(4),r=i(185),l=i(39);let c=class extends o.StoreBase{constructor(){super(...arguments),this._pinnedParticipants={}}pinParticipant(e,t){s.log(r.LogTraceArea.CallingUI,"Pinning participant with key "+l.mriOrId(e)+" for the callId: "+t),this._pinnedParticipants[t]||(this._pinnedParticipants[t]=[]),this._pinnedParticipants[t].push(e),this.trigger(t)}unpinParticipant(e,t){s.log(r.LogTraceArea.CallingUI,"Trying to unpin participant with key "+l.mriOrId(e)+" for the callId: "+t),this._pinnedParticipants[t]&&(n.pull(this._pinnedParticipants[t],e),this.trigger(t))}cleanupPinnedParticipants(e){s.log(r.LogTraceArea.CallingUI,"Cleaning up the call participants for a call "+e),delete this._pinnedParticipants[e],this.trigger(e)}getPinnedParticipants(e){return this._pinnedParticipants[e]}isParticipantPinned(e,t){return n.includes(this._pinnedParticipants[t],e)}hasPinnedParticipants(e){return!n.isEmpty(this._pinnedParticipants[e])}};a.__decorate([o.autoSubscribe,a.__param(0,o.key)],c.prototype,"getPinnedParticipants",null),a.__decorate([o.autoSubscribe,a.__param(1,o.key)],c.prototype,"isParticipantPinned",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],c.prototype,"hasPinnedParticipants",null),c=a.__decorate([o.AutoSubscribeStore],c),t.default=new c},534:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DialerUXStore=t.TriggerKeys=void 0;const a=i(25),n=i(1),o=i(15),s=i(8),r=i(7),l=i(530),c=i(475),d=i(13),u=i(102),h=i(205),p=i(27),g=i(22);var C;!function(e){e[e.CallerIdCTA=0]="CallerIdCTA",e[e.CallRate=1]="CallRate",e[e.DialpadCollapse=2]="DialpadCollapse",e[e.SaveContact=3]="SaveContact",e[e.TasterPromotion=4]="TasterPromotion",e[e.DialingExtension=5]="DialingExtension",e[e.CanDialComma=6]="CanDialComma"}(C=t.TriggerKeys||(t.TriggerKeys={}));let m=class extends o.StoreBase{constructor(){super(),this._isDialpadCollapsed=!1,this._shouldShowCallerIdCTA=!1,this._isCallerIdCTACollapsedInPortrait=!1,this._isCallerIdCTACollapsedInLandscape=!1,this._callRatesSubscriptions={},this._callRates={},this._rateIntegrationEnabled=!1,this._saveContactEnabled=!1,this._saveContactVisible=!1,this._tasterPromotionEnabled=!1,this._isRoomForTasterImage=!1,this._canDialComma=!1,this._isDialingExtension=!1,this._updateAppConfigFields=()=>{const e=r.default.getS4LEntitlementFeatures().SCE.UserServices.Client.Features.RateIntegrationEnabled;this._rateIntegrationEnabled!==e&&(this._rateIntegrationEnabled=e,this.trigger(C.CallRate),this._updateCallerIdCTAVisibility());const t=r.default.getS4LEntitlementFeatures().SCE.Dialpad.Features.SaveContactEnabled;this._saveContactEnabled!==t&&(this._saveContactEnabled=t,this._updateSaveContactVisibility(),this._updateCallerIdCTAVisibility());const i=r.default.getS4LEntitlementFeatures().SCE.Dialpad.Features.TasterPromotionEnabled;this._tasterPromotionEnabled!==i&&(this._tasterPromotionEnabled=i,this.trigger(C.TasterPromotion))},this._shouldShowCallerIdCTAUpdate=()=>{const e=l.default.shouldShowDialpadCTA();this._shouldShowCallerIdCTA!==e&&(this._shouldShowCallerIdCTA=e,this.trigger(C.CallerIdCTA))},this._searchResultsUpdate=()=>{this._contactSearchResults=h.default.getSearchResults(),this._updateSaveContactVisibility(),this._updateCallerIdCTAVisibility()},this._phoneNumberUpdate=()=>{this._phoneNumber=h.default.getPhoneNumber(h.TriggerKeys.E164),this.trigger(C.CallRate),this._updateSaveContactVisibility(),this._updateCallerIdCTAVisibility()},this._phoneNumberInputUpdate=()=>{this._phoneNumber=h.default.getPhoneNumber(h.TriggerKeys.InputValue),this._updateIsDialingExtension(),this._updateCanDialComma()},this._screenSizeUpdate=()=>{const e=p.default.isMobileScreenSize(d.MainRootViewId)&&!p.default.isHeightSmallerThanThreshold(710,d.MainRootViewId);this._isRoomForTasterImage!==e&&(this._isRoomForTasterImage=e,this.trigger(C.TasterPromotion))},this._updateSaveContactVisibility=()=>{const e=this._saveContactEnabled&&this._phoneNumber&&this._phoneNumber.callable&&!this._phoneNumber.emergency&&!this._phoneNumber.extension&&(!this._contactSearchResults||!this._contactSearchResults.selectedResult&&!this._contactSearchResults.exactMatch)&&!(this._callRates[this._phoneNumber.E164]&&this._callRates[this._phoneNumber.E164].isTasterEligible);this._saveContactVisible!==e&&(this._saveContactVisible=!!e,this.trigger(C.SaveContact))},this._updateCallerIdCTAVisibility=()=>{let e=!1,t=!1;this._phoneNumber&&this._callRates[this._phoneNumber.E164]&&(e=!0),this._contactSearchResults&&(this._contactSearchResults.results.length>0||this._contactSearchResults.selectedResult)&&(e=!0),this.isDialpadCollapsed()&&(e=!0),this._saveContactVisible&&(e=!0),this._phoneNumber&&this._phoneNumber.emergency&&(e=!0,t=!0),this._isCallerIdCTACollapsedInPortrait===e&&this._isCallerIdCTACollapsedInLandscape===t||(this._isCallerIdCTACollapsedInPortrait=e,this._isCallerIdCTACollapsedInLandscape=t,this.trigger(C.CallerIdCTA))},this._updateCanDialComma=()=>{const e=!!this._phoneNumber&&this._phoneNumber.callable;this._canDialComma!==e&&(this._canDialComma=e,this.trigger(C.CanDialComma))},this._updateIsDialingExtension=()=>{const e=!!this._phoneNumber&&!!this._phoneNumber.extension;this._isDialingExtension!==e&&(this._isDialingExtension=e,this.trigger(C.DialingExtension))},g.RegisterStartupable(this,"DialerUXStore")}startup(){return r.default.subscribe(this._updateAppConfigFields),this._updateAppConfigFields(),h.default.subscribe(this._searchResultsUpdate,h.TriggerKeys.SearchResults),this._searchResultsUpdate(),h.default.subscribe(this._phoneNumberUpdate,h.TriggerKeys.E164),this._phoneNumberUpdate(),h.default.subscribe(this._phoneNumberInputUpdate,h.TriggerKeys.InputValue),this._phoneNumberInputUpdate(),p.default.subscribe(this._screenSizeUpdate,p.TriggerKeys.ResponsiveWidth),p.default.subscribe(this._screenSizeUpdate,p.TriggerKeys.Height),this._screenSizeUpdate(),s.Resolved()}resetDialerPanelState(){this.toggleDialpadCollapse(!1)}toggleDialpadCollapse(e){this._isDialpadCollapsed=e,this._updateCallerIdCTAVisibility(),this.trigger(C.DialpadCollapse)}isDialpadCollapsed(){return this._isDialpadCollapsed}getCallRate(){if(!this._phoneNumber||!this._isValidPhoneNumber(this._phoneNumber.E164)||!this._rateIntegrationEnabled)return{};const e=this._phoneNumber.E164,t=u.default.stripPlusSign(e);return void 0===this._callRatesSubscriptions[e]&&(this._callRatesSubscriptions[e]=c.default.subscribe(()=>this._callRateUpdate(e),t),this._callRates[e]={message:c.default.getCallRateByPhoneNumber(t),isTasterEligible:c.default.isPhoneNumberEligibleForTaster(t)}),this._callRates[e]}isSaveContactVisible(e,t){return!this._isInvalidNumberNotificationVisible(e,t)&&this._saveContactVisible}isCallerIdCTAVisibleInPortrait(e,t){return this._isCallerIdCTAVisible(e,t)&&!this._isCallerIdCTACollapsedInPortrait}isCallerIdCTAVisibleInLandscape(e,t){return this._isCallerIdCTAVisible(e,t)&&!this._isCallerIdCTACollapsedInLandscape}shouldShowRateAboveSelectedContact(){return!(this.tasterImageEnabled()&&this.getCallRate().isTasterEligible)}tasterImageEnabled(){return this._tasterPromotionEnabled&&this._isRoomForTasterImage}tasterCoachmarkEnabled(){return this._tasterPromotionEnabled&&!this._isRoomForTasterImage}tasterGreenCallButtonEnabled(){return this._tasterPromotionEnabled}isDialingExtension(){return this._isDialingExtension}canDialComma(){return this._canDialComma}_isCallerIdCTAVisible(e,t){return!this._isInvalidNumberNotificationVisible(e,t)&&(void 0===this._callerIdPromptStoreSubscription&&(this._callerIdPromptStoreSubscription=l.default.subscribe(this._shouldShowCallerIdCTAUpdate,l.TriggerKeys.DialpadCTA),this._shouldShowCallerIdCTA=l.default.shouldShowDialpadCTA()),this._shouldShowCallerIdCTA)}_isInvalidNumberNotificationVisible(e,t){return!!(e&&t&&this._phoneNumber&&this._phoneNumber.E164===t)}_isValidPhoneNumber(e){try{return!n.isEmpty(e)&&u.default.isValidNumberString(e)}catch(e){return!1}}_callRateUpdate(e){const t=u.default.stripPlusSign(e),i={message:c.default.getCallRateByPhoneNumber(t),isTasterEligible:c.default.isPhoneNumberEligibleForTaster(u.default.stripPlusSign(t))};this._callRates[e].message===i.message&&this._callRates[e].isTasterEligible===i.isTasterEligible||(this._callRates[e]=i,this.trigger(C.CallRate),this._updateCallerIdCTAVisibility()),c.default.unsubscribe(this._callRatesSubscriptions[e]),delete this._callRatesSubscriptions[e]}};a.__decorate([o.autoSubscribeWithKey(C.DialpadCollapse)],m.prototype,"isDialpadCollapsed",null),a.__decorate([o.autoSubscribeWithKey(C.CallRate)],m.prototype,"getCallRate",null),a.__decorate([o.autoSubscribeWithKey(C.SaveContact)],m.prototype,"isSaveContactVisible",null),a.__decorate([o.autoSubscribeWithKey(C.CallerIdCTA)],m.prototype,"isCallerIdCTAVisibleInPortrait",null),a.__decorate([o.autoSubscribeWithKey(C.CallerIdCTA)],m.prototype,"isCallerIdCTAVisibleInLandscape",null),a.__decorate([o.autoSubscribeWithKey([C.CallRate,C.TasterPromotion])],m.prototype,"shouldShowRateAboveSelectedContact",null),a.__decorate([o.autoSubscribeWithKey(C.TasterPromotion)],m.prototype,"tasterImageEnabled",null),a.__decorate([o.autoSubscribeWithKey(C.TasterPromotion)],m.prototype,"tasterCoachmarkEnabled",null),a.__decorate([o.autoSubscribeWithKey(C.TasterPromotion)],m.prototype,"tasterGreenCallButtonEnabled",null),a.__decorate([o.autoSubscribeWithKey(C.DialingExtension)],m.prototype,"isDialingExtension",null),a.__decorate([o.autoSubscribeWithKey(C.CanDialComma)],m.prototype,"canDialComma",null),m=a.__decorate([o.AutoSubscribeStore],m),t.DialerUXStore=m,t.default=new m},563:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(34),n=i(1),o=i(1043),s=i(175),r=i(76),l=i(51),c=i(8),d=i(7),u=i(49),h=(i(164),i(3)),p=i(4),g=i(75),C=i(37),m=i(5),S=i(207),y=i(2421),f=i(2422),_=i(224),b=i(22),v=i(19),w=i(20),T=i(31),I=i(62),P=i(564),M=i(53),k=i(10);t.default=new class{constructor(){this.pushTransportPathChanged=new l.default,this._exponentialTime=new r.ExponentialTime(1e3,3e5),this._checkStateRunning=!1,this._checkStateQueued=!1,this._subscriptions=[],this._handleRegistrationTokenReceived=e=>{if(p.track(new y.GotToken),p.log(h.LogTraceArea.RegistrarService,"OS Push Notification registration token received: "+a.pii.Omit(JSON.stringify(e))),e){let t;t=e,this._setPushTransportPath(t)}else p.warn(h.LogTraceArea.RegistrarService,"Not starting RegistrarService - no push token")},this._handleRegistrationAlertTokenReceived=e=>{if(p.track(new y.GotToken),p.log(h.LogTraceArea.RegistrarService,"OS Push Notification registration token received: "+a.pii.Omit(JSON.stringify(e))),e){let t;t=e,this._setPushTransportAlertPath(t)}else p.warn(h.LogTraceArea.RegistrarService,"Not starting RegistrarService - no push token")},this._gaveUpOnFetchingRegistrationTokenEvent=()=>{p.track(new y.GaveUpOnFetchingToken)},this._nonFatalErrorFetchingRegistrationTokenEvent=e=>{p.track(new y.NonFatalErrorFetchingToken(e.errorCode,e.errorMessage,e.networkConnectivityLevel))},this._handleRegistrationInvalidated=()=>{p.warn(h.LogTraceArea.RegistrarService,"OS Push Notification token has been invalidated")},this._updateTrouter=(e,t)=>{this._trouterUrl===e&&this._trouterTTL===t||(this._setTrouterEndpoint(e,t),this._checkState())},this._checkState=()=>{this._checkStateRunning?this._checkStateQueued=!0:(this._checkStateRunning=!0,this._checkStateInner(),this._checkStateRunning=!1,this._checkStateQueued&&(this._checkStateQueued=!1,this._checkState()))},b.RegisterStartupable(this,"RegistrarService",[g.default,_.default,I.default,P.default]),S.default.registerForLogout(this,"RegistrarService")}startup(){const e=g.default.getData(u.InternalKeys.EdfRegistrationInfo);if(e&&(this._setRegistrationId(e.registrationId,!!e.registrationIdGenerated),this._lastPostedTime=e.lastPostedTime,this._lastPostedPayload=e.lastPostedPayload,p.log(h.LogTraceArea.RegistrarService,"Loaded registrationId: "+this._registrationId+" lastPostedTime: "+this._lastPostedTime),d.default.getS4LFeatures().pushConfig.refreshOnLaunch&&(p.log(h.LogTraceArea.RegistrarService,"Clearing lastPostedPayload - will re-register"),this._lastPostedPayload=void 0)),o.default.useNativeRegistrationId()||this._registrationId)!o.default.useNativeRegistrationId()||this._registrationId&&!this._registrationIdGenerated||_.default.InternalCallingRegistrationId.waitUntilSet().then(()=>this._setAndPersistRegistrationId(_.default.InternalCallingRegistrationId.get(),!1));else{const e=k.default.newGuid();p.log(h.LogTraceArea.RegistrarService,"Generated new arbitrary registrationId: "+e),this._setAndPersistRegistrationId(e,!0)}this._subscriptions.push(s.PushNotifications.registrationTokenReceivedEvent.subscribe(this._handleRegistrationTokenReceived)),this._subscriptions.push(s.PushNotifications.registrationAlertTokenReceivedEvent.subscribe(this._handleRegistrationAlertTokenReceived)),this._subscriptions.push(s.PushNotifications.gaveUpOnFetchingRegistrationTokenEvent.subscribe(this._gaveUpOnFetchingRegistrationTokenEvent)),this._subscriptions.push(s.PushNotifications.nonFatalErrorFetchingRegistrationTokenEvent.subscribe(this._nonFatalErrorFetchingRegistrationTokenEvent)),this._subscriptions.push(s.PushNotifications.registrationTokenInvalidatedEvent.subscribe(this._handleRegistrationInvalidated));const t=s.PushNotifications.getRegistrationToken();t&&this._handleRegistrationTokenReceived(t);const i=s.PushNotifications.getAlertRegistrationToken();return i&&this._handleRegistrationAlertTokenReceived(i),this._tokenStoreSubscription=I.default.subscribe(this._checkState,I.TriggerKeys.SkypeTokenKey),this._subscriptions.push(P.default.trouterChanged.subscribe(this._updateTrouter)),this._setTrouterEndpoint(P.default.getUrl(),P.default.getTTL()),this._checkState(),c.Resolved()}logout(e,t,i){this._unsubscribe();const a=i?c.Resolved():g.default.putData(u.InternalKeys.EdfRegistrationInfo,void 0),o=this._deleteRegistration(),s=_.default.deleteIds({edfRegistrationId:!0},!i);return c.all([a,s]).always(()=>c.raceTimer(o,500)).then(n.noop)}test_reset(){return this._pushTransportPath=void 0,this._pushTransportAlertPath=void 0,this._trouterUrl=void 0,this._trouterTTL=void 0,this._registrationId=void 0,this._registrationIdGenerated=void 0,this._lastPostedTime=void 0,this._lastPostedPayload=void 0,this._dontPostUntilAfter=void 0,this._registrationInFlight=void 0,this._postingPayload=void 0,this._unsubscribe(),c.all([_.default.deleteIds({edfRegistrationId:!0}),g.default.putData(u.InternalKeys.EdfRegistrationInfo,void 0)]).then(n.noop)}_unsubscribe(){const e=this._subscriptions;if(this._subscriptions=[],n.each(e,e=>e.unsubscribe()),this._tokenStoreSubscription){const e=this._tokenStoreSubscription;this._tokenStoreSubscription=void 0,I.default.unsubscribe(e)}if(this._appConfigStoreSubscription){const e=this._appConfigStoreSubscription;this._appConfigStoreSubscription=void 0,d.default.unsubscribe(e)}}_setPushTransportPath(e){this._pushTransportPath!==e&&(this._pushTransportPath=e,this.pushTransportPathChanged.fire(),this._checkState())}_setPushTransportAlertPath(e){this._pushTransportAlertPath!==e&&(this._pushTransportAlertPath=e,this._checkState())}getPushTransportPath(){return this._pushTransportPath}test_updateTrouter(e,t){this._updateTrouter(e,t)}_setTrouterEndpoint(e,t){this._trouterUrl=e,this._trouterTTL=t}hasRegisteredWithService(){return!!this._lastPostedPayload}debug_getLastPayload(){return this._lastPostedPayload}debug_enumerateRegistrations(){return f.default.enumerateRegistrations().then(e=>e.bindings)}_deleteRegistration(){return this._registrationId?f.default.deleteRegistration(this._registrationId):c.Resolved()}_checkStateInner(){if(!I.default.hasUsableSkypeToken())return void p.log(h.LogTraceArea.RegistrarService,"Skipping PNH registration request: No usable SkypeToken");if(!this._registrationId)return void p.log(h.LogTraceArea.RegistrarService,"Skipping PNH registration request: No registrationId");if(!this._trouterUrl&&!this._pushTransportPath)return void p.log(h.LogTraceArea.RegistrarService,"Skipping PNH registration request: No valid transport");const e=Date.now();if(this._dontPostUntilAfter&&e<this._dontPostUntilAfter)return this._retryTimer&&T.default.clearExpiration(this._retryTimer),this._retryTimer=T.default.setExpiration(this._checkState,this._dontPostUntilAfter),void p.log(h.LogTraceArea.RegistrarService,"Skipping PNH registration request: Cannot post until "+this._dontPostUntilAfter);const t=this._buildRegistrationPayload();if(!this._lastPostedTime||!C.default(this._lastPostedPayload,t)||e>this._lastPostedTime+1e3*d.default.getS4LFeatures().pushConfig.refreshIntervalSeconds||e>this._lastPostedTime+this._calcLowestTTLForPayload(this._lastPostedPayload)/2){if(this._registrationInFlight){if(C.default(t,this._postingPayload))return void p.log(h.LogTraceArea.RegistrarService,"Skipping PNH registration request: Already posting");const e=this._registrationInFlight;this._registrationInFlight=void 0,e.cancel()}p.log(h.LogTraceArea.RegistrarService,"Sending PNH registration request:\nClient Description: "+JSON.stringify(t.clientDescription)+", NodeId: "+t.nodeId+", Registration Id: "+t.registrationId+", Transports: "+n.map(t.transports,(e,t)=>{let i="";return"\n"+t+" registered for:"+n.map(e,e=>(i=i||e.path,", Context: "+e.context+", TTL: "+e.ttl+", CreationTime: "+e.creationTime))+", with Path: "+p.piiTrustMeThisIsSafe(i)})),this._postingPayload=t,this._registrationInFlight=f.default.postRegistration(this._postingPayload).finally(()=>{this._registrationInFlight=void 0,this._postingPayload=void 0}).then(()=>{this._dontPostUntilAfter=void 0,this._exponentialTime.reset(),p.log(h.LogTraceArea.RegistrarService,"PNH Registration Succeeded!"),this._lastPostedTime=Date.now(),this._lastPostedPayload=t,this._saveInfoToDb()},e=>{p.warn(h.LogTraceArea.RegistrarService,"PNH Registration errored: "+v.default.errorAsString(e)),this._dontPostUntilAfter=Date.now()+this._exponentialTime.getTimeAndCalculateNext()}).finally(()=>{this._checkState()})}else{const e=this._registrationCompleteDeferred;e&&(p.log(h.LogTraceArea.RegistrarService,"PNH Registration Completed..."),e.resolve(void 0),this._registrationCompleteDeferred=void 0)}}waitForRegistrationComplete(){this._registrationCompleteDeferred||(this._registrationCompleteDeferred=c.Defer());const e=this._registrationCompleteDeferred.promise();return p.log(h.LogTraceArea.RegistrarService,"Awaiting PNH Registration..."),this._checkState(),e}_calcLowestTTLForPayload(e){let t;return n.each(e.transports,e=>{n.each(e,e=>{(!t||e.ttl<t)&&(t=e.ttl)})}),t}_saveInfoToDb(){const e={registrationId:this._registrationId,registrationIdGenerated:this._registrationIdGenerated,lastPostedTime:this._lastPostedTime,lastPostedPayload:this._lastPostedPayload};return g.default.putData(u.InternalKeys.EdfRegistrationInfo,e)}_setAndPersistRegistrationId(e,t){this._setRegistrationId(e,t),this._saveInfoToDb().then(()=>this._checkState())}getRegistrationId(){return this._registrationId}_setRegistrationId(e,t){this._registrationId=e,this._registrationIdGenerated=t,this._registrationId&&_.default.setEdfRegistrationId(this._registrationId)}_buildRegistrationPayload(){const e=n.merge({},this._pushTransportPath?o.default.getTransports(d.default.getS4LFeatures().pushConfig.ttlSeconds,this._pushTransportPath,this._pushTransportAlertPath,M.UICapabilities.alertNotificationEnabled()):{},this._getTrouterTransport());return{registrationId:this._registrationId,nodeId:"",clientDescription:{appId:o.default.getApplicationId(),platform:o.default.getPlatformName(),languageId:m.getLocale(),templateKey:o.default.getTemplateKey(M.UICapabilities.alertNotificationEnabled()),platformUIVersion:w.default.getClientVersionAndPlatform()+"/",notificationFilteringService:o.default.getNotificationFilteringService()},transports:e}}_getTrouterTransport(){return this._trouterUrl?{TROUTER:[{context:"",creationTime:"",path:this._trouterUrl,ttl:this._trouterTTL}]}:{}}getTrouterUrl(){return this._trouterUrl}}},564:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(35),o=i(1452),s=i(51),r=i(8),l=i(7),c=i(3),d=i(4),u=i(432),h=i(161),p=i(22),g=i(19),C=i(20),m=i(62),S=i(1454);t.default=new class{constructor(){this.messageReceived=new s.default,this.trouterChanged=new s.default,this._started=!1,this._activityLevelIsBackground=!1,p.RegisterStartupable(this,"TrouterService",[m.default])}startup(){this._configStoreSubscriptionToken=l.default.subscribe(()=>this._onConfigChanged());const e=l.default.getTrouterJScriptClientConfig();return o.default.initialize({version:C.default.getUIVersion(),sessionIdProvider:()=>C.default.getDeviceId(),tokenProvider:e=>Promise.resolve(m.default.getRawSkypeToken()),urlProvider:()=>l.default.getTrouterJScriptClientConfig().TrouterConnectionUrl,telemetry:{sender:{logEvent(e){d.track(new S.TrouterEvent(e))}},settings:{enabled:e.TelemetryEnabled,logHealthCheckError:e.ClientTelemetryEventEnabled.logHealthCheckError,trouter_js_client_connected:e.ClientTelemetryEventEnabled.trouter_js_client_connected,trouter_js_client_disconnected:e.ClientTelemetryEventEnabled.trouter_js_client_disconnected,trouter_js_client_error:e.ClientTelemetryEventEnabled.trouter_js_client_error,trouter_js_client_progress:e.ClientTelemetryEventEnabled.trouter_js_client_progress,trouter_js_client_response:e.ClientTelemetryEventEnabled.trouter_js_client_response,numberOfStepsToMaintain:e.ClientTelemetryEventEnabled.numberOfStepsToMaintain,sendProgressTimeoutSecs:e.ClientTelemetryEventEnabled.sendProgressTimeoutSecs}},connectivityChanged:h.default.connectivityChangedEvent}),o.default.registerMessageHandler({handleMessage:e=>this.messageReceived.fire(e),canHandleMessage:e=>!a.isNaN(e.eventId)&&e.eventId!==u.PNHEvents.IncomingUnknown&&a.some(a.values(u.PNHEvents),t=>a.toNumber(t)===e.eventId)}),o.default.onConnectedChanged(e=>{if(d.log(c.LogTraceArea.Trouter,"onConnectedChanged "+e),e&&this._waitingForTrouterConnected){const e=this._waitingForTrouterConnected;this._waitingForTrouterConnected=void 0,e.resolve(void 0)}this.trouterChanged.fire(o.default.url(),o.default.ttl())}),m.default.performWhenValidSkypeTokenArrives().then(()=>o.default.start()),this._started=!0,r.Resolved()}logout(e,t,i){l.default.unsubscribe(this._configStoreSubscriptionToken),this.setActivityLevel(!0),this._started=!1}isEnabled(){return o.default.isEnabled()}setActivityLevel(e){this._started?e!==this._activityLevelIsBackground&&(d.log(c.LogTraceArea.Trouter,"Setting activity level to "+(e?"background":"foreground")),this._activityLevelIsBackground=e,o.default.setTrouterActivityLevel(this._activityLevelIsBackground),this._activityLevelIsBackground?n.default.disableWifiLock().catch(e=>{d.warn(c.LogTraceArea.Trouter,"disableWifiLock failed: "+g.default.errorAsString(e))}):n.default.enableWifiLock().catch(e=>{d.warn(c.LogTraceArea.Trouter,"enableWifiLock failed: "+g.default.errorAsString(e))})):d.log(c.LogTraceArea.Trouter,"Ignoring setActivityLevel call - not started")}getUrl(){return o.default.url()}getTTL(){return o.default.ttl()}performWhenTrouterIsConnected(){return o.default.isConnected()?r.Resolved():(this._waitingForTrouterConnected||(this._waitingForTrouterConnected=r.Defer()),this._waitingForTrouterConnected.promise())}_onConfigChanged(){const e=l.default.getCachedEcsConfig();return e?o.default.setEcsConfig(e.config):(d.log(c.LogTraceArea.Trouter,"No cached ECS settings available"),r.Resolved())}}},582:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(25),n=i(1),o=i(15),s=i(8),r=i(80),l=i(49),c=i(71);let d=class extends o.StoreBase{constructor(){super(...arguments),this._dbLookups={},this._usersByPhoneNumber={},this._usersByPhoneNumberPromise={}}_startedTrackingKey(e){this._dbLookups[e]||(this._dbLookups[e]=l.default.getUserProfilesByPhoneNumber(e).finally(()=>{delete this._dbLookups[e]}).then(t=>{this._isTrackingKey(e)&&(this._usersByPhoneNumber[e]=t,this.trigger(e))}))}_stoppedTrackingKey(e){const t=this._dbLookups[e];t&&(delete this._dbLookups[e],t.cancel()),delete this._usersByPhoneNumber[e]}getSortedUsersByPhoneNumber(e){return this._sortFoundUsers(this._usersByPhoneNumber[e])}getSortedUsersByPhoneNumberAsync(e){return this._usersByPhoneNumber[e]?s.Resolved(this._usersByPhoneNumber[e]):(this._usersByPhoneNumberPromise[e]||(this._usersByPhoneNumberPromise[e]=l.default.getUserProfilesByPhoneNumber(e).finally(()=>{delete this._usersByPhoneNumberPromise[e]}).then(e=>this._sortFoundUsers(e))),this._usersByPhoneNumberPromise[e])}getUserByPhoneNumberExactMatch(e){return this._getFirstUserMriByExactPhone(this.getSortedUsersByPhoneNumber(e),e)}getUserByPhoneNumberExactMatchAsync(e){return this._usersByPhoneNumberPromise[e]||(this._usersByPhoneNumberPromise[e]=this.getSortedUsersByPhoneNumberAsync(e)),this._usersByPhoneNumberPromise[e].then(t=>this._getFirstUserMriByExactPhone(t,e))}_getFirstUserMriByExactPhone(e,t){return n.find(e,e=>!!e.phones&&!!n.find(e.phones,e=>e.number===t))}_sortFoundUsers(e){const t=c.default.dangerousGetContactMriListMutable();return r.chain(e,r.filter(e=>e.getMri()&&n.includes(t,e.getMri())),r.sortBy(e=>e.getDisplayName().toLowerCase()))}test_reset(){this._dbLookups={},this._usersByPhoneNumberPromise={},this._usersByPhoneNumber={}}};a.__decorate([o.disableWarnings],d.prototype,"_startedTrackingKey",null),a.__decorate([o.disableWarnings],d.prototype,"_stoppedTrackingKey",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],d.prototype,"getSortedUsersByPhoneNumber",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],d.prototype,"getUserByPhoneNumberExactMatch",null),d=a.__decorate([o.AutoSubscribeStore],d);const u=new d;t.default=u},583:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ToggleCallStatsCommand=t.ShowBingBackgroundsCommand=t.InvitePeopleCommand=t.NativeMobileInvitePeopleCommand=t.ToggleTranslatorCommand=t.ToggleIncomingVideoCommand=t.BackgroundBlurCommand=t.ToggleRecordCommand=t.ChangeTogetherModeBackgroundCommand=t.ToggleAudienceModeCommand=t.MomentCommand=t.SendReactionCommand=t.AddToCallCommand=void 0;const a=i(1),n=i(508),o=i(7),s=i(29),r=i(584),l=i(1539),c=i(219),d=i(87),u=i(60),h=i(53),p=i(302),g=i(33),C=i(3),m=i(148),S=i(4),y=i(5),f=i(697),_=i(178),b=i(18),v=i(78),w=i(48),T=i(345),I=i(369),P=i(515),M=i(10),k=i(300),A=i(32);t.AddToCallCommand=class{constructor(e,t,i,a,n){this._callId=e,this._info=t,this._conversationMri=i,this._context=a,this._origin=n}canExecute(){return s.default.CallingFeaturesHelper.allowAddToCall(this._info)}execute(){const e=M.default.newCauseId();S.log(C.LogTraceArea.CallingUI,"AddToCallCommand.execute callId: ${this._callId} causeId: ${causeId}"),S.log(C.LogTraceArea.CallingUI,"AddToCallCommand.onNavigateAwayFrom Call onCallScreenClose,callId: ${this._callId} causeId: ${causeId}"),n.default.onCallScreenClose(),b.default.openAddToCall(this._conversationMri,this._callId,this._origin,this._context(),e),I.default.updateCallRosterTelemetry(this._callId,e,e=>e.callRosterAddToCall())}};t.SendReactionCommand=class{constructor(e,t,i,a,n){this._reactionType=e,this._reactionKey=t,this._callId=i,this._info=a,this._reactionsConversationMri=n}canExecute(){return s.default.CallingFeaturesHelper.allowReactions(this._info)}execute(){const e=M.default.newCauseId();S.log(C.LogTraceArea.CallingUI,"SendReactionCommand.execute callId: ${this._callId} causeId: ${causeId}");const t={reactionInfo:{type:this._reactionType,key:this._reactionKey},causeId:e,timestamp:Date.now(),postSource:C.PostSource.CallReactionPressed,callId:this._callId,conversationMri:this._info.conversationMri,reactionsConversationMri:this._reactionsConversationMri,logTraceArea:C.LogTraceArea.CallReactionsDrawer};r.CallReactionPostingHelpers.postReaction(t)}};t.MomentCommand=class{constructor(e,t,i){this._callId=e,this._info=t,this._reactionsConversationMri=i}canExecute(){return s.default.CallingFeaturesHelper.allowSnapshots(this._info)&&h.CallingCapabilities.callSnapshotSupported()}execute(){const e=M.default.newCauseId(),t=T.default.SkypeCameraCapture;S.log(C.LogTraceArea.CallingUI,"MomentCommand.execute callId: ${this._callId} causeId: ${causeId}");const i=[this._info.conversationMri],a=this._info.conversationMri,n=this._reactionsConversationMri;let o=s.default.CallingStore.getRankedSpeakerMris(this._callId);t.playOnce(e),l.default.takeSnapshot(e,this._callId,a,n,o,i),w.default.maybeAnnounceForAccessibility(y.getString("CallPanel.SnapshotPosted")),d.default.updateCallTelemetry(this._callId,e,e=>e.postPhotoSnapshot())}};t.ToggleAudienceModeCommand=class{constructor(e,t,i){this._callId=e,this._info=t,this._isAudienceMode=i}canExecute(){return s.default.CallingFeaturesHelper.allowCallAudienceBot(this._info)}execute(){const e=M.default.newCauseId();S.log(C.LogTraceArea.CallingUI,"AudienceCommand.execute callId: ${this._callId} causeId: ${causeId}"),this._isAudienceMode?s.default.InCallBotService.stopAudienceMode(this._callId,e):s.default.InCallBotService.startAudienceMode(this._callId,e)}};class R{constructor(e,t){this._callId=e,this._conversationMri=t}canExecute(){return R.canExecute(this._callId,this._conversationMri)}static canExecute(e,t){if(a.isUndefined(e)||a.isUndefined(t))return!1;const i=c.default.getStageMode(e)===u.StageMode.TogetherMode,{enabledBackgroundSelection:n}=o.default.getS4LCMCFeatures().callAudienceBotConfig,r=s.default.CallingStore.isConnectedAudienceBotInCall(e),l=!a.isEmpty(P.default.getTogetherModeBackgrounds()),d=R._isAllowedToChangeBackgroundIfInModeratedGroup(t);if(i&&n&&r&&d){if(l)return!0;{const e="ChangeTogetherModeBackgroundCommand.canExecute no TogetherMode backgrounds to choose from";return S.warn(C.LogTraceArea.CallingUI,e),!1}}return!1}static _isAllowedToChangeBackgroundIfInModeratedGroup(e){const t=e&&g.default().getConversation(e);return!_.isModerated(t)||_.isCurrentUserAdminInModeratedGroup(t)}execute(){const e=M.default.newCauseId();d.default.togetherModeSceneChangeRequestCount(this._callId,e);const t={conversationMri:this._conversationMri,onChangeBackground:t=>{s.default.AudienceBotService.selectAudienceScene(this._callId,e,t.sceneId)},onStartTogetherMode:a.noop,onClose:a.noop,isAudienceBotInCall:!0,selectedBackground:void 0};b.default.navigateToTogetherModePanel(t,P.default.getPanelId())}}t.ChangeTogetherModeBackgroundCommand=R;t.ToggleRecordCommand=class{constructor(e,t,i){this._callId=e,this._info=t,this._isRecording=i}canExecute(){const e=s.default.CallingStore.getCallRecordingInitiator(this._callId);return s.default.CallingFeaturesHelper.allowRecording(this._info)&&s.default.InCallBotUtils.showCallRecorderControls(e)}execute(){const e=M.default.newCauseId();S.log(C.LogTraceArea.CallingUI,"RecordCommand.execute callId: ${this._callId} causeId: ${causeId}"),this._isRecording?s.default.InCallBotService.stopRecording(this._callId,e):s.default.InCallBotService.startRecording(this._callId,e)}};t.BackgroundBlurCommand=class{constructor(e,t,i,a){this._callId=e,this._isVideoActive=t,this._isBackgroundBlurEnabled=i,this._isBackgroundBlurSelected=a}canExecute(){return this._isBackgroundBlurEnabled&&this._isVideoActive}execute(){const e=M.default.newCauseId();S.log(C.LogTraceArea.CallingUI,`BackgroundBlurCommand.execute callId: ${this._callId} causeId: ${e}`),this._isVideoActive&&(this._isBackgroundBlurSelected=!this._isBackgroundBlurSelected,s.default.DeviceStore.setBackgroundBlurred(this._isBackgroundBlurSelected))}};t.ToggleIncomingVideoCommand=class{constructor(e,t,i,a){this._callId=e,this._info=t,this._audioOnlyEnabled=i,this._isIncomingVideoDisabled=a}canExecute(){return s.default.CallingFeaturesHelper.allowIncomingVideoToBeDisabled(this._info)}execute(){const e=M.default.newCauseId();S.log(C.LogTraceArea.CallingUI,"IncomingVideoCommand.execute callId: ${this._callId} causeId: ${causeId}"),this._audioOnlyEnabled?s.default.CallingStore.stopAudioOnly(this._callId,e):this._isIncomingVideoDisabled?s.default.CallingStore.enableIncomingVideo(this._callId,e):s.default.CallingStore.disableIncomingVideo(this._callId,e)}};t.ToggleTranslatorCommand=class{constructor(e,t,i){this._callId=e,this._info=t,this._isTranslating=i}canExecute(){const e=m.default.isConversationTranslated(this._info.conversationMri);return s.default.CallingFeaturesHelper.allowCaptioning(this._info)&&!e}execute(){const e=M.default.newCauseId();S.log(C.LogTraceArea.CallingUI,"TranslatorCommand.execute callId: ${this._callId} causeId: ${causeId}"),this._isTranslating?s.default.InCallBotService.stopTranslator(this._callId,e):s.default.InCallBotService.startTranslator(this._callId,e)}};t.NativeMobileInvitePeopleCommand=class{constructor(e,t,i){this._conversationId=e,this._origin=t,this._callId=i}canExecute(){const e=g.default().getConversation(this._conversationId);return!!(e&&e.isMeetNowThread()&&e.isJoinEnabled())&&(this._joinLink=p.default.getLink(this._conversationId),!!this._joinLink)}execute(){this._joinLink&&f.default.showMobile({threadId:this._conversationId,joinLink:this._joinLink,callId:this._callId,meetNowParameters:{origin:this._origin}})}};t.InvitePeopleCommand=class{constructor(e,t){this._conversationId=e,this._rootViewId=t}canExecute(){var e;const t=g.default().getConversation(this._conversationId);return null!==(e=null==t?void 0:t.isGroupConversation())&&void 0!==e&&e}execute(){const e=A.default.getDisplayName(this._conversationId);b.default.navigateToGroupShare(this._conversationId,e,k.InviteLinkOrigin.QuickCallPanel,this._rootViewId)}};t.ShowBingBackgroundsCommand=class{constructor(e,t){this._callId=e,this._context=t}canExecute(){const e=s.default.CallingFeaturesHelper.bingBackgroundsEnabled(),t=s.default.CallParticipantBackgroundInfoStore.captionsReceivedCount(this._callId);return e&&t>0}execute(){S.log(C.LogTraceArea.CallingUI,"ShowBingBackgroundsCommand.execute callId: ${this._callId}"),S.log(C.LogTraceArea.CallingUI,"ShowBingBackgroundsCommand.onNavigateAwayFrom Call onCallScreenClose,callId: ${this._callId} causeId: ${causeId}"),n.default.onCallScreenClose(),b.default.openBingBackgroundsOverview(this._callId,this._context())}};t.ToggleCallStatsCommand=class{constructor(e,t,i){this._callId=e,this._context=t,this._modal=i}canExecute(){return o.default.getS4LCMCFeatures().enableCallTechnicalInformation&&!v.default.isMobileScreenReaderEnabled()&&h.CallingCapabilities.callTechnicalInformationSupported()}execute(){b.default.navigateToCallingDebugPanel(this._callId,this._context,this._modal)}}},584:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallReactionPostingHelpers=void 0;const a=i(29),n=i(325),o=i(692),s=i(87),r=i(60),l=i(139),c=i(94),d=i(4),u=i(84),h=i(324),p=i(39),g=i(28),C=i(137);t.CallReactionPostingHelpers=class{static postReaction(e){e.reactionInfo.type===r.ReactionsItemType.Sticker?this._postStickerText(e):e.reactionInfo.type===r.ReactionsItemType.Emoticon?this._postEmoticon(e):e.reactionInfo.type===r.ReactionsItemType.Snapshot?this._postSnapshot(e):e.reactionInfo.type===r.ReactionsItemType.Animation?this._postAnimation(e):e.reactionInfo.type===r.ReactionsItemType.CallEvent&&this._postCallEvent(e)}static _postAnimation(e){const t=e.reactionInfo.key;this._postHelper(e,"animation",()=>{const i=[new c.UnhandledEntity(t)];e.callId&&(i.push(new c.CallReactionMetadataEntity(e.callId,g.ReactionsTextStyle.Animation)),s.default.updateCallTelemetry(e.callId,e.causeId,e=>e.postAnimationReaction()),s.default.trackInCallReaction(t,"animation",!1,!1,!0));const a=l.createMessageInfo(e.reactionsConversationMri,e.postSource,i,void 0,o.default.getReactionsThreadPostParams(e.conversationMri));u.default.postMessage(a),s.default.trackInCallActivity(e.callId,e.reactionsConversationMri,a.messageForPosting.clientmessageid)})}static _postEmoticon(e){this._postHelper(e,"emoticon",()=>a.default.CallPostMessageService.postEmoticonReactionString(e.reactionInfo.key,e.conversationMri,e.reactionsConversationMri,e.callId,void 0,e.causeId))}static _postStickerText(e){const t=h.default.textForImageSticker(e.reactionInfo.key);t&&t.length&&this._postHelper(e,"sticker",()=>{const i=[new c.UnhandledEntity(t)];e.callId&&(i.push(new c.CallReactionMetadataEntity(e.callId,g.ReactionsTextStyle.Sticker)),s.default.updateCallTelemetry(e.callId,e.causeId,e=>e.postTextReaction()),s.default.trackInCallReaction(t,"sticker",!1,!1,!1));const a=l.createMessageInfo(e.reactionsConversationMri,e.postSource,i,void 0,o.default.getReactionsThreadPostParams(e.conversationMri));u.default.postMessage(a),s.default.trackInCallActivity(e.callId,e.reactionsConversationMri,a.messageForPosting.clientmessageid)})}static _postSnapshot(e){const t=e.reactionInfo.key;if(!t.length)return;const i=[new c.UnhandledEntity(t)];e.callId&&i.push(new c.CallReactionMetadataEntity(e.callId,g.ReactionsTextStyle.Snapshot));const a=l.createMessageInfo(e.reactionsConversationMri,e.postSource,i,void 0,o.default.getReactionsThreadPostParams(e.conversationMri));u.default.postMessage(a)}static _postCallEvent(e){const t=e.reactionInfo.key;if(!t.length)return;const i=[new c.UnhandledEntity(t)];e.callId&&i.push(new c.CallReactionMetadataEntity(e.callId,g.ReactionsTextStyle.CallEvent,e.reactionInfo.internalType,e.reactionInfo.userMri));const a=l.createMessageInfo(e.reactionsConversationMri,e.postSource,i,void 0,o.default.getReactionsThreadPostParams(e.conversationMri));u.default.postMessage(a)}static _postHelper(e,t,i){let a;d.log(e.logTraceArea,"_postHelper, type: "+t+" reactionsConversationId: "+p.mriOrId(e.reactionsConversationMri)+" callId: "+e.callId+" causeId: "+e.causeId),e.timestamp&&(a=new C.default(C.ScenarioName.RenderLocalCallReaction),a.start(void 0,e.timestamp),a.markStepCompleted("onReactionPressed"),n.default.setReactionPressedScenario(a)),n.default.setHasPostedReactions(e.reactionsConversationMri,!0),i(),a&&a.markStepCompleted("posted")}}},588:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(25),n=i(1),o=i(74),s=i(34),r=i(15),l=i(7),c=i(4),d=i(29),u=i(219),h=i(60),p=i(3),g=i(37),C=i(3169),m=i(103),S=i(10),y=i(518);let f=class extends r.StoreBase{constructor(){super(...arguments),this._remoteCallElements=new Map,this._stageElements=[],this._trayElements=[],this._stageCapacity=Number.MAX_VALUE,this._trayWidth=Number.MAX_VALUE,this._trayRemainder=0}_startedTrackingKey(e){c.log(p.LogTraceArea.CallingUI,"CallScreenElementsStore._startedTrackingKey: callId "+e),this._callId=e,this._layoutStoreSubscription||(this._layoutStoreSubscription=u.default.subscribe(()=>this._onLayoutStoreUpdate(e),e)),this._callParticipantsStoreSubscription||(this._callParticipantsStoreSubscription=d.default.CallParticipantStore.subscribe(()=>this._onParticipantsChanged(e),e)),this._callPinningStoreSubscription||(this._callPinningStoreSubscription=y.default.subscribe(()=>this._onParticipantsChanged(e),e)),this._onLayoutStoreUpdate(e),this._onParticipantsChanged(e)}_stoppedTrackingKey(e){const t=S.default.newCauseId();c.log(p.LogTraceArea.CallingUI,"CallScreenElementsStore cleaning up subscriptions for call "+e+" causeId: "+t),this._cleanupFullscreenBotStreamOverrides(e,t),n.isUndefined(this._layoutStoreSubscription)||(u.default.unsubscribe(this._layoutStoreSubscription),this._layoutStoreSubscription=void 0),n.isUndefined(this._callParticipantsStoreSubscription)||(d.default.CallParticipantStore.unsubscribe(this._callParticipantsStoreSubscription),this._callParticipantsStoreSubscription=void 0),n.isUndefined(this._callPinningStoreSubscription)||(y.default.unsubscribe(this._callPinningStoreSubscription),this._callPinningStoreSubscription=void 0),this._callId=void 0}_onLayoutStoreUpdate(e){var t;const i=u.default.getStageMode(e),a=S.default.newCauseId();c.log(p.LogTraceArea.CallingUI,"CallScreenElementsStore._onLayoutStoreUpdate: callId "+e+" stageMode: "+h.StageMode[i]+" causeId: "+a),this._cleanupFullscreenBotStreamOverrides(e,a),this._manager=this._getStageModeManager(i,a),this._updateScreenElements(null===(t=this._manager)||void 0===t?void 0:t.onInit(this._getCallParticipantsMris()))}_cleanupFullscreenBotStreamOverrides(e,t){d.default.CallingStore.unregisterRemoteStreamOverride(e,m.VideoOverrideReason.FullScreenBot,t)}_registerFullscreenBotStreamOverrides(e,t){d.default.CallingStore.registerRemoteStreamOverride(e,m.VideoOverrideReason.FullScreenBot,t)}_updateScreenElements(e){e&&(this._setStageParticipants(e.stageParticipants),this._setTrayParticipants(e.trayParticipants),this._setTrayRemainder(e.trayRemainder||0))}_getStageModeManager(e,t){if(this._callId)switch(e){case h.StageMode.Grid:case h.StageMode.Manual:return new C.GridModeElementsManager(this._callId,this._trayWidth,this._stageCapacity,u.default.getOnlyVideoOnTheStage(this._callId),u.default.getSelfInTheGrid(this._callId));case h.StageMode.Speaker:return new C.SpeakerModeElementsManager(this._callId,this._trayWidth);case h.StageMode.Presentation:case h.StageMode.FocusedScreenShare:return new C.PresentationModeElementsManager(this._callId,this._trayWidth);case h.StageMode.LargeGrid:return this._registerFullscreenBotStreamOverrides(this._callId,t),new C.LgTmModeElementsManager(this._callId,this._trayWidth,C.FullScreenBotType.LargeGrid);case h.StageMode.TogetherMode:return this._registerFullscreenBotStreamOverrides(this._callId,t),new C.LgTmModeElementsManager(this._callId,this._trayWidth,C.FullScreenBotType.TogetherMode)}else c.error(p.LogTraceArea.CallingUI,"CallScreenElementsStore._getStageModeManager call id is undefined")}_onParticipantsChanged(e){var t;const i=this._getCallParticipantsMris(),a=d.default.CallParticipantStore.getParticipantRenderInfosForCall(e),s=[];a.forEach(e=>{l.default.getS4LCMCFeatures().enableMultipleStreamSupport?n.each(e.streams,t=>{const i=e.mri+"_"+t.endpointId;this._remoteCallElements.set(i,{mri:e.mri,endpointId:t.endpointId,participantState:e.state||o.ParticipantState.None,isScreenShare:e.isAScreensharing})}):this._remoteCallElements.set(e.renderKey,{mri:e.mri,participantState:e.state||o.ParticipantState.None,isScreenShare:e.isAScreensharing}),s.push(e.renderKey)});const r=n.difference(i,s);n.each(r,e=>{this._remoteCallElements.delete(e)}),this._updateScreenElements(null===(t=this._manager)||void 0===t?void 0:t.updateParticipants(this._getCallParticipantsMris()))}_setStageParticipants(e){g.default(this._stageElements,e)||(c.log(p.LogTraceArea.CallingUI,"Stage participants for callId "+this._callId+" updated. New stage elements: "+s.pii.Omit(e.toString())),this._stageElements=e,this.trigger(this._callId))}_setTrayParticipants(e){n.xor(this._trayElements,e).length&&(c.log(p.LogTraceArea.CallingUI,"Tray participants for callId "+this._callId+" updated. New tray elements: "+s.pii.Omit(e.toString())),this._trayElements=e,this.trigger(this._callId))}_getCallParticipantsMris(){return Array.from(this._remoteCallElements.keys())}_setTrayRemainder(e){this._trayRemainder!==e&&(this._trayRemainder=e,this.trigger(this._callId))}getStageElements(e){return n.clone(this._stageElements)}getTrayElements(e){return n.clone(this._trayElements)}getTrayRemainder(e){return this._trayRemainder}trayHasParticipants(e){return this._trayElements.length>0}setStageCapacity(e){if(this._manager&&this._manager instanceof C.GridModeElementsManager&&this._stageCapacity!==e){this._stageCapacity=e;const t=this._getCallParticipantsMris();this._updateScreenElements(this._manager.updateStageCapacity(t,this._stageCapacity))}}getStageCapacity(){return this._stageCapacity}setTrayWidth(e){var t;if(this._trayWidth!==e&&0!==e){this._trayWidth=e;const i=this._getCallParticipantsMris();this._updateScreenElements(null===(t=this._manager)||void 0===t?void 0:t.setTrayWidth(e,i))}}getRemoteCallElements(e){return n.clone(this._remoteCallElements)}};a.__decorate([r.disableWarnings],f.prototype,"_startedTrackingKey",null),a.__decorate([r.disableWarnings],f.prototype,"_stoppedTrackingKey",null),a.__decorate([r.autoSubscribe,a.__param(0,r.key)],f.prototype,"getStageElements",null),a.__decorate([r.autoSubscribe,a.__param(0,r.key)],f.prototype,"getTrayElements",null),a.__decorate([r.autoSubscribe,a.__param(0,r.key)],f.prototype,"getTrayRemainder",null),a.__decorate([r.autoSubscribe,a.__param(0,r.key)],f.prototype,"trayHasParticipants",null),a.__decorate([a.__param(0,r.key)],f.prototype,"getRemoteCallElements",null),f=a.__decorate([r.AutoSubscribeStore],f),t.default=new f},60:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MobileLayoutPickerItemHeight=t.DesktopLayoutPickerItemHeight=t.BigTrayCallParticipantAvatarSize=t.BigTrayOverflowButtonWidth=t.BigTrayCallParticipantWidth=t.CallPanelHeaderHeight=t.RibbonType=t.ScreenShareIcon=t.DesktopMinCallPanelHeaderV2WidthBreakpoint=t.DesktopMinCallRibbonWidthBreakpoint=t.DesktopMinCallPanelHeaderWidthBreakpoint=t.DesktopMinSmallestNewCallControlsWidthBreakpoint=t.DesktopMinStageTwoNewCallControlsWidthBreakpoint=t.DesktopMinNewCallControlsWidthBreakpoint=t.DesktopMinSmallestCallControlsWidthBreakpoint=t.DesktopMinStageTwoCallControlsWidthBreakpoint=t.DesktopMinCallControlsWidthBreakpoint=t.ParticipantEventType=t.CallControlsType=t.ReactionsItemType=t.PhotoAnimationDirection=t.ToastActionType=t.CallRosterOrigin=t.LayoutPickerMenuItemType=t.StageMode=t.DeviceStatusToastType=t.CallControlsKeys=t.InCallWarningViewType=t.CallParticipantStreamsStatus=t.ActiveCallStatus=t.VideoStatus=t.RibbonExtraVisibility=t.CallPanelHeaderLayout=t.ParticipantDragState=t.LayoutInfoVideoType=t.DesktopTopTrayHeight=t.DesktopNewHeaderHeight=t.DesktopCallControlsHeight=t.CallStageViewMode=t.CallControlsOverflowItem=t.CallStageConfig=t.CallButtonSizes=t.RibbonSizes=t.CallAccessoryType=t.CallAccessoryPosition=t.HoveringParticipantSource=t.CallStageElementKeys=t.CallingViewUIPostion=t.CallingViewCornerPostion=t.CallUIState=void 0,t.LayoutPickerButtonWidth=void 0;const a=i(11);!function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.IncomingRing=2]="IncomingRing",e[e.OutgoingRing=3]="OutgoingRing",e[e.Disconnected=4]="Disconnected",e[e.Voicemail=5]="Voicemail",e[e.GoLiveSinglePlayer=6]="GoLiveSinglePlayer"}(t.CallUIState||(t.CallUIState={})),function(e){e[e.NotAtCorner=0]="NotAtCorner",e[e.UpperLeft=1]="UpperLeft",e[e.UpperRight=2]="UpperRight",e[e.BottomLeft=3]="BottomLeft",e[e.BottomRight=4]="BottomRight"}(t.CallingViewCornerPostion||(t.CallingViewCornerPostion={})),function(e){e[e.Stage=0]="Stage",e[e.Ribbon=1]="Ribbon",e[e.FloatingOnTop=2]="FloatingOnTop",e[e.RibbonWidowsMode=3]="RibbonWidowsMode"}(t.CallingViewUIPostion||(t.CallingViewUIPostion={})),t.CallStageElementKeys={remainderViewKey:"ringingview",callstageViewKey:"callview",screenShareViewKey:"screenshareview",callTextReactionViewKey:"calltextreactionview",ribbonModeViewKey:"ribbonmode",localUserKey:"local",addToCallViewKey:"addtocall",bingBackgrounds:"bingBackgrounds"},function(e){e[e.Participant=1]="Participant",e[e.Nametag=2]="Nametag"}(t.HoveringParticipantSource||(t.HoveringParticipantSource={})),function(e){e[e.Center=1]="Center",e[e.TopLeft=2]="TopLeft",e[e.TopRight=3]="TopRight",e[e.BottomLeft=4]="BottomLeft",e[e.BottomRight=5]="BottomRight"}(t.CallAccessoryPosition||(t.CallAccessoryPosition={})),function(e){e[e.Mute=1]="Mute",e[e.OnHold=2]="OnHold",e[e.Screensharing=3]="Screensharing"}(t.CallAccessoryType||(t.CallAccessoryType={})),t.RibbonSizes={ribbonItemSizeSmall:60,ribbonItemSizeLarge:100,defaultRibbonItemTopMargin:16,ribbonItemModernStageTopMargin:10,ribbonItemInnerMargin:16,ribbonItemMargin:16,ribbonItemRectBorderRadius:10,ribbonDropTargetSmallHeight:80,ribbonDropTargetLargeHeight:132,ribbonModeElementSize:40},t.CallButtonSizes={callbuttonExtraLargeSize:64,callbuttonLargeSize:52,callbuttonSmallSize:a.IconSize.size40,callbuttonExtraSmallSize:a.IconSize.size32,callbuttonSmallestSize:a.IconSize.size24},t.CallStageConfig={animationDuration:250,maxStageElements:4},function(e){e[e.Reactions=1]="Reactions",e[e.Chat=2]="Chat",e[e.AddPeople=3]="AddPeople",e[e.Gallery=4]="Gallery",e[e.Moments=5]="Moments",e[e.CallRecording=6]="CallRecording",e[e.CallTranslator=7]="CallTranslator",e[e.IncomingVideo=8]="IncomingVideo",e[e.AudienceChangeBackground=9]="AudienceChangeBackground",e[e.HeartReaction=10]="HeartReaction",e[e.CelebrationAnimation=11]="CelebrationAnimation",e[e.ThumbsUpReaction=12]="ThumbsUpReaction",e[e.MobileScreenSharing=13]="MobileScreenSharing",e[e.CallStats=14]="CallStats",e[e.BackgroundBlur=15]="BackgroundBlur",e[e.RaiseHands=16]="RaiseHands",e[e.LowerHands=17]="LowerHands",e[e.ChangeTogetherModeBackground=18]="ChangeTogetherModeBackground",e[e.BingBackgrounds=19]="BingBackgrounds"}(t.CallControlsOverflowItem||(t.CallControlsOverflowItem={})),function(e){e[e.None=0]="None",e[e.StageAndRibbon=1]="StageAndRibbon",e[e.RibbonOnly=2]="RibbonOnly",e[e.StageOnly=3]="StageOnly"}(t.CallStageViewMode||(t.CallStageViewMode={})),t.DesktopCallControlsHeight=70,t.DesktopNewHeaderHeight=40,t.DesktopTopTrayHeight=128,function(e){e[e.None=1]="None",e[e.Portrait=2]="Portrait",e[e.Landscape=3]="Landscape"}(t.LayoutInfoVideoType||(t.LayoutInfoVideoType={})),function(e){e[e.Unspecified=0]="Unspecified",e[e.Pan=1]="Pan",e[e.Move=2]="Move"}(t.ParticipantDragState||(t.ParticipantDragState={})),function(e){e[e.Mobile=0]="Mobile",e[e.Float=1]="Float",e[e.Window=2]="Window",e[e.None=3]="None"}(t.CallPanelHeaderLayout||(t.CallPanelHeaderLayout={})),function(e){e[e.None=0]="None",e[e.Hidden=1]="Hidden",e[e.Visible=2]="Visible"}(t.RibbonExtraVisibility||(t.RibbonExtraVisibility={})),function(e){e[e.None=0]="None",e[e.Available=1]="Available",e[e.Streaming=2]="Streaming"}(t.VideoStatus||(t.VideoStatus={})),function(e){e[e.None=0]="None",e[e.Connected=1]="Connected",e[e.OnHold=2]="OnHold"}(t.ActiveCallStatus||(t.ActiveCallStatus={})),function(e){e[e.None=0]="None",e[e.Single=1]="Single",e[e.Multiple=2]="Multiple"}(t.CallParticipantStreamsStatus||(t.CallParticipantStreamsStatus={})),function(e){e[e.Audio=0]="Audio",e[e.Network=1]="Network",e[e.Voicemail=2]="Voicemail",e[e.Forwarding=3]="Forwarding"}(t.InCallWarningViewType||(t.InCallWarningViewType={})),function(e){e.Mic="mic",e.MicQuickSettings="micQuickSettings",e.Video="video",e.VideoQuickSettings="videoQuickSettings",e.Dialpad="dialpad",e.Participants="participants",e.ScreenShare="screenShare",e.ScreenShareControl="screenShareControl",e.EndCall="endCall",e.RaiseHand="raiseHand",e.LowerHand="lowerHand",e.ShareLink="shareLink",e.ChangeScene="changeScene",e.Record="recordCall",e.ReactionsDrawer="reactionspicker",e.Overflow="overflow",e.Moments="moments",e.Chat="chat",e.TwinCam="twinCam"}(t.CallControlsKeys||(t.CallControlsKeys={})),function(e){e[e.None=0]="None",e[e.SpeakerDisconnected=1]="SpeakerDisconnected",e[e.MicrophoneDisconnected=2]="MicrophoneDisconnected",e[e.CompositeAudioAvailable=3]="CompositeAudioAvailable",e[e.AudioStoppedWorking=4]="AudioStoppedWorking",e[e.MicrophoneStoppedWorking=5]="MicrophoneStoppedWorking",e[e.SpeakerStoppedWorking=6]="SpeakerStoppedWorking",e[e.AudioDeviceBusy=7]="AudioDeviceBusy",e[e.SoundSharingStopped=8]="SoundSharingStopped",e[e.VideoStoppedWorking=9]="VideoStoppedWorking",e[e.VideoTimedOut=10]="VideoTimedOut",e[e.VideoSystemOutOfMemory=11]="VideoSystemOutOfMemory",e[e.VideoSystemBusy=12]="VideoSystemBusy",e[e.SpeakerChanged=13]="SpeakerChanged",e[e.MicrophoneChanged=14]="MicrophoneChanged",e[e.CameraChanged=15]="CameraChanged",e[e.DeviceCausingEcho=16]="DeviceCausingEcho",e[e.MicrophoneNotMuteButSilent=17]="MicrophoneNotMuteButSilent",e[e.MicrophoneServerMuted=18]="MicrophoneServerMuted",e[e.OutgoingVideoDisabledDuringScreenSharing=19]="OutgoingVideoDisabledDuringScreenSharing",e[e.DeviceRenderGlitches=20]="DeviceRenderGlitches",e[e.DeviceLowSNR=21]="DeviceLowSNR",e[e.DeviceClipping=22]="DeviceClipping",e[e.DeviceEcho=23]="DeviceEcho",e[e.DeviceMultipleEndpoints=24]="DeviceMultipleEndpoints",e[e.DeviceRenderZeroVolume=25]="DeviceRenderZeroVolume",e[e.CpuInsufficient=26]="CpuInsufficient",e[e.ZeroCaptureDevicesEnumerated=27]="ZeroCaptureDevicesEnumerated",e[e.ZeroRenderDevicesEnumerated=28]="ZeroRenderDevicesEnumerated",e[e.VideoCaptureDeviceFreeze=29]="VideoCaptureDeviceFreeze",e[e.AudioCapturePermissionDenied=30]="AudioCapturePermissionDenied",e[e.VideoCapturePermissionDenied=31]="VideoCapturePermissionDenied",e[e.VideoCaptureFreezeRecovered=32]="VideoCaptureFreezeRecovered",e[e.DeviceRenderHowling=33]="DeviceRenderHowling",e[e.PresentationAudioLoopbackDeviceState=34]="PresentationAudioLoopbackDeviceState",e[e.RemoteNetworkConnectivityIssue=35]="RemoteNetworkConnectivityIssue",e[e.AudioCaptureUltrasoundDetected=36]="AudioCaptureUltrasoundDetected",e[e.MusicModeNotAvailable=37]="MusicModeNotAvailable",e[e.CameraLighting=38]="CameraLighting",e[e.ImageRenderingQuality=39]="ImageRenderingQuality",e[e.VideoEffectsQualityChange=40]="VideoEffectsQualityChange"}(t.DeviceStatusToastType||(t.DeviceStatusToastType={})),function(e){e[e.Speaker=0]="Speaker",e[e.FocusedScreenShare=1]="FocusedScreenShare",e[e.Grid=2]="Grid",e[e.Manual=3]="Manual",e[e.Presentation=4]="Presentation",e[e.TogetherMode=5]="TogetherMode",e[e.LargeGrid=6]="LargeGrid"}(t.StageMode||(t.StageMode={})),function(e){e[e.Divider=0]="Divider",e[e.StageModeSpeaker=1]="StageModeSpeaker",e[e.StageModeFocusedScreenShare=2]="StageModeFocusedScreenShare",e[e.StageModeGrid=3]="StageModeGrid",e[e.StageModeManual=4]="StageModeManual",e[e.StageModePresentation=5]="StageModePresentation",e[e.StageModeTogetherMode=6]="StageModeTogetherMode",e[e.StageModeLargeGrid=7]="StageModeLargeGrid",e[e.OnlyVideoOnTheStage=8]="OnlyVideoOnTheStage",e[e.Fullscreen=9]="Fullscreen",e[e.CallPanelHeaderLayoutMobile=10]="CallPanelHeaderLayoutMobile",e[e.CallPanelHeaderLayoutFloat=11]="CallPanelHeaderLayoutFloat",e[e.CallPanelHeaderLayoutWindow=12]="CallPanelHeaderLayoutWindow",e[e.CallPanelHeaderLayoutNone=13]="CallPanelHeaderLayoutNone",e[e.NewCallScreenToggle=14]="NewCallScreenToggle",e[e.SelfInTheGridToggle=15]="SelfInTheGridToggle",e[e.HidePeopleAtTop=16]="HidePeopleAtTop",e[e.ShowPeopleAtTop=17]="ShowPeopleAtTop"}(t.LayoutPickerMenuItemType||(t.LayoutPickerMenuItemType={})),function(e){e[e.FromGroupTitle=0]="FromGroupTitle",e[e.FromManageGroupButton=1]="FromManageGroupButton",e[e.FromParticipantCount=2]="FromParticipantCount",e[e.FromConversationIcon=3]="FromConversationIcon",e[e.GoLiveInformationView=4]="GoLiveInformationView",e[e.CallControls=5]="CallControls",e[e.OverflowMenu=6]="OverflowMenu",e[e.TrayOverflowButton=7]="TrayOverflowButton"}(t.CallRosterOrigin||(t.CallRosterOrigin={})),function(e){e[e.Actioned=0]="Actioned",e[e.ManualDismissed=1]="ManualDismissed",e[e.AutoDismissed=2]="AutoDismissed",e[e.Dismissed=3]="Dismissed"}(t.ToastActionType||(t.ToastActionType={})),function(e){e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Up=3]="Up",e[e.Zoom=4]="Zoom"}(t.PhotoAnimationDirection||(t.PhotoAnimationDirection={})),function(e){e[e.Sticker=0]="Sticker",e[e.Emoticon=1]="Emoticon",e[e.Snapshot=2]="Snapshot",e[e.Animation=3]="Animation",e[e.CallEvent=4]="CallEvent"}(t.ReactionsItemType||(t.ReactionsItemType={})),function(e){e[e.Default=0]="Default",e[e.CallMonitor=1]="CallMonitor",e[e.Mobile=2]="Mobile",e[e.DesktopMin=3]="DesktopMin",e[e.DesktopMinStageTwo=4]="DesktopMinStageTwo",e[e.DesktopMinSmallest=5]="DesktopMinSmallest",e[e.DesktopIncomingRingToast=6]="DesktopIncomingRingToast"}(t.CallControlsType||(t.CallControlsType={})),function(e){e[e.Join=0]="Join",e[e.Leave=1]="Leave",e[e.Unavailable=2]="Unavailable",e[e.BotUnavailable=3]="BotUnavailable",e[e.Muted=4]="Muted",e[e.KickedOut=5]="KickedOut",e[e.HandRaised=6]="HandRaised",e[e.TogetherModeDesiredBackgroundAlreadySet=7]="TogetherModeDesiredBackgroundAlreadySet",e[e.TogetherModeBackgroundChangeFailed=8]="TogetherModeBackgroundChangeFailed",e[e.TogetherModeBackgroundChanged=9]="TogetherModeBackgroundChanged"}(t.ParticipantEventType||(t.ParticipantEventType={})),t.DesktopMinCallControlsWidthBreakpoint=1150,t.DesktopMinStageTwoCallControlsWidthBreakpoint=1e3,t.DesktopMinSmallestCallControlsWidthBreakpoint=850,t.DesktopMinNewCallControlsWidthBreakpoint=1200,t.DesktopMinStageTwoNewCallControlsWidthBreakpoint=1050,t.DesktopMinSmallestNewCallControlsWidthBreakpoint=900,t.DesktopMinCallPanelHeaderWidthBreakpoint=824,t.DesktopMinCallRibbonWidthBreakpoint=1128,t.DesktopMinCallPanelHeaderV2WidthBreakpoint=700,function(e){e.Default="",e.Icon1="UseAltScreenShareIconOne",e.Icon2="UseAltScreenShareIconTwo"}(t.ScreenShareIcon||(t.ScreenShareIcon={})),function(e){e[e.Small=0]="Small",e[e.Large=1]="Large"}(t.RibbonType||(t.RibbonType={})),t.CallPanelHeaderHeight={mobile:72,window:80},t.BigTrayCallParticipantWidth={video:200,audio:120},t.BigTrayOverflowButtonWidth=t.BigTrayCallParticipantWidth.audio,t.BigTrayCallParticipantAvatarSize=64,t.DesktopLayoutPickerItemHeight=37,t.MobileLayoutPickerItemHeight=53,t.LayoutPickerButtonWidth=200},653:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallCardType=void 0;const a=i(1),n=i(17),o=i(3),s=i(4),r=i(39);t.CallCardType={Started:"started",Ended:"ended",Missed:"missed",Cast:"cast"};t.default=class{static getCallUsersMaxDuration(e,t=0){if(!e.length)return t;const i=a.map(e,e=>e.duration);return a.max(i)||t}static getMri(e){let t=e.identity;if(t||(e.nameChild&&(t=e.nameChild.getRawText()),t&&t.length))return t}static getCallCardUsers(e){let t=[];return a.each(e,e=>{const i=this.getMri(e);if(!i)return void s.log(o.LogTraceArea.CallCard,"getCallCardUsers() -  no user in partnode.");const l=n.isMri(i)?n.asMri(i):n.isSkypeId(i)?n.sanitizeMri(i,n.Namespaces.SkypeId):void 0;if(l){if(!n.isAgent(l)){let i;if(e.durationChild&&a.isFunction(e.durationChild.getRawText)){const t=parseInt(e.durationChild.getRawText(),10);a.isFinite(t)&&t>=0?i=t:s.warn(o.LogTraceArea.CallCard,"Invalid Call Card user duration from service")}t.push({mri:l,duration:i,isParticipant:!!i})}}else s.log(o.LogTraceArea.CallCard,"getCallCardUsers() - part node user not valid. value:"+r.mriOrId(i))}),t}}},672:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallMarkerDisplayUtils=t.CallMarkerType=void 0;const a=i(1),n=i(653),o=i(2690),s=i(17),r=i(70),l=i(3),c=i(4),d=i(5),u=i(11),h=i(10);var p;!function(e){e[e.Started=0]="Started",e[e.Ended=1]="Ended",e[e.Missed=2]="Missed",e[e.NoAnswer=3]="NoAnswer",e[e.Declined=4]="Declined",e[e.Failed=5]="Failed"}(p=t.CallMarkerType||(t.CallMarkerType={}));t.default=class{static calculateCallMarkerInfo(e,t){let i=this._extractCallCardInfoFromPartListNode(e);return t&&e.type!==n.CallCardType.Started&&(i=this._mergeCallLogsIntoCallMarkerInfo(t,i)),i}static calculateCallMarkerInfoFromPath(e,t,i,a,n){const o={callId:t,conversationId:i,type:a,duration:n};return this._mergeCallLogsIntoCallMarkerInfo(e,o)}static _mergeCallLogsIntoCallMarkerInfo(e,t){let i=t.type,n=t.duration;if(e)if(e.callState===o.CallState.Failed)i=p.Failed;else if(e.callState===o.CallState.Missed&&e.callDirection===o.CallDirection.Incoming)i=p.Missed;else if(e.callState===o.CallState.Missed&&e.callDirection===o.CallDirection.Outgoing)i=p.NoAnswer;else if(e.callState===o.CallState.Declined)i=p.Declined;else if(e.callState===o.CallState.Accepted&&e.callDirection===o.CallDirection.Outgoing&&e.forwardingInfo&&e.forwardingInfo.acceptedBy&&e.forwardingInfo.acceptedBy.type===o.ParticipantType.Voicemail)i=p.NoAnswer;else if(e.callState===o.CallState.Accepted&&e.callDirection===o.CallDirection.Outgoing&&e.callType===o.CallType.MultiParty&&1===a.size(e.participants))i=p.NoAnswer;else if(e.callState===o.CallState.Accepted&&(i=p.Ended,e.connectTime&&e.endTime)){const t=new Date(e.connectTime).getTime(),i=new Date(e.endTime).getTime();t&&i&&i>t&&(n=a.floor((i-t)/1e3))}return Object.assign(Object.assign({},t),{type:i,duration:n})}static _extractCallCardInfoFromPartListNode(e){const t=!!e.conversationId&&s.isThread(e.conversationId),i=!!e.conversationId&&s.isPhoneMri(e.conversationId),o=!!e.conversationId&&s.isGroupConversation(e.conversationId),r=n.default.getCallCardUsers(e.children),d=a.filter(r,e=>e.isParticipant);let u,h=p.Ended;const g=a.size(e.children),C=a.size(r),m=a.size(d);g!==C&&c.warn(l.LogTraceArea.CallCard,`renderPartListNodeParts() user mismatch. tree: ${g} card: ${C} participants: ${m}type: ${h} thread: ${t} PSTN: ${i}`);const S=m>1;return e.type===n.CallCardType.Started?h=p.Started:o&&!S||!o&&e.type===n.CallCardType.Missed?h=p.Missed:(u=n.default.getCallUsersMaxDuration(r),h=p.Ended),{callId:e.callId,conversationId:e.conversationId,type:h,duration:u}}};t.CallMarkerDisplayUtils=class{static getText(e,t){switch(e){case p.Started:return d.getString("CallCard.CallStartedStatusMessage");case p.Missed:return d.getString("CallCard.CallMissedStatusMessage");case p.Ended:if(t){const e=r.default.getFormattedDuration(t,!1);return d.getString("CallCard.CallEndedStatusWithDurationMessage",{duration:e})}return d.getString("CallCard.CallEndedStatusMessage");case p.Declined:return d.getString("CallCard.CallDeclinedStatusMessage");case p.NoAnswer:return d.getString("CallCard.CallNoAnswerStatusMessage");case p.Failed:return d.getString("CallCard.CallFailedStatusMessage");default:return h.default.switchStatementExhaustiveChecking(e,"Unknown marker type - Was a call marker type added?")}}static getTextForEncryptedThread(e,t){switch(e){case p.Started:return d.getString("CallCard.EncryptedCallStartedStatusMessage");case p.Missed:return d.getString("CallCard.EncryptedCallMissedStatusMessage");case p.Ended:if(t){const e=r.default.getFormattedDuration(t,!1);return d.getString("CallCard.EncryptedCallEndedStatusWithDurationMessage",{duration:e})}return d.getString("CallCard.EncryptedCallEndedStatusMessage");case p.Declined:return d.getString("CallCard.EncryptedCallDeclinedStatusMessage");case p.NoAnswer:return d.getString("CallCard.EncryptedCallNoAnswerStatusMessage");case p.Failed:return d.getString("CallCard.EncryptedCallFailedStatusMessage");default:return h.default.switchStatementExhaustiveChecking(e,"Unknown marker type - Was a call marker type added?")}}static getIcon(e){switch(e){case p.Started:return u.SkypeIcon.CallStart;case p.Missed:case p.NoAnswer:case p.Declined:case p.Failed:return u.SkypeIcon.CallMissed;case p.Ended:return u.SkypeIcon.CallEnd;default:return h.default.switchStatementExhaustiveChecking(e,"Unknown marker type - Was a call marker type added?")}}static getTextForAccessibilityLabel(e){switch(e){case p.Started:return d.getString("AccessibilityLabel.Call");case p.Missed:return d.getString("AccessibilityLabel.CallMissed");case p.Ended:return d.getString("AccessibilityLabel.Call");case p.Declined:return d.getString("AccessibilityLabel.CallDeclined");case p.NoAnswer:return d.getString("AccessibilityLabel.CallNoAnswer");case p.Failed:return d.getString("AccessibilityLabel.CallFailed");default:return h.default.switchStatementExhaustiveChecking(e,"Unknown marker type - Was a call marker type added?")}}}},692:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(47);i(17);t.default=new class{getReactionsThreadPostParams(e){return{[a.MessageProperties.CastParentThreadId]:e}}}},695:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CelebrationType=void 0;const a=i(25),n=i(29),o=i(32),s=i(3),r=i(4),l=i(37),c=i(5),d=i(21),u=i(46),h=i(15);var p;!function(e){e[e.Birthday=0]="Birthday",e[e.SpecialDay=1]="SpecialDay"}(p=t.CelebrationType||(t.CelebrationType={}));let g=class extends h.StoreBase{constructor(){super(...arguments),this._celebrationConversations={}}_startedTrackingKey(e){this._celebrationConversations||(this._celebrationConversations={}),this._celebrationConversations[e]||(this._celebrationConversations[e]=this._newCelebrationConversation()),this._celebrationConversations[e].callIdToken||(r.log(s.LogTraceArea.Calling,"CelebrationStore subscribing to CallingStore for callId : "+e),this._celebrationConversations[e].callIdToken=n.default.CallingStore.subscribe(()=>{this._celebrationConversations[e]?l.default(this._celebrationConversations[e].participantMris,n.default.CallingStore.getRemoteCallMemberMris(e))||(r.log(s.LogTraceArea.Calling,"CelebrationStore triggering for callId : "+e),this._celebrationConversations[e].participantMris=n.default.CallingStore.getRemoteCallMemberMris(e),this.trigger()):r.warn(s.LogTraceArea.Calling,"No celebration conversation for callId : "+e)},e))}_stoppedTrackingKey(e){const t=this._celebrationConversations[e];t&&t.callIdToken&&(r.log(s.LogTraceArea.Calling,"CelebrationStore unsubscribing from CallingStore for callId : "+e),n.default.CallingStore.unsubscribe(t.callIdToken),delete this._celebrationConversations[e])}_getCelebrateButtonText(e){const t=e.length;switch(t){case 0:return c.getString("ReactionsStream.CelebrateButtonGenericTitle");case 1:return c.getString("ReactionsStream.CelebrateButtonTitle1User",{firstUser:e[0]});case 2:return c.getString("ReactionsStream.CelebrateButtonTitle2Users",{firstUser:e[0],secondUser:e[1]});default:return c.getString("ReactionsStream.CelebrateButtonTitleMoreUsers",{firstUser:e[0],secondUser:e[1],count:t-2})}}_newCelebrationConversation(){return{callIdToken:void 0,participantMris:[]}}getCelebrationData(e,t){this._celebrationConversations||(this._celebrationConversations={}),this._celebrationConversations[t]||(this._celebrationConversations[t]=this._newCelebrationConversation());const i=this._celebrationConversations[t];if(i){l.default(i.participantMris,n.default.CallingStore.getRemoteCallMemberMris(t))||(i.participantMris=n.default.CallingStore.getRemoteCallMemberMris(t),this.trigger());let a=i.participantMris.filter(e=>this.isTodayBirthdayForParticipant(e,!1)),s=p.Birthday,r=a.map(t=>{let i=o.default.getMemberShortNameForConversation(e,t);return i||""});if(a.length>0){return{recipientMris:a,recipientFirstNames:r,celebrationType:s,celebrationText:this._getCelebrateButtonText(r)}}}}isTodayBirthdayForParticipant(e,t){if(d.default.isMyMri(e)&&!t)return!1;const i=u.default.getFullUserProfileByMri(e).birthday;if(i){let e=new Date;e.setHours(0,0,0,0);let t=i.split("-");return e.getDate()===Number(t[2])&&e.getMonth()+1===Number(t[1])}return!1}isTodayBirthdayForParticipantProfile(e){const t=e.birthday;if(t){let e=new Date;e.setHours(0,0,0,0);let i=t.split("-");return e.getDate()===Number(i[2])&&e.getMonth()+1===Number(i[1])}return!1}};a.__decorate([h.disableWarnings],g.prototype,"_startedTrackingKey",null),a.__decorate([h.disableWarnings],g.prototype,"_stoppedTrackingKey",null),a.__decorate([h.autoSubscribe,a.__param(1,h.key)],g.prototype,"getCelebrationData",null),g=a.__decorate([h.AutoSubscribeStore],g),t.default=new g},698:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LowerHandParticipantCommand=t.LowerHandCommand=t.RaiseHandCommand=void 0;const a=i(29),n=i(110),o=i(4),s=i(587),r=i(10);t.RaiseHandCommand=class{constructor(e,t){this._callId=e,this._info=t}isFeatureEnabled(){return a.default.CallingFeaturesHelper.allowRaiseHands(this._info)}canExecute(){return a.default.CallingFeaturesHelper.allowRaiseHands(this._info)&&!a.default.CallingStore.isHandRaisedForCurrentUserMri(this._callId)}execute(){a.default.CallingStore.raiseHand(this._callId,r.default.newCauseId()),o.track(new s.RaiseHandTelemetryEvent(this._callId,s.RaiseHandAction.RaiseHand,a.default.CallingStore.connectedParticipantsCount(this._callId)+1))}};t.LowerHandCommand=class{constructor(e,t){this._callId=e,this._lowerHandOrigin=t}canExecute(){return a.default.CallingStore.isHandRaisedForCurrentUserMri(this._callId)}execute(){a.default.CallingStore.lowerHandForCurrentUserMri(this._callId,r.default.newCauseId()),o.track(new s.RaiseHandTelemetryEvent(this._callId,s.RaiseHandAction.LowerMyHand,a.default.CallingStore.connectedParticipantsCount(this._callId)+1,this._lowerHandOrigin)),n.default.announceLoweredHandState(!0)}};t.LowerHandParticipantCommand=class{constructor(e,t,i,a,n){this._callId=e,this._mri=t,this._lowerHandOrigin=i,this._isLocal=a,this._displayName=n}isHandRaised(){return a.default.CallingStore.isHandRaisedForMri(this._mri,this._callId)}canExecute(){return n.default.canHandBeLoweredForParticipant(this._callId,this._mri)}execute(){a.default.CallingStore.lowerHandForMri(this._mri,this._callId,r.default.newCauseId()),o.track(new s.RaiseHandTelemetryEvent(this._callId,s.RaiseHandAction.LowerOthersHand,a.default.CallingStore.connectedParticipantsCount(this._callId)+1,this._lowerHandOrigin)),n.default.announceLoweredHandState(this._isLocal,this._displayName)}}},700:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallDebugMenuItem=t.TriggerKeys=void 0;const a=i(25),n=i(1),o=i(35),s=i(15),r=i(74),l=i(8),c=i(29),d=i(17),u=i(71),h=i(185),p=i(4),g=i(18),C=i(19),m=i(31),S=i(46),y=i(10);var f,_;!function(e){e[e.SelectedTab=0]="SelectedTab",e[e.Participants=1]="Participants",e[e.CallTechnicalInfo=2]="CallTechnicalInfo",e[e.AppMetrics=3]="AppMetrics",e[e.RendererMetrics=4]="RendererMetrics"}(f=t.TriggerKeys||(t.TriggerKeys={})),function(e){e[e.CallStats=0]="CallStats",e[e.Simulation=1]="Simulation",e[e.Inspect=2]="Inspect"}(_=t.CallDebugMenuItem||(t.CallDebugMenuItem={}));let b=class extends s.StoreBase{constructor(){super(...arguments),this._selectedItem=_.CallStats,this._refreshIntervalTokens={},this._callTechnicalInfo={},this._callParticipants={},this._rendererStats={},this._showAppMetrics=!1,this._showVideoMetrics=!1,this._handleCallEndedEvent=e=>{const t=y.default.newCauseId();this.dispose(e.callId),this.closeDebugWindow(e.callId,t,void 0)},this._updatePerformanceMetrics=()=>l.all([o.default.getSystemUsage(),o.default.getAppMetrics()]).then(e=>{const[t,i]=e;this._metrics={systemUsageInfo:t,gpu:i?i.find(e=>"GPU"===e.type):void 0,renderer:i?i.find(e=>"Tab"===e.type):void 0},this.trigger(f.AppMetrics)}),this._updateCallTechnicalInfo=e=>c.default.CallingStore.getTechnicalInformation(e).then(t=>{const i=C.default.parseJsonErrorToUndefined(t);this._callTechnicalInfo[e]||(this._callTechnicalInfo[e]=void 0),this._callTechnicalInfo[e]=i,this.trigger(s.formCompoundKey(e,f.CallTechnicalInfo))})}init(e){c.default.CallingStore.callEndedEvent().subscribe(this._handleCallEndedEvent),this.startTrackCallTechnicalInfo(e)}getParticipants(e){return this._callParticipants[e]?this._callParticipants[e]:[]}addParticipant(e){this._callParticipants[e]||(this._callParticipants[e]=[]);const t=this._generateParticipant(e);t&&(this._callParticipants[e].push(t),this.trigger(f.Participants))}resetParticipants(e){delete this._callParticipants[e],this.trigger(f.Participants)}removeParticipants(e){this._callParticipants[e]&&(this._callParticipants[e].pop(),this.trigger(f.Participants))}addGroupParticipants(e){for(let t=0;t<12;t++)this.addParticipant(e);this.trigger(f.Participants)}isFakeCallParticipant(e,t){return!!this._callParticipants[e]&&void 0!==n.find(this._callParticipants[e],e=>e.mri===t)}closeDebugWindow(e,t,i,a=!0){g.default.closeCallDebugPanel(t,i,a)}openNativeWindow(e,t,i,a){g.default.closeCallDebugPanel(a,i,!t),g.default.navigateToCallingDebugPanel(e,i,t),this.trigger()}getCallTechnicalInfo(e){return this._callTechnicalInfo[e]}getAppMetrics(){return this._metrics}getSelectedTab(){return this._selectedItem}showAppMetrics(){return this._showAppMetrics}showVideoMetrics(){return this._showVideoMetrics}setShowAppMetrics(e){this._showAppMetrics=e,e?this._refreshAppMetricsIntervalTokens||(this._refreshAppMetricsIntervalTokens=m.default.setInterval(this._updatePerformanceMetrics,1e4),this._updatePerformanceMetrics()):this._refreshAppMetricsIntervalTokens&&(m.default.clearInterval(this._refreshAppMetricsIntervalTokens),this._refreshAppMetricsIntervalTokens=void 0,this._metrics=void 0),this.trigger(f.AppMetrics)}setShowVideoMetrics(e){this._showVideoMetrics=e,this.trigger()}getRendererMetrics(e,t){if(this._rendererStats[e]&&this._rendererStats[e][t])return this._rendererStats[e][t]}fetchRendererStats(e,t,i){if(!e)return;const a=c.default.RemoteStreamHelper.getRemoteStreamRenderer(e,t,i);null==a||a.getStats().then(i=>{var n,o;this._rendererStats[e]||(this._rendererStats[e]={}),this._rendererStats[e][t]={framesDropped:i.framesDropped,framesTotal:i.framesTotal,frameType:r.FrameType[null==a?void 0:a.frameType],rendererType:r.RendererType[null==a?void 0:a.rendererType],streamSize:`${null===(n=null==a?void 0:a.streamSize)||void 0===n?void 0:n.width}:${null===(o=null==a?void 0:a.streamSize)||void 0===o?void 0:o.height}`},this.trigger(s.formCompoundKey(e,f.RendererMetrics))})}setSelectedTab(e){this._selectedItem=e,this.trigger(f.SelectedTab)}startTrackCallTechnicalInfo(e){this._refreshIntervalTokens[e]||(this._refreshIntervalTokens[e]=m.default.setInterval(()=>this._updateCallTechnicalInfo(e),1e4),this._updateCallTechnicalInfo(e))}getCallDebugMemberMri(e,t){return n.find(this._callParticipants[e],e=>e.id===t.id).mri}dispose(e){const t=this._refreshIntervalTokens[e];t&&m.default.clearInterval(t),this._selectedItem=_.CallStats,this._refreshIntervalTokens[e]=void 0,this._callTechnicalInfo[e]=void 0}test_reset(){n.map(this._refreshIntervalTokens,e=>{e&&m.default.clearInterval(e)}),this._refreshIntervalTokens={},this._callParticipants={},this._selectedItem=_.CallStats,this._callTechnicalInfo={}}_generateParticipant(e){const t=u.default.dangerousGetContactMriListMutable();if(0===t.length)return;const i=n.random(0,t.length);let a;do{a=t[n.random(0,t.length)]}while(!d.isMri(a));try{const t=S.default.getDisplayableUserByMri(a),n=new v(y.default.newGuid(),t?t.getMri():"8:myfakeuserdebug"+y.default.newCauseId(),t?t.getDisplayName():"MyFakeUser"+i,r.ParticipantState.Connected);return n.streams={[r.StreamType.Video]:[new w(i,e,!0,!0,1,r.StreamType.Video)]},n}catch(e){return void p.log(h.LogTraceArea.CallDebug,"User doesn't exists")}}};a.__decorate([s.autoSubscribeWithKey(f.Participants)],b.prototype,"getParticipants",null),a.__decorate([s.autoSubscribeWithKey(f.CallTechnicalInfo),a.__param(0,s.key)],b.prototype,"getCallTechnicalInfo",null),a.__decorate([s.autoSubscribeWithKey(f.AppMetrics)],b.prototype,"getAppMetrics",null),a.__decorate([s.autoSubscribeWithKey(f.SelectedTab)],b.prototype,"getSelectedTab",null),a.__decorate([s.autoSubscribe],b.prototype,"showAppMetrics",null),a.__decorate([s.autoSubscribe],b.prototype,"showVideoMetrics",null),a.__decorate([s.autoSubscribeWithKey(f.RendererMetrics),a.__param(0,s.key)],b.prototype,"getRendererMetrics",null),a.__decorate([s.autoSubscribe],b.prototype,"getCallDebugMemberMri",null),b=a.__decorate([s.AutoSubscribeStore],b);class v{constructor(e,t,i,a){this.id=e,this.mri=t,this.displayName=i,this.state=a}getSourceIdForMediaType(e){return 42}getDiagnosticData(){return"MockedParticipant"}dispose(){}changed(e){return{dispose:e=>{}}}on(e,t){return{dispose:e=>{}}}once(e,t){return{dispose:e=>{}}}}class w{constructor(e,t,i,a,n,o){this.mediaSourceId=0,this.id=e,this.callId=t,this.isAvailable=i,this.isStreaming=a,this.rank=n,this.type=o}changed(e){return{dispose:e=>{}}}dispose(e){}getDiagnosticData(){return""}isActive(){return!0}on(e,t){return{dispose:e=>{}}}once(e,t){return{dispose:e=>{}}}start(e,t){return new Promise((e,t)=>{const i=c.default.CallingStore.getVideoPreviewRenderer(this.callId);i?e(i):t("No renderer")})}stop(){return new Promise((e,t)=>{e()})}}t.default=new b},710:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(73),o=i(8),s=i(63),r=i(7),l=i(79),c=i(3),d=i(4),u=i(5),h=i(1576),p=i(18),g=i(82),C=i(807),m=i(20),S=i(28);const y=new class{canPrefillPhoneNumber(){return!!this._isPrefillPhoneNumberAndCodeEnabled()&&this._hasAtLeastOnePermission([S.PermissionType.ReadPhoneState,S.PermissionType.ReadSms])}canAutoSubmitCode(){return!!this._isPrefillPhoneNumberAndCodeEnabled()&&this._hasAtLeastOnePermission([S.PermissionType.ReadSms,S.PermissionType.ReceiveSms,S.PermissionType.SendSms])}startPhoneNumberVerificationFromManageSearchPanel(e,t){d.track(new C.PnvUIStartFromManageSearchPanel),this.startPhoneNumberVerification(e,t)}startPhoneNumberVerification(e,t){r.default.dangerouslyGetS4LSisuFeatures().enableMsaPhoneAccrual?this._startMsaPhoneAccrual(e,t):this._navigateToPnvEnterNumber(e,t)}_startMsaPhoneAccrual(e,t){h.default.displayMsaPhoneAccrualDialog(e,t)}_navigateToPnvEnterNumber(e,t){if(this._isPrefillPhoneNumberAndCodeEnabled()){if(g.default.permissionStatus(S.PermissionType.ReadSms)===n.PermissionStatus.Granted)d.track(new C.PnvUIStartTelemetryEvent(!0,!1,"sms")),p.default.navigateToPnvEnterNumber(t,e);else if(r.default.getOnboardingFeatures().features.showPrefillPhoneNumberPrompt)this._prepromptUserForPermission(t,e);else{const i=g.default.permissionStatus(S.PermissionType.ReadPhoneState)===n.PermissionStatus.Granted?"phone":"denied";d.track(new C.PnvUIStartTelemetryEvent(!0,!1,i)),p.default.navigateToPnvEnterNumber(t,e)}}else m.default.getPlatformType()===c.PlatformType.Android&&d.track(new C.PnvUIStartTelemetryEvent(!1,!1)),p.default.navigateToPnvEnterNumber(t,e)}_prepromptUserForPermission(e,t){l.dismissAll();const i=[{text:u.getString("CapturePermissions.PrePromptCancelButtonTitle"),isCancel:!0,onPress:()=>{this._prePromptCancelled(t,e)}},{text:u.getString("CapturePermissions.PrePromptAcceptButtonTitle"),isSubmit:!0,onPress:()=>{this._promptUserForPermissions(t,e)}}],a=u.getString("AudioVideoSettings.CameraPermissionCallToAction"),n=u.getString("PhoneNumberVerification.AutoDetectSMSCodeText");s.default.showWithOptions({title:a,dialogAccessibilityTitle:n,message:n,buttons:i,useHorizontalButtons:!0,rootViewId:t,useFocussedWindowFallback:!0})}_prePromptCancelled(e,t){const i=g.default.permissionStatus(S.PermissionType.ReadPhoneState)===n.PermissionStatus.Granted?"canceled-phone":"canceled";d.track(new C.PnvUIStartTelemetryEvent(!0,!0,i)),p.default.navigateToPnvEnterNumber(t,e)}_promptUserForPermissions(e,t){let i=g.default.permissionStatus(S.PermissionType.ReadSms)===n.PermissionStatus.Granted,a=g.default.permissionStatus(S.PermissionType.ReadPhoneState)===n.PermissionStatus.Granted;o.Resolved().then(()=>{if(!i)return this._requestPermission(S.PermissionType.ReadSms).then(e=>{i=e})}).then(()=>{if(!i)return this._requestPermission(S.PermissionType.ReadPhoneState).then(e=>{a=e})}).then(()=>{let n="denied";i?n="sms":a&&(n="phone"),d.track(new C.PnvUIStartTelemetryEvent(!0,!0,n)),p.default.navigateToPnvEnterNumber(t,e)})}_isPrefillPhoneNumberAndCodeEnabled(){return r.default.getOnboardingFeatures().features.enablePrefillPhoneNumberAndCode&&m.default.getPlatformType()===c.PlatformType.Android}_requestPermission(e){return g.default.requestPermission(e,S.PermissionPromptOptions.SkipPrePrompt|S.PermissionPromptOptions.PromptAgainIfDenied).then(e=>o.Resolved(e===n.PermissionStatus.Granted))}_hasAtLeastOnePermission(e){let t=!1;return a.each(e,e=>g.default.permissionStatus(e)!==n.PermissionStatus.Granted||(t=!0,!1)),t}};t.default=y},740:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallParticipantView=void 0;const a=i(2),n=i(1),o=i(116),s=i(0),r=i(74),l=i(7),c=i(741),d=i(3511),u=i(700),h=i(29),p=i(123),g=(i(3513),i(1697)),C=i(1698),m=i(3517),S=i(1696),y=i(3519),f=i(88),_=i(87),b=i(60),v=i(110),w=i(113),T=i(132),I=i(203),P=i(32),M=i(3),k=i(26),A=i(4),R=i(229),V=i(6),E=i(5),L=i(52),B=i(23),O=i(742),D=i(39),x=i(78),N=i(19),U=i(9),F=i(11),H=i(14),z=i(12),G=i(31),W=i(10),K=V.lazyProperties({innerContainer:()=>H.default.absoluteFill,innerContainerCentered:()=>s.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,alignItems:"center",justifyContent:"flex-end",paddingBottom:5}),participantViewSpacing:()=>s.Styles.createViewStyle({margin:4}),participantViewSpacingTray:()=>s.Styles.createViewStyle({margin:2}),hiddenContainer:()=>s.Styles.createViewStyle({opacity:0}),ringingContainer:()=>s.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,alignItems:"center",justifyContent:"center",backgroundColor:U.Color.blackOverlay50}),backgroundActivityContainer:()=>s.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,alignItems:"center",justifyContent:"center",overflow:"visible"}),gestureButton:()=>s.Styles.createButtonStyle({position:"absolute",top:0,bottom:0,left:0,right:0,alignItems:"center",justifyContent:"center",backgroundColor:U.Color.transparent}),keyboardNavigatorPosition:()=>s.Styles.createViewStyle({bottom:0,left:0}),smallAccessory:()=>s.Styles.createViewStyle({position:"absolute",width:24,height:24,borderRadius:12,backgroundColor:U.Color.white,alignItems:"center",justifyContent:"center"}),smallAccessoryPosition:()=>s.Styles.createViewStyle({bottom:0,right:0}),smallAccessoryLocalVideo:()=>s.Styles.createViewStyle({backgroundColor:U.Color.transparent}),smallAccessoryLocalVideoPosition:()=>s.Styles.createViewStyle({bottom:-8,right:-8}),smallAccessoryInnerView:()=>s.Styles.createViewStyle({width:20,height:20,borderRadius:10,backgroundColor:U.Color.white,alignItems:"center",justifyContent:"center"}),smallAccessoryInnerScreenshareView:()=>s.Styles.createViewStyle({backgroundColor:U.Color.white}),smallAccessoryInnerLocalVideoView:()=>s.Styles.createViewStyle({backgroundColor:U.Color.white}),nameTag:()=>s.Styles.createViewStyle({position:"absolute",left:10,right:10,bottom:10,alignItems:"center",justifyContent:"center",overflow:"visible"}),desktopNameTag:()=>s.Styles.createViewStyle({position:"absolute",left:10,right:10,bottom:0,alignItems:"center",justifyContent:"center",overflow:"visible"}),desktopNameTagLeft:()=>s.Styles.createViewStyle({position:"relative",alignItems:"flex-end",alignSelf:"stretch",flexDirection:"row",flexShrink:1,left:0,right:0,overflow:"hidden"}),gestureButtonInsets:()=>s.Styles.createViewStyle({left:-20,right:-20,top:0,bottom:-40}),debugContainer:()=>s.Styles.createViewStyle({padding:10}),debugTextStyle:()=>s.Styles.createTextStyle({color:U.Color.greenIOS}),raiseHandInnerBorderStyle:()=>s.Styles.createViewStyle({borderColor:U.Color.raiseHandOrange,borderWidth:2}),presenterAccessory:()=>s.Styles.createViewStyle({width:24,height:24,borderRadius:12,backgroundColor:U.Color.white,alignItems:"center",justifyContent:"center",marginLeft:8,overflow:"hidden"}),activeTalkingInnerBorderStyle:()=>s.Styles.createViewStyle({borderColor:U.Color.black,borderWidth:2}),activeTalkingOuterBorderStyle:()=>s.Styles.createViewStyle({borderColor:U.Color.white,borderWidth:3}),activeTalkingInnerBorderStyleLightTheme:()=>s.Styles.createViewStyle({borderColor:U.Color.white}),activeTalkingOuterBorderStyleLightTheme:()=>s.Styles.createViewStyle({borderColor:U.Color.blue}),raisedHandOuterBorderStyle:()=>s.Styles.createViewStyle({borderColor:U.Color.raiseHandOrange,borderWidth:3}),nametagAndAccessoriesLine:()=>s.Styles.createViewStyle({position:"absolute",flexDirection:"row",justifyContent:"space-between",bottom:12,left:12,right:12,alignSelf:"stretch",flexBasis:0,flexGrow:1,overflow:"hidden",alignItems:"flex-end"}),nametagAndAccessoriesLineTray:()=>s.Styles.createViewStyle({bottom:10,left:10,right:10})});class j extends z.default{constructor(){super(...arguments),this._callParticipantVideoViews={},this._containerId=0,this._isPressed=!1,this._isPanning=!1,this._isResizing=!1,this._isTalking=!1,this._animatedAccessoryOpacityValue=new s.Animated.Value(1),this._animatedAccessoryOpacityStyle=s.Styles.createAnimatedViewStyle({opacity:this._animatedAccessoryOpacityValue}),this._triggerScalingModeUpdate=e=>{if(this.isComponentMounted()&&this.props.onScalingModeChanged){const t=this.state.sizeToFit?r.ScalingMode.Fit:r.ScalingMode.Crop,i=this._extractMriForKey(this.props.renderKey);A.log(M.LogTraceArea.CallingUI,this._componentTag+"._triggerScalingModeUpdate: Scaling mode set for "+this._participantKeyForLogging()+" "+t);const a=n.isUndefined(this._lastKeyForScaling)||n.isUndefined(this._lastTypeForScaling)||n.isUndefined(this._lastModeForScaling),o=(null==e?void 0:e.getVideoElement())!==this._lastCallingVideoViewForScaling,s=this.state.streamType!==this._lastTypeForScaling,l=t!==this._lastModeForScaling,c=i!==this._lastKeyForScaling;(a||o||c||s||l)&&(this.props.onScalingModeChanged(i,this.state.streamType,t,null==e?void 0:e.getEndpointId()),this._lastKeyForScaling=i,this._lastTypeForScaling=this.state.streamType,this._lastModeForScaling=t,this._lastCallingVideoViewForScaling=null==e?void 0:e.getVideoElement())}},this._fetchRendererStats=n.throttle(()=>u.default.fetchRendererStats(this.props.callId,this.state.renderKey,this.state.streamType),5e3),this._setKeyboardNavigatorRef=e=>{this._keyboardNavigatorRef=e||void 0},this._onDimensionsChanged=e=>{e!==this._renderedDimensions&&(this._renderedDimensions=e,this._updateSizeToFitV2())},this._onHiddenChanged=e=>{this.isComponentMounted()&&this.setState({hidden:e})},this._onMultiTouchGesture=e=>{if(this.isComponentMounted()&&this.state.zoomEnabled){if(!this._isPanning){Math.abs(e.initialCenterPageX-e.centerPageX)>20&&(this._isPanning=!0)}if(this._isPanning){const t=this._panPosition||{x:e.centerPageX,y:e.initialCenterPageY},i={x:e.centerPageX,y:e.centerPageY},a=i.x-t.x,o=i.y-t.y;n.each(this._callParticipantVideoViews,e=>{var t;return null===(t=e.getVideoElement())||void 0===t?void 0:t.panVideo({x:a,y:o})}),this._panPosition=i}else{const t=e.distance/e.initialDistance;this.state.sizeToFit?t>=1.3&&(_.default.onZoomIn(this.props.callId?this.props.callId:""),A.track(new f.Zoom),this.setState({sizeToFit:!1})):t<=.7&&(_.default.onZoomOut(this.props.callId?this.props.callId:""),A.track(new f.Zoom),this.setState({sizeToFit:!0}))}}e.isComplete&&(this._panPosition=void 0,this._isPanning=!1)},this._onCallParticipantTalkingView=e=>{this._callParticipantTalkingView=e||void 0},this._onCallParticipantVideoView=(e,t)=>{e?this._callParticipantVideoViews[t]=e:delete this._callParticipantVideoViews[t]},this._onPressIn=()=>{this._isPressed=!0,this.props.onPressInOrOut&&(this._pressedTimerToken=G.default.setTimeout(()=>{this.isComponentMounted()&&this._isPressed&&this.props.onPressInOrOut&&this.props.onPressInOrOut(this.state.renderKey,!!this.props.isCompact,!0)},350))},this._onPressOut=()=>{this._isPressed=!1,n.isUndefined(this._pressedTimerToken)||(G.default.clearTimeout(this._pressedTimerToken),this._pressedTimerToken=void 0),this.props.onPressInOrOut&&this.props.onPressInOrOut(this.state.renderKey,!!this.props.isCompact,!1)},this._onLongPress=()=>{},this._onPan=e=>{const t=this._getViewClientRect();if(this.state.zoomEnabled&&!this.props.isCompact){const t=this._panPosition||{x:e.pageX,y:e.initialPageY},i={x:e.pageX,y:e.pageY},a=i.x-t.x,o=i.y-t.y;n.each(this._callParticipantVideoViews,e=>{var t;return null===(t=e.getVideoElement())||void 0===t?void 0:t.panVideo({x:a,y:o})}),this._panPosition=i,e.isComplete&&(this._panPosition=void 0)}const i=v.CallUIUtils.shouldStartSimulateViewResizing(!!this.props.enableFloatableResizableVideoPreview,this.state.isLocal,this.state.videoStatus===b.VideoStatus.Streaming,!this.props.isDragging,this._mousePosition!==b.CallingViewCornerPostion.NotAtCorner);if(this.props.onResize&&(i||this._isResizing)){const i=this._resizePosition||{x:e.pageX,y:e.initialPageY},a={x:e.pageX,y:e.pageY},o=a.x-i.x,s=a.y-i.y;if(this._isResizing=!0,n.isUndefined(this._resizePosition)&&(this._lastViewLayoutBeforeResizing=t,this._resizePosition=a,this._mouseResizeSessionStartPosition=this._mousePosition),t&&this._lastViewLayoutBeforeResizing&&!n.isUndefined(this._resizePosition)){let i=1,r=this._lastViewLayoutBeforeResizing.y,l=0;switch(this._mouseResizeSessionStartPosition){case b.CallingViewCornerPostion.UpperLeft:i=o>0&&s>0||o>0&&0===s||0===o&&s<0?-1:1,r=this._lastViewLayoutBeforeResizing.y,l=r-a.y;break;case b.CallingViewCornerPostion.UpperRight:i=o<0&&s>0||o<0&&0===s||0===o&&s>0?-1:1,r=this._lastViewLayoutBeforeResizing.y,l=r-a.y;break;case b.CallingViewCornerPostion.BottomLeft:i=o>0&&s<0||o>0&&0===s||0===o&&s<0?-1:1,r=this._lastViewLayoutBeforeResizing.y+this._lastViewLayoutBeforeResizing.height,l=a.y-r;break;case b.CallingViewCornerPostion.BottomRight:i=o<0&&s<0||o<0&&0===s||0===o&&s<0?-1:1,r=this._lastViewLayoutBeforeResizing.y+this._lastViewLayoutBeforeResizing.height,l=a.y-r}l=1===i?l>=0?l:0:l<=0?l:0;const c=Math.abs(l)/this._lastViewLayoutBeforeResizing.height*i+1;if(!n.isUndefined(this._mouseResizeSessionStartPosition)){const i=this.isComponentMounted()?this._layoutController():void 0;i&&i.resizeRect&&i.resizeRect(c,t.height,this._mouseResizeSessionStartPosition,e.isComplete),this.props.onResize(this.state.renderKey)}if(e.isComplete){const e=W.default.newCauseId();A.log(M.LogTraceArea.CallingUI,this._componentTag+"._onPan, causeId: "+e),this.props.callId&&_.default.updateCallTelemetry(this.props.callId,e,e=>e.resizeOwnPreview()),this._resizePosition=void 0,this._isResizing=!1,this._mouseResizeSessionStartPosition=void 0}}}else if(this.props.onPan){if(this.state.isLocal&&this.state.videoStatus!==b.VideoStatus.Streaming)return;!this.props.isDragging||e.isComplete?t?this.props.onPan(this.state.renderKey,e,t):this.props.onPan(this.state.renderKey,e):this.props.onPan(this.state.renderKey,e,t)}},this._onTap=e=>{this.props.isCompact&&this.props.onMouseOverOrOut&&this.props.onMouseOverOrOut(this.state.renderKey,!0,!1);const t=this._getNormalizedTimestamp(e);this.props.onDoubleTap?this._isDoubleTap(e)?(this._cancelDoubleTapTimer(),this._sendDoubleTapEvent(),this._lastTapEvent=void 0):(this._reportDelayedTap(t),this._startDoubleTapTimer(e)):this._sendTapEvent(t)},this._sendTapEvent=e=>{this.props.onTap&&this.props.onTap(this.state.renderKey,e)},this._onMouseMove=e=>{this._setMouseOver(),this._mayChangeMouseCursor(e)},this._onMouseEnter=e=>{e.stopPropagation(),this._setMouseOver(),this._mayChangeMouseCursor(e)},this._onMouseLeave=e=>{this.props.onMouseOverOrOut&&(this.props.enableFloatableResizableVideoPreview?G.default.sleep(1e3).then(()=>{this.props.onMouseOverOrOut&&this.props.onMouseOverOrOut(this.state.renderKey,!!this.props.isCompact,!1)}):this.props.onMouseOverOrOut(this.state.renderKey,!!this.props.isCompact,!1)),this.props.isCallStageV2||this._setHovering(!1),this._setApplyGestureInsets(!1)},this._toggleCropUncropVideo=e=>{this.isComponentMounted()&&this.setState({isSizeToFitExplicitlySet:!0},()=>{A.log(M.LogTraceArea.CallingUI,this._componentTag+"._toggleCropUncropVideo isSizeToFitExplicitlySet="+this.state.isSizeToFitExplicitlySet),this._updateSizeToFitByConextMenuOption(e)})},this._onParticipantContextMenuFromKeyboard=()=>{const e=this._getCallParticipantContextMenuOptions();this.props.callId&&this.props.conversationMri&&this._keyboardNavigatorRef&&e&&T.default.measureLayoutRelativeToWindow(()=>this._keyboardNavigatorRef).then(({x:t,y:i})=>g.default.showParticipantActionsContextMenuOnPosition({x:t,y:i},this._getRootViewId(),e,this.props.onCallParticipantContextMenuOpened,this.props.onCallParticipantContextMenuDismissed,this._toggleCropUncropVideo))},this._onParticipantContextMenuHandler=e=>{if(this.props.callId&&this.props.conversationMri){const t=this._getCallParticipantContextMenuOptions();g.default.showParticipantActionsContextMenu(e,this._getRootViewId(),t,this.props.onCallParticipantContextMenuOpened,this.props.onCallParticipantContextMenuDismissed,this._toggleCropUncropVideo)}},this._onLocalVideoContextMenuFromKeyboard=()=>{const e=this._getCallLocalVideoContextMenuOptions();this.props.callId&&this.props.conversationMri&&this._keyboardNavigatorRef&&e&&T.default.measureLayoutRelativeToWindow(()=>this._keyboardNavigatorRef).then(({x:t,y:i})=>g.default.showLocalVideoActionsContextMenuOnPosition({x:t,y:i},this._getRootViewId(),e,this._toggleCropUncropVideo))},this._onLocalVideoContextMenuHandler=e=>{if(this.props.callId&&this.props.conversationMri){const t=this._getCallLocalVideoContextMenuOptions();t&&g.default.showLocalVideoActionsContextMenu(e,this._getRootViewId(),t,this._toggleCropUncropVideo)}},this._getContextMenuHandler=e=>e?this.state.isLocal?this._onLocalVideoContextMenuFromKeyboard:this._onParticipantContextMenuFromKeyboard:this.state.isLocal?this._onLocalVideoContextMenuHandler:this._onParticipantContextMenuHandler}static _generateComponentTag(e){return e.parentViewId?e.parentViewId+"#CallParticipantView":"CallParticipantView"}_buildState(e,t){const i=l.default.getS4LCMCFeatures();let a,n=e.renderInfo;e.callId&&!e.renderInfo&&(n=h.default.CallParticipantStore.getParticipantRenderInfo(e.renderKey,e.callId));const o=(null==n?void 0:n.mri)||this._extractMriForKey(e.renderKey,!1),d=(null==n?void 0:n.isLocal)||e.renderKey===b.CallStageElementKeys.localUserKey;d?a=E.getString("DisplayInfoStore.ListMyName"):(a=P.default.getDisplayName(o),(null==n?void 0:n.renderScreenShare)&&(a=E.getString("CallPanel.CallParticipantScreenshareLabel",{displayName:a||""})));const u=d?h.default.DeviceStore.getSelectedCamera():void 0,p=r.CameraPosition.Unknown,g=(null==n?void 0:n.renderScreenShare)?r.StreamType.ScreenSharing:r.StreamType.Video,C=v.CallUIUtils.isFullScreenBot(o),m=e.isFullscreenBotCall||(null==n?void 0:n.renderScreenShare)||(null==n?void 0:n.streamsStatus)===b.CallParticipantStreamsStatus.Multiple||C;let S=Object.assign(Object.assign({zoomEnabled:m||e.enableVideoGestures,gradientColors:this._getGradientColors(e,!!(null==n?void 0:n.isLocal),!!(null==n?void 0:n.renderScreenShare),o),isMobileScreenReaderEnabled:x.default.isMobileScreenReaderEnabled(),isNavigatingWithKeyboard:R.default.isNavigatingWithKeyboard(),isUsingStackNavigationContext:B.default.isUsingStackNavigationContext(),hideNameTag:e.hideNameTag||h.default.CallControlsStore.isSettingsPopupVisible()||C,displayName:a,enableActionMenuOnMobile:!1,camera:u,cameraPosition:p,showControls:e.allowCameraFlip?c.default.areCallControlsVisible():void 0,screensharingIconFromECS:v.CallUIUtils.stringToScreenShareIconEnum(i.screensharingIconFromECS),streamType:g,metricEnabled:!1,rendererMetrics:void 0,experimentalVideo:i.enableExperimentalVideoRendering&&e.experimentalVideo,enableMultipleStreamSupport:i.enableMultipleStreamSupport,autoLetterBoxThresholdRatio:e.isCallStageV2?i.autoLetterBoxThresholdRatioForNewStage:i.modernCallStage.autoLetterBoxThresholdRatio,isFullScreenBot:C},n),{renderKey:e.renderKey,mri:o,isLocal:d,forceSizeToFit:m});return t?(S.sizeToFit=S.zoomEnabled,S.isSizeToFitExplicitlySet=!1,S.hidden=e.layoutController(e.renderKey,!!(null==n?void 0:n.renderScreenShare),null==n?void 0:n.videoStatus).isHidden(),S.applyGestureButtonInsets=!1,this._componentTag=j._generateComponentTag(e),S.mouseCursor=s.Types.GestureMouseCursor.Default):(null==n?void 0:n.videoDimensions)?(null==n?void 0:n.videoDimensions)&&(null==n?void 0:n.videoDimensions.width)||(S.sizeToFit=S.zoomEnabled&&this._sizeToFit(e,S.zoomEnabled)):S.sizeToFit=S.zoomEnabled&&this.state.sizeToFit,(t||e.isCompact||e.isDragging)&&(A.log(M.LogTraceArea.CallingUI,"## setting hovering to false"),S.hovering=!1),S.localPreviewAndroidV2=h.default.CallingStore.isLocalPreviewAndroidV2Enabled(),S}_getGradientColors(e,t,i,a){if(e.useDarkBackground){const t=e.useLightTheme?U.Color.gray50:U.Color.callStageLight;return e.isCallStageV2?[t]:[U.Color.callStageDark,U.Color.gray400]}return t||i?L.default.getGradientColors():I.default.getGradientColors(a)}componentDidMount(){super.componentDidMount();const e=W.default.newCauseId();A.log(M.LogTraceArea.CallingUI,this._componentTag+".componentDidMount: Video status updated for "+this._participantKeyForLogging()+" "+b.VideoStatus[this.state.videoStatus||b.VideoStatus.None]+" causeId: "+e),this._updateBadgeOpacity();const t=this._layoutController();t.onDimensionsChanged&&t.onDimensionsChanged(this._onDimensionsChanged),t.onHiddenChanged&&t.onHiddenChanged(this._onHiddenChanged),this.props.enableFloatableResizableVideoPreview&&t.setViewCanAnimateState&&t.setViewCanAnimateState(this,!0)}componentWillUnmount(){super.componentWillUnmount();const e=this._layoutController();e.onDimensionsChanged&&e.onDimensionsChanged(void 0),e.onHiddenChanged&&e.onHiddenChanged(void 0),this.props.enableFloatableResizableVideoPreview&&e.setViewCanAnimateState&&e.setViewCanAnimateState(this,!1),A.log(M.LogTraceArea.CallingUI,this._componentTag+".componentWillUnmount "+this._participantKeyForLogging())}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i);const a=W.default.newCauseId();t.isLocal||t.videoStatus!==b.VideoStatus.Available||this.state.videoStatus!==b.VideoStatus.Streaming||this._containerId++,n.each(this._callParticipantVideoViews,i=>{var n;e.callId&&e.conversationMri&&this.state.videoStatus!==t.videoStatus&&(A.log(M.LogTraceArea.CallingUI,this._componentTag+".UNSAFE_componentWillUpdate: VideoStatus from "+this.state.videoStatus+" to "+t.videoStatus+" causeId: "+a),h.default.RemoteStreamHelper.logStreamAndRendererStatus(e.callId,e.conversationMri,this.state.streamType,null===(n=i.getVideoElement())||void 0===n?void 0:n.getVideoContainer(),a))});if(e.onScalingModeChanged&&t.sizeToFit!==this.state.sizeToFit){const i=t.sizeToFit?r.ScalingMode.Fit:r.ScalingMode.Crop,n=t.renderScreenShare?r.StreamType.ScreenSharing:r.StreamType.Video,o=this._extractMriForKey(e.renderKey);A.log(M.LogTraceArea.CallingUI,this._componentTag+".UNSAFE_componentWillUpdate: Scaling mode changed for "+this._participantKeyForLogging()+" "+i+" causeId: "+a),e.onScalingModeChanged(o,n,i),this._lastKeyForScaling=o,this._lastTypeForScaling=n,this._lastModeForScaling=i}if(this.props.enableFloatableResizableVideoPreview&&t.hidden!==this.state.hidden&&t.hidden){const e=this._layoutController();e.setViewCanAnimateState&&e.setViewCanAnimateState(this,!1)}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=W.default.newCauseId(),o=this._participantKeyForLogging();A.log(M.LogTraceArea.CallingUI,this._componentTag+".componentDidUpdate "+o+"  causeId: "+a),(this.props.isCompact!==e.isCompact||this.props.allowCameraFlip&&this.state.showControls!==t.showControls)&&this._updateBadgeOpacity(!0);if(!this.props.enableVideoGestures&&e.enableVideoGestures&&n.each(this._callParticipantVideoViews,e=>{var t;return null===(t=e.getVideoElement())||void 0===t?void 0:t.resetPan()}),this._updateTalkingView(),(this.state.videoStatus!==b.VideoStatus.None&&t.videoStatus===b.VideoStatus.None||this.state.videoDimensions&&t.videoDimensions&&this.state.videoDimensions.width!==t.videoDimensions.width)&&(this.state.isSizeToFitExplicitlySet?this.setState({isSizeToFitExplicitlySet:!1}):this._updateSizeToFitV2()),!this.state.zoomEnabled&&t.zoomEnabled&&(this._isPanning=!1,this._panPosition=void 0),this.props.enableFloatableResizableVideoPreview&&t.hidden&&!this.state.hidden){const e=this._layoutController();e.setViewCanAnimateState&&e.setViewCanAnimateState(this,!0)}}updateTalking(e){this._isTalking!==e&&(this._isTalking=e,this._updateTalkingView())}_updateTalkingView(){this.props.isCompact&&this._callParticipantTalkingView&&this._callParticipantTalkingView.updateTalking(this._isTalking),n.each(this._callParticipantVideoViews,e=>e.updateTalkingView(this._isTalking))}_updateBadgeOpacity(e=!1){const t=this._currentBadgeOpacity();e&&t>0?s.Animated.timing(this._animatedAccessoryOpacityValue,{toValue:t,duration:250,delay:250,easing:s.Animated.Easing.InOut()}).start(e=>{e.finished||t===this._currentBadgeOpacity()&&this._animatedAccessoryOpacityValue.setValue(t)}):this._animatedAccessoryOpacityValue.setValue(t)}_currentBadgeOpacity(){let e;return e=this.props.isCompact?this.props.allowCameraFlip&&this.state.showControls?0:1:0,e}getVideoElement(e){var t,i;return!e&&n.size(this._callParticipantVideoViews)>0||!this.state.enableMultipleStreamSupport?null===(t=n.first(n.values(this._callParticipantVideoViews)))||void 0===t?void 0:t.getVideoElement():e?null===(i=this._callParticipantVideoViews[e])||void 0===i?void 0:i.getVideoElement():void 0}_participantKeyForLogging(){return this._extractMriForKey(this.props.renderKey,!0)}_extractMriForKey(e,t=!1){return p.default.extractMriFromKey(e,t)}_renderContentView(){const e=this.state.videoStatus!==b.VideoStatus.None?"video_":"icon_",t=this.state.renderKey,i=e+this._participantKeyForLogging();A.log(M.LogTraceArea.CallingUI,this._componentTag+"._renderContentView key:"+i+" videoStatus: "+b.VideoStatus[this.state.videoStatus||b.VideoStatus.None]+" shouldWaitforVideoSize: "+this.props.shouldWaitForVideoSize+" videoDimensions:"+N.default.asString(this.state.videoDimensions));const a=this.props.isCallStageV2||!this.state.isHandRaised||this.state.renderScreenShare?void 0:[K.raiseHandInnerBorderStyle];this.props.isCompact&&a&&a.push(s.Styles.createViewStyle({borderRadius:this.props.videoBorderRadius},!1));const n=this.state.enableMultipleStreamSupport&&this.state.streamsStatus===b.CallParticipantStreamsStatus.Multiple,r=this.props.isCompact&&n?[s.Styles.createViewStyle({borderRadius:this.props.videoBorderRadius,overflow:"hidden"},!1)]:void 0,l=[],c=this.state.streams||[];this.state.enableMultipleStreamSupport&&void 0!==this.state.streams?this.state.streamsStatus===b.CallParticipantStreamsStatus.None?l.push(this._renderVideoView(t,{videoStatus:b.VideoStatus.None,videoDimensions:v.DummyVideoSize})):c.forEach(e=>{c.length>1&&e.videoStatus===b.VideoStatus.None||l.push(this._renderVideoView(t,e,n?0:void 0))}):l.push(this._renderVideoView(t,{videoStatus:this.state.videoStatus,videoDimensions:this.state.videoDimensions}));let d,u=s.createElement(s.View,{key:"contentcontainer"+this._containerId,style:[K.innerContainer,a,r]},l);if(this.state.isRinging&&this.props.isCompact){const e=[K.ringingContainer,s.Styles.createViewStyle({borderRadius:this.props.videoBorderRadius},!1)];d=s.createElement(s.View,{style:e},s.createElement(k.default,{icon:F.SkypeIcon.CallAnimSmall4,color:U.Color.white,size:F.IconSize.size20}))}const h=this.state.isLocal&&this.state.videoStatus===b.VideoStatus.Streaming,p=h||this.state.renderScreenShare,g=this.props.isCompact&&!this.props.suppressTalkingRing?s.createElement(s.View,{style:K.backgroundActivityContainer},s.createElement(S.default,{ref:this._onCallParticipantTalkingView,size:this.props.iconSize,useRoundedRect:p,isVideo:h})):void 0,C=this._layoutController().getInnerStyles();C&&(u=s.createElement(s.Animated.View,{style:C},u));const y=s.createElement(m.default,{ignorePointerEvents:!0,participantMri:this.state.renderKey,borderRadius:this.props.videoBorderRadius,isCompact:!!this.props.isCompact,useMobileReactionsLayout:!!this.props.useMobileReactionsLayout,getCallReactionsDisplayHelper:this.props.getCallReactionsDisplayHelper});let f;if(this.props.allowCameraFlip){const e=s.Styles.createViewStyle({borderRadius:this.props.videoBorderRadius},!1);f=s.createElement(o.GradientView,{style:[H.default.overflowVisible,K.innerContainer,e],direction:o.GradientDirection.TOP_RIGHT,colors:[U.Color.blackOverlay50,U.Color.transparent]})}return s.createElement(s.View,{style:[K.innerContainer,this._getNewCallStageParticipantSpacing(),H.default.overflowVisible]},g,u,this._getActivityIndicationView(),y,d,f)}_getNewCallStageParticipantSpacing(){if(this.props.isCallStageV2&&this.props.isGroupCall)return this.props.isInTray?K.participantViewSpacingTray:K.participantViewSpacing}_getActivityIndicationView(){const e=this._isRaisedHandNewCallStageUI(),t=this._isActiveTalkingNewCallStageUI();if(!e&&!t)return;const i=[K.backgroundActivityContainer,K.activeTalkingInnerBorderStyle],a=[K.backgroundActivityContainer,K.activeTalkingOuterBorderStyle];return this.props.useLightTheme&&(i.push(K.activeTalkingInnerBorderStyleLightTheme),a.push(K.activeTalkingOuterBorderStyleLightTheme)),e&&(a.push(K.raisedHandOuterBorderStyle),i.push(K.raiseHandInnerBorderStyle)),e&&t&&a.push(K.activeTalkingOuterBorderStyle),s.createElement(s.View,{style:a},s.createElement(s.View,{style:i}))}_renderVideoView(e,t,i){const a=t.endpointId||e;return s.createElement(d.default,{key:a,ref:e=>this._onCallParticipantVideoView(e,a),renderKey:e,mri:this.state.mri,videoStatus:t.videoStatus,videoDimensions:t.videoDimensions,isRinging:this.state.isRinging,renderScreenShare:this.state.renderScreenShare,parentViewId:this._componentTag,videoBorderRadius:n.isUndefined(i)?this.props.videoBorderRadius:i,isCompact:this.props.isCompact,iconOpacity:this.props.iconOpacity,animateIconChanges:this.props.animateIconChanges,experimentalVideo:!!this.props.experimentalVideo,gradientColors:this.state.gradientColors,iconSize:this.props.iconSize,isLocal:this.state.isLocal,useLightTheme:this.props.useLightTheme,layoutController:e=>this.props.layoutController(e,!!this.state.renderScreenShare,t.videoStatus),localPreviewAndroidV2:!!this.state.localPreviewAndroidV2,onTriggerScalingModeUpdate:this._triggerScalingModeUpdate,onUpdateElementLink:this.props.onUpdateElementLink,onCallingVideoView:this.props.onCallingVideoView,shouldWaitForVideoSize:!!this.props.shouldWaitForVideoSize,streamType:this.state.streamType,endpointId:t.endpointId})}_isActiveTalkingNewCallStageUI(){return this.props.isCallStageV2&&this.props.isGroupCall&&this.state.isTalking&&!this.state.isAScreensharing}_isRaisedHandNewCallStageUI(){return this.props.isCallStageV2&&this.state.isHandRaised&&!this.state.isAScreensharing}_isPresenterScreenSharing(){return Boolean(this.state.isAScreensharing||this.state.isPresenter)}_hasToShowKeyboardNavigator(){return this.state.isNavigatingWithKeyboard&&!(this.state.isLocal&&this.props.isScreenSharing)}_renderAccessoryView(){if(!this.state.renderScreenShare&&(this.state.isMuted||this.state.isOnHold||this.state.isAScreensharing||this.state.isPresenter||this.state.isNavigatingWithKeyboard)&&this.props.isCompact){const e=this.state.isLocal&&this.state.videoStatus===b.VideoStatus.Streaming;let t;const i=[K.smallAccessoryInnerView];this.state.isOnHold?t=F.SkypeIcon.Pause:this.state.isMuted&&!this._showOptionalNameTagForMobile()?t=F.SkypeIcon.MicrophoneOff:this._isPresenterScreenSharing()&&(t=v.CallUIUtils.getShareScreenIcon(this.state.screensharingIconFromECS),i.push(K.smallAccessoryInnerScreenshareView)),e&&i.push(K.smallAccessoryInnerLocalVideoView);const n=[K.smallAccessory,K.smallAccessoryPosition,this._animatedAccessoryOpacityStyle];return e&&(n.push(K.smallAccessoryLocalVideo),this.props.allowCameraFlip&&n.push(K.smallAccessoryLocalVideoPosition)),s.createElement(a.Fragment,null,this._hasToShowKeyboardNavigator()&&s.createElement(s.Button,{style:[K.smallAccessory,K.keyboardNavigatorPosition],onPress:this._getContextMenuHandler(!0),title:"...",ref:this._setKeyboardNavigatorRef},"..."),t&&s.createElement(s.Animated.View,{style:n,ignorePointerEvents:!0},this._getDesktopAccessory(i,t)))}}_getDesktopAccessory(e,t){return s.createElement(s.View,{style:e},s.createElement(k.default,{icon:t,size:F.IconSize.size12,color:U.Color.gray400}))}_renderRaisedHandOnRibbonParticipant(){if(this.state.isHandRaised&&this.props.isCompact&&!this.state.renderScreenShare)return s.createElement(O.default,{type:O.RaiseHandImageType.SmallSizeTopLeftAligned})}_getNormalizedTimestamp(e){return Date.now()}_isDoubleTap(e){if(!this._lastTapEvent)return!1;return this._getEventTimestamp(e)-this._getEventTimestamp(this._lastTapEvent)<=200}_startDoubleTapTimer(e){this._lastTapEvent=e;const t=this._getNormalizedTimestamp(e);this._doubleTapTimer=G.default.setTimeout(()=>{this.isComponentMounted()&&(this._reportDelayedTap(t),this._doubleTapTimer=void 0)},200)}_cancelDoubleTapTimer(){this._doubleTapTimer&&(G.default.clearTimeout(this._doubleTapTimer),this._doubleTapTimer=void 0)}_reportDelayedTap(e){this._lastTapEvent&&this.props.onTap&&(this._sendTapEvent(e),this._lastTapEvent=void 0)}_sendDoubleTapEvent(){this.props.onDoubleTap&&this.props.onDoubleTap(this.state.renderKey)}_getEventTimestamp(e){return e.timeStamp?e.timeStamp.valueOf():0}_setApplyGestureInsets(e){this.isComponentMounted()&&this.state.applyGestureButtonInsets!==e&&this.setState({applyGestureButtonInsets:e})}_mayChangeMouseCursor(e){const t=this._getViewCallUIPosition(),i=!!t&&(t===b.CallingViewUIPostion.Ribbon||t===b.CallingViewUIPostion.FloatingOnTop);if(this.isComponentMounted()&&this.props.enableFloatableResizableVideoPreview&&this.state.isLocal&&i&&this.state.videoStatus===b.VideoStatus.Streaming){const t=e.clientX,i=e.clientY,a=this._getViewClientRect();this._mousePosition=v.CallUIUtils.getMouseCornerPosition(t,i,a);let n=s.Types.GestureMouseCursor.Default;this.props.isDragging||this._mousePosition===b.CallingViewCornerPostion.NotAtCorner&&!this._isResizing||(this._mousePosition!==b.CallingViewCornerPostion.BottomLeft&&this._mousePosition!==b.CallingViewCornerPostion.UpperRight||(n=s.Types.GestureMouseCursor.NESWResize),this._mousePosition!==b.CallingViewCornerPostion.UpperLeft&&this._mousePosition!==b.CallingViewCornerPostion.BottomRight||(n=s.Types.GestureMouseCursor.NWSEResize)),this.setState({mouseCursor:n})}}_getViewClientRect(){const e=this._layoutController();return e&&e.viewRect?e.viewRect(!0):void 0}_getViewCallUIPosition(){const e=this._layoutController();return e&&e.getUIPosition?e.getUIPosition():void 0}_setMouseOver(){this.props.isDragging||(this.props.onMouseOverOrOut&&this.props.onMouseOverOrOut(this.state.renderKey,!!this.props.isCompact,!0),this.isComponentMounted()&&(this.props.isCompact?this.state.applyGestureButtonInsets||this.setState({applyGestureButtonInsets:!0}):this.props.isCallStageV2||this._setHovering(!0)))}_setHovering(e){this.isComponentMounted()&&this.state.hovering!==e&&this.setState({hovering:e})}_isLandscape(e){return e.width>=e.height}_sizeToFit(e,t){if(!this._renderedDimensions||!this.state.videoDimensions||!this.state.videoDimensions.width||this.state.renderScreenShare||e.isFullscreenBotCall||this.state.streamsStatus===b.CallParticipantStreamsStatus.Multiple)return t;const i=this._isLandscape(this._renderedDimensions),a=this._isLandscape(this.state.videoDimensions),n=i!==a;const o=this.state.videoDimensions.width/this.state.videoDimensions.height,s=Math.floor(this._renderedDimensions.height*o),r=this._renderedDimensions.width/s,l=Math.abs(1-r)>this.state.autoLetterBoxThresholdRatio,c=!a,d=c||n||l;return A.log(M.LogTraceArea.CallingUI,this._componentTag+" _sizeToFit::isPortrait="+c+" isDifferentOrientation="+n+" forceUncrop="+l+" resizingFactor="+r+" incoming video width="+this.state.videoDimensions.width+" container width="+this._renderedDimensions.width+" sizeToFitRet="+d),d}_canUpdateSizeToFit(){return!(!this.isComponentMounted()||this.state.videoStatus===b.VideoStatus.None||this.props.isFullscreenBotCall||this.state.isFullScreenBot)&&(!this.props.isCompact||(A.log(M.LogTraceArea.CallingUI,this._componentTag+"._canUpdateSizeToFit "+this._participantKeyForLogging()+" sizeToFit=false in ribbon view user="+D.mriOrId(this.state.renderKey)),this.setState({sizeToFit:!1}),!1))}_updateSizeToFitByConextMenuOption(e){this._canUpdateSizeToFit()&&!n.isUndefined(e)&&e!==this.state.sizeToFit&&this.state.isSizeToFitExplicitlySet&&(A.log(M.LogTraceArea.CallingUI,this._componentTag+"._updateSizeToFitByConextMenuOption sizeToFitSelected="+e+" user="+D.mriOrId(this.state.renderKey)),this.setState({sizeToFit:e},()=>{this.props.callId&&h.default.OngoingCallService.setSizeToFitValue(this.props.callId,this.state.renderKey,e),e?A.track(new f.CanvasAndRibbonActionsEvent(f.CanvasAndRibbonActions.FullVideo)):A.track(new f.CanvasAndRibbonActionsEvent(f.CanvasAndRibbonActions.CropVideo))}))}_updateSizeToFitV2(){if(!this._canUpdateSizeToFit())return;let e=void 0;if(this.props.callId&&(e=h.default.OngoingCallService.getSizeToFitValue(this.props.callId,this.state.renderKey)),n.isUndefined(e)){const e=this.state.forceSizeToFit||this._sizeToFit(this.props,this.state.zoomEnabled);this.state.sizeToFit!==e&&(A.log(M.LogTraceArea.CallingUI,this._componentTag+"._updateSizeToFitV2 "+this._participantKeyForLogging()+" "+e+" user="+D.mriOrId(this.state.renderKey)),this.setState({sizeToFit:e,isSizeToFitExplicitlySet:!1}),this.props.callId&&h.default.OngoingCallService.setSizeToFitValue(this.props.callId,this.state.renderKey,void 0))}else A.log(M.LogTraceArea.CallingUI,this._componentTag+"._updateSizeToFitV2 sizeToFitPersistence="+e+" user="+D.mriOrId(this.state.renderKey)),this.setState({sizeToFit:e})}_updateSizeToFit(e){if(!this.isComponentMounted()||this.state.videoStatus===b.VideoStatus.None)return;if(this.props.isCompact)return A.log(M.LogTraceArea.CallingUI,this._componentTag+"._updateSizeToFit "+this._participantKeyForLogging()+" sizeToFit=false in ribbon view user="+D.mriOrId(this.state.renderKey)),void this.setState({sizeToFit:!1});if(!n.isUndefined(e)&&e!==this.state.sizeToFit&&this.state.isSizeToFitExplicitlySet)return A.log(M.LogTraceArea.CallingUI,this._componentTag+"._updateSizeToFit sizeToFitSelected="+e+" user="+D.mriOrId(this.state.renderKey)),void this.setState({sizeToFit:e},()=>{this.props.callId&&h.default.OngoingCallService.setSizeToFitValue(this.props.callId,this.state.renderKey,e),e?A.track(new f.CanvasAndRibbonActionsEvent(f.CanvasAndRibbonActions.FullVideo)):A.track(new f.CanvasAndRibbonActionsEvent(f.CanvasAndRibbonActions.CropVideo))});let t=void 0;if(this.props.callId&&(t=h.default.OngoingCallService.getSizeToFitValue(this.props.callId,this.state.renderKey)),!n.isUndefined(t))return A.log(M.LogTraceArea.CallingUI,this._componentTag+"._updateSizeToFit sizeToFitPersistence="+t+" user="+D.mriOrId(this.state.renderKey)),void this.setState({sizeToFit:t});const i=this.state.forceSizeToFit||this.state.zoomEnabled&&this._sizeToFit(this.props,this.state.zoomEnabled);this.state.sizeToFit!==i&&(A.log(M.LogTraceArea.CallingUI,this._componentTag+"._updateSizeToFit "+this._participantKeyForLogging()+" "+i+" user="+D.mriOrId(this.state.renderKey)),this.setState({sizeToFit:i,isSizeToFitExplicitlySet:!1}),this.props.callId&&h.default.OngoingCallService.setSizeToFitValue(this.props.callId,this.state.renderKey,void 0))}_layoutController(){return this.props.layoutController(this.state.renderKey,!!this.state.renderScreenShare,this.state.videoStatus)}_getOptionalNameTag(){let e;const t=this.props.nametagPosition&&this.props.nametagPosition.offset,i=[this.props.desktopNameTag?K.desktopNameTag:K.nameTag,this.props.isCallStageV2?K.desktopNameTagLeft:void 0];return this.props.nametagOpacityStyle&&i.push(this.props.nametagOpacityStyle),t&&i.push(s.Styles.createViewStyle({bottom:t},!1)),this.props.callId&&this.props.conversationMri&&(e=s.createElement(s.Animated.View,{style:i,ignorePointerEvents:!0},s.createElement(C.CallParticipantNametagView,{hoveringKey:this.state.renderScreenShare?void 0:this.state.renderKey,callId:this.props.callId,isLocal:this.state.isLocal,conversationMri:this.props.conversationMri,onToggleCropVideoClicked:this._toggleCropUncropVideo,sizeToFit:this.state.sizeToFit,videoStatus:this.state.videoStatus?this.state.videoStatus:b.VideoStatus.None,onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,isCallStageV2:this.props.isCallStageV2,showMoreIcon:this.state.hovering,isOnHold:this.state.isOnHold,useLightTheme:this.props.useLightTheme,isInTray:this.props.isInTray}))),e}_getOptionalBackgroundEffectInfo(){return s.createElement(y.default,{renderKey:this.props.renderKey,renderInfo:this.props.renderInfo,callId:this.props.callId,conversationMri:this.props.conversationMri,isCallStageV2:this.props.isCallStageV2,nametagOpacityStyle:this.props.nametagOpacityStyle,hideCaption:this.props.isCompact&&!this.props.isCallStageV2||this.state.streamsStatus===b.CallParticipantStreamsStatus.None,noExpand:(this.props.isCompact||this.props.isInTray)&&this.props.isCallStageV2,sizeToFit:this.state.sizeToFit,useLightTheme:this.props.useLightTheme,isInTray:this.props.isInTray,callParticipantView:this,layoutController:this.props.layoutController})}_isLocalMuteSupported(){return!!this.props.callId&&h.default.CallingStore.getLocalMuteSupported(this.props.callId)}_isServerMuteSupported(){let e;return this.props.callId&&(e=h.default.CallingStore.findRemoteCallMember(this.props.callId,this.state.renderKey)),!(!e||!this.props.callId)&&h.default.CallingStore.getServerMuteUnmuteSupportedForParticipant(this.props.callId,e)}_getCallParticipantContextMenuOptions(){var e,t;const i=this.state.renderKey,a=null!==(e=this.props.callId)&&void 0!==e?e:"";return{callId:a,conversationMri:null!==(t=this.props.conversationMri)&&void 0!==t?t:"",userMri:i,isLocal:this.state.isLocal,isGroupCall:!!this.props.isGroupCall,isLocalMuteSupported:this._isLocalMuteSupported(),isMuted:!!this.state.isMuted&&this.state.isMuted,isServerMutedSupported:this._isServerMuteSupported(),sizeToFit:this.state.sizeToFit,isCompact:!!this.props.isCompact,videoStatus:this.state.videoStatus||b.VideoStatus.None,displayName:void 0,isCropVideoEnabledOnGroupCall:!0,isCropVideoEnabledOn1On1Call:!0,showCropUncropMenuOption:!1,showMute:!1,showMuteEveryone:!1,isMuteOptionDisabled:!1,showRemoveCall:!1,showSendMessageMenuOption:w.default.call().canSendMessageToParticipant&&!this.props.showChangeTogetherModeBackgroundOption,showCropVideoOption:!1,showFullVideoOption:!1,showViewProfile:w.default.navigation().canAccessUserDetails&&!this.props.showChangeTogetherModeBackgroundOption,showLowerHandOption:!!this.state.isHandRaised,showChangeTogetherModeBackgroundOption:!!this.props.showChangeTogetherModeBackgroundOption,showPinOption:v.CallUIUtils.shouldShowCallParticipantPinOption(i,a),showUnpinOption:v.CallUIUtils.shouldShowCallParticipantUnpinOption(i,a)}}_getCallLocalVideoContextMenuOptions(){if(this.props.callId&&this.props.conversationMri)return g.default.getCallLocalVideoContextMenuOptions(this.props.callId,this.props.conversationMri,!!this.props.isCompact,this.state.videoStatus||b.VideoStatus.None,this.state.sizeToFit,!!this.state.isHandRaised)}_showOptionalNameTagForDesktop(){return!this.props.isCompact&&!this.state.hideNameTag}_showOptionalNameTagForMobile(){return!1}_renderDebugInfo(){var e,t,i,a,n;if(this.state.metricEnabled&&void 0!==this.state.rendererMetrics)return s.createElement(s.View,{style:[H.default.absoluteFill,K.debugContainer]},s.createElement(s.Text,{style:K.debugTextStyle},"FrameType: ",null===(e=this.state.rendererMetrics)||void 0===e?void 0:e.frameType),s.createElement(s.Text,{style:K.debugTextStyle},"RendererType: ",null===(t=this.state.rendererMetrics)||void 0===t?void 0:t.rendererType),s.createElement(s.Text,{style:K.debugTextStyle},"StreamSize: ",null===(i=this.state.rendererMetrics)||void 0===i?void 0:i.streamSize),s.createElement(s.Text,{style:K.debugTextStyle},"FramesDropped: ",null===(a=this.state.rendererMetrics)||void 0===a?void 0:a.framesDropped),s.createElement(s.Text,{style:K.debugTextStyle},"FramesTotal: ",null===(n=this.state.rendererMetrics)||void 0===n?void 0:n.framesTotal))}_shouldShowOptionalNameTag(e){return!!(this._showOptionalNameTagForDesktop()||(n.isUndefined(e)||this.state.isHandRaised&&!this.props.isCompact)&&this._showOptionalNameTagForMobile())}_shouldShowContextMenuForNewStage(){return!!this.props.isCallStageV2&&(!this.state.isLargeGridBot&&!this.state.isAScreensharing&&(!this.state.isTogetherModeBot||this.props.showChangeTogetherModeBackgroundOption))}render(){if(this.state.hidden)return null;const e=this._renderContentView(),t=this._renderAccessoryView(),i=this._renderRaisedHandOnRibbonParticipant(),a=!this.props.isCompact&&!this.props.isDragging,n=[this.props.style,this._layoutController().getStyles(a)];let o;if(this.props.isCompact&&this.props.ribbonOpacityStyle&&n.push(this.props.ribbonOpacityStyle),this._shouldShowOptionalNameTag(t))if(this.props.isCallStageV2){let e=void 0;if(this.state.isPresenter){const t=v.CallUIUtils.getShareScreenIcon(this.state.screensharingIconFromECS);e=s.createElement(s.Animated.View,{style:K.presenterAccessory,ignorePointerEvents:!0},this._getDesktopAccessory([K.smallAccessoryInnerView,K.smallAccessoryInnerScreenshareView],t))}o=s.createElement(s.View,{style:[K.nametagAndAccessoriesLine,this.props.isInTray?K.nametagAndAccessoriesLineTray:void 0]},this._getOptionalNameTag(),e)}else o=this._getOptionalNameTag();const l=this._getOptionalBackgroundEffectInfo(),c=[K.gestureButton];let d;if(this.props.isCompact&&this.state.applyGestureButtonInsets&&!this.props.enableFloatableResizableVideoPreview&&c.push(K.gestureButtonInsets),this.props.enableFloatableResizableVideoPreview||!this.props.enableFloatableResizableVideoPreview){const a=[K.innerContainer,H.default.overflowVisible,s.Styles.createViewStyle({borderRadius:this.props.videoBorderRadius},!1)],n=this.state.isNavigatingWithKeyboard&&this.props.isCompact?s.Types.ImportantForAccessibility.NoHideDescendants:s.Types.ImportantForAccessibility.No;d=s.createElement(s.GestureView,{key:"gestureView",style:a,onPan:this._onPan,onPinchZoom:this.state.zoomEnabled?this._onMultiTouchGesture:void 0,panPixelThreshold:this.props.isCompact?void 0:25,mouseOverCursor:this.state.mouseCursor,importantForAccessibility:n},e,t,i,s.createElement(s.View,{style:c,onPress:this.props.onTap?this._onTap:void 0,onLongPress:this.props.onTap?this._onLongPress:void 0,onMouseMove:this.props.onMouseOverOrOut?this._onMouseMove:void 0,onMouseEnter:this.props.onMouseOverOrOut?this._onMouseEnter:void 0,onMouseLeave:this.props.onMouseOverOrOut?this._onMouseLeave:void 0,accessibilityLabel:this.state.displayName,accessibilityTraits:s.Types.AccessibilityTrait.Button,onContextMenu:this.props.showContextMenu||this._shouldShowContextMenuForNewStage()?this._getContextMenuHandler(!1):void 0,ignorePointerEvents:!!this.state.isScreenshareControlling||void 0}),o,l)}else{const a=this.state.isNavigatingWithKeyboard&&this.props.isCompact?s.Types.ImportantForAccessibility.NoHideDescendants:s.Types.ImportantForAccessibility.No;let n,u;this.props.allowCameraFlip&&this.state.camera&&(this.state.camera.position===r.CameraPosition.Front?u=E.getString("CallControls.CallButtonSwitchCameraBackwardLabel"):this.state.camera.position===r.CameraPosition.Back&&(u=E.getString("CallControls.CallButtonSwitchCameraForwardLabel")),n=this.state.showControls?s.createElement(k.default,{color:U.Color.white,size:F.IconSize.size18,icon:F.SkypeIcon.NewSwitchCamera}):void 0);let h=this.props.showContextMenu||this._shouldShowContextMenuForNewStage()?this._getContextMenuHandler(!1):this._onLongPress;d=s.createElement(s.GestureView,{key:"gestureView",style:[K.innerContainerCentered,H.default.overflowVisible],onPan:this._onPan,onPinchZoom:this.state.zoomEnabled?this._onMultiTouchGesture:void 0,panPixelThreshold:this.props.isCompact?void 0:25,importantForAccessibility:a,mouseOverCursor:this.state.mouseCursor},e,n,t,i,s.createElement(s.Button,{style:c,onPress:this.props.onTap?this._onTap:void 0,onPressOut:this._onPressOut,onPressIn:this._onPressIn,onLongPress:this.state.enableActionMenuOnMobile&&this.props.onTap?h:void 0,onHoverStart:this.props.onMouseOverOrOut?this._onMouseEnter:void 0,onHoverEnd:this.props.onMouseOverOrOut?this._onMouseLeave:void 0,accessibilityLabel:this.props.isCompact?u||this.state.displayName:void 0,onContextMenu:this.props.showContextMenu?this._getContextMenuHandler(!1):void 0,tabIndex:this.props.isCompact?void 0:-1}),o,l)}return s.createElement(s.Animated.View,{style:n,onMouseEnter:this.props.isCallStageV2?()=>{this._setHovering(!0)}:void 0,onMouseLeave:this.props.isCallStageV2?()=>{this._setHovering(!1)}:void 0},d,void 0,void 0,this._renderDebugInfo())}}t.CallParticipantView=j,t.default=j},741:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(25),n=i(15),o=i(3),s=i(4);var r;!function(e){e[e.CallStatsVisibilty=0]="CallStatsVisibilty",e[e.OverflowMenuVisibility=1]="OverflowMenuVisibility"}(r||(r={}));let l=class extends n.StoreBase{constructor(){super(...arguments),this._isVisible=!1,this._callStatsVisible=!1,this._overflowMenuVisible=!1}areCallControlsVisible(){return this._isVisible}setCallControlsVisible(e,t){s.log(o.LogTraceArea.CallingUI,"CallControlsVisibilityStore.setCallControlsVisible.visible: "+(e?"true":"false")+" causeId: "+t),this.areCallControlsVisible()!==e&&this._triggerUpdates(e)}_triggerUpdates(e){this._isVisible=e,this.trigger()}isOverflowMenuVisible(){return this._overflowMenuVisible}setOverflowMenuVisiblity(e,t){e!==this._overflowMenuVisible&&(s.log(o.LogTraceArea.CallingUI,`CallControlsVisibilityStore.setOverflowMenuVisibility moving  ${this._overflowMenuVisible}->${e} causeId: ${t}`),this._overflowMenuVisible=e,this.trigger(r.OverflowMenuVisibility))}isCallStatsVisible(){return this._callStatsVisible}setCallStatsVisiblity(e,t){e!==this._callStatsVisible&&(s.log(o.LogTraceArea.CallingUI,`CallControlsVisibilityStore.setCallStatsVisiblity moving  ${this._callStatsVisible}->${e} causeId: ${t}`),this._callStatsVisible=e,this.trigger(r.CallStatsVisibilty))}resetAllVisibility(e){s.log(o.LogTraceArea.CallingUI,"CallControlsVisibilityStore.resetAllVisibility causeId: "+e),this._isVisible=!1,this._callStatsVisible=!1,this._overflowMenuVisible=!1}};a.__decorate([n.autoSubscribe],l.prototype,"areCallControlsVisible",null),a.__decorate([n.autoSubscribeWithKey(r.OverflowMenuVisibility)],l.prototype,"isOverflowMenuVisible",null),a.__decorate([n.autoSubscribeWithKey(r.CallStatsVisibilty)],l.prototype,"isCallStatsVisible",null),l=a.__decorate([n.AutoSubscribeStore],l),t.default=new l},742:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RaiseHandImageType=void 0;const a=i(0),n=i(15),o=i(57),s=i(6);var r;!function(e){e[e.MediumSizeCenterAligned=0]="MediumSizeCenterAligned",e[e.SmallSizeTopLeftAligned=1]="SmallSizeTopLeftAligned"}(r=t.RaiseHandImageType||(t.RaiseHandImageType={}));const l=s.lazyProperties({raiseHandIcon20:()=>a.Styles.createImageStyle({height:20,width:20,position:"absolute",top:2,left:0}),raiseHandIcon32:()=>a.Styles.createImageStyle({height:30,width:32,alignSelf:"center",marginBottom:8})});class c extends n.ComponentBase{render(){const e=this._getStyle(),t=this._getSource();return a.createElement(a.Image,{style:e,resizeMode:"contain",source:t})}_getStyle(){switch(this.props.type){case r.MediumSizeCenterAligned:return l.raiseHandIcon32;case r.SmallSizeTopLeftAligned:return l.raiseHandIcon20}}_getSource(){switch(this.props.type){case r.MediumSizeCenterAligned:return o.Collection.RAISE_HAND_MEDIUM;case r.SmallSizeTopLeftAligned:return o.Collection.RAISE_HAND_SMALL}}}t.default=c},743:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(60),n=i(3),o=i(4),s=i(324),r=i(39),l=i(48);t.default=class{constructor(){this._participantReactionCallbacks={}}registerUnhandledReactionCallback(e){this._unhandledReactionCallback=e}unregisterUnhandledReactionCallback(){this._unhandledReactionCallback=void 0}registerUnhandledReactionDismissCallback(e){this._dismissUnhandledReactionCallback=e}unregisterUnhandledReactionDismissCallback(){this._dismissUnhandledReactionCallback=void 0}registerParticipantReactionCallback(e,t){o.log(n.LogTraceArea.CallReactions,"CallReactionsDisplayHelper.registerParticipantReactionCallback key: "+r.mriOrId(e)),this._participantReactionCallbacks[e]=t}unregisterParticipantReactionCallback(e){o.log(n.LogTraceArea.CallReactions,"CallReactionsDisplayHelper.unregisterParticipantReactionCallback key: "+r.mriOrId(e)),delete this._participantReactionCallbacks[e]}dismissReaction(e){o.log(n.LogTraceArea.CallReactions,"CallReactionsDisplayHelper.dismissReaction key: "+r.mriOrId(e)),this._dismissUnhandledReactionCallback&&this._dismissUnhandledReactionCallback(e)}showReaction(e){l.default.shouldAnnounceForAccessibility()&&s.default.announceReaction(e.reaction);const t=e.isLocal?a.CallStageElementKeys.localUserKey:e.reaction.creator,i=e.isLocal?a.CallStageElementKeys.localUserKey:r.mriOrId(e.reaction.creator);o.log(n.LogTraceArea.CallReactions,"CallReactionsDisplayHelper.showReaction cuid: "+e.reaction.cuid+" key: "+i+" has callback "+!!this._participantReactionCallbacks[t]),this._participantReactionCallbacks[t]&&this._participantReactionCallbacks[t](e)||this._unhandledReactionCallback&&this._unhandledReactionCallback(e)}static getTextTimeoutBasedOnContent(e){return e.length<=40?3e3:e.length<=100?4500:6e3}}},745:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(168),o=i(0),s=i(13),r=i(3584),l=i(6),c=i(5),d=i(23),u=i(36),h=i(48),p=i(83),g=i(14),C=i(12),m=i(31),S=l.lazyProperties({sectionHeader:()=>o.Styles.createViewStyle({height:40,flexDirection:"row",alignItems:"center",paddingHorizontal:12})}),y="country",f="header",_=e=>({key:e.country,height:60,template:y}),b=e=>({key:"recent_"+e.country,height:60,template:y});class v extends C.default{constructor(){super(...arguments),this._onCountrySelect=e=>{this.props.onSelect(e.country)},this._renderCountryItem=e=>{const t=this.props.recentCountries&&this.props.recentCountries[e.key]||this.props.countries[e.key];return o.createElement(r.default,{filter:this.state.filter,country:t,onSelect:this._onCountrySelect})},this._renderHeaderItem=e=>o.createElement(o.View,{style:S.sectionHeader},o.createElement(p.SectionTitle,{key:e.key,title:e.key,titleStyles:g.default.flexOne})),this._renderItem=e=>{switch(e.template){case f:return this._renderHeaderItem(e);case y:return this._renderCountryItem(e);default:return[]}},this._filterCountries=e=>{var t;return e&&a.includes(e.countryName.toLowerCase(),null===(t=this.state.filter)||void 0===t?void 0:t.toLowerCase())}}_buildState(e,t){return{isUsingStackNavigationContext:d.default.isUsingStackNavigationContext(),safeAreaPaddingStyle:u.default.horizontalPaddingStyle(s.HorizontalInsetDefault)}}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),this.state.filter&&this.state.filter!==t.filter){this._cancelAnnoncement();const e=c.getString("PSTNCountryList.SearchResult",{count:a.size(this._filteredCountries)});this._announceForAccessibility(e,500)}}render(){const e=[g.default.flexOne];return this.state.safeAreaPaddingStyle&&e.push(this.state.safeAreaPaddingStyle),o.createElement(o.View,{style:e},o.createElement(n.VirtualListView,{itemList:this._getCountriesListItems(),renderItem:this._renderItem,animateChanges:!1,keyboardShouldPersistTaps:!0,keyboardDismissMode:"on-drag"}))}onFilterChange(e){this.isComponentMounted()&&this.setState({filter:e})}_getListHeader(e){return{key:e,height:40,template:f,isNavigable:!1,accessibilityGroup:n.Types.AccessibilityGroupMarker.Begin,accessibilityGroupLabel:e}}_getCountriesListItems(){this._filteredCountries=this.state.filter?a.filter(this.props.countries,this._filterCountries):a.values(this.props.countries);const e=a.map(this._filteredCountries,_);if(this.state.filter||a.isEmpty(this.props.recentCountries)){const t=[];return this.state.isUsingStackNavigationContext||t.push(this._getListHeader(c.getString("PSTNCountryList.Result"))),a.concat(t,e)}const t=a.filter(this.props.recentCountries,e=>!!e),i=a.map(t,b),n=[this._getListHeader(c.getString("PSTNCountryList.Recent"))],o=[this._getListHeader(c.getString("PSTNCountryList.All"))];return a.concat(n,i,o,e)}_announceForAccessibility(e,t=0){this._announcePromise=m.default.sleep(t).then(()=>h.default.maybeAnnounceForAccessibility(e))}_cancelAnnoncement(){this._announcePromise&&(this._announcePromise.cancel(),this._announcePromise=void 0)}}t.default=v},843:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(25),n=i(34),o=i(1),s=i(15),r=i(7),l=i(29),c=i(325),d=i(3),u=i(4),h=i(37),p=i(21),g=i(19);let C=class extends s.StoreBase{constructor(){super(...arguments),this._transcriptionInfo={},this._reactionsStoreSubscription={}}_startedTrackingKey(e){this._reactionsStoreSubscription[e]||(this._reactionsStoreSubscription[e]=c.default.subscribe(()=>this._processReactionsStoreUpdate(e),e),this._initStorage(e))}_stoppedTrackingKey(e){const t=this._reactionsStoreSubscription[e];t&&(c.default.unsubscribe(t),delete this._reactionsStoreSubscription[e])}getTranscriptions(e,t){if(!this._transcriptionInfo[e])return[];let i=this._transcriptionInfo[e].transcriptions;if(o.isEmpty(i))return[];if(t){const a=this._transcriptionInfo[e].consumptionHorizon;i=a?o.filter(i,e=>e.message.createdTime>=a):o.clone(i),i.splice(0,Math.max(i.length-t,0))}return i}transcriptionCount(e){return this._transcriptionInfo[e]?this._transcriptionInfo[e].transcriptions.length:0}resetUnseenTranscriptionCount(e){c.default.resetUnseenIncomingTranscriptionCount(e)}assignCallId(e,t){this._initStorage(e),this._transcriptionInfo[e].callId=t}clearCallIdAssignment(e){this._deleteStorage(e)}setConsumptionHorizon(e,t){this._transcriptionInfo[e]&&this._transcriptionInfo[e].consumptionHorizon!==t&&(this._transcriptionInfo[e].consumptionHorizon=t,this.trigger(e))}clearConsumptionHorizon(e){this.setConsumptionHorizon(e,0)}_processReactionsStoreUpdate(e){if(!this._transcriptionInfo[e])return;const t=this._transcriptionInfo[e].callId;if(!t)return;const i=l.default.CallingStore.getParticipantId(t);if(i)if(l.default.CallingStore.isCallOnHold(t))u.log(d.LogTraceArea.CallingUI,"CallTranscriptionStore: Call is on hold, ignoring incoming subtitles");else{if(r.default.getS4LCMCFeaturesNoSubscription().isInterimCaptionConcatenated){let t=c.default.getLastTranscriptionReactions(e,this._transcriptionInfo[e].lastItemTime);if(o.isEmpty(t))return;o.each(t,t=>{this._processTranscription(t,e,i),t.createdTime>this._transcriptionInfo[e].lastItemTime&&(this._transcriptionInfo[e].lastItemTime=t.createdTime)})}else{let t=c.default.getLastTranscriptionReaction(e,this._transcriptionInfo[e].lastItemTime);if(!t)return;this._processTranscription(t,e,i)}this.trigger(e)}}_processTranscription(e,t,i){const a=g.default.parseJsonErrorToUndefined(e.content);if(!a||!a.sender||o.isEmpty(a.receivers)||!a.message&&!a.translation)return void u.warn(d.LogTraceArea.CallingUI,"CallTranscriptionStore: Invalid transcription payload: "+n.pii.Omit(e.content));if(!o.includes(a.receivers,i))return;const s=this._transcriptionInfo[t].transcriptions,l=o.findIndex(s,e=>e.payload.cid===a.cid);let c=a.message||a.translation||"";if(l>=0){if(h.default(s[l].payload,a))return;if(s[l].payload.isFinal&&!a.isFinal)return;!a.isFinal&&s[l].sentence&&(c=s[l].sentence+" "+c)}const p={message:e,payload:a,sentence:c,senderMri:this._getSenderMri(t,a.sender)};if(-1===l){const e=Math.max(50,r.default.getS4LCMCFeaturesNoSubscription().callCaptionsMaxHistory),t=s.length-e+1;t>0&&s.splice(0,t),s.push(p)}else s[l]=p}_getSenderMri(e,t){if(!this._transcriptionInfo[e])return;const i=this._transcriptionInfo[e].callId;if(!i)return;const a=l.default.CallingStore.getParticipantId(i);if(!a)return;if(t===a)return p.default.getSkypeMri();const n=l.default.CallingStore.findRemoteCallMemberByEndpointParticipantId(i,t);return n?n.id:void 0}_initStorage(e){this._transcriptionInfo[e]||(this._transcriptionInfo[e]={transcriptions:[],lastItemTime:0,consumptionHorizon:0})}_deleteStorage(e){this._transcriptionInfo[e]&&delete this._transcriptionInfo[e]}};a.__decorate([s.disableWarnings],C.prototype,"_startedTrackingKey",null),a.__decorate([s.disableWarnings],C.prototype,"_stoppedTrackingKey",null),a.__decorate([s.autoSubscribe,a.__param(0,s.key)],C.prototype,"getTranscriptions",null),a.__decorate([s.autoSubscribe,a.__param(0,s.key)],C.prototype,"transcriptionCount",null),C=a.__decorate([s.AutoSubscribeStore],C),t.default=new C},846:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Test_CallLogStore=void 0;const a=i(25),n=i(1),o=i(15),s=i(61),r=i(49),l=i(3),c=i(4);let d=class extends o.StoreBase{constructor(){super(),this._requestThrottle=n.throttle(this._requestCallLogsThrottled,250),this._throttledIds={},this._dbLookups={},this._cache={},this._incomingCallLogsProcessedCallback=e=>{n.each(e,e=>{const t=this._isTrackingKey(e.callId);t&&this._addToCache(e),c.log(l.LogTraceArea.Calling,`CallLogStore received new calllog: ${e.callId} tracking: ${t}`)})},s.default.callLogsReceived.subscribe(this._incomingCallLogsProcessedCallback)}getCallLog(e){return this._cache[e]}_startedTrackingKey(e){this._dbLookups[e]||(this._throttledIds[e]=e,this._requestThrottle())}_stoppedTrackingKey(e){delete this._throttledIds[e],delete this._cache[e]}_requestCallLogsThrottled(){if(n.isEmpty(this._throttledIds))return;const e=n.values(this._throttledIds);this._throttledIds={},c.log(l.LogTraceArea.Calling,"CallLogStore processing throttle for "+e);const t=r.default.getCallLogs(e).finally(()=>{n.each(e,e=>delete this._dbLookups[e])}).then(e=>{n.each(e,e=>{e&&this._isTrackingKey(e.callId)&&(this._addToCache(e),c.log(l.LogTraceArea.Calling,"CallLogStore adding calllog from store: "+e.callId))})}).fail(t=>{c.warn(l.LogTraceArea.Calling,"CallLogStore failed getting calllogs from store: "+e)});n.each(e,e=>{this._dbLookups[e]=t})}_addToCache(e){const t=this._cache[e.callId];t&&t.messageCuid&&e.messageCuid&&!(e.messageCuid>t.messageCuid)||(this._cache[e.callId]=e,this.trigger(e.callId))}test_setCache(e){this._cache=e}};a.__decorate([o.autoSubscribe,a.__param(0,o.key)],d.prototype,"getCallLog",null),a.__decorate([o.disableWarnings],d.prototype,"_startedTrackingKey",null),a.__decorate([o.disableWarnings],d.prototype,"_stoppedTrackingKey",null),d=a.__decorate([o.AutoSubscribeStore],d),t.Test_CallLogStore=d,t.default=new d},866:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(29),n=i(17),o=i(33),s=i(375),r=i(3),l=i(4),c=i(205),d=i(275),u=i(10);t.default=class{static startOrAddPstnCall(e,t,i,h,p,g,C){const m=c.default.getPhoneNumberOrigin()||r.NavigationCallOrigin.PstnDialpad;l.track(new d.StartCall(r.NavigationCallOrigin[m])),i&&s.default.setDefaultPstnDestinationCountryCode(i);const S=u.default.newCauseId();if(t)this._startEmergencyPstnCall(e,S,i,h);else{let t=void 0;if(e&&(t=n.sanitizeMri(e,n.Namespaces.PSTN)),t)if(p&&g){const e=o.default().getConversation(g);let i=[];e&&(i=e.getMemberMris()),a.default.CallParticipantUtils.addUsersToCallOrRing([t],p,g,i,r.NavigationAddToCallOrigin.Unknown)}else C&&a.default.PstnUtils.setCallDTMF(t,C),a.default.CallNavigationHelper.startCall({conversationMri:t,withVideo:!1,origin:c.default.getPhoneNumberOrigin()||r.NavigationCallOrigin.PstnDialpad},S),c.default.resetPhoneNumberOrigin()}}static _startEmergencyPstnCall(e,t,i,n){i?n?(l.track(new d.EmergencyCall),l.log(r.LogTraceArea.GenericUnsafe,"Placing emergency call to "+s.default.maskPhoneNumber(e)+", destination country: "+i),a.default.CallNavigationHelper.startEmergencyCall(n,i,t).catch(e=>{l.warn(r.LogTraceArea.GenericUnsafe,"Failed to place emergency call, reason: "+JSON.stringify(e)),l.track(new d.EmergencyCallFailed)})):l.warn(r.LogTraceArea.GenericUnsafe,"Refusing to place emergency call, reason: no information about phone number suffix"):l.warn(r.LogTraceArea.GenericUnsafe,"Refusing to place emergency call, reason: no information about phone number country")}}},87:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallTriggeredBy=void 0;const a=i(1),n=i(401),o=i(0),s=i(74),r=i(8),l=i(7),c=i(1521),d=i(123),u=i(88),h=i(245),p=i(17),g=i(49),C=i(452),m=i(261),S=i(33),y=i(3),f=i(688),_=i(4),b=i(75),v=i(21),w=i(512),T=i(3152),I=i(432),P=i(563),M=i(112),k=i(192),A=i(122),R=i(224),V=i(22),E=i(322),L=i(19),B=i(137),O=i(369),D=i(95),x=i(10);var N;!function(e){e.None="None",e.MeetNow="MeetNow",e.ScheduleACall="ScheduleACall"}(N=t.CallTriggeredBy||(t.CallTriggeredBy={}));class U{constructor(){this._callTelemetryEvents={},this._callPerformanceTelemetryEvents={},this._callPerformanceTelemetryTokens={},this._incomingCallScenarios={},this._answerCallScenarioIds={},this._answerCallScenarios={},this._callAddPhotoTelemetryEvents={},this._callRecordingEvents={},this._callCaptioningEvents={},this._ndiEvents={},this._callTogetherModeEvents={},this._callLargeGridEvents={},this._onCallingError=e=>{const t=l.default.getS4LCMCFeaturesNoSubscription().PSTNCampaignTerminatedReasons;this._waitForIds().then(()=>_.track(new u.CallActionError(e,R.default.CallingNodeId.get(),R.default.EdfRegistrationId.get(),t)))},this.updateCallAudioSettingsPopupEvent=e=>{this._callAudioSettingsPopupEvent?e(this._callAudioSettingsPopupEvent):_.warn(y.LogTraceArea.Calling,"updateCallAudioSettingsPopupEvent - attempted to update the AudioSettings popup but no popup event has been set")},this.updateCallVideoSettingsPopupEvent=e=>{this._callVideoSettingsPopupEvent?e(this._callVideoSettingsPopupEvent):_.warn(y.LogTraceArea.Calling,"updateCallVideoSettingsPopupEvent - attempted to update the VideoSettings popup but no popup event has been set")},this.updateVideoSuggestionTooltipEvent=e=>{this._videoSuggestionTelemetryEvent?e(this._videoSuggestionTelemetryEvent):_.warn(y.LogTraceArea.Calling,"updateVideoSuggestionTooltipEvent - attempted to update the VideoSettings popup but no popup event has been set")},this.setCallAudioSettingsPopupEvent=e=>{this._callAudioSettingsPopupEvent||(this._callAudioSettingsPopupEvent=e)},this.setCallVideoSettingsPopupEvent=e=>{this._callVideoSettingsPopupEvent||(this._callVideoSettingsPopupEvent=e)},this.setVideoSuggestionTooltipEvent=e=>{this._videoSuggestionTelemetryEvent||(this._videoSuggestionTelemetryEvent=e)},this.sendVideoSuggestionTooltipEvent=()=>{this._videoSuggestionTelemetryEvent&&(_.track(this._videoSuggestionTelemetryEvent),this._videoSuggestionTelemetryEvent=void 0)},this._updatePerformanceEvent=e=>{var t,i,a,n;const o=c.default.getPerformanceMetrics(),s=this._callPerformanceTelemetryEvents[e];s&&o&&(o.systemUsageInfo&&s.setMainUsage(o.systemUsageInfo),s.setGPUUsage(null===(t=o.gpu)||void 0===t?void 0:t.wss,null===(i=o.gpu)||void 0===i?void 0:i.cpu),s.setRendererUsage(null===(a=o.renderer)||void 0===a?void 0:a.wss,null===(n=o.renderer)||void 0===n?void 0:n.cpu))},this._sendCallAVSettingsPopupEvents=()=>{this._callAudioSettingsPopupEvent&&(_.track(this._callAudioSettingsPopupEvent),this._callAudioSettingsPopupEvent=void 0),this._callVideoSettingsPopupEvent&&(_.track(this._callVideoSettingsPopupEvent),this._callVideoSettingsPopupEvent=void 0)},this.onCallManagerError=e=>{this._waitForIds().then(()=>{_.track(new u.CallActionCallKitError(e.operation,e.domain,e.code,e.callId,R.default.CallingNodeId.get(),!!e.terminal))})},this.onCallManagerSuccess=e=>{_.track(new u.CallActionCallKitSuccess(e.operation,e.result,e.attemptNumber))},d.default.onCallingError.subscribe(this._onCallingError)}_waitForIds(){return r.all([R.default.CallingNodeId.waitUntilSet(),R.default.EdfRegistrationId.waitUntilSet()]).then(a.noop)}onCallCreated(e){if(!this._callTelemetryEvents[e.callId]){if(_.log(y.LogTraceArea.Calling,"Starting to track Call event for callId: "+e.callId+" causeId: "+e.causeId),this._callTelemetryEvents[e.callId]=new u.Call({callId:e.callId,conversationId:e.conversationId,participantId:e.participantId,isCallCreator:e.isCallCreator,origin:e.origin,isScheduledCallActive:e.isScheduledCallActive,isMeetNow:e.isMeetNow,source:e.source,isEchoCall:e.isEchoCall,isTranslatedCall:e.isTranslatedCall,nodeId:R.default.CallingNodeId.get(),isGroupCall:e.isGroupConversation,isFirstCall:e.isFirstCall,timeBeforeFirstCallInSec:e.timeBeforeFirstCallInSec,isPreheated:e.isPreheated,noiseSuppressionMode:e.noiseSuppressionMode,isModerated:e.isModerated}),l.default.getS4LCMCFeatures().enablePerfomanceTelemetry){const t=c.default.getPerformanceMetrics();t&&t.systemUsageInfo&&c.default.isTracking()&&(this._callPerformanceTelemetryEvents[e.callId]=new T.CallPerformanceEvent(e.callId,t.systemUsageInfo.cpuSpeed,t.systemUsageInfo.cpuModel,t.systemUsageInfo.cores),this._callPerformanceTelemetryTokens[e.callId]=c.OnMetricsUpdated.subscribe(()=>this._updatePerformanceEvent(e.callId)),c.default.startTrackingPerformance())}_.track(new u.CallEntryPoint(e.callId,e.origin))}}onCallDisposed(e,t,i){var a;if(O.default.getActiveSession()&&(_.log(y.LogTraceArea.Calling,"[CallTelemetryHelper] onCallDisposed, causeId: "+i),O.default.completeSession(),this.updateCallTelemetry(e.callId,i,e=>e.callRosterClosedCount())),e.failureType!==s.FailureType.CallSetupFailed&&e.durationSeconds>0?(this._maybeCompleteCallRecordingEvent(e.callId,i),this._maybeCompleteCallCaptioningEvent(e.callId,i),this._maybeCompleteNdiEvent(e.callId),this.onStopTogetherMode(e.callId,i),this.onStopGridView(e.callId,i),this.updateCallTelemetry(e.callId,i,a=>{_.log(y.LogTraceArea.Calling,"Sending Call event for callId: "+e.callId+" causeId: "+i),a.isConversationAccepted(t),a.setIsCallCreator(e.isCallCreator),a.setCallConversationMriNamespace(p.getMriNamespace(e.conversationMri)),a.setCallDurationSeconds(e.durationSeconds),a.setIsPSTNCall(!!e.isPSTNCall),a.setColorTheme(D.default.colorTheme()),_.track(a)}),C.default.trackMeetNowCallIfValid(e.conversationMri),m.default.trackMeetNowCallIfValid(e.conversationMri)):(C.default.finishScenario(),m.default.finishScenario()),l.default.getS4LCMCFeatures().enablePerfomanceTelemetry&&this._callPerformanceTelemetryTokens[e.callId]){null===(a=this._callPerformanceTelemetryTokens[e.callId])||void 0===a||a.unsubscribe();const t=this._callPerformanceTelemetryEvents[e.callId];t&&_.track(t),this._callPerformanceTelemetryTokens[e.callId]=void 0,this._callPerformanceTelemetryEvents[e.callId]=void 0}this._sendCallAVSettingsPopupEvents(),delete this._callTelemetryEvents[e.callId]}updateCallTelemetry(e,t,i){const a=this._callTelemetryEvents[e];a?i&&i(a):_.warn(y.LogTraceArea.Calling,"Attempted to access telemetry event for callId: "+e+" causeId: "+t)}maybeSendInviteFreeDeclinedEvent(e,t,i,a){p.isSkypeIdMri(t)&&!i&&_.track(new u.CallActionInviteFreeDecline(e))}trackInCallReaction(e,t,i,a,n){_.track(new u.InCallReaction(e,t,i,a,n))}trackInCallUFD(e,t,i){_.track(new u.InCallUFD(e,t,i))}trackOverflowMenuActions(e){const t=a.size(e),i=e[0]||"None",n=e[1]||"None";_.track(new u.OverflowMenuOpenedEvent(t,i,n))}trackInCallActivity(e,t,i){const a=h.getCorrelationIdFromMessageParts(v.default.getSkypeMri(),t,i);_.track(new u.InCallActivity(e,a))}trackCallViewMenuActions(e){_.track(new u.CallViewMenuActionEvent(e))}trackCallPreview(e,t,i,a,n){_.track(new u.CallPreviewEvent(e,t,i,a,n))}trackRingTheGroup(e){_.track(new u.RingTheGroupEvent(e))}trackRinglessCallInterstitial(e,t){_.track(new u.RinglessCallInterstitialEvent(e,t))}trackCalleePresence(e,t,i){a.each(t,t=>i(t).then(t=>_.track(new u.CallActionCalleeUserPresence(e,t))))}trackAudioOutputRouteChange(e,t){const i=e!==t;_.track(new u.AudioOutputRouteChangedEvent(e,t,i))}trackSystemHotKey(e){_.track(new u.SystemHotKeyCallEvent(e))}onIncomingCallNotification(e,t){const i=x.default.newGuid();return this._waitForIds().then(()=>{if(e.eventType!==I.PNHEvents.IncomingNGCStopRinger)this._sendCallNotificationEvent(e,t),e.eventType!==I.PNHEvents.IncomingP2PCall&&e.eventType!==I.PNHEvents.IncomingGoLiveStart&&this._beginTrackingIncomingCall(i,e,t);else{}}),i}onStopCallNotification(e,t){this._waitForIds().then(()=>this._sendCallNotificationEvent(e,t))}trackIncomingVideoNotification(e,t,i){const o=e?u.IncomingVideoNotificationAction.Pressed:u.IncomingVideoNotificationAction.Displayed,s=a.isUndefined(i)?n.IncomingVideoNotificationOrigin[n.IncomingVideoNotificationOrigin.NotSpecified]:n.IncomingVideoNotificationOrigin[i];_.track(new u.IncomingVideoNotification(s,t,o))}_sendCallNotificationEvent(e,t){_.log(y.LogTraceArea.Calling,"Sending call notification telemetry for callId: "+e.callId+" source: "+e.source+" causeId: "+t),r.all([this._waitForIds(),V.EnsureStarted(P.default)]).then(()=>{const t=U._hydrateInfo(e);_.track(new u.CallActionPushNotification(t,R.default.CallingNodeId.get(),R.default.EdfRegistrationId.get()))})}static _hydrateInfo(e){return Object.assign(Object.assign({},e),{hasRegistered:P.default.hasRegisteredWithService(),isStarted:A.default.isUIDisplayed()})}_beginTrackingIncomingCall(e,t,i){r.all([this._waitForIds(),V.EnsureStarted(P.default)]).then(()=>{const a=U._hydrateInfo(t),n={ActivationState:o.Types.AppActivationState[o.App.getActivationState()],EventType:a.eventType,HasRegistered:a.hasRegistered,IsStarted:a.isStarted,Source:a.source,TimeWaitingToProcess:Math.max(0,a.pushProcessedTime-a.pushReceivedTime)};let s=this._incomingCallScenarios[e];if(!s){_.log(y.LogTraceArea.Calling,"Starting incoming call scenario telemetry for scenarioId: "+e+" source: "+a.source+" causeId: "+i);const t={CallId:a.callId,NodeId:R.default.CallingNodeId.get()||"",RegistrationId:R.default.EdfRegistrationId.get()||""};a.participantId&&(t.ParticipantId=a.participantId),s=new B.default(M.ScenarioName.IncomingCall,e,t),this._incomingCallScenarios[e]=s;let o=a.pushReceivedTime||a.pushProcessedTime;if(o<=0){const e="Received invalid incoming call scenario start time";_.error(y.LogTraceArea.Calling,e),o=Date.now()}s.start(n,o)}this.markIncomingCallStep(e,u.IncomingCallStep.NotificationReceived,i,n,a.pushProcessedTime-a.pushReceivedTime)})}markIncomingCallStep(e,t,i,a,n){this._waitForIds().then(()=>{this._incomingCallScenarios[e]&&(_.log(y.LogTraceArea.Calling,"Marking incoming call scenario step for scenarioId: "+e+" step: "+u.IncomingCallStep[t]+" causeId: "+i),this._incomingCallScenarios[e].markStepCompleted(u.IncomingCallStep[t],a,n))})}endTrackingIncomingCall(e,t,i){this._waitForIds().then(()=>{if(!this._incomingCallScenarios[e])return void _.warn(y.LogTraceArea.Calling,"Unable to end tracking unknown incoming call: "+e+" causeId: "+t);const a=this._incomingCallScenarios[e];_.log(y.LogTraceArea.Calling,"Completing incoming call scenario telemetry for scenarioId: "+e+" reason: "+(i?u.IncomingCallEndReason[i.reason]:"success")+" causeId: "+t),i?a.fail(u.IncomingCallEndReason[i.reason],i.details):a.finish(),delete this._incomingCallScenarios[e]})}checkCrashedCalls(){V.EnsureStarted(b.default).then(()=>{const e=b.default.getData(g.InternalKeys.ActiveCalls);e&&e.length&&(_.log(y.LogTraceArea.Calling,"Reporting crashed calls: "+JSON.stringify(e)),this.updateActiveCalls(void 0),R.default.CallingNodeId.waitUntilSet().then(()=>{a.each(e,e=>{_.track(new u.CallCrashEvent(e.callId,e.state,R.default.CallingNodeId.get(),e.participantId,e.endpointId))})}))})}updateActiveCalls(e){b.default.putData(g.InternalKeys.ActiveCalls,e)}_getCallAddPhotosEvent(e){return e?this._callAddPhotoTelemetryEvents[e]:void 0}initCallAddPhotosEvent(e,t,i,a=!1){if(this._getCallAddPhotosEvent(e))return;const n=p.isGroupConversation(t);this._callAddPhotoTelemetryEvents[e]=a?new u.CallAddPhotosWithFabEvent(e,n,i):new u.CallAddPhotosEvent(e,n,i)}markPhotosSentCallAddPhotosEvent(e,t){const i=this._getCallAddPhotosEvent(e);i?(i.setPhotosSent(t),i.setNumberOfPhotos(1)):_.warn(y.LogTraceArea.Calling,"CallTelemetryHelper.markPhotosSentCallAddPhotosEvent() no callAddPhotos Event")}markPhotosSelectedCallAddPhotosEvent(e,t){const i=this._getCallAddPhotosEvent(e);i&&i.setMediaPickerPhotosSelected(t)}markFromMediaPickerAndNumberOfPhotosCallAddPhotosEvent(e,t,i){const a=this._getCallAddPhotosEvent(e);a&&(a.setPhotosSent(!0),a.setFromMediaPicker(t),a.setNumberOfPhotos(i))}markPhotoTakenCallAddPhotosEvent(e,t){const i=this._getCallAddPhotosEvent(e);i&&i.setPhotoTaken(t)}completeCallAddPhotosEvent(e){const t=this._getCallAddPhotosEvent(e);t&&(_.track(t),delete this._callAddPhotoTelemetryEvents[e])}onStartRecording(e,t){this._callRecordingEvents[e]?_.warn(y.LogTraceArea.Calling,"CallTelemetryHelper._onStartRecording recording event already exists for callId: "+e+" causeId: "+t):(this.updateCallTelemetry(e,t,e=>{e.startRecordingCount()}),_.log(y.LogTraceArea.Calling,"CallTelemetryHelper.onStartRecording callId: "+e+" causeId: "+t),this._callRecordingEvents[e]={recordingStartTime:Date.now(),callRecordingEvent:new u.CallRecordingEvent(e)})}onStopRecording(e,t){this._maybeCompleteCallRecordingEvent(e,t),this.updateCallTelemetry(e,t,e=>{e.stopRecordingCount()})}onStartCaptions(e,t,i,a,n,o){this._callCaptioningEvents[e]?_.warn(y.LogTraceArea.Calling,"CallTelemetryHelper.onStartCaptions captioning event already exists for callId: "+e+" causeId: "+o):(this.updateCallTelemetry(e,o,e=>{e.startCaptioningCount()}),_.log(y.LogTraceArea.Calling,"CallTelemetryHelper.onStartCaptions callId: "+e+" causeId: "+o),this._callCaptioningEvents[e]={captioningStartTime:Date.now(),callCaptioningEvent:new u.CallCaptioningEvent(e,t,i,a,n)})}onStopCaptions(e,t){this._maybeCompleteCallCaptioningEvent(e,t),this.updateCallTelemetry(e,t,e=>{e.stopCaptioningCount()})}onRecieveCaptions(e,t){this.updateCallTelemetry(e,t,e=>{e.didReceiveCaptions()})}onFailedCaptionsConfig(e,t){this.updateCallTelemetry(e,t,e=>{e.failedCaptioningConfigCount()})}onSetReceiverSetup(e,t){this.updateCallTelemetry(e,t,e=>{e.receiverSetupCount()})}onStartTogetherMode(e,t){this._callTogetherModeEvents[e]?_.warn(y.LogTraceArea.Calling,"CallTelemetryHelper._onStartTogetherMode recording event already exists for callId: "+e+" causeId: "+t):(this.updateCallTelemetry(e,t,e=>{e.startTogetherMode()}),_.log(y.LogTraceArea.Calling,"CallTelemetryHelper.onStartTogetherMode callId: "+e+" causeId: "+t),this._callTogetherModeEvents[e]={botAddedStartTime:Date.now(),callFullScreenBotEvent:new u.CallFullScreenBotEvent(e,f.BotType[f.BotType.Audience])})}onStopTogetherMode(e,t){if(!this._callTogetherModeEvents[e])return;_.log(y.LogTraceArea.Calling,"CallTelemetryHelper.onStopTogetherMode callId: "+e+" causeId: "+t);const i=this._callTogetherModeEvents[e].callFullScreenBotEvent;i.setBotOnCallLengthSeconds((Date.now()-this._callTogetherModeEvents[e].botAddedStartTime)/1e3);const a=i.getBotOnCallUselessTime();0!==a&&i.addBotOnCallUselessLengthSeconds((Date.now()-a)/1e3),_.track(this._callTogetherModeEvents[e].callFullScreenBotEvent),delete this._callTogetherModeEvents[e]}onTogetherModeFailed(e,t,i){_.track(new u.CallFullScreenBotError(a.isNumber(t)?t:0,t.callId,f.BotType[f.BotType.Audience]))}onGridViewFailed(e,t,i){this._waitForIds().then(()=>{_.track(new u.CallFullScreenBotError(a.isNumber(t)?t:0,t.callId,f.BotType[f.BotType.GridView]))})}onStartGridView(e,t){this._callLargeGridEvents[e]?_.warn(y.LogTraceArea.Calling,"CallTelemetryHelper._onStartTogetherMode recording event already exists for callId: "+e+" causeId: "+t):(this.updateCallTelemetry(e,t,e=>{e.startLargeGrid()}),_.log(y.LogTraceArea.Calling,"CallTelemetryHelper.onStartTogetherMode callId: "+e+" causeId: "+t),this._callLargeGridEvents[e]={botAddedStartTime:Date.now(),callFullScreenBotEvent:new u.CallFullScreenBotEvent(e,f.BotType[f.BotType.GridView])})}onStopGridView(e,t){if(!this._callLargeGridEvents[e])return;_.log(y.LogTraceArea.Calling,"CallTelemetryHelper.onStopTogetherMode callId: "+e+" causeId: "+t);const i=this._callLargeGridEvents[e].callFullScreenBotEvent;i.setBotOnCallLengthSeconds((Date.now()-this._callLargeGridEvents[e].botAddedStartTime)/1e3);const a=i.getBotOnCallUselessTime();0!==a&&i.addBotOnCallUselessLengthSeconds((Date.now()-a)/1e3),_.track(this._callLargeGridEvents[e].callFullScreenBotEvent),delete this._callLargeGridEvents[e]}onAddingBotToCall(e,t){_.track(new u.AddBotToCallEvent(e,f.BotType[t]))}onBotAddedToCall(e,t,i){_.track(new u.AddBotToCallSucceededEvent(e,f.BotType[t],i))}onBotFailed(e,t,i,n){_.track(new u.AddBotToCallFailedEvent(e,f.BotType[t],i,a.isNumber(n)?n:0))}_maybeCompleteCallRecordingEvent(e,t){if(!this._callRecordingEvents[e])return;_.log(y.LogTraceArea.Calling,"CallTelemetryHelper._maybeCompleteCallRecordingEvent callId: "+e+" causeId: "+t),this._callRecordingEvents[e].callRecordingEvent.recordingLengthSeconds((Date.now()-this._callRecordingEvents[e].recordingStartTime)/1e3),_.track(this._callRecordingEvents[e].callRecordingEvent),delete this._callRecordingEvents[e]}_maybeCompleteCallCaptioningEvent(e,t){if(!this._callCaptioningEvents[e])return;_.log(y.LogTraceArea.Calling,"CallTelemetryHelper._maybeCompleteCallCaptioningEvent callId: "+e+" causeId: "+t),this._callCaptioningEvents[e].callCaptioningEvent.setCaptioningLengthSeconds((Date.now()-this._callCaptioningEvents[e].captioningStartTime)/1e3),_.track(this._callCaptioningEvents[e].callCaptioningEvent),delete this._callCaptioningEvents[e]}screenShareControlReceivedControlRequest(e,t){this.updateCallTelemetry(e,t,e=>e.screenShareControlReceivedControlRequest())}togetherModeSceneChangeRequestCount(e,t){this.updateCallTelemetry(e,t,e=>e.togetherModeSceneChangeRequestCount())}screenShareControlReceivedControlRequestCanceled(e,t){this.updateCallTelemetry(e,t,e=>e.screenShareControlReceivedControlRequestCanceled())}screenShareControlSentControlRequest(e,t){this.updateCallTelemetry(e,t,e=>e.screenShareControlSentControlRequest())}screenShareControlRequestAccepted(e,t){this.updateCallTelemetry(e,t,e=>e.screenShareControlRequestAccepted())}screenShareControlRequestDenied(e,t){this.updateCallTelemetry(e,t,e=>e.screenShareControlRequestDenied())}screenShareControlGranted(e,t){this.updateCallTelemetry(e,t,e=>e.screenShareControlGranted())}screenShareControlSharerTerminatedControl(e,t){this.updateCallTelemetry(e,t,e=>e.screenShareControlSharerTerminatedControl())}screenShareControlViewerTerminatedControl(e,t){this.updateCallTelemetry(e,t,e=>e.screenShareControlViewerTerminatedControl())}onStopScreenSharing(e,t){_.track(new u.ScreenSharingStoppedEvent(e,t))}pinToolbar(e,t){this.updateCallTelemetry(e,t,e=>e.pinToolbar())}unPinToolbar(e,t){this.updateCallTelemetry(e,t,e=>e.unPinToolbar())}setGiveControlAsPossible(e,t){this.updateCallTelemetry(e,t,e=>e.setGiveControlAsPossible())}onStartNdi(e,t){this._ndiEvents[e]?_.warn(y.LogTraceArea.Calling,"CallTelemetryHelper.onStartNdi ndi event already exists for callId: "+e):(this.updateCallTelemetry(e,"ndi-started",e=>{e.startNdiCount()}),_.log(y.LogTraceArea.Calling,"CallTelemetryHelper.onStartNdi callId: "+e),this._ndiEvents[e]={broadcastingStartTime:Date.now(),broadcastingEvent:new u.NdiBroadcastEvent(e,t)})}onStopNdi(e){this._maybeCompleteNdiEvent(e),this.updateCallTelemetry(e,"ndi-stopped",e=>{e.stopNdiCount()})}onZoomIn(e){this.updateCallTelemetry(e,"ZoomedInCount",e=>{e.zoomedIn()})}onZoomOut(e){this.updateCallTelemetry(e,"ZoomedOutCount",e=>{e.zoomedOut()})}onAudioSystemReset(e,t){this.updateCallTelemetry(e,t,e=>{e.audioSystemResetCount()})}_maybeCompleteNdiEvent(e){if(!this._ndiEvents[e])return;_.log(y.LogTraceArea.Calling,"CallTelemetryHelper._onStopNdi callId: "+e);const t=this._ndiEvents[e].broadcastingEvent;t.setBroadcastingLengthSeconds((Date.now()-this._ndiEvents[e].broadcastingStartTime)/1e3),t.setWatermarkLocation(w.default.getWatermarkLocation()),_.track(t),delete this._ndiEvents[e]}updateNdiTelemetry(e,t){this._ndiEvents[e]&&t&&t(this._ndiEvents[e].broadcastingEvent)}updateCallRecordingTelemetry(e,t,i){this._callRecordingEvents[e]&&i&&i(this._callRecordingEvents[e].callRecordingEvent)}updateCallCaptioningTelemetry(e,t,i){this._callCaptioningEvents[e]&&i&&i(this._callCaptioningEvents[e].callCaptioningEvent)}updateCallTogetherModeTelemetry(e,t){this._callTogetherModeEvents[e]&&t&&t(this._callTogetherModeEvents[e].callFullScreenBotEvent)}updateCallGridViewTelemetry(e,t){this._callLargeGridEvents[e]&&t&&t(this._callLargeGridEvents[e].callFullScreenBotEvent)}updateTogetherModeAvailability(e,t){this.updateCallTelemetry(e,t,e=>{e.ableToStartTogetherMode()})}updateLargeGridAvailability(e,t){this.updateCallTelemetry(e,t,e=>{e.ableToStartLargeGrid()})}setHadNewCallStageEnabled(e,t){this.updateCallTelemetry(e,t,e=>{e.setHadNewCallStageEnabled()})}setHadOldCallStageEnabled(e,t){this.updateCallTelemetry(e,t,e=>{e.setHadOldCallStageEnabled()})}addCallingStoreUpdatePerformance(e,t,i){this.updateCallTelemetry(e,t,e=>{e.addCallingStoreUpdatePerformance(i)})}rejoinCallTelemetry(e,t,i){_.log(y.LogTraceArea.Calling,"CallingTelemetryHelper_rejoinCallTelemetry callId: "+e+" causeId: "+t),_.track(new u.CallEntryPoint(e,i,!0))}beginTrackingAnswerCall(e,t,i){return this._waitForIds().then(()=>{let a=this._answerCallScenarioIds[e];if(!a){a=x.default.newGuid(),_.log(y.LogTraceArea.Calling,"Starting answer call scenario telemetry for scenarioId: "+a+" causeId: "+i);const n={CallId:e,NodeId:R.default.CallingNodeId.get()||"",RegistrationId:R.default.EdfRegistrationId.get()||""};if(t){n.IsGroupCall=!p.isOneOnOneConversation(t);let e=N.None;const i=k.default.getScheduledCallByConversationId(t);if(i&&k.default.isScheduledCallNow(i.id))e=N.ScheduleACall;else{const i=S.default().getConversation(t);i&&i.isMeetNowThread()&&(e=N.MeetNow)}n.TriggeredBy=e}let o=new B.default(M.ScenarioName.AnswerCall,a,n);this._answerCallScenarios[a]=o,this._answerCallScenarioIds[e]=a,o.setDuplicateStepMarkingEnabled(!0),o.start()}return a})}markAnswerCallStep(e,t,i,a,n,o){this._waitForIds().then(()=>r.Resolved(this._answerCallScenarioIds[e])).then(o=>o||(t===u.AnswerCallStep.NotifyingCallee?(E.default.notifyingCallee(n),this.beginTrackingAnswerCall(e,i,a)):r.Rejected("Unable to mark step for unknown answer call: "+e+" causeId: "+a))).then(e=>{_.log(y.LogTraceArea.Calling,"Marking answer call scenario step for scenarioId: "+e+" step: "+u.AnswerCallStep[t]+" causeId: "+a),this._answerCallScenarios[e].markStepCompleted(u.AnswerCallStep[t],n,o)}).catch(e=>_.warn(y.LogTraceArea.Calling,L.default.errorAsString(e)))}endTrackingAnswerCall(e,t,i){this._waitForIds().then(()=>{let a=this._answerCallScenarioIds[e];if(!a)return void _.warn(y.LogTraceArea.Calling,"Unable to end tracking unknown answer call: "+a+" causeId: "+t);const n=this._answerCallScenarios[a];_.log(y.LogTraceArea.Calling,"Completing answer call scenario telemetry for scenarioId: "+a+" reason: "+(i?u.AnswerCallEndReason[i.reason]:"success")+" causeId: "+t),i?n.fail(u.AnswerCallEndReason[i.reason],i.details):n.finish(),delete this._answerCallScenarios[a],delete this._answerCallScenarioIds[e]})}test_getAnswerCallScenarios(){return this._answerCallScenarios}test_resetAnswerCallScenarios(){this._answerCallScenarios={},this._answerCallScenarioIds={}}}t.default=new U},878:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocallyStartedRinglessCallType=void 0;const a=i(7),n=i(29),o=i(328),s=i(17),r=i(33),l=i(3),c=i(4),d=i(64),u=i(18),h=i(10);var p;!function(e){e[e.OnePerson=0]="OnePerson",e[e.SmallGroup=1]="SmallGroup",e[e.LargeGroup=2]="LargeGroup",e[e.GoLive=3]="GoLive",e[e.None=4]="None"}(p=t.LocallyStartedRinglessCallType||(t.LocallyStartedRinglessCallType={}));class g{static getRinglessCallType(e,t){const i=g.getMemberCount(e);return t&&!this.isLocallyStartedRinglessCall(e,t)?p.None:1===i?p.OnePerson:i<=a.default.getS4LCMCFeatures().maximumGroupSizeRing&&a.default.getS4LCMCFeatures().enableRinglessCallForSmallGroups?p.SmallGroup:i>a.default.getS4LCMCFeatures().maximumGroupSizeRing&&a.default.getS4LCMCFeatures().enableRinglessCall?p.LargeGroup:p.GoLive}static getMemberCount(e){const t=r.default().getConversation(e);return t?Math.max(t.getMemberCount(),0):0}static isLocallyStartedRinglessCall(e,t){return n.default.CallingStore.hasStartedCallLocallyGoLive(t)}static handleRingTheGroup(e,t){const i=o.default.getInactiveGroupMembers(t,e);n.default.CallParticipantUtils.addUsersToCallOrRing(i,t,e,i,l.NavigationAddToCallOrigin.GoLiveInformationView);const a=h.default.newCauseId();c.log(l.LogTraceArea.CallingUI,"[GoLiveInformationPanel] _handleRingAll, causeId: "+a)}static isRingTheGroupOptionAvailable(e,t){return!(!g.isLocallyStartedRinglessCall(e,t)||n.default.CallingStore.hasRingingParticipants(t,!0)||this.getRinglessCallType(e)!==p.SmallGroup)}static isPotentialRinglessCall(e,t){if(!s.isGroupConversation(e))return!1;switch(g.getRinglessCallType(e)){case p.SmallGroup:return t;case p.LargeGroup:return!0;default:return!1}}static isInterstitialShown(e){const t=g.getMemberCount(e);if(1!==t)return t>a.default.getS4LCMCFeatures().maximumGroupSizeRing?d.default.getInterstitialForLargeGroupRinglessCallsShown():d.default.getInterstitialForSmallGroupRinglessCallsShown()}static shouldShowInterstitial(e,t){return!g.isInterstitialShown(e)&&g.isPotentialRinglessCall(e,t)}static maybeShowRinglessCallInterstitial(e,t,i,a){if(g.isInterstitialShown(e)||!g.isPotentialRinglessCall(e,t))return;c.log(l.LogTraceArea.CallingUI,"RinglessCallUtils show Ringlesscall interstitial");const n=g.getRinglessCallType(e)===p.LargeGroup;u.default.navigateToRinglessCallInterstitial({conversationMri:e,origin:i,withVideo:t,isLargeGroup:n,causeId:a}),n?d.default.setInterstitialForLargeGroupRinglessCallsShown(!0):d.default.setInterstitialForSmallGroupRinglessCallsShown(!0)}}t.default=g},901:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(4),n=i(1689);t.default=class{static registerOpenAction(e,t,i){a.track(new n.ExperimentOpenAction(e,t,i))}static registerDialerButtonClickAction(e,t,i){a.track(new n.ExperimentButtonClickAction(n.NavigateToDestination.DialerPanel,e,t,i))}static registerBalanceStateButtonClickAction(e,t,i){a.track(new n.ExperimentButtonClickAction(n.NavigateToDestination.BalanceStatePanel,e,t,i))}static registerCallButtonClickAction(e,t){a.track(new n.ExperimentButtonClickAction(n.NavigateToDestination.GroupCall,e,t))}static registerCloseButtonClickAction(e,t,i){a.track(new n.ExperimentBannerCloseAction(e,t,i))}}},913:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallNetworkConnectionStore=void 0;const a=i(25),n=i(1),o=i(15),s=i(29),r=i(103),l=i(3),c=i(4);let d,u=class extends o.StoreBase{constructor(){super(),this._networkSubscription=void 0,this._calls=[],this._reconnection={},this._receiveQuality={},this._receiveCatastrophic={},this._startWatchingForNetworkConnectionChanges=e=>{n.includes(this._calls,e.callId)||this._calls.push(e.callId),this._networkSubscription||(this._networkSubscription=s.default.CallingStore.networkConnectionEvent().subscribe(this._callNetworkStateUpdated))},this._stopWatchingForNetworkConnectionChanges=e=>{delete this._receiveQuality[e.callId],delete this._reconnection[e.callId],delete this._receiveCatastrophic[e.callId],n.pull(this._calls,e.callId),n.isEmpty(this._calls)&&(this._networkSubscription&&(this._networkSubscription.unsubscribe(),this._networkSubscription=void 0),this._reconnection={},this._receiveQuality={},this._receiveCatastrophic={})},this._callNetworkStateUpdated=e=>{const t=e.callId;n.includes(this._calls,t)&&(e.eventType===r.CallNetworkQualityEventType.NetworkReconnection?this._reconnection[t]=e.networkState:e.eventType===r.CallNetworkQualityEventType.NetworkReceiveQuality?this._receiveQuality[t]=e.networkState:e.eventType!==r.CallNetworkQualityEventType.NetworkReceiveCatastrophic&&e.eventType!==r.CallNetworkQualityEventType.NetworkSendCatastrophic||(this._receiveCatastrophic[t]=e.networkState),this.trigger(t))},this._listenStartAndStopCallEvents()}getCallReconnectionState(e){if(e in this._reconnection)return this._reconnection[e]}isCallQualityPoor(e){if(this.isCallCatastrophic(e))return!0;const t=this._getCallReceivedQualityState(e);return c.log(l.LogTraceArea.Calling,"isCallQualityPoor: connectionState="+t),t===r.NetworkConnectionState.LostConnection}isCallCatastrophic(e){const t=this._getCallReceiveCatastrophic(e);return c.log(l.LogTraceArea.Calling,"isCallCatastrophic: connectionState="+t),t===r.NetworkConnectionState.Connecting||t===r.NetworkConnectionState.LostConnection}_getCallReceivedQualityState(e){if(e in this._receiveQuality)return this._receiveQuality[e]}_getCallReceiveCatastrophic(e){if(e in this._receiveCatastrophic)return this._receiveCatastrophic[e]}test_listenStartAndStopCallEvents(){this._listenStartAndStopCallEvents()}_listenStartAndStopCallEvents(){s.default.CallingStore.callCreatedEvent().subscribe(this._startWatchingForNetworkConnectionChanges),s.default.CallingStore.callEndedEvent().subscribe(this._stopWatchingForNetworkConnectionChanges)}};a.__decorate([o.autoSubscribe,a.__param(0,o.key)],u.prototype,"getCallReconnectionState",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],u.prototype,"isCallQualityPoor",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],u.prototype,"isCallCatastrophic",null),a.__decorate([o.disableWarnings],u.prototype,"_listenStartAndStopCallEvents",null),u=a.__decorate([o.AutoSubscribeStore],u),t.CallNetworkConnectionStore=u,t.default=function(){return d||(d=new u)}},914:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(7),o=i(331),s=i(29),r=i(219),l=i(88),c=i(87),d=i(60),u=i(110),h=i(17),p=i(600),g=i(254),C=i(185),m=i(4),S=i(3646),y=i(5),f=i(35),_=i(11),b=i(10),v=i(30),w=i(88),T={[d.StageMode.Speaker]:l.CallViewMenuActions.SwitchToSpeaker,[d.StageMode.Presentation]:l.CallViewMenuActions.SwitchToPresentation,[d.StageMode.FocusedScreenShare]:l.CallViewMenuActions.SwitchToContent,[d.StageMode.Grid]:l.CallViewMenuActions.SwitchToModernGrid,[d.StageMode.TogetherMode]:l.CallViewMenuActions.SwitchToTogetherMode,[d.StageMode.LargeGrid]:l.CallViewMenuActions.SwitchToLargeGallery},I={[d.CallPanelHeaderLayout.Window]:"CallPanel.CallHeaderLayoutWindowLabel",[d.CallPanelHeaderLayout.Float]:"CallPanel.CallHeaderLayoutFloatLabel"},P={[d.CallPanelHeaderLayout.Window]:l.CallViewMenuActions.SwitchToWindow,[d.CallPanelHeaderLayout.Float]:l.CallViewMenuActions.SwitchToFloat};class M extends p.default{static getLayoutPickerHeight(e){const t=d.DesktopLayoutPickerItemHeight;return a.sum(a.map(e,e=>e.type===d.LayoutPickerMenuItemType.Divider?11:t))}_buildState(e,t){const i={isPSTNCall:s.default.CallingStore.isPSTNCall(e.callId),isEncryptedCall:h.isEncryptedThread(e.conversationMri),conversationMri:e.conversationMri,callId:e.callId},a=r.default.getStageMode(e.callId);this._changeCallLayoutCommand=new o.ChangeCallLayoutCommand(i,!!e.isIncomingOrOutGoingRing,a);const l=n.default.getS4LCMCFeatures();return{activeStageMode:a,activeHeaderMode:r.default.getCallHeaderLayoutMode(e.callId),tmNumberOfParticipants:l.callAudienceBotConfig.minParticipantsOnCall,lgNumberOfParticipants:l.callGridViewBotConfig.minParticipantsOnCall,activeOnlyVideoOnTheStage:r.default.getOnlyVideoOnTheStage(e.callId),isNewCallScreenActive:l.enableNewCallScreen&&v.default.getNewCallScreenDesignEnabled(),isSelfInTheGrid:r.default.getSelfInTheGrid(e.callId),isTrayHidden:r.default.isTopTrayHidden(e.callId)}}_buildRows(e,t){return e.availableItems.map((t,i)=>{let a={type:t.type,callId:e.callId,useMobileControls:e.useMobileControls,callStageV2:this.state.isNewCallScreenActive,itemColor:e.itemColor,dividerColor:e.dividerColor};switch(t.type){case d.LayoutPickerMenuItemType.Divider:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{isDivider:!0,key:"divider"+i}));case d.LayoutPickerMenuItemType.StageModeSpeaker:case d.LayoutPickerMenuItemType.StageModeFocusedScreenShare:case d.LayoutPickerMenuItemType.StageModeGrid:case d.LayoutPickerMenuItemType.StageModeManual:case d.LayoutPickerMenuItemType.StageModePresentation:case d.LayoutPickerMenuItemType.StageModeTogetherMode:case d.LayoutPickerMenuItemType.StageModeLargeGrid:const n=u.default.layoutPickerMenuItemTypeToStageMode(t.type);return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{icon:u.default.getIconForStageMode(n,this.state.isNewCallScreenActive),title:u.default.getStageModeItemTitle(n,this.state.isNewCallScreenActive),isSelected:n===u.default.displayedStageMode(this.state.activeStageMode),onRowPress:()=>this._onStageRowPress(n),changeLayoutCommand:this._changeCallLayoutCommand,tooltip:this._getTooltipForLgOrTm(n),key:d.StageMode[n]}));case d.LayoutPickerMenuItemType.OnlyVideoOnTheStage:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{icon:_.SkypeIcon.Video,title:y.getString("CallPanel.HideAudioFromTheStage"),onRowPress:()=>this._onOnlyVideoOnTheStageRowPress(),isSelected:this.state.activeOnlyVideoOnTheStage,key:"onlyVideoOnTheStage",isNew:t.isNew}));case d.LayoutPickerMenuItemType.Fullscreen:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{icon:this._getFullscreenModeIcon(!!e.isInFullscreenMode),title:this._getFullscreenModeItemTitle(!!e.isInFullscreenMode),onRowPress:()=>this._onFullScreenRowPress(!e.isInFullscreenMode),key:"fullscreen"}));case d.LayoutPickerMenuItemType.CallPanelHeaderLayoutMobile:case d.LayoutPickerMenuItemType.CallPanelHeaderLayoutFloat:case d.LayoutPickerMenuItemType.CallPanelHeaderLayoutWindow:case d.LayoutPickerMenuItemType.CallPanelHeaderLayoutNone:const o=u.default.layoutPickerMenuItemTypeToHeaderMode(t.type);return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{title:this._getHeaderModeItemTitle(o),isSelected:o===this.state.activeHeaderMode,onRowPress:()=>this._onHeaderRowPress(o),key:d.CallPanelHeaderLayout[o]}));case d.LayoutPickerMenuItemType.NewCallScreenToggle:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{icon:_.SkypeIcon.MagicWand,title:y.getString("CallPanel.NewCallScreen"),isSelected:this.state.isNewCallScreenActive,onRowPress:()=>this._onNewCallScreenToggled(),key:"newCallScreen",isNew:t.isNew}));case d.LayoutPickerMenuItemType.SelfInTheGridToggle:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{icon:_.SkypeIcon.Contact,title:y.getString("CallPanel.ShowMyselfInTheGrid"),isSelected:this.state.isSelfInTheGrid,onRowPress:()=>this._onSelfInTheGridToggled(),key:"selfInGrid",isNew:t.isNew}));case d.LayoutPickerMenuItemType.HidePeopleAtTop:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{icon:_.SkypeIcon.TopPanelCollapse,title:y.getString("CallPanel.HidePeopleAtTop"),onRowPress:()=>this._onTopTrayCollapseExpandPress(),key:"hideTray"}));case d.LayoutPickerMenuItemType.ShowPeopleAtTop:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{icon:_.SkypeIcon.TopPanelExpand,title:y.getString("CallPanel.ShowPeopleAtTop"),onRowPress:()=>this._onTopTrayCollapseExpandPress(),key:"showTray"}))}})}_buildSimpleRowBuilder(e){return{props:e,builder:S.default.buildRow}}_onStageRowPress(e){this._changeCallLayoutCommand.execute(e),g.default.close(this.props.rootViewId,b.default.newCauseId()),c.default.trackCallViewMenuActions(T[e])}_onHeaderRowPress(e){r.default.setCallHeaderLayoutMode(this.props.callId,e),g.default.close(this.props.rootViewId,b.default.newCauseId()),c.default.trackCallViewMenuActions(P[e])}_onOnlyVideoOnTheStageRowPress(){const e=!this.state.activeOnlyVideoOnTheStage;r.default.setOnlyVideoOnTheStage(this.props.callId,e),this._forgetManuallySetStageRibbonParticipantPlacements(),g.default.close(this.props.rootViewId,b.default.newCauseId());const t=e?l.CallViewMenuActions.ActivateOnlyVideoOnTheStage:l.CallViewMenuActions.DeactivateOnlyVideoOnTheStage;c.default.trackCallViewMenuActions(t)}_forgetManuallySetStageRibbonParticipantPlacements(){this.state.activeStageMode===d.StageMode.Manual&&this._changeCallLayoutCommand.execute(d.StageMode.Grid),s.default.OngoingCallService.setStagedParticipantsSelection(this.props.callId,void 0)}_onNewCallScreenToggled(){const e=!this.state.isNewCallScreenActive;v.default.setNewCallScreenDesignEnabled(e),n.default.getS4LCMCFeaturesNoSubscription().newCallScreenEnabledByDefault||v.default.setUserPreferencesLocal({wasNewCallScreenRevertNoticeDismissed:!0}),g.default.close(this.props.rootViewId,b.default.newCauseId());const t=e?l.CallViewMenuActions.ActivateNewCallScreen:l.CallViewMenuActions.DeactivateNewCallScreen;c.default.trackCallViewMenuActions(t),m.track(new w.CallStageLayoutChangeEvent(this.state.activeStageMode,this.state.activeStageMode,this.state.activeOnlyVideoOnTheStage,this.state.activeOnlyVideoOnTheStage,e,!1))}_onSelfInTheGridToggled(){const e=!this.state.isSelfInTheGrid;r.default.setSelfInTheGrid(e,this.props.callId),g.default.close(this.props.rootViewId,b.default.newCauseId());const t=e?l.CallViewMenuActions.ActivateSelfInTheGrid:l.CallViewMenuActions.DeactivateSelfInTheGrid;c.default.trackCallViewMenuActions(t)}_onTopTrayCollapseExpandPress(){const e=!this.state.isTrayHidden;r.default.setHideTopTray(e,this.props.callId),g.default.close(this.props.rootViewId,b.default.newCauseId()),m.track(new l.ToggleCallTray(this.props.callId,e))}_onFullScreenRowPress(e){g.default.close(this.props.rootViewId,b.default.newCauseId()),e?f.default.tryEnterFullScreenMode(this.props.rootViewId).then(e=>{e?(m.track(new l.RibbonSettingsMenuActionEvent(l.RibbonSettingsMenuActions.EnterFullScreen)),c.default.trackCallViewMenuActions(l.CallViewMenuActions.EnterFullScreen)):m.log(C.LogTraceArea.CallingUI,"Failed to Enter Full Screen Mode")}):f.default.exitFullScreenMode(this.props.rootViewId).then(()=>{m.track(new l.RibbonSettingsMenuActionEvent(l.RibbonSettingsMenuActions.ExitFullScreen))}).catch(e=>{m.log(C.LogTraceArea.CallingUI,"Failed to exit full screen mode:")})}_getTooltipForLgOrTm(e){if(e===d.StageMode.TogetherMode||e===d.StageMode.LargeGrid)return y.getString("CallPanel.StageModeRequiresMoreParticipantsTooltip",{count:d.StageMode.TogetherMode?this.state.tmNumberOfParticipants:this.state.lgNumberOfParticipants})}_getHeaderModeItemTitle(e){const t=I[e];return t?y.getString(t):(m.error(C.LogTraceArea.CallingUI,"No title found for header mode: "+d.CallPanelHeaderLayout[e]),"")}_getFullscreenModeItemTitle(e){return e?y.getString("CallPanel.ExitFullScreen"):y.getString("CallPanel.EnterFullScreen")}_getFullscreenModeIcon(e){return e?_.SkypeIcon.FitToWindow:_.SkypeIcon.ViewSwitcher}}t.default=M},915:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RibbonExtraViewBase=void 0;const a=i(0),n=i(241),o=i(109),s=i(141),r=i(26),l=i(6),c=i(9),d=i(11),u=i(16),h=i(12),p=l.lazyProperties({container:()=>a.Styles.createViewStyle({justifyContent:"center",alignItems:"center"}),innerContainer:()=>a.Styles.createViewStyle({justifyContent:"center",alignItems:"center",overflow:"hidden",flexDirection:"row"}),label:()=>a.Styles.createTextStyle({color:c.Color.whiteOverlay80,backgroundColor:c.Color.transparent,textAlign:"center",textAlignVertical:"center",marginHorizontal:5,paddingBottom:1}),chevronIcon:()=>a.Styles.createViewStyle({marginLeft:5}),iconStyle:()=>a.Styles.createViewStyle({overflow:"visible"}),redDot:()=>a.Styles.createViewStyle({width:10,height:10,borderRadius:5,backgroundColor:c.Color.red,position:"absolute",left:12,top:15})}),g=c.Color.blackOverlay50;class C extends h.default{constructor(){super(...arguments),this._onHiddenChanged=e=>{this.isComponentMounted()&&this.state.hidden!==e&&this.setState({hidden:e})},this._onPress=e=>{this._handleOnPress(e)},this._onButtonRef=e=>{this._buttonRef=e||void 0}}_iconSize(){return d.IconSize.size16}_iconBackgroundColor(){return this.props.useHighContrastTheme?this._themeColors.primaryBackgroundColor:g}_iconBorderColor(){return this.props.useHighContrastTheme?this._themeColors.dividerColor:void 0}_tooltip(){}_accessibilityLabel(){return this.props.accessibilityLabel}_labelStyle(){}_shouldRenderRedDot(){return!1}_iconColor(){}_containerStyle(){}_getMainContainerStyles(){}_buildState(e,t){const i={};return t&&(i.hidden=e.layoutController.isHidden()),i}_handleOnPress(e){this.props.onPress&&this.props.onPress()}componentDidMount(){super.componentDidMount(),this.props.layoutController.onHiddenChanged&&this.props.layoutController.onHiddenChanged(this._onHiddenChanged)}render(){if(this.state.hidden)return null;const e=this._label(),t=this._icon(),i=[p.label,this.props.useHighContrastTheme?this._themeStyles.primaryTextColorStyle:void 0,this._labelStyle()],l=e?a.createElement(u.BodyText,{style:i},e):void 0;let h,g,C,m=this._iconColor();m||(m=this.props.useHighContrastTheme?this._themeColors.primaryIconColor:c.Color.whiteOverlay80),t&&(h=a.createElement(r.default,{icon:t,size:this._iconSize(),color:m,style:p.iconStyle})),this._shouldRenderRedDot()&&(g=a.createElement(a.View,{style:p.redDot})),this.props.showChevron&&(C=a.createElement(r.default,{icon:d.SkypeIcon.DownChevron,size:6,color:m,style:p.chevronIcon}));const S=this.props.dimensions.width===this.props.dimensions.height?this.props.dimensions.width/2:0,y=[p.innerContainer,a.Styles.createViewStyle({backgroundColor:this._iconBackgroundColor(),height:this.props.dimensions.height,width:this.props.dimensions.width,borderRadius:S},!1)],f=this._iconBorderColor();f&&y.push(a.Styles.createViewStyle({borderColor:f,borderWidth:1},!1)),y.push(this._containerStyle());const _=this._accessibilityLabel(),b={style:y,title:this._tooltip(),accessibilityLabel:_,onPress:this._onPress};let v;const w=this.props.coachMarkType;v=w&&_?a.createElement(n.default.HoverableButton,Object.assign({},b,{coachMarkType:w,anchorAccessibilityLabel:_,onAnchorPress:this._onPress,positions:[o.PopupAnchorPositon.Bottom],anchorRef:this._onButtonRef}),h,l,g,C):a.createElement(s.HoverableButton,Object.assign({},b,{ref:this._onButtonRef}),h,l,g,C);const T=[p.container,this.props.layoutController.getStyles()];return this.props.ribbonOpacityStyle&&T.push(this.props.ribbonOpacityStyle),T.push(this._getMainContainerStyles()),a.createElement(a.Animated.View,{style:T},v)}}t.RibbonExtraViewBase=C,t.default=C},933:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=i(1),n=i(35),o=i(0),s=i(51),r=i(7),l=i(50),c=i(29),d=i(123),u=i(103),h=i(377),p=i(17),g=i(357),C=i(290),m=i(43),S=i(98),y=i(13),f=i(71),_=i(33),b=i(359),v=i(905),w=i(3851),T=i(3),I=i(472),P=i(99),M=i(41),k=i(173),A=i(4),R=i(6),V=i(208),E=i(233),L=i(5),B=i(30),O=i(162),D=i(18),x=i(23),N=i(278),U=i(1727),F=i(184),H=i(3854),z=i(287),G=i(273),W=i(27),K=i(39),j=i(36),Q=i(59),q=i(78),X=i(542),$=i(154),J=i(418),Y=i(163),Z=i(352),ee=i(1834),te=i(1737),ie=i(484),ae=i(44),ne=i(1270),oe=i(3855),se=i(1237),re=i(124),le=i(201),ce=i(107),de=i(42),ue=i(11),he=i(14),pe=i(46),ge=i(10),Ce=i(623),me=[H.QuickCallPanelFilter.All,H.QuickCallPanelFilter.Skype,H.QuickCallPanelFilter.Phone],Se=R.lazyProperties({mainContainer:()=>o.Styles.createViewStyle({alignSelf:"stretch",flex:1}),headerContainer:()=>o.Styles.createViewStyle({flexDirection:"column",alignItems:"stretch"}),innerHeaderContainer:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),searchInputContainer:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),noCallsContainer:()=>o.Styles.createViewStyle({flex:1,paddingLeft:12,paddingRight:12,paddingTop:20,paddingBottom:20}),searchBoxContainerCompositeNav:()=>o.Styles.createViewStyle({alignSelf:"stretch",alignItems:"stretch",justifyContent:"center",flexDirection:"row",height:$.SearchInputHeight.default,paddingLeft:15,paddingVertical:10,flex:1}),searchHeaderWrapper:()=>o.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0}),searchAccessoryButton:()=>o.Styles.createViewStyle({marginRight:5}),dialpadBarAccessibilityOffset:()=>o.Styles.createViewStyle({marginBottom:65})}),ye={zeroInput:[{groupType:T.SearchResultsListGroup.PstnDialpad},{groupType:T.SearchResultsListGroup.UpcomingCalls},{groupType:T.SearchResultsListGroup.RecentCalls},{groupType:T.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:T.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}],zeroInputWithDialpadAccessory:[{groupType:T.SearchResultsListGroup.UpcomingCalls},{groupType:T.SearchResultsListGroup.RecentCalls},{groupType:T.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:T.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}],zeroInputSearchOnly:[{groupType:T.SearchResultsListGroup.RecentCalls},{groupType:T.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:T.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}],zeroInputOneOnOneCall:[{groupType:T.SearchResultsListGroup.RecentCalls},{groupType:T.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:T.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}],zeroInputAddToOneOnOneCall:[{groupType:T.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:T.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}],zeroInputGroupCall:[{groupType:T.SearchResultsListGroup.GroupMember},{groupType:T.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:T.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}],zeroInputCallsOnly:[{groupType:T.SearchResultsListGroup.RecentCallsExtended}],shortQuery:[{groupType:T.SearchResultsListGroup.AllPeople},{groupType:T.SearchResultsListGroup.GroupChats}],longQuery:[{groupType:T.SearchResultsListGroup.AllPeople,isCollapsible:!0},{groupType:T.SearchResultsListGroup.GroupChats,isCollapsible:!0},{groupType:T.SearchResultsListGroup.PublicDirectory,isCollapsible:!0}]},fe="quickCallHeader",_e="selectedProfilesList",be="quickCallSearchResultList",ve="compositeNavsearchResultsListWrapper";class we extends l.default{constructor(e){super(e),this._onKeyDownEvent=new s.default,this._searchActive=!1,this._shadowVisible=!1,this._headerExpanded=!0,this._selectedProfiles=[],this._headerAnimatedTopValue=new o.Animated.Value(0),this._headerAnimatedTopStyle=o.Styles.createAnimatedViewStyle({transform:[{translateY:this._headerAnimatedTopValue}]}),this._resetTransitionTransformValue=new o.Animated.Value(0),this._resetTransitionOpacityValue=new o.Animated.Value(1),this._resetTransitionStyle=o.Styles.createAnimatedViewStyle({opacity:this._resetTransitionOpacityValue,transform:[{translateY:this._resetTransitionTransformValue}]}),this._shadowOpacityValue=new o.Animated.Value(0),this._shadowOpacityStyle=o.Styles.createAnimatedViewStyle({opacity:this._shadowOpacityValue}),this._renderAddContacts=()=>o.createElement(o.View,{style:Se.noCallsContainer,key:"noCallsItem"},o.createElement(U.default,{infoLabel:L.getString("QuickCallPanel.NoCallsDescriptionDesktop"),title:L.getString("QuickCallPanel.NoCallsTitleDesktop")})),this._renderDialpadButtonMobile=()=>o.createElement(M.default,{size:ue.IconSize.size24,onPress:this._onPressDialer,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,icon:ue.SkypeIcon.Dialpad,title:L.getString("PeopleList.PstnDialpadLabel")}),this._handleMenuCommand=e=>{if(!this.isComponentMounted())return;const t=we._filterForCommand(e);a.isUndefined(t)||(B.default.setUserPreferencesLocal({quickCallFilter:t}),this.setState({filter:t}))},this._getSearchButton=(e,t)=>{const i=e?Q.default.horizontalPaddingStyle(e):void 0;let a=o.createElement(X.default,{key:"search",buttonOnly:!0,placeholderText:L.getString("SearchInputControl.PlaceHolderTextPeopleGroupsMessages"),accessibilityLabel:this.state.isMobileScreenReaderEnabled?L.getString("HubHeaderPanel.SearchHubAccessibilityLabel"):void 0,useIOSStyles:this.state.useIOSSearchStyles,safeAreaPaddingStyle:i,showSearchIcon:this._getContext().isPresentedInGenericDesktopModal,onPress:this._handleSearchButtonClick});if(e&&t){const t=o.Styles.createViewStyle({marginLeft:-1*e.left,marginRight:-1*e.right},!1);a=o.createElement(o.View,{style:t},a)}return this.state.useMobileOrTabletUI?a:o.createElement(o.View,{style:[Se.searchBoxContainerCompositeNav,this._themeStyles.searchBoxColorStyle]},a)},this._handleSearchButtonClick=()=>{const e=ge.default.newCauseId();A.log(T.LogTraceArea.QuickCallPanel,"_handleSearchButtonClick causeId: "+e),D.default.navigateToSearchFromPanel(e,this._getContext(),this._isPresentedInTabletLeftNav(),T.SearchPanelInitiator.QuickCallPanel)},this._addSelectedUsersToCall=()=>{const e=ge.default.newCauseId();A.log(T.LogTraceArea.QuickCallPanel,"_addSelectedUsersToCall causeId: "+e),this.state.selectedMris&&this._addUsersToCall(this.state.selectedMris.map(e=>{const t=this.state.mriToPhoneMriMap.get(e);return t||e}),e)},this._handleSearchResultsListAddUserToCall=(e,t)=>{const i=ge.default.newCauseId();A.log(T.LogTraceArea.QuickCallPanel,"_handleAddUserToCall causeId: "+i),this._containerRef&&this._containerRef.requestFocus?this._searchResultsListActionHelper(t,e,i):A.error(T.LogTraceArea.QuickCallPanel,"_searchResultsListActionHelper anchor is not focusable:  has container ref: "+!!this._containerRef+", causeId: "+i)},this._handleSearchResultsListItemClick=(e,t,i)=>{const a=ge.default.newCauseId();if(A.log(T.LogTraceArea.QuickCallPanel,"_handleListItemClick causeId: "+a),i===T.SearchResultsListGroup.PstnDialpad)this._onPressDialer();else{const i=()=>e.isComponentMounted()?e:void 0;this._searchResultsListActionHelper(i,t,a)}},this._onPressDialer=()=>{const e=ge.default.newCauseId();A.log(T.LogTraceArea.QuickCallPanel,"_onToggleDialpad, causeId: "+e),this._onInputTextChange("");let t=T.DialerNavigationSource.QuickCallPanel;this.props.callId?t=this.props.newGroup?T.DialerNavigationSource.QuickCallPanelAddToCall:T.DialerNavigationSource.QuickCallPanelNewCall:this.state.isInGroupCallMode&&(t=this.props.newGroup?T.DialerNavigationSource.QuickCallPanelNewCall:T.DialerNavigationSource.QuickCallPanelAddToCall),D.default.navigateToPSTNDialerWithParams({callId:this.props.callId,conversationId:this.props.conversationId,causeId:e,navigationSource:t},this._getRootViewId())},this._removeProfileFromSelection=e=>{if(this.isComponentMounted()){const t=e.getMri(),i=t?this._removeEntryFromMriToPhoneMap(t):void 0,n=a.compact(a.without(this.state.selectedMris,i||t));this.setState({selectedMris:n}),this._searchResultsList?this._searchResultsList.focusFirst():this._groupCallModeHeaderButtonRef&&this._groupCallModeHeaderButtonRef.requestFocus()}},this._onSimplePanelHeaderRef=e=>{this._headerRef=e||void 0},this._onSearchResultsListRef=e=>{this._searchResultsList=e||void 0},this._onContainerRef=e=>{this._containerRef=e||void 0},this._onGroupCallModeHeaderButtonRef=e=>{this._groupCallModeHeaderButtonRef=e||void 0},this._onGroupCallBackHeaderButtonRef=e=>{this._groupCallBackHeaderButtonRef=e||void 0},this._onSearchActive=e=>{this._showOrHideHeader(this.state,!e,!0),e?this.setState({isSearchActive:e}):this.setState({isSearchActive:e,rawSearchQuery:""}),this._updateStatusBarStyle(e&&!this._useAccessibleTheme()?ce.default.createBarStyle(le.BarStyleTheme.Light,!0):ce.default.createBarStyle(this._themeColors.defaultStatusBarTheme,!0))},this._onPressClose=()=>{const e=ge.default.newCauseId();A.log(T.LogTraceArea.QuickCallPanel,"_onPressClose causeId: "+e),this.setState({rawSearchQuery:""}),this._goBack(e)},this._onSearchInputKeyDown=e=>{this._onKeyDownEvent.fire(e.keyCode)},this._onContentWrapperRef=e=>{this._wrappedTransitionView=e||void 0},this._onSearchHeaderRef=e=>{this._searchHeader=e||void 0},this._onHeaderExpanded=e=>{if(this.isComponentMounted()){let t;t=e&&!this._useAccessibleTheme()?ce.default.createBarStyle(le.BarStyleTheme.Light):ce.default.createBarStyle(this._themeColors.defaultStatusBarTheme),this._updateStatusBarStyle(t)}},this._onScroll=(e,t)=>{if(this.props.onScroll&&this.props.onScroll(e,t),this._shouldCollapseHeader()){let i=this._headerExpanded;if(e<C.default.collapsableHeight(this._getRootViewId()))i=!0;else{const a=t-e>0;i=i&&a}this._expandOrCollapseHeader(i,!0)}},this._onExperimentalNavScroll=(e,t)=>{this.props.onScroll&&this.props.onScroll(e,t);const i=e>0;this._shadowVisible!==i&&(o.Animated.timing(this._shadowOpacityValue,{toValue:i?.5:0,duration:100,easing:o.Animated.Easing.Out()}).start(),this._shadowVisible=i)},this._onExperimentalCallButtonPress=e=>{{const t=ge.default.newCauseId();A.log(T.LogTraceArea.QuickCallPanel,"_handleGroupCallButtonClick_Floating_CTA_desktop causeId: "+t),this._enterGroupCallMode(e)}},this._enterGroupCallMode=e=>{e.stopPropagation(),this.setState({isInGroupCallMode:!0})},this._leaveGroupCallMode=e=>{e.stopPropagation(),this.setState({isInGroupCallMode:!1,selectedMris:[]})},this._startGroupCall=()=>{const e=ge.default.newCauseId();if(A.log(T.LogTraceArea.QuickCallPanel,"_startGroupCall causeId: "+e),this.state.selectedMris&&1===this.state.selectedMris.length){const t=()=>this._groupCallModeHeaderButtonRef;this._startCallToMri(this.state.selectedMris[0],t,e,T.NavigationCallOrigin.QuickCallPanelNewCall)}else this.setState({isNewGroupCallStarting:!0}),this.state.selectedMris?c.default.CallNavigationHelper.startNewGroupCallAndConversation(this.state.selectedMris,!1,e,void 0,T.NavigationCallOrigin.StartNewGroupCallAndConv).always(()=>{this.isComponentMounted()&&this.setState({isNewGroupCallStarting:!1})}):A.error(T.LogTraceArea.QuickCallPanel,"_startGroupCall with no mris causeId: "+e)},this._onInputTextChange=e=>{this.isComponentMounted()&&this.setState({rawSearchQuery:e})},this._goBack=e=>(A.log(T.LogTraceArea.QuickCallPanel,"QuickCallPanel._goBack, causeId: "+e),this._isPresentedInTabletLeftNav()?(D.default.closeCallSearchPanel(e,this._getContext()),!0):super._goBack(e)),e.searchOnly&&(this._transitionSubscriptionToken=N.default.transitionInfoEvent().subscribe(e=>{if(e.inProgress&&this.isComponentMounted())if(N.default.isHubSearchTransition()){if(e.toRoute&&e.fromRoute&&e.progress){const t=e.toRoute.type===N.RouteType.Search?e.toRoute.index:e.fromRoute.index;a.isUndefined(t)?this._clearAnimatedValues():this._setAnimatedValues(e.progress,t)}}else this._clearAnimatedValues()}))}_buildState(e,t){let i=H.QuickCallPanelFilter.All;e.useExperimentalDesktopUtilityBar&&(i=B.default.getUserPreferencesLocal().quickCallFilter||H.QuickCallPanelFilter.All);let s={filter:i};t&&(s.isSearchActive=!1,s.isInGroupCallMode=!1,s.isNewGroupCallStarting=!1,s.selectedMris=[],s.mriToPhoneMriMap=new Map,s.rawSearchQuery="",this._searchController=new Z.default,e.newGroup&&(s.isInGroupCallMode=!0),this._headerAnimatedHeightValue=new o.Animated.Value(C.default.expandedHeight(this._getRootViewId())),this._headerAnimatedHeightStyle=o.Styles.createAnimatedViewStyle({height:this._headerAnimatedHeightValue}));const r=this._getContext(),l=this._getRootViewId(),u=x.default.isUsingStackNavigationContext(),h=!e.hideHeader&&(!r.isPresentedInDesktopSubview||this._isPresentedInTabletLeftNav());s.isSmallDevice=W.default.isSmallDevice(l),s.statusBarPadding=h?j.default.statusBarPadding():0,s.isPortrait=W.default.getDeviceOrientation(l)===n.DeviceOrientation.Portrait,s.isSyncAddressBookEnabled=F.default.getSyncAddressBookPrivacySetting(),s.hasCallsAndContacts=_.default().hasJoinedConversationsWithCall()||f.default.getFilteredSortedAllPeopleProfiles("",{excludeBots:!0,excludeShortCircuitMatches:!s.isSyncAddressBookEnabled,excludeUnauthorized:!s.isSyncAddressBookEnabled,excludeBlocked:!0}).length>0,s.useIOSSearchStyles=C.default.useIOSSearchStyles(),s.useMobileOrTabletUI=u||!!this._isPresentedInTabletLeftNav(),s.disableHighBandwidthOperations=k.default.isUsingGogoNetwork();const p=e.callId,g=e.conversationId;if(p&&g){s.activeCallMemberMris=a.map(a.filter(c.default.CallingStore.getRemoteCallMembers(p),e=>!!e&&(d.default.isParticipantConnected(e)||d.default.isParticipantStateRinging(e.state))),e=>c.default.CallingStore.getRemoteCallMemberMri(p,e));const e=_.default().getConversation(g);e&&(s.conversationMemberMris=e.getMemberMris())}return s.isMobileScreenReaderEnabled=q.default.isMobileScreenReaderEnabled(),s.rowSize=this._isPresentedInDesktopLeftNav()?z.default.nonRecentRowSizeAndChanges():void 0,s.enableIOSCallsFABExperiment=!1,s.modernizeConversationList=P.default.canModernizeConversationList(),s}scrollToTop(){this._searchResultsList&&this._searchResultsList.scrollToTop()}componentDidMount(){super.componentDidMount();const e=ce.default.mergeStyles([ce.default.createBarStyle(this.props.searchOnly?le.BarStyleTheme.Light:this._themeColors.defaultStatusBarTheme),ce.default.createHiddenStyle(!1)]);this._updateStatusBarStyle(e),this._showOrHideHeader(this.state,!this._searchActive,!1),this._onScroll(0,0),ne.default.showPromptIfNeeded(this.props.conversationId||y.MainRootViewId)}componentWillUnmount(){super.componentWillUnmount(),this._transitionSubscriptionToken&&(this._transitionSubscriptionToken.unsubscribe(),this._transitionSubscriptionToken=void 0),this._searchController&&this._searchController.destroy(),this._onScroll(0,0)}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i);const n=e=>{const t=this.state.mriToPhoneMriMap.get(e);return t||e};this._selectedProfiles=a.map(t.selectedMris,e=>pe.default.getDisplayableUserByMri(n(e))),this.state.statusBarPadding===t.statusBarPadding&&this.state.isPortrait===t.isPortrait&&this.state.selectedMris===t.selectedMris||this._showOrHideHeader(t,!this._searchActive,!1)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.isInGroupCallMode!==t.isInGroupCallMode&&(this._headerRef&&this._headerRef.requestFocus(),this._groupCallBackHeaderButtonRef&&this.state.isInGroupCallMode&&this._groupCallBackHeaderButtonRef.requestFocus())}render(){const e=this._shouldCollapseHeader(),t=a.trim(this.state.rawSearchQuery),i=0===t.length;let n;if(i)if(this.state.filter===H.QuickCallPanelFilter.Phone||this.state.filter===H.QuickCallPanelFilter.Skype)n=a.clone(ye.zeroInputCallsOnly);else if(e)n=a.clone(ye.zeroInputSearchOnly);else{let e=a.clone(ye.zeroInputGroupCall);r.default.getS4LCMCFeaturesNoSubscription().enableAddToCallGroupJoinLink&&e.unshift({groupType:T.SearchResultsListGroup.ShareGroup}),n=this.state.isInGroupCallMode?this.props.conversationId&&p.isGroupConversation(this.props.conversationId)?e:this.props.callId?a.clone(ye.zeroInputAddToOneOnOneCall):a.clone(ye.zeroInputOneOnOneCall):a.clone(ye.zeroInputWithDialpadAccessory)}else n=t.length<r.default.getConfigSettingsNoSubscription().search.longQueryCharCount?a.clone(ye.shortQuery):a.clone(ye.longQuery);(this.state.isInGroupCallMode||this.props.callId)&&a.remove(n,e=>e.groupType===T.SearchResultsListGroup.GroupChats);const s=this._shouldShowDialPadBar(n),l=this.props.useExperimentalDesktopUtilityBar?this._renderUtilityBar():void 0,c=l?this._renderShadow():void 0,d=[Se.mainContainer,this._getBackgroundColorStyle()];let u=[];if(this.state.hasCallsAndContacts||this.state.isSyncAddressBookEnabled){this.state.isInGroupCallMode&&!a.isEmpty(this._selectedProfiles)&&u.push(o.createElement(ee.default,{key:_e,selectedProfiles:this._selectedProfiles,onProfileRemoved:this._removeProfileFromSelection}));const t=this.props.callId||this.state.isInGroupCallMode?Y.FilterType.GroupCallCapable:Y.FilterType.CallCapable;let r=0;e&&(r=C.default.collapsableHeight(this._getRootViewId()));const l=!this.state.isInGroupCallMode&&(!this.props.callId&&i),d=Math.max(this.props.bottomPadding||0,s&&!this.state.isMobileScreenReaderEnabled?65:0),h=e||this.props.onScroll?this._onScroll:c?this._onExperimentalNavScroll:void 0,p=this._getContext().isPresentedInGenericDesktopModal||!this.props.isMobileTab?T.SearchResultsListOrigin.QuickCallPanelModal:T.SearchResultsListOrigin.QuickCallPanel,g=o.createElement(J.SearchResultsList,{rawSearchQuery:this.state.rawSearchQuery,origin:p,ref:this._onSearchResultsListRef,key:be,userMrisToExclude:this.state.activeCallMemberMris,searchResultGroups:n,searchController:this._searchController,isSearchActive:this.state.isSearchActive,hasCallIcons:l,hasAddToCallIcon:!!this.props.callId&&!this.props.newGroup,filterPeopleType:t,arePeopleSelectableForInvite:this.state.isInGroupCallMode,maxNumberOfSuggestedContacts:20,onListItemClick:this._handleSearchResultsListItemClick,onAddUserToCall:this.props.callId?this._handleSearchResultsListAddUserToCall:void 0,selectedMris:this.state.isInGroupCallMode?this.state.selectedMris:void 0,showInviteButton:!1,showButtonsOnHover:this.props.useExperimentalDesktopUtilityBar,disableItemOnLongPress:!0,excludeGroups:this.state.isInGroupCallMode,excludeEncrypted:this.state.isInGroupCallMode,onlyPstn:this.state.filter===H.QuickCallPanelFilter.Phone,excludePstn:this.state.filter===H.QuickCallPanelFilter.Skype,keyDownEvent:this._onKeyDownEvent,headerViewConfig:this._getSearchButtonConfig(),topInset:r,bottomPadding:d,onScroll:h,accessibilityLabel:L.getString("QuickCallPanel.CallsList"),suppressPseudoFocus:!0,conversationId:this.props.conversationId,hideEmptyState:this.props.newGroup,rowSize:this.state.rowSize,excludeRecentCallFromSuggestedList:!0});this.state.useMobileOrTabletUI?u.push(g):u.push(o.createElement(o.View,{style:he.default.flexOne,key:ve},g,c))}else this._isPresentedInDesktopLeftNav()||u.push(o.createElement(se.default,{key:"skypeToPhoneCardExperiment",location:I.ExperimentLocation.CallsPanel})),u.push(this._renderAddContacts());const h=[he.default.flexOne];let g;this.state.useMobileOrTabletUI?(this.props.searchOnly&&h.push(o.Styles.createViewStyle({marginTop:C.default.collapsedHeight(this._getRootViewId())+this.state.statusBarPadding},!1)),s&&this.state.isMobileScreenReaderEnabled&&h.push(Se.dialpadBarAccessibilityOffset),g=o.createElement(o.View,{key:"content",style:h},u)):g=u;const m=e?this._renderSearchHeader():this._renderHeaderContainer(),y=s?o.createElement(w.default,{key:"DialpadBarExperiment",location:I.ExperimentLocation.CallsPanel,onPress:this._onPressDialer,onCallButtonPress:this._onExperimentalCallButtonPress}):void 0,f=this._getFooterButton(),_=[m,l,g,y];let b=o.createElement(o.View,{ref:this._onContainerRef,style:d},e?a.reverse(_):_,this._renderEntitlementsBanner(),f?this._getPanelFooter(f):void 0);return this.props.searchOnly&&(b=o.createElement(Ce.default,{ref:this._onContentWrapperRef,style:Se.mainContainer},b)),o.createElement(S.default,{goBack:this._goBack},b)}_getPanelFooter(e){const t=o.createElement(ie.default,{button:e});return this.state.modernizeConversationList?o.createElement(o.View,{style:O.default.getBannerBackgroundColorStyle(this._useDarkTheme(),this._useAccessibleTheme(),this._themeStyles)},t):t}_getBackgroundColorStyle(){return this.state.modernizeConversationList&&(this._isPresentedInDesktopLeftNav()||this._isPresentedInTabletLeftNav())?O.default.getBackgroundColorStyle(this._useDarkTheme(),this._useAccessibleTheme(),this._themeStyles):this._isPresentedInDesktopLeftNav()?this._themeStyles.secondaryBackgroundColorStyle:this._themeStyles.primaryBackgroundColorStyle}_renderShadow(){return o.createElement(v.default,{opacityStyle:this._shadowOpacityStyle})}_renderUtilityBar(){const e=we._menuItemTitle(this.state.filter),t=m.default.combinedAccessibilityLabel(L.getString("QuickCallPanel.ViewByMenu"),e);return o.createElement(te.default,{key:"utilitybar",getMenuSections:this._getMenuSections(),currentMenuText:e,accessibilityText:t,onHandleMenuCommand:this._handleMenuCommand,newActionPickerContext:this.props.newActionPickerContext})}_renderSearchHeader(){if(this.state.useMobileOrTabletUI)return o.createElement(o.View,{key:fe,style:Se.searchHeaderWrapper,ignorePointerEvents:!0},o.createElement(g.default,{ref:this._onSearchHeaderRef,initialValue:1,autoFocus:!0,rawSearchQuery:this.state.rawSearchQuery||"",onInputTextChange:this._onInputTextChange,cancelSearch:this._onPressClose,onExpanded:this._onHeaderExpanded}))}_renderHeaderContainer(){if(this.props.hideHeader)return;let e;if(this.state.useMobileOrTabletUI){let t,i;t=o.createElement(g.default,{initialValue:1,showButtonWhenInactive:!0,placeholderText:L.getString("SearchInputControl.PlaceHolderTextPeopleGroupsMessages"),buttonAccessibilityLabel:this.state.isMobileScreenReaderEnabled?L.getString("HubHeaderPanel.SearchHubAccessibilityLabel"):void 0,rawSearchQuery:this.state.rawSearchQuery||"",onInputTextChange:this._onInputTextChange,onActive:this._onSearchActive,actionButton:this.state.isInGroupCallMode?this._groupCallModeHeaderButton():void 0,buttonAccessoryView:this._renderDialpadButtonMobile(),hideButtonAccessoryViewBorder:!0}),this.state.hasCallsAndContacts&&(i=o.createElement(o.View,{style:Se.searchInputContainer},t));const a=this._getHeaderText(this.state),n=a?void 0:o.createElement(o.View,{style:he.default.flexOne});e=o.createElement(o.Animated.View,{key:fe,style:[Se.headerContainer,this._headerAnimatedHeightStyle]},o.createElement(o.Animated.View,{style:this._headerAnimatedTopStyle},o.createElement(ae.SimplePanelHeader,{ref:this._onSimplePanelHeaderRef,panelName:a,leftButton:this._getHeaderCloseButton(),titleView:n,hideBottomBorder:!0,delayHeaderFocus:!1,shouldAnnouncePanelNameOnMount:!!this.props.callId&&!1}),i))}else{let t;if(this.state.hasCallsAndContacts){const e=o.createElement(de.default,{style:Se.searchAccessoryButton,buttonStyle:y.SXButtonStyle.LightFill,buttonSize:y.SXButtonSize.Small,title:L.getString("QuickCallPanel.DialpadButtonLabel"),allowTextWrap:!1,icon:ue.SkypeIcon.Dialpad,showShadow:!0,onPress:this._onPressDialer});t=o.createElement(o.View,{style:Se.searchInputContainer},o.createElement(b.default,{placeholderText:L.getString("SearchInputControl.PlaceHolderTextPeopleGroupsMessages"),accessoryView:e,showButtonWhenInactive:!0,autoFocus:!o.UserInterface.isNavigatingWithKeyboard(),autoFocusWhenActive:!0,buttonAccessibilityLabel:this.state.isMobileScreenReaderEnabled?L.getString("HubHeaderPanel.SearchHubAccessibilityLabel"):void 0,rawSearchQuery:this.state.rawSearchQuery||"",onInputTextChange:this._onInputTextChange,onActive:this._onSearchActive,onKeyDown:this._onSearchInputKeyDown}))}e=o.createElement(o.View,{style:Se.headerContainer,key:fe},this._renderCompositeNavHeader(),o.createElement(o.View,{style:[Se.innerHeaderContainer,this._themeStyles.searchBoxColorStyle]},t))}return e}_renderEntitlementsBanner(){if(this._isPresentedInDesktopLeftNav())return o.createElement(oe.default,{location:I.ExperimentLocation.CallsPanelBanner,useCompactLayout:this.state.rowSize===G.RowSize.ExtraCompact,onClose:()=>{this._searchResultsList&&this._searchResultsList.focusFirst()}})}_renderCompositeNavHeader(){return o.createElement(ae.SimplePanelHeader,{panelName:this._getHeaderText(this.state),leftButton:this._getHeaderCloseButton(),hideBottomBorder:!0,delayHeaderFocus:!1})}_getMenuSections(){return[{key:"calls",menuItems:a.map(me,e=>({text:we._menuItemTitle(e),command:we._menuItemCommand(e),selected:e===this.state.filter,isCheckbox:!0}))}]}_getSearchButtonConfig(){if(!this.props.hideHeader||this.props.hideSearchBar)return;const e=this.state.useIOSSearchStyles?$.SearchInputHeight.iOS:this.state.isSmallDevice?$.SearchInputHeight.small:$.SearchInputHeight.default;return{renderItem:this._getSearchButton,height:e}}_getHeaderCloseButton(){return this.state.isInGroupCallMode&&!this.props.newGroup?{text:L.getString("Global.CancelLabel"),onPress:this._leaveGroupCallMode,title:L.getString("Global.CancelLabel"),closeButtonType:ae.CloseButtonType.Back}:{title:this.props.callId||!this.state.useMobileOrTabletUI&&!this.props.isAloneInNavStack?L.getString("Global.BackButtonTitle"):L.getString("QuickCallPanel.CloseButtonAccessibilityLabel"),onPress:this._onPressClose,setButtonRef:this._onGroupCallBackHeaderButtonRef,closeButtonType:(this.state.useMobileOrTabletUI||this.props.isAloneInNavStack)&&this.props.navigationDirection!==re.StackNavigationDirection.Push?ae.CloseButtonType.Close:ae.CloseButtonType.Back}}_groupCallModeHeaderButton(){const e=!this.state.selectedMris||0===this.state.selectedMris.length;return{text:this.props.callId?L.getString("QuickCallPanel.AddToCallText"):L.getString("QuickCallPanel.StartCallText"),onPress:this.props.callId?this._addSelectedUsersToCall:this._startGroupCall,disabled:e,showActivityIndicator:this.state.isNewGroupCallStarting,setButtonRef:this._onGroupCallModeHeaderButtonRef}}_getFooterButton(){if(this.state.isInGroupCallMode)return this._groupCallModeHeaderButton();const e=this.props.callId?L.getString("QuickCallPanel.AddMultiplePeople"):L.getString("QuickCallPanel.CallMultiplePeople");return{icon:this.props.callId?ue.SkypeIcon.ContactGroupAdd:ue.SkypeIcon.ContactGroupCall,text:e,disabled:this.state.disableHighBandwidthOperations,onPress:this._enterGroupCallMode}}_getHeaderText(e){let t=L.getString("QuickCallPanel.PanelHeaderDefault");return this.props.callId?t=L.getString(this.props.newGroup?"QuickCallPanel.PanelHeaderAddToCall":"QuickCallPanel.PanelHeaderNewCall"):e.isInGroupCallMode&&(t=L.getString(this.props.newGroup?"QuickCallPanel.PanelHeaderNewCall":"QuickCallPanel.SelectParticipantsHeader")),t}_addUsersToCall(e,t){if(A.log(T.LogTraceArea.QuickCallPanel,"_addUsersToCall causeId: "+t),!this.props.callId)return;c.default.CallParticipantUtils.addUsersToCallOrRing(e,this.props.callId,this.props.conversationId,this.state.conversationMemberMris,this.props.addToCallTelemetryOrigin||T.NavigationAddToCallOrigin.Unknown);const i=L.getString("QuickCallPanel.AddToCallAnnouncement",{count:e.length});o.Accessibility.announceForAccessibility(i),this.state.useMobileOrTabletUI?this._onPressClose():this._goBack(t)}_searchResultsListActionHelper(e,t,i){if(this.state.isInGroupCallMode){if(!r.default.getS4LCMCFeatures().enableUIToSelectSkypeOrPSTNContactToAddToGroupCall)return void this._addOrRemoveUserSelection(t,i);const n=e=>{this._addOrRemoveUserSelection(e,i)},o=(e,t)=>{this.state.mriToPhoneMriMap.set(t,e),n(t)},s=pe.default.getDisplayableUserByMri(t);let l=p.isPhoneMri(t)?[]:E.mergeMriProfileAndExtraPhones(t,void 0,s?s.phoneNumbers:void 0);const c=a.includes(this.state.selectedMris,t);return void(a.isEmpty(l)||c?(c&&this._removeEntryFromMriToPhoneMap(t),this._addOrRemoveUserSelection(t,i)):h.default.showForSkypeMri(e,this._getRootViewId(),t,void 0,!0,T.ContactInviteOrigin.Unknown,T.NavigationCallOrigin.Unknown,n,o,void 0,l))}if(this.props.callId)return void this._addUserToExistingCall(t,i);if(!t)return void A.error(T.LogTraceArea.QuickCallPanel,"_searchResultsListActionHelper with unactionable listItemMri: "+K.mriOrId(t)+", causeId: "+i);if(!p.isMri(t)&&E.isLocalAddressBookContact(t))return void this._handleAddressBookContactClick(e,t);const n=()=>{D.default.navigateToConversation({convId:t,causeId:i,origin:T.NavigationConversationOrigin.Search})};a.trim(this.state.rawSearchQuery).length||this._isPresentedInDesktopLeftNav()&&t?n():this._startCallToMri(t,e,i,T.NavigationCallOrigin.CallsTabQuickCallPanel)}_startCallToMri(e,t,i,a){if(A.log(T.LogTraceArea.QuickCallPanel,"_startCallToMri causeId: "+i),this.props.callId)return void A.log(T.LogTraceArea.QuickCallPanel,"_startCallToMri, callId must not be defined, causeId: "+i);if(!e||!p.isMri(e)||!c.default.CallNavigationHelper.isOutgoingCallingAllowed(e))return void A.log(T.LogTraceArea.QuickCallPanel,"_startCallToMri, calling not allowed, causeId: "+i);const n=V.default.getContactByCorrespondingMri(e);h.default.startCallOrMaybePrompt(t,this._getRootViewId(),{skypeMri:e,phones:n?n.phones:void 0,inviteOrigin:T.ContactInviteOrigin.CallPanelSearch,callOrigin:a,userIntent:u.StartCallOrMaybePromptUserIntent.Generic},i)}_handleAddressBookContactClick(e,t){const i=V.default.getContactById(t);i&&i.phones&&h.default.showForAddressContact(e,this._getRootViewId(),i.getDisplayName(),T.ContactInviteOrigin.CallPanelSearch,T.NavigationCallOrigin.QuickCallPanelCall,i.phones,i.emails)}_addUserToExistingCall(e,t){if(A.log(T.LogTraceArea.QuickCallPanel,"_addUserToExistingCall causeId: "+t),!this.props.callId)return;if(!this.state.conversationMemberMris||0===this.state.conversationMemberMris.length)return;const i=p.sanitizeMri(e,p.Namespaces.SkypeId);c.default.CallParticipantUtils.addUsersToCallOrRing([i],this.props.callId,this.props.conversationId,this.state.conversationMemberMris,this.props.addToCallTelemetryOrigin||T.NavigationAddToCallOrigin.Unknown),this._onPressClose()}_removeEntryFromMriToPhoneMap(e){const t=p.isPhoneMri(e)?pe.default.getConversationOwnerNoSubscription(e):e;return t&&this.state.mriToPhoneMriMap.delete(t),t}_addOrRemoveUserSelection(e,t){A.log(T.LogTraceArea.QuickCallPanel,"_addOrRemoveUserSelection causeId: "+t);const i=a.without(this.state.selectedMris,e);i.length===(this.state.selectedMris?this.state.selectedMris.length:0)&&i.push(e),this.setState({selectedMris:i})}_shouldCollapseHeader(){return this.state.useMobileOrTabletUI&&this.props.searchOnly}_expandOrCollapseHeader(e,t=!0){this._headerExpanded!==e&&(this._searchHeader&&this._searchHeader.setExpandedValue(e?1:0,t),this._headerExpanded=e)}_showOrHideHeader(e,t,i=!0){this._searchActive=!t;const a=this._getRootViewId(),n=this._headerHeight(e),s=t?0:-1*n;let r=t?n+C.default.collapsableHeight(a):C.default.expandedHeight(a)+e.statusBarPadding;i?o.Animated.parallel([o.Animated.timing(this._headerAnimatedTopValue,{toValue:s,duration:200,easing:o.Animated.Easing.Out()}),o.Animated.timing(this._headerAnimatedHeightValue,{toValue:r,duration:200,easing:o.Animated.Easing.Out()})]).start():(this._headerAnimatedTopValue.setValue(s),this._headerAnimatedHeightValue.setValue(r))}_headerHeight(e){return(e.isPortrait?e.isSmallDevice?ae.HeaderHeightSmall:ae.HeaderHeight:e.isSmallDevice?ae.HeaderHeightLandscapeSmall:ae.HeaderHeightLandscape)+e.statusBarPadding}_setAnimatedValues(e,t){if(this._wrappedTransitionView){const i=o.Styles.createAnimatedViewStyle({transform:[{translateY:e.interpolate({inputRange:[t-1,t,t+1],outputRange:[90,0,0]})}]});this._wrappedTransitionView.setAnimatedStyle(i)}}_clearAnimatedValues(){this._wrappedTransitionView&&this._wrappedTransitionView.setAnimatedStyle(this._resetTransitionStyle)}_shouldShowDialPadBar(e){return a.some(e,e=>e.groupType===T.SearchResultsListGroup.PstnDialpad)&&!this._isPresentedInDesktopLeftNav()&&!this.state.enableIOSCallsFABExperiment}_isUsedDuringCall(){return!!this.props.callId}_updateStatusBarStyle(e){this._getContext().isPresentedByMobileStackNavigator&&super._updateStatusBarStyle(e)}static _menuItemTitle(e){switch(e){case H.QuickCallPanelFilter.All:return L.getString("QuickCallPanel.AllFilter");case H.QuickCallPanelFilter.Skype:return L.getString("QuickCallPanel.SkypeFilter");case H.QuickCallPanelFilter.Phone:return L.getString("QuickCallPanel.PhoneFilter")}return""}static _menuItemCommand(e){switch(e){case H.QuickCallPanelFilter.All:return H.QuickCallPanelMenuItemCommand.all;case H.QuickCallPanelFilter.Skype:return H.QuickCallPanelMenuItemCommand.skype;case H.QuickCallPanelFilter.Phone:return H.QuickCallPanelMenuItemCommand.phone}return""}static _filterForCommand(e){switch(e){case H.QuickCallPanelMenuItemCommand.all:return H.QuickCallPanelFilter.All;case H.QuickCallPanelMenuItemCommand.skype:return H.QuickCallPanelFilter.Skype;case H.QuickCallPanelMenuItemCommand.phone:return H.QuickCallPanelFilter.Phone}}}t.default=we}}]);